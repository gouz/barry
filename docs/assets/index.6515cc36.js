const Nc=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))e(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&e(s)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function e(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}};Nc();window.$barry={methods:{longMiddle:{label:"Le mi-chemin en temps sur le plus long trajet entre toutes les villes",color:"#10b981"},average:{label:"La moyenne des coordonn\xE9es des villes",color:"#3b82f6"},center:{label:"Le centre du cadre dans lequel toutes les villes sont pr\xE9sentes",color:"#f59e0b"}},addressColor:"#111827",resultColor:"#EF4444",roadColor:"#47695B",calculateMode:"time",calculateTransport:"car",calculateToll:!0,addressesCount:0,places:{},layers:{},addressToCalc:{},urlTourismAPI:"https://titi.gougouzian.fr",tourismCategory:["Sports","Cultural","Hotel","Food","Camping","Event","Tour"],pois:{},$addressesWrapper:document.getElementById("addresses-wrapper"),$augmentConfiguration:document.getElementById("augmentConfiguration"),$augmentWelcome:document.getElementById("augmentWelcome"),$calculate:document.getElementById("calculate"),$configuration:document.getElementById("configuration"),$log:document.getElementById("log"),$logContent:document.getElementById("log-content"),$newsearch:document.getElementById("newsearch"),$reduceConfiguration:document.getElementById("reduceConfiguration"),$reduceWelcome:document.getElementById("reduceWelcome"),$pois:document.getElementById("pois"),$rappel:document.getElementById("rappel"),$spinner:document.getElementById("spinner"),$toggleCalcMode:document.getElementById("toggleCalcMode"),$toggleLogMode:document.getElementById("toggleLogMode"),$welcome:document.getElementById("welcome"),$popin:document.getElementById("popin")};window.$barry.calcAddress=(i,r,t)=>{if(i.key=="Enter"){if(t!="")window.$barry.canPlace(`place_${r}`),window.$barry.placePoint(t,`place_${r}`),window.$barry.newAddress(`address_${window.$barry.addressesCount-1}`),document.querySelector(`#address_${window.$barry.addressesCount-1} input`).focus();else if(Object.keys(window.$barry.places).length>0){window.$barry.removeAddress(`address_${r}`);const e=document.querySelectorAll(".address");e[e.length-1].querySelector(".plus").classList.remove("hide"),e[e.length-1].querySelector(".minus").classList.add("hide")}}};window.$barry.calcBox=()=>{const i=Object.keys(window.$barry.places);let r=99,t=-99,e=99,n=-99;for(let o=0;o<i.length;o++)if(i[o].startsWith("place")){const s=parseFloat(window.$barry.places[i[o]][0]),l=parseFloat(window.$barry.places[i[o]][1]);r>s&&(r=s),t<s&&(t=s),e>l&&(e=l),n<l&&(n=l)}return[[e,r],[n,t]]};var $n={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},jt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function J(){return function(){throw new Error("Unimplemented abstract method.")}()}var Dc=0;function gt(i){return i.ol_uid||(i.ol_uid=String(++Dc))}var Fc="6.14.1",Gc=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),kc=function(i){Gc(r,i);function r(t){var e=this,n="v"+Fc.split("-")[0],o="Assertion failed. See https://openlayers.org/en/"+n+"/doc/errors/#"+t+" for details.";return e=i.call(this,o)||this,e.code=t,e.name="AssertionError",e.message=o,e}return r}(Error),yl=kc;function ht(i,r){if(!i)throw new yl(r)}function qo(i){for(var r=ce(),t=0,e=i.length;t<e;++t)Bn(r,i[t]);return r}function Uc(i,r,t){var e=Math.min.apply(null,i),n=Math.min.apply(null,r),o=Math.max.apply(null,i),s=Math.max.apply(null,r);return Oe(e,n,o,s,t)}function Es(i,r,t){return t?(t[0]=i[0]-r,t[1]=i[1]-r,t[2]=i[2]+r,t[3]=i[3]+r,t):[i[0]-r,i[1]-r,i[2]+r,i[3]+r]}function ml(i,r){return r?(r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r):i.slice()}function Fr(i,r,t){var e,n;return r<i[0]?e=i[0]-r:i[2]<r?e=r-i[2]:e=0,t<i[1]?n=i[1]-t:i[3]<t?n=t-i[3]:n=0,e*e+n*n}function oi(i,r){return ws(i,r[0],r[1])}function un(i,r){return i[0]<=r[0]&&r[2]<=i[2]&&i[1]<=r[1]&&r[3]<=i[3]}function ws(i,r,t){return i[0]<=r&&r<=i[2]&&i[1]<=t&&t<=i[3]}function Ko(i,r){var t=i[0],e=i[1],n=i[2],o=i[3],s=r[0],l=r[1],u=jt.UNKNOWN;return s<t?u=u|jt.LEFT:s>n&&(u=u|jt.RIGHT),l<e?u=u|jt.BELOW:l>o&&(u=u|jt.ABOVE),u===jt.UNKNOWN&&(u=jt.INTERSECTING),u}function ce(){return[1/0,1/0,-1/0,-1/0]}function Oe(i,r,t,e,n){return n?(n[0]=i,n[1]=r,n[2]=t,n[3]=e,n):[i,r,t,e]}function si(i){return Oe(1/0,1/0,-1/0,-1/0,i)}function jc(i,r){var t=i[0],e=i[1];return Oe(t,e,t,e,r)}function El(i,r,t,e,n){var o=si(n);return Tl(o,i,r,t,e)}function zn(i,r){return i[0]==r[0]&&i[2]==r[2]&&i[1]==r[1]&&i[3]==r[3]}function wl(i,r){return r[0]<i[0]&&(i[0]=r[0]),r[2]>i[2]&&(i[2]=r[2]),r[1]<i[1]&&(i[1]=r[1]),r[3]>i[3]&&(i[3]=r[3]),i}function Bn(i,r){r[0]<i[0]&&(i[0]=r[0]),r[0]>i[2]&&(i[2]=r[0]),r[1]<i[1]&&(i[1]=r[1]),r[1]>i[3]&&(i[3]=r[1])}function Tl(i,r,t,e,n){for(;t<e;t+=n)$c(i,r[t],r[t+1]);return i}function $c(i,r,t){i[0]=Math.min(i[0],r),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],r),i[3]=Math.max(i[3],t)}function Rl(i,r){var t;return t=r(co(i)),t||(t=r(ho(i)),t)||(t=r(fo(i)),t)||(t=r(Gr(i)),t)?t:!1}function Ho(i){var r=0;return Ts(i)||(r=It(i)*me(i)),r}function co(i){return[i[0],i[1]]}function ho(i){return[i[2],i[1]]}function Lr(i){return[(i[0]+i[2])/2,(i[1]+i[3])/2]}function Xc(i,r){var t;return r===$n.BOTTOM_LEFT?t=co(i):r===$n.BOTTOM_RIGHT?t=ho(i):r===$n.TOP_LEFT?t=Gr(i):r===$n.TOP_RIGHT?t=fo(i):ht(!1,13),t}function Zo(i,r,t,e,n){var o=r*e[0]/2,s=r*e[1]/2,l=Math.cos(t),u=Math.sin(t),h=o*l,p=o*u,d=s*l,g=s*u,_=i[0],y=i[1],E=_-h+g,w=_-h-g,C=_+h-g,x=_+h+g,S=y-p-d,R=y-p+d,I=y+p+d,b=y+p-d;return Oe(Math.min(E,w,C,x),Math.min(S,R,I,b),Math.max(E,w,C,x),Math.max(S,R,I,b),n)}function me(i){return i[3]-i[1]}function Wn(i,r,t){var e=t||ce();return Jt(i,r)?(i[0]>r[0]?e[0]=i[0]:e[0]=r[0],i[1]>r[1]?e[1]=i[1]:e[1]=r[1],i[2]<r[2]?e[2]=i[2]:e[2]=r[2],i[3]<r[3]?e[3]=i[3]:e[3]=r[3]):si(e),e}function Gr(i){return[i[0],i[3]]}function fo(i){return[i[2],i[3]]}function It(i){return i[2]-i[0]}function Jt(i,r){return i[0]<=r[2]&&i[2]>=r[0]&&i[1]<=r[3]&&i[3]>=r[1]}function Ts(i){return i[2]<i[0]||i[3]<i[1]}function Yc(i,r){return r?(r[0]=i[0],r[1]=i[1],r[2]=i[2],r[3]=i[3],r):i}function Vc(i,r,t){var e=!1,n=Ko(i,r),o=Ko(i,t);if(n===jt.INTERSECTING||o===jt.INTERSECTING)e=!0;else{var s=i[0],l=i[1],u=i[2],h=i[3],p=r[0],d=r[1],g=t[0],_=t[1],y=(_-d)/(g-p),E=void 0,w=void 0;!!(o&jt.ABOVE)&&!(n&jt.ABOVE)&&(E=g-(_-h)/y,e=E>=s&&E<=u),!e&&!!(o&jt.RIGHT)&&!(n&jt.RIGHT)&&(w=_-(g-u)*y,e=w>=l&&w<=h),!e&&!!(o&jt.BELOW)&&!(n&jt.BELOW)&&(E=g-(_-l)/y,e=E>=s&&E<=u),!e&&!!(o&jt.LEFT)&&!(n&jt.LEFT)&&(w=_-(g-s)*y,e=w>=l&&w<=h)}return e}function Bc(i,r,t,e){var n=[];if(e>1)for(var o=i[2]-i[0],s=i[3]-i[1],l=0;l<e;++l)n.push(i[0]+o*l/e,i[1],i[2],i[1]+s*l/e,i[2]-o*l/e,i[3],i[0],i[3]-s*l/e);else n=[i[0],i[1],i[2],i[1],i[2],i[3],i[0],i[3]];r(n,n,2);for(var u=[],h=[],l=0,p=n.length;l<p;l+=2)u.push(n[l]),h.push(n[l+1]);return Uc(u,h,t)}function Wc(i,r){var t=r.getExtent(),e=Lr(i);if(r.canWrapX()&&(e[0]<t[0]||e[0]>=t[2])){var n=It(t),o=Math.floor((e[0]-t[0])/n),s=o*n;i[0]-=s,i[2]-=s}return i}const po=i=>{typeof i=="undefined"&&(i=window.$barry.calcBox());var r=qo([[i[0][1],i[0][0]],[i[1][1],i[1][0]]]);window.$barry.map.getView().fit(r,{size:window.$barry.map.getSize(),padding:[50,50,50,50],duration:2e3})};var Jo=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},go={exports:{}},vo={},Sl={},Qo=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,ya=new RegExp("[\\-\\.0-9"+Qo.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),ma=new RegExp("^"+Qo.source+ya.source+"*(?::"+Qo.source+ya.source+"*)?$"),Fn=0,He=1,Hr=2,Gn=3,Zr=4,Jr=5,kn=6,Li=7;function xl(){}xl.prototype={parse:function(i,r,t){var e=this.domBuilder;e.startDocument(),Cl(r,r={}),zc(i,r,t,e,this.errorHandler),e.endDocument()}};function zc(i,r,t,e,n){function o(N){if(N>65535){N-=65536;var $=55296+(N>>10),Q=56320+(N&1023);return String.fromCharCode($,Q)}else return String.fromCharCode(N)}function s(N){var $=N.slice(1,-1);return $ in t?t[$]:$.charAt(0)==="#"?o(parseInt($.substr(1).replace("x","0x"))):(n.error("entity not found:"+N),N)}function l(N){if(N>E){var $=i.substring(E,N).replace(/&#?\w+;/g,s);g&&u(E),e.characters($,0,N-E),E=N}}function u(N,$){for(;N>=p&&($=d.exec(i));)h=$.index,p=h+$[0].length,g.lineNumber++;g.columnNumber=N-h+1}for(var h=0,p=0,d=/.*(?:\r\n?|\n)|.*$/g,g=e.locator,_=[{currentNSMap:r}],y={},E=0;;){try{var w=i.indexOf("<",E);if(w<0){if(!i.substr(E).match(/^\s*$/)){var C=e.doc,x=C.createTextNode(i.substr(E));C.appendChild(x),e.currentElement=x}return}switch(w>E&&l(w),i.charAt(w+1)){case"/":var k=i.indexOf(">",w+3),S=i.substring(w+2,k),R=_.pop();k<0?(S=i.substring(w+2).replace(/[\s<].*/,""),n.error("end tag name: "+S+" is not complete:"+R.tagName),k=w+1+S.length):S.match(/\s</)&&(S=S.replace(/[\s<].*/,""),n.error("end tag name: "+S+" maybe not complete"),k=w+1+S.length);var I=R.localNSMap,b=R.tagName==S,F=b||R.tagName&&R.tagName.toLowerCase()==S.toLowerCase();if(F){if(e.endElement(R.uri,R.localName,S),I)for(var A in I)e.endPrefixMapping(A);b||n.fatalError("end tag name: "+S+" is not match the current start tagName:"+R.tagName)}else _.push(R);k++;break;case"?":g&&u(w),k=Jc(i,w,e);break;case"!":g&&u(w),k=Zc(i,w,e,n);break;default:g&&u(w);var M=new Ol,j=_[_.length-1].currentNSMap,k=qc(i,w,M,j,s,n),U=M.length;if(!M.closed&&Hc(i,k,M.tagName,y)&&(M.closed=!0,t.nbsp||n.warning("unclosed xml attribute")),g&&U){for(var X=Ea(g,{}),K=0;K<U;K++){var Y=M[K];u(Y.offset),Y.locator=Ea(g,{})}e.locator=X,wa(M,e,j)&&_.push(M),e.locator=g}else wa(M,e,j)&&_.push(M);M.uri==="http://www.w3.org/1999/xhtml"&&!M.closed?k=Kc(i,k,M.tagName,s,e):k++}}catch(N){n.error("element parse error: "+N),k=-1}k>E?E=k:l(Math.max(w,E)+1)}}function Ea(i,r){return r.lineNumber=i.lineNumber,r.columnNumber=i.columnNumber,r}function qc(i,r,t,e,n,o){for(var s,l,u=++r,h=Fn;;){var p=i.charAt(u);switch(p){case"=":if(h===He)s=i.slice(r,u),h=Gn;else if(h===Hr)h=Gn;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(h===Gn||h===He)if(h===He&&(o.warning('attribute value must after "="'),s=i.slice(r,u)),r=u+1,u=i.indexOf(p,r),u>0)l=i.slice(r,u).replace(/&#?\w+;/g,n),t.add(s,l,r-1),h=Jr;else throw new Error("attribute value no end '"+p+"' match");else if(h==Zr)l=i.slice(r,u).replace(/&#?\w+;/g,n),t.add(s,l,r),o.warning('attribute "'+s+'" missed start quot('+p+")!!"),r=u+1,h=Jr;else throw new Error('attribute value must after "="');break;case"/":switch(h){case Fn:t.setTagName(i.slice(r,u));case Jr:case kn:case Li:h=Li,t.closed=!0;case Zr:case He:case Hr:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return o.error("unexpected end of input"),h==Fn&&t.setTagName(i.slice(r,u)),u;case">":switch(h){case Fn:t.setTagName(i.slice(r,u));case Jr:case kn:case Li:break;case Zr:case He:l=i.slice(r,u),l.slice(-1)==="/"&&(t.closed=!0,l=l.slice(0,-1));case Hr:h===Hr&&(l=s),h==Zr?(o.warning('attribute "'+l+'" missed quot(")!!'),t.add(s,l.replace(/&#?\w+;/g,n),r)):((e[""]!=="http://www.w3.org/1999/xhtml"||!l.match(/^(?:disabled|checked|selected)$/i))&&o.warning('attribute "'+l+'" missed value!! "'+l+'" instead!!'),t.add(l,l,r));break;case Gn:throw new Error("attribute value missed!!")}return u;case"\x80":p=" ";default:if(p<=" ")switch(h){case Fn:t.setTagName(i.slice(r,u)),h=kn;break;case He:s=i.slice(r,u),h=Hr;break;case Zr:var l=i.slice(r,u).replace(/&#?\w+;/g,n);o.warning('attribute "'+l+'" missed quot(")!!'),t.add(s,l,r);case Jr:h=kn;break}else switch(h){case Hr:t.tagName,(e[""]!=="http://www.w3.org/1999/xhtml"||!s.match(/^(?:disabled|checked|selected)$/i))&&o.warning('attribute "'+s+'" missed value!! "'+s+'" instead2!!'),t.add(s,s,r),r=u,h=He;break;case Jr:o.warning('attribute space is required"'+s+'"!!');case kn:h=He,r=u;break;case Gn:h=Zr,r=u;break;case Li:throw new Error("elements closed character '/' and '>' must be connected to")}}u++}}function wa(i,r,t){for(var e=i.tagName,n=null,d=i.length;d--;){var o=i[d],s=o.qName,l=o.value,g=s.indexOf(":");if(g>0)var u=o.prefix=s.slice(0,g),h=s.slice(g+1),p=u==="xmlns"&&h;else h=s,u=null,p=s==="xmlns"&&"";o.localName=h,p!==!1&&(n==null&&(n={},Cl(t,t={})),t[p]=n[p]=l,o.uri="http://www.w3.org/2000/xmlns/",r.startPrefixMapping(p,l))}for(var d=i.length;d--;){o=i[d];var u=o.prefix;u&&(u==="xml"&&(o.uri="http://www.w3.org/XML/1998/namespace"),u!=="xmlns"&&(o.uri=t[u||""]))}var g=e.indexOf(":");g>0?(u=i.prefix=e.slice(0,g),h=i.localName=e.slice(g+1)):(u=null,h=i.localName=e);var _=i.uri=t[u||""];if(r.startElement(_,h,e,i),i.closed){if(r.endElement(_,h,e),n)for(u in n)r.endPrefixMapping(u)}else return i.currentNSMap=t,i.localNSMap=n,!0}function Kc(i,r,t,e,n){if(/^(?:script|textarea)$/i.test(t)){var o=i.indexOf("</"+t+">",r),s=i.substring(r+1,o);if(/[&<]/.test(s))return/^script$/i.test(t)?(n.characters(s,0,s.length),o):(s=s.replace(/&#?\w+;/g,e),n.characters(s,0,s.length),o)}return r+1}function Hc(i,r,t,e){var n=e[t];return n==null&&(n=i.lastIndexOf("</"+t+">"),n<r&&(n=i.lastIndexOf("</"+t)),e[t]=n),n<r}function Cl(i,r){for(var t in i)r[t]=i[t]}function Zc(i,r,t,e){var n=i.charAt(r+2);switch(n){case"-":if(i.charAt(r+3)==="-"){var o=i.indexOf("-->",r+4);return o>r?(t.comment(i,r+4,o-r-4),o+3):(e.error("Unclosed comment"),-1)}else return-1;default:if(i.substr(r+3,6)=="CDATA["){var o=i.indexOf("]]>",r+9);return t.startCDATA(),t.characters(i,r+9,o-r-9),t.endCDATA(),o+3}var s=Qc(i,r),l=s.length;if(l>1&&/!doctype/i.test(s[0][0])){var u=s[1][0],h=l>3&&/^public$/i.test(s[2][0])&&s[3][0],p=l>4&&s[4][0],d=s[l-1];return t.startDTD(u,h&&h.replace(/^(['"])(.*?)\1$/,"$2"),p&&p.replace(/^(['"])(.*?)\1$/,"$2")),t.endDTD(),d.index+d[0].length}}return-1}function Jc(i,r,t){var e=i.indexOf("?>",r);if(e){var n=i.substring(r,e).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return n?(n[0].length,t.processingInstruction(n[1],n[2]),e+2):-1}return-1}function Ol(i){}Ol.prototype={setTagName:function(i){if(!ma.test(i))throw new Error("invalid tagName:"+i);this.tagName=i},add:function(i,r,t){if(!ma.test(i))throw new Error("invalid attribute:"+i);this[this.length++]={qName:i,value:r,offset:t}},length:0,getLocalName:function(i){return this[i].localName},getLocator:function(i){return this[i].locator},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}};function Mi(i,r){return i.__proto__=r,i}Mi({},Mi.prototype)instanceof Mi||(Mi=function(i,r){function t(){}t.prototype=r,t=new t;for(r in i)t[r]=i[r];return t});function Qc(i,r){var t,e=[],n=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(n.lastIndex=r,n.exec(i);t=n.exec(i);)if(e.push(t),t[1])return e}Sl.XMLReader=xl;var _o={};function ai(i,r){for(var t in i)r[t]=i[t]}function te(i,r){var t=i.prototype;if(Object.create){var e=Object.create(r.prototype);t.__proto__=e}if(!(t instanceof r)){let o=function(){};var n=o;o.prototype=r.prototype,o=new o,ai(t,o),i.prototype=t=o}t.constructor!=i&&(typeof i!="function"&&console.error("unknow Class:"+i),t.constructor=i)}var th="http://www.w3.org/1999/xhtml",ee={},xe=ee.ELEMENT_NODE=1,vn=ee.ATTRIBUTE_NODE=2,Ki=ee.TEXT_NODE=3,Il=ee.CDATA_SECTION_NODE=4,Al=ee.ENTITY_REFERENCE_NODE=5,eh=ee.ENTITY_NODE=6,Pl=ee.PROCESSING_INSTRUCTION_NODE=7,bl=ee.COMMENT_NODE=8,Ll=ee.DOCUMENT_NODE=9,Ml=ee.DOCUMENT_TYPE_NODE=10,Xe=ee.DOCUMENT_FRAGMENT_NODE=11,rh=ee.NOTATION_NODE=12,zt={},$t={};zt.INDEX_SIZE_ERR=($t[1]="Index size error",1);zt.DOMSTRING_SIZE_ERR=($t[2]="DOMString size error",2);var nh=zt.HIERARCHY_REQUEST_ERR=($t[3]="Hierarchy request error",3);zt.WRONG_DOCUMENT_ERR=($t[4]="Wrong document",4);zt.INVALID_CHARACTER_ERR=($t[5]="Invalid character",5);zt.NO_DATA_ALLOWED_ERR=($t[6]="No data allowed",6);zt.NO_MODIFICATION_ALLOWED_ERR=($t[7]="No modification allowed",7);var ih=zt.NOT_FOUND_ERR=($t[8]="Not found",8);zt.NOT_SUPPORTED_ERR=($t[9]="Not supported",9);var Ta=zt.INUSE_ATTRIBUTE_ERR=($t[10]="Attribute in use",10);zt.INVALID_STATE_ERR=($t[11]="Invalid state",11);zt.SYNTAX_ERR=($t[12]="Syntax error",12);zt.INVALID_MODIFICATION_ERR=($t[13]="Invalid modification",13);zt.NAMESPACE_ERR=($t[14]="Invalid namespace",14);zt.INVALID_ACCESS_ERR=($t[15]="Invalid access",15);function _n(i,r){if(r instanceof Error)var t=r;else t=this,Error.call(this,$t[i]),this.message=$t[i],Error.captureStackTrace&&Error.captureStackTrace(this,_n);return t.code=i,r&&(this.message=this.message+": "+r),t}_n.prototype=Error.prototype;ai(zt,_n);function lr(){}lr.prototype={length:0,item:function(i){return this[i]||null},toString:function(i,r){for(var t=[],e=0;e<this.length;e++)cn(this[e],t,i,r);return t.join("")}};function qn(i,r){this._node=i,this._refresh=r,Rs(this)}function Rs(i){var r=i._node._inc||i._node.ownerDocument._inc;if(i._inc!=r){var t=i._refresh(i._node);Vl(i,"length",t.length),ai(t,i),i._inc=r}}qn.prototype.item=function(i){return Rs(this),this[i]};te(qn,lr);function Hi(){}function Nl(i,r){for(var t=i.length;t--;)if(i[t]===r)return t}function Ra(i,r,t,e){if(e?r[Nl(r,e)]=t:r[r.length++]=t,i){t.ownerElement=i;var n=i.ownerDocument;n&&(e&&Fl(n,i,e),oh(n,i,t))}}function Sa(i,r,t){var e=Nl(r,t);if(e>=0){for(var n=r.length-1;e<n;)r[e]=r[++e];if(r.length=n,i){var o=i.ownerDocument;o&&(Fl(o,i,t),t.ownerElement=null)}}else throw _n(ih,new Error(i.tagName+"@"+t))}Hi.prototype={length:0,item:lr.prototype.item,getNamedItem:function(i){for(var r=this.length;r--;){var t=this[r];if(t.nodeName==i)return t}},setNamedItem:function(i){var r=i.ownerElement;if(r&&r!=this._ownerElement)throw new _n(Ta);var t=this.getNamedItem(i.nodeName);return Ra(this._ownerElement,this,i,t),t},setNamedItemNS:function(i){var r=i.ownerElement,t;if(r&&r!=this._ownerElement)throw new _n(Ta);return t=this.getNamedItemNS(i.namespaceURI,i.localName),Ra(this._ownerElement,this,i,t),t},removeNamedItem:function(i){var r=this.getNamedItem(i);return Sa(this._ownerElement,this,r),r},removeNamedItemNS:function(i,r){var t=this.getNamedItemNS(i,r);return Sa(this._ownerElement,this,t),t},getNamedItemNS:function(i,r){for(var t=this.length;t--;){var e=this[t];if(e.localName==r&&e.namespaceURI==i)return e}return null}};function Dl(i){if(this._features={},i)for(var r in i)this._features=i[r]}Dl.prototype={hasFeature:function(i,r){var t=this._features[i.toLowerCase()];return!!(t&&(!r||r in t))},createDocument:function(i,r,t){var e=new li;if(e.implementation=this,e.childNodes=new lr,e.doctype=t,t&&e.appendChild(t),r){var n=e.createElementNS(i,r);e.appendChild(n)}return e},createDocumentType:function(i,r,t){var e=new Is;return e.name=i,e.nodeName=i,e.publicId=r,e.systemId=t,e}};function Kt(){}Kt.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(i,r){return kl(this,i,r)},replaceChild:function(i,r){this.insertBefore(i,r),r&&this.removeChild(r)},removeChild:function(i){return Gl(this,i)},appendChild:function(i){return this.insertBefore(i,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(i){return ts(this.ownerDocument||this,this,i)},normalize:function(){for(var i=this.firstChild;i;){var r=i.nextSibling;r&&r.nodeType==Ki&&i.nodeType==Ki?(this.removeChild(r),i.appendData(r.data)):(i.normalize(),i=r)}},isSupported:function(i,r){return this.ownerDocument.implementation.hasFeature(i,r)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(i){for(var r=this;r;){var t=r._nsMap;if(t){for(var e in t)if(t[e]==i)return e}r=r.nodeType==vn?r.ownerDocument:r.parentNode}return null},lookupNamespaceURI:function(i){for(var r=this;r;){var t=r._nsMap;if(t&&i in t)return t[i];r=r.nodeType==vn?r.ownerDocument:r.parentNode}return null},isDefaultNamespace:function(i){var r=this.lookupPrefix(i);return r==null}};function xa(i){return i=="<"&&"&lt;"||i==">"&&"&gt;"||i=="&"&&"&amp;"||i=='"'&&"&quot;"||"&#"+i.charCodeAt()+";"}ai(ee,Kt);ai(ee,Kt.prototype);function Zi(i,r){if(r(i))return!0;if(i=i.firstChild)do if(Zi(i,r))return!0;while(i=i.nextSibling)}function li(){}function oh(i,r,t){i&&i._inc++;var e=t.namespaceURI;e=="http://www.w3.org/2000/xmlns/"&&(r._nsMap[t.prefix?t.localName:""]=t.value)}function Fl(i,r,t,e){i&&i._inc++;var n=t.namespaceURI;n=="http://www.w3.org/2000/xmlns/"&&delete r._nsMap[t.prefix?t.localName:""]}function Ss(i,r,t){if(i&&i._inc){i._inc++;var e=r.childNodes;if(t)e[e.length++]=t;else{for(var n=r.firstChild,o=0;n;)e[o++]=n,n=n.nextSibling;e.length=o}}}function Gl(i,r){var t=r.previousSibling,e=r.nextSibling;return t?t.nextSibling=e:i.firstChild=e,e?e.previousSibling=t:i.lastChild=t,Ss(i.ownerDocument,i),r}function kl(i,r,t){var e=r.parentNode;if(e&&e.removeChild(r),r.nodeType===Xe){var n=r.firstChild;if(n==null)return r;var o=r.lastChild}else n=o=r;var s=t?t.previousSibling:i.lastChild;n.previousSibling=s,o.nextSibling=t,s?s.nextSibling=n:i.firstChild=n,t==null?i.lastChild=o:t.previousSibling=o;do n.parentNode=i;while(n!==o&&(n=n.nextSibling));return Ss(i.ownerDocument||i,i),r.nodeType==Xe&&(r.firstChild=r.lastChild=null),r}function sh(i,r){var t=r.parentNode;if(t){var e=i.lastChild;t.removeChild(r);var e=i.lastChild}var e=i.lastChild;return r.parentNode=i,r.previousSibling=e,r.nextSibling=null,e?e.nextSibling=r:i.firstChild=r,i.lastChild=r,Ss(i.ownerDocument,i,r),r}li.prototype={nodeName:"#document",nodeType:Ll,doctype:null,documentElement:null,_inc:1,insertBefore:function(i,r){if(i.nodeType==Xe){for(var t=i.firstChild;t;){var e=t.nextSibling;this.insertBefore(t,r),t=e}return i}return this.documentElement==null&&i.nodeType==xe&&(this.documentElement=i),kl(this,i,r),i.ownerDocument=this,i},removeChild:function(i){return this.documentElement==i&&(this.documentElement=null),Gl(this,i)},importNode:function(i,r){return Yl(this,i,r)},getElementById:function(i){var r=null;return Zi(this.documentElement,function(t){if(t.nodeType==xe&&t.getAttribute("id")==i)return r=t,!0}),r},createElement:function(i){var r=new yn;r.ownerDocument=this,r.nodeName=i,r.tagName=i,r.childNodes=new lr;var t=r.attributes=new Hi;return t._ownerElement=r,r},createDocumentFragment:function(){var i=new yo;return i.ownerDocument=this,i.childNodes=new lr,i},createTextNode:function(i){var r=new xs;return r.ownerDocument=this,r.appendData(i),r},createComment:function(i){var r=new Cs;return r.ownerDocument=this,r.appendData(i),r},createCDATASection:function(i){var r=new Os;return r.ownerDocument=this,r.appendData(i),r},createProcessingInstruction:function(i,r){var t=new Ps;return t.ownerDocument=this,t.tagName=t.target=i,t.nodeValue=t.data=r,t},createAttribute:function(i){var r=new Ji;return r.ownerDocument=this,r.name=i,r.nodeName=i,r.localName=i,r.specified=!0,r},createEntityReference:function(i){var r=new As;return r.ownerDocument=this,r.nodeName=i,r},createElementNS:function(i,r){var t=new yn,e=r.split(":"),n=t.attributes=new Hi;return t.childNodes=new lr,t.ownerDocument=this,t.nodeName=r,t.tagName=r,t.namespaceURI=i,e.length==2?(t.prefix=e[0],t.localName=e[1]):t.localName=r,n._ownerElement=t,t},createAttributeNS:function(i,r){var t=new Ji,e=r.split(":");return t.ownerDocument=this,t.nodeName=r,t.name=r,t.namespaceURI=i,t.specified=!0,e.length==2?(t.prefix=e[0],t.localName=e[1]):t.localName=r,t}};te(li,Kt);function yn(){this._nsMap={}}yn.prototype={nodeType:xe,hasAttribute:function(i){return this.getAttributeNode(i)!=null},getAttribute:function(i){var r=this.getAttributeNode(i);return r&&r.value||""},getAttributeNode:function(i){return this.attributes.getNamedItem(i)},setAttribute:function(i,r){var t=this.ownerDocument.createAttribute(i);t.value=t.nodeValue=""+r,this.setAttributeNode(t)},removeAttribute:function(i){var r=this.getAttributeNode(i);r&&this.removeAttributeNode(r)},appendChild:function(i){return i.nodeType===Xe?this.insertBefore(i,null):sh(this,i)},setAttributeNode:function(i){return this.attributes.setNamedItem(i)},setAttributeNodeNS:function(i){return this.attributes.setNamedItemNS(i)},removeAttributeNode:function(i){return this.attributes.removeNamedItem(i.nodeName)},removeAttributeNS:function(i,r){var t=this.getAttributeNodeNS(i,r);t&&this.removeAttributeNode(t)},hasAttributeNS:function(i,r){return this.getAttributeNodeNS(i,r)!=null},getAttributeNS:function(i,r){var t=this.getAttributeNodeNS(i,r);return t&&t.value||""},setAttributeNS:function(i,r,t){var e=this.ownerDocument.createAttributeNS(i,r);e.value=e.nodeValue=""+t,this.setAttributeNode(e)},getAttributeNodeNS:function(i,r){return this.attributes.getNamedItemNS(i,r)},getElementsByTagName:function(i){return new qn(this,function(r){var t=[];return Zi(r,function(e){e!==r&&e.nodeType==xe&&(i==="*"||e.tagName==i)&&t.push(e)}),t})},getElementsByTagNameNS:function(i,r){return new qn(this,function(t){var e=[];return Zi(t,function(n){n!==t&&n.nodeType===xe&&(i==="*"||n.namespaceURI===i)&&(r==="*"||n.localName==r)&&e.push(n)}),e})}};li.prototype.getElementsByTagName=yn.prototype.getElementsByTagName;li.prototype.getElementsByTagNameNS=yn.prototype.getElementsByTagNameNS;te(yn,Kt);function Ji(){}Ji.prototype.nodeType=vn;te(Ji,Kt);function ui(){}ui.prototype={data:"",substringData:function(i,r){return this.data.substring(i,i+r)},appendData:function(i){i=this.data+i,this.nodeValue=this.data=i,this.length=i.length},insertData:function(i,r){this.replaceData(i,0,r)},appendChild:function(i){throw new Error($t[nh])},deleteData:function(i,r){this.replaceData(i,r,"")},replaceData:function(i,r,t){var e=this.data.substring(0,i),n=this.data.substring(i+r);t=e+t+n,this.nodeValue=this.data=t,this.length=t.length}};te(ui,Kt);function xs(){}xs.prototype={nodeName:"#text",nodeType:Ki,splitText:function(i){var r=this.data,t=r.substring(i);r=r.substring(0,i),this.data=this.nodeValue=r,this.length=r.length;var e=this.ownerDocument.createTextNode(t);return this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling),e}};te(xs,ui);function Cs(){}Cs.prototype={nodeName:"#comment",nodeType:bl};te(Cs,ui);function Os(){}Os.prototype={nodeName:"#cdata-section",nodeType:Il};te(Os,ui);function Is(){}Is.prototype.nodeType=Ml;te(Is,Kt);function Ul(){}Ul.prototype.nodeType=rh;te(Ul,Kt);function jl(){}jl.prototype.nodeType=eh;te(jl,Kt);function As(){}As.prototype.nodeType=Al;te(As,Kt);function yo(){}yo.prototype.nodeName="#document-fragment";yo.prototype.nodeType=Xe;te(yo,Kt);function Ps(){}Ps.prototype.nodeType=Pl;te(Ps,Kt);function $l(){}$l.prototype.serializeToString=function(i,r,t){return Xl.call(i,r,t)};Kt.prototype.toString=Xl;function Xl(i,r){var t=[],e=this.nodeType==9?this.documentElement:this,n=e.prefix,o=e.namespaceURI;if(o&&n==null){var n=e.lookupPrefix(o);if(n==null)var s=[{namespace:o,prefix:null}]}return cn(this,t,i,r,s),t.join("")}function Ca(i,r,t){var e=i.prefix||"",n=i.namespaceURI;if(!e&&!n||e==="xml"&&n==="http://www.w3.org/XML/1998/namespace"||n=="http://www.w3.org/2000/xmlns/")return!1;for(var o=t.length;o--;){var s=t[o];if(s.prefix==e)return s.namespace!=n}return!0}function cn(i,r,t,e,n){if(e)if(i=e(i),i){if(typeof i=="string"){r.push(i);return}}else return;switch(i.nodeType){case xe:n||(n=[]),n.length;var o=i.attributes,s=o.length,_=i.firstChild,l=i.tagName;t=th===i.namespaceURI||t,r.push("<",l);for(var u=0;u<s;u++){var h=o.item(u);h.prefix=="xmlns"?n.push({prefix:h.localName,namespace:h.value}):h.nodeName=="xmlns"&&n.push({prefix:"",namespace:h.value})}for(var u=0;u<s;u++){var h=o.item(u);if(Ca(h,t,n)){var p=h.prefix||"",d=h.namespaceURI,g=p?" xmlns:"+p:" xmlns";r.push(g,'="',d,'"'),n.push({prefix:p,namespace:d})}cn(h,r,t,e,n)}if(Ca(i,t,n)){var p=i.prefix||"",d=i.namespaceURI,g=p?" xmlns:"+p:" xmlns";r.push(g,'="',d,'"'),n.push({prefix:p,namespace:d})}if(_||t&&!/^(?:meta|link|img|br|hr|input)$/i.test(l)){if(r.push(">"),t&&/^script$/i.test(l))for(;_;)_.data?r.push(_.data):cn(_,r,t,e,n),_=_.nextSibling;else for(;_;)cn(_,r,t,e,n),_=_.nextSibling;r.push("</",l,">")}else r.push("/>");return;case Ll:case Xe:for(var _=i.firstChild;_;)cn(_,r,t,e,n),_=_.nextSibling;return;case vn:return r.push(" ",i.name,'="',i.value.replace(/[<&"]/g,xa),'"');case Ki:return r.push(i.data.replace(/[<&]/g,xa));case Il:return r.push("<![CDATA[",i.data,"]]>");case bl:return r.push("<!--",i.data,"-->");case Ml:var y=i.publicId,E=i.systemId;if(r.push("<!DOCTYPE ",i.name),y)r.push(' PUBLIC "',y),E&&E!="."&&r.push('" "',E),r.push('">');else if(E&&E!=".")r.push(' SYSTEM "',E,'">');else{var w=i.internalSubset;w&&r.push(" [",w,"]"),r.push(">")}return;case Pl:return r.push("<?",i.target," ",i.data,"?>");case Al:return r.push("&",i.nodeName,";");default:r.push("??",i.nodeName)}}function Yl(i,r,t){var e;switch(r.nodeType){case xe:e=r.cloneNode(!1),e.ownerDocument=i;case Xe:break;case vn:t=!0;break}if(e||(e=r.cloneNode(!1)),e.ownerDocument=i,e.parentNode=null,t)for(var n=r.firstChild;n;)e.appendChild(Yl(i,n,t)),n=n.nextSibling;return e}function ts(i,r,t){var e=new r.constructor;for(var n in r){var o=r[n];typeof o!="object"&&o!=e[n]&&(e[n]=o)}switch(r.childNodes&&(e.childNodes=new lr),e.ownerDocument=i,e.nodeType){case xe:var s=r.attributes,l=e.attributes=new Hi,u=s.length;l._ownerElement=e;for(var h=0;h<u;h++)e.setAttributeNode(ts(i,s.item(h),!0));break;case vn:t=!0}if(t)for(var p=r.firstChild;p;)e.appendChild(ts(i,p,t)),p=p.nextSibling;return e}function Vl(i,r,t){i[r]=t}try{if(Object.defineProperty){let i=function(r){switch(r.nodeType){case xe:case Xe:var t=[];for(r=r.firstChild;r;)r.nodeType!==7&&r.nodeType!==8&&t.push(i(r)),r=r.nextSibling;return t.join("");default:return r.nodeValue}};var getTextContent=i;Object.defineProperty(qn.prototype,"length",{get:function(){return Rs(this),this.$$length}}),Object.defineProperty(Kt.prototype,"textContent",{get:function(){return i(this)},set:function(r){switch(this.nodeType){case xe:case Xe:for(;this.firstChild;)this.removeChild(this.firstChild);(r||String(r))&&this.appendChild(this.ownerDocument.createTextNode(r));break;default:this.data=r,this.value=r,this.nodeValue=r}}}),Vl=function(r,t,e){r["$$"+t]=e}}}catch{}_o.DOMImplementation=Dl;_o.XMLSerializer=$l;function Bl(i){this.options=i||{locator:{}}}Bl.prototype.parseFromString=function(i,r){var t=this.options,e=new lh,n=t.domBuilder||new mo,o=t.errorHandler,s=t.locator,l=t.xmlns||{},u={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return s&&n.setDocumentLocator(s),e.errorHandler=ah(o,n,s),e.domBuilder=t.domBuilder||n,/\/x?html?$/.test(r)&&(u.nbsp="\xA0",u.copy="\xA9",l[""]="http://www.w3.org/1999/xhtml"),l.xml=l.xml||"http://www.w3.org/XML/1998/namespace",i?e.parse(i,l,u):e.errorHandler.error("invalid doc source"),n.doc};function ah(i,r,t){if(!i){if(r instanceof mo)return r;i=r}var e={},n=i instanceof Function;t=t||{};function o(s){var l=i[s];!l&&n&&(l=i.length==2?function(u){i(s,u)}:i),e[s]=l&&function(u){l("[xmldom "+s+"]	"+u+zi(t))}||function(){}}return o("warning"),o("error"),o("fatalError"),e}function mo(){this.cdata=!1}function Qr(i,r){r.lineNumber=i.lineNumber,r.columnNumber=i.columnNumber}mo.prototype={startDocument:function(){this.doc=new uh().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(i,r,t,e){var n=this.doc,o=n.createElementNS(i,t||r),s=e.length;Ni(this,o),this.currentElement=o,this.locator&&Qr(this.locator,o);for(var l=0;l<s;l++){var i=e.getURI(l),u=e.getValue(l),t=e.getQName(l),h=n.createAttributeNS(i,t);this.locator&&Qr(e.getLocator(l),h),h.value=h.nodeValue=u,o.setAttributeNode(h)}},endElement:function(i,r,t){var e=this.currentElement;e.tagName,this.currentElement=e.parentNode},startPrefixMapping:function(i,r){},endPrefixMapping:function(i){},processingInstruction:function(i,r){var t=this.doc.createProcessingInstruction(i,r);this.locator&&Qr(this.locator,t),Ni(this,t)},ignorableWhitespace:function(i,r,t){},characters:function(i,r,t){if(i=Oa.apply(this,arguments),i){if(this.cdata)var e=this.doc.createCDATASection(i);else var e=this.doc.createTextNode(i);this.currentElement?this.currentElement.appendChild(e):/^\s*$/.test(i)&&this.doc.appendChild(e),this.locator&&Qr(this.locator,e)}},skippedEntity:function(i){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(i){(this.locator=i)&&(i.lineNumber=0)},comment:function(i,r,t){i=Oa.apply(this,arguments);var e=this.doc.createComment(i);this.locator&&Qr(this.locator,e),Ni(this,e)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(i,r,t){var e=this.doc.implementation;if(e&&e.createDocumentType){var n=e.createDocumentType(i,r,t);this.locator&&Qr(this.locator,n),Ni(this,n)}},warning:function(i){console.warn("[xmldom warning]	"+i,zi(this.locator))},error:function(i){console.error("[xmldom error]	"+i,zi(this.locator))},fatalError:function(i){throw console.error("[xmldom fatalError]	"+i,zi(this.locator)),i}};function zi(i){if(i)return`
@`+(i.systemId||"")+"#[line:"+i.lineNumber+",col:"+i.columnNumber+"]"}function Oa(i,r,t){return typeof i=="string"?i.substr(r,t):i.length>=r+t||r?new java.lang.String(i,r,t)+"":i}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(i){mo.prototype[i]=function(){return null}});function Ni(i,r){i.currentElement?i.currentElement.appendChild(r):i.doc.appendChild(r)}var lh=Sl.XMLReader,uh=vo.DOMImplementation=_o.DOMImplementation;vo.XMLSerializer=_o.XMLSerializer;vo.DOMParser=Bl;var es={exports:{}};(function(i,r){var t=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof Jo!="undefined")return Jo;throw new Error("unable to locate global object")},e=t();i.exports=r=e.fetch,e.fetch&&(r.default=e.fetch.bind(e)),r.Headers=e.Headers,r.Request=e.Request,r.Response=e.Response})(es,es.exports);/*!
 * @brief Geoportal resources access library
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * copyright CeCILL-B
 * copyright IGN
 * @author IGN
 * @version 3.1.0
 * @date 23/03/2022
 *
 */(function(i,r){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4
 */(function(t,e){i.exports=e(vo,es.exports)})(Jo,function(t,e){return function(n){var o={};function s(l){if(o[l])return o[l].exports;var u=o[l]={i:l,l:!1,exports:{}};return n[l].call(u.exports,u,u.exports,s),u.l=!0,u.exports}return s.m=n,s.c=o,s.d=function(l,u,h){s.o(l,u)||Object.defineProperty(l,u,{enumerable:!0,get:h})},s.r=function(l){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},s.t=function(l,u){if(1&u&&(l=s(l)),8&u||4&u&&typeof l=="object"&&l&&l.__esModule)return l;var h=Object.create(null);if(s.r(h),Object.defineProperty(h,"default",{enumerable:!0,value:l}),2&u&&typeof l!="string")for(var p in l)s.d(h,p,function(d){return l[d]}.bind(null,p));return h},s.n=function(l){var u=l&&l.__esModule?function(){return l.default}:function(){return l};return s.d(u,"a",u),u},s.o=function(l,u){return Object.prototype.hasOwnProperty.call(l,u)},s.p="",s(s.s=4)}([function(n){n.exports=JSON.parse(`{"name":"geoportal-access-lib","version":"3.1.0","date":"23/03/2022","description":"French Geoportal resources access library","module":"src/Gp.js","main":"dist/GpServices-src.js","homepage":"https://github.com/IGNF/geoportal-access-lib#readme","scripts":{"clean":"echo \\"Warning: no yet implemented!\\" && exit 0","setup":"npm install","cover":"nyc --reporter=lcov --reporter=text npm run test","eslint":"eslint src/","build":"webpack --mode=none","build:prod":"webpack --mode=production","build:dev":"webpack --mode=development","test":"mocha-webpack --reporter mochawesome --reporter-options reportDir=test-report,reportFilename=index --webpack-config ./test/webpack/webpack.test.js --glob \\"test_*.js\\" test/spec/","test:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.js","test:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.docker.js","test:end-to-end:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.js","test:end-to-end:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.docker.js","sample":"npm run sample:serve","sample:serve":"webpack-dev-server --mode=none --open-page samples/index-src.html --https --content-base . --output-public-path '/dist/' --port 9001 --open","sample:serve:prod":"webpack-dev-server --mode=production --open-page samples/index-prod.html --content-base . --output-public-path '/dist/' --port 9001 --open","sample:serve:dev":"webpack-dev-server --mode=development --open-page samples/index-map.html --content-base . --output-public-path '/dist/' --port 9001 --open","doc":"npm run doc:serve","doc:serve":"webpack-dev-server --content-base jsdoc --port 9001 --open"},"nyc":{"include":["src/**/*.js"],"instrument":false,"sourceMap":false},"repository":{"type":"git","url":"https://github.com/IGNF/geoportal-access-lib.git"},"keywords":["geoportail","webservice","javascript","es6"],"author":"IGNF","license":"CECILL-B","dependencies":{"es6-promise":"^4.2.4","node-fetch":"^2.6.1","xmldom":"^0.1.27"},"devDependencies":{"@babel/core":"^7.12.10","@babel/plugin-transform-template-literals":"^7.12.1","@babel/preset-env":"^7.12.11","babel-loader":"^8.2.2","chai":"^4.1.2","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.1.2","eslint":"^7.18.0","eslint-config-standard":"^16.0.2","eslint-loader":"^4.0.2","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^5.0.0","glob":"^7.1.2","handlebars-layouts":"^3.1.4","handlebars-webpack-plugin":"^1.4.1","html-webpack-plugin":"^4.5.1","istanbul-instrumenter-loader":"^3.0.1","jsdoc-webpack-plugin":"^0.3.0","loglevel":"^1.6.1","mocha":"^7.2.0","mocha-loader":"^5.1.5","mocha-webpack":"^2.0.0-beta.0","mochawesome":"^6.2.1","nyc":"^15.1.0","path":"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0","sinon":"^9.2.4","sinon-es6":"0.0.3","speed-measure-webpack-plugin":"^1.4.2","string-template":"^1.0.0","terser-webpack-plugin":"^2.3.8","webpack":"^4.46.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^2.5.2","webpack-shell-plugin":"^0.5.0"},"bundledDependencies":[],"peerDependencies":{},"optionalDependencies":{}}`)},function(n,o,s){var l,u;(function(h,p){(u=typeof(l=function(){var d=function(){},g=typeof window!="undefined"&&window.navigator!==void 0&&/Trident\/|MSIE /.test(window.navigator.userAgent),_=["trace","debug","info","warn","error"];function y(A,M){var j=A[M];if(typeof j.bind=="function")return j.bind(A);try{return Function.prototype.bind.call(j,A)}catch{return function(){return Function.prototype.apply.apply(j,[A,arguments])}}}function E(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function w(A){return A==="debug"&&(A="log"),typeof console!="undefined"&&(A==="trace"&&g?E:console[A]!==void 0?y(console,A):console.log!==void 0?y(console,"log"):d)}function C(A,M){for(var j=0;j<_.length;j++){var k=_[j];this[k]=j<A?d:this.methodFactory(k,A,M)}this.log=this.debug}function x(A,M,j){return function(){typeof console!="undefined"&&(C.call(this,M,j),this[A].apply(this,arguments))}}function S(A,M,j){return w(A)||x.apply(this,arguments)}function R(A,M,j){var k,U=this;M=M==null?"WARN":M;var X="loglevel";function K(){var N;if(typeof window!="undefined"&&X){try{N=window.localStorage[X]}catch{}if(N===void 0)try{var $=window.document.cookie,Q=$.indexOf(encodeURIComponent(X)+"=");Q!==-1&&(N=/^([^;]+)/.exec($.slice(Q))[1])}catch{}return U.levels[N]===void 0&&(N=void 0),N}}typeof A=="string"?X+=":"+A:typeof A=="symbol"&&(X=void 0),U.name=A,U.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},U.methodFactory=j||S,U.getLevel=function(){return k},U.setLevel=function(N,$){if(typeof N=="string"&&U.levels[N.toUpperCase()]!==void 0&&(N=U.levels[N.toUpperCase()]),!(typeof N=="number"&&N>=0&&N<=U.levels.SILENT))throw"log.setLevel() called with invalid level: "+N;if(k=N,$!==!1&&function(Q){var ot=(_[Q]||"silent").toUpperCase();if(typeof window!="undefined"&&X){try{return void(window.localStorage[X]=ot)}catch{}try{window.document.cookie=encodeURIComponent(X)+"="+ot+";"}catch{}}}(N),C.call(U,N,A),typeof console=="undefined"&&N<U.levels.SILENT)return"No console available for logging"},U.setDefaultLevel=function(N){M=N,K()||U.setLevel(N,!1)},U.resetLevel=function(){U.setLevel(M,!1),function(){if(typeof window!="undefined"&&X){try{return void window.localStorage.removeItem(X)}catch{}try{window.document.cookie=encodeURIComponent(X)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}()},U.enableAll=function(N){U.setLevel(U.levels.TRACE,N)},U.disableAll=function(N){U.setLevel(U.levels.SILENT,N)};var Y=K();Y==null&&(Y=M),U.setLevel(Y,!1)}var I=new R,b={};I.getLogger=function(A){if(typeof A!="symbol"&&typeof A!="string"||A==="")throw new TypeError("You must supply a name when creating a logger.");var M=b[A];return M||(M=b[A]=new R(A,I.getLevel(),I.methodFactory)),M};var F=typeof window!="undefined"?window.log:void 0;return I.noConflict=function(){return typeof window!="undefined"&&window.log===I&&(window.log=F),I},I.getLoggers=function(){return b},I.default=I,I})=="function"?l.call(o,s,o,n):l)===void 0||(n.exports=u)})()},function(n,o){n.exports=t},function(n,o,s){(function(l,u){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var h;h=function(){function p(P){return typeof P=="function"}var d=Array.isArray?Array.isArray:function(P){return Object.prototype.toString.call(P)==="[object Array]"},g=0,_=void 0,y=void 0,E=function(P,G){b[g]=P,b[g+1]=G,(g+=2)===2&&(y?y(F):U())},w=typeof window!="undefined"?window:void 0,C=w||{},x=C.MutationObserver||C.WebKitMutationObserver,S=typeof self=="undefined"&&l!==void 0&&{}.toString.call(l)==="[object process]",R=typeof Uint8ClampedArray!="undefined"&&typeof importScripts!="undefined"&&typeof MessageChannel!="undefined";function I(){var P=setTimeout;return function(){return P(F,1)}}var b=new Array(1e3);function F(){for(var P=0;P<g;P+=2)(0,b[P])(b[P+1]),b[P]=void 0,b[P+1]=void 0;g=0}var A,M,j,k,U=void 0;function X(P,G){var V=this,W=new this.constructor(N);W[Y]===void 0&&Tt(W);var H=V._state;if(H){var it=arguments[H-1];E(function(){return Z(H,W,it,V._result)})}else D(V,W,P,G);return W}function K(P){if(P&&typeof P=="object"&&P.constructor===this)return P;var G=new this(N);return Q(G,P),G}S?U=function(){return l.nextTick(F)}:x?(M=0,j=new x(F),k=document.createTextNode(""),j.observe(k,{characterData:!0}),U=function(){k.data=M=++M%2}):R?((A=new MessageChannel).port1.onmessage=F,U=function(){return A.port2.postMessage(0)}):U=w===void 0?function(){try{var P=Function("return this")().require("vertx");return(_=P.runOnLoop||P.runOnContext)!==void 0?function(){_(F)}:I()}catch{return I()}}():I();var Y=Math.random().toString(36).substring(2);function N(){}function $(P,G,V){G.constructor===P.constructor&&V===X&&G.constructor.resolve===K?function(W,H){H._state===1?rt(W,H._result):H._state===2?at(W,H._result):D(H,void 0,function(it){return Q(W,it)},function(it){return at(W,it)})}(P,G):V===void 0?rt(P,G):p(V)?function(W,H,it){E(function(yt){var Rt=!1,St=function(At,ie,oe,Ae){try{At.call(ie,oe,Ae)}catch(re){return re}}(it,H,function(At){Rt||(Rt=!0,H!==At?Q(yt,At):rt(yt,At))},function(At){Rt||(Rt=!0,at(yt,At))},yt._label);!Rt&&St&&(Rt=!0,at(yt,St))},W)}(P,G,V):rt(P,G)}function Q(P,G){if(P===G)at(P,new TypeError("You cannot resolve a promise with itself"));else if(H=typeof(W=G),W===null||H!=="object"&&H!=="function")rt(P,G);else{var V=void 0;try{V=G.then}catch(it){return void at(P,it)}$(P,G,V)}var W,H}function ot(P){P._onerror&&P._onerror(P._result),pt(P)}function rt(P,G){P._state===void 0&&(P._result=G,P._state=1,P._subscribers.length!==0&&E(pt,P))}function at(P,G){P._state===void 0&&(P._state=2,P._result=G,E(ot,P))}function D(P,G,V,W){var H=P._subscribers,it=H.length;P._onerror=null,H[it]=G,H[it+1]=V,H[it+2]=W,it===0&&P._state&&E(pt,P)}function pt(P){var G=P._subscribers,V=P._state;if(G.length!==0){for(var W=void 0,H=void 0,it=P._result,yt=0;yt<G.length;yt+=3)W=G[yt],H=G[yt+V],W?Z(V,W,H,it):H(it);P._subscribers.length=0}}function Z(P,G,V,W){var H=p(V),it=void 0,yt=void 0,Rt=!0;if(H){try{it=V(W)}catch(St){Rt=!1,yt=St}if(G===it)return void at(G,new TypeError("A promises callback cannot return that same promise."))}else it=W;G._state!==void 0||(H&&Rt?Q(G,it):Rt===!1?at(G,yt):P===1?rt(G,it):P===2&&at(G,it))}var vt=0;function Tt(P){P[Y]=vt++,P._state=void 0,P._result=void 0,P._subscribers=[]}var Lt=function(){function P(G,V){this._instanceConstructor=G,this.promise=new G(N),this.promise[Y]||Tt(this.promise),d(V)?(this.length=V.length,this._remaining=V.length,this._result=new Array(this.length),this.length===0?rt(this.promise,this._result):(this.length=this.length||0,this._enumerate(V),this._remaining===0&&rt(this.promise,this._result))):at(this.promise,new Error("Array Methods must be provided an Array"))}return P.prototype._enumerate=function(G){for(var V=0;this._state===void 0&&V<G.length;V++)this._eachEntry(G[V],V)},P.prototype._eachEntry=function(G,V){var W=this._instanceConstructor,H=W.resolve;if(H===K){var it=void 0,yt=void 0,Rt=!1;try{it=G.then}catch(At){Rt=!0,yt=At}if(it===X&&G._state!==void 0)this._settledAt(G._state,V,G._result);else if(typeof it!="function")this._remaining--,this._result[V]=G;else if(W===ut){var St=new W(N);Rt?at(St,yt):$(St,G,it),this._willSettleAt(St,V)}else this._willSettleAt(new W(function(At){return At(G)}),V)}else this._willSettleAt(H(G),V)},P.prototype._settledAt=function(G,V,W){var H=this.promise;H._state===void 0&&(this._remaining--,G===2?at(H,W):this._result[V]=W),this._remaining===0&&rt(H,this._result)},P.prototype._willSettleAt=function(G,V){var W=this;D(G,void 0,function(H){return W._settledAt(1,V,H)},function(H){return W._settledAt(2,V,H)})},P}(),ut=function(){function P(G){this[Y]=vt++,this._result=this._state=void 0,this._subscribers=[],N!==G&&(typeof G!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof P?function(V,W){try{W(function(H){Q(V,H)},function(H){at(V,H)})}catch(H){at(V,H)}}(this,G):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return P.prototype.catch=function(G){return this.then(null,G)},P.prototype.finally=function(G){var V=this.constructor;return p(G)?this.then(function(W){return V.resolve(G()).then(function(){return W})},function(W){return V.resolve(G()).then(function(){throw W})}):this.then(G,G)},P}();return ut.prototype.then=X,ut.all=function(P){return new Lt(this,P).promise},ut.race=function(P){var G=this;return d(P)?new G(function(V,W){for(var H=P.length,it=0;it<H;it++)G.resolve(P[it]).then(V,W)}):new G(function(V,W){return W(new TypeError("You must pass an array to race."))})},ut.resolve=K,ut.reject=function(P){var G=new this(N);return at(G,P),G},ut._setScheduler=function(P){y=P},ut._setAsap=function(P){E=P},ut._asap=E,ut.polyfill=function(){var P=void 0;if(u!==void 0)P=u;else if(typeof self!="undefined")P=self;else try{P=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var G=P.Promise;if(G){var V=null;try{V=Object.prototype.toString.call(G.resolve())}catch{}if(V==="[object Promise]"&&!G.cast)return}P.Promise=ut},ut.Promise=ut,ut},n.exports=h()}).call(this,s(5),s(6))},function(n,o,s){n.exports=s(8)},function(n,o){var s,l,u=n.exports={};function h(){throw new Error("setTimeout has not been defined")}function p(){throw new Error("clearTimeout has not been defined")}function d(R){if(s===setTimeout)return setTimeout(R,0);if((s===h||!s)&&setTimeout)return s=setTimeout,setTimeout(R,0);try{return s(R,0)}catch{try{return s.call(null,R,0)}catch{return s.call(this,R,0)}}}(function(){try{s=typeof setTimeout=="function"?setTimeout:h}catch{s=h}try{l=typeof clearTimeout=="function"?clearTimeout:p}catch{l=p}})();var g,_=[],y=!1,E=-1;function w(){y&&g&&(y=!1,g.length?_=g.concat(_):E=-1,_.length&&C())}function C(){if(!y){var R=d(w);y=!0;for(var I=_.length;I;){for(g=_,_=[];++E<I;)g&&g[E].run();E=-1,I=_.length}g=null,y=!1,function(b){if(l===clearTimeout)return clearTimeout(b);if((l===p||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(b);try{l(b)}catch{try{return l.call(null,b)}catch{return l.call(this,b)}}}(R)}}function x(R,I){this.fun=R,this.array=I}function S(){}u.nextTick=function(R){var I=new Array(arguments.length-1);if(arguments.length>1)for(var b=1;b<arguments.length;b++)I[b-1]=arguments[b];_.push(new x(R,I)),_.length!==1||y||d(C)},x.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=S,u.addListener=S,u.once=S,u.off=S,u.removeListener=S,u.removeAllListeners=S,u.emit=S,u.prependListener=S,u.prependOnceListener=S,u.listeners=function(R){return[]},u.binding=function(R){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(R){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},function(n,o){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch{typeof window=="object"&&(s=window)}n.exports=s},function(n,o){n.exports=e},function(n,o,s){s.r(o),s.d(o,"servicesVersion",function(){return ga}),s.d(o,"servicesDate",function(){return va});var l=s(1),u={getLogger:function(a){"true".match(/true/)?l.disableAll():l.enableAll();var c=a||"default";return l.getLogger(c)}},h={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(a,c){if(Object.keys(arguments).length===0)return"Message indefined !";var f=Array.prototype.slice.call(arguments),v=f.shift(),m=f,T=this[v];try{T=Array.isArray(m)&&m.length>0?T.replace("%var%",m.join(" - ")):T.replace("%var%","%var% (not specified)")}catch{}return T}};function p(a){if(!(this instanceof p))throw new TypeError("ErrorService constructor cannot be called as a function.");var c=a;typeof a=="string"||a instanceof String?(this.message=a,this.status=-1,this.type=p.TYPE_UNKERR):(this.message=c.message||"undefined!?",this.type=c.type,this.status=c.status||-1),this.name="ErrorService",this.stack=new Error().stack}p.TYPE_SRVERR="SERVICE_ERROR",p.TYPE_USEERR="USAGE_ERROR",p.TYPE_UNKERR="UNKNOWN_ERROR",p.prototype=Object.create(Error.prototype,{constructor:{value:p,writable:!0,configurable:!0}});var d=p,g={normalyzeParameters:function(a){var c=null;if(a){var f=[];for(var v in a)if(a.hasOwnProperty(v)){var m=a[v];m||(m=""),f.push(v+"="+m)}c=f.join("&")}return c},normalyzeUrl:function(a,c,f){var v=a;if(a){var m=a.indexOf("?");m===-1&&(v+="?"),m!==-1&&m!==a.length-1&&(v+="&")}return c&&(v+=typeof c=="string"?c:this.normalyzeParameters(c)),f&&(v=encodeURIComponent(v)),v},indent:function(a,c){return new Array((a||0)+1).join("	")+c}},_=s(3),y=s.n(_);function E(a){return(E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}var w,C={call:function(a){var c=u.getLogger("XHR");if(c.trace("[XHR::call()]"),y.a.polyfill(),!a.url)throw new Error("missing parameter : url is not defined !");if(!a.method)throw new Error("missing parameter : method is not defined !");a.format||(a.format="text");var f={};switch(f.url=a.url,f.data=a.data?a.data:null,f.method=a.method,f.timeOut=a.timeOut||0,f.scope=a.scope||this,f.proxy=a.proxy||null,f.content=a.content||null,f.headers=a.headers||{referer:"http://localhost"},a.method){case"DELETE":case"GET":break;case"PUT":case"POST":f.content=a.content?a.content:"application/x-www-form-urlencoded",f.headers=a.headers?a.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(a.format){case"text":this.__call(f).then(function(v){c.trace(v),a.onResponse.call(this,v)}).catch(function(v){a.onFailure.call(this,v)});break;case"json":this.__callJSON(f).then(function(v){c.trace(v),a.onResponse.call(this,v)}).catch(function(v){a.onFailure.call(this,v)});break;case"xml":this.__callXML(f).then(function(v){c.trace(v),a.onResponse.call(this,v)}).catch(function(v){a.onFailure.call(this,v)});break;default:throw new Error("This output Format is not yet supported !")}},__call:function(a){var c=u.getLogger("XHR");return c.trace("[XHR::__call()]"),new Promise(function(f,v){var m=a.method==="POST"||a.method==="PUT"?1:0;a.data&&(E(a.data)==="object"&&Object.keys(a.data).length||typeof a.data=="string"&&a.data.length)&&!m&&(a.url=g.normalyzeUrl(a.url,a.data)),c.trace("URL = ",a.url);var T=null;if(typeof window=="undefined"){var O=s(7),L={headers:{Referer:"https://localhost"}};return a.data&&typeof a.data=="string"&&m&&(L={method:a.method,body:a.data,headers:{"Content-Type":a.content,Referer:"https://localhost"}}),O(a.url,L).then(function(nt){if(nt.ok)f(nt.text());else{var qt="Errors Occured on Http Request (status : '"+nt.statusText+"' | url : '"+nt.url+"')",Ke=nt.status;v({message:qt,status:Ke})}}).catch(function(nt){v({message:nt,status:-1})})}if(window.XMLHttpRequest){c.trace("XMLHttpRequest"),(T=new XMLHttpRequest).open(a.method,a.url,!0),T.overrideMimeType=a.content;var z=null;a.timeOut>0&&(c.trace("XHR - TimeOut actif !"),z=window.setTimeout(function(){v({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})},a.timeOut)),m&&(c.trace("data = ",a.data),T.setRequestHeader("Content-type",a.content)),T.onerror=function(nt){console.log(nt),v(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},T.ontimeout=function(nt){console.log(nt),v(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},T.onreadystatechange=function(nt){if(T.readyState===4)if(T.status===200)window.clearTimeout(z),f(T.response);else{var qt="Errors Occured on Http Request (status : '"+nt.target.statusText+"' | url : '"+nt.target.responseURL+"')",Ke=nt.target.status;v({message:qt,status:Ke})}};var B=a.data&&m?a.data:null;T.send(B)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");c.trace("XDomainRequest"),(T=new XDomainRequest).open(a.method,a.url),T.overrideMimeType=a.content,a.timeOut>0&&(T.timeout=a.timeout,c.trace("XHR - TimeOut actif !")),m&&T.setRequestHeader("Content-type",a.content),T.onerror=function(){v(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},T.ontimeout=function(){v(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},T.onload=function(nt){if(T.status===200)f(T.responseText);else{var qt="Errors Occured on Http Request (status : '"+nt.target.statusText+"' | url : '"+nt.target.responseURL+"')",Ke=nt.target.status;v({message:qt,status:Ke})}};var dt=a.data&&m?a.data:null;T.send(dt)}})},__callJSON:function(a){return this.__call(a).then(JSON.parse).catch(function(c){console.log("_callJSON failed on : ",a.url,c)})},__callXML:function(a){return this.__call(a).then(function(c){var f;return typeof window=="undefined"?f=new(s(2)).DOMParser().parseFromString(c,"text/xml"):window.DOMParser?f=new window.DOMParser().parseFromString(c,"text/xml"):((f=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,f.loadXML(c)),f}).catch(function(c){console.log("__callXML failed on : ",a.url,c)})}},x={uuid:(w=Math.floor(Date.now()),function(){return w++}),call:function(a){var c=u.getLogger("JSONP");if(c.trace("[JSONP::call ()]"),!a)throw c.error("missing parameter : options !"),new Error("missing parameter : options !");if(!a.url)throw c.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(a.timeOut||(c.info("setting 'options.timeOut' default value"),a.timeOut=0),!a.onResponse)throw c.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var f=typeof a.callbackSuffix=="string"?a.callbackSuffix:this.uuid(),v=!1,m=!1,T=a.url.indexOf("callback=");if(T!==-1){v=!0;var O=a.url.indexOf("&",T);O===-1&&(O=a.url.length);var L=a.url.substring(T+9,O);L&&(m=!0,a.callbackName=L,c.info("setting 'options.callbackName' value ("+a.callbackName+") from 'options.url' parameter"))}if(!v){var z=a.url.indexOf("?");z===-1?a.url=a.url+"?callback=":z===a.url.length?a.url=a.url+"callback=":a.url=a.url+"&callback=",c.info("setting callback default key in 'options.url' : "+a.url)}var B=!!a.callbackName||m;if(m||(a.callbackName||(c.info("setting 'options.callbackName' default value"),a.callbackName="callback",(f||f==="")&&(a.callbackName+=f)),a.url=a.url.replace("callback=","callback="+a.callbackName),c.info("setting callback function name in 'options.url' : "+a.url)),a.onTimeOut||(c.info("setting 'options.onTimeOut' default value"),a.onTimeOut=function(){console.log("TimeOut while invoking url : "+a.url)}),!B){var dt=this,nt=null;a.timeOut>0&&(nt=window.setTimeout(function(){window[a.callbackName]=function(){},a.onTimeOut(),dt._deleteScript(f)},a.timeOut)),window[a.callbackName]=function(qt){window.clearTimeout(nt),a.onResponse(qt),dt._deleteScript(f)}}this._createScript(f,a.url)},_createScript:function(a,c){var f,v=document.getElementById("results"+a);(f=document.createElement("script")).setAttribute("type","text/javascript"),f.setAttribute("src",c),f.setAttribute("charset","UTF-8"),f.setAttribute("id","results"+a),f.setAttribute("async","true");var m=document.documentElement||document.getElementsByTagName("head")[0];v===null?m.appendChild(f):m.replaceChild(f,v)},_deleteScript:function(a){var c=document.getElementById("results"+a);if(c){var f=c.parentNode||document.documentElement;if(!f)return;f.removeChild(c)}}},S={send:function(a){var c=a||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if(typeof window!="undefined"||a.protocol!=="JSONP"){if(a.protocol==="XHR"||a.format==="json"?c.wrap=!1:a.protocol==="JSONP"&&a.format==="xml"&&(c.wrap=!0),c.callback=null,c.output=c.wrap?"json":null,c.wrap){var f={};f.output=c.output,f.callback=c.callback,delete f.callback,c.url=g.normalyzeUrl(a.url,f)}switch(c.protocol){case"XHR":a.method==="GET"&&a.nocache&&(c.url=g.normalyzeUrl(c.url,{t:new Date().getTime()})),C.call(c);break;case"JSONP":c.data&&(c.url=g.normalyzeUrl(c.url,c.data)),x.call(c);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}else console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS")}},R={ssl:!0,url:function(a,c){return(R.ssl===!1?"http://":"https://")+"wxs.ign.fr".concat("/",a,c)},Alti:{_key:{"elevation-json":"/alti/rest/elevation.json","elevation-xml":"/alti/rest/elevation.xml","profil-json":"/alti/rest/elevationLine.json","profil-xml":"/alti/rest/elevationLine.xml",wps:"/alti/wps"},url:function(a){return{"elevation-json":R.url(a,this._key["elevation-json"]),"elevation-xml":R.url(a,this._key["elevation-xml"]),"profil-json":R.url(a,this._key["profil-json"]),"profil-xml":R.url(a,this._key["profil-xml"]),wps:R.url(a,this._key.wps)}}},ProcessIsoCurve:{_key:"/geoportail/isochrone/rest/1.0.0/isochrone",url:function(a){return R.url(a,this._key)}},AutoComplete:{_key:"/ols/apis/completion",url:function(a){return R.url(a,this._key)}},ReverseGeocode:{_key:"/geoportail/ols",url:function(a){return R.url(a,this._key)}},AutoConf:{_key:{apiKey:"/autoconf",apiKeys:"/autoconf?keys=%KEYS%",aggregate:"/autoconf/id/"},url:function(a){var c="";if(Array.isArray(a)&&a.length>0){c=a[0];for(var f=1;f<a.length;f++)c+=","+a[f]}return{apiKey:R.url(a,this._key.apiKey),apiKeys:R.url(a[0],this._key.apiKeys).replace("%KEYS%",c),aggregate:R.url(a,this._key.aggregate)}}},Geocode:{_key:"/geoportail/ols",url:function(a){return R.url(a,this._key)}},Route:{_key:"/geoportail/itineraire/rest/1.0.0/route",url:function(a){return R.url(a,this._key)}}},I=R,b=s(0);function F(a){if(!(this instanceof F))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR"));for(var c in this.logger=u.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(v){console.log("onSuccess - la reponse est la suivante : ",v)},onFailure:function(v){v.status!==200&&v.status?console.log("onFailure - Erreur (",v.status,") : ",v.message):console.log("onFailure : ",v.message)}},a)a.hasOwnProperty(c)&&(this.options[c]=a[c]);if(!this.options.apiKey&&!this.options.serverUrl)throw new Error(h.getMessage("PARAM_MISSING","apiKey","serverUrl"));if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(v){console.log("onSuccess - la r\xE9ponse brute du service est la suivante : ",v)}),this.options.onSuccess===null||typeof this.options.onSuccess!="function")throw new Error(h.getMessage("PARAM_MISSING","onSuccess()"));if(!this.options.serverUrl){I.ssl=this.options.ssl;var f=I[this.CLASSNAME].url(this.options.apiKey);typeof f=="string"?this.options.serverUrl=f:this.logger.trace("URL par defaut \xE0 determiner au niveau du composant...")}switch(this.options.httpMethod=typeof a.httpMethod=="string"?a.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(h.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(h.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol=typeof a.protocol=="string"?a.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(h.getMessage("PARAM_UNKNOWN","protocol"))}if(typeof window=="undefined"&&this.options.protocol==="JSONP")throw new Error(h.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));this.options.protocol==="JSONP"&&(this.options.httpMethod="GET"),this.options.nocache=a.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}F.prototype={constructor:F,call:function(){this.logger.trace("CommonService::call ()");var a=this;function c(T){this.logger.trace("CommonService::onBuildRequest : ",T),this.callService.call(a,m,f)}function f(T){this.logger.trace("CommonService::onCallService : ",T),this.analyzeResponse.call(a,m,v)}function v(T){if(this.logger.trace("CommonService::onAnalyzeResponse : ",T),!T)return m.call(this,new d("Analyse de la reponse en \xE9chec !?"));this.options.onSuccess.call(this,T)}function m(T){this.logger.trace("CommonService::onError()");var O=T;O instanceof d||(O=new d(T.message)),this.options.onFailure.call(this,O)}(function(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(a,m,c)}).call(a)},buildRequest:function(a,c){this.logger.error("overwritten method !"),a&&a.call(this,"This method must be overwritten !"),c.call(this,"This method must be overwritten !")},callService:function(a,c){var f=null,v=this.request,m=!(!this.options.proxyURL||this.options.protocol!=="XHR");this.options.serverUrl=g.normalyzeUrl(this.options.serverUrl,{"gp-access-lib":b.version},!1),m&&(this.options.httpMethod==="GET"&&(f=this.options.proxyURL+g.normalyzeUrl(this.options.serverUrl,this.request,!0),v=null),this.options.httpMethod==="POST"&&(f=this.options.proxyURL+g.normalyzeUrl(this.options.serverUrl,null,!0),v=this.request));var T=this,O={url:f||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:this.options.protocol!=="XHR",callbackSuffix:this.options.callbackSuffix,data:v,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(L){T.logger.trace("callService::onResponse()");var z=null;if(T.options.protocol==="XHR"&&(T.logger.trace("Response XHR",L),z=L),T.options.protocol==="JSONP"){if(T.logger.trace("Response JSON",L),!L)return void a.call(T,new d("Le contenu de la reponse est vide !?"));if(L.http){if(L.http.status!==200)return void a.call(T,new d({status:L.http.status,message:L.http.error,type:d.TYPE_SRVERR}));z=L.xml,T.options.rawResponse&&(z=L)}else z=L}if(typeof T.options.onBeforeParse=="function"){var B=T.options.onBeforeParse(z);typeof B=="string"&&(z=B)}T.response=z,c.call(T,z)},onFailure:function(L){T.logger.trace("callService::onFailure()"),L.type=d.TYPE_SRVERR,a.call(T,new d(L))},onTimeOut:function(){T.logger.trace("callService::onTimeOut()"),a.call(T,new d("TimeOut!"))}};S.send(O)},analyzeResponse:function(a,c){this.logger.error("overwritten method !"),a&&a.call(this,"This method must be overwritten !"),c.call(this,"This method must be overwritten !")}};var A=F;function M(a){if(!(this instanceof M))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=u.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=a||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json"}M.CLASSNAME="AltiRequest",M.prototype={constructor:M,setPositions:function(a){for(var c=[],f=0;f<a.length;f++){var v=a[f];v.lon&&v.lat&&c.push(v)}this.positions=c},getPositions:function(a){if(!a)return this.positions;var c=this.positions.length-1;return a>c||a<c?(this.logger.warn("index out of range !"),this.positions):this.positions[a]},addPositions:function(a){for(var c=0;c<a.length;c++){var f=a[c];f.lon&&f.lat&&this.positions.push(a[c])}},getLon:function(){for(var a=[],c=0;c<this.positions.length;c++)a.push(this.positions[c].lon);return this.logger.trace(a),a.join(this.delimiter)},getLat:function(){for(var a=[],c=0;c<this.positions.length;c++)a.push(this.positions[c].lat);return this.logger.trace(a),a.join(this.delimiter)}},M.prototype.getData=function(){var a=[];return a.push({k:"lon",v:this.getLon()}),a.push({k:"lat",v:this.getLat()}),a.push({k:"delimiter",v:this.delimiter}),a.push({k:"indent",v:this.indent}),a.push({k:"crs",v:this.crs}),a.push({k:"format",v:this.format}),a};var j=M;function k(a){if(!(this instanceof k))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",j.apply(this,arguments),this.logger=u.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}k.prototype=Object.create(j.prototype,{zonly:{get:function(){return this._zonly},set:function(a){this._zonly=a}}}),k.prototype.constructor=k,k.prototype.getData=function(){var a=[];return a.push({k:"lon",v:this.getLon()}),a.push({k:"lat",v:this.getLat()}),a.push({k:"indent",v:this.indent}),a.push({k:"crs",v:this.crs}),a.push({k:"zonly",v:this.zonly}),a.push({k:"format",v:this.format}),a};var U=k;function X(a){if(!(this instanceof X))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",j.apply(this,arguments),this.logger=u.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}X.prototype=Object.create(j.prototype,{sampling:{get:function(){return this._sampling},set:function(a){this._sampling=a}}}),X.prototype.constructor=X,X.prototype.getData=function(){var a=[];return a.push({k:"lon",v:this.getLon()}),a.push({k:"lat",v:this.getLat()}),a.push({k:"indent",v:this.indent}),a.push({k:"crs",v:this.crs}),a.push({k:"sampling",v:this.sampling}),a.push({k:"format",v:this.format}),a};var K=X;function Y(a){if(this.logger=u.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof Y))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=a||{},!this.options)throw new Error(h.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(h.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new U(this.options.param);break;case"Profil":this.DataObject=new K(this.options.param);break;default:throw new Error(h.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}Y.prototype={requestString:null,constructor:Y,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:`lon=__LON__
lat=__LAT__
indent=__INDENT__
crs='__CRS__'
`,input:{point:"zonly=__ZONLY__",profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var a="";return this.method==="POST"?a=this.template.post.value:this.method==="GET"&&(a=this.template.get.value),a=(a=(a=(a=a.replace(/__LON__/g,this.DataObject.getLon())).replace(/__LAT__/g,this.DataObject.getLat())).replace(/__INDENT__/g,this.DataObject.indent)).replace(/__CRS__/g,this.DataObject.crs),a+=this.__addDataInputs(),this.logger.trace("traduction tmpl",a),this.requestString=a,this.requestString},__addDataInputs:function(){var a;if(this.logger.trace("AltiRequestREST::addDataInput ()"),this.method==="POST")a=this.template.post;else{if(this.method!=="GET")throw new Error("No other HTTP method supported by the service !");a=this.template.get}if(this.DataObject.CLASSNAME==="AltiElevationRequest")return a.input.point.replace(/__ZONLY__/g,this.DataObject.zonly);if(this.DataObject.CLASSNAME==="AltiProfilRequest")return a.input.profil.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}};var N=Y;function $(a){if(this.logger=u.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof $))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=a||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}$.prototype={requestString:null,constructor:$,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=<!-- __DATAINPUTS__ -->",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs><!-- __DATAINPUTS__ --></wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var a="";if(this.method==="POST")a=this.template.post.value;else{if(this.method!=="GET")return this.logger.error("No other method supported by the service !"),!1;a=this.template.get.value}return a=(a=(a=(a=(a=a.replace(/__SERVICE__/g,this.paramservice)).replace(/__VERSION__/g,this.paramversion)).replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput)).replace(/__IDENTIFIER__/g,this.paramidentifier)).replace(/__REQUEST__/g,this.paramrequest),this.method==="POST"&&(a=(a=a.replace(/__NAMESPACE__/g,this.namespaceByDefault)).replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),(a=a.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()))?(this.requestString=a,this.logger.trace("traduction tmpl",a),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var a,c=this.method==="GET"?this.template.get.input:this.template.post.input,f=this.method==="GET"?";":"",v="",m=this,T=this.DataObject.getData(),O=0;O<T.length;O++)a=O,f&&(f=a===T.length-1?"":";"),v=v.concat(m.__addDataInput(c,T[a].k,T[a].v),f);return v},__addDataInput:function(a,c,f){var v=a;return v=(v=v.replace(/__KEY__/g,c)).replace(/__DATA__/g,f)},setMethod:function(a){a==="GET"||a==="POST"?this.method=a:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}};var Q=$,ot={build:function(a){if(u.getLogger("AltiRequestWPS").trace(["AltiRequestWPS::build()"]),!a)throw new Error(h.getMessage("PARAM_EMPTY","options"));if(!a.type)throw new Error(h.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var c=null;switch(a.type){case"Elevation":a.wps.identifier="gs:WPSElevation",c=new U(a.param);break;case"Profil":a.wps.identifier="gs:WPSLineElevation",c=new K(a.param);break;default:throw new Error(h.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var f={data:c,method:a.method,param:a.wps},v=new Q(f);if(!v.processRequestString())throw new Error("Enable to process request !");return v.requestString}},rt={build:function(a){u.getLogger("AltiRequestFactory").trace(["AltiRequestFactory::build()"]);var c=null,f={type:a.sampling?"Profil":"Elevation",method:a.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null}};f.param.positions=a.positions,f.param.format=a.outputFormat,f.param.sampling=a.sampling,f.param.zonly=a.zonly;var v=!(a.onError===null||typeof a.onError!="function"),m=!(a.onSuccess===null||typeof a.onSuccess!="function"),T=null;switch(a.api){case"REST":var O=new N(f);if(!O.processRequestString()){if(T="Error in process request (rest) !",v)return void a.onError.call(a.scope,new d(T));throw new Error(T)}c=O.requestString;break;case"WPS":if(f.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},!(c=ot.build(f))){if(T="Error in process request (wps) !",v)return void a.onError.call(a.scope,new d(T));throw new Error(T)}break;default:if(T="Type of API is not supported by service (REST or WPS) !",v)return void a.onError.call(a.scope,new d(T));throw new Error(T)}return m&&a.onSuccess.call(a.scope,c),c}};function at(a){if(!(this instanceof at))throw new TypeError("XML constructor cannot be called as a function.");this.logger=u.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,a&&(a.xmlString&&typeof a.xmlString=="string"&&(this.xmlString=a.xmlString,this.xmlDoc=D(a.xmlString)),a.reader&&this.setReader(a.reader))}function D(a){if(typeof window=="undefined")return new(s(2)).DOMParser().parseFromString(a,"text/xml");var c,f,v="Erreur lors du parsing de la r\xE9ponse du service : XML non conforme";if(window.ActiveXObject){(f=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,f.loadXML(a);var m=f.parseError;if(m.errorCode)throw m.line&&m.linepos&&(v+="( ligne "+m.line+", colonne "+m.linepos),m.reason&&(v+=":  "+m.reason+")"),new Error(v);return f}if(window.DOMParser){c=new window.DOMParser;try{f=c.parseFromString(a,"text/xml")}catch(z){throw z.message==="SyntaxError"?new Error(v):new Error("Erreur lors du parsing de la r\xE9ponse du service : "+z.message)}if(f.getElementsByTagName("parsererror").length>0)for(var T=f.getElementsByTagName("parsererror"),O=0;O<T.length;O++){var L=T[O].innerHTML;if(L.indexOf("Huge input lookup")===-1)throw v+="("+L+")",new Error(v)}else if(!f.documentElement)throw new Error(v);return f}throw new Error("Incompatible DOM Parser pour ce navigateur !")}at.prototype={constructor:at,getXMLString:function(){return this.xmlString},setXMLString:function(a){a&&typeof a=="string"&&(this.xmlString=a,this.xmlDoc=D(a))},getReader:function(){return this.reader},setReader:function(a){a&&a.read&&typeof a.read=="function"&&(this.reader=a)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(a){this.xmlDoc=a},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=D(this.xmlString)),this.xmlDoc){var a,c=function(f){var v;return f.nodeType===9?v=f.documentElement:f.nodeType===1&&(v=f),v}(this.xmlDoc);return c?(this.reader&&this.reader.read?a=this.reader.read(c):(a={})[c.nodeName]=function f(v){var m={};if(v.attributes.length>0){var T=function(nt){if(nt.attributes.length>0){for(var qt={},Ke=nt.attributes,Mo=0;Mo<Ke.length;Mo++){var _a=Ke[Mo];qt[_a.nodeName]=_a.nodeValue}return qt}}(v);m.attributes=T}if(v.hasChildNodes()){for(var O,L={},z=v.childNodes,B=0;B<z.length;B++)if((O=z[B]).nodeType===3)m.textContent=O.nodeValue;else if(O.nodeType===1)if(L=f(O),m[O.nodeName]){if(!Array.isArray(m[O.nodeName])){var dt=m[O.nodeName];m[O.nodeName]=[],m[O.nodeName].push(dt)}m[O.nodeName].push(L)}else m[O.nodeName]=L}return m}(c),a):{}}}};var pt=at;function Z(){if(!(this instanceof Z))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}Z.prototype={constructor:Z};var vt=Z;function Tt(){if(!(this instanceof Tt))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}Tt.prototype={constructor:Tt};var Lt=Tt,ut={};ut.READERS={elevations:function(a){var c=new vt;if(a.hasChildNodes())for(var f,v,m=a.childNodes,T=0;T<m.length;T++)f=m[T],ut.READERS[f.nodeName]&&(v=ut.READERS[f.nodeName](f),c.elevations.push(v));return c},elevation:function(a){var c=new Lt;if(a.hasChildNodes())for(var f,v=a.childNodes,m=0;m<v.length;m++)f=v[m],ut.READERS[f.nodeName]&&ut.READERS[f.nodeName](f,c);return c},lat:function(a,c){var f=a.firstChild;if(!f||f.nodeType!==3)throw new Error("Erreur dans la lecture de la r\xE9ponse du service : latitude attendue mais absente");c.lat=parseFloat(f.nodeValue)},lon:function(a,c){var f=a.firstChild;if(!f||f.nodeType!==3)throw new Error("Erreur dans la lecture de la r\xE9ponse du service : longitude attendue mais absente");c.lon=parseFloat(f.nodeValue)},z:function(a,c){var f=a.firstChild;if(!f||f.nodeType!==3)throw new Error("Erreur dans la lecture de la r\xE9ponse du service : altitude attendue mais absente");if(!c)return(c=new Lt).z=parseFloat(f.nodeValue),c;c.z=parseFloat(f.nodeValue)},acc:function(a,c){var f=a.firstChild;if(!f||f.nodeType!==3)throw new Error("Erreur dans la lecture de la r\xE9ponse du service : pr\xE9cision (acc) attendue mais absente");c.acc=parseFloat(f.nodeValue)},exceptionreport:function(a){var c={};if(a.hasChildNodes())for(var f,v=a.childNodes,m=0;m<v.length;m++)(f=v[m]).nodeName==="Exception"&&(c.exceptionReport=ut.READERS.exception(f));return c},exception:function(a){var c={},f=a.getAttribute("exceptionCode");f&&(c.exceptionCode=f);var v=a.firstChild;return v&&v.nodeType===3&&(c.exception=v.nodeValue),c},error:function(a){var c={error:{}};if(a.hasChildNodes())for(var f,v=a.childNodes,m=0;m<v.length;m++){var T;(f=v[m]).nodeType===1&&f.nodeName==="code"&&(T=f.firstChild)&&T.nodeType===3&&(c.error.code=T.nodeValue),f.nodeType===1&&f.nodeName==="description"&&(T=f.firstChild)&&T.nodeType===3&&(c.error.description=T.nodeValue)}return c}},ut.read=function(a){if(a.nodeName==="elevations")return ut.READERS.elevations(a);if(a.nodeName==="ExceptionReport")return ut.READERS.exceptionreport(a);if(a.nodeName==="error")return ut.READERS.error(a);throw new Error("Erreur lors de la lecture de la r\xE9ponse : elle n'est pas au format attendu.")};var P=ut;function G(a){return(G=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}var V={build:function(a){var c=u.getLogger("AltiResponseFactory");c.trace(["AltiResponseFactory::build()"]);var f=null;if(a.response){if(a.rawResponse)c.trace("analyze response : raw"),f=a.response;else{switch(a.outputFormat){case"xml":c.trace("analyze response : xml");try{var v=new pt({reader:P});if(typeof a.response=="string"?v.setXMLString(a.response):v.setXMLDoc(a.response),!(f=v.parse()))throw new Error(h.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(nt){var m=nt.message;return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",m),status:200,type:d.TYPE_SRVERR}))}break;case"json":c.trace("analyze response : json"),c.trace("analyze response : ",G(a.response));var T=null;if((T=typeof a.response=="string"?JSON.parse(a.response):a.response)&&T.error)return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",T.error.description),status:200,type:d.TYPE_SRVERR}));if(T){var O,L=T.elevations,z=new vt;if(Array.isArray(L)&&L.length)for(var B=0;B<L.length;B++)O=new Lt,G(L[B])==="object"?(L[B].lon&&(O.lon=L[B].lon),L[B].lat&&(O.lat=L[B].lat),L[B].z&&(O.z=L[B].z),L[B].acc&&(O.acc=L[B].acc)):typeof L[B]=="number"&&(O.z=L[B]),Array.isArray(z.elevations)&&z.elevations.push(O);f=z}if(!f)return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:d.TYPE_UNKERR,status:-1}));break;default:return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:d.TYPE_UNKERR,status:-1}))}if(f.exceptionReport)return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",f.exceptionReport),type:d.TYPE_SRVERR,status:200}));if(f.error){var dt=f.error.description;return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",dt),type:d.TYPE_SRVERR,status:200}))}}a.onSuccess.call(a.scope,f)}else a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))}};function W(a){if(!(this instanceof W))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",A.apply(this,arguments),this.logger=u.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!a.positions)throw new Error(h.getMessage("PARAM_MISSING","positions"));if(a.positions.length===0)throw new Error(h.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=a.positions,this.options.outputFormat=typeof a.outputFormat=="string"?a.outputFormat.toLowerCase():"xml",this.options.sampling=a.sampling||null,this.options.api=typeof a.api=="string"?a.api.toUpperCase():"REST",this.options.api==="REST"&&(this.options.httpMethod="GET"),this.options.zonly=a.zonly||!1,!this.options.serverUrl){var c=I.Alti.url(this.options.apiKey),f=null;switch(this.options.api){case"WPS":f=c.wps;break;case"REST":var v=(a.sampling?"profil":"elevation")+"-"+this.options.outputFormat;f=c[v];break;default:throw new Error(h.getMessage("PARAM_UNKNOWN","api"))}if(!f)throw new Error("Url by default not found !");this.options.serverUrl=f,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var m=this.options.serverUrl.lastIndexOf(".");if(m!==-1){var T=this.options.serverUrl.substring(m+1);if(T&&T.length<5)switch(this.logger.trace("Server Extension URL : "+T),T.toLowerCase()){case"json":case"xml":this.options.outputFormat=T.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}W.prototype=Object.create(A.prototype,{}),W.prototype.constructor=W,W.prototype.buildRequest=function(a,c){var f={httpMethod:this.options.httpMethod,onSuccess:function(v){this.request=v,c.call(this,this.request)},onError:a,scope:this,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly};rt.build(f)},W.prototype.analyzeResponse=function(a,c){if(this.response){var f={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:a,onSuccess:c,scope:this};V.build(f)}else a.call(this,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var H=W;function it(){if(!(this instanceof it))throw new TypeError("AutoConfResponse constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.territories={},this.tileMatrixSets={},this.services={}}it.prototype={constructor:it,isConfLoaded:function(a){if(a)return!!this.generalOptions.apiKeys[a]},getLayersId:function(a){return this.generalOptions.apiKeys[a]},getLayersConf:function(a){var c={},f=this.getLayersId(a);if(f)for(var v=0;v<f.length;v++){var m=f[v];c[m]=this.layers[m]}return c},getLayerConf:function(a){if(this.layers)return this.layers[a]},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(a){if(this.tileMatrixSets)return this.tileMatrixSets[a]},getTerritories:function(){return this.territories},getTerritoryConf:function(a){if(this.territories)return this.territories[a]},getServices:function(){return this.services},getServiceConf:function(a){if(this.services)return this.services[a]}};var yt=it;function Rt(){if(!(this instanceof Rt))throw new TypeError("Constraint constructor cannot be called as a function.");this.crs=null,this.bbox={left:null,right:null,top:null,bottom:null},this.minScaleDenominator=null,this.maxScaleDenominator=null,this.temporalExtent=[null,null]}Rt.prototype={constructor:Rt};var St=Rt;function At(){if(!(this instanceof At))throw new TypeError("Format constructor cannot be called as a function.");this.current=null,this.name=null}At.prototype={constructor:At};var ie=At;function oe(){if(!(this instanceof oe))throw new TypeError("Layer constructor cannot be called as a function.")}oe.prototype={constructor:oe,getName:function(){return this.name},getTitle:function(){return this.title},getDescription:function(){return this.description},getLayerId:function(){return this.layerId},getQuicklookUrl:function(){return this.quicklookUrl},getDefaultProjection:function(){return this.defaultProjection},getProjections:function(){var a=[];return a.push(this.defaultProjection),a.concat(this.additionalProjections)},getBBOX:function(){if(this.globalConstraint)return this.globalConstraint.bbox},getMinScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.minScaleDenominator},getMaxScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.maxScaleDenominator},getTMSID:function(){if(this.wmtsOptions)return this.wmtsOptions.tileMatrixSetLink},getServiceParams:function(){return this.serviceParams},getServerUrl:function(a){if(a&&this.serviceParams&&this.serviceParams.serverUrl)return this.serviceParams.serverUrl[a]},getLegends:function(){return this.legends},getMetadata:function(){return this.metadata},getStyles:function(){return this.styles},getDefaultStyle:function(){if(this.styles){for(var a,c=this.styles,f=0;f<c.length;f++)if(c[f].current===!0){a=c[f].name;break}return a}},getThematics:function(){return this.thematics},getDefaultFormat:function(){if(this.formats){for(var a,c=this.formats,f=0;f<c.length;f++)if(c[f].current===!0){a=c[f].name;break}return a}},getConstraints:function(){return this.constraints},getOriginators:function(){return this.originators},getDimensions:function(){return this.dimensions},getAggregatedLayers:function(){if(this.isAggregate)return this.aggregatedLayers}};var Ae=oe;function re(){if(!(this instanceof re))throw new TypeError("Legend constructor cannot be called as a function.");this.format=null,this.url=null,this.minScaleDenominator=null}re.prototype={constructor:re};var de=re;function ge(){if(!(this instanceof ge))throw new TypeError("Metadata constructor cannot be called as a function.");this.format=null,this.url=null}ge.prototype={constructor:ge};var jr=ge;function Pe(){if(!(this instanceof Pe))throw new TypeError("Originator constructor cannot be called as a function.");this.name=null,this.attribution=null,this.logo=null,this.url=null,this.constraints=[]}Pe.prototype={constructor:Pe};var Be=Pe;function Ht(){if(!(this instanceof Ht))throw new TypeError("Service constructor cannot be called as a function.");this.title=null,this.serverUrl=null,this.version=null}Ht.prototype={constructor:Ht};var Zt=Ht;function se(){if(!(this instanceof se))throw new TypeError("Style constructor cannot be called as a function.");this.name=null,this.title=null,this.current=null,this.url=null}se.prototype={constructor:se};var We=se;function kt(){if(!(this instanceof kt))throw new TypeError("Territory constructor cannot be called as a function.");this.isDefault=null,this.defaultCRS=null,this.additionalCRS=[],this.geoBBOX={left:null,right:null,top:null,bottom:null},this.geoCenter={lon:null,lat:null},this.defaultOptions={resolution:null,minScaleDenominator:null,maxScaleDenominator:null},this.defaultLayers=[]}kt.prototype={constructor:kt};var hr=kt;function Ot(){if(!(this instanceof Ot))throw new TypeError("Thematic constructor cannot be called as a function.");this.inspire=null,this.name=null}Ot.prototype={constructor:Ot};var Ee=Ot;function ae(){if(!(this instanceof ae))throw new TypeError("TileMatrixSet constructor cannot be called as a function.");this.projection=null,this.nativeResolutions=[],this.matrixIds=[],this.tileMatrices={}}ae.prototype={constructor:ae,getResolutions:function(){return this.nativeResolutions},getMatrixIds:function(){return this.matrixIds},getProjection:function(){return this.projection},getTileMatrices:function(){return this.tileMatrices},getTopLeftCorner:function(){var a,c=this.getTileMatrices();if(c){for(var f in c)if(c.hasOwnProperty(f)){a=c[f].topLeftCorner;break}}return a}};var xn=ae;function fr(){if(!(this instanceof fr))throw new TypeError("TileMatrix constructor cannot be called as a function.");this.matrixId=null,this.matrixHeight=null,this.matrixWidth=null,this.scaleDenominator=null,this.tileHeight=null,this.tileWidth=null,this.topLeftCorner=null}fr.prototype={constructor:fr,getTopLeftCorner:function(){return this.topLeftCorner},getScaleDenominator:function(){return this.scaleDenominator},getTileHeight:function(){return this.tileHeight},getTileWidth:function(){return this.tileWidth},getMatrixHeight:function(){return this.matrixHeight},getMatrixWidth:function(){return this.matrixWidth}};var $r=fr;function Xr(){if(!(this instanceof Xr))throw new TypeError("TileMatrixLimit constructor cannot be called as a function.");this.minTileRow=null,this.maxTileRow=null,this.minTileCol=null,this.maxTileCol=null}Xr.prototype={constructor:Xr};var vi=Xr;function Yr(a){return(Yr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}var xt={};function Xt(a,c){if(a.hasChildNodes())for(var f,v,m,T=a.childNodes,O=0;O<T.length;O++)(f=T[O]).nodeType===1&&(v=f.localName||f.baseName||f.nodeName,m=f.prefix||xt.DEFAULTPREFIX,xt.READERS[m][v]?(0,xt.READERS[m][v])(f,c):Xt(f,c))}function st(a){var c,f="";return a.hasChildNodes()&&((c=a.firstChild).nodeType!==3&&c.nodeType!==4||(f=c.nodeValue)),f}xt.VERSION="1.1.0",xt.NAMESPACES={xmlns:"http://www.opengis.net/context",gpp:"http://api.ign.fr/geoportail",ows:"http://www.opengis.net/ows/2.0",sld:"http://www.opengis.net/sld",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},xt.SCHEMALOCATION=["http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf/autoconf.xsd","http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf.xsd"],xt.DEFAULTPREFIX="context",xt.READERS={context:{ViewContext:function(a){(function(f){if(f.attributes.length>0){var v=function(L){if(L.attributes.length>0){for(var z={},B=L.attributes,dt=0;dt<B.length;dt++){var nt=B[dt];z[nt.nodeName]=nt.nodeValue}return z}}(f);for(var m in v)if(v.hasOwnProperty(m)){if(m==="version"&&v.version!==xt.VERSION)return void console.log("[AutoConfResponseReader] autoconf version is not the expected one : there may be errors in parsing");if(m==="xmlns"){if(v[m]!==xt.NAMESPACES.xmlns)return void console.log("[AutoConfResponseReader] autoconf response default namespace is not the expected one");continue}var T=m.split(":")[0],O=m.split(":")[1];if(T==="xmlns"&&O&&xt.NAMESPACES[O]&&xt.NAMESPACES[O]!==v[m])return void console.log("[AutoConfResponseReader] autoconf response "+m+" namespace is not the expected one");if(O==="schemaLocation"&&v[m]!==xt.SCHEMALOCATION[0]&&v[m]!==xt.SCHEMALOCATION[1])return void console.log("[AutoConfResponseReader] autoconf response schema location is not the expected one")}}})(a);var c=new yt;return Xt(a,c),c},Title:function(a,c){c&&c.generalOptions?c.generalOptions.title=st(a):c&&c.lyr&&(c.lyr.title=st(a))},Abstract:function(a,c){c&&c.lyr&&(c.lyr.description=st(a))},Server:function(a,c){var f=a.getAttribute("service"),v=a.getAttribute("title"),m=a.getAttribute("version");if(f)if(c&&c.services&&Yr(c.services)==="object"&&!c.services[f]){var T=new Zt;T.title=v,T.version=m,Xt(a,T),c.services[f]=T}else c&&c.lyr&&(c.lyr.serviceParams||(c.lyr.serviceParams={}),c.lyr.serviceParams.id=f,c.lyr.serviceParams.version=m)},OnlineResource:function(a,c){c&&c.hasOwnProperty("serverUrl")&&(c.serverUrl=a.getAttribute("xlink:href"))},LayerList:function(a,c){if(Xt(a,c),c&&c.layers&&c.generalOptions&&c.services){for(var f in c.layers)if(c.layers.hasOwnProperty(f)){var v=c.layers[f],m=v.apiKeys;if(m&&Array.isArray(m))for(var T=0;T<m.length;T++){var O=m[T];c.generalOptions.apiKeys&&(c.generalOptions.apiKeys[O]&&Array.isArray(c.generalOptions.apiKeys[O])||(c.generalOptions.apiKeys[O]=[]),c.generalOptions.apiKeys[O].push(f))}var L=v.serviceParams;if(L&&L.id&&!c.services[L.id]){var z=new Zt;L.serverUrl&&(z.serverUrl=L.serverUrl),L.version&&(z.version=L.version),c.services[L.id]=z}if(v.wmtsOptions&&v.wmtsOptions.tileMatrixSetLink&&c.tileMatrixSets){var B=v.wmtsOptions.tileMatrixSetLink,dt=c.tileMatrixSets;for(var nt in dt)dt.hasOwnProperty(nt)&&nt===B&&(v.defaultProjection=dt[nt].projection)}}}},Layer:function(a,c){if(c&&c.layers){var f={lyr:new Ae,lyrId:null},v=a.getAttribute("hidden");f.lyr.hidden=v==="1";var m=a.getAttribute("queryable");if(f.lyr.queryable=m==="1",Xt(a,f),f.lyrId){if(f.lyr.serviceParams&&f.lyr.serviceParams.id){var T=f.lyr.serviceParams.id;if(T.toUpperCase().indexOf("OPENLS")!==-1||T.toUpperCase().indexOf("ELEVATION")!==-1){var O=f.lyrId.split("$")[0];f.lyrId=O+"$"+T}}f.lyr.layerId=f.lyrId,c.layers[f.lyrId]=f.lyr}}},Name:function(a,c){c&&c.lyr&&(c.lyr.name=st(a))},SRS:function(a,c){c&&c.lyr&&(c.lyr.defaultProjection=st(a))},Format:function(a,c){if(c&&c.lyr){var f=new ie,v=a.getAttribute("current");f.current=v==="1",f.name=st(a),c.lyr.formats&&Array.isArray(c.lyr.formats)||(c.lyr.formats=[]),c.lyr.formats.push(f)}},Style:function(a,c){if(c&&c.lyr){var f=new We,v=a.getAttribute("current");if(f.current=v==="1"||v===1,a.hasChildNodes)for(var m,T,O=a.childNodes,L=0;L<O.length;L++)(m=O[L]).nodeType===1&&((T=m.localName||m.baseName||m.nodeName)==="Name"?f.name=st(m):T==="Title"?f.title=st(m):T==="URL"&&(f.url=st(m)));c.lyr.styles&&Array.isArray(c.lyr.styles)||(c.lyr.styles=[]),c.lyr.styles.push(f)}},Dimension:function(a,c){var f=a.getAttribute("name"),v=st(a);c&&c.lyr&&(c.lyr.dimensions||(c.lyr.dimensions={}),f==="Type"?c.lyr.dimensions.type=v:f==="VisibilityRange"?c.lyr.dimensions.visibilityRange=v:f==="VisibilityMode "?c.lyr.dimensions.visibilityMode=v:f==="GeometricType"?c.lyr.dimensions.geometricType=v:f==="NoDataValue"&&(c.lyr.dimensions.noDataValue=v))}},gpp:{Theme:function(a,c){c&&c.generalOptions&&c.generalOptions.hasOwnProperty("theme")&&(c.generalOptions.theme=st(a))},defaultGMLGFIStyleUrl:function(a,c){c&&c.generalOptions&&c.generalOptions.hasOwnProperty("defaultGMLGFIStyle")&&(c.generalOptions.defaultGMLGFIStyle=st(a))},Territory:function(a,c){var f=a.getAttribute("id");if(f){var v=new hr,m=a.getAttribute("default");v.isDefault=m==="1",Xt(a,v),c&&c.territories&&Yr(c.territories)==="object"&&(c.territories[f]=v)}},defaultCRS:function(a,c){c&&c.hasOwnProperty("defaultCRS")&&(c.defaultCRS=st(a))},AdditionalCRS:function(a,c){var f=st(a);f&&c&&(Array.isArray(c.additionalCRS)?c.additionalCRS.push(f):(c.additionalProjections&&Array.isArray(c.additionalProjections)||(c.additionalProjections=[]),c.additionalProjections.push(f)))},DefaultLayer:function(a,c){var f=a.getAttribute("layerId");f&&c&&Array.isArray(c.defaultLayers)&&c.defaultLayers.push(f)},BoundingBox:function(a,c){if(c){var f=st(a).split(",");if(f.length===4){var v={left:parseFloat(f[0]),right:parseFloat(f[2]),top:parseFloat(f[3]),bottom:parseFloat(f[1])},m=a.getAttribute("minT"),T=a.getAttribute("maxT");if(c.hasOwnProperty("geoBBOX"))c.geoBBOX=v;else if(c.hasOwnProperty("bbox"))if(c.bbox.left||c.bbox.right||c.bbox.top||c.bbox.bottom){c.multiConstraints||(c.multiConstraints=[]);var O=new St;O.bbox=v,O.temporalExtent=[m,T],c.multiConstraints.push(O)}else c.bbox=v,c.temporalExtent=[m,T];else c.globalConstraint||(c.globalConstraint=new St),c.globalConstraint.bbox=v,c.globalConstraint.temporalExtent=[m,T]}}},Resolution:function(a,c){var f=st(a);f&&c&&c.defaultOptions&&c.defaultOptions.hasOwnProperty("resolution")&&(c.defaultOptions.resolution=parseFloat(f))},x:function(a,c){var f=st(a);f&&c&&c.geoCenter&&c.geoCenter.hasOwnProperty("lon")&&(c.geoCenter.lon=parseFloat(f))},y:function(a,c){var f=st(a);f&&c&&c.geoCenter&&c.geoCenter.hasOwnProperty("lat")&&(c.geoCenter.lat=parseFloat(f))},Resolutions:function(a,c){c&&c.generalOptions&&c.generalOptions.hasOwnProperty("wgs84Resolutions")&&(c.generalOptions.wgs84Resolutions=st(a).split(","))},Layer:function(a,c){if(c&&c.hasOwnProperty("lyrId")&&c.lyr){c.lyrId=a.getAttribute("id");var f=a.getAttribute("aggregate"),v=a.getAttribute("more");(f||v)&&(c.lyr.isAggregate=!0),Xt(a,c.lyr)}},Constraint:function(a,c){var f=new St;if(Xt(a,f),c)if(c.constraints&&Array.isArray(c.constraints)||(c.constraints=[]),f.multiConstraints&&Array.isArray(f.multiConstraints)){var v=new St;v.crs=f.crs,v.bbox=f.bbox,v.minScaleDenominator=f.minScaleDenominator,v.maxScaleDenominator=f.maxScaleDenominator,v.temporalExtent=f.temporalExtent,c.constraints.push(v);for(var m=0;m<f.multiConstraints.length;m++)(v=new St).crs=f.crs,v.minScaleDenominator=f.minScaleDenominator,v.maxScaleDenominator=f.maxScaleDenominator,v.bbox=f.multiConstraints[m].bbox,v.temporalExtent=f.multiConstraints[m].temporalExtent,c.constraints.push(v)}else c.constraints.push(f)},CRS:function(a,c){c&&c.hasOwnProperty("crs")&&(c.crs=st(a))},Thematic:function(a,c){if(c){var f=new Ee;f.inspire=!1,f.name=st(a),c.thematics&&Array.isArray(c.thematics)||(c.thematics=[]),c.thematics.push(f)}},InspireThematic:function(a,c){if(c){var f=new Ee;f.inspire=!0,f.name=st(a),c.thematics&&Array.isArray(c.thematics)||(c.thematics=[]),c.thematics.push(f)}},Originator:function(a,c){if(c){var f=new Be;f.name=a.getAttribute("name"),Xt(a,f),c.originators&&Array.isArray(c.originators)||(c.originators=[]),c.originators.push(f)}},Attribution:function(a,c){c&&c.hasOwnProperty("attribution")&&(c.attribution=st(a))},Logo:function(a,c){c&&c.hasOwnProperty("logo")&&(c.logo=st(a))},URL:function(a,c){c&&c.hasOwnProperty("url")&&(c.url=st(a))},Legend:function(a,c){var f=new de;Xt(a,f),c&&(c.legends&&Array.isArray(c.legends)||(c.legends=[]),c.legends.push(f))},LegendURL:function(a,c){if(c&&c.hasOwnProperty("format")&&(c.format=a.getAttribute("format"),a.hasChildNodes)){var f=a.childNodes[0];(f.localName||f.baseName||f.nodeName)==="OnlineResource"&&c.hasOwnProperty("url")&&(c.url=f.getAttribute("xlink:href"))}},QuickLook:function(a,c){if(a.hasChildNodes){var f=a.childNodes[0];(f.localName||f.baseName||f.nodeName)==="OnlineResource"&&c&&(c.quicklookUrl=f.getAttribute("xlink:href"))}},MetadataURL:function(a,c){if(c){var f=new jr;if(f.format=a.getAttribute("format"),a.hasChildNodes){var v=a.childNodes[0];(v.localName||v.baseName||v.nodeName)==="OnlineResource"&&(f.url=v.getAttribute("xlink:href"))}c.metadata||(c.metadata=[]),c.metadata.push(f)}},Key:function(a,c){if(c){var f=a.getAttribute("id");c.apiKeys&&Array.isArray(c.apiKeys)||(c.apiKeys=[]),c.apiKeys.push(f);var v=st(a);c.serviceParams||(c.serviceParams={}),c.serviceParams.serverUrl||(c.serviceParams.serverUrl={}),c.serviceParams.serverUrl[f]||(c.serviceParams.serverUrl[f]=v)}}},ows:{Identifier:function(a,c){c&&c.hasOwnProperty("TMS")?c.identifier=st(a):c&&c.hasOwnProperty("matrixId")&&(c.matrixId=st(a))},SupportedCRS:function(a,c){c&&c.TMS&&c.TMS.hasOwnProperty("projection")&&(c.TMS.projection=st(a))}},sld:{MinScaleDenominator:function(a,c){var f=st(a);f&&c&&(c.hasOwnProperty("defaultOptions")?c.defaultOptions.minScaleDenominator=parseFloat(f):c.lyr?(c.lyr.globalConstraint||(c.lyr.globalConstraint=new St),c.lyr.globalConstraint.minScaleDenominator=parseFloat(f)):c.hasOwnProperty("minScaleDenominator")&&(c.minScaleDenominator=parseFloat(f)))},MaxScaleDenominator:function(a,c){var f=st(a);f&&c&&(c.hasOwnProperty("defaultOptions")?c.defaultOptions.maxScaleDenominator=parseFloat(f):c.lyr?(c.lyr.globalConstraint||(c.lyr.globalConstraint=new St),c.lyr.globalConstraint.maxScaleDenominator=parseFloat(f)):c.hasOwnProperty("maxScaleDenominator")&&(c.maxScaleDenominator=parseFloat(f)))}},wmts:{TileMatrixSetLimits:function(a,c){if(c){var f={};Xt(a,f),c.wmtsOptions||(c.wmtsOptions={}),c.wmtsOptions.tileMatrixSetLimits=f}},TileMatrixLimits:function(a,c){var f,v=new vi;if(a.hasChildNodes){for(var m=a.childNodes,T=0;T<m.length;T++){var O=m[T],L=O.localName||O.baseName||O.nodeName;L==="TileMatrix"?f=st(O):L==="MinTileRow"?v.minTileRow=st(O):L==="MaxTileRow"?v.maxTileRow=st(O):L==="MinTileCol"?v.minTileCol=st(O):L==="MaxTileCol"&&(v.maxTileCol=st(O))}f&&c&&!c[f]&&(c[f]=v)}},TileMatrixSet:function(a,c){if(c&&c.tileMatrixSets){var f={};f.TMS=new xn,f.resolutions=[],Xt(a,f);var v=f.TMS.tileMatrices;for(var m in v)v.hasOwnProperty(m)&&f.TMS.matrixIds.push(m);if((f.TMS.getProjection()==="IGNF:WGS84G"||f.TMS.getProjection()==="EPSG:4326")&&c.generalOptions&&Array.isArray(c.generalOptions.wgs84Resolutions))for(var T=c.generalOptions.wgs84Resolutions,O=0;O<T.length;O++)f.resolutions[O]=parseFloat(T[O]);Array.isArray(f.resolutions)&&f.resolutions.sort!==void 0&&f.resolutions.sort(function(L,z){return z-L}),f.TMS.nativeResolutions=f.resolutions,c.tileMatrixSets[f.identifier]=f.TMS}else c&&!c.wmtsOptions&&(c.wmtsOptions={}),c.wmtsOptions.tileMatrixSetLink=st(a)},TileMatrix:function(a,c){if(c){var f=new $r;if(Xt(a,f),c.TMS&&c.TMS.getProjection()){var v=c.TMS.getProjection();if(v==="EPSG:3857"||v==="EPSG:2154"){var m=28e-5*f.scaleDenominator;c.resolutions&&Array.isArray(c.resolutions)&&c.resolutions.push(m)}}c.TMS&&c.TMS.tileMatrices&&(c.TMS.tileMatrices[f.matrixId]=f)}},ScaleDenominator:function(a,c){var f=st(a);f&&c&&c.hasOwnProperty("scaleDenominator")&&(c.scaleDenominator=parseFloat(f))},TopLeftCorner:function(a,c){var f=st(a).split(" ");f&&c&&(c.topLeftCorner={},c.topLeftCorner.x=parseFloat(f[0]),c.topLeftCorner.y=parseFloat(f[1]))},TileWidth:function(a,c){var f=st(a);f&&c&&c.hasOwnProperty("tileWidth")&&(c.tileWidth=parseInt(f,10))},TileHeight:function(a,c){var f=st(a);f&&c&&c.hasOwnProperty("tileHeight")&&(c.tileHeight=parseInt(f,10))},MatrixWidth:function(a,c){var f=st(a);f&&c&&c.hasOwnProperty("matrixWidth")&&(c.matrixWidth=parseInt(f,10))},MatrixHeight:function(a,c){var f=st(a);f&&c&&c.hasOwnProperty("matrixHeight")&&(c.matrixHeight=parseInt(f,10))}},serviceException:function(a){var c={};if(a.hasChildNodes())for(var f,v=a.childNodes,m=0;m<v.length;m++)(f=v[m]).nodeName==="exception"&&(c.exceptionReport=xt.READERS.exception(f));return c},exception:function(a){var c={},f=a.getAttribute("code");f&&(c.exceptionCode=f);var v=a.firstChild;return v&&v.nodeType===3&&(c.exception=v.nodeValue),c}},xt.read=function(a){if(a.nodeName==="ViewContext"){var c=a.prefix||xt.DEFAULTPREFIX;return xt.READERS[c][a.nodeName](a)}if(a.nodeName==="serviceException")return xt.READERS[a.nodeName](a);throw new Error("Erreur lors de la lecture de la r\xE9ponse : elle n'est pas au format attendu.")};var Cn=xt,pr={build:function(a){u.getLogger("AutoConfResponseFactory").trace(["AutoConfResponseFactory::build()"]);var c=null;if(a.response){if(a.rawResponse)c=a.response;else{try{var f=new pt({reader:Cn});typeof a.response=="string"?f.setXMLString(a.response):f.setXMLDoc(a.response),c=f.parse()}catch(L){var v=L.message;return typeof a.response=="string"?v+=`
 (raw response service'`+a.response+"')":v+=`
 (raw response service'`+a.response.documentElement.innerHTML+"')",void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",v),status:200,type:d.TYPE_SRVERR}))}var m=!0;for(var T in c)c.hasOwnProperty(T)&&(m=!1);if(m)return void a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_EMPTY_2")));if(c.exceptionReport)return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",c.exceptionReport),type:d.TYPE_SRVERR,status:200}))}var O=typeof window!="undefined"?window:{};O.Gp||(O.Gp={}),O.Gp.Config?this.mergeConfig(O.Gp.Config,c,a.layerId):O.Gp.Config=c,a.onSuccess.call(a.scope,O.Gp.Config)}else a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))},mergeConfig:function(a,c,f){if(c&&a){for(var v in c)if(c.hasOwnProperty(v)){if(v==="generalOptions")for(var m in c[v].apiKeys)c[v].apiKeys.hasOwnProperty(m)&&!a.generalOptions.apiKeys[m]&&(a.generalOptions.apiKeys[m]=c[v].apiKeys[m]);else if(a[v])for(var T in c[v])c[v].hasOwnProperty(T)&&!a[v][T]&&(a[v][T]=c[v][T])}if(f){var O=[];for(var L in c.layers)c.layers.hasOwnProperty(L)&&O.push(L);a.layers[f]&&(a.layers[f].aggregatedLayers=O)}}}};function ne(a){if(!(this instanceof ne))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","AutoConf"));if(this.CLASSNAME="AutoConf",a||(a={}),a.protocol=a.protocol||"JSONP",A.apply(this,arguments),this.logger=u.getLogger("Gp.Services.AutoConf"),this.logger.trace("[Constructeur AutoConf (options)]"),(typeof this.options.apiKey=="string"||this.options.apiKey instanceof String)&&Array.isArray(this.options.apiKey.split(","))&&this.options.apiKey.split(",").length>1&&(this.options.apiKey=this.options.apiKey.split(",")),!this.options.serverUrl&&!this.options.serverUrl){var c=I.AutoConf.url(this.options.apiKey);this.options.layerId?this.options.serverUrl=c.aggregate+this.options.layerId:Array.isArray(this.options.apiKey)&&this.options.apiKey.length>0?this.options.serverUrl=c.apiKeys:this.options.serverUrl=c.apiKey}this.options.protocol==="XHR"&&this.options.httpMethod==="POST"&&(this.logger.warn("Le service ne g\xE9re pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"xml"}ne.prototype=Object.create(A.prototype,{}),ne.prototype.constructor=ne,ne.prototype.buildRequest=function(a,c){var f=typeof window!="undefined"?window:{};if(f.Gp&&f.Gp.Config&&f.Gp.Config.generalOptions&&f.Gp.Config.layers&&f.Gp.Config.generalOptions.apiKeys[this.options.apiKey]){if(!this.options.layerId)return this.logger.warn("Gp.Config existe d\xE9j\xE0 pour cette cl\xE9"),void this.options.onSuccess.call(this,f.Gp.Config);if(f.Gp.Config.layers[this.options.layerId]&&f.Gp.Config.layers[this.options.layerId].aggregatedLayers)return this.logger.warn("Gp.Config existe d\xE9j\xE0 pour cette cl\xE9 et cette couche"),void this.options.onSuccess.call(this,f.Gp.Config)}this.request="",this.options.serverUrl.indexOf("http://")!==-1&&this.layerId&&(this.request=g.normalyzeParameters({layerId:this.layerId})),this.request||this.request===""?c.call(this,this.request):a.call(this,new d(h.getMessage("SERVICE_REQUEST_BUILD")))},ne.prototype.analyzeResponse=function(a,c){if(this.response){var f={layerId:this.options.layerId,response:this.response,rawResponse:this.options.rawResponse,onSuccess:c,onError:a,scope:this};pr.build(f)}else a.call(this,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var dr=ne;function gr(a){if(this.logger=u.getLogger(),this.logger.trace("[Constructeur RequestHeader ()]"),!(this instanceof gr))throw new TypeError("RequestHeader constructor cannot be called as a function.");for(var c in this.options=a||{srsName:"EPSG:4326"},a)a.hasOwnProperty(c)&&(this.options[c]=a[c])}gr.prototype={requestString:null,template:'<RequestHeader srsName="__SRSNAME__"/>',constructor:gr,toString:function(){var a=null;return a=(a=this.template).replace(/__SRSNAME__/g,this.options.srsName),this.requestString=a,this.requestString}};var _i=gr;function Vr(a){if(this.logger=u.getLogger(),this.logger.trace("[Constructeur Request ()]"),!(this instanceof Vr))throw new TypeError("Request constructor cannot be called as a function.");for(var c in this.options=a||{maximumResponses:25,methodName:null,version:"1.2"},a)a.hasOwnProperty(c)&&(this.options[c]=a[c])}Vr.prototype={requestString:null,template:'<Request maximumResponses="__MAXRESPONSES__" methodName="__METHODNAME__" requestID="__UUID__" version="__VERSION__"><!-- __REQUESTSERVICE__ --></Request>',constructor:Vr,guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return(a==="x"?c:3&c|8).toString(16)})},toString:function(){var a=null;return a=(a=(a=(a=(a=this.template).replace(/__MAXRESPONSES__/g,this.options.maximumResponses)).replace(/__METHODNAME__/g,this.options.methodName)).replace(/__UUID__/g,this.guid())).replace(/__VERSION__/g,this.options.version),this.requestString=a,this.requestString}};var Po=Vr;function we(a){if(this.logger=u.getLogger(),this.logger.trace("[Constructeur AbstractService ()]"),!(this instanceof we))throw new TypeError("AbstractService constructor cannot be called as a function.");for(var c in this.options=a||{},a)a.hasOwnProperty(c)&&(this.options[c]=a[c])}we.prototype={strRequest:null,oRequest:null,oFilter:null,constructor:we,addRequest:function(a){this.logger.error("overwritten method !")},addFilter:function(a){this.logger.error("overwritten method !")},toString:function(){this.logger.error("overwritten method !")}};var be=we;function Ut(a){if(this.logger=u.getLogger(),this.logger.trace("[Constructeur XLS()]"),!(this instanceof Ut))throw new TypeError("XLS constructor cannot be called as a function.");for(var c in this.options={srsName:"EPSG:4326",maximumResponses:25},a)a.hasOwnProperty(c)&&a[c]&&(this.options[c]=a[c])}Ut.VERSION="1.2",Ut.prototype={requestString:null,namespace:!1,oService:null,constructor:Ut,template:`<?xml version="1.0" encoding="UTF-8"?>
<XLS version="__VERSION__"
__NAMESPACE__ 
__SCHEMALOCATION__>
__REQUESTHEADER__
__REQUEST__
</XLS>
`,namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns:xls="http://www.opengis.net/xls"','xmlns:gml="http://www.opengis.net/gml"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/xls http://schemas.opengis.net/ols/1.2/olsAll.xsd"'},setService:function(a){a?a instanceof be?this.oService=a:this.logger.error("L'objet n'est pas du type 'LocationUtilityService' ou 'RouteService' !?"):this.logger.trace("L'objet de type Service XSL n'est pas encore defini !?")},getService:function(){return this.oService}},Ut.prototype.addNamespace=function(a,c){for(var f,v,m=a.key,T=!1,O=this.namespaceByDefault().split(" "),L=0;L<O.length;L++)if(O[L].split("=")[0]==="xmlns:"+m){T=!0;break}return T?(f=/<(\w+[\s>])/g,v="<"+m+":$1",c=c.replace(f,v),f=/<\/(\w+[\s>])/g,v="</"+m+":$1",c=c.replace(f,v),this.logger.trace("namespace",c),c):(this.logger.warn("L'ajout d'un nouvel namespace n'est pas encore impl\xE9ment\xE9 !"),c)},Ut.prototype.build=function(){var a=!!this.getService(),c="";c=(c=(c=(c=this.template).replace(/__VERSION__/g,Ut.VERSION)).replace(/__NAMESPACE__/g,this.namespaceByDefault)).replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault);var f=new _i({srsName:this.options.srsName});c=c.replace(/__REQUESTHEADER__/g,f.toString());var v=new Po({maximumResponses:this.options.maximumResponses,version:Ut.VERSION,methodName:a?this.getService().CLASSTYPE:null});if(c=c.replace(/__REQUEST__/g,v.toString()),a&&(c=c.replace(/<!-- __REQUESTSERVICE__ -->/g,this.getService().toString())),c)return this.namespace&&(c=this.addNamespace({key:"xls",url:"http://www.opengis.net/xls"},c)),this.requestString=c,this.logger.trace("traduction tmpl",c),this.requestString;this.logger.warn("traduction tmpl : empty request !?")};var vr=Ut;function Te(a){if(this.logger=u.getLogger("Address"),this.logger.trace("[Constructeur Address ()]"),!(this instanceof Te))throw new TypeError("Address constructor cannot be called as a function.");if(this.options=a||{location:{},type:["StreetAddress"],filter:{}},!this.options.location||Object.keys(this.options.location).length===0)throw new Error("l'option 'location' n'est pas renseign\xE9e !")}Te.prototype={constructor:Te,requestString:null,template:{address:'<Address countryCode="__COUNTRYCODE__">__LOCATION____PLACE____POSTALCODE____ENVELOPE__</Address>',location:{freeFormAddress:"<freeFormAddress>__FREEFORMADDRESSVALUE__</freeFormAddress>",streetAddress:{container:"<StreetAddress>__STREET____BUILDING__</StreetAddress>",building:'<Building number="__BUILDINGVALUE__"/>',street:"<Street>__STREETVALUE__</Street>"}},place:'<Place type="__PLACETYPE__">__PLACEVALUE__</Place>',postalCode:"<PostalCode>__POSTALCODEVALUE__</PostalCode>",envelope:"<gml:Envelope><gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner><gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner></gml:Envelope>"}},Te.prototype.toString=function(){var a=null;if(a=(a=this.template.address).replace(/__COUNTRYCODE__/g,this.options.type),typeof this.options.location=="string"){var c=this.template.location.freeFormAddress;c=c.replace(/__FREEFORMADDRESSVALUE__/g,this.options.location),a=a.replace(/__LOCATION__/g,c)}else{var f="",v="";this.options.location.number&&(f=(f=this.template.location.streetAddress.building).replace(/__BUILDINGVALUE__/g,this.options.location.number)),this.options.location.street&&(v=(v=this.template.location.streetAddress.street).replace(/__STREETVALUE__/g,this.options.location.street));var m=this.template.location.streetAddress.container;m=(m=m.replace(/__STREET__/g,v)).replace(/__BUILDING__/g,f),a=a.replace(/__LOCATION__/g,m)}var T="";this.options.location.postalCode&&(T=(T=this.template.postalCode).replace(/__POSTALCODEVALUE__/g,this.options.location.postalCode));var O="";if(this.options.filter){var L=this.options.filter.bbox;L&&(O=(O=(O=(O=(O=this.template.envelope).replace(/__LEFT__/g,L.left)).replace(/__BOTTOM__/g,L.bottom)).replace(/__RIGHT__/g,L.right)).replace(/__TOP__/g,L.top))}var z=[],B="";if(this.options.filter){var dt=this.options.filter;for(var nt in dt)nt!=="bbox"&&(B=(B=(B=this.template.place).replace(/__PLACETYPE__/g,nt)).replace(/__PLACEVALUE__/g,dt[nt]),z.push(B))}var qt="";return this.options.location.city&&(qt=(qt=(qt=this.template.place).replace(/__PLACETYPE__/g,"Municipality")).replace(/__PLACEVALUE__/g,this.options.location.city),z.push(qt)),a=(a=(a=a.replace(/__POSTALCODE__/g,T)).replace(/__PLACE__/g,z.join(`
`))).replace(/__ENVELOPE__/g,O),this.requestString=a,this.requestString};var Yt=Te;function Vt(){if(this.logger=u.getLogger("GeocodeFilterExtension"),this.logger.trace("[Constructeur GeocodeFilterExtension ()]"),!(this instanceof Vt))throw new TypeError("GeocodeFilterExtension constructor cannot be called as a function.");this.filters=[]}Vt.prototype={constructor:Vt,addFilterExtensions:function(a){a&&this.filters.push(a)},getNames:function(){var a=[];for(var c in this.filters)a.push(this.filters[c].CLASSNAME);return this.logger.trace(a),a},getFilter:function(a){var c=null;for(var f in this.filters)this.filters[f].CLASSNAME===a&&(c=this.filters[f]);return this.logger.trace(c),c},getFilters:function(){return this.logger.trace(this.filters),this.filters},getAttributs:function(a){var c=[];for(var f in this.filters)this.filters[f].CLASSNAME===a&&(c=this.filters[f].attributesList);return this.logger.trace(c),c},setPlaceAttributs:function(a,c){var f=this.getFilter(a),v=this.getAttributs(a);for(var m in v){var T=v[m];c[T]&&(f.placeAttributes[T]=c[T])}},getPlaceAttributs:function(a){var c={};for(var f in this.filters)this.filters[f].CLASSNAME===a&&(c=this.filters[f].placeAttributes);return this.logger.trace(c),c}};var _r=Vt;function Br(a){if(this.logger=u.getLogger(),this.logger.trace("[Constructeur GeocodeRequest ()]"),!(this instanceof Br))throw new TypeError("GeocodeRequest constructor cannot be called as a function.");for(var c in this.options=a||{},a)a.hasOwnProperty(c)&&(this.options[c]=a[c]);this.CLASSNAME="GeocodeRequest"}Br.prototype={strRequest:null,oAddress:null,oFilter:null,template:'<GeocodeRequest returnFreeForm="__RETURNFREEFORM__">__ADDRESS__</GeocodeRequest>',addAddress:function(a){a instanceof Yt&&(this.oAddress=a)},addFilter:function(a){a instanceof _r&&(this.oFilter=a)},constructor:Br,toString:function(){var a="";if(a=this.template,!this.oAddress){var c={};if(c.location=this.options.location,c.type=this.options.filterOptions.type||["StreetAddress"],c.filter=this.options.filterOptions,delete c.filter.type,this.oFilter)for(var f in c.filter={},c.type){var v=c.type[f],m=this.oFilter.getFilter(v);if(m){for(var T=this.options.filterOptions,O=m.attributesList,L=0;L<O.length;L++){var z=O[L];if(T[z]){var B=m.serviceAttributes[L];m.placeAttributes[B]=T[z],this.logger.trace("Selection du filtre '"+z+"' sur le type '"+v+"'.")}}var dt=m.placeAttributes;for(var nt in dt)dt.hasOwnProperty(nt)&&(c.filter[nt]=dt[nt])}else this.logger.warn("Le filtre '"+v+"' n'existe pas !?")}if(this.oAddress=new Yt(c),!this.oAddress)throw new Error("La construction de l'adresse n'est pas correctement definie !?")}return a=(a=a.replace(/__ADDRESS__/g,this.oAddress.toString())).replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=a,this.strRequest}};var yi=Br;function On(a){if(this.logger=u.getLogger("Position"),this.logger.trace("[Constructeur Position ()]"),!(this instanceof On))throw new TypeError("Position constructor cannot be called as a function.");if(this.options=a||{},!this.options.position)throw new Error("l'option 'position' n'est pas renseign\xE9e !")}On.prototype={constructor:On,requestString:null,template:{position:"<Position>__GMLPOINT____GMLFILTER__</Position>",gml:{point:'<gml:Point xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos></gml:Point>',pos:null,filter:{bbox:'<gml:Envelope xmlns:gml="http://www.opengis.net/gml"><gml:lowerCorner>__LEFT__ __BOTTOM__</gml:lowerCorner><gml:upperCorner>__RIGHT__ __TOP__</gml:upperCorner></gml:Envelope>',circle:'<gml:CircleByCenterPoint xmlns:gml="http://www.opengis.net/gml"><gml:pos>__X__ __Y__</gml:pos><gml:radius>__RADIUS__</gml:radius></gml:CircleByCenterPoint>',polygon:'<gml:Polygon xmlns:gml="http://www.opengis.net/gml"><gml:exterior><gml:LinearRing><gml:posList>__XY__</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>',multipolygon:null}}}},On.prototype.toString=function(){var a=this.template.position,c=this.template.gml.point;c=(c=c.replace(/__X__/g,this.options.position.x)).replace(/__Y__/g,this.options.position.y);var f="";if(this.options.filter){var v=this.options.filter;for(var m in v)switch(m){case"circle":f=(f=(f=(f=this.template.gml.filter[m]).replace(/__X__/g,v[m].x)).replace(/__Y__/g,v[m].y)).replace(/__RADIUS__/g,v[m].radius);break;case"bbox":f=(f=(f=(f=(f=this.template.gml.filter[m]).replace(/__LEFT__/g,v[m].left)).replace(/__BOTTOM__/g,v[m].bottom)).replace(/__RIGHT__/g,v[m].right)).replace(/__TOP__/g,v[m].top);break;case"polygon":f=this.template.gml.filter[m];for(var T="",O=v[m],L=0;L<O.length;L++){var z=O[L];if(Array.isArray(z)){this.logger.error("Holes are not implemented !");break}(z.x&&z.y||z.x===0||z.y===0)&&(T+=z.x+" "+z.y),O.length!==L+1&&(T+=" ")}f=f.replace(/__XY__/g,T);break;case"multipolygon":this.logger.warn("Filter '"+m+"' is not yet implemented !");break;default:this.logger.error("This filter '"+m+"' is not useful !")}}return a=(a=a.replace(/__GMLPOINT__/g,c)).replace(/__GMLFILTER__/g,f),this.requestString=a,this.requestString};var na=On;function In(a){if(this.logger=u.getLogger("Preference"),this.logger.trace("[Constructeur Preference ()]"),!(this instanceof In))throw new TypeError("Preference constructor cannot be called as a function.");this.type=a}In.prototype={constructor:In,requestString:null,template:"<ReverseGeocodePreference>__TYPE__</ReverseGeocodePreference>"},In.prototype.toString=function(){for(var a=[],c="",f=0;f<this.type.length;f++)c=(c=this.template).replace(/__TYPE__/g,this.type[f]),a.push(c);return this.strRequest=a.join(`
`),this.strRequest};var ia=In;function mi(a){if(this.logger=u.getLogger(),this.logger.trace("[Constructeur ReverseGeocodeRequest ()]"),!(this instanceof mi))throw new TypeError("ReverseGeocodeRequest constructor cannot be called as a function.");for(var c in this.options=a||{},a)a.hasOwnProperty(c)&&(this.options[c]=a[c]);this.CLASSNAME="ReverseGeocodeRequest"}mi.prototype={strRequest:null,oPosition:null,oPreference:null,constructor:mi,template:'<ReverseGeocodeRequest returnFreeForm="__RETURNFREEFORM__">__POSITION____PREFERENCE__</ReverseGeocodeRequest>',addPosition:function(a){a instanceof na&&(this.oPosition=a)},addPreferences:function(a){a instanceof ia&&(this.oPreference=a)},toString:function(){var a="";if(a=this.template,!this.oPreference&&(this.oPreference=new ia(this.options.filterOptions.type||["StreetAddress"]),!this.oPreference))throw new Error("Les preferences ne sont pas definies !?");if(a=a.replace(/__PREFERENCE__/g,this.oPreference.toString()),!this.oPosition){var c={position:this.options.position,filter:{}};if(this.options.filterOptions&&(c.filter=this.options.filterOptions,delete c.filter.type),this.oPosition=new na(c),!this.oPosition)throw new Error("La position et ses filtres ne sont pas definis !?")}return a=(a=a.replace(/__POSITION__/g,this.oPosition.toString())).replace(/__RETURNFREEFORM__/g,this.options.returnFreeForm?"true":"false"),this.strRequest=a,this.strRequest}};var uc=mi;function ze(a){if(this.logger=u.getLogger(),this.logger.trace("[Constructeur LocationUtilityService ()]"),!(this instanceof ze))throw new TypeError("LocationUtilityService constructor cannot be called as a function.");this.CLASSNAME="LocationUtilityService",this.CLASSTYPE=null,be.apply(this,arguments),this.options&&(this.CLASSTYPE=this.options.location?"GeocodeRequest":this.options.position?"ReverseGeocodeRequest":null)}ze.prototype=Object.create(be.prototype,{}),ze.prototype.constructor=ze,ze.prototype.addRequest=function(a){switch(this.CLASSTYPE=a.CLASSNAME,this.CLASSTYPE){case"GeocodeRequest":case"ReverseGeocodeRequest":this.oRequest=a;break;default:throw new Error("Ce n'est pas un objet de type 'LUS Request' !?")}},ze.prototype.addFilter=function(a){a instanceof _r&&(this.oFilter=a)},ze.prototype.toString=function(){if(!this.oRequest){if(!this.options)throw new Error("Les options ne sont pas renseign\xE9es, impossible de construire la requ\xEAte !");if(this.CLASSTYPE==="GeocodeRequest"){var a={location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new yi(a),this.oFilter&&this.oRequest.addFilter(this.oFilter)}else if(this.CLASSTYPE==="ReverseGeocodeRequest"){var c={position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions||{}};this.oRequest=new uc(c)}else this.logger.error("impossible de determiner le type de geocodage : Direct ou Inverse !?")}if(!this.oRequest)throw new Error("Type de Geocodage indefini !");return this.strRequest=this.oRequest.toString(),this.strRequest};var oa=ze;function Ei(){if(!(this instanceof Ei))throw new TypeError("GeocodeLocation constructor cannot be called as a function.");this.placeAttributes={},this.attributesList=[],this.serviceAttributes=[]}Ei.prototype={constructor:Ei};var qe=Ei;function An(){if(!(this instanceof An))throw new TypeError("StreetAddress constructor cannot be called as a function.");qe.apply(this,arguments),this.CLASSNAME="StreetAddress",this.attributesList=["bbox","ID","IDTR","quality","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","ID","IDTR","Qualite","Territoire","Commune","Departement","INSEE","Municipality"]}An.prototype=Object.create(qe.prototype),An.prototype.constructor=An;var cc=An;function Pn(){if(!(this instanceof Pn))throw new TypeError("PositionOfInterest constructor cannot be called as a function.");qe.apply(this,arguments),this.CLASSNAME="PositionOfInterest",this.attributesList=["bbox","importance","nature","territory","commune","department","insee","municipality"],this.serviceAttributes=["bbox","Importance","Nature","Territoire","Commune","Departement","INSEE","Municipality"]}Pn.prototype=Object.create(qe.prototype),Pn.prototype.constructor=Pn;var hc=Pn;function bn(){if(!(this instanceof bn))throw new TypeError("CadastralParcel constructor cannot be called as a function.");qe.apply(this,arguments),this.CLASSNAME="CadastralParcel",this.attributesList=["absorbedCity","sheet","number","section","commune","department","insee","municipality","origin"],this.serviceAttributes=["CommuneAbsorbee","Feuille","Numero","Section","Commune","Departement","INSEE","Municipality","Type"]}bn.prototype=Object.create(qe.prototype),bn.prototype.constructor=bn;var fc=bn;function Ln(){if(!(this instanceof Ln))throw new TypeError("Administratif constructor cannot be called as a function.");qe.apply(this,arguments),this.CLASSNAME="Administratif",this.attributesList=["bbox","prefecture","inseeRegion","inseeDepartment","municipality"],this.serviceAttributes=["bbox","Prefecture","InseeRegion","InseeDepartement","Municipality"]}Ln.prototype=Object.create(qe.prototype),Ln.prototype.constructor=Ln;var pc=Ln,dc={build:function(a){var c=u.getLogger("DirectGeocodeRequestFactory");c.trace(["DirectGeocodeRequestFactory::build()"]);var f=null,v=new _r;v.addFilterExtensions(new pc),v.addFilterExtensions(new cc),v.addFilterExtensions(new hc),v.addFilterExtensions(new fc);var m=new oa({location:a.location,returnFreeForm:a.returnFreeForm,filterOptions:a.filterOptions});m.addFilter(v);var T=new vr({srsName:a.srs,maximumResponses:a.maximumResponses});return T.namespace=!0,T.setService(m),f=T.build(),a.httpMethod==="GET"&&(f="qxml="+encodeURIComponent(f).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")),c.trace(f),f}};function wi(){if(!(this instanceof wi))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}wi.prototype={constructor:wi};var bo=wi;function Ti(){if(!(this instanceof Ti))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position={x:null,y:null},this.matchType=null,this.placeAttributes={},this.type=null}Ti.prototype={constructor:Ti};var Mn=Ti;function Nn(){if(!(this instanceof Nn))throw new TypeError("DirectGeocodedLocation constructor cannot be called as a function.");Mn.apply(this,arguments),this.CLASSNAME="DirectGeocodedLocation",this.accuracy=null}Nn.prototype=Object.create(Mn.prototype),Nn.prototype.constructor=Nn;var sa=Nn,Mt={};function Ri(a,c){if(a.hasChildNodes())for(var f,v,m,T=a.childNodes,O=0;O<T.length;O++)(f=T[O]).nodeType===1&&(v=f.localName||f.baseName||f.nodeName,m=f.prefix||Mt.DEFAULTPREFIX,Mt.READERS[m][v]?(0,Mt.READERS[m][v])(f,c):Ri(f,c))}function Wr(a){var c,f="";return a.hasChildNodes()&&(c=a.firstChild).nodeType===3&&(f=c.nodeValue),f}Mt.VERSION="1.2",Mt.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},Mt.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",Mt.DEFAULTPREFIX="xls",Mt.READERS={xls:{XLS:function(a){var c=new bo;return function(f){if(f.attributes.length>0){var v=function(L){if(L.attributes.length>0){for(var z={},B=L.attributes,dt=0;dt<B.length;dt++){var nt=B[dt];z[nt.nodeName]=nt.nodeValue}return z}}(f);for(var m in v)if(v.hasOwnProperty(m)){if(m==="version"&&v.version!==Mt.VERSION)return void console.log("[DirectGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if(m==="xmlns"){if(v[m]!==Mt.NAMESPACES[Mt.DEFAULTPREFIX])return void console.log("[DirectGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var T=m.split(":")[0],O=m.split(":")[1];if(T==="xmlns"&&O&&Mt.NAMESPACES[O]&&Mt.NAMESPACES[O]!==v[m])return void console.log("[DirectGeocodeResponseReader] geocode response "+m+" namespace is not the expected one");if(O==="schemaLocation"&&Mt.SCHEMALOCATION!==v[m])return void console.log("[DirectGeocodeResponseReader] geocode response schema location is not the expected one")}}}(a),Ri(a,c),c},GeocodedAddress:function(a,c){var f=new sa;Ri(a,f),c&&Array.isArray(c.locations)&&c.locations.push(f)},GeocodeMatchCode:function(a,c){var f=a.getAttribute("accuracy");f&&c&&(c.accuracy=parseFloat(f));var v=a.getAttribute("matchType");v&&c&&(c.matchType=v)},Address:function(a,c){var f=a.getAttribute("countryCode");c&&f&&(c.type=f),Ri(a,c)},freeFormAddress:function(a,c){c&&c.hasOwnProperty("placeAttributes")&&(c.placeAttributes.freeform=Wr(a))},Building:function(a,c){var f=a.getAttribute("number");c&&c.hasOwnProperty("placeAttributes")&&(f?c.placeAttributes.number=f:a.getAttribute("buildingName")?c.placeAttributes.number=a.getAttribute("buildingName"):a.getAttribute("subdivision")&&(c.placeAttributes.number=a.getAttribute("subdivision")))},Street:function(a,c){c&&c.hasOwnProperty("placeAttributes")&&(c.type==="StreetAddress"?c.placeAttributes.street=Wr(a):c.type==="CadastralParcel"&&(c.placeAttributes.cadastralParcel=Wr(a)))},Place:function(a,c){var f=a.getAttribute("type"),v=Wr(a);if(c&&c.hasOwnProperty("placeAttributes"))if(f==="Municipality")c.placeAttributes.municipality=v;else if(f==="Bbox"){var m=v.split(";");m.length===4&&(c.placeAttributes.bbox={left:parseFloat(m[0]),right:parseFloat(m[2]),top:parseFloat(m[1]),bottom:parseFloat(m[3])})}else f==="Commune"?c.placeAttributes.commune=v:f==="Departement"?c.placeAttributes.department=v:f==="INSEE"?c.placeAttributes.insee=v:f==="Qualite"?c.placeAttributes.quality=v:f==="Territoire"?c.placeAttributes.territory=v:f==="ID"?c.placeAttributes.ID=v:f==="ID_TR"?c.placeAttributes.IDTR=v:f==="Importance"?c.placeAttributes.importance=parseInt(v,10):f==="Nature"?c.placeAttributes.nature=v:f==="Numero"?c.placeAttributes.number=v:f==="Feuille"?c.placeAttributes.sheet=v:f==="Section"?c.placeAttributes.section=v:f==="CommuneAbsorbee"?c.placeAttributes.absorbedCity=v:f==="Arrondissement"?v&&(c.placeAttributes.arrondissement=v):f==="Type"?c.placeAttributes.origin=v:f==="Prefecture"?c.placeAttributes.prefecture=v:f==="InseeRegion"?c.placeAttributes.inseeRegion=v:f==="InseeDepartment"&&(c.placeAttributes.inseeDepartment=v)},PostalCode:function(a,c){c&&c.hasOwnProperty("placeAttributes")&&(c.placeAttributes.postalCode=Wr(a))},Error:function(a){var c=a.getAttribute("message"),f=a.getAttribute("errorCode"),v=h.getMessage("SERVICE_RESPONSE_EXCEPTION","("+f+") : "+c);throw new d({message:v,type:d.TYPE_SRVERR})}},gml:{pos:function(a,c){var f=Wr(a);c&&f&&(c.position={x:parseFloat(f.split(" ")[0]),y:parseFloat(f.split(" ")[1])})}},ExceptionReport:function(a){var c={};if(a.hasChildNodes())for(var f,v=a.childNodes,m=0;m<v.length;m++)(f=v[m]).nodeName==="Exception"&&(c.exceptionReport=Mt.READERS.Exception(f));return c},Exception:function(a){var c={},f=a.getAttribute("exceptionCode");f&&(c.exceptionCode=f);var v=a.firstChild;return v&&v.nodeType===3&&(c.exception=v.nodeValue),c}},Mt.read=function(a){if(a.nodeName==="XLS"){var c=a.prefix;return c||(c=Mt.DEFAULTPREFIX),Mt.READERS[c][a.nodeName](a)}if(a.nodeName==="ExceptionReport")return Mt.READERS[a.nodeName](a);var f=h.getMessage("SERVICE_RESPONSE_ANALYSE",a.nodeName);throw new d({message:f,type:d.TYPE_UNKERR,status:200})};var gc=Mt,vc={build:function(a){var c=null;if(a.response){if(a.rawResponse)c=a.response;else{try{var f=new pt({reader:gc});if(typeof a.response=="string"?f.setXMLString(a.response):f.setXMLDoc(a.response),!(c=f.parse()))throw new Error("L'analyse de la r\xE9ponse du service !?")}catch(m){var v=m.message;return typeof a.response=="string"?v+="('"+a.response+"')":v+="('"+a.response.documentElement.innerHTML+"')",void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_ANALYSE",v),type:d.TYPE_UNKERR,status:-1}))}if(c.exceptionReport)return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",c.exceptionReport),type:d.TYPE_SRVERR,status:200}))}a.onSuccess.call(a.scope,c)}else a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EMPTY"),type:d.TYPE_SRVERR,status:-1}))}};function Lo(a){return(Lo=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}function yr(a){if(!(this instanceof yr))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","Geocode"));if(this.CLASSNAME="Geocode",A.apply(this,arguments),this.logger=u.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]"),!a.location)throw new Error(h.getMessage("PARAM_MISSING","location"));if(Lo(a.location)==="object"&&Object.keys(a.location).length===0)throw new Error(h.getMessage("PARAM_EMPTY","location"));if(typeof a.location=="string"&&a.location.length===0)throw new Error(h.getMessage("PARAM_EMPTY","location"));this.options.location=a.location,a.filterOptions&&Lo(a.filterOptions)==="object"||(this.options.filterOptions=a.filterOptions={type:["StreetAddress"]}),Object.keys(a.filterOptions).length===0&&(this.options.filterOptions={type:["StreetAddress"]});for(var c=Object.keys(a.filterOptions),f=0;f<c.length;f++){var v=c[f],m=["department","number","postalCode","insee","importance","ID","IDTR","absorbedCity","sheet","section","inseeRegion","inseeDepartment"];m.indexOf(v)!==-1&&typeof a.filterOptions[v]!="string"&&(a.filterOptions[v]=a.filterOptions[v].toString()),a.filterOptions[v]||delete this.options.filterOptions[v]}this.options.filterOptions.type=a.filterOptions.type||["StreetAddress"],this.options.maximumResponses=a.maximumResponses||25,this.options.returnFreeForm=a.returnFreeForm||!1,this.options.srs=a.srs||"EPSG:4326",this.options.outputFormat=this.options.rawResponse?"":"xml"}yr.prototype=Object.create(A.prototype,{}),yr.prototype.constructor=yr,yr.prototype.buildRequest=function(a,c){var f={httpMethod:this.options.httpMethod,location:this.options.location,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:this.options.srs,maximumResponses:this.options.maximumResponses};this.request=dc.build(f),this.request?c.call(this,this.request):a.call(this,new d(h.getMessage("SERVICE_REQUEST_BUILD")))},yr.prototype.analyzeResponse=function(a,c){if(this.response){var f={response:this.response,rawResponse:this.options.rawResponse,onError:a,onSuccess:c,scope:this};vc.build(f)}else a.call(this,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var _c=yr,yc={build:function(a){var c=u.getLogger("ReverseGeocodeRequestFactory");c.trace(["ReverseGeocodeRequestFactory::build()"]);var f=a||{},v=null,m=new oa({position:f.position,returnFreeForm:f.returnFreeForm,filterOptions:f.filterOptions}),T=new vr({srsName:f.srs,maximumResponses:f.maximumResponses});return T.namespace=!0,T.setService(m),v=T.build(),f.httpMethod==="GET"&&(v="qxml="+encodeURIComponent(v).replace(/-/g,"%2D").replace(/_/g,"%5F").replace(/\./g,"%2E").replace(/!/g,"%21").replace(/~/g,"%7E").replace(/\*/g,"%2A").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29")),c.trace(v),v}};function Dn(){if(!(this instanceof Dn))throw new TypeError("ReverseGeocodedLocation constructor cannot be called as a function.");Mn.apply(this,arguments),this.CLASSNAME="ReverseGeocodedLocation",this.searchCenterDistance=null}Dn.prototype=Object.create(Mn.prototype),Dn.prototype.constructor=Dn;var aa=Dn,Nt={};function Si(a,c){if(a.hasChildNodes())for(var f,v,m,T=a.childNodes,O=0;O<T.length;O++)(f=T[O]).nodeType===1&&(v=f.localName||f.baseName||f.nodeName,m=f.prefix||Nt.DEFAULTPREFIX,Nt.READERS[m][v]?(0,Nt.READERS[m][v])(f,c):Si(f,c))}function zr(a){var c,f="";return a.hasChildNodes()&&(c=a.firstChild).nodeType===3&&(f=c.nodeValue),f}Nt.VERSION="1.2",Nt.NAMESPACES={xmlns:"http://www.opengis.net/xls",gml:"http://www.opengis.net/gml",xls:"http://www.opengis.net/xls",xlsext:"http://www.opengis.net/xlsext",xsi:"http://www.w3.org/2001/XMLSchema-instance"},Nt.SCHEMALOCATION="http://wxs.ign.fr/schemas/olsAll.xsd",Nt.DEFAULTPREFIX="xls",Nt.READERS={xls:{XLS:function(a){var c=new bo;return function(f){if(f.attributes.length>0){var v=function(L){if(L.attributes.length>0){for(var z={},B=L.attributes,dt=0;dt<B.length;dt++){var nt=B[dt];z[nt.nodeName]=nt.nodeValue}return z}}(f);for(var m in v)if(v.hasOwnProperty(m)){if(m==="version"&&v.version!==Nt.VERSION)return void console.log("[ReverseGeocodeResponseReader] geocode version is not the expected one : there may be errors in parsing");if(m==="xmlns"){if(v[m]!==Nt.NAMESPACES[Nt.DEFAULTPREFIX])return void console.log("[ReverseGeocodeResponseReader] geocode response default namespace is not the expected one");continue}var T=m.split(":")[0],O=m.split(":")[1];if(T==="xmlns"&&O&&Nt.NAMESPACES[O]&&Nt.NAMESPACES[O]!==v[m])return void console.log("[ReverseGeocodeResponseReader] geocode response "+m+" namespace is not the expected one");if(O==="schemaLocation"&&Nt.SCHEMALOCATION!==v[m])return void console.log("[ReverseGeocodeResponseReader] geocode response schema location is not the expected one")}}}(a),Si(a,c),c},ReverseGeocodedLocation:function(a,c){var f=new aa;Si(a,f),c&&Array.isArray(c.locations)&&c.locations.push(f)},Address:function(a,c){var f=a.getAttribute("countryCode");c&&f&&(c.type=f),Si(a,c)},Building:function(a,c){var f=a.getAttribute("number");c&&c.hasOwnProperty("placeAttributes")&&(f?c.placeAttributes.number=f:a.getAttribute("buildingName")?c.placeAttributes.number=a.getAttribute("buildingName"):a.getAttribute("subdivision")&&(c.placeAttributes.number=a.getAttribute("subdivision")))},Street:function(a,c){c.type==="StreetAddress"?c.placeAttributes.street=zr(a):c.type==="CadastralParcel"&&(c.placeAttributes.cadastralParcel=zr(a))},Place:function(a,c){var f=a.getAttribute("type"),v=zr(a);if(c&&c.hasOwnProperty("placeAttributes"))if(f==="Municipality")c.placeAttributes.municipality=v;else if(f==="Bbox"){var m=v.split(";");m.length===4&&(c.placeAttributes.bbox={left:parseFloat(m[0]),right:parseFloat(m[2]),top:parseFloat(m[1]),bottom:parseFloat(m[3])})}else f==="Commune"?c.placeAttributes.commune=v:f==="Departement"?c.placeAttributes.department=v:f==="INSEE"?c.placeAttributes.insee=v:f==="Qualite"?c.placeAttributes.quality=v:f==="Territoire"?c.placeAttributes.territory=v:f==="ID"?c.placeAttributes.ID=v:f==="ID_TR"?c.placeAttributes.IDTR=v:f==="Importance"?c.placeAttributes.importance=parseInt(v,10):f==="Nature"?c.placeAttributes.nature=v:f==="Numero"?c.placeAttributes.number=v:f==="Feuille"?c.placeAttributes.sheet=v:f==="Section"?c.placeAttributes.section=v:f==="CommuneAbsorbee"?c.placeAttributes.absorbedCity=v:f==="Arrondissement"?v&&(c.placeAttributes.arrondissement=v):f==="Type"?c.placeAttributes.origin=v:f==="Prefecture"?c.placeAttributes.prefecture=v:f==="InseeRegion"?c.placeAttributes.inseeRegion=v:f==="InseeDepartment"&&(c.placeAttributes.inseeDepartment=v)},PostalCode:function(a,c){c&&c.hasOwnProperty("placeAttributes")&&(c.placeAttributes.postalCode=zr(a))},SearchCentreDistance:function(a,c){c&&(c.searchCenterDistance=parseFloat(a.getAttribute("value")))},Error:function(a){var c=a.getAttribute("message"),f=a.getAttribute("errorCode"),v=h.getMessage("SERVICE_RESPONSE_EXCEPTION","("+f+") : "+c);throw new d({message:v,type:d.TYPE_SRVERR})}},gml:{pos:function(a,c){var f=zr(a);c&&f&&(c.position={x:parseFloat(f.split(" ")[0]),y:parseFloat(f.split(" ")[1])})}},xlsext:{ExtendedGeocodeMatchCode:function(a,c){c&&(c.matchType=zr(a))}},ExceptionReport:function(a){var c={};if(a.hasChildNodes())for(var f,v=a.childNodes,m=0;m<v.length;m++)(f=v[m]).nodeName==="Exception"&&(c.exceptionReport=Nt.READERS.Exception(f));return c},Exception:function(a){var c={},f=a.getAttribute("exceptionCode");f&&(c.exceptionCode=f);var v=a.firstChild;return v&&v.nodeType===3&&(c.exception=v.nodeValue),c}},Nt.read=function(a){if(a.nodeName==="XLS"){var c=a.prefix;return c||(c=Nt.DEFAULTPREFIX),Nt.READERS[c][a.nodeName](a)}if(a.nodeName==="ExceptionReport")return Nt.READERS[a.nodeName](a);throw new Error("Erreur lors de la lecture de la r\xE9ponse : elle n'est pas au format attendu.")};var mc=Nt,Ec={build:function(a){var c=null;if(a.response){if(a.rawResponse)c=a.response;else{try{var f=new pt({reader:mc});if(typeof a.response=="string"?f.setXMLString(a.response):f.setXMLDoc(a.response),!(c=f.parse()))throw new Error("L'analyse de la r\xE9ponse du service !?")}catch(O){return O.status=200,void a.onError.call(a.scope,O)}if(c.exceptionReport)return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",c.exceptionReport),type:d.TYPE_SRVERR,status:200}));var v,m;if(a.scope&&a.scope.options&&a.scope.options.srs&&a.scope.options.srs!=="EPSG:4326"&&c.locations)for(var T=0;T<c.locations.length;T++)(v=c.locations[T])&&(m=v.position)&&(v.position={x:m.y,y:m.x})}a.onSuccess.call(a.scope,c)}else a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EMPTY"),type:d.TYPE_SRVERR,status:-1}))}};function la(a){return(la=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}function Le(a){if(!(this instanceof Le))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));if(this.CLASSNAME="ReverseGeocode",A.apply(this,arguments),this.logger=u.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]"),!a.position)throw new Error(h.getMessage("PARAM_MISSING","position"));if(a.position.x===null)throw new Error(h.getMessage("PARAM_MISSING","position.x"));if(a.position.y===null)throw new Error(h.getMessage("PARAM_MISSING","position.y"));this.options.position=a.position,a.filterOptions&&la(a.filterOptions)==="object"||(this.options.filterOptions=a.filterOptions={type:["StreetAddress"]}),Object.keys(a.filterOptions).length===0&&(this.options.filterOptions={type:["StreetAddress"]});for(var c=Object.keys(a.filterOptions),f=0;f<c.length;f++){var v=c[f];a.filterOptions[v]&&Object.keys(a.filterOptions[v]).length!==0||delete this.options.filterOptions[v]}if(this.options.filterOptions.type=a.filterOptions.type||["StreetAddress"],!Array.isArray(this.options.filterOptions.type))throw new Error(h.getMessage("PARAM_TYPE","filterOptions.type"));if(this.options.maximumResponses=a.maximumResponses||25,this.options.returnFreeForm=a.returnFreeForm||!1,this.options.srs=a.srs||"CRS:84",Le.geoEPSG.indexOf(this.options.srs)===-1){if(this.options.position={x:this.options.position.y,y:this.options.position.x},this.options.filterOptions&&this.options.filterOptions.circle){var m=this.options.filterOptions.circle;this.options.filterOptions.circle={x:m.y,y:m.x,radius:m.radius}}if(this.options.filterOptions&&this.options.filterOptions.polygon){var T=this.options.filterOptions.polygon;for(f=0;f<T.length;f++){var O=T[f];this.options.filterOptions.polygon[f]={x:O.y,y:O.x}}}}this.options.outputFormat=this.options.rawResponse?"":"xml"}Le.prototype=Object.create(A.prototype,{}),Le.prototype.constructor=Le,Le.prototype.buildRequest=function(a,c){var f={httpMethod:this.options.httpMethod,position:this.options.position,returnFreeForm:this.options.returnFreeForm,filterOptions:this.options.filterOptions,srs:"EPSG:4326",maximumResponses:this.options.maximumResponses};this.request=yc.build(f),this.request?c.call(this,this.request):a.call(this,new d(h.getMessage("SERVICE_REQUEST_BUILD")))},Le.prototype.analyzeResponse=function(a,c){if(this.response){var f={response:this.response,rawResponse:this.options.rawResponse,onError:a,onSuccess:c,scope:this};Ec.build(f)}else a.call(this,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))},Le.geoEPSG=["EPSG:4326"];var wc=Le;function xi(){if(!(this instanceof xi))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}xi.prototype={constructor:xi};var ua=xi;function Ci(){if(!(this instanceof Ci))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}Ci.prototype={constructor:Ci};var ca=Ci,Tc={build:function(a){var c=u.getLogger("AutoCompleteResponseFactory");c.trace(["AutoCompleteResponseFactory::build()"]);var f=null;if(a.response){if(a.rawResponse)c.trace("analyze response : raw"),f=a.response;else{var v=null;if(v=typeof a.response=="string"?JSON.parse(a.response):a.response){if(v.error)return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",v.error.description),status:v.error.code,type:d.TYPE_SRVERR}));if(f=new ua,!v.results||!Array.isArray(v.results))return void a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var m=null,T=0;T<v.results.length;T++){var O=v.results[T];m=new ca,O&&(O.country==="StreetAddress"?(m.street=O.street,m.type="StreetAddress"):O.country==="PositionOfInterest"&&(m.poi=O.street,m.kind=O.kind,m.type="PositionOfInterest"),m.position&&(m.position.x=O.x,m.position.y=O.y),m.commune=O.city,m.fullText=O.fulltext,m.postalCode=O.zipcode,m.classification=O.classification),f.suggestedLocations.push(m)}if(!f.suggestedLocations.length)return void a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!f)return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:d.TYPE_UNKERR,status:-1}));if(f.exceptionReport)return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",f.exceptionReport),type:d.TYPE_SRVERR,status:200}))}a.onSuccess.call(a.scope,f)}else a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))}};function ha(a){return(ha=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}function mr(a){if(!(this instanceof mr))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));if(this.CLASSNAME="AutoComplete",A.apply(this,arguments),this.logger=u.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]"),!a.text)throw new Error(h.getMessage("PARAM_MISSING","text"));this.options.text=a.text,a.filterOptions&&ha(a.filterOptions)==="object"||(this.options.filterOptions=a.filterOptions={territory:[],type:["StreetAddress"]}),Object.keys(a.filterOptions).length===0&&(this.options.filterOptions={territory:[],type:["StreetAddress"]}),this.options.filterOptions.type=a.filterOptions.type||["StreetAddress"],this.options.filterOptions.territory=a.filterOptions.territory||[],this.options.maximumResponses=a.maximumResponses||10,this.options.protocol==="XHR"&&this.options.httpMethod==="POST"&&(this.logger.warn("Le service ne g\xE9re pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}mr.prototype=Object.create(A.prototype,{}),mr.prototype.constructor=mr,mr.prototype.buildRequest=function(a,c){var f="";this.options.filterOptions.territory&&(f=this.options.filterOptions.territory.join(";"));var v="";this.options.filterOptions.type&&(v=this.options.filterOptions.type.join(",")),this.request=g.normalyzeParameters({text:encodeURIComponent(this.options.text),type:v,terr:f,maximumResponses:this.options.maximumResponses}),this.request?c.call(this,this.request):a.call(this,new d(h.getMessage("SERVICE_REQUEST_BUILD")))},mr.prototype.analyzeResponse=function(a,c){if(this.response){var f={response:this.response,rawResponse:this.options.rawResponse,onSuccess:c,onError:a,scope:this};Tc.build(f)}else a.call(this,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var Rc=mr;function qr(a){if(!(this instanceof qr))throw new TypeError("RouteParamREST constructor cannot be called as a function.");this.logger=u.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=a||{},this.resource=this.options.resource,this.start=this.options.startPoint.x+","+this.options.startPoint.y,this.end=this.options.endPoint.x+","+this.options.endPoint.y,this.intermediates=this.options.viaPoints,this.profile=this.options.graph,this.crs=this.options.srs,this.constraints=this.options.constraints,this.optimization=this.options.routePreference,this.getSteps=this.options.geometryInInstructions?"true":"false",this.distanceUnit=this.options.distanceUnit,this.timeUnit=this.options.timeUnit,this.waysAttributes=this.options.waysAttributes}qr.CLASSNAME="RouteParamREST",qr.prototype={constructor:qr,getIntermediates:function(){var a=[];if(this.intermediates.length!==0)for(var c=0;c<this.intermediates.length;c++){var f=this.intermediates[c];a.push(f.x+","+f.y)}return a.join("|")},getWaysAttributes:function(){return this.waysAttributes.join("|")},getProfile:function(){return this.profile},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getOptimization:function(){return this.optimization?this.optimization:""},getConstraints:function(){var a=[];if(this.constraints.length!==0)for(var c=0;c<this.constraints.length;c++)a.push(JSON.stringify(this.constraints[c]));return a.join("|")}},qr.prototype.getParams=function(){var a=[];return a.push({k:"resource",v:this.resource}),a.push({k:"start",v:this.start}),a.push({k:"end",v:this.end}),a.push({k:"geometryFormat",v:"geojson"}),this.optimization&&a.push({k:"optimization",v:this.getOptimization()}),this.intermediates&&a.push({k:"intermediates",v:this.getIntermediates()}),this.profile&&a.push({k:"profile",v:this.getProfile()}),this.constraints&&a.push({k:"constraints",v:this.getConstraints()}),this.crs&&a.push({k:"crs",v:this.crs}),this.distanceUnit&&a.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.timeUnit&&a.push({k:"timeUnit",v:this.timeUnit}),this.waysAttributes&&a.push({k:"waysAttributes",v:this.getWaysAttributes()}),a};var Sc=qr;function Oi(a){if(this.logger=u.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof Oi))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!a)throw new Error(h.getMessage("PARAM_EMPTY","options"));this.settings=a}Oi.prototype={requestString:null,constructor:Oi,processRequestString:function(){this.logger.warn(" PROTOTYPE !");for(var a=new Sc(this.settings).getParams(),c="",f=0;f<a.length;f++){var v=a[f];c&&(c+="&"),c+=v.k+"="+v.v}return this.logger.trace(c),this.requestString=c,this.requestString}};var xc=Oi,Cc={build:function(a){u.getLogger("RouteRequestFactory").trace(["RouteRequestFactory::build()"]);var c=a||{},f=!(a.onError===null||typeof a.onError!="function"),v=null,m=new xc(c);if(!m.processRequestString()){if(v="Error process request (rest) !",f)return void a.onError.call(a.scope,new d(v));throw new Error(v)}return m.requestString}};function Ii(){if(!(this instanceof Ii))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}Ii.prototype={constructor:Ii};var fa=Ii;function Ai(){if(!(this instanceof Ai))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}Ai.prototype={constructor:Ai};var pa=Ai,Oc={build:function(a){var c=u.getLogger("RouteResponseFactory");c.trace("RouteResponseFactory::build()");var f=null;if(a.response){if(a.rawResponse)c.trace("analyze response : raw"),f=a.response;else{var v;if(c.trace("analyze response : json"),v=typeof a.response=="string"?JSON.parse(a.response):a.response){if(v.message)return void a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_EXCEPTION",v.message)));var m=[],T=[],O=[];if((f=new fa).hasOwnProperty("totalTime")&&(f.totalTime=parseFloat(v.duration)),f.hasOwnProperty("totalDistance")&&(f.totalDistance=parseFloat(v.distance)),f.hasOwnProperty("bbox")&&(f.bbox.left=parseFloat(v.bbox[0]),f.bbox.bottom=parseFloat(v.bbox[1]),f.bbox.right=parseFloat(v.bbox[2]),f.bbox.top=parseFloat(v.bbox[3])),f.hasOwnProperty("routeGeometry")&&!a.geometryInInstructions&&(f.routeGeometry=v.geometry),f.hasOwnProperty("routeInstructions")&&a.geometryInInstructions){var L,z=v.portions;if(Array.isArray(z)&&z.length)for(L=0;L<z.length;L++)m.push(z[L]);if(m.length)for(L=0;L<m.length;L++)T.push(m[L].steps);if(T.length)for(L=0;L<T.length;L++)O=O.concat(T[L]);O.forEach(function(B){switch(f.routeInstructions.push(new pa),f.routeInstructions[f.routeInstructions.length-1].duration=B.duration,f.routeInstructions[f.routeInstructions.length-1].distance=B.distance,f.routeInstructions[f.routeInstructions.length-1].code="",f.routeInstructions[f.routeInstructions.length-1].instruction="",f.routeInstructions[f.routeInstructions.length-1].geometry=B.geometry,B.name==="Valeur non renseign\xE9e"&&(B.name=""),B.instruction.type){case"turn":f.routeInstructions[f.routeInstructions.length-1].instruction+="Tourner";break;case"new name":f.routeInstructions[f.routeInstructions.length-1].instruction+="Continuer tout droit";break;case"depart":f.routeInstructions[f.routeInstructions.length-1].instruction+="D\xE9part";break;case"arrive":f.routeInstructions[f.routeInstructions.length-1].instruction+="Arriv\xE9e";break;case"merge":f.routeInstructions[f.routeInstructions.length-1].instruction+="Rejoindre";break;case"ramp":case"on ramp":f.routeInstructions[f.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"off ramp":f.routeInstructions[f.routeInstructions.length-1].instruction+="Prendre la sortie";break;case"fork":f.routeInstructions[f.routeInstructions.length-1].instruction+="Sur la bifurcation, prendre";break;case"end of road":f.routeInstructions[f.routeInstructions.length-1].instruction+="\xC0 la fin de la route, prendre";break;case"use lane":f.routeInstructions[f.routeInstructions.length-1].instruction+="Utiliser la file";break;case"continue":f.routeInstructions[f.routeInstructions.length-1].instruction+="Continuer";break;case"roundabout":case"rotary":f.routeInstructions[f.routeInstructions.length-1].instruction+="Au rond-point";break;case"roundabout turn":f.routeInstructions[f.routeInstructions.length-1].instruction+="Au rond point, tourner";break;case"notification":f.routeInstructions[f.routeInstructions.length-1].instruction+="";break;default:f.routeInstructions[f.routeInstructions.length-1].instruction+="?"+B.instruction.type+"?"}if(B.instruction.modifier)switch(B.instruction.modifier){case"uturn":f.routeInstructions[f.routeInstructions.length-1].instruction="Faire demi-tour";break;case"sharp right":f.routeInstructions[f.routeInstructions.length-1].instruction+=" compl\xE8tement \xE0 droite";break;case"right":f.routeInstructions[f.routeInstructions.length-1].instruction+=" \xE0 droite";break;case"slight right":f.routeInstructions[f.routeInstructions.length-1].instruction+=" l\xE9g\xE8rement \xE0 droite";break;case"straight":f.routeInstructions[f.routeInstructions.length-1].instruction="Continuer tout droit";break;case"slight left":f.routeInstructions[f.routeInstructions.length-1].instruction+=" l\xE8g\xE8rement \xE0 gauche";break;case"left":f.routeInstructions[f.routeInstructions.length-1].instruction+=" \xE0 gauche";break;case"sharp left":f.routeInstructions[f.routeInstructions.length-1].instruction+=" compl\xE8tement \xE0 gauche";break;default:f.routeInstructions[f.routeInstructions.length-1].instruction+=" ?"+B.instruction.modifier+"?"}B.instruction.exit&&(f.routeInstructions[f.routeInstructions.length-1].instruction+="".concat(B.instruction.exit,"e sortie")),B.attributes.name&&((B.attributes.name.nom_1_droite||B.attributes.name.toponyme)&&(f.routeInstructions[f.routeInstructions.length-1].instruction+=" sur"),B.attributes.name.nom_1_droite&&(f.routeInstructions[f.routeInstructions.length-1].instruction+=" ".concat(B.attributes.name.nom_1_droite)),B.attributes.name.toponyme&&(f.routeInstructions[f.routeInstructions.length-1].instruction+=" ".concat(B.attributes.name.toponyme)))})}}if(!f)return void a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_ANALYSE","json")));if(f.exceptionReport)return void a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_EXCEPTION_2")))}a.onSuccess.call(a.scope,f)}else a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))}};function Er(a){if(!(this instanceof Er))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",A.apply(this,arguments),this.logger=u.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!a.startPoint)throw new Error(h.getMessage("PARAM_MISSING","startPoint"));if(a.startPoint.x===null)throw new Error(h.getMessage("PARAM_MISSING","startPoint.x"));if(a.startPoint.y===null)throw new Error(h.getMessage("PARAM_MISSING","startPoint.y"));if(!a.endPoint)throw new Error(h.getMessage("PARAM_MISSING","endPoint"));if(a.endPoint.x===null)throw new Error(h.getMessage("PARAM_MISSING","endPoint.x"));if(a.endPoint.y===null)throw new Error(h.getMessage("PARAM_MISSING","endPoint.y"));if(a.outputFormat&&a.outputFormat!=="json"&&this.logger.warn("options.outputFormat could only be json"),this.options.outputFormat="json",this.options.resource=a.resource||"bdtopo-osrm",this.options.startPoint=a.startPoint,this.options.endPoint=a.endPoint,this.options.viaPoints=a.viaPoints||[],this.options.routePreference=a.routePreference||"fastest",a.graph?(a.graph==="Voiture"&&(this.options.graph="car"),a.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],a.constraints){if(!Array.isArray(a.constraints))throw new Error(h.getMessage("PARAM_TYPE","constraints"));for(var c=0;c<a.constraints.length;c++)this.options.constraints.push(a.constraints[c])}var f={},v={},m={};if(a.exclusions&&a.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var T=0;T<a.exclusions.length;T++)typeof a.exclusions[T]=="string"&&(a.exclusions[T]=a.exclusions[T].toLowerCase(),a.exclusions[T]==="toll"&&(m.constraintType="banned",m.key="wayType",m.operator="=",m.value="autoroute",this.options.constraints.push(m)),a.exclusions[T]==="tunnel"&&(f.constraintType="banned",f.key="wayType",f.operator="=",f.value="tunnel",this.options.constraints.push(f)),a.exclusions[T]==="bridge"&&(v.constraintType="banned",v.key="wayType",v.operator="=",v.value="pont",this.options.constraints.push(v)))}if(this.options.geometryInInstructions=a.geometryInInstructions||!1,this.options.provideBbox=a.provideBbox||!0,this.options.distanceUnit=a.distanceUnit||"m",this.options.timeUnit=a.timeUnit||"second",this.options.expectedStartTime=null,this.options.srs=a.srs||"EPSG:4326",this.options.waysAttributes=a.waysAttributes||[],!this.options.serverUrl){var O=I.Route.url(this.options.apiKey);if(!O)throw new Error("Url by default not found !");this.options.serverUrl=O,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}Er.prototype=Object.create(A.prototype,{}),Er.prototype.constructor=Er,Er.prototype.buildRequest=function(a,c){var f={resource:this.options.resource,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,constraints:this.options.constraints,distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs,waysAttributes:this.options.waysAttributes};this.request=Cc.build(f),this.request?c.call(this,this.request):a.call(this,new d(h.getMessage("SERVICE_REQUEST_BUILD")))},Er.prototype.analyzeResponse=function(a,c){if(this.response){var f={distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:a,onSuccess:c,scope:this,geometryInInstructions:this.options.geometryInInstructions};Oc.build(f)}else a.call(this,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var Ic=Er;function Kr(a){if(!(this instanceof Kr))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");this.logger=u.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam ()]"),this.options=a||{},this.id=this.options.id,this.resource=this.options.resource,this.point=this.options.position,this.crs=this.options.srs,this.profile=this.options.graph,this.constraints=this.options.constraints,this.reverse=this.options.reverse,this.timeUnit=this.options.timeUnit,this.distanceUnit=this.options.distanceUnit,this.options.method==="distance"?(this.costType="distance",this.costValue=this.options.distance):(this.costType="time",this.costValue=this.options.time)}Kr.CLASSNAME="ProcessIsoCurveParam",Kr.prototype={constructor:Kr,getLocation:function(){return this.point.x+","+this.point.y},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getConstraints:function(){var a=[];if(this.constraints.length!==0)for(var c=0;c<this.constraints.length;c++)a.push(JSON.stringify(this.constraints[c]));return a.join("|")},getDirection:function(){return this.reverse?"arrival":"departure"}},Kr.prototype.getParams=function(){var a=[];return a.push({k:"resource",v:this.resource}),a.push({k:"point",v:this.getLocation()}),a.push({k:"direction",v:this.getDirection()}),a.push({k:"costType",v:this.costType}),a.push({k:"costValue",v:this.costValue}),a.push({k:"profile",v:this.profile}),a.push({k:"timeUnit",v:this.timeUnit}),a.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.crs&&a.push({k:"crs",v:this.crs}),this.constraints&&a.push({k:"constraints",v:this.getConstraints()}),a};var Ac=Kr;function Pi(a){if(this.logger=u.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest ()]"),!(this instanceof Pi))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!a)throw new Error(h.getMessage("PARAM_EMPTY","options"));this.settings=a,this.mode=this.settings.httpMethod||"GET"}Pi.prototype={requestString:null,constructor:Pi,processRequestString:function(){var a="",c=0;switch(this.mode){case"GET":this.logger.trace("Process GET Request");var f=new Ac(this.settings).getParams();for(c=0;c<f.length;c++){var v=f[c];a&&(a+="&"),a+=v.k+"="+v.v}break;case"POST":this.logger.trace("Process POST Request");var m={};m.resource=this.settings.resource,m.point=this.settings.position.x+","+this.settings.position.y,this.settings.method==="distance"?(m.costType="distance",m.costValue=this.settings.distance):(m.costType="time",m.costValue=this.settings.time),m.profile=this.settings.graph,this.settings.reverse?m.direction="arrival":m.direction="departure",m.constraints=this.settings.constraints,m.distanceUnit=this.settings.distanceUnit,m.timeUnit=this.settings.timeUnit,m.crs=this.settings.srs,a=JSON.stringify(m);break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(a),this.requestString=a,this.requestString}};var Pc=Pi;function bi(){if(!(this instanceof bi))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}bi.prototype={constructor:bi};var da=bi,bc={build:function(a){var c=u.getLogger("ProcessIsoCurveResponseFactory");c.trace(["ProcessIsoCurveResponseFactory::build()"]);var f=null;if(a.response){if(a.rawResponse)c.trace("analyze response : raw"),f=a.response;else{var v;if(c.trace("analyze response : json"),v=typeof a.response=="string"?JSON.parse(a.response):a.response,f=new da,!v)return void a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_ANALYSE",a.response)));v.costType==="distance"?(f.time="",f.distance=v.costValue):(f.time=v.costValue,f.distance=""),f.message="",f.id="",f.srs=v.crs,f.geometry=v.geometry;var m=v.point.split(",");if(f.location&&(f.location.x=m[0],f.location.y=m[1]),f.exceptionReport)return void a.onError.call(a.scope,new d({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",f.exceptionReport),type:d.TYPE_SRVERR,status:200}))}a.onSuccess.call(a.scope,f)}else a.onError.call(a.scope,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))}};function wr(a){if(!(this instanceof wr))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",A.apply(this,arguments),this.logger=u.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve (options)]"),!a.position)throw new Error(h.getMessage("PARAM_MISSING","position"));if(a.position.x===null)throw new Error(h.getMessage("PARAM_MISSING","position.x"));if(a.position.y===null)throw new Error(h.getMessage("PARAM_MISSING","position.y"));if(!a.time&&!a.distance)throw new Error("Parameter (s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!a.time&&a.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),a.time&&!a.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",this.options.resource=a.resource||"bdtopo-iso",this.options.exclusions=a.exclusions||[],this.options.reverse=a.reverse||!1,this.options.srs=a.srs||"EPSG:4326",this.options.distanceUnit=a.distanceUnit||"m",this.options.timeUnit=a.timeUnit||"second",a.smoothing&&this.logger.warn("options.smoothing is DEPRECATED"),this.options.smoothing=!1,a.holes&&this.logger.warn("options.holes is DEPRECATED"),this.options.holes=!1,a.graph?(a.graph==="Voiture"&&(this.options.graph="car"),a.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],a.constraints){if(!Array.isArray(a.constraints))throw new Error(h.getMessage("PARAM_TYPE","constraints"));for(var c=0;c<a.constraints.length;c++)this.options.constraints.push(a.constraints[c])}var f={},v={},m={};if(a.exclusions&&a.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var T=0;T<a.exclusions.length;T++)typeof a.exclusions[T]=="string"&&(a.exclusions[T]=a.exclusions[T].toLowerCase(),a.exclusions[T]==="toll"&&(m.constraintType="banned",m.key="wayType",m.operator="=",m.value="autoroute",this.options.constraints.push(m)),a.exclusions[T]==="tunnel"&&(f.constraintType="banned",f.key="wayType",f.operator="=",f.value="tunnel",this.options.constraints.push(f)),a.exclusions[T]==="bridge"&&(v.constraintType="banned",v.key="wayType",v.operator="=",v.value="pont",this.options.constraints.push(v)))}if(this.options.outputFormat=typeof a.outputFormat=="string"?a.outputFormat.toLowerCase():"json",a.outputFormat&&a.outputFormat!=="json")throw new Error(h.getMessage("PARAM_NOT_SUPPORT","outputFormat"));if(this.options.outputFormat="json",!this.options.serverUrl){var O=I.ProcessIsoCurve.url(this.options.apiKey);if(!O)throw new Error("Url by default not found !");this.options.serverUrl=O,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}wr.prototype=Object.create(A.prototype,{}),wr.prototype.constructor=wr,wr.prototype.buildRequest=function(a,c){try{var f=new Pc(this.options);if(!f.processRequestString())throw new Error(h.getMessage("SERVICE_REQUEST_BUILD"));this.request=f.requestString}catch(v){return void a.call(this,new d(v.message))}c.call(this,this.request)},wr.prototype.analyzeResponse=function(a,c){if(this.response){var f={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:c,onError:a,scope:this};bc.build(f)}else a.call(this,new d(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var Lc=wr,Mc={getConfig:function(a){new dr(a).call()},getAltitude:function(a){new H(a).call()},geocode:function(a){new _c(a).call()},reverseGeocode:function(a){new wc(a).call()},autoComplete:function(a){new Rc(a).call()},route:function(a){new Ic(a).call()},isoCurve:function(a){new Lc(a).call()}},ga=b.version,va=b.date,ct={};ct.servicesVersion=ga,ct.servicesDate=va,ct.Protocols={},ct.Protocols.XHR=C,ct.Services=Mc,ct.Services.DefaultUrl=I,ct.Services.AltiResponse=vt,ct.Services.Alti={},ct.Services.Alti.Elevation=Lt,ct.Services.AutoCompleteResponse=ua,ct.Services.AutoComplete={},ct.Services.AutoComplete.SuggestedLocation=ca,ct.Services.GetConfigResponse=yt,ct.Services.Config={},ct.Services.Config.Constraint=St,ct.Services.Config.Format=ie,ct.Services.Config.Layer=Ae,ct.Services.Config.Legend=de,ct.Services.Config.Metadata=jr,ct.Services.Config.Originator=Be,ct.Services.Config.Service=Zt,ct.Services.Config.Style=We,ct.Services.Config.Territory=hr,ct.Services.Config.Thematic=Ee,ct.Services.Config.TileMatrix=$r,ct.Services.Config.TileMatrixLimit=vi,ct.Services.Config.TileMatrixSet=xn,ct.Services.GeocodeResponse=bo,ct.Services.Geocode={},ct.Services.Geocode.GeocodedLocation=Mn,ct.Services.Geocode.DirectGeocodedLocation=sa,ct.Services.Geocode.ReverseGeocodedLocation=aa,ct.Services.IsoCurveResponse=da,ct.Services.RouteResponse=fa,ct.Services.Route={},ct.Services.Route.RouteInstruction=pa,ct.Error=d,ct.Helper=g,o.default=ct}]).default})})(go);const rs=(i,r,t,e=!1)=>{let n=[];return window.$barry.calculateToll||n.push("toll"),new Promise(o=>{go.exports.Services.route({startPoint:{x:i[0],y:i[1]},endPoint:{x:r[0],y:r[1]},graph:window.$barry.calculateTransport,exclusions:n,routePreference:window.$barry.calculateMode=="time"?"fastest":"shortest",geometryInInstructions:e,apiKey:"calcul",onSuccess:s=>{s.key=t,o(s)},onFailure:s=>{alert(s)}})})};var mt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Ia(i){return i[0]>0&&i[1]>0}function ch(i,r,t){return t===void 0&&(t=[0,0]),t[0]=i[0]*r+.5|0,t[1]=i[1]*r+.5|0,t}function ye(i,r){return Array.isArray(i)?i:(r===void 0?r=[i,i]:(r[0]=i,r[1]=i),r)}var hh=function(){function i(r){this.opacity_=r.opacity,this.rotateWithView_=r.rotateWithView,this.rotation_=r.rotation,this.scale_=r.scale,this.scaleArray_=ye(r.scale),this.displacement_=r.displacement}return i.prototype.clone=function(){var r=this.getScale();return new i({opacity:this.getOpacity(),scale:Array.isArray(r)?r.slice():r,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()})},i.prototype.getOpacity=function(){return this.opacity_},i.prototype.getRotateWithView=function(){return this.rotateWithView_},i.prototype.getRotation=function(){return this.rotation_},i.prototype.getScale=function(){return this.scale_},i.prototype.getScaleArray=function(){return this.scaleArray_},i.prototype.getDisplacement=function(){return this.displacement_},i.prototype.getAnchor=function(){return J()},i.prototype.getImage=function(r){return J()},i.prototype.getHitDetectionImage=function(){return J()},i.prototype.getPixelRatio=function(r){return 1},i.prototype.getImageState=function(){return J()},i.prototype.getImageSize=function(){return J()},i.prototype.getOrigin=function(){return J()},i.prototype.getSize=function(){return J()},i.prototype.setDisplacement=function(r){this.displacement_=r},i.prototype.setOpacity=function(r){this.opacity_=r},i.prototype.setRotateWithView=function(r){this.rotateWithView_=r},i.prototype.setRotation=function(r){this.rotation_=r},i.prototype.setScale=function(r){this.scale_=r,this.scaleArray_=ye(r)},i.prototype.listenImageChange=function(r){J()},i.prototype.load=function(){J()},i.prototype.unlistenImageChange=function(r){J()},i}(),Wl=hh;function Gt(i,r,t){return Math.min(Math.max(i,r),t)}var fh=function(){var i;return"cosh"in Math?i=Math.cosh:i=function(r){var t=Math.exp(r);return(t+1/t)/2},i}(),ph=function(){var i;return"log2"in Math?i=Math.log2:i=function(r){return Math.log(r)*Math.LOG2E},i}();function dh(i,r,t,e,n,o){var s=n-t,l=o-e;if(s!==0||l!==0){var u=((i-t)*s+(r-e)*l)/(s*s+l*l);u>1?(t=n,e=o):u>0&&(t+=s*u,e+=l*u)}return Pr(i,r,t,e)}function Pr(i,r,t,e){var n=t-i,o=e-r;return n*n+o*o}function gh(i){for(var r=i.length,t=0;t<r;t++){for(var e=t,n=Math.abs(i[t][t]),o=t+1;o<r;o++){var s=Math.abs(i[o][t]);s>n&&(n=s,e=o)}if(n===0)return null;var l=i[e];i[e]=i[t],i[t]=l;for(var u=t+1;u<r;u++)for(var h=-i[u][t]/i[t][t],p=t;p<r+1;p++)t==p?i[u][p]=0:i[u][p]+=h*i[t][p]}for(var d=new Array(r),g=r-1;g>=0;g--){d[g]=i[g][r]/i[g][g];for(var _=g-1;_>=0;_--)i[_][r]-=i[_][g]*d[g]}return d}function qi(i){return i*Math.PI/180}function fn(i,r){var t=i%r;return t*r<0?t+r:t}function ke(i,r,t){return i+t*(r-i)}function zl(i,r){var t=Math.pow(10,r);return Math.round(i*t)/t}function Di(i,r){return Math.floor(zl(i,r))}function Fi(i,r){return Math.ceil(zl(i,r))}var vh=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,_h=/^([a-z]*)$|^hsla?\(.*\)$/i;function ql(i){return typeof i=="string"?i:Kl(i)}function yh(i){var r=document.createElement("div");if(r.style.color=i,r.style.color!==""){document.body.appendChild(r);var t=getComputedStyle(r).color;return document.body.removeChild(r),t}else return""}var mh=function(){var i=1024,r={},t=0;return function(e){var n;if(r.hasOwnProperty(e))n=r[e];else{if(t>=i){var o=0;for(var s in r)(o++&3)===0&&(delete r[s],--t)}n=Eh(e),r[e]=n,++t}return n}}();function Qi(i){return Array.isArray(i)?i:mh(i)}function Eh(i){var r,t,e,n,o;if(_h.exec(i)&&(i=yh(i)),vh.exec(i)){var s=i.length-1,l=void 0;s<=4?l=1:l=2;var u=s===4||s===8;r=parseInt(i.substr(1+0*l,l),16),t=parseInt(i.substr(1+1*l,l),16),e=parseInt(i.substr(1+2*l,l),16),u?n=parseInt(i.substr(1+3*l,l),16):n=255,l==1&&(r=(r<<4)+r,t=(t<<4)+t,e=(e<<4)+e,u&&(n=(n<<4)+n)),o=[r,t,e,n/255]}else i.indexOf("rgba(")==0?(o=i.slice(5,-1).split(",").map(Number),Aa(o)):i.indexOf("rgb(")==0?(o=i.slice(4,-1).split(",").map(Number),o.push(1),Aa(o)):ht(!1,14);return o}function Aa(i){return i[0]=Gt(i[0]+.5|0,0,255),i[1]=Gt(i[1]+.5|0,0,255),i[2]=Gt(i[2]+.5|0,0,255),i[3]=Gt(i[3],0,1),i}function Kl(i){var r=i[0];r!=(r|0)&&(r=r+.5|0);var t=i[1];t!=(t|0)&&(t=t+.5|0);var e=i[2];e!=(e|0)&&(e=e+.5|0);var n=i[3]===void 0?1:Math.round(i[3]*100)/100;return"rgba("+r+","+t+","+e+","+n+")"}function Se(i){return Array.isArray(i)?Kl(i):i}var cr=typeof navigator!="undefined"&&typeof navigator.userAgent!="undefined"?navigator.userAgent.toLowerCase():"",wh=cr.indexOf("firefox")!==-1,Th=cr.indexOf("safari")!==-1&&cr.indexOf("chrom")==-1;Th&&(cr.indexOf("version/15.4")>=0||cr.match(/cpu (os|iphone os) 15_4 like mac os x/));var Rh=cr.indexOf("webkit")!==-1&&cr.indexOf("edge")==-1,Sh=cr.indexOf("macintosh")!==-1,Hl=typeof devicePixelRatio!="undefined"?devicePixelRatio:1,Eo=typeof WorkerGlobalScope!="undefined"&&typeof OffscreenCanvas!="undefined"&&self instanceof WorkerGlobalScope,xh=typeof Image!="undefined"&&Image.prototype.decode,Zl=function(){var i=!1;try{var r=Object.defineProperty({},"passive",{get:function(){i=!0}});window.addEventListener("_",null,r),window.removeEventListener("_",null,r)}catch{}return i}();function he(i,r,t,e){var n;return t&&t.length?n=t.shift():Eo?n=new OffscreenCanvas(i||300,r||300):n=document.createElement("canvas"),i&&(n.width=i),r&&(n.height=r),n.getContext("2d",e)}function Pa(i,r){var t=r.parentNode;t&&t.replaceChild(i,r)}function ns(i){return i&&i.parentNode?i.parentNode.removeChild(i):null}function Ch(i){for(;i.lastChild;)i.removeChild(i.lastChild)}function Oh(i,r){for(var t=i.childNodes,e=0;;++e){var n=t[e],o=r[e];if(!n&&!o)break;if(n!==o){if(!n){i.appendChild(o);continue}if(!o){i.removeChild(n),--e;continue}i.insertBefore(o,n)}}}var Ih=function(){function i(r){this.propagationStopped,this.defaultPrevented,this.type=r,this.target=null}return i.prototype.preventDefault=function(){this.defaultPrevented=!0},i.prototype.stopPropagation=function(){this.propagationStopped=!0},i}(),Ve=Ih,mn={PROPERTYCHANGE:"propertychange"},Ah=function(){function i(){this.disposed=!1}return i.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.disposeInternal())},i.prototype.disposeInternal=function(){},i}(),bs=Ah;function Ph(i,r,t){for(var e,n,o=t||Mr,s=0,l=i.length,u=!1;s<l;)e=s+(l-s>>1),n=+o(i[e],r),n<0?s=e+1:(l=e,u=!n);return u?s:~s}function Mr(i,r){return i>r?1:i<r?-1:0}function Ls(i,r,t){var e=i.length;if(i[0]<=r)return 0;if(r<=i[e-1])return e-1;var n=void 0;if(t>0){for(n=1;n<e;++n)if(i[n]<r)return n-1}else if(t<0){for(n=1;n<e;++n)if(i[n]<=r)return n}else for(n=1;n<e;++n){if(i[n]==r)return n;if(i[n]<r)return typeof t=="function"?t(r,i[n-1],i[n])>0?n-1:n:i[n-1]-r<r-i[n]?n-1:n}return e-1}function bh(i,r,t){for(;r<t;){var e=i[r];i[r]=i[t],i[t]=e,++r,--t}}function Ue(i,r){for(var t=Array.isArray(r)?r:[r],e=t.length,n=0;n<e;n++)i[i.length]=t[n]}function kr(i,r){var t=i.length;if(t!==r.length)return!1;for(var e=0;e<t;e++)if(i[e]!==r[e])return!1;return!0}function Lh(i,r,t){var e=r||Mr;return i.every(function(n,o){if(o===0)return!0;var s=e(i[o-1],n);return!(s>0||t&&s===0)})}function pn(){return!0}function wo(){return!1}function Nr(){}function Mh(i){var r=!1,t,e,n;return function(){var o=Array.prototype.slice.call(arguments);return(!r||this!==n||!kr(o,e))&&(r=!0,n=this,e=o,t=i.apply(this,arguments)),t}}var Ft=typeof Object.assign=="function"?Object.assign:function(i,r){if(i==null)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(i),e=1,n=arguments.length;e<n;++e){var o=arguments[e];if(o!=null)for(var s in o)o.hasOwnProperty(s)&&(t[s]=o[s])}return t};function ci(i){for(var r in i)delete i[r]}var Jl=typeof Object.values=="function"?Object.values:function(i){var r=[];for(var t in i)r.push(i[t]);return r};function En(i){var r;for(r in i)return!1;return!r}var Nh=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Dh=function(i){Nh(r,i);function r(t){var e=i.call(this)||this;return e.eventTarget_=t,e.pendingRemovals_=null,e.dispatching_=null,e.listeners_=null,e}return r.prototype.addEventListener=function(t,e){if(!(!t||!e)){var n=this.listeners_||(this.listeners_={}),o=n[t]||(n[t]=[]);o.indexOf(e)===-1&&o.push(e)}},r.prototype.dispatchEvent=function(t){var e=typeof t=="string",n=e?t:t.type,o=this.listeners_&&this.listeners_[n];if(!!o){var s=e?new Ve(t):t;s.target||(s.target=this.eventTarget_||this);var l=this.dispatching_||(this.dispatching_={}),u=this.pendingRemovals_||(this.pendingRemovals_={});n in l||(l[n]=0,u[n]=0),++l[n];for(var h,p=0,d=o.length;p<d;++p)if("handleEvent"in o[p]?h=o[p].handleEvent(s):h=o[p].call(this,s),h===!1||s.propagationStopped){h=!1;break}if(--l[n]===0){var g=u[n];for(delete u[n];g--;)this.removeEventListener(n,Nr);delete l[n]}return h}},r.prototype.disposeInternal=function(){this.listeners_&&ci(this.listeners_)},r.prototype.getListeners=function(t){return this.listeners_&&this.listeners_[t]||void 0},r.prototype.hasListener=function(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1},r.prototype.removeEventListener=function(t,e){var n=this.listeners_&&this.listeners_[t];if(n){var o=n.indexOf(e);o!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[o]=Nr,++this.pendingRemovals_[t]):(n.splice(o,1),n.length===0&&delete this.listeners_[t]))}},r}(bs),Tn=Dh,lt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function ft(i,r,t,e,n){if(e&&e!==i&&(t=t.bind(e)),n){var o=t;t=function(){i.removeEventListener(r,t),o.apply(this,arguments)}}var s={target:i,type:r,listener:t};return i.addEventListener(r,t),s}function to(i,r,t,e){return ft(i,r,t,e,!0)}function wt(i){i&&i.target&&(i.target.removeEventListener(i.type,i.listener),ci(i))}var Fh=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),To=function(i){Fh(r,i);function r(){var t=i.call(this)||this;return t.on=t.onInternal,t.once=t.onceInternal,t.un=t.unInternal,t.revision_=0,t}return r.prototype.changed=function(){++this.revision_,this.dispatchEvent(lt.CHANGE)},r.prototype.getRevision=function(){return this.revision_},r.prototype.onInternal=function(t,e){if(Array.isArray(t)){for(var n=t.length,o=new Array(n),s=0;s<n;++s)o[s]=ft(this,t[s],e);return o}else return ft(this,t,e)},r.prototype.onceInternal=function(t,e){var n;if(Array.isArray(t)){var o=t.length;n=new Array(o);for(var s=0;s<o;++s)n[s]=to(this,t[s],e)}else n=to(this,t,e);return e.ol_key=n,n},r.prototype.unInternal=function(t,e){var n=e.ol_key;if(n)Gh(n);else if(Array.isArray(t))for(var o=0,s=t.length;o<s;++o)this.removeEventListener(t[o],e);else this.removeEventListener(t,e)},r}(Tn);To.prototype.on;To.prototype.once;To.prototype.un;function Gh(i){if(Array.isArray(i))for(var r=0,t=i.length;r<t;++r)wt(i[r]);else wt(i)}var Ql=To,tu=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ba=function(i){tu(r,i);function r(t,e,n){var o=i.call(this,t)||this;return o.key=e,o.oldValue=n,o}return r}(Ve),kh=function(i){tu(r,i);function r(t){var e=i.call(this)||this;return e.on,e.once,e.un,gt(e),e.values_=null,t!==void 0&&e.setProperties(t),e}return r.prototype.get=function(t){var e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e},r.prototype.getKeys=function(){return this.values_&&Object.keys(this.values_)||[]},r.prototype.getProperties=function(){return this.values_&&Ft({},this.values_)||{}},r.prototype.hasProperties=function(){return!!this.values_},r.prototype.notify=function(t,e){var n;n="change:".concat(t),this.hasListener(n)&&this.dispatchEvent(new ba(n,t,e)),n=mn.PROPERTYCHANGE,this.hasListener(n)&&this.dispatchEvent(new ba(n,t,e))},r.prototype.addChangeListener=function(t,e){this.addEventListener("change:".concat(t),e)},r.prototype.removeChangeListener=function(t,e){this.removeEventListener("change:".concat(t),e)},r.prototype.set=function(t,e,n){var o=this.values_||(this.values_={});if(n)o[t]=e;else{var s=o[t];o[t]=e,s!==e&&this.notify(t,s)}},r.prototype.setProperties=function(t,e){for(var n in t)this.set(n,t[n],e)},r.prototype.applyProperties=function(t){!t.values_||Ft(this.values_||(this.values_={}),t.values_)},r.prototype.unset=function(t,e){if(this.values_&&t in this.values_){var n=this.values_[t];delete this.values_[t],En(this.values_)&&(this.values_=null),e||this.notify(t,n)}},r}(Ql),Ie=kh,Gi="ol-hidden",Ro="ol-unselectable",Ms="ol-control",La="ol-collapsed",Uh=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Ma=["style","variant","weight","size","lineHeight","family"],eu=function(i){var r=i.match(Uh);if(!r)return null;for(var t={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},e=0,n=Ma.length;e<n;++e){var o=r[e+1];o!==void 0&&(t[Ma[e]]=o)}return t.families=t.family.split(/,\s?/),t};function ru(i){return i===1?"":String(Math.round(i*100)/100)}var nu="10px sans-serif",je="#000",eo="round",Kn=[],Hn=0,wn="round",Zn=10,Jn="#000",Qn="center",ro="middle",Cr=[0,0,0,0],ti=1,Fe=new Ie,jh=new Tn;jh.setSize=function(){console.warn("labelCache is deprecated.")};var on=null,is,os={},$h=function(){var i=100,r="32px ",t=["monospace","serif"],e=t.length,n="wmytzilWMYTZIL@#/&?$%10\uF013",o,s;function l(h,p,d){for(var g=!0,_=0;_<e;++_){var y=t[_];if(s=no(h+" "+p+" "+r+y,n),d!=y){var E=no(h+" "+p+" "+r+d+","+y,n);g=g&&E!=s}}return!!g}function u(){for(var h=!0,p=Fe.getKeys(),d=0,g=p.length;d<g;++d){var _=p[d];Fe.get(_)<i&&(l.apply(this,_.split(`
`))?(ci(os),on=null,is=void 0,Fe.set(_,i)):(Fe.set(_,Fe.get(_)+1,!0),h=!1))}h&&(clearInterval(o),o=void 0)}return function(h){var p=eu(h);if(!!p)for(var d=p.families,g=0,_=d.length;g<_;++g){var y=d[g],E=p.style+`
`+p.weight+`
`+y;Fe.get(E)===void 0&&(Fe.set(E,i,!0),l(p.style,p.weight,y)||(Fe.set(E,0,!0),o===void 0&&(o=setInterval(u,32))))}}}(),Xh=function(){var i;return function(r){var t=os[r];if(t==null){if(Eo){var e=eu(r),n=iu(r,"\u017Dg"),o=isNaN(Number(e.lineHeight))?1.2:Number(e.lineHeight);t=o*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else i||(i=document.createElement("div"),i.innerHTML="M",i.style.minHeight="0",i.style.maxHeight="none",i.style.height="auto",i.style.padding="0",i.style.border="none",i.style.position="absolute",i.style.display="block",i.style.left="-99999px"),i.style.font=r,document.body.appendChild(i),t=i.offsetHeight,document.body.removeChild(i);os[r]=t}return t}}();function iu(i,r){return on||(on=he(1,1)),i!=is&&(on.font=i,is=on.font),on.measureText(r)}function no(i,r){return iu(i,r).width}function Na(i,r,t){if(r in t)return t[r];var e=no(i,r);return t[r]=e,e}function Yh(i,r){for(var t=[],e=[],n=[],o=0,s=0,l=0,u=0,h=0,p=r.length;h<=p;h+=2){var d=r[h];if(d===`
`||h===p){o=Math.max(o,s),n.push(s),s=0,l+=u;continue}var g=r[h+1]||i.font,_=no(g,d);t.push(_),s+=_;var y=Xh(g);e.push(y),u=Math.max(u,y)}return{width:o,height:l,widths:t,heights:e,lineWidths:n}}function Vh(i,r,t,e,n,o,s,l,u,h,p){i.save(),t!==1&&(i.globalAlpha*=t),r&&i.setTransform.apply(i,r),e.contextInstructions?(i.translate(u,h),i.scale(p[0],p[1]),Bh(e,i)):p[0]<0||p[1]<0?(i.translate(u,h),i.scale(p[0],p[1]),i.drawImage(e,n,o,s,l,0,0,s,l)):i.drawImage(e,n,o,s,l,u,h,s*p[0],l*p[1]),i.restore()}function Bh(i,r){for(var t=i.contextInstructions,e=0,n=t.length;e<n;e+=2)Array.isArray(t[e+1])?r[t[e]].apply(r,t[e+1]):r[t[e]]=t[e+1]}var Wh=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),zh=function(i){Wh(r,i);function r(t){var e=this,n=t.rotateWithView!==void 0?t.rotateWithView:!1;return e=i.call(this,{opacity:1,rotateWithView:n,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0]})||this,e.canvas_=void 0,e.hitDetectionCanvas_=null,e.fill_=t.fill!==void 0?t.fill:null,e.origin_=[0,0],e.points_=t.points,e.radius_=t.radius!==void 0?t.radius:t.radius1,e.radius2_=t.radius2,e.angle_=t.angle!==void 0?t.angle:0,e.stroke_=t.stroke!==void 0?t.stroke:null,e.size_=null,e.renderOptions_=null,e.render(),e}return r.prototype.clone=function(){var t=this.getScale(),e=new r({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice()});return e.setOpacity(this.getOpacity()),e},r.prototype.getAnchor=function(){var t=this.size_;if(!t)return null;var e=this.getDisplacement();return[t[0]/2-e[0],t[1]/2+e[1]]},r.prototype.getAngle=function(){return this.angle_},r.prototype.getFill=function(){return this.fill_},r.prototype.getHitDetectionImage=function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_},r.prototype.getImage=function(t){var e=this.canvas_[t];if(!e){var n=this.renderOptions_,o=he(n.size*t,n.size*t);this.draw_(n,o,t),e=o.canvas,this.canvas_[t]=e}return e},r.prototype.getPixelRatio=function(t){return t},r.prototype.getImageSize=function(){return this.size_},r.prototype.getImageState=function(){return mt.LOADED},r.prototype.getOrigin=function(){return this.origin_},r.prototype.getPoints=function(){return this.points_},r.prototype.getRadius=function(){return this.radius_},r.prototype.getRadius2=function(){return this.radius2_},r.prototype.getSize=function(){return this.size_},r.prototype.getStroke=function(){return this.stroke_},r.prototype.listenImageChange=function(t){},r.prototype.load=function(){},r.prototype.unlistenImageChange=function(t){},r.prototype.calculateLineJoinSize_=function(t,e,n){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;var o=this.radius_,s=this.radius2_===void 0?o:this.radius2_;if(o<s){var l=o;o=s,s=l}var u=this.radius2_===void 0?this.points_:this.points_*2,h=2*Math.PI/u,p=s*Math.sin(h),d=Math.sqrt(s*s-p*p),g=o-d,_=Math.sqrt(p*p+g*g),y=_/p;if(t==="miter"&&y<=n)return y*e;var E=e/2/y,w=e/2*(g/_),C=Math.sqrt((o+E)*(o+E)+w*w),x=C-o;if(this.radius2_===void 0||t==="bevel")return x*2;var S=o*Math.sin(h),R=Math.sqrt(o*o-S*S),I=s-R,b=Math.sqrt(S*S+I*I),F=b/S;if(F<=n){var A=F*e/2-s-o;return 2*Math.max(x,A)}return x*2},r.prototype.createRenderOptions=function(){var t=wn,e=0,n=null,o=0,s,l=0;this.stroke_&&(s=this.stroke_.getColor(),s===null&&(s=Jn),s=Se(s),l=this.stroke_.getWidth(),l===void 0&&(l=ti),n=this.stroke_.getLineDash(),o=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=wn),e=this.stroke_.getMiterLimit(),e===void 0&&(e=Zn));var u=this.calculateLineJoinSize_(t,l,e),h=Math.max(this.radius_,this.radius2_||0),p=Math.ceil(2*h+u);return{strokeStyle:s,strokeWidth:l,size:p,lineDash:n,lineDashOffset:o,lineJoin:t,miterLimit:e}},r.prototype.render=function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]},r.prototype.draw_=function(t,e,n){if(e.scale(n,n),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var o=this.fill_.getColor();o===null&&(o=je),e.fillStyle=Se(o),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},r.prototype.createHitDetectionCanvas_=function(t){if(this.fill_){var e=this.fill_.getColor(),n=0;if(typeof e=="string"&&(e=Qi(e)),e===null?n=1:Array.isArray(e)&&(n=e.length===4?e[3]:1),n===0){var o=he(t.size,t.size);this.hitDetectionCanvas_=o.canvas,this.drawHitDetectionCanvas_(t,o)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))},r.prototype.createPath_=function(t){var e=this.points_,n=this.radius_;if(e===1/0)t.arc(0,0,n,0,2*Math.PI);else{var o=this.radius2_===void 0?n:this.radius2_;this.radius2_!==void 0&&(e*=2);for(var s=this.angle_-Math.PI/2,l=2*Math.PI/e,u=0;u<e;u++){var h=s+u*l,p=u%2===0?n:o;t.lineTo(p*Math.cos(h),p*Math.sin(h))}t.closePath()}},r.prototype.drawHitDetectionCanvas_=function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=je,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())},r}(Wl),qh=zh,Kh=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Hh=function(i){Kh(r,i);function r(t){var e=t||{};return i.call(this,{points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:e.scale!==void 0?e.scale:1,rotation:e.rotation!==void 0?e.rotation:0,rotateWithView:e.rotateWithView!==void 0?e.rotateWithView:!1,displacement:e.displacement!==void 0?e.displacement:[0,0]})||this}return r.prototype.clone=function(){var t=this.getScale(),e=new r({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice()});return e.setOpacity(this.getOpacity()),e},r.prototype.setRadius=function(t){this.radius_=t,this.render()},r}(qh),ou=Hh,Zh=function(){function i(r){var t=r||{};this.color_=t.color!==void 0?t.color:null}return i.prototype.clone=function(){var r=this.getColor();return new i({color:Array.isArray(r)?r.slice():r||void 0})},i.prototype.getColor=function(){return this.color_},i.prototype.setColor=function(r){this.color_=r},i}(),su=Zh,nr={FRACTION:"fraction",PIXELS:"pixels"},le={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Jh=function(){function i(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}return i.prototype.clear=function(){this.cache_={},this.cacheSize_=0},i.prototype.canExpireCache=function(){return this.cacheSize_>this.maxCacheSize_},i.prototype.expire=function(){if(this.canExpireCache()){var r=0;for(var t in this.cache_){var e=this.cache_[t];(r++&3)===0&&!e.hasListener()&&(delete this.cache_[t],--this.cacheSize_)}}},i.prototype.get=function(r,t,e){var n=Da(r,t,e);return n in this.cache_?this.cache_[n]:null},i.prototype.set=function(r,t,e,n){var o=Da(r,t,e);this.cache_[o]=n,++this.cacheSize_},i.prototype.setSize=function(r){this.maxCacheSize_=r,this.expire()},i}();function Da(i,r,t){var e=t?ql(t):"null";return r+":"+i+":"+e}var io=new Jh,Qh=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),tf=function(i){Qh(r,i);function r(t,e,n,o){var s=i.call(this)||this;return s.extent=t,s.pixelRatio_=n,s.resolution=e,s.state=o,s}return r.prototype.changed=function(){this.dispatchEvent(lt.CHANGE)},r.prototype.getExtent=function(){return this.extent},r.prototype.getImage=function(){return J()},r.prototype.getPixelRatio=function(){return this.pixelRatio_},r.prototype.getResolution=function(){return this.resolution},r.prototype.getState=function(){return this.state},r.prototype.load=function(){J()},r}(Tn),ef=tf,rf=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();(function(i){rf(r,i);function r(t,e,n,o,s,l){var u=i.call(this,t,e,n,mt.IDLE)||this;return u.src_=o,u.image_=new Image,s!==null&&(u.image_.crossOrigin=s),u.unlisten_=null,u.state=mt.IDLE,u.imageLoadFunction_=l,u}return r.prototype.getImage=function(){return this.image_},r.prototype.handleImageError_=function(){this.state=mt.ERROR,this.unlistenImage_(),this.changed()},r.prototype.handleImageLoad_=function(){this.resolution===void 0&&(this.resolution=me(this.extent)/this.image_.height),this.state=mt.LOADED,this.unlistenImage_(),this.changed()},r.prototype.load=function(){(this.state==mt.IDLE||this.state==mt.ERROR)&&(this.state=mt.LOADING,this.changed(),this.imageLoadFunction_(this,this.src_),this.unlisten_=Ns(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},r.prototype.setImage=function(t){this.image_=t,this.resolution=me(this.extent)/this.image_.height},r.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},r})(ef);function Ns(i,r,t){var e=i,n=!0,o=!1,s=!1,l=[to(e,lt.LOAD,function(){s=!0,o||r()})];return e.src&&xh?(o=!0,e.decode().then(function(){n&&r()}).catch(function(u){n&&(s?r():t())})):l.push(to(e,lt.ERROR,t)),function(){n=!1,l.forEach(wt)}}var nf=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Un=null,of=function(i){nf(r,i);function r(t,e,n,o,s,l){var u=i.call(this)||this;return u.hitDetectionImage_=null,u.image_=t||new Image,o!==null&&(u.image_.crossOrigin=o),u.canvas_={},u.color_=l,u.unlisten_=null,u.imageState_=s,u.size_=n,u.src_=e,u.tainted_,u}return r.prototype.isTainted_=function(){if(this.tainted_===void 0&&this.imageState_===mt.LOADED){Un||(Un=he(1,1)),Un.drawImage(this.image_,0,0);try{Un.getImageData(0,0,1,1),this.tainted_=!1}catch{Un=null,this.tainted_=!0}}return this.tainted_===!0},r.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(lt.CHANGE)},r.prototype.handleImageError_=function(){this.imageState_=mt.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()},r.prototype.handleImageLoad_=function(){this.imageState_=mt.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()},r.prototype.getImage=function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_},r.prototype.getPixelRatio=function(t){return this.replaceColor_(t),this.canvas_[t]?t:1},r.prototype.getImageState=function(){return this.imageState_},r.prototype.getHitDetectionImage=function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],n=he(t,e);n.fillRect(0,0,t,e),this.hitDetectionImage_=n.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_},r.prototype.getSize=function(){return this.size_},r.prototype.getSrc=function(){return this.src_},r.prototype.load=function(){if(this.imageState_==mt.IDLE){this.imageState_=mt.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=Ns(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}},r.prototype.replaceColor_=function(t){if(!(!this.color_||this.canvas_[t]||this.imageState_!==mt.LOADED)){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var n=e.getContext("2d");if(n.scale(t,t),n.drawImage(this.image_,0,0),n.globalCompositeOperation="multiply",n.globalCompositeOperation==="multiply"||this.isTainted_())n.fillStyle=ql(this.color_),n.fillRect(0,0,e.width/t,e.height/t),n.globalCompositeOperation="destination-in",n.drawImage(this.image_,0,0);else{for(var o=n.getImageData(0,0,e.width,e.height),s=o.data,l=this.color_[0]/255,u=this.color_[1]/255,h=this.color_[2]/255,p=this.color_[3],d=0,g=s.length;d<g;d+=4)s[d]*=l,s[d+1]*=u,s[d+2]*=h,s[d+3]*=p;n.putImageData(o,0,0)}}},r.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},r}(Tn);function sf(i,r,t,e,n,o){var s=io.get(r,e,o);return s||(s=new of(i,r,t,e,n,o),io.set(r,e,o,s)),s}var af=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),lf=function(i){af(r,i);function r(t){var e=this,n=t||{},o=n.opacity!==void 0?n.opacity:1,s=n.rotation!==void 0?n.rotation:0,l=n.scale!==void 0?n.scale:1,u=n.rotateWithView!==void 0?n.rotateWithView:!1;e=i.call(this,{opacity:o,rotation:s,scale:l,displacement:n.displacement!==void 0?n.displacement:[0,0],rotateWithView:u})||this,e.anchor_=n.anchor!==void 0?n.anchor:[.5,.5],e.normalizedAnchor_=null,e.anchorOrigin_=n.anchorOrigin!==void 0?n.anchorOrigin:le.TOP_LEFT,e.anchorXUnits_=n.anchorXUnits!==void 0?n.anchorXUnits:nr.FRACTION,e.anchorYUnits_=n.anchorYUnits!==void 0?n.anchorYUnits:nr.FRACTION,e.crossOrigin_=n.crossOrigin!==void 0?n.crossOrigin:null;var h=n.img!==void 0?n.img:null;e.imgSize_=n.imgSize;var p=n.src;ht(!(p!==void 0&&h),4),ht(!h||h&&e.imgSize_,5),(p===void 0||p.length===0)&&h&&(p=h.src||gt(h)),ht(p!==void 0&&p.length>0,6);var d=n.src!==void 0?mt.IDLE:mt.LOADED;return e.color_=n.color!==void 0?Qi(n.color):null,e.iconImage_=sf(h,p,e.imgSize_!==void 0?e.imgSize_:null,e.crossOrigin_,d,e.color_),e.offset_=n.offset!==void 0?n.offset:[0,0],e.offsetOrigin_=n.offsetOrigin!==void 0?n.offsetOrigin:le.TOP_LEFT,e.origin_=null,e.size_=n.size!==void 0?n.size:null,e}return r.prototype.clone=function(){var t=this.getScale();return new r({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc()})},r.prototype.getAnchor=function(){var t=this.normalizedAnchor_;if(!t){t=this.anchor_;var e=this.getSize();if(this.anchorXUnits_==nr.FRACTION||this.anchorYUnits_==nr.FRACTION){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==nr.FRACTION&&(t[0]*=e[0]),this.anchorYUnits_==nr.FRACTION&&(t[1]*=e[1])}if(this.anchorOrigin_!=le.TOP_LEFT){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_==le.TOP_RIGHT||this.anchorOrigin_==le.BOTTOM_RIGHT)&&(t[0]=-t[0]+e[0]),(this.anchorOrigin_==le.BOTTOM_LEFT||this.anchorOrigin_==le.BOTTOM_RIGHT)&&(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}var n=this.getDisplacement();return[t[0]-n[0],t[1]+n[1]]},r.prototype.setAnchor=function(t){this.anchor_=t,this.normalizedAnchor_=null},r.prototype.getColor=function(){return this.color_},r.prototype.getImage=function(t){return this.iconImage_.getImage(t)},r.prototype.getPixelRatio=function(t){return this.iconImage_.getPixelRatio(t)},r.prototype.getImageSize=function(){return this.iconImage_.getSize()},r.prototype.getImageState=function(){return this.iconImage_.getImageState()},r.prototype.getHitDetectionImage=function(){return this.iconImage_.getHitDetectionImage()},r.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=le.TOP_LEFT){var e=this.getSize(),n=this.iconImage_.getSize();if(!e||!n)return null;t=t.slice(),(this.offsetOrigin_==le.TOP_RIGHT||this.offsetOrigin_==le.BOTTOM_RIGHT)&&(t[0]=n[0]-e[0]-t[0]),(this.offsetOrigin_==le.BOTTOM_LEFT||this.offsetOrigin_==le.BOTTOM_RIGHT)&&(t[1]=n[1]-e[1]-t[1])}return this.origin_=t,this.origin_},r.prototype.getSrc=function(){return this.iconImage_.getSrc()},r.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()},r.prototype.listenImageChange=function(t){this.iconImage_.addEventListener(lt.CHANGE,t)},r.prototype.load=function(){this.iconImage_.load()},r.prototype.unlistenImageChange=function(t){this.iconImage_.removeEventListener(lt.CHANGE,t)},r}(Wl),uf=lf,cf=function(){function i(r){var t=r||{};this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}return i.prototype.clone=function(){var r=this.getColor();return new i({color:Array.isArray(r)?r.slice():r||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})},i.prototype.getColor=function(){return this.color_},i.prototype.getLineCap=function(){return this.lineCap_},i.prototype.getLineDash=function(){return this.lineDash_},i.prototype.getLineDashOffset=function(){return this.lineDashOffset_},i.prototype.getLineJoin=function(){return this.lineJoin_},i.prototype.getMiterLimit=function(){return this.miterLimit_},i.prototype.getWidth=function(){return this.width_},i.prototype.setColor=function(r){this.color_=r},i.prototype.setLineCap=function(r){this.lineCap_=r},i.prototype.setLineDash=function(r){this.lineDash_=r},i.prototype.setLineDashOffset=function(r){this.lineDashOffset_=r},i.prototype.setLineJoin=function(r){this.lineJoin_=r},i.prototype.setMiterLimit=function(r){this.miterLimit_=r},i.prototype.setWidth=function(r){this.width_=r},i}(),au=cf,q={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},lu=function(){function i(r){var t=r||{};this.geometry_=null,this.geometryFunction_=Fa,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}return i.prototype.clone=function(){var r=this.getGeometry();return r&&typeof r=="object"&&(r=r.clone()),new i({geometry:r,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})},i.prototype.getRenderer=function(){return this.renderer_},i.prototype.setRenderer=function(r){this.renderer_=r},i.prototype.setHitDetectionRenderer=function(r){this.hitDetectionRenderer_=r},i.prototype.getHitDetectionRenderer=function(){return this.hitDetectionRenderer_},i.prototype.getGeometry=function(){return this.geometry_},i.prototype.getGeometryFunction=function(){return this.geometryFunction_},i.prototype.getFill=function(){return this.fill_},i.prototype.setFill=function(r){this.fill_=r},i.prototype.getImage=function(){return this.image_},i.prototype.setImage=function(r){this.image_=r},i.prototype.getStroke=function(){return this.stroke_},i.prototype.setStroke=function(r){this.stroke_=r},i.prototype.getText=function(){return this.text_},i.prototype.setText=function(r){this.text_=r},i.prototype.getZIndex=function(){return this.zIndex_},i.prototype.setGeometry=function(r){typeof r=="function"?this.geometryFunction_=r:typeof r=="string"?this.geometryFunction_=function(t){return t.get(r)}:r?r!==void 0&&(this.geometryFunction_=function(){return r}):this.geometryFunction_=Fa,this.geometry_=r},i.prototype.setZIndex=function(r){this.zIndex_=r},i}();function hf(i){var r;if(typeof i=="function")r=i;else{var t;if(Array.isArray(i))t=i;else{ht(typeof i.getZIndex=="function",41);var e=i;t=[e]}r=function(){return t}}return r}var No=null;function ff(i,r){if(!No){var t=new su({color:"rgba(255,255,255,0.4)"}),e=new au({color:"#3399CC",width:1.25});No=[new lu({image:new ou({fill:t,stroke:e,radius:5}),fill:t,stroke:e})]}return No}function Fa(i){return i.getGeometry()}var uu=lu,pf={POINT:"point",LINE:"line"},Rn={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},fe={};fe[Rn.RADIANS]=6370997/(2*Math.PI);fe[Rn.DEGREES]=2*Math.PI*6370997/360;fe[Rn.FEET]=.3048;fe[Rn.METERS]=1;fe[Rn.USFEET]=1200/3937;var $e=Rn;new Array(6);function Ce(){return[1,0,0,1,0,0]}function df(i,r,t,e,n,o,s){return i[0]=r,i[1]=t,i[2]=e,i[3]=n,i[4]=o,i[5]=s,i}function gf(i,r){return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i[4]=r[4],i[5]=r[5],i}function Dt(i,r){var t=r[0],e=r[1];return r[0]=i[0]*t+i[2]*e+i[4],r[1]=i[1]*t+i[3]*e+i[5],r}function vf(i,r,t){return df(i,r,0,0,t,0,0)}function Ye(i,r,t,e,n,o,s,l){var u=Math.sin(o),h=Math.cos(o);return i[0]=e*h,i[1]=n*u,i[2]=-e*u,i[3]=n*h,i[4]=s*e*h-l*e*u+r,i[5]=s*n*u+l*n*h+t,i}function Ds(i,r){var t=_f(r);ht(t!==0,32);var e=r[0],n=r[1],o=r[2],s=r[3],l=r[4],u=r[5];return i[0]=s/t,i[1]=-n/t,i[2]=-o/t,i[3]=e/t,i[4]=(o*u-s*l)/t,i[5]=-(e*u-n*l)/t,i}function _f(i){return i[0]*i[3]-i[1]*i[2]}var Ga;function cu(i){var r="matrix("+i.join(", ")+")";if(Eo)return r;var t=Ga||(Ga=document.createElement("div"));return t.style.transform=r,t.style.transform}var yf=function(){function i(r){this.code_=r.code,this.units_=r.units,this.extent_=r.extent!==void 0?r.extent:null,this.worldExtent_=r.worldExtent!==void 0?r.worldExtent:null,this.axisOrientation_=r.axisOrientation!==void 0?r.axisOrientation:"enu",this.global_=r.global!==void 0?r.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=r.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=r.metersPerUnit}return i.prototype.canWrapX=function(){return this.canWrapX_},i.prototype.getCode=function(){return this.code_},i.prototype.getExtent=function(){return this.extent_},i.prototype.getUnits=function(){return this.units_},i.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||fe[this.units_]},i.prototype.getWorldExtent=function(){return this.worldExtent_},i.prototype.getAxisOrientation=function(){return this.axisOrientation_},i.prototype.isGlobal=function(){return this.global_},i.prototype.setGlobal=function(r){this.global_=r,this.canWrapX_=!!(r&&this.extent_)},i.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_},i.prototype.setDefaultTileGrid=function(r){this.defaultTileGrid_=r},i.prototype.setExtent=function(r){this.extent_=r,this.canWrapX_=!!(this.global_&&r)},i.prototype.setWorldExtent=function(r){this.worldExtent_=r},i.prototype.setGetPointResolution=function(r){this.getPointResolutionFunc_=r},i.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_},i}(),hu=yf,mf=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),hi=6378137,hn=Math.PI*hi,Ef=[-hn,-hn,hn,hn],wf=[-180,-85,180,85],ki=hi*Math.log(Math.tan(Math.PI/2)),tn=function(i){mf(r,i);function r(t){return i.call(this,{code:t,units:$e.METERS,extent:Ef,global:!0,worldExtent:wf,getPointResolution:function(e,n){return e/fh(n[1]/hi)}})||this}return r}(hu),ka=[new tn("EPSG:3857"),new tn("EPSG:102100"),new tn("EPSG:102113"),new tn("EPSG:900913"),new tn("http://www.opengis.net/def/crs/EPSG/0/3857"),new tn("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Tf(i,r,t){var e=i.length,n=t>1?t:2,o=r;o===void 0&&(n>2?o=i.slice():o=new Array(e));for(var s=0;s<e;s+=n){o[s]=hn*i[s]/180;var l=hi*Math.log(Math.tan(Math.PI*(+i[s+1]+90)/360));l>ki?l=ki:l<-ki&&(l=-ki),o[s+1]=l}return o}function Rf(i,r,t){var e=i.length,n=t>1?t:2,o=r;o===void 0&&(n>2?o=i.slice():o=new Array(e));for(var s=0;s<e;s+=n)o[s]=180*i[s]/hn,o[s+1]=360*Math.atan(Math.exp(i[s+1]/hi))/Math.PI-90;return o}var Sf=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),xf=6378137,Ua=[-180,-90,180,90],Cf=Math.PI*xf/180,Tr=function(i){Sf(r,i);function r(t,e){return i.call(this,{code:t,units:$e.DEGREES,extent:Ua,axisOrientation:e,global:!0,metersPerUnit:Cf,worldExtent:Ua})||this}return r}(hu),ja=[new Tr("CRS:84"),new Tr("EPSG:4326","neu"),new Tr("urn:ogc:def:crs:OGC:1.3:CRS84"),new Tr("urn:ogc:def:crs:OGC:2:84"),new Tr("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new Tr("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new Tr("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],ss={};function Of(i){return ss[i]||ss[i.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function If(i,r){ss[i]=r}var dn={};function oo(i,r,t){var e=i.getCode(),n=r.getCode();e in dn||(dn[e]={}),dn[e][n]=t}function Af(i,r){var t;return i in dn&&r in dn[i]&&(t=dn[i][r]),t}function Pf(i,r){return i[0]+=+r[0],i[1]+=+r[1],i}function so(i,r){for(var t=!0,e=i.length-1;e>=0;--e)if(i[e]!=r[e]){t=!1;break}return t}function Fs(i,r){var t=Math.cos(r),e=Math.sin(r),n=i[0]*t-i[1]*e,o=i[1]*t+i[0]*e;return i[0]=n,i[1]=o,i}function bf(i,r){return i[0]*=r,i[1]*=r,i}function fu(i,r){if(r.canWrapX()){var t=It(r.getExtent()),e=Lf(i,r,t);e&&(i[0]-=e*t)}return i}function Lf(i,r,t){var e=r.getExtent(),n=0;if(r.canWrapX()&&(i[0]<e[0]||i[0]>e[2])){var o=t||It(e);n=Math.floor((i[0]-e[0])/o)}return n}var Mf=63710088e-1;function $a(i,r,t){var e=t||Mf,n=qi(i[1]),o=qi(r[1]),s=(o-n)/2,l=qi(r[0]-i[0])/2,u=Math.sin(s)*Math.sin(s)+Math.sin(l)*Math.sin(l)*Math.cos(n)*Math.cos(o);return 2*e*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))}var as=!0;function Nf(i){var r=i===void 0?!0:i;as=!r}function Gs(i,r,t){var e;if(r!==void 0){for(var n=0,o=i.length;n<o;++n)r[n]=i[n];e=r}else e=i.slice();return e}function pu(i,r,t){if(r!==void 0&&i!==r){for(var e=0,n=i.length;e<n;++e)r[e]=i[e];i=r}return i}function Df(i){If(i.getCode(),i),oo(i,i,Gs)}function Ff(i){i.forEach(Df)}function Pt(i){return typeof i=="string"?Of(i):i||null}function Xa(i,r,t,e){i=Pt(i);var n,o=i.getPointResolutionFunc();if(o){if(n=o(r,t),e&&e!==i.getUnits()){var s=i.getMetersPerUnit();s&&(n=n*s/fe[e])}}else{var l=i.getUnits();if(l==$e.DEGREES&&!e||e==$e.DEGREES)n=r;else{var u=So(i,Pt("EPSG:4326"));if(u===pu&&l!==$e.DEGREES)n=r*i.getMetersPerUnit();else{var h=[t[0]-r/2,t[1],t[0]+r/2,t[1],t[0],t[1]-r/2,t[0],t[1]+r/2];h=u(h,h,2);var p=$a(h.slice(0,2),h.slice(2,4)),d=$a(h.slice(4,6),h.slice(6,8));n=(p+d)/2}var s=e?fe[e]:i.getMetersPerUnit();s!==void 0&&(n/=s)}}return n}function Ya(i){Ff(i),i.forEach(function(r){i.forEach(function(t){r!==t&&oo(r,t,Gs)})})}function Gf(i,r,t,e){i.forEach(function(n){r.forEach(function(o){oo(n,o,t),oo(o,n,e)})})}function ks(i,r){return i?typeof i=="string"?Pt(i):i:Pt(r)}function xr(i,r){if(i===r)return!0;var t=i.getUnits()===r.getUnits();if(i.getCode()===r.getCode())return t;var e=So(i,r);return e===Gs&&t}function So(i,r){var t=i.getCode(),e=r.getCode(),n=Af(t,e);return n||(n=pu),n}function ei(i,r){var t=Pt(i),e=Pt(r);return So(t,e)}function Us(i,r,t){var e=ei(r,t);return e(i,void 0,i.length)}function du(i,r,t,e){var n=ei(r,t);return Bc(i,n,void 0,e)}var pe=null;function kf(i){pe=Pt(i)}function gu(){return pe}function Uf(){kf("EPSG:4326")}function ls(i,r){return pe?Us(i,r,pe):i}function Ge(i,r){return pe?Us(i,pe,r):(as&&!so(i,[0,0])&&i[0]>=-180&&i[0]<=180&&i[1]>=-90&&i[1]<=90&&(as=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),i)}function us(i,r){return pe?du(i,r,pe):i}function Or(i,r){return pe?du(i,pe,r):i}function jf(i,r){if(!pe)return i;var t=Pt(r).getUnits(),e=pe.getUnits();return t&&e?i*fe[t]/fe[e]:i}function $f(){Ya(ka),Ya(ja),Gf(ja,ka,Tf,Rf)}$f();function br(i,r,t,e,n,o){for(var s=o||[],l=0,u=r;u<t;u+=e){var h=i[u],p=i[u+1];s[l++]=n[0]*h+n[2]*p+n[4],s[l++]=n[1]*h+n[3]*p+n[5]}return o&&s.length!=l&&(s.length=l),s}function vu(i,r,t,e,n,o,s){for(var l=s||[],u=Math.cos(n),h=Math.sin(n),p=o[0],d=o[1],g=0,_=r;_<t;_+=e){var y=i[_]-p,E=i[_+1]-d;l[g++]=p+y*u-E*h,l[g++]=d+y*h+E*u;for(var w=_+2;w<_+e;++w)l[g++]=i[w]}return s&&l.length!=g&&(l.length=g),l}function Xf(i,r,t,e,n,o,s,l){for(var u=l||[],h=s[0],p=s[1],d=0,g=r;g<t;g+=e){var _=i[g]-h,y=i[g+1]-p;u[d++]=h+n*_,u[d++]=p+o*y;for(var E=g+2;E<g+e;++E)u[d++]=i[E]}return l&&u.length!=d&&(u.length=d),u}function Yf(i,r,t,e,n,o,s){for(var l=s||[],u=0,h=r;h<t;h+=e){l[u++]=i[h]+n,l[u++]=i[h+1]+o;for(var p=h+2;p<h+e;++p)l[u++]=i[p]}return s&&l.length!=u&&(l.length=u),l}var Vf=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Va=Ce(),Bf=function(i){Vf(r,i);function r(){var t=i.call(this)||this;return t.extent_=ce(),t.extentRevision_=-1,t.simplifiedGeometryMaxMinSquaredTolerance=0,t.simplifiedGeometryRevision=0,t.simplifyTransformedInternal=Mh(function(e,n,o){if(!o)return this.getSimplifiedGeometry(n);var s=this.clone();return s.applyTransform(o),s.getSimplifiedGeometry(n)}),t}return r.prototype.simplifyTransformed=function(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)},r.prototype.clone=function(){return J()},r.prototype.closestPointXY=function(t,e,n,o){return J()},r.prototype.containsXY=function(t,e){var n=this.getClosestPoint([t,e]);return n[0]===t&&n[1]===e},r.prototype.getClosestPoint=function(t,e){var n=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],n,1/0),n},r.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])},r.prototype.computeExtent=function(t){return J()},r.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){var e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&si(e),this.extentRevision_=this.getRevision()}return Yc(this.extent_,t)},r.prototype.rotate=function(t,e){J()},r.prototype.scale=function(t,e,n){J()},r.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)},r.prototype.getSimplifiedGeometry=function(t){return J()},r.prototype.getType=function(){return J()},r.prototype.applyTransform=function(t){J()},r.prototype.intersectsExtent=function(t){return J()},r.prototype.translate=function(t,e){J()},r.prototype.transform=function(t,e){var n=Pt(t),o=n.getUnits()==$e.TILE_PIXELS?function(s,l,u){var h=n.getExtent(),p=n.getWorldExtent(),d=me(p)/me(h);return Ye(Va,p[0],p[3],d,-d,0,0,0),br(s,0,s.length,u,Va,l),ei(n,e)(s,l,u)}:ei(n,e);return this.applyTransform(o),this},r}(Ie),_u=Bf,bt={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},Wf=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),zf=function(i){Wf(r,i);function r(){var t=i.call(this)||this;return t.layout=bt.XY,t.stride=2,t.flatCoordinates=null,t}return r.prototype.computeExtent=function(t){return El(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},r.prototype.getCoordinates=function(){return J()},r.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)},r.prototype.getFlatCoordinates=function(){return this.flatCoordinates},r.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)},r.prototype.getLayout=function(){return this.layout},r.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t),n=e.getFlatCoordinates();return n.length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)},r.prototype.getSimplifiedGeometryInternal=function(t){return this},r.prototype.getStride=function(){return this.stride},r.prototype.setFlatCoordinates=function(t,e){this.stride=Ba(t),this.layout=t,this.flatCoordinates=e},r.prototype.setCoordinates=function(t,e){J()},r.prototype.setLayout=function(t,e,n){var o;if(t)o=Ba(t);else{for(var s=0;s<n;++s)if(e.length===0){this.layout=bt.XY,this.stride=2;return}else e=e[0];o=e.length,t=qf(o)}this.layout=t,this.stride=o},r.prototype.applyTransform=function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())},r.prototype.rotate=function(t,e){var n=this.getFlatCoordinates();if(n){var o=this.getStride();vu(n,0,n.length,o,t,e,n),this.changed()}},r.prototype.scale=function(t,e,n){var o=e;o===void 0&&(o=t);var s=n;s||(s=Lr(this.getExtent()));var l=this.getFlatCoordinates();if(l){var u=this.getStride();Xf(l,0,l.length,u,t,o,s,l),this.changed()}},r.prototype.translate=function(t,e){var n=this.getFlatCoordinates();if(n){var o=this.getStride();Yf(n,0,n.length,o,t,e,n),this.changed()}},r}(_u);function qf(i){var r;return i==2?r=bt.XY:i==3?r=bt.XYZ:i==4&&(r=bt.XYZM),r}function Ba(i){var r;return i==bt.XY?r=2:i==bt.XYZ||i==bt.XYM?r=3:i==bt.XYZM&&(r=4),r}function Kf(i,r,t){var e=i.getFlatCoordinates();if(e){var n=i.getStride();return br(e,0,e.length,n,r,t)}else return null}var Ur=zf;function Hf(i,r,t,e){for(var n=0,o=t.length;n<o;++n)i[r++]=t[n];return r}function xo(i,r,t,e){for(var n=0,o=t.length;n<o;++n)for(var s=t[n],l=0;l<e;++l)i[r++]=s[l];return r}function js(i,r,t,e,n){for(var o=n||[],s=0,l=0,u=t.length;l<u;++l){var h=xo(i,r,t[l],e);o[s++]=h,r=h}return o.length=s,o}function Zf(i,r,t,e,n){for(var o=n||[],s=0,l=0,u=t.length;l<u;++l){var h=js(i,r,t[l],e,o[s]);o[s++]=h,r=h[h.length-1]}return o.length=s,o}var Jf=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Qf=function(i){Jf(r,i);function r(t){var e=i.call(this)||this;return e.geometries_=t||null,e.changeEventsKeys_=[],e.listenGeometriesChange_(),e}return r.prototype.unlistenGeometriesChange_=function(){this.changeEventsKeys_.forEach(wt),this.changeEventsKeys_.length=0},r.prototype.listenGeometriesChange_=function(){if(!!this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(ft(this.geometries_[t],lt.CHANGE,this.changed,this))},r.prototype.clone=function(){var t=new r(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t},r.prototype.closestPointXY=function(t,e,n,o){if(o<Fr(this.getExtent(),t,e))return o;for(var s=this.geometries_,l=0,u=s.length;l<u;++l)o=s[l].closestPointXY(t,e,n,o);return o},r.prototype.containsXY=function(t,e){for(var n=this.geometries_,o=0,s=n.length;o<s;++o)if(n[o].containsXY(t,e))return!0;return!1},r.prototype.computeExtent=function(t){si(t);for(var e=this.geometries_,n=0,o=e.length;n<o;++n)wl(t,e[n].getExtent());return t},r.prototype.getGeometries=function(){return Wa(this.geometries_)},r.prototype.getGeometriesArray=function(){return this.geometries_},r.prototype.getGeometriesArrayRecursive=function(){for(var t=[],e=this.geometries_,n=0,o=e.length;n<o;++n)e[n].getType()===this.getType()?t=t.concat(e[n].getGeometriesArrayRecursive()):t.push(e[n]);return t},r.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var e=[],n=this.geometries_,o=!1,s=0,l=n.length;s<l;++s){var u=n[s],h=u.getSimplifiedGeometry(t);e.push(h),h!==u&&(o=!0)}if(o){var p=new r(null);return p.setGeometriesArray(e),p}else return this.simplifiedGeometryMaxMinSquaredTolerance=t,this},r.prototype.getType=function(){return q.GEOMETRY_COLLECTION},r.prototype.intersectsExtent=function(t){for(var e=this.geometries_,n=0,o=e.length;n<o;++n)if(e[n].intersectsExtent(t))return!0;return!1},r.prototype.isEmpty=function(){return this.geometries_.length===0},r.prototype.rotate=function(t,e){for(var n=this.geometries_,o=0,s=n.length;o<s;++o)n[o].rotate(t,e);this.changed()},r.prototype.scale=function(t,e,n){var o=n;o||(o=Lr(this.getExtent()));for(var s=this.geometries_,l=0,u=s.length;l<u;++l)s[l].scale(t,e,o);this.changed()},r.prototype.setGeometries=function(t){this.setGeometriesArray(Wa(t))},r.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()},r.prototype.applyTransform=function(t){for(var e=this.geometries_,n=0,o=e.length;n<o;++n)e[n].applyTransform(t);this.changed()},r.prototype.translate=function(t,e){for(var n=this.geometries_,o=0,s=n.length;o<s;++o)n[o].translate(t,e);this.changed()},r.prototype.disposeInternal=function(){this.unlistenGeometriesChange_(),i.prototype.disposeInternal.call(this)},r}(_u);function Wa(i){for(var r=[],t=0,e=i.length;t<e;++t)r.push(i[t].clone());return r}var tp=Qf;function za(i,r,t,e,n,o,s){var l=i[r],u=i[r+1],h=i[t]-l,p=i[t+1]-u,d;if(h===0&&p===0)d=r;else{var g=((n-l)*h+(o-u)*p)/(h*h+p*p);if(g>1)d=t;else if(g>0){for(var _=0;_<e;++_)s[_]=ke(i[r+_],i[t+_],g);s.length=e;return}else d=r}for(var _=0;_<e;++_)s[_]=i[d+_];s.length=e}function $s(i,r,t,e,n){var o=i[r],s=i[r+1];for(r+=e;r<t;r+=e){var l=i[r],u=i[r+1],h=Pr(o,s,l,u);h>n&&(n=h),o=l,s=u}return n}function Xs(i,r,t,e,n){for(var o=0,s=t.length;o<s;++o){var l=t[o];n=$s(i,r,l,e,n),r=l}return n}function ep(i,r,t,e,n){for(var o=0,s=t.length;o<s;++o){var l=t[o];n=Xs(i,r,l,e,n),r=l[l.length-1]}return n}function Ys(i,r,t,e,n,o,s,l,u,h,p){if(r==t)return h;var d,g;if(n===0)if(g=Pr(s,l,i[r],i[r+1]),g<h){for(d=0;d<e;++d)u[d]=i[r+d];return u.length=e,g}else return h;for(var _=p||[NaN,NaN],y=r+e;y<t;)if(za(i,y-e,y,e,s,l,_),g=Pr(s,l,_[0],_[1]),g<h){for(h=g,d=0;d<e;++d)u[d]=_[d];u.length=e,y+=e}else y+=e*Math.max((Math.sqrt(g)-Math.sqrt(h))/n|0,1);if(o&&(za(i,t-e,r,e,s,l,_),g=Pr(s,l,_[0],_[1]),g<h)){for(h=g,d=0;d<e;++d)u[d]=_[d];u.length=e}return h}function Vs(i,r,t,e,n,o,s,l,u,h,p){for(var d=p||[NaN,NaN],g=0,_=t.length;g<_;++g){var y=t[g];h=Ys(i,r,y,e,n,o,s,l,u,h,d),r=y}return h}function rp(i,r,t,e,n,o,s,l,u,h,p){for(var d=p||[NaN,NaN],g=0,_=t.length;g<_;++g){var y=t[g];h=Vs(i,r,y,e,n,o,s,l,u,h,d),r=y[y.length-1]}return h}function Bs(i,r,t,e,n,o,s){var l=(t-r)/e;if(l<3){for(;r<t;r+=e)o[s++]=i[r],o[s++]=i[r+1];return s}var u=new Array(l);u[0]=1,u[l-1]=1;for(var h=[r,t-e],p=0;h.length>0;){for(var d=h.pop(),g=h.pop(),_=0,y=i[g],E=i[g+1],w=i[d],C=i[d+1],x=g+e;x<d;x+=e){var S=i[x],R=i[x+1],I=dh(S,R,y,E,w,C);I>_&&(p=x,_=I)}_>n&&(u[(p-r)/e]=1,g+e<p&&h.push(g,p),p+e<d&&h.push(p,d))}for(var x=0;x<l;++x)u[x]&&(o[s++]=i[r+x*e],o[s++]=i[r+x*e+1]);return s}function np(i,r,t,e,n,o,s,l){for(var u=0,h=t.length;u<h;++u){var p=t[u];s=Bs(i,r,p,e,n,o,s),l.push(s),r=p}return s}function Sr(i,r){return r*Math.round(i/r)}function ip(i,r,t,e,n,o,s){if(r==t)return s;var l=Sr(i[r],n),u=Sr(i[r+1],n);r+=e,o[s++]=l,o[s++]=u;var h,p;do if(h=Sr(i[r],n),p=Sr(i[r+1],n),r+=e,r==t)return o[s++]=h,o[s++]=p,s;while(h==l&&p==u);for(;r<t;){var d=Sr(i[r],n),g=Sr(i[r+1],n);if(r+=e,!(d==h&&g==p)){var _=h-l,y=p-u,E=d-l,w=g-u;if(_*w==y*E&&(_<0&&E<_||_==E||_>0&&E>_)&&(y<0&&w<y||y==w||y>0&&w>y)){h=d,p=g;continue}o[s++]=h,o[s++]=p,l=h,u=p,h=d,p=g}}return o[s++]=h,o[s++]=p,s}function yu(i,r,t,e,n,o,s,l){for(var u=0,h=t.length;u<h;++u){var p=t[u];s=ip(i,r,p,e,n,o,s),l.push(s),r=p}return s}function op(i,r,t,e,n,o,s,l){for(var u=0,h=t.length;u<h;++u){var p=t[u],d=[];s=yu(i,r,p,e,n,o,s,d),l.push(d),r=p[p.length-1]}return s}function sr(i,r,t,e,n){for(var o=n!==void 0?n:[],s=0,l=r;l<t;l+=e)o[s++]=i.slice(l,l+e);return o.length=s,o}function ri(i,r,t,e,n){for(var o=n!==void 0?n:[],s=0,l=0,u=t.length;l<u;++l){var h=t[l];o[s++]=sr(i,r,h,e,o[s]),r=h}return o.length=s,o}function cs(i,r,t,e,n){for(var o=n!==void 0?n:[],s=0,l=0,u=t.length;l<u;++l){var h=t[l];o[s++]=ri(i,r,h,e,o[s]),r=h[h.length-1]}return o.length=s,o}function mu(i,r,t,e){for(var n=0,o=i[t-e],s=i[t-e+1];r<t;r+=e){var l=i[r],u=i[r+1];n+=s*l-o*u,o=l,s=u}return n/2}function Eu(i,r,t,e){for(var n=0,o=0,s=t.length;o<s;++o){var l=t[o];n+=mu(i,r,l,e),r=l}return n}function sp(i,r,t,e){for(var n=0,o=0,s=t.length;o<s;++o){var l=t[o];n+=Eu(i,r,l,e),r=l[l.length-1]}return n}var ap=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),lp=function(i){ap(r,i);function r(t,e){var n=i.call(this)||this;return n.maxDelta_=-1,n.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?n.setFlatCoordinates(e,t):n.setCoordinates(t,e),n}return r.prototype.clone=function(){return new r(this.flatCoordinates.slice(),this.layout)},r.prototype.closestPointXY=function(t,e,n,o){return o<Fr(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($s(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ys(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,n,o))},r.prototype.getArea=function(){return mu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},r.prototype.getCoordinates=function(){return sr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},r.prototype.getSimplifiedGeometryInternal=function(t){var e=[];return e.length=Bs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new r(e,bt.XY)},r.prototype.getType=function(){return q.LINEAR_RING},r.prototype.intersectsExtent=function(t){return!1},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=xo(this.flatCoordinates,0,t,this.stride),this.changed()},r}(Ur),qa=lp;function wu(i,r,t,e,n){var o;for(r+=e;r<t;r+=e)if(o=n(i.slice(r-e,r),i.slice(r,r+e)),o)return o;return!1}function Tu(i,r,t,e,n,o,s){var l,u,h=(t-r)/e;if(h===1)l=r;else if(h===2)l=r,u=n;else if(h!==0){for(var p=i[r],d=i[r+1],g=0,_=[0],y=r+e;y<t;y+=e){var E=i[y],w=i[y+1];g+=Math.sqrt((E-p)*(E-p)+(w-d)*(w-d)),_.push(g),p=E,d=w}var C=n*g,x=Ph(_,C);x<0?(u=(C-_[-x-2])/(_[-x-1]-_[-x-2]),l=r+(-x-2)*e):l=r+x*e}for(var S=s>1?s:2,R=o||new Array(S),y=0;y<S;++y)R[y]=l===void 0?NaN:u===void 0?i[l+y]:ke(i[l+y],i[l+e+y],u);return R}function hs(i,r,t,e,n,o){if(t==r)return null;var s;if(n<i[r+e-1])return o?(s=i.slice(r,r+e),s[e-1]=n,s):null;if(i[t-1]<n)return o?(s=i.slice(t-e,t),s[e-1]=n,s):null;if(n==i[r+e-1])return i.slice(r,r+e);for(var l=r/e,u=t/e;l<u;){var h=l+u>>1;n<i[(h+1)*e-1]?u=h:l=h+1}var p=i[l*e-1];if(n==p)return i.slice((l-1)*e,(l-1)*e+e);var d=i[(l+1)*e-1],g=(n-p)/(d-p);s=[];for(var _=0;_<e-1;++_)s.push(ke(i[(l-1)*e+_],i[l*e+_],g));return s.push(n),s}function up(i,r,t,e,n,o,s){if(s)return hs(i,r,t[t.length-1],e,n,o);var l;if(n<i[e-1])return o?(l=i.slice(0,e),l[e-1]=n,l):null;if(i[i.length-1]<n)return o?(l=i.slice(i.length-e),l[e-1]=n,l):null;for(var u=0,h=t.length;u<h;++u){var p=t[u];if(r!=p){if(n<i[r+e-1])return null;if(n<=i[p-1])return hs(i,r,p,e,n,!1);r=p}}return null}function cp(i,r,t,e,n){var o=Rl(n,function(s){return!Ir(i,r,t,e,s[0],s[1])});return!o}function Ir(i,r,t,e,n,o){for(var s=0,l=i[t-e],u=i[t-e+1];r<t;r+=e){var h=i[r],p=i[r+1];u<=o?p>o&&(h-l)*(o-u)-(n-l)*(p-u)>0&&s++:p<=o&&(h-l)*(o-u)-(n-l)*(p-u)<0&&s--,l=h,u=p}return s!==0}function Ws(i,r,t,e,n,o){if(t.length===0||!Ir(i,r,t[0],e,n,o))return!1;for(var s=1,l=t.length;s<l;++s)if(Ir(i,t[s-1],t[s],e,n,o))return!1;return!0}function hp(i,r,t,e,n,o){if(t.length===0)return!1;for(var s=0,l=t.length;s<l;++s){var u=t[s];if(Ws(i,r,u,e,n,o))return!0;r=u[u.length-1]}return!1}function Co(i,r,t,e,n){var o=Tl(ce(),i,r,t,e);return Jt(n,o)?un(n,o)||o[0]>=n[0]&&o[2]<=n[2]||o[1]>=n[1]&&o[3]<=n[3]?!0:wu(i,r,t,e,function(s,l){return Vc(n,s,l)}):!1}function fp(i,r,t,e,n){for(var o=0,s=t.length;o<s;++o){if(Co(i,r,t[o],e,n))return!0;r=t[o]}return!1}function pp(i,r,t,e,n){return!!(Co(i,r,t,e,n)||Ir(i,r,t,e,n[0],n[1])||Ir(i,r,t,e,n[0],n[3])||Ir(i,r,t,e,n[2],n[1])||Ir(i,r,t,e,n[2],n[3]))}function Ru(i,r,t,e,n){if(!pp(i,r,t[0],e,n))return!1;if(t.length===1)return!0;for(var o=1,s=t.length;o<s;++o)if(cp(i,t[o-1],t[o],e,n)&&!Co(i,t[o-1],t[o],e,n))return!1;return!0}function dp(i,r,t,e,n){for(var o=0,s=t.length;o<s;++o){var l=t[o];if(Ru(i,r,l,e,n))return!0;r=l[l.length-1]}return!1}function Su(i,r,t,e){for(var n=i[r],o=i[r+1],s=0,l=r+e;l<t;l+=e){var u=i[l],h=i[l+1];s+=Math.sqrt((u-n)*(u-n)+(h-o)*(h-o)),n=u,o=h}return s}var gp=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),vp=function(i){gp(r,i);function r(t,e){var n=i.call(this)||this;return n.flatMidpoint_=null,n.flatMidpointRevision_=-1,n.maxDelta_=-1,n.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?n.setFlatCoordinates(e,t):n.setCoordinates(t,e),n}return r.prototype.appendCoordinate=function(t){this.flatCoordinates?Ue(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()},r.prototype.clone=function(){var t=new r(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},r.prototype.closestPointXY=function(t,e,n,o){return o<Fr(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($s(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ys(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,n,o))},r.prototype.forEachSegment=function(t){return wu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},r.prototype.getCoordinateAtM=function(t,e){if(this.layout!=bt.XYM&&this.layout!=bt.XYZM)return null;var n=e!==void 0?e:!1;return hs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,n)},r.prototype.getCoordinates=function(){return sr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},r.prototype.getCoordinateAt=function(t,e){return Tu(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)},r.prototype.getLength=function(){return Su(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},r.prototype.getFlatMidpoint=function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_},r.prototype.getSimplifiedGeometryInternal=function(t){var e=[];return e.length=Bs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new r(e,bt.XY)},r.prototype.getType=function(){return q.LINE_STRING},r.prototype.intersectsExtent=function(t){return Co(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=xo(this.flatCoordinates,0,t,this.stride),this.changed()},r}(Ur),fs=vp,_p=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),yp=function(i){_p(r,i);function r(t,e,n){var o=i.call(this)||this;if(o.ends_=[],o.maxDelta_=-1,o.maxDeltaRevision_=-1,Array.isArray(t[0]))o.setCoordinates(t,e);else if(e!==void 0&&n)o.setFlatCoordinates(e,t),o.ends_=n;else{for(var s=o.getLayout(),l=t,u=[],h=[],p=0,d=l.length;p<d;++p){var g=l[p];p===0&&(s=g.getLayout()),Ue(u,g.getFlatCoordinates()),h.push(u.length)}o.setFlatCoordinates(s,u),o.ends_=h}return o}return r.prototype.appendLineString=function(t){this.flatCoordinates?Ue(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},r.prototype.clone=function(){var t=new r(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},r.prototype.closestPointXY=function(t,e,n,o){return o<Fr(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xs(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Vs(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,n,o))},r.prototype.getCoordinateAtM=function(t,e,n){if(this.layout!=bt.XYM&&this.layout!=bt.XYZM||this.flatCoordinates.length===0)return null;var o=e!==void 0?e:!1,s=n!==void 0?n:!1;return up(this.flatCoordinates,0,this.ends_,this.stride,t,o,s)},r.prototype.getCoordinates=function(){return ri(this.flatCoordinates,0,this.ends_,this.stride)},r.prototype.getEnds=function(){return this.ends_},r.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new fs(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)},r.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,n=this.layout,o=[],s=0,l=0,u=e.length;l<u;++l){var h=e[l],p=new fs(t.slice(s,h),n);o.push(p),s=h}return o},r.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,n=0,o=this.ends_,s=this.stride,l=0,u=o.length;l<u;++l){var h=o[l],p=Tu(e,n,h,s,.5);Ue(t,p),n=h}return t},r.prototype.getSimplifiedGeometryInternal=function(t){var e=[],n=[];return e.length=np(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,n),new r(e,bt.XY,n)},r.prototype.getType=function(){return q.MULTI_LINE_STRING},r.prototype.intersectsExtent=function(t){return fp(this.flatCoordinates,0,this.ends_,this.stride,t)},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=js(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()},r}(Ur),mp=yp,Ep=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),wp=function(i){Ep(r,i);function r(t,e){var n=i.call(this)||this;return n.setCoordinates(t,e),n}return r.prototype.clone=function(){var t=new r(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},r.prototype.closestPointXY=function(t,e,n,o){var s=this.flatCoordinates,l=Pr(t,e,s[0],s[1]);if(l<o){for(var u=this.stride,h=0;h<u;++h)n[h]=s[h];return n.length=u,l}else return o},r.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]},r.prototype.computeExtent=function(t){return jc(this.flatCoordinates,t)},r.prototype.getType=function(){return q.POINT},r.prototype.intersectsExtent=function(t){return ws(t,this.flatCoordinates[0],this.flatCoordinates[1])},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Hf(this.flatCoordinates,0,t,this.stride),this.changed()},r}(Ur),ni=wp,Tp=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Rp=function(i){Tp(r,i);function r(t,e){var n=i.call(this)||this;return e&&!Array.isArray(t[0])?n.setFlatCoordinates(e,t):n.setCoordinates(t,e),n}return r.prototype.appendPoint=function(t){this.flatCoordinates?Ue(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()},r.prototype.clone=function(){var t=new r(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t},r.prototype.closestPointXY=function(t,e,n,o){if(o<Fr(this.getExtent(),t,e))return o;for(var s=this.flatCoordinates,l=this.stride,u=0,h=s.length;u<h;u+=l){var p=Pr(t,e,s[u],s[u+1]);if(p<o){o=p;for(var d=0;d<l;++d)n[d]=s[u+d];n.length=l}}return o},r.prototype.getCoordinates=function(){return sr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)},r.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new ni(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)},r.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,n=this.stride,o=[],s=0,l=t.length;s<l;s+=n){var u=new ni(t.slice(s,s+n),e);o.push(u)}return o},r.prototype.getType=function(){return q.MULTI_POINT},r.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,n=this.stride,o=0,s=e.length;o<s;o+=n){var l=e[o],u=e[o+1];if(ws(t,l,u))return!0}return!1},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=xo(this.flatCoordinates,0,t,this.stride),this.changed()},r}(Ur),xu=Rp;function Cu(i,r,t,e,n,o,s){for(var l,u,h,p,d,g,_,y=n[o+1],E=[],w=0,C=t.length;w<C;++w){var x=t[w];for(p=i[x-e],g=i[x-e+1],l=r;l<x;l+=e)d=i[l],_=i[l+1],(y<=g&&_<=y||g<=y&&y<=_)&&(h=(y-g)/(_-g)*(d-p)+p,E.push(h)),p=d,g=_}var S=NaN,R=-1/0;for(E.sort(Mr),p=E[0],l=1,u=E.length;l<u;++l){d=E[l];var I=Math.abs(d-p);I>R&&(h=(p+d)/2,Ws(i,r,t,e,h,y)&&(S=h,R=I)),p=d}return isNaN(S)&&(S=n[o]),s?(s.push(S,y,R),s):[S,y,R]}function Sp(i,r,t,e,n){for(var o=[],s=0,l=t.length;s<l;++s){var u=t[s];o=Cu(i,r,u,e,n,2*s,o),r=u[u.length-1]}return o}function xp(i,r,t,e){for(;r<t-e;){for(var n=0;n<e;++n){var o=i[r+n];i[r+n]=i[t-e+n],i[t-e+n]=o}r+=e,t-=e}}function Ou(i,r,t,e){for(var n=0,o=i[t-e],s=i[t-e+1];r<t;r+=e){var l=i[r],u=i[r+1];n+=(l-o)*(u+s),o=l,s=u}return n===0?void 0:n>0}function Iu(i,r,t,e,n){for(var o=n!==void 0?n:!1,s=0,l=t.length;s<l;++s){var u=t[s],h=Ou(i,r,u,e);if(s===0){if(o&&h||!o&&!h)return!1}else if(o&&!h||!o&&h)return!1;r=u}return!0}function Cp(i,r,t,e,n){for(var o=0,s=t.length;o<s;++o){var l=t[o];if(!Iu(i,r,l,e,n))return!1;l.length&&(r=l[l.length-1])}return!0}function ps(i,r,t,e,n){for(var o=n!==void 0?n:!1,s=0,l=t.length;s<l;++s){var u=t[s],h=Ou(i,r,u,e),p=s===0?o&&h||!o&&!h:o&&!h||!o&&h;p&&xp(i,r,u,e),r=u}return r}function Ka(i,r,t,e,n){for(var o=0,s=t.length;o<s;++o)r=ps(i,r,t[o],e,n);return r}var Op=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ii=function(i){Op(r,i);function r(t,e,n){var o=i.call(this)||this;return o.ends_=[],o.flatInteriorPointRevision_=-1,o.flatInteriorPoint_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,e!==void 0&&n?(o.setFlatCoordinates(e,t),o.ends_=n):o.setCoordinates(t,e),o}return r.prototype.appendLinearRing=function(t){this.flatCoordinates?Ue(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()},r.prototype.clone=function(){var t=new r(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t},r.prototype.closestPointXY=function(t,e,n,o){return o<Fr(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Xs(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Vs(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,n,o))},r.prototype.containsXY=function(t,e){return Ws(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)},r.prototype.getArea=function(){return Eu(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)},r.prototype.getCoordinates=function(t){var e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),ps(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,ri(e,0,this.ends_,this.stride)},r.prototype.getEnds=function(){return this.ends_},r.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=Lr(this.getExtent());this.flatInteriorPoint_=Cu(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_},r.prototype.getInteriorPoint=function(){return new ni(this.getFlatInteriorPoint(),bt.XYM)},r.prototype.getLinearRingCount=function(){return this.ends_.length},r.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new qa(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)},r.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,n=this.ends_,o=[],s=0,l=0,u=n.length;l<u;++l){var h=n[l],p=new qa(e.slice(s,h),t);o.push(p),s=h}return o},r.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Iu(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=ps(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},r.prototype.getSimplifiedGeometryInternal=function(t){var e=[],n=[];return e.length=yu(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,n),new r(e,bt.XY,n)},r.prototype.getType=function(){return q.POLYGON},r.prototype.intersectsExtent=function(t){return Ru(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var n=js(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=n.length===0?0:n[n.length-1],this.changed()},r}(Ur);function Ha(i){var r=i[0],t=i[1],e=i[2],n=i[3],o=[r,t,r,n,e,n,e,t,r,t];return new ii(o,bt.XY,[o.length])}function Ip(i,r,t,e){for(var n=[],o=ce(),s=0,l=t.length;s<l;++s){var u=t[s];o=El(i,r,u[0],e),n.push((o[0]+o[2])/2,(o[1]+o[3])/2),r=u[u.length-1]}return n}var Ap=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Pp=function(i){Ap(r,i);function r(t,e,n){var o=i.call(this)||this;if(o.endss_=[],o.flatInteriorPointsRevision_=-1,o.flatInteriorPoints_=null,o.maxDelta_=-1,o.maxDeltaRevision_=-1,o.orientedRevision_=-1,o.orientedFlatCoordinates_=null,!n&&!Array.isArray(t[0])){for(var s=o.getLayout(),l=t,u=[],h=[],p=0,d=l.length;p<d;++p){var g=l[p];p===0&&(s=g.getLayout());for(var _=u.length,y=g.getEnds(),E=0,w=y.length;E<w;++E)y[E]+=_;Ue(u,g.getFlatCoordinates()),h.push(y)}e=s,t=u,n=h}return e!==void 0&&n?(o.setFlatCoordinates(e,t),o.endss_=n):o.setCoordinates(t,e),o}return r.prototype.appendPolygon=function(t){var e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{var n=this.flatCoordinates.length;Ue(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(var o=0,s=e.length;o<s;++o)e[o]+=n}this.endss_.push(e),this.changed()},r.prototype.clone=function(){for(var t=this.endss_.length,e=new Array(t),n=0;n<t;++n)e[n]=this.endss_[n].slice();var o=new r(this.flatCoordinates.slice(),this.layout,e);return o.applyProperties(this),o},r.prototype.closestPointXY=function(t,e,n,o){return o<Fr(this.getExtent(),t,e)?o:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(ep(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),rp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,n,o))},r.prototype.containsXY=function(t,e){return hp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)},r.prototype.getArea=function(){return sp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)},r.prototype.getCoordinates=function(t){var e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Ka(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,cs(e,0,this.endss_,this.stride)},r.prototype.getEndss=function(){return this.endss_},r.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=Ip(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Sp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_},r.prototype.getInteriorPoints=function(){return new xu(this.getFlatInteriorPoints().slice(),bt.XYM)},r.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;Cp(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ka(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_},r.prototype.getSimplifiedGeometryInternal=function(t){var e=[],n=[];return e.length=op(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,n),new r(e,bt.XY,n)},r.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(t===0)e=0;else{var n=this.endss_[t-1];e=n[n.length-1]}var o=this.endss_[t].slice(),s=o[o.length-1];if(e!==0)for(var l=0,u=o.length;l<u;++l)o[l]-=e;return new ii(this.flatCoordinates.slice(e,s),this.layout,o)},r.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,n=this.endss_,o=[],s=0,l=0,u=n.length;l<u;++l){var h=n[l].slice(),p=h[h.length-1];if(s!==0)for(var d=0,g=h.length;d<g;++d)h[d]-=s;var _=new ii(e.slice(s,p),t,h);o.push(_),s=p}return o},r.prototype.getType=function(){return q.MULTI_POLYGON},r.prototype.intersectsExtent=function(t){return dp(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)},r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var n=Zf(this.flatCoordinates,0,t,this.stride,this.endss_);if(n.length===0)this.flatCoordinates.length=0;else{var o=n[n.length-1];this.flatCoordinates.length=o.length===0?0:o[o.length-1]}this.changed()},r}(Ur),bp=Pp,Qt={ADD:"add",REMOVE:"remove"},Au=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Za={LENGTH:"length"},Ui=function(i){Au(r,i);function r(t,e,n){var o=i.call(this,t)||this;return o.element=e,o.index=n,o}return r}(Ve),Lp=function(i){Au(r,i);function r(t,e){var n=i.call(this)||this;n.on,n.once,n.un;var o=e||{};if(n.unique_=!!o.unique,n.array_=t||[],n.unique_)for(var s=0,l=n.array_.length;s<l;++s)n.assertUnique_(n.array_[s],s);return n.updateLength_(),n}return r.prototype.clear=function(){for(;this.getLength()>0;)this.pop()},r.prototype.extend=function(t){for(var e=0,n=t.length;e<n;++e)this.push(t[e]);return this},r.prototype.forEach=function(t){for(var e=this.array_,n=0,o=e.length;n<o;++n)t(e[n],n,e)},r.prototype.getArray=function(){return this.array_},r.prototype.item=function(t){return this.array_[t]},r.prototype.getLength=function(){return this.get(Za.LENGTH)},r.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Ui(Qt.ADD,e,t))},r.prototype.pop=function(){return this.removeAt(this.getLength()-1)},r.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();return this.insertAt(e,t),this.getLength()},r.prototype.remove=function(t){for(var e=this.array_,n=0,o=e.length;n<o;++n)if(e[n]===t)return this.removeAt(n)},r.prototype.removeAt=function(t){var e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Ui(Qt.REMOVE,e,t)),e},r.prototype.setAt=function(t,e){var n=this.getLength();if(t<n){this.unique_&&this.assertUnique_(e,t);var o=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Ui(Qt.REMOVE,o,t)),this.dispatchEvent(new Ui(Qt.ADD,e,t))}else{for(var s=n;s<t;++s)this.insertAt(s,void 0);this.insertAt(t,e)}},r.prototype.updateLength_=function(){this.set(Za.LENGTH,this.array_.length)},r.prototype.assertUnique_=function(t,e){for(var n=0,o=this.array_.length;n<o;++n)if(this.array_[n]===t&&n!==e)throw new yl(58)},r}(Ie),ue=Lp,ur={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Mp=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Np=function(i){Mp(r,i);function r(t){var e=i.call(this)||this;if(e.on,e.once,e.un,e.id_=void 0,e.geometryName_="geometry",e.style_=null,e.styleFunction_=void 0,e.geometryChangeKey_=null,e.addChangeListener(e.geometryName_,e.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){var n=t;e.setGeometry(n)}else{var o=t;e.setProperties(o)}return e}return r.prototype.clone=function(){var t=new r(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var e=this.getGeometry();e&&t.setGeometry(e.clone());var n=this.getStyle();return n&&t.setStyle(n),t},r.prototype.getGeometry=function(){return this.get(this.geometryName_)},r.prototype.getId=function(){return this.id_},r.prototype.getGeometryName=function(){return this.geometryName_},r.prototype.getStyle=function(){return this.style_},r.prototype.getStyleFunction=function(){return this.styleFunction_},r.prototype.handleGeometryChange_=function(){this.changed()},r.prototype.handleGeometryChanged_=function(){this.geometryChangeKey_&&(wt(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=ft(t,lt.CHANGE,this.handleGeometryChange_,this)),this.changed()},r.prototype.setGeometry=function(t){this.set(this.geometryName_,t)},r.prototype.setStyle=function(t){this.style_=t,this.styleFunction_=t?Dp(t):void 0,this.changed()},r.prototype.setId=function(t){this.id_=t,this.changed()},r.prototype.setGeometryName=function(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()},r}(Ie);function Dp(i){if(typeof i=="function")return i;var r;if(Array.isArray(i))r=i;else{ht(typeof i.getZIndex=="function",41);var t=i;r=[t]}return function(){return r}}var zs=Np,_t={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"},Fp=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Gp=function(i){Fp(r,i);function r(t){var e=i.call(this)||this;e.on,e.once,e.un,e.background_=t.background;var n=Ft({},t);return typeof t.properties=="object"&&(delete n.properties,Ft(n,t.properties)),n[_t.OPACITY]=t.opacity!==void 0?t.opacity:1,ht(typeof n[_t.OPACITY]=="number",64),n[_t.VISIBLE]=t.visible!==void 0?t.visible:!0,n[_t.Z_INDEX]=t.zIndex,n[_t.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,n[_t.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,n[_t.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,n[_t.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,e.className_=n.className!==void 0?n.className:"ol-layer",delete n.className,e.setProperties(n),e.state_=null,e}return r.prototype.getBackground=function(){return this.background_},r.prototype.getClassName=function(){return this.className_},r.prototype.getLayerState=function(t){var e=this.state_||{layer:this,managed:t===void 0?!0:t},n=this.getZIndex();return e.opacity=Gt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=n===void 0&&!e.managed?1/0:n,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e},r.prototype.getLayersArray=function(t){return J()},r.prototype.getLayerStatesArray=function(t){return J()},r.prototype.getExtent=function(){return this.get(_t.EXTENT)},r.prototype.getMaxResolution=function(){return this.get(_t.MAX_RESOLUTION)},r.prototype.getMinResolution=function(){return this.get(_t.MIN_RESOLUTION)},r.prototype.getMinZoom=function(){return this.get(_t.MIN_ZOOM)},r.prototype.getMaxZoom=function(){return this.get(_t.MAX_ZOOM)},r.prototype.getOpacity=function(){return this.get(_t.OPACITY)},r.prototype.getSourceState=function(){return J()},r.prototype.getVisible=function(){return this.get(_t.VISIBLE)},r.prototype.getZIndex=function(){return this.get(_t.Z_INDEX)},r.prototype.setBackground=function(t){this.background_=t,this.changed()},r.prototype.setExtent=function(t){this.set(_t.EXTENT,t)},r.prototype.setMaxResolution=function(t){this.set(_t.MAX_RESOLUTION,t)},r.prototype.setMinResolution=function(t){this.set(_t.MIN_RESOLUTION,t)},r.prototype.setMaxZoom=function(t){this.set(_t.MAX_ZOOM,t)},r.prototype.setMinZoom=function(t){this.set(_t.MIN_ZOOM,t)},r.prototype.setOpacity=function(t){ht(typeof t=="number",64),this.set(_t.OPACITY,t)},r.prototype.setVisible=function(t){this.set(_t.VISIBLE,t)},r.prototype.setZIndex=function(t){this.set(_t.Z_INDEX,t)},r.prototype.disposeInternal=function(){this.state_&&(this.state_.layer=null,this.state_=null),i.prototype.disposeInternal.call(this)},r}(Ie),Pu=Gp,Dr={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},kp=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Up=function(i){kp(r,i);function r(t){var e=this,n=Ft({},t);delete n.source,e=i.call(this,n)||this,e.on,e.once,e.un,e.mapPrecomposeKey_=null,e.mapRenderKey_=null,e.sourceChangeKey_=null,e.renderer_=null,e.rendered=!1,t.render&&(e.render=t.render),t.map&&e.setMap(t.map),e.addChangeListener(_t.SOURCE,e.handleSourcePropertyChange_);var o=t.source?t.source:null;return e.setSource(o),e}return r.prototype.getLayersArray=function(t){var e=t||[];return e.push(this),e},r.prototype.getLayerStatesArray=function(t){var e=t||[];return e.push(this.getLayerState()),e},r.prototype.getSource=function(){return this.get(_t.SOURCE)||null},r.prototype.getRenderSource=function(){return this.getSource()},r.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():Dr.UNDEFINED},r.prototype.handleSourceChange_=function(){this.changed()},r.prototype.handleSourcePropertyChange_=function(){this.sourceChangeKey_&&(wt(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=ft(t,lt.CHANGE,this.handleSourceChange_,this)),this.changed()},r.prototype.getFeatures=function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(function(e){return e([])})},r.prototype.getData=function(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)},r.prototype.render=function(t,e){var n=this.getRenderer();if(n.prepareFrame(t))return this.rendered=!0,n.renderFrame(t,e)},r.prototype.unrender=function(){this.rendered=!1},r.prototype.setMapInternal=function(t){t||this.unrender(),this.set(_t.MAP,t)},r.prototype.getMapInternal=function(){return this.get(_t.MAP)},r.prototype.setMap=function(t){this.mapPrecomposeKey_&&(wt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(wt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=ft(t,ur.PRECOMPOSE,function(e){var n=e,o=n.frameState.layerStatesArray,s=this.getLayerState(!1);ht(!o.some(function(l){return l.layer===s.layer}),67),o.push(s)},this),this.mapRenderKey_=ft(this,lt.CHANGE,t.render,t),this.changed())},r.prototype.setSource=function(t){this.set(_t.SOURCE,t)},r.prototype.getRenderer=function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_},r.prototype.hasRenderer=function(){return!!this.renderer_},r.prototype.createRenderer=function(){return null},r.prototype.disposeInternal=function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),i.prototype.disposeInternal.call(this)},r}(Pu);function ao(i,r){if(!i.visible)return!1;var t=r.resolution;if(t<i.minResolution||t>=i.maxResolution)return!1;var e=r.zoom;return e>i.minZoom&&e<=i.maxZoom}var Oo=Up;function jp(i,r,t,e,n){bu(i,r,t||0,e||i.length-1,n||$p)}function bu(i,r,t,e,n){for(;e>t;){if(e-t>600){var o=e-t+1,s=r-t+1,l=Math.log(o),u=.5*Math.exp(2*l/3),h=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1),p=Math.max(t,Math.floor(r-s*u/o+h)),d=Math.min(e,Math.floor(r+(o-s)*u/o+h));bu(i,r,p,d,n)}var g=i[r],_=t,y=e;for(jn(i,t,r),n(i[e],g)>0&&jn(i,t,e);_<y;){for(jn(i,_,y),_++,y--;n(i[_],g)<0;)_++;for(;n(i[y],g)>0;)y--}n(i[t],g)===0?jn(i,t,y):(y++,jn(i,y,e)),y<=r&&(t=y+1),r<=y&&(e=y-1)}}function jn(i,r,t){var e=i[r];i[r]=i[t],i[t]=e}function $p(i,r){return i<r?-1:i>r?1:0}class Lu{constructor(r=9){this._maxEntries=Math.max(4,r),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(r){let t=this.data;const e=[];if(!$i(r,t))return e;const n=this.toBBox,o=[];for(;t;){for(let s=0;s<t.children.length;s++){const l=t.children[s],u=t.leaf?n(l):l;$i(r,u)&&(t.leaf?e.push(l):Fo(r,u)?this._all(l,e):o.push(l))}t=o.pop()}return e}collides(r){let t=this.data;if(!$i(r,t))return!1;const e=[];for(;t;){for(let n=0;n<t.children.length;n++){const o=t.children[n],s=t.leaf?this.toBBox(o):o;if($i(r,s)){if(t.leaf||Fo(r,s))return!0;e.push(o)}}t=e.pop()}return!1}load(r){if(!(r&&r.length))return this;if(r.length<this._minEntries){for(let e=0;e<r.length;e++)this.insert(r[e]);return this}let t=this._build(r.slice(),0,r.length-1,0);if(!this.data.children.length)this.data=t;else if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}return this}insert(r){return r&&this._insert(r,this.data.height-1),this}clear(){return this.data=sn([]),this}remove(r,t){if(!r)return this;let e=this.data;const n=this.toBBox(r),o=[],s=[];let l,u,h;for(;e||o.length;){if(e||(e=o.pop(),u=o[o.length-1],l=s.pop(),h=!0),e.leaf){const p=Xp(r,e.children,t);if(p!==-1)return e.children.splice(p,1),o.push(e),this._condense(o),this}!h&&!e.leaf&&Fo(e,n)?(o.push(e),s.push(l),l=0,u=e,e=e.children[0]):u?(l++,e=u.children[l],h=!1):e=null}return this}toBBox(r){return r}compareMinX(r,t){return r.minX-t.minX}compareMinY(r,t){return r.minY-t.minY}toJSON(){return this.data}fromJSON(r){return this.data=r,this}_all(r,t){const e=[];for(;r;)r.leaf?t.push(...r.children):e.push(...r.children),r=e.pop();return t}_build(r,t,e,n){const o=e-t+1;let s=this._maxEntries,l;if(o<=s)return l=sn(r.slice(t,e+1)),en(l,this.toBBox),l;n||(n=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,n-1))),l=sn([]),l.leaf=!1,l.height=n;const u=Math.ceil(o/s),h=u*Math.ceil(Math.sqrt(s));Ja(r,t,e,h,this.compareMinX);for(let p=t;p<=e;p+=h){const d=Math.min(p+h-1,e);Ja(r,p,d,u,this.compareMinY);for(let g=p;g<=d;g+=u){const _=Math.min(g+u-1,d);l.children.push(this._build(r,g,_,n-1))}}return en(l,this.toBBox),l}_chooseSubtree(r,t,e,n){for(;n.push(t),!(t.leaf||n.length-1===e);){let o=1/0,s=1/0,l;for(let u=0;u<t.children.length;u++){const h=t.children[u],p=Do(h),d=Bp(r,h)-p;d<s?(s=d,o=p<o?p:o,l=h):d===s&&p<o&&(o=p,l=h)}t=l||t.children[0]}return t}_insert(r,t,e){const n=e?r:this.toBBox(r),o=[],s=this._chooseSubtree(n,this.data,t,o);for(s.children.push(r),Yn(s,n);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(n,o,t)}_split(r,t){const e=r[t],n=e.children.length,o=this._minEntries;this._chooseSplitAxis(e,o,n);const s=this._chooseSplitIndex(e,o,n),l=sn(e.children.splice(s,e.children.length-s));l.height=e.height,l.leaf=e.leaf,en(e,this.toBBox),en(l,this.toBBox),t?r[t-1].children.push(l):this._splitRoot(e,l)}_splitRoot(r,t){this.data=sn([r,t]),this.data.height=r.height+1,this.data.leaf=!1,en(this.data,this.toBBox)}_chooseSplitIndex(r,t,e){let n,o=1/0,s=1/0;for(let l=t;l<=e-t;l++){const u=Xn(r,0,l,this.toBBox),h=Xn(r,l,e,this.toBBox),p=Wp(u,h),d=Do(u)+Do(h);p<o?(o=p,n=l,s=d<s?d:s):p===o&&d<s&&(s=d,n=l)}return n||e-t}_chooseSplitAxis(r,t,e){const n=r.leaf?this.compareMinX:Yp,o=r.leaf?this.compareMinY:Vp,s=this._allDistMargin(r,t,e,n),l=this._allDistMargin(r,t,e,o);s<l&&r.children.sort(n)}_allDistMargin(r,t,e,n){r.children.sort(n);const o=this.toBBox,s=Xn(r,0,t,o),l=Xn(r,e-t,e,o);let u=ji(s)+ji(l);for(let h=t;h<e-t;h++){const p=r.children[h];Yn(s,r.leaf?o(p):p),u+=ji(s)}for(let h=e-t-1;h>=t;h--){const p=r.children[h];Yn(l,r.leaf?o(p):p),u+=ji(l)}return u}_adjustParentBBoxes(r,t,e){for(let n=e;n>=0;n--)Yn(t[n],r)}_condense(r){for(let t=r.length-1,e;t>=0;t--)r[t].children.length===0?t>0?(e=r[t-1].children,e.splice(e.indexOf(r[t]),1)):this.clear():en(r[t],this.toBBox)}}function Xp(i,r,t){if(!t)return r.indexOf(i);for(let e=0;e<r.length;e++)if(t(i,r[e]))return e;return-1}function en(i,r){Xn(i,0,i.children.length,r,i)}function Xn(i,r,t,e,n){n||(n=sn(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let o=r;o<t;o++){const s=i.children[o];Yn(n,i.leaf?e(s):s)}return n}function Yn(i,r){return i.minX=Math.min(i.minX,r.minX),i.minY=Math.min(i.minY,r.minY),i.maxX=Math.max(i.maxX,r.maxX),i.maxY=Math.max(i.maxY,r.maxY),i}function Yp(i,r){return i.minX-r.minX}function Vp(i,r){return i.minY-r.minY}function Do(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function ji(i){return i.maxX-i.minX+(i.maxY-i.minY)}function Bp(i,r){return(Math.max(r.maxX,i.maxX)-Math.min(r.minX,i.minX))*(Math.max(r.maxY,i.maxY)-Math.min(r.minY,i.minY))}function Wp(i,r){const t=Math.max(i.minX,r.minX),e=Math.max(i.minY,r.minY),n=Math.min(i.maxX,r.maxX),o=Math.min(i.maxY,r.maxY);return Math.max(0,n-t)*Math.max(0,o-e)}function Fo(i,r){return i.minX<=r.minX&&i.minY<=r.minY&&r.maxX<=i.maxX&&r.maxY<=i.maxY}function $i(i,r){return r.minX<=i.maxX&&r.minY<=i.maxY&&r.maxX>=i.minX&&r.maxY>=i.minY}function sn(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ja(i,r,t,e,n){const o=[r,t];for(;o.length;){if(t=o.pop(),r=o.pop(),t-r<=e)continue;const s=r+Math.ceil((t-r)/e/2)*e;jp(i,s,r,t,n),o.push(r,s,s,t)}}var zp=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Qa={RENDER_ORDER:"renderOrder"},qp=function(i){zp(r,i);function r(t){var e=this,n=t||{},o=Ft({},n);return delete o.style,delete o.renderBuffer,delete o.updateWhileAnimating,delete o.updateWhileInteracting,e=i.call(this,o)||this,e.declutter_=n.declutter!==void 0?n.declutter:!1,e.renderBuffer_=n.renderBuffer!==void 0?n.renderBuffer:100,e.style_=null,e.styleFunction_=void 0,e.setStyle(n.style),e.updateWhileAnimating_=n.updateWhileAnimating!==void 0?n.updateWhileAnimating:!1,e.updateWhileInteracting_=n.updateWhileInteracting!==void 0?n.updateWhileInteracting:!1,e}return r.prototype.getDeclutter=function(){return this.declutter_},r.prototype.getFeatures=function(t){return i.prototype.getFeatures.call(this,t)},r.prototype.getRenderBuffer=function(){return this.renderBuffer_},r.prototype.getRenderOrder=function(){return this.get(Qa.RENDER_ORDER)},r.prototype.getStyle=function(){return this.style_},r.prototype.getStyleFunction=function(){return this.styleFunction_},r.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_},r.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_},r.prototype.renderDeclutter=function(t){t.declutterTree||(t.declutterTree=new Lu(9)),this.getRenderer().renderDeclutter(t)},r.prototype.setRenderOrder=function(t){this.set(Qa.RENDER_ORDER,t)},r.prototype.setStyle=function(t){this.style_=t!==void 0?t:ff,this.styleFunction_=t===null?void 0:hf(this.style_),this.changed()},r}(Oo),Kp=qp,fi={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Xi=[fi.FILL],ar=[fi.STROKE],Ar=[fi.BEGIN_PATH],tl=[fi.CLOSE_PATH],tt=fi,Hp=function(){function i(){}return i.prototype.drawCustom=function(r,t,e,n){},i.prototype.drawGeometry=function(r){},i.prototype.setStyle=function(r){},i.prototype.drawCircle=function(r,t){},i.prototype.drawFeature=function(r,t){},i.prototype.drawGeometryCollection=function(r,t){},i.prototype.drawLineString=function(r,t){},i.prototype.drawMultiLineString=function(r,t){},i.prototype.drawMultiPoint=function(r,t){},i.prototype.drawMultiPolygon=function(r,t){},i.prototype.drawPoint=function(r,t){},i.prototype.drawPolygon=function(r,t){},i.prototype.drawText=function(r,t){},i.prototype.setFillStrokeStyle=function(r,t){},i.prototype.setImageStyle=function(r,t){},i.prototype.setTextStyle=function(r,t){},i}(),Mu=Hp,Zp=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Jp=function(i){Zp(r,i);function r(t,e,n,o){var s=i.call(this)||this;return s.tolerance=t,s.maxExtent=e,s.pixelRatio=o,s.maxLineWidth=0,s.resolution=n,s.beginGeometryInstruction1_=null,s.beginGeometryInstruction2_=null,s.bufferedMaxExtent_=null,s.instructions=[],s.coordinates=[],s.tmpCoordinate_=[],s.hitDetectionInstructions=[],s.state={},s}return r.prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return e==1?t:t.map(function(n){return n*e})},r.prototype.appendFlatPointCoordinates=function(t,e){for(var n=this.getBufferedMaxExtent(),o=this.tmpCoordinate_,s=this.coordinates,l=s.length,u=0,h=t.length;u<h;u+=e)o[0]=t[u],o[1]=t[u+1],oi(n,o)&&(s[l++]=o[0],s[l++]=o[1]);return l},r.prototype.appendFlatLineCoordinates=function(t,e,n,o,s,l){var u=this.coordinates,h=u.length,p=this.getBufferedMaxExtent();l&&(e+=o);var d=t[e],g=t[e+1],_=this.tmpCoordinate_,y=!0,E,w,C;for(E=e+o;E<n;E+=o)_[0]=t[E],_[1]=t[E+1],C=Ko(p,_),C!==w?(y&&(u[h++]=d,u[h++]=g,y=!1),u[h++]=_[0],u[h++]=_[1]):C===jt.INTERSECTING?(u[h++]=_[0],u[h++]=_[1],y=!1):y=!0,d=_[0],g=_[1],w=C;return(s&&y||E===e+o)&&(u[h++]=d,u[h++]=g),h},r.prototype.drawCustomCoordinates_=function(t,e,n,o,s){for(var l=0,u=n.length;l<u;++l){var h=n[l],p=this.appendFlatLineCoordinates(t,e,h,o,!1,!1);s.push(p),e=h}return e},r.prototype.drawCustom=function(t,e,n,o){this.beginGeometry(t,e);var s=t.getType(),l=t.getStride(),u=this.coordinates.length,h,p,d,g,_;switch(s){case q.MULTI_POLYGON:h=t.getOrientedFlatCoordinates(),g=[];var y=t.getEndss();_=0;for(var E=0,w=y.length;E<w;++E){var C=[];_=this.drawCustomCoordinates_(h,_,y[E],l,C),g.push(C)}this.instructions.push([tt.CUSTOM,u,g,t,n,cs]),this.hitDetectionInstructions.push([tt.CUSTOM,u,g,t,o||n,cs]);break;case q.POLYGON:case q.MULTI_LINE_STRING:d=[],h=s==q.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),_=this.drawCustomCoordinates_(h,0,t.getEnds(),l,d),this.instructions.push([tt.CUSTOM,u,d,t,n,ri]),this.hitDetectionInstructions.push([tt.CUSTOM,u,d,t,o||n,ri]);break;case q.LINE_STRING:case q.CIRCLE:h=t.getFlatCoordinates(),p=this.appendFlatLineCoordinates(h,0,h.length,l,!1,!1),this.instructions.push([tt.CUSTOM,u,p,t,n,sr]),this.hitDetectionInstructions.push([tt.CUSTOM,u,p,t,o||n,sr]);break;case q.MULTI_POINT:h=t.getFlatCoordinates(),p=this.appendFlatPointCoordinates(h,l),p>u&&(this.instructions.push([tt.CUSTOM,u,p,t,n,sr]),this.hitDetectionInstructions.push([tt.CUSTOM,u,p,t,o||n,sr]));break;case q.POINT:h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),p=this.coordinates.length,this.instructions.push([tt.CUSTOM,u,p,t,n]),this.hitDetectionInstructions.push([tt.CUSTOM,u,p,t,o||n]);break}this.endGeometry(e)},r.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[tt.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[tt.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)},r.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}},r.prototype.reverseHitDetectionInstructions=function(){var t=this.hitDetectionInstructions;t.reverse();var e,n=t.length,o,s,l=-1;for(e=0;e<n;++e)o=t[e],s=o[0],s==tt.END_GEOMETRY?l=e:s==tt.BEGIN_GEOMETRY&&(o[2]=e,bh(this.hitDetectionInstructions,l,e),l=-1)},r.prototype.setFillStrokeStyle=function(t,e){var n=this.state;if(t){var o=t.getColor();n.fillStyle=Se(o||je)}else n.fillStyle=void 0;if(e){var s=e.getColor();n.strokeStyle=Se(s||Jn);var l=e.getLineCap();n.lineCap=l!==void 0?l:eo;var u=e.getLineDash();n.lineDash=u?u.slice():Kn;var h=e.getLineDashOffset();n.lineDashOffset=h||Hn;var p=e.getLineJoin();n.lineJoin=p!==void 0?p:wn;var d=e.getWidth();n.lineWidth=d!==void 0?d:ti;var g=e.getMiterLimit();n.miterLimit=g!==void 0?g:Zn,n.lineWidth>this.maxLineWidth&&(this.maxLineWidth=n.lineWidth,this.bufferedMaxExtent_=null)}else n.strokeStyle=void 0,n.lineCap=void 0,n.lineDash=null,n.lineDashOffset=void 0,n.lineJoin=void 0,n.lineWidth=void 0,n.miterLimit=void 0},r.prototype.createFill=function(t){var e=t.fillStyle,n=[tt.SET_FILL_STYLE,e];return typeof e!="string"&&n.push(!0),n},r.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))},r.prototype.createStroke=function(t){return[tt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]},r.prototype.updateFillStyle=function(t,e){var n=t.fillStyle;(typeof n!="string"||t.currentFillStyle!=n)&&(n!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=n)},r.prototype.updateStrokeStyle=function(t,e){var n=t.strokeStyle,o=t.lineCap,s=t.lineDash,l=t.lineDashOffset,u=t.lineJoin,h=t.lineWidth,p=t.miterLimit;(t.currentStrokeStyle!=n||t.currentLineCap!=o||s!=t.currentLineDash&&!kr(t.currentLineDash,s)||t.currentLineDashOffset!=l||t.currentLineJoin!=u||t.currentLineWidth!=h||t.currentMiterLimit!=p)&&(n!==void 0&&e.call(this,t),t.currentStrokeStyle=n,t.currentLineCap=o,t.currentLineDash=s,t.currentLineDashOffset=l,t.currentLineJoin=u,t.currentLineWidth=h,t.currentMiterLimit=p)},r.prototype.endGeometry=function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[tt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)},r.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=ml(this.maxExtent),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;Es(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_},r}(Mu),pi=Jp,Qp=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),td=function(i){Qp(r,i);function r(t,e,n,o){var s=i.call(this,t,e,n,o)||this;return s.hitDetectionImage_=null,s.image_=null,s.imagePixelRatio_=void 0,s.anchorX_=void 0,s.anchorY_=void 0,s.height_=void 0,s.opacity_=void 0,s.originX_=void 0,s.originY_=void 0,s.rotateWithView_=void 0,s.rotation_=void 0,s.scale_=void 0,s.width_=void 0,s.declutterImageWithText_=void 0,s}return r.prototype.drawPoint=function(t,e){if(!!this.image_){this.beginGeometry(t,e);var n=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length,l=this.appendFlatPointCoordinates(n,o);this.instructions.push([tt.DRAW_IMAGE,s,l,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([tt.DRAW_IMAGE,s,l,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},r.prototype.drawMultiPoint=function(t,e){if(!!this.image_){this.beginGeometry(t,e);var n=t.getFlatCoordinates(),o=t.getStride(),s=this.coordinates.length,l=this.appendFlatPointCoordinates(n,o);this.instructions.push([tt.DRAW_IMAGE,s,l,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterImageWithText_]),this.hitDetectionInstructions.push([tt.DRAW_IMAGE,s,l,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterImageWithText_]),this.endGeometry(e)}},r.prototype.finish=function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,i.prototype.finish.call(this)},r.prototype.setImageStyle=function(t,e){var n=t.getAnchor(),o=t.getSize(),s=t.getHitDetectionImage(),l=t.getImage(this.pixelRatio),u=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=n[0],this.anchorY_=n[1],this.hitDetectionImage_=s,this.image_=l,this.height_=o[1],this.opacity_=t.getOpacity(),this.originX_=u[0]*this.imagePixelRatio_,this.originY_=u[1]*this.imagePixelRatio_,this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=o[0],this.declutterImageWithText_=e},r}(pi),ed=td,rd=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),nd=function(i){rd(r,i);function r(t,e,n,o){return i.call(this,t,e,n,o)||this}return r.prototype.drawFlatCoordinates_=function(t,e,n,o){var s=this.coordinates.length,l=this.appendFlatLineCoordinates(t,e,n,o,!1,!1),u=[tt.MOVE_TO_LINE_TO,s,l];return this.instructions.push(u),this.hitDetectionInstructions.push(u),n},r.prototype.drawLineString=function(t,e){var n=this.state,o=n.strokeStyle,s=n.lineWidth;if(!(o===void 0||s===void 0)){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([tt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,Kn,Hn],Ar);var l=t.getFlatCoordinates(),u=t.getStride();this.drawFlatCoordinates_(l,0,l.length,u),this.hitDetectionInstructions.push(ar),this.endGeometry(e)}},r.prototype.drawMultiLineString=function(t,e){var n=this.state,o=n.strokeStyle,s=n.lineWidth;if(!(o===void 0||s===void 0)){this.updateStrokeStyle(n,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([tt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset],Ar);for(var l=t.getEnds(),u=t.getFlatCoordinates(),h=t.getStride(),p=0,d=0,g=l.length;d<g;++d)p=this.drawFlatCoordinates_(u,p,l[d],h);this.hitDetectionInstructions.push(ar),this.endGeometry(e)}},r.prototype.finish=function(){var t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ar),this.reverseHitDetectionInstructions(),this.state=null,i.prototype.finish.call(this)},r.prototype.applyStroke=function(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ar),t.lastStroke=this.coordinates.length),t.lastStroke=0,i.prototype.applyStroke.call(this,t),this.instructions.push(Ar)},r}(pi),id=nd,od=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),sd=function(i){od(r,i);function r(t,e,n,o){return i.call(this,t,e,n,o)||this}return r.prototype.drawFlatCoordinatess_=function(t,e,n,o){var s=this.state,l=s.fillStyle!==void 0,u=s.strokeStyle!==void 0,h=n.length;this.instructions.push(Ar),this.hitDetectionInstructions.push(Ar);for(var p=0;p<h;++p){var d=n[p],g=this.coordinates.length,_=this.appendFlatLineCoordinates(t,e,d,o,!0,!u),y=[tt.MOVE_TO_LINE_TO,g,_];this.instructions.push(y),this.hitDetectionInstructions.push(y),u&&(this.instructions.push(tl),this.hitDetectionInstructions.push(tl)),e=d}return l&&(this.instructions.push(Xi),this.hitDetectionInstructions.push(Xi)),u&&(this.instructions.push(ar),this.hitDetectionInstructions.push(ar)),e},r.prototype.drawCircle=function(t,e){var n=this.state,o=n.fillStyle,s=n.strokeStyle;if(!(o===void 0&&s===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([tt.SET_FILL_STYLE,je]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([tt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var l=t.getFlatCoordinates(),u=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(l,0,l.length,u,!1,!1);var p=[tt.CIRCLE,h];this.instructions.push(Ar,p),this.hitDetectionInstructions.push(Ar,p),n.fillStyle!==void 0&&(this.instructions.push(Xi),this.hitDetectionInstructions.push(Xi)),n.strokeStyle!==void 0&&(this.instructions.push(ar),this.hitDetectionInstructions.push(ar)),this.endGeometry(e)}},r.prototype.drawPolygon=function(t,e){var n=this.state,o=n.fillStyle,s=n.strokeStyle;if(!(o===void 0&&s===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([tt.SET_FILL_STYLE,je]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([tt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);var l=t.getEnds(),u=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(u,0,l,h),this.endGeometry(e)}},r.prototype.drawMultiPolygon=function(t,e){var n=this.state,o=n.fillStyle,s=n.strokeStyle;if(!(o===void 0&&s===void 0)){this.setFillStrokeStyles_(),this.beginGeometry(t,e),n.fillStyle!==void 0&&this.hitDetectionInstructions.push([tt.SET_FILL_STYLE,je]),n.strokeStyle!==void 0&&this.hitDetectionInstructions.push([tt.SET_STROKE_STYLE,n.strokeStyle,n.lineWidth,n.lineCap,n.lineJoin,n.miterLimit,n.lineDash,n.lineDashOffset]);for(var l=t.getEndss(),u=t.getOrientedFlatCoordinates(),h=t.getStride(),p=0,d=0,g=l.length;d<g;++d)p=this.drawFlatCoordinatess_(u,p,l[d],h);this.endGeometry(e)}},r.prototype.finish=function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(t!==0)for(var e=this.coordinates,n=0,o=e.length;n<o;++n)e[n]=Sr(e[n],t);return i.prototype.finish.call(this)},r.prototype.setFillStrokeStyles_=function(){var t=this.state,e=t.fillStyle;e!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)},r}(pi),el=sd;function ad(i,r,t,e,n){var o=t,s=t,l=0,u=0,h=t,p,d,g,_,y,E,w,C,x,S;for(d=t;d<e;d+=n){var R=r[d],I=r[d+1];y!==void 0&&(x=R-y,S=I-E,_=Math.sqrt(x*x+S*S),w!==void 0&&(u+=g,p=Math.acos((w*x+C*S)/(g*_)),p>i&&(u>l&&(l=u,o=h,s=d),u=0,h=d-n)),g=_,w=x,C=S),y=R,E=I}return u+=_,u>l?[h,d]:[o,s]}var ld=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),lo={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},ud=function(i){ld(r,i);function r(t,e,n,o){var s=i.call(this,t,e,n,o)||this;return s.labels_=null,s.text_="",s.textOffsetX_=0,s.textOffsetY_=0,s.textRotateWithView_=void 0,s.textRotation_=0,s.textFillState_=null,s.fillStates={},s.textStrokeState_=null,s.strokeStates={},s.textState_={},s.textStates={},s.textKey_="",s.fillKey_="",s.strokeKey_="",s.declutterImageWithText_=void 0,s}return r.prototype.finish=function(){var t=i.prototype.finish.call(this);return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t},r.prototype.drawText=function(t,e){var n=this.textFillState_,o=this.textStrokeState_,s=this.textState_;if(!(this.text_===""||!s||!n&&!o)){var l=this.coordinates,u=l.length,h=t.getType(),p=null,d=t.getStride();if(s.placement===pf.LINE&&(h==q.LINE_STRING||h==q.MULTI_LINE_STRING||h==q.POLYGON||h==q.MULTI_POLYGON)){if(!Jt(this.getBufferedMaxExtent(),t.getExtent()))return;var g=void 0;if(p=t.getFlatCoordinates(),h==q.LINE_STRING)g=[p.length];else if(h==q.MULTI_LINE_STRING)g=t.getEnds();else if(h==q.POLYGON)g=t.getEnds().slice(0,1);else if(h==q.MULTI_POLYGON){var _=t.getEndss();g=[];for(var y=0,E=_.length;y<E;++y)g.push(_[y][0])}this.beginGeometry(t,e);for(var w=s.textAlign,C=0,x=void 0,S=0,R=g.length;S<R;++S){if(w==null){var I=ad(s.maxAngle,p,C,g[S],d);C=I[0],x=I[1]}else x=g[S];for(var y=C;y<x;y+=d)l.push(p[y],p[y+1]);var b=l.length;C=g[S],this.drawChars_(u,b),u=b}this.endGeometry(e)}else{var F=s.overflow?null:[];switch(h){case q.POINT:case q.MULTI_POINT:p=t.getFlatCoordinates();break;case q.LINE_STRING:p=t.getFlatMidpoint();break;case q.CIRCLE:p=t.getCenter();break;case q.MULTI_LINE_STRING:p=t.getFlatMidpoints(),d=2;break;case q.POLYGON:p=t.getFlatInteriorPoint(),s.overflow||F.push(p[2]/this.resolution),d=3;break;case q.MULTI_POLYGON:var A=t.getFlatInteriorPoints();p=[];for(var y=0,E=A.length;y<E;y+=3)s.overflow||F.push(A[y+2]/this.resolution),p.push(A[y],A[y+1]);if(p.length===0)return;d=2;break}var b=this.appendFlatPointCoordinates(p,d);if(b===u)return;if(F&&(b-u)/2!==p.length/d){var M=u/2;F=F.filter(function(Q,ot){var rt=l[(M+ot)*2]===p[ot*d]&&l[(M+ot)*2+1]===p[ot*d+1];return rt||--M,rt})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var j=s.padding;if(j!=Cr&&(s.scale[0]<0||s.scale[1]<0)){var k=s.padding[0],U=s.padding[1],X=s.padding[2],K=s.padding[3];s.scale[0]<0&&(U=-U,K=-K),s.scale[1]<0&&(k=-k,X=-X),j=[k,U,X,K]}var Y=this.pixelRatio;this.instructions.push([tt.DRAW_IMAGE,u,b,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterImageWithText_,j==Cr?Cr:j.map(function(Q){return Q*Y}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,F]);var N=1/Y;this.hitDetectionInstructions.push([tt.DRAW_IMAGE,u,b,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[N,N],NaN,this.declutterImageWithText_,j,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,F]),this.endGeometry(e)}}},r.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,n=this.textFillState_,o=this.strokeKey_;t&&(o in this.strokeStates||(this.strokeStates[o]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||Qn,textBaseline:e.textBaseline||ro,scale:e.scale});var l=this.fillKey_;n&&(l in this.fillStates||(this.fillStates[l]={fillStyle:n.fillStyle}))},r.prototype.drawChars_=function(t,e){var n=this.textStrokeState_,o=this.textState_,s=this.strokeKey_,l=this.textKey_,u=this.fillKey_;this.saveTextStates_();var h=this.pixelRatio,p=lo[o.textBaseline],d=this.textOffsetY_*h,g=this.text_,_=n?n.lineWidth*Math.abs(o.scale[0])/2:0;this.instructions.push([tt.DRAW_CHARS,t,e,p,o.overflow,u,o.maxAngle,h,d,s,_*h,g,l,1]),this.hitDetectionInstructions.push([tt.DRAW_CHARS,t,e,p,o.overflow,u,o.maxAngle,1,d,s,_,g,l,1/h])},r.prototype.setTextStyle=function(t,e){var n,o,s;if(!t)this.text_="";else{var l=t.getFill();l?(o=this.textFillState_,o||(o={},this.textFillState_=o),o.fillStyle=Se(l.getColor()||je)):(o=null,this.textFillState_=o);var u=t.getStroke();if(!u)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);var h=u.getLineDash(),p=u.getLineDashOffset(),d=u.getWidth(),g=u.getMiterLimit();s.lineCap=u.getLineCap()||eo,s.lineDash=h?h.slice():Kn,s.lineDashOffset=p===void 0?Hn:p,s.lineJoin=u.getLineJoin()||wn,s.lineWidth=d===void 0?ti:d,s.miterLimit=g===void 0?Zn:g,s.strokeStyle=Se(u.getColor()||Jn)}n=this.textState_;var _=t.getFont()||nu;$h(_);var y=t.getScaleArray();n.overflow=t.getOverflow(),n.font=_,n.maxAngle=t.getMaxAngle(),n.placement=t.getPlacement(),n.textAlign=t.getTextAlign(),n.textBaseline=t.getTextBaseline()||ro,n.backgroundFill=t.getBackgroundFill(),n.backgroundStroke=t.getBackgroundStroke(),n.padding=t.getPadding()||Cr,n.scale=y===void 0?[1,1]:y;var E=t.getOffsetX(),w=t.getOffsetY(),C=t.getRotateWithView(),x=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=E===void 0?0:E,this.textOffsetY_=w===void 0?0:w,this.textRotateWithView_=C===void 0?!1:C,this.textRotation_=x===void 0?0:x,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:gt(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=n.font+n.scale+(n.textAlign||"?")+(n.textBaseline||"?"),this.fillKey_=o?typeof o.fillStyle=="string"?o.fillStyle:"|"+gt(o.fillStyle):""}this.declutterImageWithText_=e},r}(pi),cd=ud,hd={Circle:el,Default:pi,Image:ed,LineString:id,Polygon:el,Text:cd},fd=function(){function i(r,t,e,n){this.tolerance_=r,this.maxExtent_=t,this.pixelRatio_=n,this.resolution_=e,this.buildersByZIndex_={}}return i.prototype.finish=function(){var r={};for(var t in this.buildersByZIndex_){r[t]=r[t]||{};var e=this.buildersByZIndex_[t];for(var n in e){var o=e[n].finish();r[t][n]=o}}return r},i.prototype.getBuilder=function(r,t){var e=r!==void 0?r.toString():"0",n=this.buildersByZIndex_[e];n===void 0&&(n={},this.buildersByZIndex_[e]=n);var o=n[t];if(o===void 0){var s=hd[t];o=new s(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[t]=o}return o},i}(),rl=fd,pd=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),dd=function(i){pd(r,i);function r(t){var e=i.call(this)||this;return e.ready=!0,e.boundHandleImageChange_=e.handleImageChange_.bind(e),e.layer_=t,e.declutterExecutorGroup=null,e}return r.prototype.getFeatures=function(t){return J()},r.prototype.getData=function(t){return null},r.prototype.prepareFrame=function(t){return J()},r.prototype.renderFrame=function(t,e){return J()},r.prototype.loadedTileCallback=function(t,e,n){t[e]||(t[e]={}),t[e][n.tileCoord.toString()]=n},r.prototype.createLoadedTileFinder=function(t,e,n){return function(o,s){var l=this.loadedTileCallback.bind(this,n,o);return t.forEachLoadedTile(e,o,s,l)}.bind(this)},r.prototype.forEachFeatureAtCoordinate=function(t,e,n,o,s){},r.prototype.getDataAtPixel=function(t,e,n){return null},r.prototype.getLayer=function(){return this.layer_},r.prototype.handleFontsChanged=function(){},r.prototype.handleImageChange_=function(t){var e=t.target;e.getState()===mt.LOADED&&this.renderIfReadyAndVisible()},r.prototype.loadImage=function(t){var e=t.getState();return e!=mt.LOADED&&e!=mt.ERROR&&t.addEventListener(lt.CHANGE,this.boundHandleImageChange_),e==mt.IDLE&&(t.load(),e=t.getState()),e==mt.LOADED},r.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==Dr.READY&&t.changed()},r.prototype.disposeInternal=function(){delete this.layer_,i.prototype.disposeInternal.call(this)},r}(Ql),gd=dd,vd=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),_d=function(i){vd(r,i);function r(t,e,n,o){var s=i.call(this,t)||this;return s.inversePixelTransform=e,s.frameState=n,s.context=o,s}return r}(Ve),Nu=_d,yd=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Vn=null;function md(){var i=document.createElement("canvas");i.width=1,i.height=1,Vn=i.getContext("2d")}var Ed=function(i){yd(r,i);function r(t){var e=i.call(this,t)||this;return e.container=null,e.renderedResolution,e.tempTransform=Ce(),e.pixelTransform=Ce(),e.inversePixelTransform=Ce(),e.context=null,e.containerReused=!1,e.pixelContext_=null,e.frameState=null,e}return r.prototype.getImageData=function(t,e,n){Vn||md(),Vn.clearRect(0,0,1,1);var o;try{Vn.drawImage(t,e,n,1,1,0,0,1,1),o=Vn.getImageData(0,0,1,1).data}catch{return null}return o},r.prototype.getBackground=function(t){var e=this.getLayer(),n=e.getBackground();return typeof n=="function"&&(n=n(t.viewState.resolution)),n||void 0},r.prototype.useContainer=function(t,e,n,o){var s=this.getLayer().getClassName(),l,u;if(t&&t.className===s&&t.style.opacity===""&&n===1&&(!o||t.style.backgroundColor&&kr(Qi(t.style.backgroundColor),Qi(o)))){var h=t.firstElementChild;h instanceof HTMLCanvasElement&&(u=h.getContext("2d"))}if(u&&u.canvas.style.transform===e?(this.container=t,this.context=u,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){l=document.createElement("div"),l.className=s;var p=l.style;p.position="absolute",p.width="100%",p.height="100%",o&&(p.backgroundColor=o),u=he();var h=u.canvas;l.appendChild(h),p=h.style,p.position="absolute",p.left="0",p.transformOrigin="top left",this.container=l,this.context=u}},r.prototype.clipUnrotated=function(t,e,n){var o=Gr(n),s=fo(n),l=ho(n),u=co(n);Dt(e.coordinateToPixelTransform,o),Dt(e.coordinateToPixelTransform,s),Dt(e.coordinateToPixelTransform,l),Dt(e.coordinateToPixelTransform,u);var h=this.inversePixelTransform;Dt(h,o),Dt(h,s),Dt(h,l),Dt(h,u),t.save(),t.beginPath(),t.moveTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(l[0]),Math.round(l[1])),t.lineTo(Math.round(u[0]),Math.round(u[1])),t.clip()},r.prototype.dispatchRenderEvent_=function(t,e,n){var o=this.getLayer();if(o.hasListener(t)){var s=new Nu(t,this.inversePixelTransform,n,e);o.dispatchEvent(s)}},r.prototype.preRender=function(t,e){this.frameState=e,this.dispatchRenderEvent_(ur.PRERENDER,t,e)},r.prototype.postRender=function(t,e){this.dispatchRenderEvent_(ur.POSTRENDER,t,e)},r.prototype.getRenderTransform=function(t,e,n,o,s,l,u){var h=s/2,p=l/2,d=o/e,g=-d,_=-t[0]+u,y=-t[1];return Ye(this.tempTransform,h,p,d,g,-n,_,y)},r.prototype.getDataAtPixel=function(t,e,n){var o=Dt(this.inversePixelTransform,t.slice()),s=this.context,l=this.getLayer(),u=l.getExtent();if(u){var h=Dt(e.pixelToCoordinateTransform,t.slice());if(!oi(u,h))return null}var p=Math.round(o[0]),d=Math.round(o[1]),g=this.pixelContext_;if(!g){var _=document.createElement("canvas");_.width=1,_.height=1,g=_.getContext("2d"),this.pixelContext_=g}g.clearRect(0,0,1,1);var y;try{g.drawImage(s.canvas,p,d,1,1,0,0,1,1),y=g.getImageData(0,0,1,1).data}catch(E){return E.name==="SecurityError"?(this.pixelContext_=null,new Uint8Array):y}return y[3]===0?null:y},r.prototype.disposeInternal=function(){delete this.frameState,i.prototype.disposeInternal.call(this)},r}(gd),Du=Ed,Ct={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function wd(i,r,t,e,n,o,s,l,u,h,p,d){var g=i[r],_=i[r+1],y=0,E=0,w=0,C=0;function x(){y=g,E=_,r+=e,g=i[r],_=i[r+1],C+=w,w=Math.sqrt((g-y)*(g-y)+(_-E)*(_-E))}do x();while(r<t-e&&C+w<o);for(var S=w===0?0:(o-C)/w,R=ke(y,g,S),I=ke(E,_,S),b=r-e,F=C,A=o+l*u(h,n,p);r<t-e&&C+w<A;)x();S=w===0?0:(A-C)/w;var M=ke(y,g,S),j=ke(E,_,S),k;if(d){var U=[R,I,M,j];vu(U,0,4,2,d,U,U),k=U[0]>U[2]}else k=R>M;var X=Math.PI,K=[],Y=b+e===r;r=b,w=0,C=F,g=i[r],_=i[r+1];var N;if(Y){x(),N=Math.atan2(_-E,g-y),k&&(N+=N>0?-X:X);var $=(M+R)/2,Q=(j+I)/2;return K[0]=[$,Q,(A-o)/2,N,n],K}for(var ot=0,rt=n.length;ot<rt;){x();var at=Math.atan2(_-E,g-y);if(k&&(at+=at>0?-X:X),N!==void 0){var D=at-N;if(D+=D>X?-2*X:D<-X?2*X:0,Math.abs(D)>s)return null}N=at;for(var pt=ot,Z=0;ot<rt;++ot){var vt=k?rt-ot-1:ot,Tt=l*u(h,n[vt],p);if(r+e<t&&C+w<o+Z+Tt/2)break;Z+=Tt}if(ot!==pt){var Lt=k?n.substring(rt-pt,rt-ot):n.substring(pt,ot);S=w===0?0:(o+Z/2-C)/w;var $=ke(y,g,S),Q=ke(E,_,S);K.push([$,Q,Z/2,at,Lt]),o+=Z}}return K}var rn=ce(),Ze=[],Me=[],Ne=[],Je=[];function nl(i){return i[3].declutterBox}var Td=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function il(i,r){return(r==="start"||r==="end")&&!Td.test(i)&&(r=r==="start"?"left":"right"),lo[r]}function Rd(i,r,t){return t>0&&i.push(`
`,""),i.push(r,""),i}var Sd=function(){function i(r,t,e,n){this.overlaps=e,this.pixelRatio=t,this.resolution=r,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=Ce(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}return i.prototype.createLabel=function(r,t,e,n){var o=r+t+e+n;if(this.labels_[o])return this.labels_[o];var s=n?this.strokeStates[n]:null,l=e?this.fillStates[e]:null,u=this.textStates[t],h=this.pixelRatio,p=[u.scale[0]*h,u.scale[1]*h],d=Array.isArray(r),g=il(d?r[0]:r,u.textAlign||Qn),_=n&&s.lineWidth?s.lineWidth:0,y=d?r:r.split(`
`).reduce(Rd,[]),E=Yh(u,y),w=E.width,C=E.height,x=E.widths,S=E.heights,R=E.lineWidths,I=w+_,b=[],F=(I+2)*p[0],A=(C+_)*p[1],M={width:F<0?Math.floor(F):Math.ceil(F),height:A<0?Math.floor(A):Math.ceil(A),contextInstructions:b};if((p[0]!=1||p[1]!=1)&&b.push("scale",p),n){b.push("strokeStyle",s.strokeStyle),b.push("lineWidth",_),b.push("lineCap",s.lineCap),b.push("lineJoin",s.lineJoin),b.push("miterLimit",s.miterLimit);var j=Eo?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D;j.prototype.setLineDash&&(b.push("setLineDash",[s.lineDash]),b.push("lineDashOffset",s.lineDashOffset))}e&&b.push("fillStyle",l.fillStyle),b.push("textBaseline","middle"),b.push("textAlign","center");for(var k=.5-g,U=g*I+k*_,X=[],K=[],Y=0,N=0,$=0,Q=0,ot,rt=0,at=y.length;rt<at;rt+=2){var D=y[rt];if(D===`
`){N+=Y,Y=0,U=g*I+k*_,++Q;continue}var pt=y[rt+1]||u.font;pt!==ot&&(n&&X.push("font",pt),e&&K.push("font",pt),ot=pt),Y=Math.max(Y,S[$]);var Z=[D,U+k*x[$]+g*(x[$]-R[Q]),.5*(_+Y)+N];U+=x[$],n&&X.push("strokeText",Z),e&&K.push("fillText",Z),++$}return Array.prototype.push.apply(b,X),Array.prototype.push.apply(b,K),this.labels_[o]=M,M},i.prototype.replayTextBackground_=function(r,t,e,n,o,s,l){r.beginPath(),r.moveTo.apply(r,t),r.lineTo.apply(r,e),r.lineTo.apply(r,n),r.lineTo.apply(r,o),r.lineTo.apply(r,t),s&&(this.alignFill_=s[2],this.fill_(r)),l&&(this.setStrokeStyle_(r,l),r.stroke())},i.prototype.calculateImageOrLabelDimensions_=function(r,t,e,n,o,s,l,u,h,p,d,g,_,y,E,w){l*=g[0],u*=g[1];var C=e-l,x=n-u,S=o+h>r?r-h:o,R=s+p>t?t-p:s,I=y[3]+S*g[0]+y[1],b=y[0]+R*g[1]+y[2],F=C-y[3],A=x-y[0];(E||d!==0)&&(Ze[0]=F,Je[0]=F,Ze[1]=A,Me[1]=A,Me[0]=F+I,Ne[0]=Me[0],Ne[1]=A+b,Je[1]=Ne[1]);var M;return d!==0?(M=Ye(Ce(),e,n,1,1,d,-e,-n),Dt(M,Ze),Dt(M,Me),Dt(M,Ne),Dt(M,Je),Oe(Math.min(Ze[0],Me[0],Ne[0],Je[0]),Math.min(Ze[1],Me[1],Ne[1],Je[1]),Math.max(Ze[0],Me[0],Ne[0],Je[0]),Math.max(Ze[1],Me[1],Ne[1],Je[1]),rn)):Oe(Math.min(F,F+I),Math.min(A,A+b),Math.max(F,F+I),Math.max(A,A+b),rn),_&&(C=Math.round(C),x=Math.round(x)),{drawImageX:C,drawImageY:x,drawImageW:S,drawImageH:R,originX:h,originY:p,declutterBox:{minX:rn[0],minY:rn[1],maxX:rn[2],maxY:rn[3],value:w},canvasTransform:M,scale:g}},i.prototype.replayImageOrLabel_=function(r,t,e,n,o,s,l){var u=!!(s||l),h=n.declutterBox,p=r.canvas,d=l?l[2]*n.scale[0]/2:0,g=h.minX-d<=p.width/t&&h.maxX+d>=0&&h.minY-d<=p.height/t&&h.maxY+d>=0;return g&&(u&&this.replayTextBackground_(r,Ze,Me,Ne,Je,s,l),Vh(r,n.canvasTransform,o,e,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0},i.prototype.fill_=function(r){if(this.alignFill_){var t=Dt(this.renderedTransform_,[0,0]),e=512*this.pixelRatio;r.save(),r.translate(t[0]%e,t[1]%e),r.rotate(this.viewRotation_)}r.fill(),this.alignFill_&&r.restore()},i.prototype.setStrokeStyle_=function(r,t){r.strokeStyle=t[1],r.lineWidth=t[2],r.lineCap=t[3],r.lineJoin=t[4],r.miterLimit=t[5],r.setLineDash&&(r.lineDashOffset=t[7],r.setLineDash(t[6]))},i.prototype.drawLabelWithPointPlacement_=function(r,t,e,n){var o=this.textStates[t],s=this.createLabel(r,t,n,e),l=this.strokeStates[e],u=this.pixelRatio,h=il(Array.isArray(r)?r[0]:r,o.textAlign||Qn),p=lo[o.textBaseline||ro],d=l&&l.lineWidth?l.lineWidth:0,g=s.width/u-2*o.scale[0],_=h*g+2*(.5-h)*d,y=p*s.height/u+2*(.5-p)*d;return{label:s,anchorX:_,anchorY:y}},i.prototype.execute_=function(r,t,e,n,o,s,l,u){var h;this.pixelCoordinates_&&kr(e,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=br(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_),gf(this.renderedTransform_,e));for(var p=0,d=n.length,g=0,_,y,E,w,C,x,S,R,I,b,F,A,M=0,j=0,k=null,U=null,X=this.coordinateCache_,K=this.viewRotation_,Y=Math.round(Math.atan2(-e[1],e[0])*1e12)/1e12,N={context:r,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:K},$=this.instructions!=n||this.overlaps?0:200,Q,ot,rt,at;p<d;){var D=n[p],pt=D[0];switch(pt){case tt.BEGIN_GEOMETRY:Q=D[1],at=D[3],Q.getGeometry()?l!==void 0&&!Jt(l,at.getExtent())?p=D[2]+1:++p:p=D[2];break;case tt.BEGIN_PATH:M>$&&(this.fill_(r),M=0),j>$&&(r.stroke(),j=0),!M&&!j&&(r.beginPath(),w=NaN,C=NaN),++p;break;case tt.CIRCLE:g=D[1];var Z=h[g],vt=h[g+1],Tt=h[g+2],Lt=h[g+3],ut=Tt-Z,P=Lt-vt,G=Math.sqrt(ut*ut+P*P);r.moveTo(Z+G,vt),r.arc(Z,vt,G,0,2*Math.PI,!0),++p;break;case tt.CLOSE_PATH:r.closePath(),++p;break;case tt.CUSTOM:g=D[1],_=D[2];var V=D[3],W=D[4],H=D.length==6?D[5]:void 0;N.geometry=V,N.feature=Q,p in X||(X[p]=[]);var it=X[p];H?H(h,g,_,2,it):(it[0]=h[g],it[1]=h[g+1],it.length=2),W(it,N),++p;break;case tt.DRAW_IMAGE:g=D[1],_=D[2],R=D[3],y=D[4],E=D[5];var yt=D[6],Rt=D[7],St=D[8],At=D[9],ie=D[10],oe=D[11],Ae=D[12],re=D[13],de=D[14];if(!R&&D.length>=19){I=D[18],b=D[19],F=D[20],A=D[21];var ge=this.drawLabelWithPointPlacement_(I,b,F,A);R=ge.label,D[3]=R;var jr=D[22];y=(ge.anchorX-jr)*this.pixelRatio,D[4]=y;var Pe=D[23];E=(ge.anchorY-Pe)*this.pixelRatio,D[5]=E,yt=R.height,D[6]=yt,re=R.width,D[13]=re}var Be=void 0;D.length>24&&(Be=D[24]);var Ht=void 0,Zt=void 0,se=void 0;D.length>16?(Ht=D[15],Zt=D[16],se=D[17]):(Ht=Cr,Zt=!1,se=!1),ie&&Y?oe+=K:!ie&&!Y&&(oe-=K);for(var We=0;g<_;g+=2)if(!(Be&&Be[We++]<re/this.pixelRatio)){var kt=this.calculateImageOrLabelDimensions_(R.width,R.height,h[g],h[g+1],re,yt,y,E,St,At,oe,Ae,o,Ht,Zt||se,Q),hr=[r,t,R,kt,Rt,Zt?k:null,se?U:null],Ot=void 0,Ee=void 0;if(u&&de){var ae=_-g;if(!de[ae]){de[ae]=hr;continue}if(Ot=de[ae],delete de[ae],Ee=nl(Ot),u.collides(Ee))continue}u&&u.collides(kt.declutterBox)||(Ot&&(u&&u.insert(Ee),this.replayImageOrLabel_.apply(this,Ot)),u&&u.insert(kt.declutterBox),this.replayImageOrLabel_.apply(this,hr))}++p;break;case tt.DRAW_CHARS:var xn=D[1],fr=D[2],$r=D[3],Xr=D[4];A=D[5];var vi=D[6],Yr=D[7],xt=D[8];F=D[9];var Xt=D[10];I=D[11],b=D[12];var st=[D[13],D[13]],Cn=this.textStates[b],pr=Cn.font,ne=[Cn.scale[0]*Yr,Cn.scale[1]*Yr],dr=void 0;pr in this.widths_?dr=this.widths_[pr]:(dr={},this.widths_[pr]=dr);var gr=Su(h,xn,fr,2),_i=Math.abs(ne[0])*Na(pr,I,dr);if(Xr||_i<=gr){var Vr=this.textStates[b].textAlign,Po=(gr-_i)*lo[Vr],we=wd(h,xn,fr,2,I,Po,vi,Math.abs(ne[0]),Na,pr,dr,Y?0:this.viewRotation_);t:if(we){var be=[],Ut=void 0,vr=void 0,Te=void 0,Yt=void 0,Vt=void 0;if(F)for(Ut=0,vr=we.length;Ut<vr;++Ut){Vt=we[Ut],Te=Vt[4],Yt=this.createLabel(Te,b,"",F),y=Vt[2]+(ne[0]<0?-Xt:Xt),E=$r*Yt.height+(.5-$r)*2*Xt*ne[1]/ne[0]-xt;var kt=this.calculateImageOrLabelDimensions_(Yt.width,Yt.height,Vt[0],Vt[1],Yt.width,Yt.height,y,E,0,0,Vt[3],st,!1,Cr,!1,Q);if(u&&u.collides(kt.declutterBox))break t;be.push([r,t,Yt,kt,1,null,null])}if(A)for(Ut=0,vr=we.length;Ut<vr;++Ut){Vt=we[Ut],Te=Vt[4],Yt=this.createLabel(Te,b,A,""),y=Vt[2],E=$r*Yt.height-xt;var kt=this.calculateImageOrLabelDimensions_(Yt.width,Yt.height,Vt[0],Vt[1],Yt.width,Yt.height,y,E,0,0,Vt[3],st,!1,Cr,!1,Q);if(u&&u.collides(kt.declutterBox))break t;be.push([r,t,Yt,kt,1,null,null])}u&&u.load(be.map(nl));for(var _r=0,Br=be.length;_r<Br;++_r)this.replayImageOrLabel_.apply(this,be[_r])}}++p;break;case tt.END_GEOMETRY:if(s!==void 0){Q=D[1];var yi=s(Q,at);if(yi)return yi}++p;break;case tt.FILL:$?M++:this.fill_(r),++p;break;case tt.MOVE_TO_LINE_TO:for(g=D[1],_=D[2],ot=h[g],rt=h[g+1],x=ot+.5|0,S=rt+.5|0,(x!==w||S!==C)&&(r.moveTo(ot,rt),w=x,C=S),g+=2;g<_;g+=2)ot=h[g],rt=h[g+1],x=ot+.5|0,S=rt+.5|0,(g==_-2||x!==w||S!==C)&&(r.lineTo(ot,rt),w=x,C=S);++p;break;case tt.SET_FILL_STYLE:k=D,this.alignFill_=D[2],M&&(this.fill_(r),M=0,j&&(r.stroke(),j=0)),r.fillStyle=D[1],++p;break;case tt.SET_STROKE_STYLE:U=D,j&&(r.stroke(),j=0),this.setStrokeStyle_(r,D),++p;break;case tt.STROKE:$?j++:r.stroke(),++p;break;default:++p;break}}M&&this.fill_(r),j&&r.stroke()},i.prototype.execute=function(r,t,e,n,o,s){this.viewRotation_=n,this.execute_(r,t,e,this.instructions,o,void 0,void 0,s)},i.prototype.executeHitDetection=function(r,t,e,n,o){return this.viewRotation_=e,this.execute_(r,1,t,this.hitDetectionInstructions,!0,n,o)},i}(),xd=Sd,Go=[Ct.POLYGON,Ct.CIRCLE,Ct.LINE_STRING,Ct.IMAGE,Ct.TEXT,Ct.DEFAULT],Cd=function(){function i(r,t,e,n,o,s){this.maxExtent_=r,this.overlaps_=n,this.pixelRatio_=e,this.resolution_=t,this.renderBuffer_=s,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Ce(),this.createExecutors_(o)}return i.prototype.clip=function(r,t){var e=this.getClipCoords(t);r.beginPath(),r.moveTo(e[0],e[1]),r.lineTo(e[2],e[3]),r.lineTo(e[4],e[5]),r.lineTo(e[6],e[7]),r.clip()},i.prototype.createExecutors_=function(r){for(var t in r){var e=this.executorsByZIndex_[t];e===void 0&&(e={},this.executorsByZIndex_[t]=e);var n=r[t];for(var o in n){var s=n[o];e[o]=new xd(this.resolution_,this.pixelRatio_,this.overlaps_,s)}}},i.prototype.hasExecutors=function(r){for(var t in this.executorsByZIndex_)for(var e=this.executorsByZIndex_[t],n=0,o=r.length;n<o;++n)if(r[n]in e)return!0;return!1},i.prototype.forEachFeatureAtCoordinate=function(r,t,e,n,o,s){n=Math.round(n);var l=n*2+1,u=Ye(this.hitDetectionTransform_,n+.5,n+.5,1/t,-1/t,-e,-r[0],-r[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=he(l,l));var p=this.hitDetectionContext_;p.canvas.width!==l||p.canvas.height!==l?(p.canvas.width=l,p.canvas.height=l):h||p.clearRect(0,0,l,l);var d;this.renderBuffer_!==void 0&&(d=ce(),Bn(d,r),Es(d,t*(this.renderBuffer_+n),d));var g=Od(n),_;function y(b,F){for(var A=p.getImageData(0,0,l,l).data,M=0,j=g.length;M<j;M++)if(A[g[M]]>0){if(!s||_!==Ct.IMAGE&&_!==Ct.TEXT||s.indexOf(b)!==-1){var k=(g[M]-3)/4,U=n-k%l,X=n-(k/l|0),K=o(b,F,U*U+X*X);if(K)return K}p.clearRect(0,0,l,l);break}}var E=Object.keys(this.executorsByZIndex_).map(Number);E.sort(Mr);var w,C,x,S,R;for(w=E.length-1;w>=0;--w){var I=E[w].toString();for(x=this.executorsByZIndex_[I],C=Go.length-1;C>=0;--C)if(_=Go[C],S=x[_],S!==void 0&&(R=S.executeHitDetection(p,u,e,y,d),R))return R}},i.prototype.getClipCoords=function(r){var t=this.maxExtent_;if(!t)return null;var e=t[0],n=t[1],o=t[2],s=t[3],l=[e,n,e,s,o,s,o,n];return br(l,0,8,2,r,l),l},i.prototype.isEmpty=function(){return En(this.executorsByZIndex_)},i.prototype.execute=function(r,t,e,n,o,s,l){var u=Object.keys(this.executorsByZIndex_).map(Number);u.sort(Mr),this.maxExtent_&&(r.save(),this.clip(r,e));var h=s||Go,p,d,g,_,y,E;for(l&&u.reverse(),p=0,d=u.length;p<d;++p){var w=u[p].toString();for(y=this.executorsByZIndex_[w],g=0,_=h.length;g<_;++g){var C=h[g];E=y[C],E!==void 0&&E.execute(r,t,e,n,o,l)}}this.maxExtent_&&r.restore()},i}(),ko={};function Od(i){if(ko[i]!==void 0)return ko[i];for(var r=i*2+1,t=i*i,e=new Array(t+1),n=0;n<=i;++n)for(var o=0;o<=i;++o){var s=n*n+o*o;if(s>t)break;var l=e[s];l||(l=[],e[s]=l),l.push(((i+n)*r+(i+o))*4+3),n>0&&l.push(((i-n)*r+(i+o))*4+3),o>0&&(l.push(((i+n)*r+(i-o))*4+3),n>0&&l.push(((i-n)*r+(i-o))*4+3))}for(var u=[],n=0,h=e.length;n<h;++n)e[n]&&u.push.apply(u,e[n]);return ko[i]=u,u}var ol=Cd,Wt={ANIMATING:0,INTERACTING:1},Id=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ad=function(i){Id(r,i);function r(t,e,n,o,s,l,u){var h=i.call(this)||this;return h.context_=t,h.pixelRatio_=e,h.extent_=n,h.transform_=o,h.viewRotation_=s,h.squaredTolerance_=l,h.userTransform_=u,h.contextFillState_=null,h.contextStrokeState_=null,h.contextTextState_=null,h.fillState_=null,h.strokeState_=null,h.image_=null,h.imageAnchorX_=0,h.imageAnchorY_=0,h.imageHeight_=0,h.imageOpacity_=0,h.imageOriginX_=0,h.imageOriginY_=0,h.imageRotateWithView_=!1,h.imageRotation_=0,h.imageScale_=[0,0],h.imageWidth_=0,h.text_="",h.textOffsetX_=0,h.textOffsetY_=0,h.textRotateWithView_=!1,h.textRotation_=0,h.textScale_=[0,0],h.textFillState_=null,h.textStrokeState_=null,h.textState_=null,h.pixelCoordinates_=[],h.tmpLocalTransform_=Ce(),h}return r.prototype.drawImages_=function(t,e,n,o){if(!!this.image_){var s=br(t,e,n,o,this.transform_,this.pixelCoordinates_),l=this.context_,u=this.tmpLocalTransform_,h=l.globalAlpha;this.imageOpacity_!=1&&(l.globalAlpha=h*this.imageOpacity_);var p=this.imageRotation_;this.imageRotateWithView_&&(p+=this.viewRotation_);for(var d=0,g=s.length;d<g;d+=2){var _=s[d]-this.imageAnchorX_,y=s[d+1]-this.imageAnchorY_;if(p!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){var E=_+this.imageAnchorX_,w=y+this.imageAnchorY_;Ye(u,E,w,1,1,p,-E,-w),l.setTransform.apply(l,u),l.translate(E,w),l.scale(this.imageScale_[0],this.imageScale_[1]),l.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),l.setTransform(1,0,0,1,0,0)}else l.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,_,y,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(l.globalAlpha=h)}},r.prototype.drawText_=function(t,e,n,o){if(!(!this.textState_||this.text_==="")){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var s=br(t,e,n,o,this.transform_,this.pixelCoordinates_),l=this.context_,u=this.textRotation_;for(this.textRotateWithView_&&(u+=this.viewRotation_);e<n;e+=o){var h=s[e]+this.textOffsetX_,p=s[e+1]+this.textOffsetY_;if(u!==0||this.textScale_[0]!=1||this.textScale_[1]!=1){var d=Ye(this.tmpLocalTransform_,h,p,1,1,u,-h,-p);l.setTransform.apply(l,d),l.translate(h,p),l.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&l.strokeText(this.text_,0,0),this.textFillState_&&l.fillText(this.text_,0,0),l.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&l.strokeText(this.text_,h,p),this.textFillState_&&l.fillText(this.text_,h,p)}}},r.prototype.moveToLineTo_=function(t,e,n,o,s){var l=this.context_,u=br(t,e,n,o,this.transform_,this.pixelCoordinates_);l.moveTo(u[0],u[1]);var h=u.length;s&&(h-=2);for(var p=2;p<h;p+=2)l.lineTo(u[p],u[p+1]);return s&&l.closePath(),n},r.prototype.drawRings_=function(t,e,n,o){for(var s=0,l=n.length;s<l;++s)e=this.moveToLineTo_(t,e,n[s],o,!0);return e},r.prototype.drawCircle=function(t){if(!!Jt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=Kf(t,this.transform_,this.pixelCoordinates_),n=e[2]-e[0],o=e[3]-e[1],s=Math.sqrt(n*n+o*o),l=this.context_;l.beginPath(),l.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&l.fill(),this.strokeState_&&l.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}},r.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())},r.prototype.setTransform=function(t){this.transform_=t},r.prototype.drawGeometry=function(t){var e=t.getType();switch(e){case q.POINT:this.drawPoint(t);break;case q.LINE_STRING:this.drawLineString(t);break;case q.POLYGON:this.drawPolygon(t);break;case q.MULTI_POINT:this.drawMultiPoint(t);break;case q.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case q.MULTI_POLYGON:this.drawMultiPolygon(t);break;case q.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case q.CIRCLE:this.drawCircle(t);break}},r.prototype.drawFeature=function(t,e){var n=e.getGeometryFunction()(t);!n||!Jt(this.extent_,n.getExtent())||(this.setStyle(e),this.drawGeometry(n))},r.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),n=0,o=e.length;n<o;++n)this.drawGeometry(e[n])},r.prototype.drawPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)},r.prototype.drawMultiPoint=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),n=t.getStride();this.image_&&this.drawImages_(e,0,e.length,n),this.text_!==""&&this.drawText_(e,0,e.length,n)},r.prototype.drawLineString=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Jt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,n=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(n,0,n.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){var o=t.getFlatMidpoint();this.drawText_(o,0,2,2)}}},r.prototype.drawMultiLineString=function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(!!Jt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var n=this.context_,o=t.getFlatCoordinates(),s=0,l=t.getEnds(),u=t.getStride();n.beginPath();for(var h=0,p=l.length;h<p;++h)s=this.moveToLineTo_(o,s,l[h],u,!1);n.stroke()}if(this.text_!==""){var d=t.getFlatMidpoints();this.drawText_(d,0,d.length,2)}}},r.prototype.drawPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Jt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){var n=t.getFlatInteriorPoint();this.drawText_(n,0,2,2)}}},r.prototype.drawMultiPolygon=function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!Jt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,n=t.getOrientedFlatCoordinates(),o=0,s=t.getEndss(),l=t.getStride();e.beginPath();for(var u=0,h=s.length;u<h;++u){var p=s[u];o=this.drawRings_(n,o,p,l)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){var d=t.getFlatInteriorPoints();this.drawText_(d,0,d.length,2)}}},r.prototype.setContextFillState_=function(t){var e=this.context_,n=this.contextFillState_;n?n.fillStyle!=t.fillStyle&&(n.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})},r.prototype.setContextStrokeState_=function(t){var e=this.context_,n=this.contextStrokeState_;n?(n.lineCap!=t.lineCap&&(n.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(kr(n.lineDash,t.lineDash)||e.setLineDash(n.lineDash=t.lineDash),n.lineDashOffset!=t.lineDashOffset&&(n.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),n.lineJoin!=t.lineJoin&&(n.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),n.lineWidth!=t.lineWidth&&(n.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),n.miterLimit!=t.miterLimit&&(n.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),n.strokeStyle!=t.strokeStyle&&(n.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})},r.prototype.setContextTextState_=function(t){var e=this.context_,n=this.contextTextState_,o=t.textAlign?t.textAlign:Qn;n?(n.font!=t.font&&(n.font=t.font,e.font=t.font),n.textAlign!=o&&(n.textAlign=o,e.textAlign=o),n.textBaseline!=t.textBaseline&&(n.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=o,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:o,textBaseline:t.textBaseline})},r.prototype.setFillStrokeStyle=function(t,e){var n=this;if(!t)this.fillState_=null;else{var o=t.getColor();this.fillState_={fillStyle:Se(o||je)}}if(!e)this.strokeState_=null;else{var s=e.getColor(),l=e.getLineCap(),u=e.getLineDash(),h=e.getLineDashOffset(),p=e.getLineJoin(),d=e.getWidth(),g=e.getMiterLimit(),_=u||Kn;this.strokeState_={lineCap:l!==void 0?l:eo,lineDash:this.pixelRatio_===1?_:_.map(function(y){return y*n.pixelRatio_}),lineDashOffset:(h||Hn)*this.pixelRatio_,lineJoin:p!==void 0?p:wn,lineWidth:(d!==void 0?d:ti)*this.pixelRatio_,miterLimit:g!==void 0?g:Zn,strokeStyle:Se(s||Jn)}}},r.prototype.setImageStyle=function(t){var e;if(!t||!(e=t.getSize())){this.image_=null;return}var n=t.getAnchor(),o=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*this.pixelRatio_,this.imageAnchorY_=n[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=o[0],this.imageOriginY_=o[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_},r.prototype.setTextStyle=function(t){if(!t)this.text_="";else{var e=t.getFill();if(!e)this.textFillState_=null;else{var n=e.getColor();this.textFillState_={fillStyle:Se(n||je)}}var o=t.getStroke();if(!o)this.textStrokeState_=null;else{var s=o.getColor(),l=o.getLineCap(),u=o.getLineDash(),h=o.getLineDashOffset(),p=o.getLineJoin(),d=o.getWidth(),g=o.getMiterLimit();this.textStrokeState_={lineCap:l!==void 0?l:eo,lineDash:u||Kn,lineDashOffset:h||Hn,lineJoin:p!==void 0?p:wn,lineWidth:d!==void 0?d:ti,miterLimit:g!==void 0?g:Zn,strokeStyle:Se(s||Jn)}}var _=t.getFont(),y=t.getOffsetX(),E=t.getOffsetY(),w=t.getRotateWithView(),C=t.getRotation(),x=t.getScaleArray(),S=t.getText(),R=t.getTextAlign(),I=t.getTextBaseline();this.textState_={font:_!==void 0?_:nu,textAlign:R!==void 0?R:Qn,textBaseline:I!==void 0?I:ro},this.text_=S!==void 0?Array.isArray(S)?S.reduce(function(b,F,A){return b+=A%2?" ":F},""):S:"",this.textOffsetX_=y!==void 0?this.pixelRatio_*y:0,this.textOffsetY_=E!==void 0?this.pixelRatio_*E:0,this.textRotateWithView_=w!==void 0?w:!1,this.textRotation_=C!==void 0?C:0,this.textScale_=[this.pixelRatio_*x[0],this.pixelRatio_*x[1]]}},r}(Mu),Pd=Ad,Re=.5;function bd(i,r,t,e,n,o,s){var l=i[0]*Re,u=i[1]*Re,h=he(l,u);h.imageSmoothingEnabled=!1;for(var p=h.canvas,d=new Pd(h,Re,n,null,s),g=t.length,_=Math.floor((256*256*256-1)/g),y={},E=1;E<=g;++E){var w=t[E-1],C=w.getStyleFunction()||e;if(!!e){var x=C(w,o);if(!!x){Array.isArray(x)||(x=[x]);for(var S=E*_,R="#"+("000000"+S.toString(16)).slice(-6),I=0,b=x.length;I<b;++I){var F=x[I],A=F.getGeometryFunction()(w);if(!(!A||!Jt(n,A.getExtent()))){var M=F.clone(),j=M.getFill();j&&j.setColor(R);var k=M.getStroke();k&&(k.setColor(R),k.setLineDash(null)),M.setText(void 0);var U=F.getImage();if(U&&U.getOpacity()!==0){var X=U.getImageSize();if(!X)continue;var K=he(X[0],X[1],void 0,{alpha:!1}),Y=K.canvas;K.fillStyle=R,K.fillRect(0,0,Y.width,Y.height),M.setImage(new uf({img:Y,imgSize:X,anchor:U.getAnchor(),anchorXUnits:nr.PIXELS,anchorYUnits:nr.PIXELS,offset:U.getOrigin(),opacity:1,size:U.getSize(),scale:U.getScale(),rotation:U.getRotation(),rotateWithView:U.getRotateWithView()}))}var N=M.getZIndex()||0,$=y[N];$||($={},y[N]=$,$[q.POLYGON]=[],$[q.CIRCLE]=[],$[q.LINE_STRING]=[],$[q.POINT]=[]),$[A.getType().replace("Multi","")].push(A,M)}}}}}for(var Q=Object.keys(y).map(Number).sort(Mr),E=0,ot=Q.length;E<ot;++E){var $=y[Q[E]];for(var rt in $)for(var at=$[rt],I=0,b=at.length;I<b;I+=2){d.setStyle(at[I+1]);for(var D=0,pt=r.length;D<pt;++D)d.setTransform(r[D]),d.drawGeometry(at[I])}}return h.getImageData(0,0,p.width,p.height)}function Ld(i,r,t){var e=[];if(t){var n=Math.floor(Math.round(i[0])*Re),o=Math.floor(Math.round(i[1])*Re),s=(Gt(n,0,t.width-1)+Gt(o,0,t.height-1)*t.width)*4,l=t.data[s],u=t.data[s+1],h=t.data[s+2],p=h+256*(u+256*l),d=Math.floor((256*256*256-1)/r.length);p&&p%d===0&&e.push(r[p/d-1])}return e}var Md=.5,Fu={Point:Xd,LineString:Ud,Polygon:Vd,MultiPoint:Yd,MultiLineString:jd,MultiPolygon:$d,GeometryCollection:kd,Circle:Fd};function Nd(i,r){return parseInt(gt(i),10)-parseInt(gt(r),10)}function Dd(i,r){var t=ds(i,r);return t*t}function ds(i,r){return Md*i/r}function Fd(i,r,t,e,n){var o=t.getFill(),s=t.getStroke();if(o||s){var l=i.getBuilder(t.getZIndex(),Ct.CIRCLE);l.setFillStrokeStyle(o,s),l.drawCircle(r,e)}var u=t.getText();if(u&&u.getText()){var h=(n||i).getBuilder(t.getZIndex(),Ct.TEXT);h.setTextStyle(u),h.drawText(r,e)}}function sl(i,r,t,e,n,o,s){var l=!1,u=t.getImage();if(u){var h=u.getImageState();h==mt.LOADED||h==mt.ERROR?u.unlistenImageChange(n):(h==mt.IDLE&&u.load(),h=u.getImageState(),u.listenImageChange(n),l=!0)}return Gd(i,r,t,e,o,s),l}function Gd(i,r,t,e,n,o){var s=t.getGeometryFunction()(r);if(!!s){var l=s.simplifyTransformed(e,n),u=t.getRenderer();if(u)Gu(i,l,t,r);else{var h=Fu[l.getType()];h(i,l,t,r,o)}}}function Gu(i,r,t,e){if(r.getType()==q.GEOMETRY_COLLECTION){for(var n=r.getGeometries(),o=0,s=n.length;o<s;++o)Gu(i,n[o],t,e);return}var l=i.getBuilder(t.getZIndex(),Ct.DEFAULT);l.drawCustom(r,e,t.getRenderer(),t.getHitDetectionRenderer())}function kd(i,r,t,e,n){var o=r.getGeometriesArray(),s,l;for(s=0,l=o.length;s<l;++s){var u=Fu[o[s].getType()];u(i,o[s],t,e,n)}}function Ud(i,r,t,e,n){var o=t.getStroke();if(o){var s=i.getBuilder(t.getZIndex(),Ct.LINE_STRING);s.setFillStrokeStyle(null,o),s.drawLineString(r,e)}var l=t.getText();if(l&&l.getText()){var u=(n||i).getBuilder(t.getZIndex(),Ct.TEXT);u.setTextStyle(l),u.drawText(r,e)}}function jd(i,r,t,e,n){var o=t.getStroke();if(o){var s=i.getBuilder(t.getZIndex(),Ct.LINE_STRING);s.setFillStrokeStyle(null,o),s.drawMultiLineString(r,e)}var l=t.getText();if(l&&l.getText()){var u=(n||i).getBuilder(t.getZIndex(),Ct.TEXT);u.setTextStyle(l),u.drawText(r,e)}}function $d(i,r,t,e,n){var o=t.getFill(),s=t.getStroke();if(s||o){var l=i.getBuilder(t.getZIndex(),Ct.POLYGON);l.setFillStrokeStyle(o,s),l.drawMultiPolygon(r,e)}var u=t.getText();if(u&&u.getText()){var h=(n||i).getBuilder(t.getZIndex(),Ct.TEXT);h.setTextStyle(u),h.drawText(r,e)}}function Xd(i,r,t,e,n){var o=t.getImage(),s=t.getText(),l;if(n&&(i=n,l=o&&s&&s.getText()?{}:void 0),o){if(o.getImageState()!=mt.LOADED)return;var u=i.getBuilder(t.getZIndex(),Ct.IMAGE);u.setImageStyle(o,l),u.drawPoint(r,e)}if(s&&s.getText()){var h=i.getBuilder(t.getZIndex(),Ct.TEXT);h.setTextStyle(s,l),h.drawText(r,e)}}function Yd(i,r,t,e,n){var o=t.getImage(),s=t.getText(),l;if(n&&(i=n,l=o&&s&&s.getText()?{}:void 0),o){if(o.getImageState()!=mt.LOADED)return;var u=i.getBuilder(t.getZIndex(),Ct.IMAGE);u.setImageStyle(o,l),u.drawMultiPoint(r,e)}if(s&&s.getText()){var h=(n||i).getBuilder(t.getZIndex(),Ct.TEXT);h.setTextStyle(s,l),h.drawText(r,e)}}function Vd(i,r,t,e,n){var o=t.getFill(),s=t.getStroke();if(o||s){var l=i.getBuilder(t.getZIndex(),Ct.POLYGON);l.setFillStrokeStyle(o,s),l.drawPolygon(r,e)}var u=t.getText();if(u&&u.getText()){var h=(n||i).getBuilder(t.getZIndex(),Ct.TEXT);h.setTextStyle(u),h.drawText(r,e)}}var Bd=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Wd=function(i){Bd(r,i);function r(t){var e=i.call(this,t)||this;return e.boundHandleStyleImageChange_=e.handleStyleImageChange_.bind(e),e.animatingOrInteracting_,e.dirty_=!1,e.hitDetectionImageData_=null,e.renderedFeatures_=null,e.renderedRevision_=-1,e.renderedResolution_=NaN,e.renderedExtent_=ce(),e.wrappedRenderedExtent_=ce(),e.renderedRotation_,e.renderedCenter_=null,e.renderedProjection_=null,e.renderedRenderOrder_=null,e.replayGroup_=null,e.replayGroupChanged=!0,e.declutterExecutorGroup=null,e.clipping=!0,e}return r.prototype.renderWorlds=function(t,e,n){var o=e.extent,s=e.viewState,l=s.center,u=s.resolution,h=s.projection,p=s.rotation,d=h.getExtent(),g=this.getLayer().getSource(),_=e.pixelRatio,y=e.viewHints,E=!(y[Wt.ANIMATING]||y[Wt.INTERACTING]),w=this.context,C=Math.round(e.size[0]*_),x=Math.round(e.size[1]*_),S=g.getWrapX()&&h.canWrapX(),R=S?It(d):null,I=S?Math.ceil((o[2]-d[2])/R)+1:1,b=S?Math.floor((o[0]-d[0])/R):0;do{var F=this.getRenderTransform(l,u,p,_,C,x,b*R);t.execute(w,1,F,p,E,void 0,n)}while(++b<I)},r.prototype.renderDeclutter=function(t){this.declutterExecutorGroup&&this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree)},r.prototype.renderFrame=function(t,e){var n=t.pixelRatio,o=t.layerStatesArray[t.layerIndex];vf(this.pixelTransform,1/n,1/n),Ds(this.inversePixelTransform,this.pixelTransform);var s=cu(this.pixelTransform);this.useContainer(e,s,o.opacity,this.getBackground(t));var l=this.context,u=l.canvas,h=this.replayGroup_,p=this.declutterExecutorGroup;if((!h||h.isEmpty())&&(!p||p.isEmpty()))return null;var d=Math.round(t.size[0]*n),g=Math.round(t.size[1]*n);u.width!=d||u.height!=g?(u.width=d,u.height=g,u.style.transform!==s&&(u.style.transform=s)):this.containerReused||l.clearRect(0,0,d,g),this.preRender(l,t);var _=t.viewState,y=_.projection,E=!1,w=!0;if(o.extent&&this.clipping){var C=Or(o.extent,y);w=Jt(C,t.extent),E=w&&!un(C,t.extent),E&&this.clipUnrotated(l,t,C)}w&&this.renderWorlds(h,t),E&&l.restore(),this.postRender(l,t);var x=ru(o.opacity),S=this.container;return x!==S.style.opacity&&(S.style.opacity=x),this.renderedRotation_!==_.rotation&&(this.renderedRotation_=_.rotation,this.hitDetectionImageData_=null),this.container},r.prototype.getFeatures=function(t){return new Promise(function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){var n=[this.context.canvas.width,this.context.canvas.height];Dt(this.pixelTransform,n);var o=this.renderedCenter_,s=this.renderedResolution_,l=this.renderedRotation_,u=this.renderedProjection_,h=this.wrappedRenderedExtent_,p=this.getLayer(),d=[],g=n[0]*Re,_=n[1]*Re;d.push(this.getRenderTransform(o,s,l,Re,g,_,0).slice());var y=p.getSource(),E=u.getExtent();if(y.getWrapX()&&u.canWrapX()&&!un(E,h)){for(var w=h[0],C=It(E),x=0,S=void 0;w<E[0];)--x,S=C*x,d.push(this.getRenderTransform(o,s,l,Re,g,_,S).slice()),w+=C;for(x=0,w=h[2];w>E[2];)++x,S=C*x,d.push(this.getRenderTransform(o,s,l,Re,g,_,S).slice()),w-=C}this.hitDetectionImageData_=bd(n,d,this.renderedFeatures_,p.getStyleFunction(),h,s,l)}e(Ld(t,this.renderedFeatures_,this.hitDetectionImageData_))}.bind(this))},r.prototype.forEachFeatureAtCoordinate=function(t,e,n,o,s){var l=this;if(!!this.replayGroup_){var u=e.viewState.resolution,h=e.viewState.rotation,p=this.getLayer(),d={},g=function(E,w,C){var x=gt(E),S=d[x];if(S){if(S!==!0&&C<S.distanceSq){if(C===0)return d[x]=!0,s.splice(s.lastIndexOf(S),1),o(E,p,w);S.geometry=w,S.distanceSq=C}}else{if(C===0)return d[x]=!0,o(E,p,w);s.push(d[x]={feature:E,layer:p,geometry:w,distanceSq:C,callback:o})}},_,y=[this.replayGroup_];return this.declutterExecutorGroup&&y.push(this.declutterExecutorGroup),y.some(function(E){return _=E.forEachFeatureAtCoordinate(t,u,h,n,g,E===l.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(function(w){return w.value}):null)}),_}},r.prototype.handleFontsChanged=function(){var t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()},r.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()},r.prototype.prepareFrame=function(t){var e=this.getLayer(),n=e.getSource();if(!n)return!1;var o=t.viewHints[Wt.ANIMATING],s=t.viewHints[Wt.INTERACTING],l=e.getUpdateWhileAnimating(),u=e.getUpdateWhileInteracting();if(!this.dirty_&&!l&&o||!u&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;var h=t.extent,p=t.viewState,d=p.projection,g=p.resolution,_=t.pixelRatio,y=e.getRevision(),E=e.getRenderBuffer(),w=e.getRenderOrder();w===void 0&&(w=Nd);var C=p.center.slice(),x=Es(h,E*g),S=x.slice(),R=[x.slice()],I=d.getExtent();if(n.getWrapX()&&d.canWrapX()&&!un(I,t.extent)){var b=It(I),F=Math.max(It(x)/2,b);x[0]=I[0]-F,x[2]=I[2]+F,fu(C,d);var A=Wc(R[0],d);A[0]<I[0]&&A[2]<I[2]?R.push([A[0]+b,A[1],A[2]+b,A[3]]):A[0]>I[0]&&A[2]>I[2]&&R.push([A[0]-b,A[1],A[2]-b,A[3]])}if(!this.dirty_&&this.renderedResolution_==g&&this.renderedRevision_==y&&this.renderedRenderOrder_==w&&un(this.wrappedRenderedExtent_,x))return kr(this.renderedExtent_,S)||(this.hitDetectionImageData_=null,this.renderedExtent_=S),this.renderedCenter_=C,this.replayGroupChanged=!1,!0;this.replayGroup_=null,this.dirty_=!1;var M=new rl(ds(g,_),x,g,_),j;this.getLayer().getDeclutter()&&(j=new rl(ds(g,_),x,g,_));var k=gu(),U;if(k){for(var X=0,K=R.length;X<K;++X){var Y=R[X],N=us(Y,d);n.loadFeatures(N,jf(g,d),k)}U=So(k,d)}else for(var X=0,K=R.length;X<K;++X)n.loadFeatures(R[X],g,d);var $=Dd(g,_),Q=function(pt){var Z,vt=pt.getStyleFunction()||e.getStyleFunction();if(vt&&(Z=vt(pt,g)),Z){var Tt=this.renderFeature(pt,$,Z,M,U,j);this.dirty_=this.dirty_||Tt}}.bind(this),ot=us(x,d),rt=n.getFeaturesInExtent(ot);w&&rt.sort(w);for(var X=0,K=rt.length;X<K;++X)Q(rt[X]);this.renderedFeatures_=rt;var at=M.finish(),D=new ol(x,g,_,n.getOverlaps(),at,e.getRenderBuffer());return j&&(this.declutterExecutorGroup=new ol(x,g,_,n.getOverlaps(),j.finish(),e.getRenderBuffer())),this.renderedResolution_=g,this.renderedRevision_=y,this.renderedRenderOrder_=w,this.renderedExtent_=S,this.wrappedRenderedExtent_=x,this.renderedCenter_=C,this.renderedProjection_=d,this.replayGroup_=D,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0},r.prototype.renderFeature=function(t,e,n,o,s,l){if(!n)return!1;var u=!1;if(Array.isArray(n))for(var h=0,p=n.length;h<p;++h)u=sl(o,t,n[h],e,this.boundHandleStyleImageChange_,s,l)||u;else u=sl(o,t,n,e,this.boundHandleStyleImageChange_,s,l);return u},r}(Du),zd=Wd,qd=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Kd=function(i){qd(r,i);function r(t){return i.call(this,t)||this}return r.prototype.createRenderer=function(){return new zd(this)},r}(Kp),qs=Kd,Hd=function(){function i(r){this.rbush_=new Lu(r),this.items_={}}return i.prototype.insert=function(r,t){var e={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],value:t};this.rbush_.insert(e),this.items_[gt(t)]=e},i.prototype.load=function(r,t){for(var e=new Array(t.length),n=0,o=t.length;n<o;n++){var s=r[n],l=t[n],u={minX:s[0],minY:s[1],maxX:s[2],maxY:s[3],value:l};e[n]=u,this.items_[gt(l)]=u}this.rbush_.load(e)},i.prototype.remove=function(r){var t=gt(r),e=this.items_[t];return delete this.items_[t],this.rbush_.remove(e)!==null},i.prototype.update=function(r,t){var e=this.items_[gt(t)],n=[e.minX,e.minY,e.maxX,e.maxY];zn(n,r)||(this.remove(t),this.insert(r,t))},i.prototype.getAll=function(){var r=this.rbush_.all();return r.map(function(t){return t.value})},i.prototype.getInExtent=function(r){var t={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]},e=this.rbush_.search(t);return e.map(function(n){return n.value})},i.prototype.forEach=function(r){return this.forEach_(this.getAll(),r)},i.prototype.forEachInExtent=function(r,t){return this.forEach_(this.getInExtent(r),t)},i.prototype.forEach_=function(r,t){for(var e,n=0,o=r.length;n<o;n++)if(e=t(r[n]),e)return e;return e},i.prototype.isEmpty=function(){return En(this.items_)},i.prototype.clear=function(){this.rbush_.clear(),this.items_={}},i.prototype.getExtent=function(r){var t=this.rbush_.toJSON();return Oe(t.minX,t.minY,t.maxX,t.maxY,r)},i.prototype.concat=function(r){this.rbush_.load(r.rbush_.all());for(var t in r.items_)this.items_[t]=r.items_[t]},i}(),al=Hd,Zd=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Jd=function(i){Zd(r,i);function r(t){var e=i.call(this)||this;e.projection=Pt(t.projection),e.attributions_=ll(t.attributions),e.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,e.loading=!1,e.state_=t.state!==void 0?t.state:Dr.READY,e.wrapX_=t.wrapX!==void 0?t.wrapX:!1,e.interpolate_=!!t.interpolate,e.viewResolver=null,e.viewRejector=null;var n=e;return e.viewPromise_=new Promise(function(o,s){n.viewResolver=o,n.viewRejector=s}),e}return r.prototype.getAttributions=function(){return this.attributions_},r.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_},r.prototype.getProjection=function(){return this.projection},r.prototype.getResolutions=function(){return J()},r.prototype.getView=function(){return this.viewPromise_},r.prototype.getState=function(){return this.state_},r.prototype.getWrapX=function(){return this.wrapX_},r.prototype.getInterpolate=function(){return this.interpolate_},r.prototype.refresh=function(){this.changed()},r.prototype.setAttributions=function(t){this.attributions_=ll(t),this.changed()},r.prototype.setState=function(t){this.state_=t,this.changed()},r}(Ie);function ll(i){return i?Array.isArray(i)?function(r){return i}:typeof i=="function"?i:function(r){return[i]}:null}var ku=Jd,ve={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function Qd(i,r){return[[-1/0,-1/0,1/0,1/0]]}var an={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"},tg=!1;function eg(i,r,t,e,n,o,s){var l=new XMLHttpRequest;l.open("GET",typeof i=="function"?i(t,e,n):i,!0),r.getType()==an.ARRAY_BUFFER&&(l.responseType="arraybuffer"),l.withCredentials=tg,l.onload=function(u){if(!l.status||l.status>=200&&l.status<300){var h=r.getType(),p=void 0;h==an.JSON||h==an.TEXT?p=l.responseText:h==an.XML?(p=l.responseXML,p||(p=new DOMParser().parseFromString(l.responseText,"application/xml"))):h==an.ARRAY_BUFFER&&(p=l.response),p?o(r.readFeatures(p,{extent:t,featureProjection:n}),r.readProjection(p)):s()}else s()},l.onerror=s,l.send()}function ul(i,r){return function(t,e,n,o,s){var l=this;eg(i,r,t,e,n,function(u,h){l.addFeatures(u),o!==void 0&&o(u)},s||Nr)}}var Uu=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Qe=function(i){Uu(r,i);function r(t,e,n){var o=i.call(this,t)||this;return o.feature=e,o.features=n,o}return r}(Ve),rg=function(i){Uu(r,i);function r(t){var e=this,n=t||{};e=i.call(this,{attributions:n.attributions,interpolate:!0,projection:void 0,state:Dr.READY,wrapX:n.wrapX!==void 0?n.wrapX:!0})||this,e.on,e.once,e.un,e.loader_=Nr,e.format_=n.format,e.overlaps_=n.overlaps===void 0?!0:n.overlaps,e.url_=n.url,n.loader!==void 0?e.loader_=n.loader:e.url_!==void 0&&(ht(e.format_,7),e.loader_=ul(e.url_,e.format_)),e.strategy_=n.strategy!==void 0?n.strategy:Qd;var o=n.useSpatialIndex!==void 0?n.useSpatialIndex:!0;e.featuresRtree_=o?new al:null,e.loadedExtentsRtree_=new al,e.loadingExtentsCount_=0,e.nullGeometryFeatures_={},e.idIndex_={},e.uidIndex_={},e.featureChangeKeys_={},e.featuresCollection_=null;var s,l;return Array.isArray(n.features)?l=n.features:n.features&&(s=n.features,l=s.getArray()),!o&&s===void 0&&(s=new ue(l)),l!==void 0&&e.addFeaturesInternal(l),s!==void 0&&e.bindFeaturesCollection_(s),e}return r.prototype.addFeature=function(t){this.addFeatureInternal(t),this.changed()},r.prototype.addFeatureInternal=function(t){var e=gt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);var n=t.getGeometry();if(n){var o=n.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(o,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new Qe(ve.ADDFEATURE,t))},r.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[ft(e,lt.CHANGE,this.handleFeatureChange_,this),ft(e,mn.PROPERTYCHANGE,this.handleFeatureChange_,this)]},r.prototype.addToIndex_=function(t,e){var n=!0,o=e.getId();return o!==void 0&&(o.toString()in this.idIndex_?n=!1:this.idIndex_[o.toString()]=e),n&&(ht(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),n},r.prototype.addFeatures=function(t){this.addFeaturesInternal(t),this.changed()},r.prototype.addFeaturesInternal=function(t){for(var e=[],n=[],o=[],s=0,l=t.length;s<l;s++){var u=t[s],h=gt(u);this.addToIndex_(h,u)&&n.push(u)}for(var s=0,p=n.length;s<p;s++){var u=n[s],h=gt(u);this.setupChangeEvents_(h,u);var d=u.getGeometry();if(d){var g=d.getExtent();e.push(g),o.push(u)}else this.nullGeometryFeatures_[h]=u}if(this.featuresRtree_&&this.featuresRtree_.load(e,o),this.hasListener(ve.ADDFEATURE))for(var s=0,_=n.length;s<_;s++)this.dispatchEvent(new Qe(ve.ADDFEATURE,n[s]))},r.prototype.bindFeaturesCollection_=function(t){var e=!1;this.addEventListener(ve.ADDFEATURE,function(n){e||(e=!0,t.push(n.feature),e=!1)}),this.addEventListener(ve.REMOVEFEATURE,function(n){e||(e=!0,t.remove(n.feature),e=!1)}),t.addEventListener(Qt.ADD,function(n){e||(e=!0,this.addFeature(n.element),e=!1)}.bind(this)),t.addEventListener(Qt.REMOVE,function(n){e||(e=!0,this.removeFeature(n.element),e=!1)}.bind(this)),this.featuresCollection_=t},r.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_){var n=this.featureChangeKeys_[e];n.forEach(wt)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){var o=function(u){this.removeFeatureInternal(u)}.bind(this);this.featuresRtree_.forEach(o);for(var s in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[s])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};var l=new Qe(ve.CLEAR);this.dispatchEvent(l),this.changed()},r.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)},r.prototype.forEachFeatureAtCoordinateDirect=function(t,e){var n=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(n,function(o){var s=o.getGeometry();if(s.intersectsCoordinate(t))return e(o)})},r.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)},r.prototype.forEachFeatureIntersectingExtent=function(t,e){return this.forEachFeatureInExtent(t,function(n){var o=n.getGeometry();if(o.intersectsExtent(t)){var s=e(n);if(s)return s}})},r.prototype.getFeaturesCollection=function(){return this.featuresCollection_},r.prototype.getFeatures=function(){var t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),En(this.nullGeometryFeatures_)||Ue(t,Jl(this.nullGeometryFeatures_))),t},r.prototype.getFeaturesAtCoordinate=function(t){var e=[];return this.forEachFeatureAtCoordinateDirect(t,function(n){e.push(n)}),e},r.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_?this.featuresRtree_.getInExtent(t):this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]},r.prototype.getClosestFeatureToCoordinate=function(t,e){var n=t[0],o=t[1],s=null,l=[NaN,NaN],u=1/0,h=[-1/0,-1/0,1/0,1/0],p=e||pn;return this.featuresRtree_.forEachInExtent(h,function(d){if(p(d)){var g=d.getGeometry(),_=u;if(u=g.closestPointXY(n,o,l,u),u<_){s=d;var y=Math.sqrt(u);h[0]=n-y,h[1]=o-y,h[2]=n+y,h[3]=o+y}}}),s},r.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)},r.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return e!==void 0?e:null},r.prototype.getFeatureByUid=function(t){var e=this.uidIndex_[t];return e!==void 0?e:null},r.prototype.getFormat=function(){return this.format_},r.prototype.getOverlaps=function(){return this.overlaps_},r.prototype.getUrl=function(){return this.url_},r.prototype.handleFeatureChange_=function(t){var e=t.target,n=gt(e),o=e.getGeometry();if(!o)n in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[n]=e);else{var s=o.getExtent();n in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[n],this.featuresRtree_&&this.featuresRtree_.insert(s,e)):this.featuresRtree_&&this.featuresRtree_.update(s,e)}var l=e.getId();if(l!==void 0){var u=l.toString();this.idIndex_[u]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[u]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[n]=e;this.changed(),this.dispatchEvent(new Qe(ve.CHANGEFEATURE,e))},r.prototype.hasFeature=function(t){var e=t.getId();return e!==void 0?e in this.idIndex_:gt(t)in this.uidIndex_},r.prototype.isEmpty=function(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&En(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0},r.prototype.loadFeatures=function(t,e,n){for(var o=this.loadedExtentsRtree_,s=this.strategy_(t,e,n),l=function(d,g){var _=s[d],y=o.forEachInExtent(_,function(E){return un(E.extent,_)});y||(++u.loadingExtentsCount_,u.dispatchEvent(new Qe(ve.FEATURESLOADSTART)),u.loader_.call(u,_,e,n,function(E){--this.loadingExtentsCount_,this.dispatchEvent(new Qe(ve.FEATURESLOADEND,void 0,E))}.bind(u),function(){--this.loadingExtentsCount_,this.dispatchEvent(new Qe(ve.FEATURESLOADERROR))}.bind(u)),o.insert(_,{extent:_.slice()}))},u=this,h=0,p=s.length;h<p;++h)l(h);this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0},r.prototype.refresh=function(){this.clear(!0),this.loadedExtentsRtree_.clear(),i.prototype.refresh.call(this)},r.prototype.removeLoadedExtent=function(t){var e=this.loadedExtentsRtree_,n;e.forEachInExtent(t,function(o){if(zn(o.extent,t))return n=o,!0}),n&&e.remove(n)},r.prototype.removeFeature=function(t){if(!!t){var e=gt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);var n=this.removeFeatureInternal(t);n&&this.changed()}},r.prototype.removeFeatureInternal=function(t){var e=gt(t),n=this.featureChangeKeys_[e];if(!!n){n.forEach(wt),delete this.featureChangeKeys_[e];var o=t.getId();return o!==void 0&&delete this.idIndex_[o.toString()],delete this.uidIndex_[e],this.dispatchEvent(new Qe(ve.REMOVEFEATURE,t)),t}},r.prototype.removeFromIdIndex_=function(t){var e=!1;for(var n in this.idIndex_)if(this.idIndex_[n]===t){delete this.idIndex_[n],e=!0;break}return e},r.prototype.setLoader=function(t){this.loader_=t},r.prototype.setUrl=function(t){ht(this.format_,7),this.url_=t,this.setLoader(ul(t,this.format_))},r}(ku),ju=rg,$u=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ir=function(i){$u(r,i);function r(t,e){var n=i.call(this,t)||this;return n.layer=e,n}return r}(Ve),Uo={LAYERS:"layers"},ng=function(i){$u(r,i);function r(t){var e=this,n=t||{},o=Ft({},n);delete o.layers;var s=n.layers;return e=i.call(this,o)||this,e.on,e.once,e.un,e.layersListenerKeys_=[],e.listenerKeys_={},e.addChangeListener(Uo.LAYERS,e.handleLayersChanged_),s?Array.isArray(s)?s=new ue(s.slice(),{unique:!0}):ht(typeof s.getArray=="function",43):s=new ue(void 0,{unique:!0}),e.setLayers(s),e}return r.prototype.handleLayerChange_=function(){this.changed()},r.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(wt),this.layersListenerKeys_.length=0;var t=this.getLayers();this.layersListenerKeys_.push(ft(t,Qt.ADD,this.handleLayersAdd_,this),ft(t,Qt.REMOVE,this.handleLayersRemove_,this));for(var e in this.listenerKeys_)this.listenerKeys_[e].forEach(wt);ci(this.listenerKeys_);for(var n=t.getArray(),o=0,s=n.length;o<s;o++){var l=n[o];this.registerLayerListeners_(l),this.dispatchEvent(new ir("addlayer",l))}this.changed()},r.prototype.registerLayerListeners_=function(t){var e=[ft(t,mn.PROPERTYCHANGE,this.handleLayerChange_,this),ft(t,lt.CHANGE,this.handleLayerChange_,this)];t instanceof r&&e.push(ft(t,"addlayer",this.handleLayerGroupAdd_,this),ft(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[gt(t)]=e},r.prototype.handleLayerGroupAdd_=function(t){this.dispatchEvent(new ir("addlayer",t.layer))},r.prototype.handleLayerGroupRemove_=function(t){this.dispatchEvent(new ir("removelayer",t.layer))},r.prototype.handleLayersAdd_=function(t){var e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new ir("addlayer",e)),this.changed()},r.prototype.handleLayersRemove_=function(t){var e=t.element,n=gt(e);this.listenerKeys_[n].forEach(wt),delete this.listenerKeys_[n],this.dispatchEvent(new ir("removelayer",e)),this.changed()},r.prototype.getLayers=function(){return this.get(Uo.LAYERS)},r.prototype.setLayers=function(t){var e=this.getLayers();if(e)for(var n=e.getArray(),o=0,s=n.length;o<s;++o)this.dispatchEvent(new ir("removelayer",n[o]));this.set(Uo.LAYERS,t)},r.prototype.getLayersArray=function(t){var e=t!==void 0?t:[];return this.getLayers().forEach(function(n){n.getLayersArray(e)}),e},r.prototype.getLayerStatesArray=function(t){var e=t!==void 0?t:[],n=e.length;this.getLayers().forEach(function(p){p.getLayerStatesArray(e)});var o=this.getLayerState(),s=o.zIndex;!t&&o.zIndex===void 0&&(s=0);for(var l=n,u=e.length;l<u;l++){var h=e[l];h.opacity*=o.opacity,h.visible=h.visible&&o.visible,h.maxResolution=Math.min(h.maxResolution,o.maxResolution),h.minResolution=Math.max(h.minResolution,o.minResolution),h.minZoom=Math.max(h.minZoom,o.minZoom),h.maxZoom=Math.min(h.maxZoom,o.maxZoom),o.extent!==void 0&&(h.extent!==void 0?h.extent=Wn(h.extent,o.extent):h.extent=o.extent),h.zIndex===void 0&&(h.zIndex=s)}return e},r.prototype.getSourceState=function(){return Dr.READY},r}(Pu),Io=ng,ig=.5,De=!0,gs={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},og={imageSmoothingEnabled:!0,msImageSmoothingEnabled:!0},sg=function(){function i(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}return i.prototype.getReadOptions=function(r,t){var e;if(t){var n=t.dataProjection?Pt(t.dataProjection):this.readProjection(r);t.extent&&n&&n.getUnits()===$e.TILE_PIXELS&&(n=Pt(n),n.setWorldExtent(t.extent)),e={dataProjection:n,featureProjection:t.featureProjection}}return this.adaptOptions(e)},i.prototype.adaptOptions=function(r){return Ft({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},r)},i.prototype.getType=function(){return J()},i.prototype.readFeature=function(r,t){return J()},i.prototype.readFeatures=function(r,t){return J()},i.prototype.readGeometry=function(r,t){return J()},i.prototype.readProjection=function(r){return J()},i.prototype.writeFeature=function(r,t){return J()},i.prototype.writeFeatures=function(r,t){return J()},i.prototype.writeGeometry=function(r,t){return J()},i}();function Xu(i,r,t){var e=t?Pt(t.featureProjection):null,n=t?Pt(t.dataProjection):null,o;if(e&&n&&!xr(e,n)?o=(r?i.clone():i).transform(r?e:n,r?n:e):o=i,r&&t&&t.decimals!==void 0){var s=Math.pow(10,t.decimals),l=function(u){for(var h=0,p=u.length;h<p;++h)u[h]=Math.round(u[h]*s)/s;return u};o===i&&(o=i.clone()),o.applyTransform(l)}return o}var et={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Yu(i){return Math.pow(i,3)}function Sn(i){return 1-Yu(1-i)}function ag(i){return 3*i*i-2*i*i*i}function lg(i){return i}var ug=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),cg=function(i){ug(r,i);function r(t,e,n){var o=i.call(this)||this,s=n||{};return o.tileCoord=t,o.state=e,o.interimTile=null,o.key="",o.transition_=s.transition===void 0?250:s.transition,o.transitionStarts_={},o.interpolate=!!s.interpolate,o}return r.prototype.changed=function(){this.dispatchEvent(lt.CHANGE)},r.prototype.release=function(){},r.prototype.getKey=function(){return this.key+"/"+this.tileCoord},r.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==et.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this},r.prototype.refreshInterimChain=function(){if(!!this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==et.LOADED){t.interimTile=null;break}else t.getState()==et.LOADING?e=t:t.getState()==et.IDLE?e.interimTile=t.interimTile:e=t;t=e.interimTile}while(t)}},r.prototype.getTileCoord=function(){return this.tileCoord},r.prototype.getState=function(){return this.state},r.prototype.setState=function(t){if(this.state!==et.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()},r.prototype.load=function(){J()},r.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var n=this.transitionStarts_[t];if(!n)n=e,this.transitionStarts_[t]=n;else if(n===-1)return 1;var o=e-n+1e3/60;return o>=this.transition_?1:Yu(o/this.transition_)},r.prototype.inTransition=function(t){return this.transition_?this.transitionStarts_[t]!==-1:!1},r.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)},r}(Tn),Vu=cg,hg=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),fg=function(i){hg(r,i);function r(t,e,n,o,s,l){var u=i.call(this,t,e,l)||this;return u.crossOrigin_=o,u.src_=n,u.key=n,u.image_=new Image,o!==null&&(u.image_.crossOrigin=o),u.unlisten_=null,u.tileLoadFunction_=s,u}return r.prototype.getImage=function(){return this.image_},r.prototype.setImage=function(t){this.image_=t,this.state=et.LOADED,this.unlistenImage_(),this.changed()},r.prototype.handleImageError_=function(){this.state=et.ERROR,this.unlistenImage_(),this.image_=pg(),this.changed()},r.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=et.LOADED:this.state=et.EMPTY,this.unlistenImage_(),this.changed()},r.prototype.load=function(){this.state==et.ERROR&&(this.state=et.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==et.IDLE&&(this.state=et.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Ns(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))},r.prototype.unlistenImage_=function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)},r}(Vu);function pg(){var i=he(1,1);return i.fillStyle="rgba(0,0,0,0)",i.fillRect(0,0,1,1),i.canvas}var Bu=fg,dg=10,cl=.25,gg=function(){function i(r,t,e,n,o,s){this.sourceProj_=r,this.targetProj_=t;var l={},u=ei(this.targetProj_,this.sourceProj_);this.transformInv_=function(S){var R=S[0]+"/"+S[1];return l[R]||(l[R]=u(S)),l[R]},this.maxSourceExtent_=n,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&It(n)==It(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?It(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?It(this.targetProj_.getExtent()):null;var h=Gr(e),p=fo(e),d=ho(e),g=co(e),_=this.transformInv_(h),y=this.transformInv_(p),E=this.transformInv_(d),w=this.transformInv_(g),C=dg+(s?Math.max(0,Math.ceil(ph(Ho(e)/(s*s*256*256)))):0);if(this.addQuad_(h,p,d,g,_,y,E,w,C),this.wrapsXInSource_){var x=1/0;this.triangles_.forEach(function(S,R,I){x=Math.min(x,S.source[0][0],S.source[1][0],S.source[2][0])}),this.triangles_.forEach(function(S){if(Math.max(S.source[0][0],S.source[1][0],S.source[2][0])-x>this.sourceWorldWidth_/2){var R=[[S.source[0][0],S.source[0][1]],[S.source[1][0],S.source[1][1]],[S.source[2][0],S.source[2][1]]];R[0][0]-x>this.sourceWorldWidth_/2&&(R[0][0]-=this.sourceWorldWidth_),R[1][0]-x>this.sourceWorldWidth_/2&&(R[1][0]-=this.sourceWorldWidth_),R[2][0]-x>this.sourceWorldWidth_/2&&(R[2][0]-=this.sourceWorldWidth_);var I=Math.min(R[0][0],R[1][0],R[2][0]),b=Math.max(R[0][0],R[1][0],R[2][0]);b-I<this.sourceWorldWidth_/2&&(S.source=R)}}.bind(this))}l={}}return i.prototype.addTriangle_=function(r,t,e,n,o,s){this.triangles_.push({source:[n,o,s],target:[r,t,e]})},i.prototype.addQuad_=function(r,t,e,n,o,s,l,u,h){var p=qo([o,s,l,u]),d=this.sourceWorldWidth_?It(p)/this.sourceWorldWidth_:null,g=this.sourceWorldWidth_,_=this.sourceProj_.canWrapX()&&d>.5&&d<1,y=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){var E=qo([r,t,e,n]),w=It(E)/this.targetWorldWidth_;y=w>cl||y}!_&&this.sourceProj_.isGlobal()&&d&&(y=d>cl||y)}if(!(!y&&this.maxSourceExtent_&&isFinite(p[0])&&isFinite(p[1])&&isFinite(p[2])&&isFinite(p[3])&&!Jt(p,this.maxSourceExtent_))){var C=0;if(!y&&(!isFinite(o[0])||!isFinite(o[1])||!isFinite(s[0])||!isFinite(s[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(u[0])||!isFinite(u[1]))){if(h>0)y=!0;else if(C=(!isFinite(o[0])||!isFinite(o[1])?8:0)+(!isFinite(s[0])||!isFinite(s[1])?4:0)+(!isFinite(l[0])||!isFinite(l[1])?2:0)+(!isFinite(u[0])||!isFinite(u[1])?1:0),C!=1&&C!=2&&C!=4&&C!=8)return}if(h>0){if(!y){var x=[(r[0]+e[0])/2,(r[1]+e[1])/2],S=this.transformInv_(x),R=void 0;if(_){var I=(fn(o[0],g)+fn(l[0],g))/2;R=I-fn(S[0],g)}else R=(o[0]+l[0])/2-S[0];var b=(o[1]+l[1])/2-S[1],F=R*R+b*b;y=F>this.errorThresholdSquared_}if(y){if(Math.abs(r[0]-e[0])<=Math.abs(r[1]-e[1])){var A=[(t[0]+e[0])/2,(t[1]+e[1])/2],M=this.transformInv_(A),j=[(n[0]+r[0])/2,(n[1]+r[1])/2],k=this.transformInv_(j);this.addQuad_(r,t,A,j,o,s,M,k,h-1),this.addQuad_(j,A,e,n,k,M,l,u,h-1)}else{var U=[(r[0]+t[0])/2,(r[1]+t[1])/2],X=this.transformInv_(U),K=[(e[0]+n[0])/2,(e[1]+n[1])/2],Y=this.transformInv_(K);this.addQuad_(r,U,K,n,o,X,Y,u,h-1),this.addQuad_(U,t,e,K,X,s,l,Y,h-1)}return}}if(_){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}(C&11)==0&&this.addTriangle_(r,e,n,o,l,u),(C&14)==0&&this.addTriangle_(r,e,t,o,l,s),C&&((C&13)==0&&this.addTriangle_(t,n,r,s,u,o),(C&7)==0&&this.addTriangle_(t,n,e,s,u,l))}},i.prototype.calculateSourceExtent=function(){var r=ce();return this.triangles_.forEach(function(t,e,n){var o=t.source;Bn(r,o[0]),Bn(r,o[1]),Bn(r,o[2])}),r},i.prototype.getTriangles=function(){return this.triangles_},i}(),vg=gg,jo;function hl(i,r,t,e,n){i.beginPath(),i.moveTo(0,0),i.lineTo(r,t),i.lineTo(e,n),i.closePath(),i.save(),i.clip(),i.fillRect(0,0,Math.max(r,e)+1,Math.max(t,n)),i.restore()}function $o(i,r){return Math.abs(i[r*4]-210)>2||Math.abs(i[r*4+3]-.75*255)>2}function _g(){if(jo===void 0){var i=document.createElement("canvas").getContext("2d");i.globalCompositeOperation="lighter",i.fillStyle="rgba(210, 0, 0, 0.75)",hl(i,4,5,4,0),hl(i,4,5,0,5);var r=i.getImageData(0,0,3,3).data;jo=$o(r,0)||$o(r,4)||$o(r,8)}return jo}function fl(i,r,t,e){var n=Us(t,r,i),o=Xa(r,e,t),s=r.getMetersPerUnit();s!==void 0&&(o*=s);var l=i.getMetersPerUnit();l!==void 0&&(o/=l);var u=i.getExtent();if(!u||oi(u,n)){var h=Xa(i,o,n)/o;isFinite(h)&&h>0&&(o/=h)}return o}function yg(i,r,t,e){var n=Lr(t),o=fl(i,r,n,e);return(!isFinite(o)||o<=0)&&Rl(t,function(s){return o=fl(i,r,s,e),isFinite(o)&&o>0}),o}function mg(i,r,t,e,n,o,s,l,u,h,p,d){var g=he(Math.round(t*i),Math.round(t*r));if(d||Ft(g,gs),u.length===0)return g.canvas;g.scale(t,t);function _(R){return Math.round(R*t)/t}g.globalCompositeOperation="lighter";var y=ce();u.forEach(function(R,I,b){wl(y,R.extent)});var E=It(y),w=me(y),C=he(Math.round(t*E/e),Math.round(t*w/e));d||Ft(C,gs);var x=t/e;u.forEach(function(R,I,b){var F=R.extent[0]-y[0],A=-(R.extent[3]-y[3]),M=It(R.extent),j=me(R.extent);R.image.width>0&&R.image.height>0&&C.drawImage(R.image,h,h,R.image.width-2*h,R.image.height-2*h,F*x,A*x,M*x,j*x)});var S=Gr(s);return l.getTriangles().forEach(function(R,I,b){var F=R.source,A=R.target,M=F[0][0],j=F[0][1],k=F[1][0],U=F[1][1],X=F[2][0],K=F[2][1],Y=_((A[0][0]-S[0])/o),N=_(-(A[0][1]-S[1])/o),$=_((A[1][0]-S[0])/o),Q=_(-(A[1][1]-S[1])/o),ot=_((A[2][0]-S[0])/o),rt=_(-(A[2][1]-S[1])/o),at=M,D=j;M=0,j=0,k-=at,U-=D,X-=at,K-=D;var pt=[[k,U,0,0,$-Y],[X,K,0,0,ot-Y],[0,0,k,U,Q-N],[0,0,X,K,rt-N]],Z=gh(pt);if(!!Z){if(g.save(),g.beginPath(),_g()||!d){g.moveTo($,Q);for(var vt=4,Tt=Y-$,Lt=N-Q,ut=0;ut<vt;ut++)g.lineTo($+_((ut+1)*Tt/vt),Q+_(ut*Lt/(vt-1))),ut!=vt-1&&g.lineTo($+_((ut+1)*Tt/vt),Q+_((ut+1)*Lt/(vt-1)));g.lineTo(ot,rt)}else g.moveTo($,Q),g.lineTo(Y,N),g.lineTo(ot,rt);g.clip(),g.transform(Z[0],Z[2],Z[1],Z[3],Y,N),g.translate(y[0]-at,y[3]-D),g.scale(e/t,-e/t),g.drawImage(C.canvas,0,0),g.restore()}}),p&&(g.save(),g.globalCompositeOperation="source-over",g.strokeStyle="black",g.lineWidth=1,l.getTriangles().forEach(function(R,I,b){var F=R.target,A=(F[0][0]-S[0])/o,M=-(F[0][1]-S[1])/o,j=(F[1][0]-S[0])/o,k=-(F[1][1]-S[1])/o,U=(F[2][0]-S[0])/o,X=-(F[2][1]-S[1])/o;g.beginPath(),g.moveTo(j,k),g.lineTo(A,M),g.lineTo(U,X),g.closePath(),g.stroke()}),g.restore()),g.canvas}var Eg=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),wg=function(i){Eg(r,i);function r(t,e,n,o,s,l,u,h,p,d,g,_){var y=i.call(this,s,et.IDLE,{interpolate:!!_})||this;y.renderEdges_=g!==void 0?g:!1,y.pixelRatio_=u,y.gutter_=h,y.canvas_=null,y.sourceTileGrid_=e,y.targetTileGrid_=o,y.wrappedTileCoord_=l||s,y.sourceTiles_=[],y.sourcesListenerKeys_=null,y.sourceZ_=0;var E=o.getTileCoordExtent(y.wrappedTileCoord_),w=y.targetTileGrid_.getExtent(),C=y.sourceTileGrid_.getExtent(),x=w?Wn(E,w):E;if(Ho(x)===0)return y.state=et.EMPTY,y;var S=t.getExtent();S&&(C?C=Wn(C,S):C=S);var R=o.getResolution(y.wrappedTileCoord_[0]),I=yg(t,n,x,R);if(!isFinite(I)||I<=0)return y.state=et.EMPTY,y;var b=d!==void 0?d:ig;if(y.triangulation_=new vg(t,n,x,C,I*b,R),y.triangulation_.getTriangles().length===0)return y.state=et.EMPTY,y;y.sourceZ_=e.getZForResolution(I);var F=y.triangulation_.calculateSourceExtent();if(C&&(t.canWrapX()?(F[1]=Gt(F[1],C[1],C[3]),F[3]=Gt(F[3],C[1],C[3])):F=Wn(F,C)),!Ho(F))y.state=et.EMPTY;else{for(var A=e.getTileRangeForExtentAndZ(F,y.sourceZ_),M=A.minX;M<=A.maxX;M++)for(var j=A.minY;j<=A.maxY;j++){var k=p(y.sourceZ_,M,j,u);k&&y.sourceTiles_.push(k)}y.sourceTiles_.length===0&&(y.state=et.EMPTY)}return y}return r.prototype.getImage=function(){return this.canvas_},r.prototype.reproject_=function(){var t=[];if(this.sourceTiles_.forEach(function(p,d,g){p&&p.getState()==et.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(p.tileCoord),image:p.getImage()})}.bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=et.ERROR;else{var e=this.wrappedTileCoord_[0],n=this.targetTileGrid_.getTileSize(e),o=typeof n=="number"?n:n[0],s=typeof n=="number"?n:n[1],l=this.targetTileGrid_.getResolution(e),u=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=mg(o,s,this.pixelRatio_,u,this.sourceTileGrid_.getExtent(),l,h,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=et.LOADED}this.changed()},r.prototype.load=function(){if(this.state==et.IDLE){this.state=et.LOADING,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,n,o){var s=e.getState();if(s==et.IDLE||s==et.LOADING){t++;var l=ft(e,lt.CHANGE,function(u){var h=e.getState();(h==et.LOADED||h==et.ERROR||h==et.EMPTY)&&(wt(l),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(l)}}.bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,n,o){var s=e.getState();s==et.IDLE&&e.load()})}},r.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(wt),this.sourcesListenerKeys_=null},r}(Vu),Wu=wg,zu=function(){function i(r,t,e,n){this.minX=r,this.maxX=t,this.minY=e,this.maxY=n}return i.prototype.contains=function(r){return this.containsXY(r[1],r[2])},i.prototype.containsTileRange=function(r){return this.minX<=r.minX&&r.maxX<=this.maxX&&this.minY<=r.minY&&r.maxY<=this.maxY},i.prototype.containsXY=function(r,t){return this.minX<=r&&r<=this.maxX&&this.minY<=t&&t<=this.maxY},i.prototype.equals=function(r){return this.minX==r.minX&&this.minY==r.minY&&this.maxX==r.maxX&&this.maxY==r.maxY},i.prototype.extend=function(r){r.minX<this.minX&&(this.minX=r.minX),r.maxX>this.maxX&&(this.maxX=r.maxX),r.minY<this.minY&&(this.minY=r.minY),r.maxY>this.maxY&&(this.maxY=r.maxY)},i.prototype.getHeight=function(){return this.maxY-this.minY+1},i.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]},i.prototype.getWidth=function(){return this.maxX-this.minX+1},i.prototype.intersects=function(r){return this.minX<=r.maxX&&this.maxX>=r.minX&&this.minY<=r.maxY&&this.maxY>=r.minY},i}();function nn(i,r,t,e,n){return n!==void 0?(n.minX=i,n.maxX=r,n.minY=t,n.maxY=e,n):new zu(i,r,t,e)}var qu=zu,Tg=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Rg=function(i){Tg(r,i);function r(t){var e=i.call(this,t)||this;return e.extentChanged=!0,e.renderedExtent_=null,e.renderedPixelRatio,e.renderedProjection=null,e.renderedRevision,e.renderedTiles=[],e.newTiles_=!1,e.tmpExtent=ce(),e.tmpTileRange_=new qu(0,0,0,0),e}return r.prototype.isDrawableTile=function(t){var e=this.getLayer(),n=t.getState(),o=e.getUseInterimTilesOnError();return n==et.LOADED||n==et.EMPTY||n==et.ERROR&&!o},r.prototype.getTile=function(t,e,n,o){var s=o.pixelRatio,l=o.viewState.projection,u=this.getLayer(),h=u.getSource(),p=h.getTile(t,e,n,s,l);return p.getState()==et.ERROR&&(u.getUseInterimTilesOnError()?u.getPreload()>0&&(this.newTiles_=!0):p.setState(et.LOADED)),this.isDrawableTile(p)||(p=p.getInterimTile()),p},r.prototype.getData=function(t){var e=this.frameState;if(!e)return null;var n=this.getLayer(),o=Dt(e.pixelToCoordinateTransform,t.slice()),s=n.getExtent();if(s&&!oi(s,o))return null;for(var l=e.pixelRatio,u=e.viewState.projection,h=e.viewState,p=n.getRenderSource(),d=p.getTileGridForProjection(h.projection),g=p.getTilePixelRatio(e.pixelRatio),_=d.getZForResolution(h.resolution);_>=d.getMinZoom();--_){var y=d.getTileCoordForCoordAndZ(o,_),E=p.getTile(_,y[1],y[2],l,u);if(!(E instanceof Bu||E instanceof Wu))return null;if(E.getState()===et.LOADED){var w=d.getOrigin(_),C=ye(d.getTileSize(_)),x=d.getResolution(_),S=Math.floor(g*((o[0]-w[0])/x-y[1]*C[0])),R=Math.floor(g*((w[1]-o[1])/x-y[2]*C[1]));return this.getImageData(E.getImage(),S,R)}}return null},r.prototype.loadedTileCallback=function(t,e,n){return this.isDrawableTile(n)?i.prototype.loadedTileCallback.call(this,t,e,n):!1},r.prototype.prepareFrame=function(t){return!!this.getLayer().getSource()},r.prototype.renderFrame=function(t,e){var n=t.layerStatesArray[t.layerIndex],o=t.viewState,s=o.projection,l=o.resolution,u=o.center,h=o.rotation,p=t.pixelRatio,d=this.getLayer(),g=d.getSource(),_=g.getRevision(),y=g.getTileGridForProjection(s),E=y.getZForResolution(l,g.zDirection),w=y.getResolution(E),C=t.extent,x=n.extent&&Or(n.extent,s);x&&(C=Wn(C,Or(n.extent,s)));var S=g.getTilePixelRatio(p),R=Math.round(t.size[0]*S),I=Math.round(t.size[1]*S);if(h){var b=Math.round(Math.sqrt(R*R+I*I));R=b,I=b}var F=w*R/2/S,A=w*I/2/S,M=[u[0]-F,u[1]-A,u[0]+F,u[1]+A],j=y.getTileRangeForExtentAndZ(C,E),k={};k[E]={};var U=this.createLoadedTileFinder(g,s,k),X=this.tmpExtent,K=this.tmpTileRange_;this.newTiles_=!1;for(var Y=j.minX;Y<=j.maxX;++Y)for(var N=j.minY;N<=j.maxY;++N){var $=this.getTile(E,Y,N,t);if(this.isDrawableTile($)){var Q=gt(this);if($.getState()==et.LOADED){k[E][$.tileCoord.toString()]=$;var ot=$.inTransition(Q);!this.newTiles_&&(ot||this.renderedTiles.indexOf($)===-1)&&(this.newTiles_=!0)}if($.getAlpha(Q,t.time)===1)continue}var rt=y.getTileCoordChildTileRange($.tileCoord,K,X),at=!1;rt&&(at=U(E+1,rt)),at||y.forEachTileCoordParentTileRange($.tileCoord,U,K,X)}var D=w/l;Ye(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/S,1/S,h,-R/2,-I/2);var pt=cu(this.pixelTransform);this.useContainer(e,pt,n.opacity,this.getBackground(t));var Z=this.context,vt=Z.canvas;Ds(this.inversePixelTransform,this.pixelTransform),Ye(this.tempTransform,R/2,I/2,D,D,0,-R/2,-I/2),vt.width!=R||vt.height!=I?(vt.width=R,vt.height=I):this.containerReused||Z.clearRect(0,0,R,I),x&&this.clipUnrotated(Z,t,x),g.getInterpolate()||Ft(Z,gs),this.preRender(Z,t),this.renderedTiles.length=0;var Tt=Object.keys(k).map(Number);Tt.sort(Mr);var Lt,ut,P;n.opacity===1&&(!this.containerReused||g.getOpaque(t.viewState.projection))?Tt=Tt.reverse():(Lt=[],ut=[]);for(var G=Tt.length-1;G>=0;--G){var V=Tt[G],W=g.getTilePixelSize(V,p,s),H=y.getResolution(V),it=H/w,yt=W[0]*it*D,Rt=W[1]*it*D,St=y.getTileCoordForCoordAndZ(Gr(M),V),At=y.getTileCoordExtent(St),ie=Dt(this.tempTransform,[S*(At[0]-M[0])/w,S*(M[3]-At[3])/w]),oe=S*g.getGutterForProjection(s),Ae=k[V];for(var re in Ae){var $=Ae[re],de=$.tileCoord,ge=St[1]-de[1],jr=Math.round(ie[0]-(ge-1)*yt),Pe=St[2]-de[2],Be=Math.round(ie[1]-(Pe-1)*Rt),Y=Math.round(ie[0]-ge*yt),N=Math.round(ie[1]-Pe*Rt),Ht=jr-Y,Zt=Be-N,se=E===V,ot=se&&$.getAlpha(gt(this),t.time)!==1,We=!1;if(!ot)if(Lt){P=[Y,N,Y+Ht,N,Y+Ht,N+Zt,Y,N+Zt];for(var kt=0,hr=Lt.length;kt<hr;++kt)if(E!==V&&V<ut[kt]){var Ot=Lt[kt];Jt([Y,N,Y+Ht,N+Zt],[Ot[0],Ot[3],Ot[4],Ot[7]])&&(We||(Z.save(),We=!0),Z.beginPath(),Z.moveTo(P[0],P[1]),Z.lineTo(P[2],P[3]),Z.lineTo(P[4],P[5]),Z.lineTo(P[6],P[7]),Z.moveTo(Ot[6],Ot[7]),Z.lineTo(Ot[4],Ot[5]),Z.lineTo(Ot[2],Ot[3]),Z.lineTo(Ot[0],Ot[1]),Z.clip())}Lt.push(P),ut.push(V)}else Z.clearRect(Y,N,Ht,Zt);this.drawTileImage($,t,Y,N,Ht,Zt,oe,se),Lt&&!ot?(We&&Z.restore(),this.renderedTiles.unshift($)):this.renderedTiles.push($),this.updateUsedTiles(t.usedTiles,g,$)}}this.renderedRevision=_,this.renderedResolution=w,this.extentChanged=!this.renderedExtent_||!zn(this.renderedExtent_,M),this.renderedExtent_=M,this.renderedPixelRatio=p,this.renderedProjection=s,this.manageTilePyramid(t,g,y,p,s,C,E,d.getPreload()),this.scheduleExpireCache(t,g),this.postRender(Z,t),n.extent&&Z.restore(),Ft(Z,og),pt!==vt.style.transform&&(vt.style.transform=pt);var Ee=ru(n.opacity),ae=this.container;return Ee!==ae.style.opacity&&(ae.style.opacity=Ee),this.container},r.prototype.drawTileImage=function(t,e,n,o,s,l,u,h){var p=this.getTileImage(t);if(!!p){var d=gt(this),g=h?t.getAlpha(d,e.time):1,_=g!==this.context.globalAlpha;_&&(this.context.save(),this.context.globalAlpha=g),this.context.drawImage(p,u,u,p.width-2*u,p.height-2*u,n,o,s,l),_&&this.context.restore(),g!==1?e.animate=!0:h&&t.endTransition(d)}},r.prototype.getImage=function(){var t=this.context;return t?t.canvas:null},r.prototype.getTileImage=function(t){return t.getImage()},r.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var n=function(o,s,l){var u=gt(o);u in l.usedTiles&&o.expireCache(l.viewState.projection,l.usedTiles[u])}.bind(null,e);t.postRenderFunctions.push(n)}},r.prototype.updateUsedTiles=function(t,e,n){var o=gt(e);o in t||(t[o]={}),t[o][n.getKey()]=!0},r.prototype.manageTilePyramid=function(t,e,n,o,s,l,u,h,p){var d=gt(e);d in t.wantedTiles||(t.wantedTiles[d]={});var g=t.wantedTiles[d],_=t.tileQueue,y=n.getMinZoom(),E=0,w,C,x,S,R,I;for(I=y;I<=u;++I)for(C=n.getTileRangeForExtentAndZ(l,I,C),x=n.getResolution(I),S=C.minX;S<=C.maxX;++S)for(R=C.minY;R<=C.maxY;++R)u-I<=h?(++E,w=e.getTile(I,S,R,o,s),w.getState()==et.IDLE&&(g[w.getKey()]=!0,_.isKeyQueued(w.getKey())||_.enqueue([w,d,n.getTileCoordCenter(w.tileCoord),x])),p!==void 0&&p(w)):e.useTile(I,S,R,s);e.updateCacheSize(E,s)},r}(Du),Sg=Rg,Yi={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},xg=function(){function i(r){this.highWaterMark=r!==void 0?r:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}return i.prototype.canExpireCache=function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark},i.prototype.expireCache=function(r){for(;this.canExpireCache();)this.pop()},i.prototype.clear=function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null},i.prototype.containsKey=function(r){return this.entries_.hasOwnProperty(r)},i.prototype.forEach=function(r){for(var t=this.oldest_;t;)r(t.value_,t.key_,this),t=t.newer},i.prototype.get=function(r,t){var e=this.entries_[r];return ht(e!==void 0,15),e===this.newest_||(e===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(e.newer.older=e.older,e.older.newer=e.newer),e.newer=null,e.older=this.newest_,this.newest_.newer=e,this.newest_=e),e.value_},i.prototype.remove=function(r){var t=this.entries_[r];return ht(t!==void 0,15),t===this.newest_?(this.newest_=t.older,this.newest_&&(this.newest_.newer=null)):t===this.oldest_?(this.oldest_=t.newer,this.oldest_&&(this.oldest_.older=null)):(t.newer.older=t.older,t.older.newer=t.newer),delete this.entries_[r],--this.count_,t.value_},i.prototype.getCount=function(){return this.count_},i.prototype.getKeys=function(){var r=new Array(this.count_),t=0,e;for(e=this.newest_;e;e=e.older)r[t++]=e.key_;return r},i.prototype.getValues=function(){var r=new Array(this.count_),t=0,e;for(e=this.newest_;e;e=e.older)r[t++]=e.value_;return r},i.prototype.peekLast=function(){return this.oldest_.value_},i.prototype.peekLastKey=function(){return this.oldest_.key_},i.prototype.peekFirstKey=function(){return this.newest_.key_},i.prototype.pop=function(){var r=this.oldest_;return delete this.entries_[r.key_],r.newer&&(r.newer.older=null),this.oldest_=r.newer,this.oldest_||(this.newest_=null),--this.count_,r.value_},i.prototype.replace=function(r,t){this.get(r),this.entries_[r].value_=t},i.prototype.set=function(r,t){ht(!(r in this.entries_),16);var e={key_:r,newer:null,older:this.newest_,value_:t};this.newest_?this.newest_.newer=e:this.oldest_=e,this.newest_=e,this.entries_[r]=e,++this.count_},i.prototype.setSize=function(r){this.highWaterMark=r},i}(),Cg=xg;function pl(i,r,t,e){return e!==void 0?(e[0]=i,e[1]=r,e[2]=t,e):[i,r,t]}function Ao(i,r,t){return i+"/"+r+"/"+t}function Ku(i){return Ao(i[0],i[1],i[2])}function Og(i){return i.split("/").map(Number)}function Ig(i){return(i[1]<<i[0])+i[2]}function Ag(i,r){var t=i[0],e=i[1],n=i[2];if(r.getMinZoom()>t||t>r.getMaxZoom())return!1;var o=r.getFullTileRange(t);return o?o.containsXY(e,n):!0}var Pg=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),bg=function(i){Pg(r,i);function r(){return i!==null&&i.apply(this,arguments)||this}return r.prototype.expireCache=function(t){for(;this.canExpireCache();){var e=this.peekLast();if(e.getKey()in t)break;this.pop().release()}},r.prototype.pruneExceptNewestZ=function(){if(this.getCount()!==0){var t=this.peekFirstKey(),e=Og(t),n=e[0];this.forEach(function(o){o.tileCoord[0]!==n&&(this.remove(Ku(o.tileCoord)),o.release())}.bind(this))}},r}(Cg),Hu=bg,Xo={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},Lg=42,Ks=256,Mg=[0,0,0],tr=5,Ng=function(){function i(r){this.minZoom=r.minZoom!==void 0?r.minZoom:0,this.resolutions_=r.resolutions,ht(Lh(this.resolutions_,function(s,l){return l-s},!0),17);var t;if(!r.origins){for(var e=0,n=this.resolutions_.length-1;e<n;++e)if(!t)t=this.resolutions_[e]/this.resolutions_[e+1];else if(this.resolutions_[e]/this.resolutions_[e+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=r.origin!==void 0?r.origin:null,this.origins_=null,r.origins!==void 0&&(this.origins_=r.origins,ht(this.origins_.length==this.resolutions_.length,20));var o=r.extent;o!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Gr(o)),ht(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,r.tileSizes!==void 0&&(this.tileSizes_=r.tileSizes,ht(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=r.tileSize!==void 0?r.tileSize:this.tileSizes_?null:Ks,ht(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=o!==void 0?o:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],r.sizes!==void 0?this.fullTileRanges_=r.sizes.map(function(s,l){var u=new qu(Math.min(0,s[0]),Math.max(s[0]-1,-1),Math.min(0,s[1]),Math.max(s[1]-1,-1));if(o){var h=this.getTileRangeForExtentAndZ(o,l);u.minX=Math.max(h.minX,u.minX),u.maxX=Math.min(h.maxX,u.maxX),u.minY=Math.max(h.minY,u.minY),u.maxY=Math.min(h.maxY,u.maxY)}return u},this):o&&this.calculateTileRanges_(o)}return i.prototype.forEachTileCoord=function(r,t,e){for(var n=this.getTileRangeForExtentAndZ(r,t),o=n.minX,s=n.maxX;o<=s;++o)for(var l=n.minY,u=n.maxY;l<=u;++l)e([t,o,l])},i.prototype.forEachTileCoordParentTileRange=function(r,t,e,n){var o,s,l,u=null,h=r[0]-1;for(this.zoomFactor_===2?(s=r[1],l=r[2]):u=this.getTileCoordExtent(r,n);h>=this.minZoom;){if(this.zoomFactor_===2?(s=Math.floor(s/2),l=Math.floor(l/2),o=nn(s,s,l,l,e)):o=this.getTileRangeForExtentAndZ(u,h,e),t(h,o))return!0;--h}return!1},i.prototype.getExtent=function(){return this.extent_},i.prototype.getMaxZoom=function(){return this.maxZoom},i.prototype.getMinZoom=function(){return this.minZoom},i.prototype.getOrigin=function(r){return this.origin_?this.origin_:this.origins_[r]},i.prototype.getResolution=function(r){return this.resolutions_[r]},i.prototype.getResolutions=function(){return this.resolutions_},i.prototype.getTileCoordChildTileRange=function(r,t,e){if(r[0]<this.maxZoom){if(this.zoomFactor_===2){var n=r[1]*2,o=r[2]*2;return nn(n,n+1,o,o+1,t)}var s=this.getTileCoordExtent(r,e||this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,r[0]+1,t)}return null},i.prototype.getTileRangeForTileCoordAndZ=function(r,t,e){if(t>this.maxZoom||t<this.minZoom)return null;var n=r[0],o=r[1],s=r[2];if(t===n)return nn(o,s,o,s,e);if(this.zoomFactor_){var l=Math.pow(this.zoomFactor_,t-n),u=Math.floor(o*l),h=Math.floor(s*l);if(t<n)return nn(u,u,h,h,e);var p=Math.floor(l*(o+1))-1,d=Math.floor(l*(s+1))-1;return nn(u,p,h,d,e)}var g=this.getTileCoordExtent(r,this.tmpExtent_);return this.getTileRangeForExtentAndZ(g,t,e)},i.prototype.getTileRangeExtent=function(r,t,e){var n=this.getOrigin(r),o=this.getResolution(r),s=ye(this.getTileSize(r),this.tmpSize_),l=n[0]+t.minX*s[0]*o,u=n[0]+(t.maxX+1)*s[0]*o,h=n[1]+t.minY*s[1]*o,p=n[1]+(t.maxY+1)*s[1]*o;return Oe(l,h,u,p,e)},i.prototype.getTileRangeForExtentAndZ=function(r,t,e){var n=Mg;this.getTileCoordForXYAndZ_(r[0],r[3],t,!1,n);var o=n[1],s=n[2];return this.getTileCoordForXYAndZ_(r[2],r[1],t,!0,n),nn(o,n[1],s,n[2],e)},i.prototype.getTileCoordCenter=function(r){var t=this.getOrigin(r[0]),e=this.getResolution(r[0]),n=ye(this.getTileSize(r[0]),this.tmpSize_);return[t[0]+(r[1]+.5)*n[0]*e,t[1]-(r[2]+.5)*n[1]*e]},i.prototype.getTileCoordExtent=function(r,t){var e=this.getOrigin(r[0]),n=this.getResolution(r[0]),o=ye(this.getTileSize(r[0]),this.tmpSize_),s=e[0]+r[1]*o[0]*n,l=e[1]-(r[2]+1)*o[1]*n,u=s+o[0]*n,h=l+o[1]*n;return Oe(s,l,u,h,t)},i.prototype.getTileCoordForCoordAndResolution=function(r,t,e){return this.getTileCoordForXYAndResolution_(r[0],r[1],t,!1,e)},i.prototype.getTileCoordForXYAndResolution_=function(r,t,e,n,o){var s=this.getZForResolution(e),l=e/this.getResolution(s),u=this.getOrigin(s),h=ye(this.getTileSize(s),this.tmpSize_),p=l*(r-u[0])/e/h[0],d=l*(u[1]-t)/e/h[1];return n?(p=Fi(p,tr)-1,d=Fi(d,tr)-1):(p=Di(p,tr),d=Di(d,tr)),pl(s,p,d,o)},i.prototype.getTileCoordForXYAndZ_=function(r,t,e,n,o){var s=this.getOrigin(e),l=this.getResolution(e),u=ye(this.getTileSize(e),this.tmpSize_),h=(r-s[0])/l/u[0],p=(s[1]-t)/l/u[1];return n?(h=Fi(h,tr)-1,p=Fi(p,tr)-1):(h=Di(h,tr),p=Di(p,tr)),pl(e,h,p,o)},i.prototype.getTileCoordForCoordAndZ=function(r,t,e){return this.getTileCoordForXYAndZ_(r[0],r[1],t,!1,e)},i.prototype.getTileCoordResolution=function(r){return this.resolutions_[r[0]]},i.prototype.getTileSize=function(r){return this.tileSize_?this.tileSize_:this.tileSizes_[r]},i.prototype.getFullTileRange=function(r){return this.fullTileRanges_?this.fullTileRanges_[r]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,r):null},i.prototype.getZForResolution=function(r,t){var e=Ls(this.resolutions_,r,t||0);return Gt(e,this.minZoom,this.maxZoom)},i.prototype.calculateTileRanges_=function(r){for(var t=this.resolutions_.length,e=new Array(t),n=this.minZoom;n<t;++n)e[n]=this.getTileRangeForExtentAndZ(r,n);this.fullTileRanges_=e},i}(),Zu=Ng;function Ju(i){var r=i.getDefaultTileGrid();return r||(r=kg(i),i.setDefaultTileGrid(r)),r}function Dg(i,r,t){var e=r[0],n=i.getTileCoordCenter(r),o=Hs(t);if(oi(o,n))return r;var s=It(o),l=Math.ceil((o[0]-n[0])/s);return n[0]+=s*l,i.getTileCoordForCoordAndZ(n,e)}function Fg(i,r,t,e){var n=e!==void 0?e:$n.TOP_LEFT,o=Qu(i,r,t);return new Zu({extent:i,origin:Xc(i,n),resolutions:o,tileSize:t})}function Gg(i){var r=i||{},t=r.extent||Pt("EPSG:3857").getExtent(),e={extent:t,minZoom:r.minZoom,tileSize:r.tileSize,resolutions:Qu(t,r.maxZoom,r.tileSize,r.maxResolution)};return new Zu(e)}function Qu(i,r,t,e){for(var n=r!==void 0?r:Lg,o=me(i),s=It(i),l=ye(t!==void 0?t:Ks),u=e>0?e:Math.max(s/l[0],o/l[1]),h=n+1,p=new Array(h),d=0;d<h;++d)p[d]=u/Math.pow(2,d);return p}function kg(i,r,t,e){var n=Hs(i);return Fg(n,r,t,e)}function Hs(i){i=Pt(i);var r=i.getExtent();if(!r){var t=180*fe[$e.DEGREES]/i.getMetersPerUnit();r=Oe(-t,-t,t,t)}return r}var tc=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ug=function(i){tc(r,i);function r(t){var e=i.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate})||this;e.on,e.once,e.un,e.opaque_=t.opaque!==void 0?t.opaque:!1,e.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,e.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;var n=[256,256];return e.tileGrid&&ye(e.tileGrid.getTileSize(e.tileGrid.getMinZoom()),n),e.tileCache=new Hu(t.cacheSize||0),e.tmpSize=[0,0],e.key_=t.key||"",e.tileOptions={transition:t.transition,interpolate:t.interpolate},e.zDirection=t.zDirection?t.zDirection:0,e}return r.prototype.canExpireCache=function(){return this.tileCache.canExpireCache()},r.prototype.expireCache=function(t,e){var n=this.getTileCacheForProjection(t);n&&n.expireCache(e)},r.prototype.forEachLoadedTile=function(t,e,n,o){var s=this.getTileCacheForProjection(t);if(!s)return!1;for(var l=!0,u,h,p,d=n.minX;d<=n.maxX;++d)for(var g=n.minY;g<=n.maxY;++g)h=Ao(e,d,g),p=!1,s.containsKey(h)&&(u=s.get(h),p=u.getState()===et.LOADED,p&&(p=o(u)!==!1)),p||(l=!1);return l},r.prototype.getGutterForProjection=function(t){return 0},r.prototype.getKey=function(){return this.key_},r.prototype.setKey=function(t){this.key_!==t&&(this.key_=t,this.changed())},r.prototype.getOpaque=function(t){return this.opaque_},r.prototype.getResolutions=function(){return this.tileGrid?this.tileGrid.getResolutions():null},r.prototype.getTile=function(t,e,n,o,s){return J()},r.prototype.getTileGrid=function(){return this.tileGrid},r.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:Ju(t)},r.prototype.getTileCacheForProjection=function(t){return ht(xr(this.getProjection(),t),68),this.tileCache},r.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_},r.prototype.getTilePixelSize=function(t,e,n){var o=this.getTileGridForProjection(n),s=this.getTilePixelRatio(e),l=ye(o.getTileSize(t),this.tmpSize);return s==1?l:ch(l,s,this.tmpSize)},r.prototype.getTileCoordForTileUrlFunction=function(t,e){var n=e!==void 0?e:this.getProjection(),o=this.getTileGridForProjection(n);return this.getWrapX()&&n.isGlobal()&&(t=Dg(o,t,n)),Ag(t,o)?t:null},r.prototype.clear=function(){this.tileCache.clear()},r.prototype.refresh=function(){this.clear(),i.prototype.refresh.call(this)},r.prototype.updateCacheSize=function(t,e){var n=this.getTileCacheForProjection(e);t>n.highWaterMark&&(n.highWaterMark=t)},r.prototype.useTile=function(t,e,n,o){},r}(ku),jg=function(i){tc(r,i);function r(t,e){var n=i.call(this,t)||this;return n.tile=e,n}return r}(Ve),$g=Ug;function Xg(i,r){var t=/\{z\}/g,e=/\{x\}/g,n=/\{y\}/g,o=/\{-y\}/g;return function(s,l,u){if(s)return i.replace(t,s[0].toString()).replace(e,s[1].toString()).replace(n,s[2].toString()).replace(o,function(){var h=s[0],p=r.getFullTileRange(h);ht(p,55);var d=p.getHeight()-s[2]-1;return d.toString()})}}function Yg(i,r){for(var t=i.length,e=new Array(t),n=0;n<t;++n)e[n]=Xg(i[n],r);return Vg(e)}function Vg(i){return i.length===1?i[0]:function(r,t,e){if(r){var n=Ig(r),o=fn(n,i.length);return i[o](r,t,e)}else return}}function Bg(i){var r=[],t=/\{([a-z])-([a-z])\}/.exec(i);if(t){var e=t[1].charCodeAt(0),n=t[2].charCodeAt(0),o=void 0;for(o=e;o<=n;++o)r.push(i.replace(t[0],String.fromCharCode(o)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(i),t){for(var s=parseInt(t[2],10),l=parseInt(t[1],10);l<=s;l++)r.push(i.replace(t[0],l.toString()));return r}return r.push(i),r}var Wg=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),zg=function(i){Wg(r,i);function r(t){var e=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this;return e.generateTileUrlFunction_=e.tileUrlFunction===r.prototype.tileUrlFunction,e.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(e.tileUrlFunction=t.tileUrlFunction),e.urls=null,t.urls?e.setUrls(t.urls):t.url&&e.setUrl(t.url),e.tileLoadingKeys_={},e}return r.prototype.getTileLoadFunction=function(){return this.tileLoadFunction},r.prototype.getTileUrlFunction=function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction},r.prototype.getUrls=function(){return this.urls},r.prototype.handleTileChange=function(t){var e=t.target,n=gt(e),o=e.getState(),s;o==et.LOADING?(this.tileLoadingKeys_[n]=!0,s=Xo.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=o==et.ERROR?Xo.TILELOADERROR:o==et.LOADED?Xo.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new jg(s,e))},r.prototype.setTileLoadFunction=function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()},r.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e!="undefined"?this.setKey(e):this.changed()},r.prototype.setUrl=function(t){var e=Bg(t);this.urls=e,this.setUrls(e)},r.prototype.setUrls=function(t){this.urls=t;var e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Yg(t,this.tileGrid),e):this.setKey(e)},r.prototype.tileUrlFunction=function(t,e,n){},r.prototype.useTile=function(t,e,n){var o=Ao(t,e,n);this.tileCache.containsKey(o)&&this.tileCache.get(o)},r}($g),qg=zg,Kg=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Hg=function(i){Kg(r,i);function r(){return i.call(this)||this}return r.prototype.getType=function(){return an.JSON},r.prototype.readFeature=function(t,e){return this.readFeatureFromObject(Vi(t),this.getReadOptions(t,e))},r.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(Vi(t),this.getReadOptions(t,e))},r.prototype.readFeatureFromObject=function(t,e){return J()},r.prototype.readFeaturesFromObject=function(t,e){return J()},r.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(Vi(t),this.getReadOptions(t,e))},r.prototype.readGeometryFromObject=function(t,e){return J()},r.prototype.readProjection=function(t){return this.readProjectionFromObject(Vi(t))},r.prototype.readProjectionFromObject=function(t){return J()},r.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))},r.prototype.writeFeatureObject=function(t,e){return J()},r.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))},r.prototype.writeFeaturesObject=function(t,e){return J()},r.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))},r.prototype.writeGeometryObject=function(t,e){return J()},r}(sg);function Vi(i){if(typeof i=="string"){var r=JSON.parse(i);return r||null}else return i!==null?i:null}var Zg=Hg,Jg=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Qg=function(i){Jg(r,i);function r(t){var e=this,n=t||{};return e=i.call(this)||this,e.dataProjection=Pt(n.dataProjection?n.dataProjection:"EPSG:4326"),n.featureProjection&&(e.defaultFeatureProjection=Pt(n.featureProjection)),e.geometryName_=n.geometryName,e.extractGeometryName_=n.extractGeometryName,e.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"],e}return r.prototype.readFeatureFromObject=function(t,e){var n=null;t.type==="Feature"?n=t:n={type:"Feature",geometry:t,properties:null};var o=vs(n.geometry,e),s=new zs;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in n!==void 0&&s.setGeometryName(n.geometry_name),s.setGeometry(o),"id"in n&&s.setId(n.id),n.properties&&s.setProperties(n.properties,!0),s},r.prototype.readFeaturesFromObject=function(t,e){var n=t,o=null;if(n.type==="FeatureCollection"){var s=t;o=[];for(var l=s.features,u=0,h=l.length;u<h;++u)o.push(this.readFeatureFromObject(l[u],e))}else o=[this.readFeatureFromObject(t,e)];return o},r.prototype.readGeometryFromObject=function(t,e){return vs(t,e)},r.prototype.readProjectionFromObject=function(t){var e=t.crs,n;return e?e.type=="name"?n=Pt(e.properties.name):e.type==="EPSG"?n=Pt("EPSG:"+e.properties.code):ht(!1,36):n=this.dataProjection,n},r.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var n={type:"Feature",geometry:null,properties:null},o=t.getId();if(o!==void 0&&(n.id=o),!t.hasProperties())return n;var s=t.getProperties(),l=t.getGeometry();return l&&(n.geometry=_s(l,e),delete s[t.getGeometryName()]),En(s)||(n.properties=s),n},r.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var n=[],o=0,s=t.length;o<s;++o)n.push(this.writeFeatureObject(t[o],e));return{type:"FeatureCollection",features:n}},r.prototype.writeGeometryObject=function(t,e){return _s(t,this.adaptOptions(e))},r}(Zg);function vs(i,r){if(!i)return null;var t;switch(i.type){case q.POINT:{t=ev(i);break}case q.LINE_STRING:{t=rv(i);break}case q.POLYGON:{t=sv(i);break}case q.MULTI_POINT:{t=iv(i);break}case q.MULTI_LINE_STRING:{t=nv(i);break}case q.MULTI_POLYGON:{t=ov(i);break}case q.GEOMETRY_COLLECTION:{t=tv(i);break}default:throw new Error("Unsupported GeoJSON type: "+i.type)}return Xu(t,!1,r)}function tv(i,r){var t=i.geometries.map(function(e){return vs(e,r)});return new tp(t)}function ev(i){return new ni(i.coordinates)}function rv(i){return new fs(i.coordinates)}function nv(i){return new mp(i.coordinates)}function iv(i){return new xu(i.coordinates)}function ov(i){return new bp(i.coordinates)}function sv(i){return new ii(i.coordinates)}function _s(i,r){i=Xu(i,!0,r);var t=i.getType(),e;switch(t){case q.POINT:{e=fv(i);break}case q.LINE_STRING:{e=lv(i);break}case q.POLYGON:{e=pv(i,r);break}case q.MULTI_POINT:{e=cv(i);break}case q.MULTI_LINE_STRING:{e=uv(i);break}case q.MULTI_POLYGON:{e=hv(i,r);break}case q.GEOMETRY_COLLECTION:{e=av(i,r);break}case q.CIRCLE:{e={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+t)}return e}function av(i,r){var t=i.getGeometriesArray().map(function(e){var n=Ft({},r);return delete n.featureProjection,_s(e,n)});return{type:"GeometryCollection",geometries:t}}function lv(i,r){return{type:"LineString",coordinates:i.getCoordinates()}}function uv(i,r){return{type:"MultiLineString",coordinates:i.getCoordinates()}}function cv(i,r){return{type:"MultiPoint",coordinates:i.getCoordinates()}}function hv(i,r){var t;return r&&(t=r.rightHanded),{type:"MultiPolygon",coordinates:i.getCoordinates(t)}}function fv(i,r){return{type:"Point",coordinates:i.getCoordinates()}}function pv(i,r){var t;return r&&(t=r.rightHanded),{type:"Polygon",coordinates:i.getCoordinates(t)}}var dv=Qg,gv=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),vv=function(i){gv(r,i);function r(t){var e=i.call(this)||this;return e.map_=t,e}return r.prototype.dispatchRenderEvent=function(t,e){J()},r.prototype.calculateMatrices2D=function(t){var e=t.viewState,n=t.coordinateToPixelTransform,o=t.pixelToCoordinateTransform;Ye(n,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Ds(o,n)},r.prototype.forEachFeatureAtCoordinate=function(t,e,n,o,s,l,u,h){var p,d=e.viewState;function g(Y,N,$,Q){return s.call(l,N,Y?$:null,Q)}var _=d.projection,y=fu(t.slice(),_),E=[[0,0]];if(_.canWrapX()&&o){var w=_.getExtent(),C=It(w);E.push([-C,0],[C,0])}for(var x=e.layerStatesArray,S=x.length,R=[],I=[],b=0;b<E.length;b++)for(var F=S-1;F>=0;--F){var A=x[F],M=A.layer;if(M.hasRenderer()&&ao(A,d)&&u.call(h,M)){var j=M.getRenderer(),k=M.getSource();if(j&&k){var U=k.getWrapX()?y:t,X=g.bind(null,A.managed);I[0]=U[0]+E[b][0],I[1]=U[1]+E[b][1],p=j.forEachFeatureAtCoordinate(I,e,n,X,R)}if(p)return p}}if(R.length!==0){var K=1/R.length;return R.forEach(function(Y,N){return Y.distanceSq+=N*K}),R.sort(function(Y,N){return Y.distanceSq-N.distanceSq}),R.some(function(Y){return p=Y.callback(Y.feature,Y.layer,Y.geometry)}),p}},r.prototype.forEachLayerAtPixel=function(t,e,n,o,s){return J()},r.prototype.hasFeatureAtCoordinate=function(t,e,n,o,s,l){var u=this.forEachFeatureAtCoordinate(t,e,n,o,pn,this,s,l);return u!==void 0},r.prototype.getMap=function(){return this.map_},r.prototype.renderFrame=function(t){J()},r.prototype.scheduleExpireIconCache=function(t){io.canExpireCache()&&t.postRenderFunctions.push(_v)},r}(bs);function _v(i,r){io.expire()}var yv=vv,mv=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ev=function(i){mv(r,i);function r(t){var e=i.call(this,t)||this;e.fontChangeListenerKey_=ft(Fe,mn.PROPERTYCHANGE,t.redrawText.bind(t)),e.element_=document.createElement("div");var n=e.element_.style;n.position="absolute",n.width="100%",n.height="100%",n.zIndex="0",e.element_.className=Ro+" ol-layers";var o=t.getViewport();return o.insertBefore(e.element_,o.firstChild||null),e.children_=[],e.renderedVisible_=!0,e}return r.prototype.dispatchRenderEvent=function(t,e){var n=this.getMap();if(n.hasListener(t)){var o=new Nu(t,void 0,e);n.dispatchEvent(o)}},r.prototype.disposeInternal=function(){wt(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),i.prototype.disposeInternal.call(this)},r.prototype.renderFrame=function(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(ur.PRECOMPOSE,t);var e=t.layerStatesArray.sort(function(_,y){return _.zIndex-y.zIndex}),n=t.viewState;this.children_.length=0;for(var o=[],s=null,l=0,u=e.length;l<u;++l){var h=e[l];t.layerIndex=l;var p=h.layer,d=p.getSourceState();if(!ao(h,n)||d!=Dr.READY&&d!=Dr.UNDEFINED){p.unrender();continue}var g=p.render(t,s);!g||(g!==s&&(this.children_.push(g),s=g),"getDeclutter"in p&&o.push(p))}for(var l=o.length-1;l>=0;--l)o[l].renderDeclutter(t);Oh(this.element_,this.children_),this.dispatchRenderEvent(ur.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)},r.prototype.forEachLayerAtPixel=function(t,e,n,o,s){for(var l=e.viewState,u=e.layerStatesArray,h=u.length,p=h-1;p>=0;--p){var d=u[p],g=d.layer;if(g.hasRenderer()&&ao(d,l)&&s(g)){var _=g.getRenderer(),y=_.getDataAtPixel(t,e,n);if(y){var E=o(g,y);if(E)return E}}}},r}(yv),wv=Ev,Tv=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Rv=function(i){Tv(r,i);function r(t,e,n){var o=i.call(this,t)||this;return o.map=e,o.frameState=n!==void 0?n:null,o}return r}(Ve),ln=Rv,Sv=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),xv=function(i){Sv(r,i);function r(t,e,n,o,s){var l=i.call(this,t,e,s)||this;return l.originalEvent=n,l.pixel_=null,l.coordinate_=null,l.dragging=o!==void 0?o:!1,l}return Object.defineProperty(r.prototype,"pixel",{get:function(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_},set:function(t){this.pixel_=t},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"coordinate",{get:function(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_},set:function(t){this.coordinate_=t},enumerable:!1,configurable:!0}),r.prototype.preventDefault=function(){i.prototype.preventDefault.call(this),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()},r.prototype.stopPropagation=function(){i.prototype.stopPropagation.call(this),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()},r}(ln),er=xv,Et={SINGLECLICK:"singleclick",CLICK:lt.CLICK,DBLCLICK:lt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},ys={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Cv=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Ov=function(i){Cv(r,i);function r(t,e){var n=i.call(this,t)||this;n.map_=t,n.clickTimeoutId_,n.emulateClicks_=!1,n.dragging_=!1,n.dragListenerKeys_=[],n.moveTolerance_=e===void 0?1:e,n.down_=null;var o=n.map_.getViewport();return n.activePointers_=0,n.trackedTouches_={},n.element_=o,n.pointerdownListenerKey_=ft(o,ys.POINTERDOWN,n.handlePointerDown_,n),n.originalPointerMoveEvent_,n.relayedListenerKey_=ft(o,ys.POINTERMOVE,n.relayEvent_,n),n.boundHandleTouchMove_=n.handleTouchMove_.bind(n),n.element_.addEventListener(lt.TOUCHMOVE,n.boundHandleTouchMove_,Zl?{passive:!1}:!1),n}return r.prototype.emulateClick_=function(t){var e=new er(Et.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new er(Et.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var n=new er(Et.SINGLECLICK,this.map_,t);this.dispatchEvent(n)}.bind(this),250)},r.prototype.updateActivePointers_=function(t){var e=t;e.type==Et.POINTERUP||e.type==Et.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==Et.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0),this.activePointers_=Object.keys(this.trackedTouches_).length},r.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new er(Et.POINTERUP,this.map_,t);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_===0&&(this.dragListenerKeys_.forEach(wt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)},r.prototype.isMouseActionButton_=function(t){return t.button===0},r.prototype.handlePointerDown_=function(t){this.emulateClicks_=this.activePointers_===0,this.updateActivePointers_(t);var e=new er(Et.POINTERDOWN,this.map_,t);this.dispatchEvent(e),this.down_={};for(var n in t){var o=t[n];this.down_[n]=typeof o=="function"?Nr:o}if(this.dragListenerKeys_.length===0){var s=this.map_.getOwnerDocument();this.dragListenerKeys_.push(ft(s,Et.POINTERMOVE,this.handlePointerMove_,this),ft(s,Et.POINTERUP,this.handlePointerUp_,this),ft(this.element_,Et.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==s&&this.dragListenerKeys_.push(ft(this.element_.getRootNode(),Et.POINTERUP,this.handlePointerUp_,this))}},r.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var e=new er(Et.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}},r.prototype.relayEvent_=function(t){this.originalPointerMoveEvent_=t;var e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new er(t.type,this.map_,t,e))},r.prototype.handleTouchMove_=function(t){var e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()},r.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_},r.prototype.disposeInternal=function(){this.relayedListenerKey_&&(wt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(lt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(wt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(wt),this.dragListenerKeys_.length=0,this.element_=null,i.prototype.disposeInternal.call(this)},r}(Tn),Iv=Ov,rr={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Bt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},uo=1/0,Av=function(){function i(r,t){this.priorityFunction_=r,this.keyFunction_=t,this.elements_=[],this.priorities_=[],this.queuedElements_={}}return i.prototype.clear=function(){this.elements_.length=0,this.priorities_.length=0,ci(this.queuedElements_)},i.prototype.dequeue=function(){var r=this.elements_,t=this.priorities_,e=r[0];r.length==1?(r.length=0,t.length=0):(r[0]=r.pop(),t[0]=t.pop(),this.siftUp_(0));var n=this.keyFunction_(e);return delete this.queuedElements_[n],e},i.prototype.enqueue=function(r){ht(!(this.keyFunction_(r)in this.queuedElements_),31);var t=this.priorityFunction_(r);return t!=uo?(this.elements_.push(r),this.priorities_.push(t),this.queuedElements_[this.keyFunction_(r)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1},i.prototype.getCount=function(){return this.elements_.length},i.prototype.getLeftChildIndex_=function(r){return r*2+1},i.prototype.getRightChildIndex_=function(r){return r*2+2},i.prototype.getParentIndex_=function(r){return r-1>>1},i.prototype.heapify_=function(){var r;for(r=(this.elements_.length>>1)-1;r>=0;r--)this.siftUp_(r)},i.prototype.isEmpty=function(){return this.elements_.length===0},i.prototype.isKeyQueued=function(r){return r in this.queuedElements_},i.prototype.isQueued=function(r){return this.isKeyQueued(this.keyFunction_(r))},i.prototype.siftUp_=function(r){for(var t=this.elements_,e=this.priorities_,n=t.length,o=t[r],s=e[r],l=r;r<n>>1;){var u=this.getLeftChildIndex_(r),h=this.getRightChildIndex_(r),p=h<n&&e[h]<e[u]?h:u;t[r]=t[p],e[r]=e[p],r=p}t[r]=o,e[r]=s,this.siftDown_(l,r)},i.prototype.siftDown_=function(r,t){for(var e=this.elements_,n=this.priorities_,o=e[t],s=n[t];t>r;){var l=this.getParentIndex_(t);if(n[l]>s)e[t]=e[l],n[t]=n[l],t=l;else break}e[t]=o,n[t]=s},i.prototype.reprioritize=function(){var r=this.priorityFunction_,t=this.elements_,e=this.priorities_,n=0,o=t.length,s,l,u;for(l=0;l<o;++l)s=t[l],u=r(s),u==uo?delete this.queuedElements_[this.keyFunction_(s)]:(e[n]=u,t[n++]=s);t.length=n,e.length=n,this.heapify_()},i}(),Pv=Av,bv=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Lv=function(i){bv(r,i);function r(t,e){var n=i.call(this,function(o){return t.apply(null,o)},function(o){return o[0].getKey()})||this;return n.boundHandleTileChange_=n.handleTileChange.bind(n),n.tileChangeCallback_=e,n.tilesLoading_=0,n.tilesLoadingKeys_={},n}return r.prototype.enqueue=function(t){var e=i.prototype.enqueue.call(this,t);if(e){var n=t[0];n.addEventListener(lt.CHANGE,this.boundHandleTileChange_)}return e},r.prototype.getTilesLoading=function(){return this.tilesLoading_},r.prototype.handleTileChange=function(t){var e=t.target,n=e.getState();if(n===et.LOADED||n===et.ERROR||n===et.EMPTY){e.removeEventListener(lt.CHANGE,this.boundHandleTileChange_);var o=e.getKey();o in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[o],--this.tilesLoading_),this.tileChangeCallback_()}},r.prototype.loadMoreTiles=function(t,e){for(var n=0,o,s,l;this.tilesLoading_<t&&n<e&&this.getCount()>0;)s=this.dequeue()[0],l=s.getKey(),o=s.getState(),o===et.IDLE&&!(l in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[l]=!0,++this.tilesLoading_,++n,s.load())},r}(Pv),Mv=Lv;function Nv(i,r,t,e,n){if(!i||!(t in i.wantedTiles)||!i.wantedTiles[t][r.getKey()])return uo;var o=i.viewState.center,s=e[0]-o[0],l=e[1]-o[1];return 65536*Math.log(n)+Math.sqrt(s*s+l*l)/n}var _e={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function dl(i,r,t){return function(e,n,o,s,l){if(!!e){if(!n&&!r)return e;var u=r?0:o[0]*n,h=r?0:o[1]*n,p=l?l[0]:0,d=l?l[1]:0,g=i[0]+u/2+p,_=i[2]-u/2+p,y=i[1]+h/2+d,E=i[3]-h/2+d;g>_&&(g=(_+g)/2,_=g),y>E&&(y=(E+y)/2,E=y);var w=Gt(e[0],g,_),C=Gt(e[1],y,E);if(s&&t&&n){var x=30*n;w+=-x*Math.log(1+Math.max(0,g-e[0])/x)+x*Math.log(1+Math.max(0,e[0]-_)/x),C+=-x*Math.log(1+Math.max(0,y-e[1])/x)+x*Math.log(1+Math.max(0,e[1]-E)/x)}return[w,C]}}}function Dv(i){return i}function Zs(i,r,t,e){var n=It(r)/t[0],o=me(r)/t[1];return e?Math.min(i,Math.max(n,o)):Math.min(i,Math.min(n,o))}function Js(i,r,t){var e=Math.min(i,r),n=50;return e*=Math.log(1+n*Math.max(0,i/r-1))/n+1,t&&(e=Math.max(e,t),e/=Math.log(1+n*Math.max(0,t/i-1))/n+1),Gt(e,t/2,r*2)}function Fv(i,r,t,e){return function(n,o,s,l){if(n!==void 0){var u=i[0],h=i[i.length-1],p=t?Zs(u,t,s,e):u;if(l){var d=r!==void 0?r:!0;return d?Js(n,p,h):Gt(n,h,p)}var g=Math.min(p,n),_=Math.floor(Ls(i,g,o));return i[_]>p&&_<i.length-1?i[_+1]:i[_]}else return}}function Gv(i,r,t,e,n,o){return function(s,l,u,h){if(s!==void 0){var p=n?Zs(r,n,u,o):r,d=t!==void 0?t:0;if(h){var g=e!==void 0?e:!0;return g?Js(s,p,d):Gt(s,d,p)}var _=1e-9,y=Math.ceil(Math.log(r/p)/Math.log(i)-_),E=-l*(.5-_)+.5,w=Math.min(p,s),C=Math.floor(Math.log(r/w)/Math.log(i)+E),x=Math.max(y,C),S=r/Math.pow(i,x);return Gt(S,d,p)}else return}}function gl(i,r,t,e,n){return function(o,s,l,u){if(o!==void 0){var h=e?Zs(i,e,l,n):i,p=t!==void 0?t:!0;return!p||!u?Gt(o,r,h):Js(o,h,r)}else return}}function Qs(i){if(i!==void 0)return 0}function vl(i){if(i!==void 0)return i}function kv(i){var r=2*Math.PI/i;return function(t,e){if(e)return t;if(t!==void 0)return t=Math.floor(t/r+.5)*r,t}}function Uv(i){var r=i||qi(5);return function(t,e){if(e)return t;if(t!==void 0)return Math.abs(t)<=r?0:t}}var jv=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Yo=0,$v=function(i){jv(r,i);function r(t){var e=i.call(this)||this;e.on,e.once,e.un;var n=Ft({},t);return e.hints_=[0,0],e.animations_=[],e.updateAnimationKey_,e.projection_=ks(n.projection,"EPSG:3857"),e.viewportSize_=[100,100],e.targetCenter_=null,e.targetResolution_,e.targetRotation_,e.nextCenter_=null,e.nextResolution_,e.nextRotation_,e.cancelAnchor_=void 0,n.projection&&Nf(),n.center&&(n.center=Ge(n.center,e.projection_)),n.extent&&(n.extent=Or(n.extent,e.projection_)),e.applyOptions_(n),e}return r.prototype.applyOptions_=function(t){var e=Ft({},t);for(var n in _e)delete e[n];this.setProperties(e,!0);var o=Yv(t);this.maxResolution_=o.maxResolution,this.minResolution_=o.minResolution,this.zoomFactor_=o.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=o.minZoom;var s=Xv(t),l=o.constraint,u=Vv(t);this.constraints_={center:s,resolution:l,rotation:u},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)},Object.defineProperty(r.prototype,"padding",{get:function(){return this.padding_},set:function(t){var e=this.padding_;this.padding_=t;var n=this.getCenter();if(n){var o=t||[0,0,0,0];e=e||[0,0,0,0];var s=this.getResolution(),l=s/2*(o[3]-e[3]+e[1]-o[1]),u=s/2*(o[0]-e[0]+e[2]-o[2]);this.setCenterInternal([n[0]+l,n[1]-u])}},enumerable:!1,configurable:!0}),r.prototype.getUpdatedOptions_=function(t){var e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Ft({},e,t)},r.prototype.animate=function(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);for(var e=new Array(arguments.length),n=0;n<e.length;++n){var o=arguments[n];o.center&&(o=Ft({},o),o.center=Ge(o.center,this.getProjection())),o.anchor&&(o=Ft({},o),o.anchor=Ge(o.anchor,this.getProjection())),e[n]=o}this.animateInternal.apply(this,e)},r.prototype.animateInternal=function(t){var e=arguments.length,n;e>1&&typeof arguments[e-1]=="function"&&(n=arguments[e-1],--e);for(var o=0;o<e&&!this.isDef();++o){var s=arguments[o];s.center&&this.setCenterInternal(s.center),s.zoom!==void 0?this.setZoom(s.zoom):s.resolution&&this.setResolution(s.resolution),s.rotation!==void 0&&this.setRotation(s.rotation)}if(o===e){n&&Bi(n,!0);return}for(var l=Date.now(),u=this.targetCenter_.slice(),h=this.targetResolution_,p=this.targetRotation_,d=[];o<e;++o){var g=arguments[o],_={start:l,complete:!1,anchor:g.anchor,duration:g.duration!==void 0?g.duration:1e3,easing:g.easing||ag,callback:n};if(g.center&&(_.sourceCenter=u,_.targetCenter=g.center.slice(),u=_.targetCenter),g.zoom!==void 0?(_.sourceResolution=h,_.targetResolution=this.getResolutionForZoom(g.zoom),h=_.targetResolution):g.resolution&&(_.sourceResolution=h,_.targetResolution=g.resolution,h=_.targetResolution),g.rotation!==void 0){_.sourceRotation=p;var y=fn(g.rotation-p+Math.PI,2*Math.PI)-Math.PI;_.targetRotation=p+y,p=_.targetRotation}Bv(_)?_.complete=!0:l+=_.duration,d.push(_)}this.animations_.push(d),this.setHint(Wt.ANIMATING,1),this.updateAnimations_()},r.prototype.getAnimating=function(){return this.hints_[Wt.ANIMATING]>0},r.prototype.getInteracting=function(){return this.hints_[Wt.INTERACTING]>0},r.prototype.cancelAnimations=function(){this.setHint(Wt.ANIMATING,-this.hints_[Wt.ANIMATING]);for(var t,e=0,n=this.animations_.length;e<n;++e){var o=this.animations_[e];if(o[0].callback&&Bi(o[0].callback,!1),!t)for(var s=0,l=o.length;s<l;++s){var u=o[s];if(!u.complete){t=u.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN},r.prototype.updateAnimations_=function(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!!this.getAnimating()){for(var t=Date.now(),e=!1,n=this.animations_.length-1;n>=0;--n){for(var o=this.animations_[n],s=!0,l=0,u=o.length;l<u;++l){var h=o[l];if(!h.complete){var p=t-h.start,d=h.duration>0?p/h.duration:1;d>=1?(h.complete=!0,d=1):s=!1;var g=h.easing(d);if(h.sourceCenter){var _=h.sourceCenter[0],y=h.sourceCenter[1],E=h.targetCenter[0],w=h.targetCenter[1];this.nextCenter_=h.targetCenter;var C=_+g*(E-_),x=y+g*(w-y);this.targetCenter_=[C,x]}if(h.sourceResolution&&h.targetResolution){var S=g===1?h.targetResolution:h.sourceResolution+g*(h.targetResolution-h.sourceResolution);if(h.anchor){var R=this.getViewportSize_(this.getRotation()),I=this.constraints_.resolution(S,0,R,!0);this.targetCenter_=this.calculateCenterZoom(I,h.anchor)}this.nextResolution_=h.targetResolution,this.targetResolution_=S,this.applyTargetState_(!0)}if(h.sourceRotation!==void 0&&h.targetRotation!==void 0){var b=g===1?fn(h.targetRotation+Math.PI,2*Math.PI)-Math.PI:h.sourceRotation+g*(h.targetRotation-h.sourceRotation);if(h.anchor){var F=this.constraints_.rotation(b,!0);this.targetCenter_=this.calculateCenterRotate(F,h.anchor)}this.nextRotation_=h.targetRotation,this.targetRotation_=b}if(this.applyTargetState_(!0),e=!0,!h.complete)break}}if(s){this.animations_[n]=null,this.setHint(Wt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;var A=o[0].callback;A&&Bi(A,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}},r.prototype.calculateCenterRotate=function(t,e){var n,o=this.getCenterInternal();return o!==void 0&&(n=[o[0]-e[0],o[1]-e[1]],Fs(n,t-this.getRotation()),Pf(n,e)),n},r.prototype.calculateCenterZoom=function(t,e){var n,o=this.getCenterInternal(),s=this.getResolution();if(o!==void 0&&s!==void 0){var l=e[0]-t*(e[0]-o[0])/s,u=e[1]-t*(e[1]-o[1])/s;n=[l,u]}return n},r.prototype.getViewportSize_=function(t){var e=this.viewportSize_;if(t){var n=e[0],o=e[1];return[Math.abs(n*Math.cos(t))+Math.abs(o*Math.sin(t)),Math.abs(n*Math.sin(t))+Math.abs(o*Math.cos(t))]}else return e},r.prototype.setViewportSize=function(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)},r.prototype.getCenter=function(){var t=this.getCenterInternal();return t&&ls(t,this.getProjection())},r.prototype.getCenterInternal=function(){return this.get(_e.CENTER)},r.prototype.getConstraints=function(){return this.constraints_},r.prototype.getConstrainResolution=function(){return this.get("constrainResolution")},r.prototype.getHints=function(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()},r.prototype.calculateExtent=function(t){var e=this.calculateExtentInternal(t);return us(e,this.getProjection())},r.prototype.calculateExtentInternal=function(t){var e=t||this.getViewportSizeMinusPadding_(),n=this.getCenterInternal();ht(n,1);var o=this.getResolution();ht(o!==void 0,2);var s=this.getRotation();return ht(s!==void 0,3),Zo(n,o,s,e)},r.prototype.getMaxResolution=function(){return this.maxResolution_},r.prototype.getMinResolution=function(){return this.minResolution_},r.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)},r.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))},r.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)},r.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))},r.prototype.setConstrainResolution=function(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))},r.prototype.getProjection=function(){return this.projection_},r.prototype.getResolution=function(){return this.get(_e.RESOLUTION)},r.prototype.getResolutions=function(){return this.resolutions_},r.prototype.getResolutionForExtent=function(t,e){return this.getResolutionForExtentInternal(Or(t,this.getProjection()),e)},r.prototype.getResolutionForExtentInternal=function(t,e){var n=e||this.getViewportSizeMinusPadding_(),o=It(t)/n[0],s=me(t)/n[1];return Math.max(o,s)},r.prototype.getResolutionForValueFunction=function(t){var e=t||2,n=this.getConstrainedResolution(this.maxResolution_),o=this.minResolution_,s=Math.log(n/o)/Math.log(e);return function(l){var u=n/Math.pow(e,l*s);return u}},r.prototype.getRotation=function(){return this.get(_e.ROTATION)},r.prototype.getValueForResolutionFunction=function(t){var e=Math.log(t||2),n=this.getConstrainedResolution(this.maxResolution_),o=this.minResolution_,s=Math.log(n/o)/e;return function(l){var u=Math.log(n/l)/e/s;return u}},r.prototype.getViewportSizeMinusPadding_=function(t){var e=this.getViewportSize_(t),n=this.padding_;return n&&(e=[e[0]-n[1]-n[3],e[1]-n[0]-n[2]]),e},r.prototype.getState=function(){var t=this.getProjection(),e=this.getResolution(),n=this.getRotation(),o=this.getCenterInternal(),s=this.padding_;if(s){var l=this.getViewportSizeMinusPadding_();o=Vo(o,this.getViewportSize_(),[l[0]/2+s[3],l[1]/2+s[0]],e,n)}return{center:o.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:n,zoom:this.getZoom()}},r.prototype.getZoom=function(){var t,e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t},r.prototype.getZoomForResolution=function(t){var e=this.minZoom_||0,n,o;if(this.resolutions_){var s=Ls(this.resolutions_,t,1);e=s,n=this.resolutions_[s],s==this.resolutions_.length-1?o=2:o=n/this.resolutions_[s+1]}else n=this.maxResolution_,o=this.zoomFactor_;return e+Math.log(n/t)/Math.log(o)},r.prototype.getResolutionForZoom=function(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;var e=Gt(Math.floor(t),0,this.resolutions_.length-2),n=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(n,Gt(t-e,0,1))}else return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)},r.prototype.fit=function(t,e){var n;if(ht(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function",24),Array.isArray(t)){ht(!Ts(t),25);var o=Or(t,this.getProjection());n=Ha(o)}else if(t.getType()===q.CIRCLE){var o=Or(t.getExtent(),this.getProjection());n=Ha(o),n.rotate(this.getRotation(),Lr(o))}else{var s=gu();s?n=t.clone().transform(s,this.getProjection()):n=t}this.fitInternal(n,e)},r.prototype.rotatedExtentForGeometry=function(t){for(var e=this.getRotation(),n=Math.cos(e),o=Math.sin(-e),s=t.getFlatCoordinates(),l=t.getStride(),u=1/0,h=1/0,p=-1/0,d=-1/0,g=0,_=s.length;g<_;g+=l){var y=s[g]*n-s[g+1]*o,E=s[g]*o+s[g+1]*n;u=Math.min(u,y),h=Math.min(h,E),p=Math.max(p,y),d=Math.max(d,E)}return[u,h,p,d]},r.prototype.fitInternal=function(t,e){var n=e||{},o=n.size;o||(o=this.getViewportSizeMinusPadding_());var s=n.padding!==void 0?n.padding:[0,0,0,0],l=n.nearest!==void 0?n.nearest:!1,u;n.minResolution!==void 0?u=n.minResolution:n.maxZoom!==void 0?u=this.getResolutionForZoom(n.maxZoom):u=0;var h=this.rotatedExtentForGeometry(t),p=this.getResolutionForExtentInternal(h,[o[0]-s[1]-s[3],o[1]-s[0]-s[2]]);p=isNaN(p)?u:Math.max(p,u),p=this.getConstrainedResolution(p,l?0:1);var d=this.getRotation(),g=Math.sin(d),_=Math.cos(d),y=Lr(h);y[0]+=(s[1]-s[3])/2*p,y[1]+=(s[0]-s[2])/2*p;var E=y[0]*_-y[1]*g,w=y[1]*_+y[0]*g,C=this.getConstrainedCenter([E,w],p),x=n.callback?n.callback:Nr;n.duration!==void 0?this.animateInternal({resolution:p,center:C,duration:n.duration,easing:n.easing},x):(this.targetResolution_=p,this.targetCenter_=C,this.applyTargetState_(!1,!0),Bi(x,!0))},r.prototype.centerOn=function(t,e,n){this.centerOnInternal(Ge(t,this.getProjection()),e,n)},r.prototype.centerOnInternal=function(t,e,n){this.setCenterInternal(Vo(t,e,n,this.getResolution(),this.getRotation()))},r.prototype.calculateCenterShift=function(t,e,n,o){var s,l=this.padding_;if(l&&t){var u=this.getViewportSizeMinusPadding_(-n),h=Vo(t,o,[u[0]/2+l[3],u[1]/2+l[0]],e,n);s=[t[0]-h[0],t[1]-h[1]]}return s},r.prototype.isDef=function(){return!!this.getCenterInternal()&&this.getResolution()!==void 0},r.prototype.adjustCenter=function(t){var e=ls(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])},r.prototype.adjustCenterInternal=function(t){var e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])},r.prototype.adjustResolution=function(t,e){var n=e&&Ge(e,this.getProjection());this.adjustResolutionInternal(t,n)},r.prototype.adjustResolutionInternal=function(t,e){var n=this.getAnimating()||this.getInteracting(),o=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,o,n);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()},r.prototype.adjustZoom=function(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)},r.prototype.adjustRotation=function(t,e){e&&(e=Ge(e,this.getProjection())),this.adjustRotationInternal(t,e)},r.prototype.adjustRotationInternal=function(t,e){var n=this.getAnimating()||this.getInteracting(),o=this.constraints_.rotation(this.targetRotation_+t,n);e&&(this.targetCenter_=this.calculateCenterRotate(o,e)),this.targetRotation_+=t,this.applyTargetState_()},r.prototype.setCenter=function(t){this.setCenterInternal(t&&Ge(t,this.getProjection()))},r.prototype.setCenterInternal=function(t){this.targetCenter_=t,this.applyTargetState_()},r.prototype.setHint=function(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]},r.prototype.setResolution=function(t){this.targetResolution_=t,this.applyTargetState_()},r.prototype.setRotation=function(t){this.targetRotation_=t,this.applyTargetState_()},r.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))},r.prototype.applyTargetState_=function(t,e){var n=this.getAnimating()||this.getInteracting()||e,o=this.constraints_.rotation(this.targetRotation_,n),s=this.getViewportSize_(o),l=this.constraints_.resolution(this.targetResolution_,0,s,n),u=this.constraints_.center(this.targetCenter_,l,s,n,this.calculateCenterShift(this.targetCenter_,l,o,s));this.get(_e.ROTATION)!==o&&this.set(_e.ROTATION,o),this.get(_e.RESOLUTION)!==l&&(this.set(_e.RESOLUTION,l),this.set("zoom",this.getZoom(),!0)),(!u||!this.get(_e.CENTER)||!so(this.get(_e.CENTER),u))&&this.set(_e.CENTER,u),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0},r.prototype.resolveConstraints=function(t,e,n){var o=t!==void 0?t:200,s=e||0,l=this.constraints_.rotation(this.targetRotation_),u=this.getViewportSize_(l),h=this.constraints_.resolution(this.targetResolution_,s,u),p=this.constraints_.center(this.targetCenter_,h,u,!1,this.calculateCenterShift(this.targetCenter_,h,l,u));if(o===0&&!this.cancelAnchor_){this.targetResolution_=h,this.targetRotation_=l,this.targetCenter_=p,this.applyTargetState_();return}var d=n||(o===0?this.cancelAnchor_:void 0);this.cancelAnchor_=void 0,(this.getResolution()!==h||this.getRotation()!==l||!this.getCenterInternal()||!so(this.getCenterInternal(),p))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:l,center:p,resolution:h,duration:o,easing:Sn,anchor:d}))},r.prototype.beginInteraction=function(){this.resolveConstraints(0),this.setHint(Wt.INTERACTING,1)},r.prototype.endInteraction=function(t,e,n){var o=n&&Ge(n,this.getProjection());this.endInteractionInternal(t,e,o)},r.prototype.endInteractionInternal=function(t,e,n){this.setHint(Wt.INTERACTING,-1),this.resolveConstraints(t,e,n)},r.prototype.getConstrainedCenter=function(t,e){var n=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),n)},r.prototype.getConstrainedZoom=function(t,e){var n=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(n,e))},r.prototype.getConstrainedResolution=function(t,e){var n=e||0,o=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,n,o)},r}(Ie);function Bi(i,r){setTimeout(function(){i(r)},0)}function Xv(i){if(i.extent!==void 0){var r=i.smoothExtentConstraint!==void 0?i.smoothExtentConstraint:!0;return dl(i.extent,i.constrainOnlyCenter,r)}var t=ks(i.projection,"EPSG:3857");if(i.multiWorld!==!0&&t.isGlobal()){var e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,dl(e,!1,!1)}return Dv}function Yv(i){var r,t,e,n=28,o=2,s=i.minZoom!==void 0?i.minZoom:Yo,l=i.maxZoom!==void 0?i.maxZoom:n,u=i.zoomFactor!==void 0?i.zoomFactor:o,h=i.multiWorld!==void 0?i.multiWorld:!1,p=i.smoothResolutionConstraint!==void 0?i.smoothResolutionConstraint:!0,d=i.showFullExtent!==void 0?i.showFullExtent:!1,g=ks(i.projection,"EPSG:3857"),_=g.getExtent(),y=i.constrainOnlyCenter,E=i.extent;if(!h&&!E&&g.isGlobal()&&(y=!1,E=_),i.resolutions!==void 0){var w=i.resolutions;t=w[s],e=w[l]!==void 0?w[l]:w[w.length-1],i.constrainResolution?r=Fv(w,p,!y&&E,d):r=gl(t,e,p,!y&&E,d)}else{var C=_?Math.max(It(_),me(_)):360*fe[$e.DEGREES]/g.getMetersPerUnit(),x=C/Ks/Math.pow(o,Yo),S=x/Math.pow(o,n-Yo);t=i.maxResolution,t!==void 0?s=0:t=x/Math.pow(u,s),e=i.minResolution,e===void 0&&(i.maxZoom!==void 0?i.maxResolution!==void 0?e=t/Math.pow(u,l):e=x/Math.pow(u,l):e=S),l=s+Math.floor(Math.log(t/e)/Math.log(u)),e=t/Math.pow(u,l-s),i.constrainResolution?r=Gv(u,t,e,p,!y&&E,d):r=gl(t,e,p,!y&&E,d)}return{constraint:r,maxResolution:t,minResolution:e,minZoom:s,zoomFactor:u}}function Vv(i){var r=i.enableRotation!==void 0?i.enableRotation:!0;if(r){var t=i.constrainRotation;return t===void 0||t===!0?Uv():t===!1?vl:typeof t=="number"?kv(t):vl}else return Qs}function Bv(i){return!(i.sourceCenter&&i.targetCenter&&!so(i.sourceCenter,i.targetCenter)||i.sourceResolution!==i.targetResolution||i.sourceRotation!==i.targetRotation)}function Vo(i,r,t,e,n){var o=Math.cos(-n),s=Math.sin(-n),l=i[0]*o-i[1]*s,u=i[1]*o+i[0]*s;l+=(r[0]/2-t[0])*e,u+=(t[1]-r[1]/2)*e,s=-s;var h=l*o-u*s,p=u*o+l*s;return[h,p]}var or=$v,Wv=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}();function ec(i){if(i instanceof Oo){i.setMapInternal(null);return}i instanceof Io&&i.getLayers().forEach(ec)}function rc(i,r){if(i instanceof Oo){i.setMapInternal(r);return}if(i instanceof Io)for(var t=i.getLayers().getArray(),e=0,n=t.length;e<n;++e)rc(t[e],r)}var zv=function(i){Wv(r,i);function r(t){var e=i.call(this)||this;e.on,e.once,e.un;var n=qv(t);e.renderComplete_,e.loaded_=!0,e.boundHandleBrowserEvent_=e.handleBrowserEvent.bind(e),e.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,e.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:Hl,e.postRenderTimeoutHandle_,e.animationDelayKey_,e.animationDelay_=function(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}.bind(e),e.coordinateToPixelTransform_=Ce(),e.pixelToCoordinateTransform_=Ce(),e.frameIndex_=0,e.frameState_=null,e.previousExtent_=null,e.viewPropertyListenerKey_=null,e.viewChangeListenerKey_=null,e.layerGroupPropertyListenerKeys_=null,e.viewport_=document.createElement("div"),e.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),e.viewport_.style.position="relative",e.viewport_.style.overflow="hidden",e.viewport_.style.width="100%",e.viewport_.style.height="100%",e.overlayContainer_=document.createElement("div"),e.overlayContainer_.style.position="absolute",e.overlayContainer_.style.zIndex="0",e.overlayContainer_.style.width="100%",e.overlayContainer_.style.height="100%",e.overlayContainer_.style.pointerEvents="none",e.overlayContainer_.className="ol-overlaycontainer",e.viewport_.appendChild(e.overlayContainer_),e.overlayContainerStopEvent_=document.createElement("div"),e.overlayContainerStopEvent_.style.position="absolute",e.overlayContainerStopEvent_.style.zIndex="0",e.overlayContainerStopEvent_.style.width="100%",e.overlayContainerStopEvent_.style.height="100%",e.overlayContainerStopEvent_.style.pointerEvents="none",e.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",e.viewport_.appendChild(e.overlayContainerStopEvent_),e.mapBrowserEventHandler_=null,e.moveTolerance_=t.moveTolerance,e.keyboardEventTarget_=n.keyboardEventTarget,e.targetChangeHandlerKeys_=null,e.controls=n.controls||new ue,e.interactions=n.interactions||new ue,e.overlays_=n.overlays,e.overlayIdIndex_={},e.renderer_=null,e.postRenderFunctions_=[],e.tileQueue_=new Mv(e.getTilePriority.bind(e),e.handleTileChange_.bind(e)),e.addChangeListener(Bt.LAYERGROUP,e.handleLayerGroupChanged_),e.addChangeListener(Bt.VIEW,e.handleViewChanged_),e.addChangeListener(Bt.SIZE,e.handleSizeChanged_),e.addChangeListener(Bt.TARGET,e.handleTargetChanged_),e.setProperties(n.values);var o=e;return t.view&&!(t.view instanceof or)&&t.view.then(function(s){o.setView(new or(s))}),e.controls.addEventListener(Qt.ADD,function(s){s.element.setMap(this)}.bind(e)),e.controls.addEventListener(Qt.REMOVE,function(s){s.element.setMap(null)}.bind(e)),e.interactions.addEventListener(Qt.ADD,function(s){s.element.setMap(this)}.bind(e)),e.interactions.addEventListener(Qt.REMOVE,function(s){s.element.setMap(null)}.bind(e)),e.overlays_.addEventListener(Qt.ADD,function(s){this.addOverlayInternal_(s.element)}.bind(e)),e.overlays_.addEventListener(Qt.REMOVE,function(s){var l=s.element,u=l.getId();u!==void 0&&delete this.overlayIdIndex_[u.toString()],s.element.setMap(null)}.bind(e)),e.controls.forEach(function(s){s.setMap(this)}.bind(e)),e.interactions.forEach(function(s){s.setMap(this)}.bind(e)),e.overlays_.forEach(e.addOverlayInternal_.bind(e)),e}return r.prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")},r.prototype.addControl=function(t){this.getControls().push(t)},r.prototype.addInteraction=function(t){this.getInteractions().push(t)},r.prototype.addLayer=function(t){var e=this.getLayerGroup().getLayers();e.push(t)},r.prototype.handleLayerAdd_=function(t){rc(t.layer,this)},r.prototype.addOverlay=function(t){this.getOverlays().push(t)},r.prototype.addOverlayInternal_=function(t){var e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)},r.prototype.disposeInternal=function(){this.setTarget(null),i.prototype.disposeInternal.call(this)},r.prototype.forEachFeatureAtPixel=function(t,e,n){if(!(!this.frameState_||!this.renderer_)){var o=this.getCoordinateFromPixelInternal(t);n=n!==void 0?n:{};var s=n.hitTolerance!==void 0?n.hitTolerance:0,l=n.layerFilter!==void 0?n.layerFilter:pn,u=n.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(o,this.frameState_,s,u,e,null,l,null)}},r.prototype.getFeaturesAtPixel=function(t,e){var n=[];return this.forEachFeatureAtPixel(t,function(o){n.push(o)},e),n},r.prototype.getAllLayers=function(){var t=[];function e(n){n.forEach(function(o){o instanceof Io?e(o.getLayers()):t.push(o)})}return e(this.getLayers()),t},r.prototype.forEachLayerAtPixel=function(t,e,n){if(!(!this.frameState_||!this.renderer_)){var o=n||{},s=o.hitTolerance!==void 0?o.hitTolerance:0,l=o.layerFilter||pn;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,s,e,l)}},r.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_||!this.renderer_)return!1;var n=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};var o=e.layerFilter!==void 0?e.layerFilter:pn,s=e.hitTolerance!==void 0?e.hitTolerance:0,l=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(n,this.frameState_,s,l,o,null)},r.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))},r.prototype.getEventCoordinateInternal=function(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))},r.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),n="changedTouches"in t?t.changedTouches[0]:t;return[n.clientX-e.left,n.clientY-e.top]},r.prototype.getTarget=function(){return this.get(Bt.TARGET)},r.prototype.getTargetElement=function(){var t=this.getTarget();return t!==void 0?typeof t=="string"?document.getElementById(t):t:null},r.prototype.getCoordinateFromPixel=function(t){return ls(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())},r.prototype.getCoordinateFromPixelInternal=function(t){var e=this.frameState_;return e?Dt(e.pixelToCoordinateTransform,t.slice()):null},r.prototype.getControls=function(){return this.controls},r.prototype.getOverlays=function(){return this.overlays_},r.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null},r.prototype.getInteractions=function(){return this.interactions},r.prototype.getLayerGroup=function(){return this.get(Bt.LAYERGROUP)},r.prototype.setLayers=function(t){var e=this.getLayerGroup();if(t instanceof ue){e.setLayers(t);return}var n=e.getLayers();n.clear(),n.extend(t)},r.prototype.getLayers=function(){var t=this.getLayerGroup().getLayers();return t},r.prototype.getLoadingOrNotReady=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,n=t.length;e<n;++e){var o=t[e];if(!!o.visible){var s=o.layer.getRenderer();if(s&&!s.ready)return!0;var l=o.layer.getSource();if(l&&l.loading)return!0}}return!1},r.prototype.getPixelFromCoordinate=function(t){var e=Ge(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)},r.prototype.getPixelFromCoordinateInternal=function(t){var e=this.frameState_;return e?Dt(e.coordinateToPixelTransform,t.slice(0,2)):null},r.prototype.getRenderer=function(){return this.renderer_},r.prototype.getSize=function(){return this.get(Bt.SIZE)},r.prototype.getView=function(){return this.get(Bt.VIEW)},r.prototype.getViewport=function(){return this.viewport_},r.prototype.getOverlayContainer=function(){return this.overlayContainer_},r.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},r.prototype.getOwnerDocument=function(){var t=this.getTargetElement();return t?t.ownerDocument:document},r.prototype.getTilePriority=function(t,e,n,o){return Nv(this.frameState_,t,e,n,o)},r.prototype.handleBrowserEvent=function(t,e){var n=e||t.type,o=new er(n,this,t);this.handleMapBrowserEvent(o)},r.prototype.handleMapBrowserEvent=function(t){if(!!this.frameState_){var e=t.originalEvent,n=e.type;if(n===ys.POINTERDOWN||n===lt.WHEEL||n===lt.KEYDOWN){var o=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():o,l=e.target;if(this.overlayContainerStopEvent_.contains(l)||!(s===o?o.documentElement:s).contains(l))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1)for(var u=this.getInteractions().getArray().slice(),h=u.length-1;h>=0;h--){var p=u[h];if(!(p.getMap()!==this||!p.getActive()||!this.getTargetElement())){var d=p.handleEvent(t);if(!d||t.propagationStopped)break}}}},r.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var n=this.maxTilesLoading_,o=n;if(t){var s=t.viewHints;if(s[Wt.ANIMATING]||s[Wt.INTERACTING]){var l=Date.now()-t.time>8;n=l?0:8,o=l?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,o))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(ur.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(ur.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new ln(rr.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new ln(rr.LOADSTART,this,t))));for(var u=this.postRenderFunctions_,h=0,p=u.length;h<p;++h)u[h](this,t);u.length=0},r.prototype.handleSizeChanged_=function(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()},r.prototype.handleTargetChanged_=function(){if(this.mapBrowserEventHandler_){for(var t=0,e=this.targetChangeHandlerKeys_.length;t<e;++t)wt(this.targetChangeHandlerKeys_[t]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(lt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(lt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,ns(this.viewport_)}var n=this.getTargetElement();if(!n)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{n.appendChild(this.viewport_),this.renderer_||(this.renderer_=this.createRenderer()),this.mapBrowserEventHandler_=new Iv(this,this.moveTolerance_);for(var o in Et)this.mapBrowserEventHandler_.addEventListener(Et[o],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(lt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(lt.WHEEL,this.boundHandleBrowserEvent_,Zl?{passive:!1}:!1);var s=this.getOwnerDocument().defaultView,l=this.keyboardEventTarget_?this.keyboardEventTarget_:n;this.targetChangeHandlerKeys_=[ft(l,lt.KEYDOWN,this.handleBrowserEvent,this),ft(l,lt.KEYPRESS,this.handleBrowserEvent,this),ft(s,lt.RESIZE,this.updateSize,this)]}this.updateSize()},r.prototype.handleTileChange_=function(){this.render()},r.prototype.handleViewPropertyChanged_=function(){this.render()},r.prototype.handleViewChanged_=function(){this.viewPropertyListenerKey_&&(wt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(wt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);var t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=ft(t,mn.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=ft(t,lt.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()},r.prototype.handleLayerGroupChanged_=function(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(wt),this.layerGroupPropertyListenerKeys_=null);var t=this.getLayerGroup();t&&(this.handleLayerAdd_(new ir("addlayer",t)),this.layerGroupPropertyListenerKeys_=[ft(t,mn.PROPERTYCHANGE,this.render,this),ft(t,lt.CHANGE,this.render,this),ft(t,"addlayer",this.handleLayerAdd_,this),ft(t,"removelayer",this.handleLayerRemove_,this)]),this.render()},r.prototype.isRendered=function(){return!!this.frameState_},r.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()},r.prototype.redrawText=function(){for(var t=this.getLayerGroup().getLayerStatesArray(),e=0,n=t.length;e<n;++e){var o=t[e].layer;o.hasRenderer()&&o.getRenderer().handleFontsChanged()}},r.prototype.render=function(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))},r.prototype.removeControl=function(t){return this.getControls().remove(t)},r.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)},r.prototype.removeLayer=function(t){var e=this.getLayerGroup().getLayers();return e.remove(t)},r.prototype.handleLayerRemove_=function(t){ec(t.layer)},r.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)},r.prototype.renderFrame_=function(t){var e=this,n=this.getSize(),o=this.getView(),s=this.frameState_,l=null;if(n!==void 0&&Ia(n)&&o&&o.isDef()){var u=o.getHints(this.frameState_?this.frameState_.viewHints:void 0),h=o.getState();if(l={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Zo(h.center,h.resolution,h.rotation,n),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:n,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:h,viewHints:u,wantedTiles:{},mapId:gt(this),renderTargets:{}},h.nextCenter&&h.nextResolution){var p=isNaN(h.nextRotation)?h.rotation:h.nextRotation;l.nextExtent=Zo(h.nextCenter,h.nextResolution,p,n)}}if(this.frameState_=l,this.renderer_.renderFrame(l),l){if(l.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,l.postRenderFunctions),s){var d=!this.previousExtent_||!Ts(this.previousExtent_)&&!zn(l.extent,this.previousExtent_);d&&(this.dispatchEvent(new ln(rr.MOVESTART,this,s)),this.previousExtent_=si(this.previousExtent_))}var g=this.previousExtent_&&!l.viewHints[Wt.ANIMATING]&&!l.viewHints[Wt.INTERACTING]&&!zn(l.extent,this.previousExtent_);g&&(this.dispatchEvent(new ln(rr.MOVEEND,this,l)),ml(l.extent,this.previousExtent_))}this.dispatchEvent(new ln(rr.POSTRENDER,this,l)),this.renderComplete_=this.hasListener(rr.LOADSTART)||this.hasListener(rr.LOADEND)||this.hasListener(ur.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(function(){e.postRenderTimeoutHandle_=void 0,e.handlePostRender()},0))},r.prototype.setLayerGroup=function(t){var e=this.getLayerGroup();e&&this.handleLayerRemove_(new ir("removelayer",e)),this.set(Bt.LAYERGROUP,t)},r.prototype.setSize=function(t){this.set(Bt.SIZE,t)},r.prototype.setTarget=function(t){this.set(Bt.TARGET,t)},r.prototype.setView=function(t){if(!t||t instanceof or){this.set(Bt.VIEW,t);return}this.set(Bt.VIEW,new or);var e=this;t.then(function(n){e.setView(new or(n))})},r.prototype.updateSize=function(){var t=this.getTargetElement(),e=void 0;if(t){var n=getComputedStyle(t),o=t.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),s=t.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(o)&&!isNaN(s)&&(e=[o,s],!Ia(e)&&!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(e),this.updateViewportSize_()},r.prototype.updateViewportSize_=function(){var t=this.getView();if(t){var e=void 0,n=getComputedStyle(this.viewport_);n.width&&n.height&&(e=[parseInt(n.width,10),parseInt(n.height,10)]),t.setViewportSize(e)}},r}(Ie);function qv(i){var r=null;i.keyboardEventTarget!==void 0&&(r=typeof i.keyboardEventTarget=="string"?document.getElementById(i.keyboardEventTarget):i.keyboardEventTarget);var t={},e=i.layers&&typeof i.layers.getLayers=="function"?i.layers:new Io({layers:i.layers});t[Bt.LAYERGROUP]=e,t[Bt.TARGET]=i.target,t[Bt.VIEW]=i.view instanceof or?i.view:new or;var n;i.controls!==void 0&&(Array.isArray(i.controls)?n=new ue(i.controls.slice()):(ht(typeof i.controls.getArray=="function",47),n=i.controls));var o;i.interactions!==void 0&&(Array.isArray(i.interactions)?o=new ue(i.interactions.slice()):(ht(typeof i.interactions.getArray=="function",48),o=i.interactions));var s;return i.overlays!==void 0?Array.isArray(i.overlays)?s=new ue(i.overlays.slice()):(ht(typeof i.overlays.getArray=="function",49),s=i.overlays):s=new ue,{controls:n,interactions:o,keyboardEventTarget:r,overlays:s,values:t}}var Kv=zv,Hv=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Zv=function(i){Hv(r,i);function r(t){var e=i.call(this)||this,n=t.element;return n&&!t.target&&!n.style.pointerEvents&&(n.style.pointerEvents="auto"),e.element=n||null,e.target_=null,e.map_=null,e.listenerKeys=[],t.render&&(e.render=t.render),t.target&&e.setTarget(t.target),e}return r.prototype.disposeInternal=function(){ns(this.element),i.prototype.disposeInternal.call(this)},r.prototype.getMap=function(){return this.map_},r.prototype.setMap=function(t){this.map_&&ns(this.element);for(var e=0,n=this.listenerKeys.length;e<n;++e)wt(this.listenerKeys[e]);if(this.listenerKeys.length=0,this.map_=t,t){var o=this.target_?this.target_:t.getOverlayContainerStopEvent();o.appendChild(this.element),this.render!==Nr&&this.listenerKeys.push(ft(t,rr.POSTRENDER,this.render,this)),t.render()}},r.prototype.render=function(t){},r.prototype.setTarget=function(t){this.target_=typeof t=="string"?document.getElementById(t):t},r}(Ie),ta=Zv,Jv=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Qv=function(i){Jv(r,i);function r(t){var e=this,n=t||{};e=i.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this,e.ulElement_=document.createElement("ul"),e.collapsed_=n.collapsed!==void 0?n.collapsed:!0,e.userCollapsed_=e.collapsed_,e.overrideCollapsible_=n.collapsible!==void 0,e.collapsible_=n.collapsible!==void 0?n.collapsible:!0,e.collapsible_||(e.collapsed_=!1);var o=n.className!==void 0?n.className:"ol-attribution",s=n.tipLabel!==void 0?n.tipLabel:"Attributions",l=n.expandClassName!==void 0?n.expandClassName:o+"-expand",u=n.collapseLabel!==void 0?n.collapseLabel:"\u203A",h=n.collapseClassName!==void 0?n.collapseClassName:o+"-collapse";typeof u=="string"?(e.collapseLabel_=document.createElement("span"),e.collapseLabel_.textContent=u,e.collapseLabel_.className=h):e.collapseLabel_=u;var p=n.label!==void 0?n.label:"i";typeof p=="string"?(e.label_=document.createElement("span"),e.label_.textContent=p,e.label_.className=l):e.label_=p;var d=e.collapsible_&&!e.collapsed_?e.collapseLabel_:e.label_;e.toggleButton_=document.createElement("button"),e.toggleButton_.setAttribute("type","button"),e.toggleButton_.setAttribute("aria-expanded",String(!e.collapsed_)),e.toggleButton_.title=s,e.toggleButton_.appendChild(d),e.toggleButton_.addEventListener(lt.CLICK,e.handleClick_.bind(e),!1);var g=o+" "+Ro+" "+Ms+(e.collapsed_&&e.collapsible_?" "+La:"")+(e.collapsible_?"":" ol-uncollapsible"),_=e.element;return _.className=g,_.appendChild(e.toggleButton_),_.appendChild(e.ulElement_),e.renderedAttributions_=[],e.renderedVisible_=!0,e}return r.prototype.collectSourceAttributions_=function(t){for(var e={},n=[],o=!0,s=t.layerStatesArray,l=0,u=s.length;l<u;++l){var h=s[l];if(!!ao(h,t.viewState)){var p=h.layer.getSource();if(!!p){var d=p.getAttributions();if(!!d){var g=d(t);if(!!g)if(o=o&&p.getAttributionsCollapsible()!==!1,Array.isArray(g))for(var _=0,y=g.length;_<y;++_)g[_]in e||(n.push(g[_]),e[g[_]]=!0);else g in e||(n.push(g),e[g]=!0)}}}}return this.overrideCollapsible_||this.setCollapsible(o),n},r.prototype.updateElement_=function(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}var e=this.collectSourceAttributions_(t),n=e.length>0;if(this.renderedVisible_!=n&&(this.element.style.display=n?"":"none",this.renderedVisible_=n),!kr(e,this.renderedAttributions_)){Ch(this.ulElement_);for(var o=0,s=e.length;o<s;++o){var l=document.createElement("li");l.innerHTML=e[o],this.ulElement_.appendChild(l)}this.renderedAttributions_=e}},r.prototype.handleClick_=function(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_},r.prototype.handleToggle_=function(){this.element.classList.toggle(La),this.collapsed_?Pa(this.collapseLabel_,this.label_):Pa(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))},r.prototype.getCollapsible=function(){return this.collapsible_},r.prototype.setCollapsible=function(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())},r.prototype.setCollapsed=function(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()},r.prototype.getCollapsed=function(){return this.collapsed_},r.prototype.render=function(t){this.updateElement_(t.frameState)},r}(ta),t_=Qv,e_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),r_=function(i){e_(r,i);function r(t){var e=this,n=t||{};e=i.call(this,{element:document.createElement("div"),render:n.render,target:n.target})||this;var o=n.className!==void 0?n.className:"ol-rotate",s=n.label!==void 0?n.label:"\u21E7",l=n.compassClassName!==void 0?n.compassClassName:"ol-compass";e.label_=null,typeof s=="string"?(e.label_=document.createElement("span"),e.label_.className=l,e.label_.textContent=s):(e.label_=s,e.label_.classList.add(l));var u=n.tipLabel?n.tipLabel:"Reset rotation",h=document.createElement("button");h.className=o+"-reset",h.setAttribute("type","button"),h.title=u,h.appendChild(e.label_),h.addEventListener(lt.CLICK,e.handleClick_.bind(e),!1);var p=o+" "+Ro+" "+Ms,d=e.element;return d.className=p,d.appendChild(h),e.callResetNorth_=n.resetNorth?n.resetNorth:void 0,e.duration_=n.duration!==void 0?n.duration:250,e.autoHide_=n.autoHide!==void 0?n.autoHide:!0,e.rotation_=void 0,e.autoHide_&&e.element.classList.add(Gi),e}return r.prototype.handleClick_=function(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()},r.prototype.resetNorth_=function(){var t=this.getMap(),e=t.getView();if(!!e){var n=e.getRotation();n!==void 0&&(this.duration_>0&&n%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Sn}):e.setRotation(0))}},r.prototype.render=function(t){var e=t.frameState;if(!!e){var n=e.viewState.rotation;if(n!=this.rotation_){var o="rotate("+n+"rad)";if(this.autoHide_){var s=this.element.classList.contains(Gi);!s&&n===0?this.element.classList.add(Gi):s&&n!==0&&this.element.classList.remove(Gi)}this.label_.style.transform=o}this.rotation_=n}},r}(ta),n_=r_,i_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),o_=function(i){i_(r,i);function r(t){var e=this,n=t||{};e=i.call(this,{element:document.createElement("div"),target:n.target})||this;var o=n.className!==void 0?n.className:"ol-zoom",s=n.delta!==void 0?n.delta:1,l=n.zoomInClassName!==void 0?n.zoomInClassName:o+"-in",u=n.zoomOutClassName!==void 0?n.zoomOutClassName:o+"-out",h=n.zoomInLabel!==void 0?n.zoomInLabel:"+",p=n.zoomOutLabel!==void 0?n.zoomOutLabel:"\u2013",d=n.zoomInTipLabel!==void 0?n.zoomInTipLabel:"Zoom in",g=n.zoomOutTipLabel!==void 0?n.zoomOutTipLabel:"Zoom out",_=document.createElement("button");_.className=l,_.setAttribute("type","button"),_.title=d,_.appendChild(typeof h=="string"?document.createTextNode(h):h),_.addEventListener(lt.CLICK,e.handleClick_.bind(e,s),!1);var y=document.createElement("button");y.className=u,y.setAttribute("type","button"),y.title=g,y.appendChild(typeof p=="string"?document.createTextNode(p):p),y.addEventListener(lt.CLICK,e.handleClick_.bind(e,-s),!1);var E=o+" "+Ro+" "+Ms,w=e.element;return w.className=E,w.appendChild(_),w.appendChild(y),e.duration_=n.duration!==void 0?n.duration:250,e}return r.prototype.handleClick_=function(t,e){e.preventDefault(),this.zoomByDelta_(t)},r.prototype.zoomByDelta_=function(t){var e=this.getMap(),n=e.getView();if(!!n){var o=n.getZoom();if(o!==void 0){var s=n.getConstrainedZoom(o+t);this.duration_>0?(n.getAnimating()&&n.cancelAnimations(),n.animate({zoom:s,duration:this.duration_,easing:Sn})):n.setZoom(s)}}},r}(ta),s_=o_;function a_(i){var r=i||{},t=new ue,e=r.zoom!==void 0?r.zoom:!0;e&&t.push(new s_(r.zoomOptions));var n=r.rotate!==void 0?r.rotate:!0;n&&t.push(new n_(r.rotateOptions));var o=r.attribution!==void 0?r.attribution:!0;return o&&t.push(new t_(r.attributionOptions)),t}var _l={ACTIVE:"active"},l_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),u_=function(i){l_(r,i);function r(t){var e=i.call(this)||this;return e.on,e.once,e.un,t&&t.handleEvent&&(e.handleEvent=t.handleEvent),e.map_=null,e.setActive(!0),e}return r.prototype.getActive=function(){return this.get(_l.ACTIVE)},r.prototype.getMap=function(){return this.map_},r.prototype.handleEvent=function(t){return!0},r.prototype.setActive=function(t){this.set(_l.ACTIVE,t)},r.prototype.setMap=function(t){this.map_=t},r}(Ie);function c_(i,r,t){var e=i.getCenterInternal();if(e){var n=[e[0]+r[0],e[1]+r[1]];i.animateInternal({duration:t!==void 0?t:250,easing:lg,center:i.getConstrainedCenter(n)})}}function ea(i,r,t,e){var n=i.getZoom();if(n!==void 0){var o=i.getConstrainedZoom(n+r),s=i.getResolutionForZoom(o);i.getAnimating()&&i.cancelAnimations(),i.animate({resolution:s,anchor:t,duration:e!==void 0?e:250,easing:Sn})}}var di=u_,h_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),f_=function(i){h_(r,i);function r(t){var e=i.call(this)||this,n=t||{};return e.delta_=n.delta?n.delta:1,e.duration_=n.duration!==void 0?n.duration:250,e}return r.prototype.handleEvent=function(t){var e=!1;if(t.type==Et.DBLCLICK){var n=t.originalEvent,o=t.map,s=t.coordinate,l=n.shiftKey?-this.delta_:this.delta_,u=o.getView();ea(u,l,s,this.duration_),n.preventDefault(),e=!0}return!e},r}(di),p_=f_,d_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),g_=function(i){d_(r,i);function r(t){var e=this,n=t||{};return e=i.call(this,n)||this,n.handleDownEvent&&(e.handleDownEvent=n.handleDownEvent),n.handleDragEvent&&(e.handleDragEvent=n.handleDragEvent),n.handleMoveEvent&&(e.handleMoveEvent=n.handleMoveEvent),n.handleUpEvent&&(e.handleUpEvent=n.handleUpEvent),n.stopDown&&(e.stopDown=n.stopDown),e.handlingDownUpSequence=!1,e.trackedPointers_={},e.targetPointers=[],e}return r.prototype.getPointerCount=function(){return this.targetPointers.length},r.prototype.handleDownEvent=function(t){return!1},r.prototype.handleDragEvent=function(t){},r.prototype.handleEvent=function(t){if(!t.originalEvent)return!0;var e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==Et.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==Et.POINTERUP){var n=this.handleUpEvent(t);this.handlingDownUpSequence=n&&this.targetPointers.length>0}}else if(t.type==Et.POINTERDOWN){var o=this.handleDownEvent(t);this.handlingDownUpSequence=o,e=this.stopDown(o)}else t.type==Et.POINTERMOVE&&this.handleMoveEvent(t);return!e},r.prototype.handleMoveEvent=function(t){},r.prototype.handleUpEvent=function(t){return!1},r.prototype.stopDown=function(t){return t},r.prototype.updateTrackedPointers_=function(t){if(v_(t)){var e=t.originalEvent,n=e.pointerId.toString();t.type==Et.POINTERUP?delete this.trackedPointers_[n]:t.type==Et.POINTERDOWN?this.trackedPointers_[n]=e:n in this.trackedPointers_&&(this.trackedPointers_[n]=e),this.targetPointers=Jl(this.trackedPointers_)}},r}(di);function ra(i){for(var r=i.length,t=0,e=0,n=0;n<r;n++)t+=i[n].clientX,e+=i[n].clientY;return[t/r,e/r]}function v_(i){var r=i.type;return r===Et.POINTERDOWN||r===Et.POINTERDRAG||r===Et.POINTERUP}var gi=g_;function ms(i){var r=arguments;return function(t){for(var e=!0,n=0,o=r.length;n<o&&(e=e&&r[n](t),!!e);++n);return e}}var __=function(i){var r=i.originalEvent;return r.altKey&&!(r.metaKey||r.ctrlKey)&&r.shiftKey},y_=function(i){var r=i.map.getTargetElement(),t=i.map.getOwnerDocument().activeElement;return r.contains(t)},nc=function(i){return i.map.getTargetElement().hasAttribute("tabindex")?y_(i):!0},m_=pn,ic=function(i){var r=i.originalEvent;return r.button==0&&!(Rh&&Sh&&r.ctrlKey)},oc=function(i){var r=i.originalEvent;return!r.altKey&&!(r.metaKey||r.ctrlKey)&&!r.shiftKey},E_=function(i){var r=i.originalEvent;return!r.altKey&&!(r.metaKey||r.ctrlKey)&&r.shiftKey},sc=function(i){var r=i.originalEvent,t=r.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"},Bo=function(i){var r=i.originalEvent;return ht(r!==void 0,56),r.pointerType=="mouse"},w_=function(i){var r=i.originalEvent;return ht(r!==void 0,56),r.isPrimary&&r.button===0},T_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),R_=function(i){T_(r,i);function r(t){var e=i.call(this,{stopDown:wo})||this,n=t||{};e.kinetic_=n.kinetic,e.lastCentroid=null,e.lastPointersCount_,e.panning_=!1;var o=n.condition?n.condition:ms(oc,w_);return e.condition_=n.onFocusOnly?ms(nc,o):o,e.noKinetic_=!1,e}return r.prototype.handleDragEvent=function(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());var e=this.targetPointers,n=ra(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){var o=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],s=t.map,l=s.getView();bf(o,l.getResolution()),Fs(o,l.getRotation()),l.adjustCenterInternal(o)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()},r.prototype.handleUpEvent=function(t){var e=t.map,n=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var o=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),l=n.getCenterInternal(),u=e.getPixelFromCoordinateInternal(l),h=e.getCoordinateFromPixelInternal([u[0]-o*Math.cos(s),u[1]-o*Math.sin(s)]);n.animateInternal({center:n.getConstrainedCenter(h),duration:500,easing:Sn})}return this.panning_&&(this.panning_=!1,n.endInteraction()),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0},r.prototype.handleDownEvent=function(t){if(this.targetPointers.length>0&&this.condition_(t)){var e=t.map,n=e.getView();return this.lastCentroid=null,n.getAnimating()&&n.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1},r}(gi),S_=R_,x_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),C_=function(i){x_(r,i);function r(t){var e=this,n=t||{};return e=i.call(this,{stopDown:wo})||this,e.condition_=n.condition?n.condition:__,e.lastAngle_=void 0,e.duration_=n.duration!==void 0?n.duration:250,e}return r.prototype.handleDragEvent=function(t){if(!!Bo(t)){var e=t.map,n=e.getView();if(n.getConstraints().rotation!==Qs){var o=e.getSize(),s=t.pixel,l=Math.atan2(o[1]/2-s[1],s[0]-o[0]/2);if(this.lastAngle_!==void 0){var u=l-this.lastAngle_;n.adjustRotationInternal(-u)}this.lastAngle_=l}}},r.prototype.handleUpEvent=function(t){if(!Bo(t))return!0;var e=t.map,n=e.getView();return n.endInteraction(this.duration_),!1},r.prototype.handleDownEvent=function(t){if(!Bo(t))return!1;if(ic(t)&&this.condition_(t)){var e=t.map;return e.getView().beginInteraction(),this.lastAngle_=void 0,!0}else return!1},r}(gi),O_=C_,I_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),A_=function(i){I_(r,i);function r(t){var e=i.call(this)||this;return e.geometry_=null,e.element_=document.createElement("div"),e.element_.style.position="absolute",e.element_.style.pointerEvents="auto",e.element_.className="ol-box "+t,e.map_=null,e.startPixel_=null,e.endPixel_=null,e}return r.prototype.disposeInternal=function(){this.setMap(null)},r.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,n="px",o=this.element_.style;o.left=Math.min(t[0],e[0])+n,o.top=Math.min(t[1],e[1])+n,o.width=Math.abs(e[0]-t[0])+n,o.height=Math.abs(e[1]-t[1])+n},r.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)},r.prototype.setPixels=function(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()},r.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]],o=n.map(this.map_.getCoordinateFromPixelInternal,this.map_);o[4]=o[0].slice(),this.geometry_?this.geometry_.setCoordinates([o]):this.geometry_=new ii([o])},r.prototype.getGeometry=function(){return this.geometry_},r}(bs),P_=A_,ac=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Wi={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"},Wo=function(i){ac(r,i);function r(t,e,n){var o=i.call(this,t)||this;return o.coordinate=e,o.mapBrowserEvent=n,o}return r}(Ve),b_=function(i){ac(r,i);function r(t){var e=i.call(this)||this;e.on,e.once,e.un;var n=t||{};return e.box_=new P_(n.className||"ol-dragbox"),e.minArea_=n.minArea!==void 0?n.minArea:64,n.onBoxEnd&&(e.onBoxEnd=n.onBoxEnd),e.startPixel_=null,e.condition_=n.condition?n.condition:ic,e.boxEndCondition_=n.boxEndCondition?n.boxEndCondition:e.defaultBoxEndCondition,e}return r.prototype.defaultBoxEndCondition=function(t,e,n){var o=n[0]-e[0],s=n[1]-e[1];return o*o+s*s>=this.minArea_},r.prototype.getGeometry=function(){return this.box_.getGeometry()},r.prototype.handleDragEvent=function(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Wo(Wi.BOXDRAG,t.coordinate,t))},r.prototype.handleUpEvent=function(t){this.box_.setMap(null);var e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Wo(e?Wi.BOXEND:Wi.BOXCANCEL,t.coordinate,t)),!1},r.prototype.handleDownEvent=function(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Wo(Wi.BOXSTART,t.coordinate,t)),!0):!1},r.prototype.onBoxEnd=function(t){},r}(gi),L_=b_,M_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),N_=function(i){M_(r,i);function r(t){var e=this,n=t||{},o=n.condition?n.condition:E_;return e=i.call(this,{condition:o,className:n.className||"ol-dragzoom",minArea:n.minArea})||this,e.duration_=n.duration!==void 0?n.duration:200,e.out_=n.out!==void 0?n.out:!1,e}return r.prototype.onBoxEnd=function(t){var e=this.getMap(),n=e.getView(),o=this.getGeometry();if(this.out_){var s=n.rotatedExtentForGeometry(o),l=n.getResolutionForExtentInternal(s),u=n.getResolution()/l;o=o.clone(),o.scale(u*u)}n.fitInternal(o,{duration:this.duration_,easing:Sn})},r}(L_),D_=N_,Rr={LEFT:37,UP:38,RIGHT:39,DOWN:40},F_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),G_=function(i){F_(r,i);function r(t){var e=i.call(this)||this,n=t||{};return e.defaultCondition_=function(o){return oc(o)&&sc(o)},e.condition_=n.condition!==void 0?n.condition:e.defaultCondition_,e.duration_=n.duration!==void 0?n.duration:100,e.pixelDelta_=n.pixelDelta!==void 0?n.pixelDelta:128,e}return r.prototype.handleEvent=function(t){var e=!1;if(t.type==lt.KEYDOWN){var n=t.originalEvent,o=n.keyCode;if(this.condition_(t)&&(o==Rr.DOWN||o==Rr.LEFT||o==Rr.RIGHT||o==Rr.UP)){var s=t.map,l=s.getView(),u=l.getResolution()*this.pixelDelta_,h=0,p=0;o==Rr.DOWN?p=-u:o==Rr.LEFT?h=-u:o==Rr.RIGHT?h=u:p=u;var d=[h,p];Fs(d,l.getRotation()),c_(l,d,this.duration_),n.preventDefault(),e=!0}}return!e},r}(di),k_=G_,U_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),j_=function(i){U_(r,i);function r(t){var e=i.call(this)||this,n=t||{};return e.condition_=n.condition?n.condition:sc,e.delta_=n.delta?n.delta:1,e.duration_=n.duration!==void 0?n.duration:100,e}return r.prototype.handleEvent=function(t){var e=!1;if(t.type==lt.KEYDOWN||t.type==lt.KEYPRESS){var n=t.originalEvent,o=n.charCode;if(this.condition_(t)&&(o=="+".charCodeAt(0)||o=="-".charCodeAt(0))){var s=t.map,l=o=="+".charCodeAt(0)?this.delta_:-this.delta_,u=s.getView();ea(u,l,void 0,this.duration_),n.preventDefault(),e=!0}}return!e},r}(di),$_=j_,X_=function(){function i(r,t,e){this.decay_=r,this.minVelocity_=t,this.delay_=e,this.points_=[],this.angle_=0,this.initialVelocity_=0}return i.prototype.begin=function(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0},i.prototype.update=function(r,t){this.points_.push(r,t,Date.now())},i.prototype.end=function(){if(this.points_.length<6)return!1;var r=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<r)return!1;for(var e=t-3;e>0&&this.points_[e+2]>r;)e-=3;var n=this.points_[t+2]-this.points_[e+2];if(n<1e3/60)return!1;var o=this.points_[t]-this.points_[e],s=this.points_[t+1]-this.points_[e+1];return this.angle_=Math.atan2(s,o),this.initialVelocity_=Math.sqrt(o*o+s*s)/n,this.initialVelocity_>this.minVelocity_},i.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_},i.prototype.getAngle=function(){return this.angle_},i}(),Y_=X_,V_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),zo={TRACKPAD:"trackpad",WHEEL:"wheel"},B_=function(i){V_(r,i);function r(t){var e=this,n=t||{};e=i.call(this,n)||this,e.totalDelta_=0,e.lastDelta_=0,e.maxDelta_=n.maxDelta!==void 0?n.maxDelta:1,e.duration_=n.duration!==void 0?n.duration:250,e.timeout_=n.timeout!==void 0?n.timeout:80,e.useAnchor_=n.useAnchor!==void 0?n.useAnchor:!0,e.constrainResolution_=n.constrainResolution!==void 0?n.constrainResolution:!1;var o=n.condition?n.condition:m_;return e.condition_=n.onFocusOnly?ms(nc,o):o,e.lastAnchor_=null,e.startTime_=void 0,e.timeoutId_,e.mode_=void 0,e.trackpadEventGap_=400,e.trackpadTimeoutId_,e.deltaPerZoom_=300,e}return r.prototype.endInteraction_=function(){this.trackpadTimeoutId_=void 0;var t=this.getMap().getView();t.endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)},r.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;var e=t.type;if(e!==lt.WHEEL)return!0;var n=t.map,o=t.originalEvent;o.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);var s;if(t.type==lt.WHEEL&&(s=o.deltaY,wh&&o.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Hl),o.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;var l=Date.now();this.startTime_===void 0&&(this.startTime_=l),(!this.mode_||l-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?zo.TRACKPAD:zo.WHEEL);var u=n.getView();if(this.mode_===zo.TRACKPAD&&!(u.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(u.getAnimating()&&u.cancelAnimations(),u.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),u.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=l,!1;this.totalDelta_+=s;var h=Math.max(this.timeout_-(l-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,n),h),!1},r.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();var n=-Gt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(n=n?n>0?1:-1:0),ea(e,n,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0},r.prototype.setMouseAnchor=function(t){this.useAnchor_=t,t||(this.lastAnchor_=null)},r}(di),W_=B_,z_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),q_=function(i){z_(r,i);function r(t){var e=this,n=t||{},o=n;return o.stopDown||(o.stopDown=wo),e=i.call(this,o)||this,e.anchor_=null,e.lastAngle_=void 0,e.rotating_=!1,e.rotationDelta_=0,e.threshold_=n.threshold!==void 0?n.threshold:.3,e.duration_=n.duration!==void 0?n.duration:250,e}return r.prototype.handleDragEvent=function(t){var e=0,n=this.targetPointers[0],o=this.targetPointers[1],s=Math.atan2(o.clientY-n.clientY,o.clientX-n.clientX);if(this.lastAngle_!==void 0){var l=s-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=l}this.lastAngle_=s;var u=t.map,h=u.getView();if(h.getConstraints().rotation!==Qs){var p=u.getViewport().getBoundingClientRect(),d=ra(this.targetPointers);d[0]-=p.left,d[1]-=p.top,this.anchor_=u.getCoordinateFromPixelInternal(d),this.rotating_&&(u.render(),h.adjustRotationInternal(e,this.anchor_))}},r.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map,n=e.getView();return n.endInteraction(this.duration_),!1}else return!0},r.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1},r}(gi),K_=q_,H_=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),Z_=function(i){H_(r,i);function r(t){var e=this,n=t||{},o=n;return o.stopDown||(o.stopDown=wo),e=i.call(this,o)||this,e.anchor_=null,e.duration_=n.duration!==void 0?n.duration:400,e.lastDistance_=void 0,e.lastScaleDelta_=1,e}return r.prototype.handleDragEvent=function(t){var e=1,n=this.targetPointers[0],o=this.targetPointers[1],s=n.clientX-o.clientX,l=n.clientY-o.clientY,u=Math.sqrt(s*s+l*l);this.lastDistance_!==void 0&&(e=this.lastDistance_/u),this.lastDistance_=u;var h=t.map,p=h.getView();e!=1&&(this.lastScaleDelta_=e);var d=h.getViewport().getBoundingClientRect(),g=ra(this.targetPointers);g[0]-=d.left,g[1]-=d.top,this.anchor_=h.getCoordinateFromPixelInternal(g),h.render(),p.adjustResolutionInternal(e,this.anchor_)},r.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map,n=e.getView(),o=this.lastScaleDelta_>1?1:-1;return n.endInteraction(this.duration_,o),!1}else return!0},r.prototype.handleDownEvent=function(t){if(this.targetPointers.length>=2){var e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1},r}(gi),J_=Z_;function Q_(i){var r=i||{},t=new ue,e=new Y_(-.005,.05,100),n=r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0;n&&t.push(new O_);var o=r.doubleClickZoom!==void 0?r.doubleClickZoom:!0;o&&t.push(new p_({delta:r.zoomDelta,duration:r.zoomDuration}));var s=r.dragPan!==void 0?r.dragPan:!0;s&&t.push(new S_({onFocusOnly:r.onFocusOnly,kinetic:e}));var l=r.pinchRotate!==void 0?r.pinchRotate:!0;l&&t.push(new K_);var u=r.pinchZoom!==void 0?r.pinchZoom:!0;u&&t.push(new J_({duration:r.zoomDuration}));var h=r.keyboard!==void 0?r.keyboard:!0;h&&(t.push(new k_),t.push(new $_({delta:r.zoomDelta,duration:r.zoomDuration})));var p=r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0;p&&t.push(new W_({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration}));var d=r.shiftDragZoom!==void 0?r.shiftDragZoom:!0;return d&&t.push(new D_({duration:r.zoomDuration})),t}var ty=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ey=function(i){ty(r,i);function r(t){return t=Ft({},t),t.controls||(t.controls=a_()),t.interactions||(t.interactions=Q_({onFocusOnly:!0})),i.call(this,t)||this}return r.prototype.createRenderer=function(){return new wv(this)},r}(Kv),ry=ey,ny=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),iy=function(i){ny(r,i);function r(t){var e=this,n=t.imageSmoothing!==void 0?t.imageSmoothing:!0;return t.interpolate!==void 0&&(n=t.interpolate),e=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:oy,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:n,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})||this,e.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,e.tileClass=t.tileClass!==void 0?t.tileClass:Bu,e.tileCacheForProjection={},e.tileGridForProjection={},e.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,e.renderReprojectionEdges_=!1,e}return r.prototype.canExpireCache=function(){if(!De)return i.prototype.canExpireCache.call(this);if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1},r.prototype.expireCache=function(t,e){if(!De){i.prototype.expireCache.call(this,t,e);return}var n=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==n?e:{});for(var o in this.tileCacheForProjection){var s=this.tileCacheForProjection[o];s.expireCache(s==n?e:{})}},r.prototype.getGutterForProjection=function(t){return De&&this.getProjection()&&t&&!xr(this.getProjection(),t)?0:this.getGutter()},r.prototype.getGutter=function(){return 0},r.prototype.getKey=function(){var t=i.prototype.getKey.call(this);return this.getInterpolate()||(t+=":disable-interpolation"),t},r.prototype.getOpaque=function(t){return De&&this.getProjection()&&t&&!xr(this.getProjection(),t)?!1:i.prototype.getOpaque.call(this,t)},r.prototype.getTileGridForProjection=function(t){if(!De)return i.prototype.getTileGridForProjection.call(this,t);var e=this.getProjection();if(this.tileGrid&&(!e||xr(e,t)))return this.tileGrid;var n=gt(t);return n in this.tileGridForProjection||(this.tileGridForProjection[n]=Ju(t)),this.tileGridForProjection[n]},r.prototype.getTileCacheForProjection=function(t){if(!De)return i.prototype.getTileCacheForProjection.call(this,t);var e=this.getProjection();if(!e||xr(e,t))return this.tileCache;var n=gt(t);return n in this.tileCacheForProjection||(this.tileCacheForProjection[n]=new Hu(this.tileCache.highWaterMark)),this.tileCacheForProjection[n]},r.prototype.createTile_=function(t,e,n,o,s,l){var u=[t,e,n],h=this.getTileCoordForTileUrlFunction(u,s),p=h?this.tileUrlFunction(h,o,s):void 0,d=new this.tileClass(u,p!==void 0?et.IDLE:et.EMPTY,p!==void 0?p:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return d.key=l,d.addEventListener(lt.CHANGE,this.handleTileChange.bind(this)),d},r.prototype.getTile=function(t,e,n,o,s){var l=this.getProjection();if(!De||!l||!s||xr(l,s))return this.getTileInternal(t,e,n,o,l||s);var u=this.getTileCacheForProjection(s),h=[t,e,n],p=void 0,d=Ku(h);u.containsKey(d)&&(p=u.get(d));var g=this.getKey();if(p&&p.key==g)return p;var _=this.getTileGridForProjection(l),y=this.getTileGridForProjection(s),E=this.getTileCoordForTileUrlFunction(h,s),w=new Wu(l,_,s,y,h,E,this.getTilePixelRatio(o),this.getGutter(),function(C,x,S,R){return this.getTileInternal(C,x,S,R,l)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return w.key=g,p?(w.interimTile=p,w.refreshInterimChain(),u.replace(d,w)):u.set(d,w),w},r.prototype.getTileInternal=function(t,e,n,o,s){var l=null,u=Ao(t,e,n),h=this.getKey();if(!this.tileCache.containsKey(u))l=this.createTile_(t,e,n,o,s,h),this.tileCache.set(u,l);else if(l=this.tileCache.get(u),l.key!=h){var p=l;l=this.createTile_(t,e,n,o,s,h),p.getState()==et.IDLE?l.interimTile=p.interimTile:l.interimTile=p,l.refreshInterimChain(),this.tileCache.replace(u,l)}return l},r.prototype.setRenderReprojectionEdges=function(t){if(!(!De||this.renderReprojectionEdges_==t)){this.renderReprojectionEdges_=t;for(var e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}},r.prototype.setTileGridForProjection=function(t,e){if(De){var n=Pt(t);if(n){var o=gt(n);o in this.tileGridForProjection||(this.tileGridForProjection[o]=e)}}},r}(qg);function oy(i,r){i.getImage().src=r}var sy=iy,ay=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),ly=function(i){ay(r,i);function r(t){var e=this,n=t||{},o=Ft({},n);return delete o.preload,delete o.useInterimTilesOnError,e=i.call(this,o)||this,e.on,e.once,e.un,e.setPreload(n.preload!==void 0?n.preload:0),e.setUseInterimTilesOnError(n.useInterimTilesOnError!==void 0?n.useInterimTilesOnError:!0),e}return r.prototype.getPreload=function(){return this.get(Yi.PRELOAD)},r.prototype.setPreload=function(t){this.set(Yi.PRELOAD,t)},r.prototype.getUseInterimTilesOnError=function(){return this.get(Yi.USE_INTERIM_TILES_ON_ERROR)},r.prototype.setUseInterimTilesOnError=function(t){this.set(Yi.USE_INTERIM_TILES_ON_ERROR,t)},r.prototype.getData=function(t){return i.prototype.getData.call(this,t)},r}(Oo),uy=ly,cy=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),hy=function(i){cy(r,i);function r(t){return i.call(this,t)||this}return r.prototype.createRenderer=function(){return new Sg(this)},r}(uy),fy=hy,py=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),dy=function(i){py(r,i);function r(t){var e=t||{},n=e.imageSmoothing!==void 0?e.imageSmoothing:!0;e.interpolate!==void 0&&(n=e.interpolate);var o=e.projection!==void 0?e.projection:"EPSG:3857",s=e.tileGrid!==void 0?e.tileGrid:Gg({extent:Hs(o),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});return i.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:n,opaque:e.opaque,projection:o,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:s,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection})||this}return r}(sy),gy=dy,vy=globalThis&&globalThis.__extends||function(){var i=function(r,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])},i(r,t)};return function(r,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");i(r,t);function e(){this.constructor=r}r.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}}(),_y='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.',yy=function(i){vy(r,i);function r(t){var e=t||{},n=e.imageSmoothing!==void 0?e.imageSmoothing:!0;e.interpolate!==void 0&&(n=e.interpolate);var o;e.attributions!==void 0?o=e.attributions:o=[_y];var s=e.crossOrigin!==void 0?e.crossOrigin:"anonymous",l=e.url!==void 0?e.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";return i.call(this,{attributions:o,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:s,interpolate:n,maxZoom:e.maxZoom!==void 0?e.maxZoom:19,opaque:e.opaque!==void 0?e.opaque:!0,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:l,wrapX:e.wrapX,zDirection:e.zDirection})||this}return r}(gy),my=yy;const gn=(i,r,t,e,n=5)=>{let o=[i,r];typeof window.$barry.layers[e]!="undefined"&&window.$barry.map.removeLayer(window.$barry.layers[e]),e.startsWith("place")&&(window.$barry.places[e]=o,window.$barry.canCalculate());const s=new ni(o),l=new zs(s);l.setId(e);const u=new qs({source:new ju({features:[l]}),style:new uu({image:new ou({radius:n,fill:new su({color:t})})})});window.$barry.layers[e]=u,window.$barry.map.addLayer(u)},Ey=(i,r,t,e=3)=>{typeof window.$barry.layers[t]!=null&&window.$barry.map.removeLayer(window.$barry.layers[t]);const n=new dv,o=new zs({geometry:n.readGeometry(i)});o.setId(t),o.setStyle(new uu({stroke:new au({color:r,width:e})}));var s=new ju({features:[o]}),l=new qs({source:s});window.$barry.layers[t]=l,window.$barry.map.addLayer(l)},wy=(i,r,t)=>{const e=Object.keys(window.$barry.places);let n=[];for(let o=0;o<e.length;o++)e[o].startsWith("place")&&n.push(new Promise(s=>{rs(window.$barry.places[e[o]],i,o).then(l=>{const u=l.totalTime,h=Math.floor(u/3600),p=Math.floor(u/60%60);Ey(l.routeGeometry,window.$barry.roadColor,`route_${l.key}`),window.$barry.log(`
<span onmouseenter="window.$barry.showNav('route_${l.key}', 1);"
      onmouseleave="window.$barry.showNav('route_${l.key}', 0)"
      onclick="window.$barry.zoom([[${l.bbox.top}, ${l.bbox.left}],[${l.bbox.bottom}, ${l.bbox.right}]])"
>
  De 
  <b>
    ${document.querySelector(`input[data-city="${e[o]}"]`).value}
  </b>
  , il y 
  <b>
    ${Math.round(100*parseFloat(l.totalDistance)/1e3)/100}
  </b>
  km en
  <b>
    ${h} h ${p<10?"0"+p:p}
  </b>
</span>`),s()})}));window.$barry.log("Je calcule le trajet pour chaque ville.",1),Promise.all(n).then(()=>{gn(i[0],i[1],r,t)})},Ty=i=>new Promise(r=>{go.exports.Services.reverseGeocode({position:{x:i[0],y:i[1]},filterOptions:{type:["PositionOfInterest"]},apiKey:"calcul",onSuccess:function(t){let e=!1;t.locations.forEach(n=>{n.matchType=="City"&&!e&&(e=!0,window.$barry.log(`On se retrouve donc \xE0 <b>${n.placeAttributes.commune}</b>`),r([n.position.x,n.position.y]))}),r(i)},onFailure:function(t){alert(t),r(i)}})}),Ry=()=>new Promise((i,r)=>{window.$barry.log("Je calcule tous les chemins !",1);let t=[];const e=Object.keys(window.$barry.places);for(let n=0;n<e.length;n++)for(let o=n+1;o<e.length;o++)e[n].startsWith("place")&&e[o].startsWith("place")&&t.push(rs(window.$barry.places[e[n]],window.$barry.places[e[o]],e[n]+";"+e[o]));Promise.all(t).then(n=>{let o=0,s=0,l=n[0].key;for(let h=0;h<n.length;h++){const p=parseFloat(n[h].totalTime),d=parseFloat(n[h].totalDistance),g=Math.floor(p/3600),_=Math.floor(p/60%60);let y=n[h].key.split(";");window.$barry.log(`Entre "${document.querySelector(`input[data-city="${y[0]}"]`).value}" et "${document.querySelector(`input[data-city="${y[1]}"]`).value}" il y a ${Math.round(100*d/1e3)/100} km en ${g}h${_<10?"0"+_:_}`,1),(window.$barry.calculateMode=="time"&&p>s||window.$barry.calculateMode=="distance"&&d>o)&&(o=d,s=p,l=n[h].key)}let u=l.split(";");window.$barry.log(`Le trajet le plus long (en ${window.$barry.calculateMode=="time"?"temps":"distance"}) est donc entre "${document.querySelector(`input[data-city="${u[0]}"]`).value}" et "${document.querySelector(`input[data-city="${u[1]}"]`).value}"`,1),window.$barry.log("Je calcule le point \xE0 mi-temps.",1),u.length>1?rs(window.$barry.places[u[0]],window.$barry.places[u[1]],"",!0).then(h=>{let p=null;const d=h.routeInstructions.length;let g=0,_=0;const y=Math.round(s/2),E=Math.round(o/2);for(let w=0;w<d&&(_+=parseFloat(h.routeInstructions[w].distance),g+=parseFloat(h.routeInstructions[w].duration),p=h.routeInstructions[w],!(window.$barry.calculateMode=="time"&&g>y||window.$barry.calculateMode=="distance"&&_>E));w++);if(p!=null){let w=0;window.$barry.calculateMode=="time"?w=(g-y)/parseFloat(p.duration):window.$barry.calculateMode=="distance"&&(w=(_-E)/parseFloat(p.distance)),window.$barry.log("Le point est trouv\xE9.",1),i(p.geometry.coordinates[Math.round((1-w)*p.geometry.coordinates.length)])}}):r("Pas de point trouv\xE9")})});function Sy(){return new Promise(i=>{const r=Object.keys(window.$barry.places);let t=0,e=0;for(let n=0;n<r.length;n++)r[n].startsWith("place")&&(t+=parseFloat(window.$barry.places[r[n]][0]),e+=parseFloat(window.$barry.places[r[n]][1]));t/=r.length,e/=r.length,window.$barry.log("Je fais la moyenne des coordonn\xE9es des villes.",1),i([t,e])})}const xy=()=>new Promise(i=>{const r=window.$barry.calcBox();window.$barry.log("Je d\xE9termine les latitudes et longitudes minimales et maximales pour d\xE9finir un cadre et je calcule le centre du cadre.",1),i([(r[1][1]+r[0][1])/2,(r[1][0]+r[0][0])/2])});window.$barry.calculate=()=>{window.$barry.$logContent.innerHTML="",window.$barry.$log.classList.remove("hide"),window.$barry.$spinner.classList.remove("hide"),window.$barry.$rappel.classList.add("hide");let i=[];i.push(window.$barry.calculateMode),document.querySelectorAll(".address").forEach(n=>{const o=n.querySelector("input").value;o==""?window.$barry.removeAddress(n.id):(i.push(o),n.querySelectorAll("button").forEach(s=>s.classList.add("hide")))}),window.location.hash=btoa(i.join("|")),window.$barry.log("C'est parti pour rechercher votre point de rencontre \xE9quitable");let r=[Ry(),Sy(),xy()],t=["longMiddle","average","center"],e=[8,2,1];Promise.all(r).then(n=>{window.$barry.log("J'ai fini les diff\xE9rents calculs, je prend maintenant la moyenne des coordonn\xE9es.",1);let o=0,s=0,l=0;Object.keys(window.$barry.places).length>2?(n.map((u,h)=>{for(let p=0;p<e[h];p++)o+=parseFloat(u[0]),s+=parseFloat(u[1]),l++;gn(u[0],u[1],window.$barry.methods[t[h]].color,t[h])}),o/=l,s/=l):(o=n[0][0],s=n[0][1],gn(o,s,window.$barry.methods[t[0]].color,t[0])),window.$barry.log(`On se retrouve \xE0 [${o}, ${s}]`,1),window.$barry.log("Je cherche la ville la plus proche du point.",1),gn(o,s,window.$barry.resultColor,"result"),Ty([o,s]).then(u=>{u[0]==u[1]&&u[0]==0?window.$barry.log("Pas de ville trouv\xE9e proche, je suis d\xE9sol\xE9 mais va falloir le faire \xE0 la main."):(wy(u,window.$barry.resultColor,"result"),po(),window.$barry.meetPoint=u,window.$barry.$pois.classList.remove("hide")),window.$barry.$spinner.classList.add("hide"),window.$barry.$calculate.classList.add("hide"),window.$barry.$newsearch.classList.remove("hide")})})};window.$barry.canCalculate=()=>{Object.keys(window.$barry.places).length>1?window.$barry.$calculate.classList.remove("hide"):window.$barry.$calculate.classList.add("hide")};window.$barry.canPlace=i=>{window.$barry.addressToCalc[i]=!0};window.$barry.changeCalcMode=()=>{window.$barry.calculateMode=="time"?window.$barry.calculateMode="distance":window.$barry.calculateMode="time"};window.$barry.changeCalcTransport=()=>{window.$barry.calculateTransport=="car"?window.$barry.calculateTransport="pedestrian":window.$barry.calculateTransport="car"};window.$barry.changeCalcToll=()=>{window.$barry.calculateToll=!window.$barry.calculateToll};window.$barry.changeLogMode=()=>{window.$barry.$log.querySelectorAll(".log-1").forEach(i=>{window.$barry.$toggleLogMode.checked?i.classList.remove("hide"):i.classList.add("hide")})};window.$barry.log=(i,r)=>{typeof r=="undefined"&&(r=0),window.$barry.$logContent.innerHTML+=`<p class="log-${r}${r>0?" hide":""}">${i}</p>`};window.$barry.managePOI=i=>{Object.keys(window.$barry.layers).forEach(r=>{r.startsWith("poi_")&&window.$barry.map.removeLayer(window.$barry.layers[r])});for(let r in window.$barry.pois){const t=window.$barry.pois[r];t.categories.includes(i)&&gn(t.longitude,t.latitude,"#131282",`poi_${t.identifier}`,3)}};window.$barry.newAddress=i=>{if(typeof i!="undefined"){const t=document.getElementById(i);t.querySelector(".plus").classList.toggle("hide"),t.querySelector(".minus").classList.toggle("hide")}const r=document.createElement("div");r.classList.add("address"),r.id=`address_${window.$barry.addressesCount}`,r.innerHTML=`
<input type="text"
       placeholder="Adresse postale"
       onfocus="window.$barry.canPlace('place_${window.$barry.addressesCount}')"
       onblur="window.$barry.placePoint(this.value, 'place_${window.$barry.addressesCount}');"
       onkeydown="window.$barry.calcAddress(event, '${window.$barry.addressesCount}', this.value)"
       data-city="place_${window.$barry.addressesCount}" />
<button class="minus hide" 
        onclick="window.$barry.removeAddress('address_${window.$barry.addressesCount}')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
    </svg>
</button>
<button class="plus" 
        onclick="window.$barry.newAddress('address_${window.$barry.addressesCount}')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
    </svg>
</button>
      `,window.$barry.$addressesWrapper.appendChild(r),window.$barry.addressesCount++,window.$barry.nbPlaces++};const lc=()=>{po([[51.31133241804094,-4.369239747680932],[42.14745185055437,8.623599144082085]])};window.$barry.newSearch=()=>{window.$barry.$log.classList.add("hide"),window.$barry.$newsearch.classList.add("hide"),window.$barry.$rappel.classList.remove("hide"),document.querySelectorAll(".address").forEach(i=>{i.parentNode.removeChild(i)}),window.$barry.addressesCount=0,window.$barry.places={},Object.keys(window.$barry.layers).forEach(i=>{window.$barry.map.removeLayer(window.$barry.layers[i])}),window.$barry.layers={},window.$barry.newAddress(),lc(),window.$barry.$pois.classList.remove("hide"),window.$barry.pois=[],window.location.hash=""};const Cy=(i,r)=>{if(i.trim()!="")return go.exports.Services.geocode({location:i,apiKey:"calcul",onSuccess:t=>{gn(t.locations[0].position.y,t.locations[0].position.x,window.$barry.addressColor,r)},onFailure:t=>{alert(t)}});window.$barry.canCalculate()};window.$barry.placePoint=(i,r)=>{window.$barry.addressToCalc[r]&&window.$barry.$newsearch.classList.contains("hide")&&(window.$barry.addressToCalc[r]=!1,window.$barry.$calculate.classList.add("hide"),Cy(i,r))};window.$barry.removeAddress=i=>{window.$barry.nbPlaces--;const r=document.getElementById(i);r.parentNode.removeChild(r),i=i.replace("address_","place_"),delete window.$barry.places[i],window.$barry.map.removeLayer(window.$barry.layers[i]),delete window.$barry.layers[i]};window.$barry.showPOI=i=>{document.querySelectorAll("#pois a").forEach(r=>r.classList.remove("active")),document.querySelector(`#pois a[data-cat="${i}"]`).classList.add("active"),Object.keys(window.$barry.pois).length==0?window.$barry.tourisme().then(r=>{r.forEach(t=>{window.$barry.pois[`poi_${t.identifier}`]=t}),window.$barry.managePOI(i)}):window.$barry.managePOI(i)};window.$barry.showNav=(i,r)=>{Object.keys(window.$barry.layers).forEach(t=>{t.startsWith("route_")&&window.$barry.layers[t].setVisible(r==1?t.startsWith(i):!0)})};window.$barry.toggleConfiguration=()=>{window.$barry.$configuration.classList.toggle("hide"),window.$barry.$reduceConfiguration.classList.toggle("hide"),window.$barry.$augmentConfiguration.classList.toggle("hide")};window.$barry.toggleWelcome=()=>{window.$barry.$welcome.querySelector("div").classList.toggle("hide"),window.$barry.$reduceWelcome.classList.toggle("hide"),window.$barry.$augmentWelcome.classList.toggle("hide")};window.$barry.tourisme=()=>{let i=new URL(window.$barry.urlTourismAPI);const r=window.$barry.meetPoint,t={lat_min:parseFloat(r[1])-.2,lat_max:parseFloat(r[1])+.2,lng_min:parseFloat(r[0])-.3,lng_max:parseFloat(r[0])+.3};Object.keys(t).forEach(n=>i.searchParams.append(n,t[n]));const e=[[t.lat_min,t.lng_min],[t.lat_max,t.lng_max]];return po(e),fetch(i).then(function(n){return n.text()}).then(function(n){try{return JSON.parse(n)}catch{return n}})};window.$barry.zoom=i=>{po(i)};const Oy=()=>{window.$barry.layers={},Uf(),window.$barry.map=new ry({target:"map",layers:[new fy({source:new my})],view:new or({center:[2.213749,46.927638],zoom:2})}),window.$barry.map.on("pointermove",i=>{window.$barry.map.forEachFeatureAtPixel(i.pixel,r=>{if(r.id_.startsWith("poi_")){const t=window.$barry.pois[r.id_];window.$barry.$popin.innerHTML=`
<h3>${t.label}</h3>
<p>${t.description}</p>
<ul>
  <li>
    ${t.address.replace(/\|/g,"<br />")}<br />${t.postcode} ${t.city}
  </li>
  <li>
    <a href="tel:${t.phone}">${t.phone}</a>
  </li>
  <li>
    <a href="mailto:${t.mail}">${t.mail}</a>
  </li>
</ul>
`,window.$barry.$popin.classList.remove("hide")}else window.$barry.$popin.classList.add("hide")},{layerFilter:r=>r.type===new qs().type,hitTolerance:6})})};Oy();lc();window.$barry.newAddress();if(window.location.hash!=""){const i=atob(window.location.hash.substring(1)).split("|");i.length>1&&(window.$barry.calculateMode=i.shift(),window.$barry.calculateMode!="time"&&(window.$barry.$toggleCalcMode.checked=!0),i.forEach(r=>{const t=window.$barry.addressesCount-1;window.$barry.canPlace(`place_${t}`),window.$barry.placePoint(r,`place_${t}`);const e=document.getElementById(`address_${t}`);e.querySelector("input").value=r,e.querySelector(".plus").classList.add("hide"),e.querySelector(".minus").classList.remove("hide"),window.$barry.newAddress()}))}
