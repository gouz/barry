(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();window.$barry={methods:{longMiddle:{label:"Le mi-chemin en temps sur le plus long trajet entre toutes les villes",color:"#10b981"},average:{label:"La moyenne des coordonnées des villes",color:"#3b82f6"},center:{label:"Le centre du cadre dans lequel toutes les villes sont présentes",color:"#f59e0b"}},addressColor:"#111827",resultColor:"#EF4444",roadColor:"#47695B",calculateMode:"time",calculateTransport:"car",calculateToll:!0,addressesCount:0,places:{},layers:{},addressToCalc:{},urlTourismAPI:"https://titi.gougouzian.fr",tourismCategory:["Sports","Cultural","Hotel","Food","Camping","Event","Tour"],pois:{},$addressesWrapper:document.getElementById("addresses-wrapper"),$augmentConfiguration:document.getElementById("augmentConfiguration"),$augmentWelcome:document.getElementById("augmentWelcome"),$calculate:document.getElementById("calculate"),$configuration:document.getElementById("configuration"),$log:document.getElementById("log"),$logContent:document.getElementById("log-content"),$newsearch:document.getElementById("newsearch"),$reduceConfiguration:document.getElementById("reduceConfiguration"),$reduceWelcome:document.getElementById("reduceWelcome"),$pois:document.getElementById("pois"),$rappel:document.getElementById("rappel"),$spinner:document.getElementById("spinner"),$toggleCalcMode:document.getElementById("toggleCalcMode"),$toggleLogMode:document.getElementById("toggleLogMode"),$welcome:document.getElementById("welcome"),$popin:document.getElementById("popin")};window.$barry.calcAddress=(r,t,e)=>{if(r.key==="Enter"){if(e!=="")window.$barry.canPlace(`place_${t}`),window.$barry.placePoint(e,`place_${t}`),window.$barry.newAddress(`address_${window.$barry.addressesCount-1}`),document.querySelector(`#address_${window.$barry.addressesCount-1} input`).focus();else if(Object.keys(window.$barry.places).length>0){window.$barry.removeAddress(`address_${t}`);const i=document.querySelectorAll(".address");i[i.length-1].querySelector(".plus").classList.remove("hide"),i[i.length-1].querySelector(".minus").classList.add("hide")}}};window.$barry.calcBox=()=>{const r=Object.keys(window.$barry.places);let t=99,e=-99,i=99,n=-99;for(let s=0;s<r.length;s++)if(r[s].startsWith("place")){const o=Number.parseFloat(window.$barry.places[r[s]][0]),a=Number.parseFloat(window.$barry.places[r[s]][1]);t>o&&(t=o),e<o&&(e=o),i>a&&(i=a),n<a&&(n=a)}return[[i,t],[n,e]]};const Ht={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},Va={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection"};class Io extends Error{constructor(t){const e=Va[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}function wt(r,t){if(!r)throw new Io(t)}function Ar(r){const t=ge();for(let e=0,i=r.length;e<i;++e)Ki(t,r[e]);return t}function Wa(r,t,e){const i=Math.min.apply(null,r),n=Math.min.apply(null,t),s=Math.max.apply(null,r),o=Math.max.apply(null,t);return Re(i,n,s,o,e)}function Jr(r,t,e){return e?(e[0]=r[0]-t,e[1]=r[1]-t,e[2]=r[2]+t,e[3]=r[3]+t,e):[r[0]-t,r[1]-t,r[2]+t,r[3]+t]}function Ao(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r.slice()}function yi(r,t,e){let i,n;return t<r[0]?i=r[0]-t:r[2]<t?i=t-r[2]:i=0,e<r[1]?n=r[1]-e:r[3]<e?n=e-r[3]:n=0,i*i+n*n}function Jn(r,t){return Qr(r,t[0],t[1])}function Mi(r,t){return r[0]<=t[0]&&t[2]<=r[2]&&r[1]<=t[1]&&t[3]<=r[3]}function Qr(r,t,e){return r[0]<=t&&t<=r[2]&&r[1]<=e&&e<=r[3]}function Or(r,t){const e=r[0],i=r[1],n=r[2],s=r[3],o=t[0],a=t[1];let l=Ht.UNKNOWN;return o<e?l=l|Ht.LEFT:o>n&&(l=l|Ht.RIGHT),a<i?l=l|Ht.BELOW:a>s&&(l=l|Ht.ABOVE),l===Ht.UNKNOWN&&(l=Ht.INTERSECTING),l}function ge(){return[1/0,1/0,-1/0,-1/0]}function Re(r,t,e,i,n){return n?(n[0]=r,n[1]=t,n[2]=e,n[3]=i,n):[r,t,e,i]}function gn(r){return Re(1/0,1/0,-1/0,-1/0,r)}function Ba(r,t){const e=r[0],i=r[1];return Re(e,i,e,i,t)}function Oo(r,t,e,i,n){const s=gn(n);return Mo(s,r,t,e,i)}function Qi(r,t){return r[0]==t[0]&&r[2]==t[2]&&r[1]==t[1]&&r[3]==t[3]}function Lo(r,t){return t[0]<r[0]&&(r[0]=t[0]),t[2]>r[2]&&(r[2]=t[2]),t[1]<r[1]&&(r[1]=t[1]),t[3]>r[3]&&(r[3]=t[3]),r}function Ki(r,t){t[0]<r[0]&&(r[0]=t[0]),t[0]>r[2]&&(r[2]=t[0]),t[1]<r[1]&&(r[1]=t[1]),t[1]>r[3]&&(r[3]=t[1])}function Mo(r,t,e,i,n){for(;e<i;e+=n)$a(r,t[e],t[e+1]);return r}function $a(r,t,e){r[0]=Math.min(r[0],t),r[1]=Math.min(r[1],e),r[2]=Math.max(r[2],t),r[3]=Math.max(r[3],e)}function Po(r,t){let e;return e=t(Qn(r)),e||(e=t(tr(r)),e)||(e=t(er(r)),e)||(e=t(wi(r)),e)?e:!1}function Lr(r){let t=0;return ts(r)||(t=Pt(r)*Se(r)),t}function Qn(r){return[r[0],r[1]]}function tr(r){return[r[2],r[1]]}function gi(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function Ha(r,t){let e;return t==="bottom-left"?e=Qn(r):t==="bottom-right"?e=tr(r):t==="top-left"?e=wi(r):t==="top-right"?e=er(r):wt(!1,13),e}function Mr(r,t,e,i,n){const[s,o,a,l,h,u,g,p]=Pr(r,t,e,i);return Re(Math.min(s,a,h,g),Math.min(o,l,u,p),Math.max(s,a,h,g),Math.max(o,l,u,p),n)}function Pr(r,t,e,i){const n=t*i[0]/2,s=t*i[1]/2,o=Math.cos(e),a=Math.sin(e),l=n*o,h=n*a,u=s*o,g=s*a,p=r[0],_=r[1];return[p-l+g,_-h-u,p-l-g,_-h+u,p+l-g,_+h+u,p+l+g,_+h-u,p-l+g,_-h-u]}function Se(r){return r[3]-r[1]}function Zi(r,t,e){const i=e||ge();return ie(r,t)?(r[0]>t[0]?i[0]=r[0]:i[0]=t[0],r[1]>t[1]?i[1]=r[1]:i[1]=t[1],r[2]<t[2]?i[2]=r[2]:i[2]=t[2],r[3]<t[3]?i[3]=r[3]:i[3]=t[3]):gn(i),i}function wi(r){return[r[0],r[3]]}function er(r){return[r[2],r[3]]}function Pt(r){return r[2]-r[0]}function ie(r,t){return r[0]<=t[2]&&r[2]>=t[0]&&r[1]<=t[3]&&r[3]>=t[1]}function ts(r){return r[2]<r[0]||r[3]<r[1]}function Ka(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r}function Za(r,t,e){let i=!1;const n=Or(r,t),s=Or(r,e);if(n===Ht.INTERSECTING||s===Ht.INTERSECTING)i=!0;else{const o=r[0],a=r[1],l=r[2],h=r[3],u=t[0],g=t[1],p=e[0],_=e[1],w=(_-g)/(p-u);let R,S;s&Ht.ABOVE&&!(n&Ht.ABOVE)&&(R=p-(_-h)/w,i=R>=o&&R<=l),!i&&s&Ht.RIGHT&&!(n&Ht.RIGHT)&&(S=_-(p-l)*w,i=S>=a&&S<=h),!i&&s&Ht.BELOW&&!(n&Ht.BELOW)&&(R=p-(_-a)/w,i=R>=o&&R<=l),!i&&s&Ht.LEFT&&!(n&Ht.LEFT)&&(S=_-(p-o)*w,i=S>=a&&S<=h)}return i}function Ja(r,t,e,i){let n=[];n=[r[0],r[1],r[2],r[1],r[2],r[3],r[0],r[3]],t(n,n,2);const s=[],o=[];for(let a=0,l=n.length;a<l;a+=2)s.push(n[a]),o.push(n[a+1]);return Wa(s,o,e)}function No(r,t){const e=t.getExtent(),i=gi(r);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const n=Pt(e),o=Math.floor((i[0]-e[0])/n)*n;r[0]-=o,r[2]-=o}return r}function Qa(r,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(r[0])||!isFinite(r[2]))return[[e[0],r[1],e[2],r[3]]];No(r,t);const i=Pt(e);if(Pt(r)>i)return[[e[0],r[1],e[2],r[3]]];if(r[0]<e[0])return[[r[0]+i,r[1],e[2],r[3]],[e[0],r[1],r[2],r[3]]];if(r[2]>e[2])return[[r[0],r[1],e[2],r[3]],[e[0],r[1],r[2]-i,r[3]]]}return[r]}const ir=r=>{let t=r;typeof r>"u"&&(t=window.$barry.calcBox());const e=Ar([[t[0][1],t[0][0]],[t[1][1],t[1][0]]]);window.$barry.map.getView().fit(e,{size:window.$barry.map.getSize(),padding:[50,50,50,50],duration:2e3})};var Nr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Do={exports:{}},Cn={exports:{}},Ds;function tl(){return Ds||(Ds=1,function(r,t){var e=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof Nr<"u")return Nr;throw new Error("unable to locate global object")},i=e();r.exports=t=i.fetch,i.fetch&&(t.default=i.fetch.bind(i)),t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response}(Cn,Cn.exports)),Cn.exports}/*!
 * @brief Geoportal resources access library
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * copyright CeCILL-B
 * copyright IGN
 * @author IGN
 * @version 3.4.3
 * @date 21/08/2024
 *
 */(function(r,t){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4
 */(function(e,i){r.exports=i(tl())})(Nr,function(e){return function(i){var n={};function s(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return i[o].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=i,s.c=n,s.d=function(o,a,l){s.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:l})},s.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s.t=function(o,a){if(1&a&&(o=s(o)),8&a||4&a&&typeof o=="object"&&o&&o.__esModule)return o;var l=Object.create(null);if(s.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:o}),2&a&&typeof o!="string")for(var h in o)s.d(l,h,(function(u){return o[u]}).bind(null,h));return l},s.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return s.d(a,"a",a),a},s.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},s.p="",s(s.s=7)}([function(i){i.exports=JSON.parse(`{"name":"geoportal-access-lib","version":"3.4.3","date":"21/08/2024","description":"French Geoportal resources access library","module":"src/Gp.js","main":"dist/GpServices-src.js","homepage":"https://github.com/IGNF/geoportal-access-lib#readme","scripts":{"clean":"echo \\"Warning: no yet implemented!\\" && exit 0","setup":"npm install","cover":"nyc --reporter=lcov --reporter=text npm run test","eslint":"eslint src/","build":"webpack --mode=none","build:prod":"webpack --mode=production","build:dev":"webpack --mode=development","test":"mocha-webpack --reporter mochawesome --reporter-options reportDir=test-report,reportFilename=index --webpack-config ./test/webpack/webpack.test.js --glob \\"test_*.js\\" test/spec/","test:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.js","test:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.docker.js","test:end-to-end:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.js","test:end-to-end:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.docker.js","sample":"npm run sample:serve","sample:serve":"webpack-dev-server --mode=none --open-page samples/index-src.html --https --content-base . --output-public-path '/dist/' --port 9001 --open","sample:serve:prod":"webpack-dev-server --mode=production --open-page samples/index-prod.html --content-base . --output-public-path '/dist/' --port 9001 --open","sample:serve:dev":"webpack-dev-server --mode=development --open-page samples/index-map.html --content-base . --output-public-path '/dist/' --port 9001 --open","doc":"npm run doc:serve","doc:serve":"webpack-dev-server --content-base jsdoc --port 9001 --open"},"engines":{"node":"<=16"},"nyc":{"include":["src/**/*.js"],"instrument":false,"sourceMap":false},"repository":{"type":"git","url":"https://github.com/IGNF/geoportal-access-lib.git"},"keywords":["geoplateforme","geoportail","webservice","javascript","es6"],"author":"IGNF","license":"CECILL-B","dependencies":{"es6-promise":"^4.2.4","node-fetch":"^2.6.1","@xmldom/xmldom":"^0.8.10"},"devDependencies":{"@babel/core":"^7.12.10","@babel/plugin-transform-template-literals":"^7.12.1","@babel/preset-env":"^7.12.11","babel-loader":"^8.2.2","chai":"^4.1.2","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.1.2","eslint":"^7.18.0","eslint-config-standard":"^16.0.2","eslint-loader":"^4.0.2","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^5.0.0","glob":"^7.1.2","handlebars-layouts":"^3.1.4","handlebars-webpack-plugin":"^1.4.1","html-webpack-plugin":"^4.5.1","istanbul-instrumenter-loader":"^3.0.1","jsdoc-webpack-plugin":"^0.3.0","loglevel":"^1.6.1","mocha":"^7.2.0","mocha-loader":"^5.1.5","mocha-webpack":"^2.0.0-beta.0","mochawesome":"^6.2.1","nyc":"^15.1.0","path":"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0","sinon":"^9.2.4","sinon-es6":"0.0.3","speed-measure-webpack-plugin":"^1.4.2","string-template":"^1.0.0","terser-webpack-plugin":"^2.3.8","webpack":"^4.46.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^2.5.2","webpack-shell-plugin":"^0.5.0"},"bundledDependencies":[],"peerDependencies":{},"optionalDependencies":{}}`)},function(i,n,s){function o(h,u){return u===void 0&&(u=Object),u&&typeof u.freeze=="function"?u.freeze(h):h}var a=o({HTML:"text/html",isHTML:function(h){return h===a.HTML},XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),l=o({HTML:"http://www.w3.org/1999/xhtml",isHTML:function(h){return h===l.HTML},SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});n.assign=function(h,u){if(h===null||typeof h!="object")throw new TypeError("target is not an object");for(var g in u)Object.prototype.hasOwnProperty.call(u,g)&&(h[g]=u[g]);return h},n.find=function(h,u,g){if(g===void 0&&(g=Array.prototype),h&&typeof g.find=="function")return g.find.call(h,u);for(var p=0;p<h.length;p++)if(Object.prototype.hasOwnProperty.call(h,p)){var _=h[p];if(u.call(void 0,_,p,h))return _}},n.freeze=o,n.MIME_TYPE=a,n.NAMESPACE=l},function(i,n,s){var o,a;(function(l,h){(a=typeof(o=function(){var u=function(){},g=typeof window<"u"&&window.navigator!==void 0&&/Trident\/|MSIE /.test(window.navigator.userAgent),p=["trace","debug","info","warn","error"],_={},w=null;function R(A,k){var F=A[k];if(typeof F.bind=="function")return F.bind(A);try{return Function.prototype.bind.call(F,A)}catch{return function(){return Function.prototype.apply.apply(F,[A,arguments])}}}function S(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function T(A){return A==="debug"&&(A="log"),typeof console<"u"&&(A==="trace"&&g?S:console[A]!==void 0?R(console,A):console.log!==void 0?R(console,"log"):u)}function v(){for(var A=this.getLevel(),k=0;k<p.length;k++){var F=p[k];this[F]=k<A?u:this.methodFactory(F,A,this.name)}if(this.log=this.debug,typeof console>"u"&&A<this.levels.SILENT)return"No console available for logging"}function O(A){return function(){typeof console<"u"&&(v.call(this),this[A].apply(this,arguments))}}function M(A,k,F){return T(A)||O.apply(this,arguments)}function E(A,k){var F,V,Y,N=this,q="loglevel";function B(){var U;if(typeof window<"u"&&q){try{U=window.localStorage[q]}catch{}if(U===void 0)try{var W=window.document.cookie,st=encodeURIComponent(q),K=W.indexOf(st+"=");K!==-1&&(U=/^([^;]+)/.exec(W.slice(K+st.length+1))[1])}catch{}return N.levels[U]===void 0&&(U=void 0),U}}function H(U){var W=U;if(typeof W=="string"&&N.levels[W.toUpperCase()]!==void 0&&(W=N.levels[W.toUpperCase()]),typeof W=="number"&&W>=0&&W<=N.levels.SILENT)return W;throw new TypeError("log.setLevel() called with invalid level: "+U)}typeof A=="string"?q+=":"+A:typeof A=="symbol"&&(q=void 0),N.name=A,N.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},N.methodFactory=k||M,N.getLevel=function(){return Y??V??F},N.setLevel=function(U,W){return Y=H(U),W!==!1&&function(st){var K=(p[st]||"silent").toUpperCase();if(typeof window<"u"&&q){try{return void(window.localStorage[q]=K)}catch{}try{window.document.cookie=encodeURIComponent(q)+"="+K+";"}catch{}}}(Y),v.call(N)},N.setDefaultLevel=function(U){V=H(U),B()||N.setLevel(U,!1)},N.resetLevel=function(){Y=null,function(){if(typeof window<"u"&&q){try{window.localStorage.removeItem(q)}catch{}try{window.document.cookie=encodeURIComponent(q)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}(),v.call(N)},N.enableAll=function(U){N.setLevel(N.levels.TRACE,U)},N.disableAll=function(U){N.setLevel(N.levels.SILENT,U)},N.rebuild=function(){if(w!==N&&(F=H(w.getLevel())),v.call(N),w===N)for(var U in _)_[U].rebuild()},F=H(w?w.getLevel():"WARN");var G=B();G!=null&&(Y=H(G)),v.call(N)}(w=new E).getLogger=function(A){if(typeof A!="symbol"&&typeof A!="string"||A==="")throw new TypeError("You must supply a name when creating a logger.");var k=_[A];return k||(k=_[A]=new E(A,w.methodFactory)),k};var I=typeof window<"u"?window.log:void 0;return w.noConflict=function(){return typeof window<"u"&&window.log===w&&(window.log=I),w},w.getLoggers=function(){return _},w.default=w,w})=="function"?o.call(n,s,n,i):o)===void 0||(i.exports=a)})()},function(i,n){i.exports=e},function(i,n,s){var o=s(5);n.DOMImplementation=o.DOMImplementation,n.XMLSerializer=o.XMLSerializer,n.DOMParser=s(10).DOMParser},function(i,n,s){var o=s(1),a=o.find,l=o.NAMESPACE;function h(m){return m!==""}function u(m,y){return m.hasOwnProperty(y)||(m[y]=!0),m}function g(m){if(!m)return[];var y=function(b){return b?b.split(/[\t\n\f\r ]+/).filter(h):[]}(m);return Object.keys(y.reduce(u,{}))}function p(m,y){for(var b in m)Object.prototype.hasOwnProperty.call(m,b)&&(y[b]=m[b])}function _(m,y){var b=m.prototype;if(!(b instanceof y)){let $=function(){};var L=$;$.prototype=y.prototype,p(b,$=new $),m.prototype=b=$}b.constructor!=m&&(typeof m!="function"&&console.error("unknown Class:"+m),b.constructor=m)}var w={},R=w.ELEMENT_NODE=1,S=w.ATTRIBUTE_NODE=2,T=w.TEXT_NODE=3,v=w.CDATA_SECTION_NODE=4,O=w.ENTITY_REFERENCE_NODE=5,M=w.ENTITY_NODE=6,E=w.PROCESSING_INSTRUCTION_NODE=7,I=w.COMMENT_NODE=8,A=w.DOCUMENT_NODE=9,k=w.DOCUMENT_TYPE_NODE=10,F=w.DOCUMENT_FRAGMENT_NODE=11,V=w.NOTATION_NODE=12,Y={},N={},q=(Y.INDEX_SIZE_ERR=(N[1]="Index size error",1),Y.DOMSTRING_SIZE_ERR=(N[2]="DOMString size error",2),Y.HIERARCHY_REQUEST_ERR=(N[3]="Hierarchy request error",3)),B=(Y.WRONG_DOCUMENT_ERR=(N[4]="Wrong document",4),Y.INVALID_CHARACTER_ERR=(N[5]="Invalid character",5),Y.NO_DATA_ALLOWED_ERR=(N[6]="No data allowed",6),Y.NO_MODIFICATION_ALLOWED_ERR=(N[7]="No modification allowed",7),Y.NOT_FOUND_ERR=(N[8]="Not found",8)),H=(Y.NOT_SUPPORTED_ERR=(N[9]="Not supported",9),Y.INUSE_ATTRIBUTE_ERR=(N[10]="Attribute in use",10));Y.INVALID_STATE_ERR=(N[11]="Invalid state",11),Y.SYNTAX_ERR=(N[12]="Syntax error",12),Y.INVALID_MODIFICATION_ERR=(N[13]="Invalid modification",13),Y.NAMESPACE_ERR=(N[14]="Invalid namespace",14),Y.INVALID_ACCESS_ERR=(N[15]="Invalid access",15);function G(m,y){if(y instanceof Error)var b=y;else b=this,Error.call(this,N[m]),this.message=N[m],Error.captureStackTrace&&Error.captureStackTrace(this,G);return b.code=m,y&&(this.message=this.message+": "+y),b}function U(){}function W(m,y){this._node=m,this._refresh=y,st(this)}function st(m){var y=m._node._inc||m._node.ownerDocument._inc;if(m._inc!==y){var b=m._refresh(m._node);if(Ue(m,"length",b.length),!m.$$length||b.length<m.$$length)for(var L=b.length;L in m;L++)Object.prototype.hasOwnProperty.call(m,L)&&delete m[L];p(b,m),m._inc=y}}function K(){}function gt(m,y){for(var b=m.length;b--;)if(m[b]===y)return b}function X(m,y,b,L){if(L?y[gt(y,L)]=b:y[y.length++]=b,m){b.ownerElement=m;var $=m.ownerDocument;$&&(L&&z($,m,L),function(et,at,ht){et&&et._inc++,ht.namespaceURI===l.XMLNS&&(at._nsMap[ht.prefix?ht.localName:""]=ht.value)}($,m,b))}}function mt(m,y,b){var L=gt(y,b);if(!(L>=0))throw new G(B,new Error(m.tagName+"@"+b));for(var $=y.length-1;L<$;)y[L]=y[++L];if(y.length=$,m){var et=m.ownerDocument;et&&(z(et,m,b),b.ownerElement=null)}}function nt(){}function tt(){}function jt(m){return(m=="<"?"&lt;":m==">"&&"&gt;")||m=="&"&&"&amp;"||m=='"'&&"&quot;"||"&#"+m.charCodeAt()+";"}function ut(m,y){if(y(m))return!0;if(m=m.firstChild)do if(ut(m,y))return!0;while(m=m.nextSibling)}function D(){this.ownerDocument=this}function z(m,y,b,L){m&&m._inc++,b.namespaceURI===l.XMLNS&&delete y._nsMap[b.prefix?b.localName:""]}function Z(m,y,b){if(m&&m._inc){m._inc++;var L=y.childNodes;if(b)L[L.length++]=b;else{for(var $=y.firstChild,et=0;$;)L[et++]=$,$=$.nextSibling;L.length=et,delete L[L.length]}}}function rt(m,y){var b=y.previousSibling,L=y.nextSibling;return b?b.nextSibling=L:m.firstChild=L,L?L.previousSibling=b:m.lastChild=b,y.parentNode=null,y.previousSibling=null,y.nextSibling=null,Z(m.ownerDocument,m),y}function J(m){return m&&m.nodeType===tt.DOCUMENT_TYPE_NODE}function Q(m){return m&&m.nodeType===tt.ELEMENT_NODE}function yt(m){return m&&m.nodeType===tt.TEXT_NODE}function bt(m,y){var b=m.childNodes||[];if(a(b,Q)||J(y))return!1;var L=a(b,J);return!(y&&L&&b.indexOf(L)>b.indexOf(y))}function It(m,y){var b=m.childNodes||[];if(a(b,function($){return Q($)&&$!==y}))return!1;var L=a(b,J);return!(y&&L&&b.indexOf(L)>b.indexOf(y))}function At(m,y,b){if(!function(L){return L&&(L.nodeType===tt.DOCUMENT_NODE||L.nodeType===tt.DOCUMENT_FRAGMENT_NODE||L.nodeType===tt.ELEMENT_NODE)}(m))throw new G(q,"Unexpected parent node type "+m.nodeType);if(b&&b.parentNode!==m)throw new G(B,"child not in parent");if(!function(L){return L&&(Q(L)||yt(L)||J(L)||L.nodeType===tt.DOCUMENT_FRAGMENT_NODE||L.nodeType===tt.COMMENT_NODE||L.nodeType===tt.PROCESSING_INSTRUCTION_NODE)}(y)||J(y)&&m.nodeType!==tt.DOCUMENT_NODE)throw new G(q,"Unexpected node type "+y.nodeType+" for parent node type "+m.nodeType)}function re(m,y,b){var L=m.childNodes||[],$=y.childNodes||[];if(y.nodeType===tt.DOCUMENT_FRAGMENT_NODE){var et=$.filter(Q);if(et.length>1||a($,yt))throw new G(q,"More than one element or text in fragment");if(et.length===1&&!bt(m,b))throw new G(q,"Element in fragment can not be inserted before doctype")}if(Q(y)&&!bt(m,b))throw new G(q,"Only one element can be added and only after doctype");if(J(y)){if(a(L,J))throw new G(q,"Only one doctype is allowed");var at=a(L,Q);if(b&&L.indexOf(at)<L.indexOf(b))throw new G(q,"Doctype can only be inserted before an element");if(!b&&at)throw new G(q,"Doctype can not be appended since element is present")}}function _t(m,y,b){var L=m.childNodes||[],$=y.childNodes||[];if(y.nodeType===tt.DOCUMENT_FRAGMENT_NODE){var et=$.filter(Q);if(et.length>1||a($,yt))throw new G(q,"More than one element or text in fragment");if(et.length===1&&!It(m,b))throw new G(q,"Element in fragment can not be inserted before doctype")}if(Q(y)&&!It(m,b))throw new G(q,"Only one element can be added and only after doctype");if(J(y)){if(a(L,function(ht){return J(ht)&&ht!==b}))throw new G(q,"Only one doctype is allowed");var at=a(L,Q);if(b&&L.indexOf(at)<L.indexOf(b))throw new G(q,"Doctype can only be inserted before an element")}}function Lt(m,y,b,L){At(m,y,b),m.nodeType===tt.DOCUMENT_NODE&&(L||re)(m,y,b);var $=y.parentNode;if($&&$.removeChild(y),y.nodeType===F){var et=y.firstChild;if(et==null)return y;var at=y.lastChild}else et=at=y;var ht=b?b.previousSibling:m.lastChild;et.previousSibling=ht,at.nextSibling=b,ht?ht.nextSibling=et:m.firstChild=et,b==null?m.lastChild=at:b.previousSibling=at;do et.parentNode=m;while(et!==at&&(et=et.nextSibling));return Z(m.ownerDocument||m,m),y.nodeType==F&&(y.firstChild=y.lastChild=null),y}function Gt(){this._nsMap={}}function kt(){}function Ct(){}function Zt(){}function Yt(){}function he(){}function Jt(){}function se(){}function ue(){}function oe(){}function Ut(){}function de(){}function xi(){}function Te(m,y){var b=[],L=this.nodeType==9&&this.documentElement||this,$=L.prefix,et=L.namespaceURI;if(et&&$==null&&($=L.lookupPrefix(et))==null)var at=[{namespace:et,prefix:null}];return ae(this,b,m,y,at),b.join("")}function Fe(m,y,b){var L=m.prefix||"",$=m.namespaceURI;if(!$||L==="xml"&&$===l.XML||$===l.XMLNS)return!1;for(var et=b.length;et--;){var at=b[et];if(at.prefix===L)return at.namespace!==$}return!0}function Ge(m,y,b){m.push(" ",y,'="',b.replace(/[<>&"\t\n\r]/g,jt),'"')}function ae(m,y,b,L,$){if($||($=[]),L){if(!(m=L(m)))return;if(typeof m=="string")return void y.push(m)}switch(m.nodeType){case R:var et=m.attributes,at=et.length,ht=m.firstChild,Tt=m.tagName,Vt=Tt;if(!(b=l.isHTML(m.namespaceURI)||b)&&!m.prefix&&m.namespaceURI){for(var Rt,ee=0;ee<et.length;ee++)if(et.item(ee).name==="xmlns"){Rt=et.item(ee).value;break}if(!Rt){for(var Dt=$.length-1;Dt>=0;Dt--)if((Ft=$[Dt]).prefix===""&&Ft.namespace===m.namespaceURI){Rt=Ft.namespace;break}}if(Rt!==m.namespaceURI)for(Dt=$.length-1;Dt>=0;Dt--){var Ft;if((Ft=$[Dt]).namespace===m.namespaceURI){Ft.prefix&&(Vt=Ft.prefix+":"+Tt);break}}}y.push("<",Vt);for(var Mt=0;Mt<at;Mt++)(Xt=et.item(Mt)).prefix=="xmlns"?$.push({prefix:Xt.localName,namespace:Xt.value}):Xt.nodeName=="xmlns"&&$.push({prefix:"",namespace:Xt.value});for(Mt=0;Mt<at;Mt++){var Xt,we,Ie;Fe(Xt=et.item(Mt),0,$)&&(Ge(y,(we=Xt.prefix||"")?"xmlns:"+we:"xmlns",Ie=Xt.namespaceURI),$.push({prefix:we,namespace:Ie})),ae(Xt,y,b,L,$)}if(Tt===Vt&&Fe(m,0,$)&&(Ge(y,(we=m.prefix||"")?"xmlns:"+we:"xmlns",Ie=m.namespaceURI),$.push({prefix:we,namespace:Ie})),ht||b&&!/^(?:meta|link|img|br|hr|input)$/i.test(Tt)){if(y.push(">"),b&&/^script$/i.test(Tt))for(;ht;)ht.data?y.push(ht.data):ae(ht,y,b,L,$.slice()),ht=ht.nextSibling;else for(;ht;)ae(ht,y,b,L,$.slice()),ht=ht.nextSibling;y.push("</",Vt,">")}else y.push("/>");return;case A:case F:for(ht=m.firstChild;ht;)ae(ht,y,b,L,$.slice()),ht=ht.nextSibling;return;case S:return Ge(y,m.name,m.value);case T:return y.push(m.data.replace(/[<&>]/g,jt));case v:return y.push("<![CDATA[",m.data,"]]>");case I:return y.push("<!--",m.data,"-->");case k:var Yi=m.publicId,me=m.systemId;if(y.push("<!DOCTYPE ",m.name),Yi)y.push(" PUBLIC ",Yi),me&&me!="."&&y.push(" ",me),y.push(">");else if(me&&me!=".")y.push(" SYSTEM ",me,">");else{var Vi=m.internalSubset;Vi&&y.push(" [",Vi,"]"),y.push(">")}return;case E:return y.push("<?",m.target," ",m.data,"?>");case O:return y.push("&",m.nodeName,";");default:y.push("??",m.nodeName)}}function Ue(m,y,b){m[y]=b}G.prototype=Error.prototype,p(Y,G),U.prototype={length:0,item:function(m){return m>=0&&m<this.length?this[m]:null},toString:function(m,y){for(var b=[],L=0;L<this.length;L++)ae(this[L],b,m,y);return b.join("")},filter:function(m){return Array.prototype.filter.call(this,m)},indexOf:function(m){return Array.prototype.indexOf.call(this,m)}},W.prototype.item=function(m){return st(this),this[m]||null},_(W,U),K.prototype={length:0,item:U.prototype.item,getNamedItem:function(m){for(var y=this.length;y--;){var b=this[y];if(b.nodeName==m)return b}},setNamedItem:function(m){var y=m.ownerElement;if(y&&y!=this._ownerElement)throw new G(H);var b=this.getNamedItem(m.nodeName);return X(this._ownerElement,this,m,b),b},setNamedItemNS:function(m){var y,b=m.ownerElement;if(b&&b!=this._ownerElement)throw new G(H);return y=this.getNamedItemNS(m.namespaceURI,m.localName),X(this._ownerElement,this,m,y),y},removeNamedItem:function(m){var y=this.getNamedItem(m);return mt(this._ownerElement,this,y),y},removeNamedItemNS:function(m,y){var b=this.getNamedItemNS(m,y);return mt(this._ownerElement,this,b),b},getNamedItemNS:function(m,y){for(var b=this.length;b--;){var L=this[b];if(L.localName==y&&L.namespaceURI==m)return L}return null}},nt.prototype={hasFeature:function(m,y){return!0},createDocument:function(m,y,b){var L=new D;if(L.implementation=this,L.childNodes=new U,L.doctype=b||null,b&&L.appendChild(b),y){var $=L.createElementNS(m,y);L.appendChild($)}return L},createDocumentType:function(m,y,b){var L=new Jt;return L.name=m,L.nodeName=m,L.publicId=y||"",L.systemId=b||"",L}},tt.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(m,y){return Lt(this,m,y)},replaceChild:function(m,y){Lt(this,m,y,_t),y&&this.removeChild(y)},removeChild:function(m){return rt(this,m)},appendChild:function(m){return this.insertBefore(m,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(m){return function y(b,L,$){var et=new L.constructor;for(var at in L)if(Object.prototype.hasOwnProperty.call(L,at)){var ht=L[at];typeof ht!="object"&&ht!=et[at]&&(et[at]=ht)}switch(L.childNodes&&(et.childNodes=new U),et.ownerDocument=b,et.nodeType){case R:var Tt=L.attributes,Vt=et.attributes=new K,Rt=Tt.length;Vt._ownerElement=et;for(var ee=0;ee<Rt;ee++)et.setAttributeNode(y(b,Tt.item(ee),!0));break;case S:$=!0}if($)for(var Dt=L.firstChild;Dt;)et.appendChild(y(b,Dt,$)),Dt=Dt.nextSibling;return et}(this.ownerDocument||this,this,m)},normalize:function(){for(var m=this.firstChild;m;){var y=m.nextSibling;y&&y.nodeType==T&&m.nodeType==T?(this.removeChild(y),m.appendData(y.data)):(m.normalize(),m=y)}},isSupported:function(m,y){return this.ownerDocument.implementation.hasFeature(m,y)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(m){for(var y=this;y;){var b=y._nsMap;if(b){for(var L in b)if(Object.prototype.hasOwnProperty.call(b,L)&&b[L]===m)return L}y=y.nodeType==S?y.ownerDocument:y.parentNode}return null},lookupNamespaceURI:function(m){for(var y=this;y;){var b=y._nsMap;if(b&&Object.prototype.hasOwnProperty.call(b,m))return b[m];y=y.nodeType==S?y.ownerDocument:y.parentNode}return null},isDefaultNamespace:function(m){return this.lookupPrefix(m)==null}},p(w,tt),p(w,tt.prototype),D.prototype={nodeName:"#document",nodeType:A,doctype:null,documentElement:null,_inc:1,insertBefore:function(m,y){if(m.nodeType==F){for(var b=m.firstChild;b;){var L=b.nextSibling;this.insertBefore(b,y),b=L}return m}return Lt(this,m,y),m.ownerDocument=this,this.documentElement===null&&m.nodeType===R&&(this.documentElement=m),m},removeChild:function(m){return this.documentElement==m&&(this.documentElement=null),rt(this,m)},replaceChild:function(m,y){Lt(this,m,y,_t),m.ownerDocument=this,y&&this.removeChild(y),Q(m)&&(this.documentElement=m)},importNode:function(m,y){return function b(L,$,et){var at;switch($.nodeType){case R:(at=$.cloneNode(!1)).ownerDocument=L;case F:break;case S:et=!0}if(at||(at=$.cloneNode(!1)),at.ownerDocument=L,at.parentNode=null,et)for(var ht=$.firstChild;ht;)at.appendChild(b(L,ht,et)),ht=ht.nextSibling;return at}(this,m,y)},getElementById:function(m){var y=null;return ut(this.documentElement,function(b){if(b.nodeType==R&&b.getAttribute("id")==m)return y=b,!0}),y},getElementsByClassName:function(m){var y=g(m);return new W(this,function(b){var L=[];return y.length>0&&ut(b.documentElement,function($){if($!==b&&$.nodeType===R){var et=$.getAttribute("class");if(et){var at=m===et;if(!at){var ht=g(et);at=y.every((Tt=ht,function(Vt){return Tt&&Tt.indexOf(Vt)!==-1}))}at&&L.push($)}}var Tt}),L})},createElement:function(m){var y=new Gt;return y.ownerDocument=this,y.nodeName=m,y.tagName=m,y.localName=m,y.childNodes=new U,(y.attributes=new K)._ownerElement=y,y},createDocumentFragment:function(){var m=new Ut;return m.ownerDocument=this,m.childNodes=new U,m},createTextNode:function(m){var y=new Zt;return y.ownerDocument=this,y.appendData(m),y},createComment:function(m){var y=new Yt;return y.ownerDocument=this,y.appendData(m),y},createCDATASection:function(m){var y=new he;return y.ownerDocument=this,y.appendData(m),y},createProcessingInstruction:function(m,y){var b=new de;return b.ownerDocument=this,b.tagName=b.nodeName=b.target=m,b.nodeValue=b.data=y,b},createAttribute:function(m){var y=new kt;return y.ownerDocument=this,y.name=m,y.nodeName=m,y.localName=m,y.specified=!0,y},createEntityReference:function(m){var y=new oe;return y.ownerDocument=this,y.nodeName=m,y},createElementNS:function(m,y){var b=new Gt,L=y.split(":"),$=b.attributes=new K;return b.childNodes=new U,b.ownerDocument=this,b.nodeName=y,b.tagName=y,b.namespaceURI=m,L.length==2?(b.prefix=L[0],b.localName=L[1]):b.localName=y,$._ownerElement=b,b},createAttributeNS:function(m,y){var b=new kt,L=y.split(":");return b.ownerDocument=this,b.nodeName=y,b.name=y,b.namespaceURI=m,b.specified=!0,L.length==2?(b.prefix=L[0],b.localName=L[1]):b.localName=y,b}},_(D,tt),Gt.prototype={nodeType:R,hasAttribute:function(m){return this.getAttributeNode(m)!=null},getAttribute:function(m){var y=this.getAttributeNode(m);return y&&y.value||""},getAttributeNode:function(m){return this.attributes.getNamedItem(m)},setAttribute:function(m,y){var b=this.ownerDocument.createAttribute(m);b.value=b.nodeValue=""+y,this.setAttributeNode(b)},removeAttribute:function(m){var y=this.getAttributeNode(m);y&&this.removeAttributeNode(y)},appendChild:function(m){return m.nodeType===F?this.insertBefore(m,null):function(y,b){return b.parentNode&&b.parentNode.removeChild(b),b.parentNode=y,b.previousSibling=y.lastChild,b.nextSibling=null,b.previousSibling?b.previousSibling.nextSibling=b:y.firstChild=b,y.lastChild=b,Z(y.ownerDocument,y,b),b}(this,m)},setAttributeNode:function(m){return this.attributes.setNamedItem(m)},setAttributeNodeNS:function(m){return this.attributes.setNamedItemNS(m)},removeAttributeNode:function(m){return this.attributes.removeNamedItem(m.nodeName)},removeAttributeNS:function(m,y){var b=this.getAttributeNodeNS(m,y);b&&this.removeAttributeNode(b)},hasAttributeNS:function(m,y){return this.getAttributeNodeNS(m,y)!=null},getAttributeNS:function(m,y){var b=this.getAttributeNodeNS(m,y);return b&&b.value||""},setAttributeNS:function(m,y,b){var L=this.ownerDocument.createAttributeNS(m,y);L.value=L.nodeValue=""+b,this.setAttributeNode(L)},getAttributeNodeNS:function(m,y){return this.attributes.getNamedItemNS(m,y)},getElementsByTagName:function(m){return new W(this,function(y){var b=[];return ut(y,function(L){L===y||L.nodeType!=R||m!=="*"&&L.tagName!=m||b.push(L)}),b})},getElementsByTagNameNS:function(m,y){return new W(this,function(b){var L=[];return ut(b,function($){$===b||$.nodeType!==R||m!=="*"&&$.namespaceURI!==m||y!=="*"&&$.localName!=y||L.push($)}),L})}},D.prototype.getElementsByTagName=Gt.prototype.getElementsByTagName,D.prototype.getElementsByTagNameNS=Gt.prototype.getElementsByTagNameNS,_(Gt,tt),kt.prototype.nodeType=S,_(kt,tt),Ct.prototype={data:"",substringData:function(m,y){return this.data.substring(m,m+y)},appendData:function(m){m=this.data+m,this.nodeValue=this.data=m,this.length=m.length},insertData:function(m,y){this.replaceData(m,0,y)},appendChild:function(m){throw new Error(N[q])},deleteData:function(m,y){this.replaceData(m,y,"")},replaceData:function(m,y,b){b=this.data.substring(0,m)+b+this.data.substring(m+y),this.nodeValue=this.data=b,this.length=b.length}},_(Ct,tt),Zt.prototype={nodeName:"#text",nodeType:T,splitText:function(m){var y=this.data,b=y.substring(m);y=y.substring(0,m),this.data=this.nodeValue=y,this.length=y.length;var L=this.ownerDocument.createTextNode(b);return this.parentNode&&this.parentNode.insertBefore(L,this.nextSibling),L}},_(Zt,Ct),Yt.prototype={nodeName:"#comment",nodeType:I},_(Yt,Ct),he.prototype={nodeName:"#cdata-section",nodeType:v},_(he,Ct),Jt.prototype.nodeType=k,_(Jt,tt),se.prototype.nodeType=V,_(se,tt),ue.prototype.nodeType=M,_(ue,tt),oe.prototype.nodeType=O,_(oe,tt),Ut.prototype.nodeName="#document-fragment",Ut.prototype.nodeType=F,_(Ut,tt),de.prototype.nodeType=E,_(de,tt),xi.prototype.serializeToString=function(m,y,b){return Te.call(m,y,b)},tt.prototype.toString=Te;try{Object.defineProperty&&(Object.defineProperty(W.prototype,"length",{get:function(){return st(this),this.$$length}}),Object.defineProperty(tt.prototype,"textContent",{get:function(){return function m(y){switch(y.nodeType){case R:case F:var b=[];for(y=y.firstChild;y;)y.nodeType!==7&&y.nodeType!==8&&b.push(m(y)),y=y.nextSibling;return b.join("");default:return y.nodeValue}}(this)},set:function(m){switch(this.nodeType){case R:case F:for(;this.firstChild;)this.removeChild(this.firstChild);(m||String(m))&&this.appendChild(this.ownerDocument.createTextNode(m));break;default:this.data=m,this.value=m,this.nodeValue=m}}}),Ue=function(m,y,b){m["$$"+y]=b})}catch{}n.DocumentType=Jt,n.DOMException=G,n.DOMImplementation=nt,n.Element=Gt,n.Node=tt,n.NodeList=U,n.XMLSerializer=xi},function(i,n,s){(function(o,a){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var l;l=function(){function h(D){return typeof D=="function"}var u=Array.isArray?Array.isArray:function(D){return Object.prototype.toString.call(D)==="[object Array]"},g=0,p=void 0,_=void 0,w=function(D,z){E[g]=D,E[g+1]=z,(g+=2)===2&&(_?_(I):Y())},R=typeof window<"u"?window:void 0,S=R||{},T=S.MutationObserver||S.WebKitMutationObserver,v=typeof self>"u"&&o!==void 0&&{}.toString.call(o)==="[object process]",O=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function M(){var D=setTimeout;return function(){return D(I,1)}}var E=new Array(1e3);function I(){for(var D=0;D<g;D+=2)(0,E[D])(E[D+1]),E[D]=void 0,E[D+1]=void 0;g=0}var A,k,F,V,Y=void 0;function N(D,z){var Z=this,rt=new this.constructor(H);rt[B]===void 0&&tt(rt);var J=Z._state;if(J){var Q=arguments[J-1];w(function(){return mt(J,rt,Q,Z._result)})}else gt(Z,rt,D,z);return rt}function q(D){if(D&&typeof D=="object"&&D.constructor===this)return D;var z=new this(H);return U(z,D),z}v?Y=function(){return o.nextTick(I)}:T?(k=0,F=new T(I),V=document.createTextNode(""),F.observe(V,{characterData:!0}),Y=function(){V.data=k=++k%2}):O?((A=new MessageChannel).port1.onmessage=I,Y=function(){return A.port2.postMessage(0)}):Y=R===void 0?function(){try{var D=Function("return this")().require("vertx");return(p=D.runOnLoop||D.runOnContext)!==void 0?function(){p(I)}:M()}catch{return M()}}():M();var B=Math.random().toString(36).substring(2);function H(){}function G(D,z,Z){z.constructor===D.constructor&&Z===N&&z.constructor.resolve===q?function(rt,J){J._state===1?st(rt,J._result):J._state===2?K(rt,J._result):gt(J,void 0,function(Q){return U(rt,Q)},function(Q){return K(rt,Q)})}(D,z):Z===void 0?st(D,z):h(Z)?function(rt,J,Q){w(function(yt){var bt=!1,It=function(At,re,_t,Lt){try{At.call(re,_t,Lt)}catch(Gt){return Gt}}(Q,J,function(At){bt||(bt=!0,J!==At?U(yt,At):st(yt,At))},function(At){bt||(bt=!0,K(yt,At))},yt._label);!bt&&It&&(bt=!0,K(yt,It))},rt)}(D,z,Z):st(D,z)}function U(D,z){if(D===z)K(D,new TypeError("You cannot resolve a promise with itself"));else if(J=typeof(rt=z),rt===null||J!=="object"&&J!=="function")st(D,z);else{var Z=void 0;try{Z=z.then}catch(Q){return void K(D,Q)}G(D,z,Z)}var rt,J}function W(D){D._onerror&&D._onerror(D._result),X(D)}function st(D,z){D._state===void 0&&(D._result=z,D._state=1,D._subscribers.length!==0&&w(X,D))}function K(D,z){D._state===void 0&&(D._state=2,D._result=z,w(W,D))}function gt(D,z,Z,rt){var J=D._subscribers,Q=J.length;D._onerror=null,J[Q]=z,J[Q+1]=Z,J[Q+2]=rt,Q===0&&D._state&&w(X,D)}function X(D){var z=D._subscribers,Z=D._state;if(z.length!==0){for(var rt=void 0,J=void 0,Q=D._result,yt=0;yt<z.length;yt+=3)rt=z[yt],J=z[yt+Z],rt?mt(Z,rt,J,Q):J(Q);D._subscribers.length=0}}function mt(D,z,Z,rt){var J=h(Z),Q=void 0,yt=void 0,bt=!0;if(J){try{Q=Z(rt)}catch(It){bt=!1,yt=It}if(z===Q)return void K(z,new TypeError("A promises callback cannot return that same promise."))}else Q=rt;z._state!==void 0||(J&&bt?U(z,Q):bt===!1?K(z,yt):D===1?st(z,Q):D===2&&K(z,Q))}var nt=0;function tt(D){D[B]=nt++,D._state=void 0,D._result=void 0,D._subscribers=[]}var jt=function(){function D(z,Z){this._instanceConstructor=z,this.promise=new z(H),this.promise[B]||tt(this.promise),u(Z)?(this.length=Z.length,this._remaining=Z.length,this._result=new Array(this.length),this.length===0?st(this.promise,this._result):(this.length=this.length||0,this._enumerate(Z),this._remaining===0&&st(this.promise,this._result))):K(this.promise,new Error("Array Methods must be provided an Array"))}return D.prototype._enumerate=function(z){for(var Z=0;this._state===void 0&&Z<z.length;Z++)this._eachEntry(z[Z],Z)},D.prototype._eachEntry=function(z,Z){var rt=this._instanceConstructor,J=rt.resolve;if(J===q){var Q=void 0,yt=void 0,bt=!1;try{Q=z.then}catch(At){bt=!0,yt=At}if(Q===N&&z._state!==void 0)this._settledAt(z._state,Z,z._result);else if(typeof Q!="function")this._remaining--,this._result[Z]=z;else if(rt===ut){var It=new rt(H);bt?K(It,yt):G(It,z,Q),this._willSettleAt(It,Z)}else this._willSettleAt(new rt(function(At){return At(z)}),Z)}else this._willSettleAt(J(z),Z)},D.prototype._settledAt=function(z,Z,rt){var J=this.promise;J._state===void 0&&(this._remaining--,z===2?K(J,rt):this._result[Z]=rt),this._remaining===0&&st(J,this._result)},D.prototype._willSettleAt=function(z,Z){var rt=this;gt(z,void 0,function(J){return rt._settledAt(1,Z,J)},function(J){return rt._settledAt(2,Z,J)})},D}(),ut=function(){function D(z){this[B]=nt++,this._result=this._state=void 0,this._subscribers=[],H!==z&&(typeof z!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof D?function(Z,rt){try{rt(function(J){U(Z,J)},function(J){K(Z,J)})}catch(J){K(Z,J)}}(this,z):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return D.prototype.catch=function(z){return this.then(null,z)},D.prototype.finally=function(z){var Z=this.constructor;return h(z)?this.then(function(rt){return Z.resolve(z()).then(function(){return rt})},function(rt){return Z.resolve(z()).then(function(){throw rt})}):this.then(z,z)},D}();return ut.prototype.then=N,ut.all=function(D){return new jt(this,D).promise},ut.race=function(D){var z=this;return u(D)?new z(function(Z,rt){for(var J=D.length,Q=0;Q<J;Q++)z.resolve(D[Q]).then(Z,rt)}):new z(function(Z,rt){return rt(new TypeError("You must pass an array to race."))})},ut.resolve=q,ut.reject=function(D){var z=new this(H);return K(z,D),z},ut._setScheduler=function(D){_=D},ut._setAsap=function(D){w=D},ut._asap=w,ut.polyfill=function(){var D=void 0;if(a!==void 0)D=a;else if(typeof self<"u")D=self;else try{D=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var z=D.Promise;if(z){var Z=null;try{Z=Object.prototype.toString.call(z.resolve())}catch{}if(Z==="[object Promise]"&&!z.cast)return}D.Promise=ut},ut.Promise=ut,ut},i.exports=l()}).call(this,s(8),s(9))},function(i,n,s){i.exports=s(13)},function(i,n){var s,o,a=i.exports={};function l(){throw new Error("setTimeout has not been defined")}function h(){throw new Error("clearTimeout has not been defined")}function u(O){if(s===setTimeout)return setTimeout(O,0);if((s===l||!s)&&setTimeout)return s=setTimeout,setTimeout(O,0);try{return s(O,0)}catch{try{return s.call(null,O,0)}catch{return s.call(this,O,0)}}}(function(){try{s=typeof setTimeout=="function"?setTimeout:l}catch{s=l}try{o=typeof clearTimeout=="function"?clearTimeout:h}catch{o=h}})();var g,p=[],_=!1,w=-1;function R(){_&&g&&(_=!1,g.length?p=g.concat(p):w=-1,p.length&&S())}function S(){if(!_){var O=u(R);_=!0;for(var M=p.length;M;){for(g=p,p=[];++w<M;)g&&g[w].run();w=-1,M=p.length}g=null,_=!1,function(E){if(o===clearTimeout)return clearTimeout(E);if((o===h||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(E);try{o(E)}catch{try{return o.call(null,E)}catch{return o.call(this,E)}}}(O)}}function T(O,M){this.fun=O,this.array=M}function v(){}a.nextTick=function(O){var M=new Array(arguments.length-1);if(arguments.length>1)for(var E=1;E<arguments.length;E++)M[E-1]=arguments[E];p.push(new T(O,M)),p.length!==1||_||u(S)},T.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=v,a.addListener=v,a.once=v,a.off=v,a.removeListener=v,a.removeAllListeners=v,a.emit=v,a.prependListener=v,a.prependOnceListener=v,a.listeners=function(O){return[]},a.binding=function(O){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(O){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(i,n){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch{typeof window=="object"&&(s=window)}i.exports=s},function(i,n,s){var o=s(1),a=s(5),l=s(11),h=s(12),u=a.DOMImplementation,g=o.NAMESPACE,p=h.ParseError,_=h.XMLReader;function w(E){return E.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function R(E){this.options=E||{locator:{}}}function S(){this.cdata=!1}function T(E,I){I.lineNumber=E.lineNumber,I.columnNumber=E.columnNumber}function v(E){if(E)return`
@`+(E.systemId||"")+"#[line:"+E.lineNumber+",col:"+E.columnNumber+"]"}function O(E,I,A){return typeof E=="string"?E.substr(I,A):E.length>=I+A||I?new java.lang.String(E,I,A)+"":E}function M(E,I){E.currentElement?E.currentElement.appendChild(I):E.doc.appendChild(I)}R.prototype.parseFromString=function(E,I){var A=this.options,k=new _,F=A.domBuilder||new S,V=A.errorHandler,Y=A.locator,N=A.xmlns||{},q=/\/x?html?$/.test(I),B=q?l.HTML_ENTITIES:l.XML_ENTITIES;Y&&F.setDocumentLocator(Y),k.errorHandler=function(G,U,W){if(!G){if(U instanceof S)return U;G=U}var st={},K=G instanceof Function;function gt(X){var mt=G[X];!mt&&K&&(mt=G.length==2?function(nt){G(X,nt)}:G),st[X]=mt&&function(nt){mt("[xmldom "+X+"]	"+nt+v(W))}||function(){}}return W=W||{},gt("warning"),gt("error"),gt("fatalError"),st}(V,F,Y),k.domBuilder=A.domBuilder||F,q&&(N[""]=g.HTML),N.xml=N.xml||g.XML;var H=A.normalizeLineEndings||w;return E&&typeof E=="string"?k.parse(H(E),N,B):k.errorHandler.error("invalid doc source"),F.doc},S.prototype={startDocument:function(){this.doc=new u().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(E,I,A,k){var F=this.doc,V=F.createElementNS(E,A||I),Y=k.length;M(this,V),this.currentElement=V,this.locator&&T(this.locator,V);for(var N=0;N<Y;N++){E=k.getURI(N);var q=k.getValue(N),B=(A=k.getQName(N),F.createAttributeNS(E,A));this.locator&&T(k.getLocator(N),B),B.value=B.nodeValue=q,V.setAttributeNode(B)}},endElement:function(E,I,A){var k=this.currentElement;k.tagName,this.currentElement=k.parentNode},startPrefixMapping:function(E,I){},endPrefixMapping:function(E){},processingInstruction:function(E,I){var A=this.doc.createProcessingInstruction(E,I);this.locator&&T(this.locator,A),M(this,A)},ignorableWhitespace:function(E,I,A){},characters:function(E,I,A){if(E=O.apply(this,arguments)){if(this.cdata)var k=this.doc.createCDATASection(E);else k=this.doc.createTextNode(E);this.currentElement?this.currentElement.appendChild(k):/^\s*$/.test(E)&&this.doc.appendChild(k),this.locator&&T(this.locator,k)}},skippedEntity:function(E){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(E){(this.locator=E)&&(E.lineNumber=0)},comment:function(E,I,A){E=O.apply(this,arguments);var k=this.doc.createComment(E);this.locator&&T(this.locator,k),M(this,k)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(E,I,A){var k=this.doc.implementation;if(k&&k.createDocumentType){var F=k.createDocumentType(E,I,A);this.locator&&T(this.locator,F),M(this,F),this.doc.doctype=F}},warning:function(E){console.warn("[xmldom warning]	"+E,v(this.locator))},error:function(E){console.error("[xmldom error]	"+E,v(this.locator))},fatalError:function(E){throw new p(E,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(E){S.prototype[E]=function(){return null}}),n.__DOMHandler=S,n.normalizeLineEndings=w,n.DOMParser=R},function(i,n,s){var o=s(1).freeze;n.XML_ENTITIES=o({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),n.HTML_ENTITIES=o({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",AMP:"&",amp:"&",And:"⩓",and:"∧",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",ap:"≈",apacir:"⩯",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",Barwed:"⌆",barwed:"⌅",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",Because:"∵",because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxDL:"╗",boxDl:"╖",boxdL:"╕",boxdl:"┐",boxDR:"╔",boxDr:"╓",boxdR:"╒",boxdr:"┌",boxH:"═",boxh:"─",boxHD:"╦",boxHd:"╤",boxhD:"╥",boxhd:"┬",boxHU:"╩",boxHu:"╧",boxhU:"╨",boxhu:"┴",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxUL:"╝",boxUl:"╜",boxuL:"╛",boxul:"┘",boxUR:"╚",boxUr:"╙",boxuR:"╘",boxur:"└",boxV:"║",boxv:"│",boxVH:"╬",boxVh:"╫",boxvH:"╪",boxvh:"┼",boxVL:"╣",boxVl:"╢",boxvL:"╡",boxvl:"┤",boxVR:"╠",boxVr:"╟",boxvR:"╞",boxvr:"├",bprime:"‵",Breve:"˘",breve:"˘",brvbar:"¦",Bscr:"ℬ",bscr:"𝒷",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",Cap:"⋒",cap:"∩",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",CenterDot:"·",centerdot:"·",Cfr:"ℭ",cfr:"𝔠",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",Colon:"∷",colon:":",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",Conint:"∯",conint:"∮",ContourIntegral:"∮",Copf:"ℂ",copf:"𝕔",coprod:"∐",Coproduct:"∐",COPY:"©",copy:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",Cross:"⨯",cross:"✗",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",Cup:"⋓",cup:"∪",cupbrcap:"⩈",CupCap:"≍",cupcap:"⩆",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",Dagger:"‡",dagger:"†",daleth:"ℸ",Darr:"↡",dArr:"⇓",darr:"↓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",DD:"ⅅ",dd:"ⅆ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",Diamond:"⋄",diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrow:"↓",Downarrow:"⇓",downarrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",ecir:"≖",Ecirc:"Ê",ecirc:"ê",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",eDot:"≑",edot:"ė",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",Escr:"ℰ",escr:"ℯ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",ExponentialE:"ⅇ",exponentiale:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",ForAll:"∀",forall:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",Fscr:"ℱ",fscr:"𝒻",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",gE:"≧",ge:"≥",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",Gg:"⋙",gg:"≫",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gnE:"≩",gne:"⪈",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",Gt:"≫",GT:">",gt:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",hArr:"⇔",harr:"↔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",Hfr:"ℌ",hfr:"𝔥",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",Hopf:"ℍ",hopf:"𝕙",horbar:"―",HorizontalLine:"─",Hscr:"ℋ",hscr:"𝒽",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",Ifr:"ℑ",ifr:"𝔦",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Im:"ℑ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",Int:"∬",int:"∫",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",Iscr:"ℐ",iscr:"𝒾",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",Lang:"⟪",lang:"⟨",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",Larr:"↞",lArr:"⇐",larr:"←",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",lAtail:"⤛",latail:"⤙",late:"⪭",lates:"⪭︀",lBarr:"⤎",lbarr:"⤌",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",lE:"≦",le:"≤",LeftAngleBracket:"⟨",LeftArrow:"←",Leftarrow:"⇐",leftarrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",Ll:"⋘",ll:"≪",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lnE:"≨",lne:"⪇",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftarrow:"⟵",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longleftrightarrow:"⟷",longmapsto:"⟼",LongRightArrow:"⟶",Longrightarrow:"⟹",longrightarrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",Lscr:"ℒ",lscr:"𝓁",Lsh:"↰",lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",Lt:"≪",LT:"<",lt:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",Mscr:"ℳ",mscr:"𝓂",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",ne:"≠",nearhk:"⤤",neArr:"⇗",nearr:"↗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:`
`,nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nhArr:"⇎",nharr:"↮",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlArr:"⇍",nlarr:"↚",nldr:"‥",nlE:"≦̸",nle:"≰",nLeftarrow:"⇍",nleftarrow:"↚",nLeftrightarrow:"⇎",nleftrightarrow:"↮",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",Nopf:"ℕ",nopf:"𝕟",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrArr:"⇏",nrarr:"↛",nrarrc:"⤳̸",nrarrw:"↝̸",nRightarrow:"⇏",nrightarrow:"↛",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nVDash:"⊯",nVdash:"⊮",nvDash:"⊭",nvdash:"⊬",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwArr:"⇖",nwarr:"↖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",ocir:"⊚",Ocirc:"Ô",ocirc:"ô",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",Or:"⩔",or:"∨",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",Otimes:"⨷",otimes:"⊗",otimesas:"⨶",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",Popf:"ℙ",popf:"𝕡",pound:"£",Pr:"⪻",pr:"≺",prap:"⪷",prcue:"≼",prE:"⪳",pre:"⪯",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",Prime:"″",prime:"′",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",Qopf:"ℚ",qopf:"𝕢",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",QUOT:'"',quot:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",Rang:"⟫",rang:"⟩",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",Rarr:"↠",rArr:"⇒",rarr:"→",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",rAtail:"⤜",ratail:"⤚",ratio:"∶",rationals:"ℚ",RBarr:"⤐",rBarr:"⤏",rbarr:"⤍",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",REG:"®",reg:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",Rfr:"ℜ",rfr:"𝔯",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrow:"→",Rightarrow:"⇒",rightarrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",Ropf:"ℝ",ropf:"𝕣",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",Rscr:"ℛ",rscr:"𝓇",Rsh:"↱",rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",Sc:"⪼",sc:"≻",scap:"⪸",Scaron:"Š",scaron:"š",sccue:"≽",scE:"⪴",sce:"⪰",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",seArr:"⇘",searr:"↘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",sol:"/",solb:"⧄",solbar:"⌿",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",Square:"□",square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",Sub:"⋐",sub:"⊂",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",Subset:"⋐",subset:"⊂",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",Sum:"∑",sum:"∑",sung:"♪",Sup:"⋑",sup:"⊃",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",Supset:"⋑",supset:"⊃",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swArr:"⇙",swarr:"↙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"	",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",Therefore:"∴",therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",Tilde:"∼",tilde:"˜",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",TRADE:"™",trade:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",Uarr:"↟",uArr:"⇑",uarr:"↑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrow:"↑",Uparrow:"⇑",uparrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",UpDownArrow:"↕",Updownarrow:"⇕",updownarrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",Upsi:"ϒ",upsi:"υ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",vArr:"⇕",varr:"↕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",Vbar:"⫫",vBar:"⫨",vBarv:"⫩",Vcy:"В",vcy:"в",VDash:"⊫",Vdash:"⊩",vDash:"⊨",vdash:"⊢",Vdashl:"⫦",Vee:"⋁",vee:"∨",veebar:"⊻",veeeq:"≚",vellip:"⋮",Verbar:"‖",verbar:"|",Vert:"‖",vert:"|",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",Wedge:"⋀",wedge:"∧",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xhArr:"⟺",xharr:"⟷",Xi:"Ξ",xi:"ξ",xlArr:"⟸",xlarr:"⟵",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrArr:"⟹",xrarr:"⟶",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",Yuml:"Ÿ",yuml:"ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",Zfr:"ℨ",zfr:"𝔷",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",Zopf:"ℤ",zopf:"𝕫",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}),n.entityMap=n.HTML_ENTITIES},function(i,n,s){var o=s(1).NAMESPACE,a=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,l=new RegExp("[\\-\\.0-9"+a.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),h=new RegExp("^"+a.source+l.source+"*(?::"+a.source+l.source+"*)?$");function u(E,I){this.message=E,this.locator=I,Error.captureStackTrace&&Error.captureStackTrace(this,u)}function g(){}function p(E,I){return I.lineNumber=E.lineNumber,I.columnNumber=E.columnNumber,I}function _(E,I,A,k,F,V){function Y(U,W,st){A.attributeNames.hasOwnProperty(U)&&V.fatalError("Attribute "+U+" redefined"),A.addValue(U,W.replace(/[\t\n\r]/g," ").replace(/&#?\w+;/g,F),st)}for(var N,q=++I,B=0;;){var H=E.charAt(q);switch(H){case"=":if(B===1)N=E.slice(I,q),B=3;else{if(B!==2)throw new Error("attribute equal must after attrName");B=3}break;case"'":case'"':if(B===3||B===1){if(B===1&&(V.warning('attribute value must after "="'),N=E.slice(I,q)),I=q+1,!((q=E.indexOf(H,I))>0))throw new Error("attribute value no end '"+H+"' match");Y(N,G=E.slice(I,q),I-1),B=5}else{if(B!=4)throw new Error('attribute value must after "="');Y(N,G=E.slice(I,q),I),V.warning('attribute "'+N+'" missed start quot('+H+")!!"),I=q+1,B=5}break;case"/":switch(B){case 0:A.setTagName(E.slice(I,q));case 5:case 6:case 7:B=7,A.closed=!0;case 4:case 1:break;case 2:A.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return V.error("unexpected end of input"),B==0&&A.setTagName(E.slice(I,q)),q;case">":switch(B){case 0:A.setTagName(E.slice(I,q));case 5:case 6:case 7:break;case 4:case 1:(G=E.slice(I,q)).slice(-1)==="/"&&(A.closed=!0,G=G.slice(0,-1));case 2:B===2&&(G=N),B==4?(V.warning('attribute "'+G+'" missed quot(")!'),Y(N,G,I)):(o.isHTML(k[""])&&G.match(/^(?:disabled|checked|selected)$/i)||V.warning('attribute "'+G+'" missed value!! "'+G+'" instead!!'),Y(G,G,I));break;case 3:throw new Error("attribute value missed!!")}return q;case"":H=" ";default:if(H<=" ")switch(B){case 0:A.setTagName(E.slice(I,q)),B=6;break;case 1:N=E.slice(I,q),B=2;break;case 4:var G=E.slice(I,q);V.warning('attribute "'+G+'" missed quot(")!!'),Y(N,G,I);case 5:B=6}else switch(B){case 2:A.tagName,o.isHTML(k[""])&&N.match(/^(?:disabled|checked|selected)$/i)||V.warning('attribute "'+N+'" missed value!! "'+N+'" instead2!!'),Y(N,N,I),I=q,B=1;break;case 5:V.warning('attribute space is required"'+N+'"!!');case 6:B=1,I=q;break;case 3:B=4,I=q;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}q++}}function w(E,I,A){for(var k=E.tagName,F=null,V=E.length;V--;){var Y=E[V],N=Y.qName,q=Y.value;if((U=N.indexOf(":"))>0)var B=Y.prefix=N.slice(0,U),H=N.slice(U+1),G=B==="xmlns"&&H;else H=N,B=null,G=N==="xmlns"&&"";Y.localName=H,G!==!1&&(F==null&&(F={},T(A,A={})),A[G]=F[G]=q,Y.uri=o.XMLNS,I.startPrefixMapping(G,q))}for(V=E.length;V--;)(B=(Y=E[V]).prefix)&&(B==="xml"&&(Y.uri=o.XML),B!=="xmlns"&&(Y.uri=A[B||""]));var U;(U=k.indexOf(":"))>0?(B=E.prefix=k.slice(0,U),H=E.localName=k.slice(U+1)):(B=null,H=E.localName=k);var W=E.uri=A[B||""];if(I.startElement(W,H,k,E),!E.closed)return E.currentNSMap=A,E.localNSMap=F,!0;if(I.endElement(W,H,k),F)for(B in F)Object.prototype.hasOwnProperty.call(F,B)&&I.endPrefixMapping(B)}function R(E,I,A,k,F){if(/^(?:script|textarea)$/i.test(A)){var V=E.indexOf("</"+A+">",I),Y=E.substring(I+1,V);if(/[&<]/.test(Y))return/^script$/i.test(A)?(F.characters(Y,0,Y.length),V):(Y=Y.replace(/&#?\w+;/g,k),F.characters(Y,0,Y.length),V)}return I+1}function S(E,I,A,k){var F=k[A];return F==null&&((F=E.lastIndexOf("</"+A+">"))<I&&(F=E.lastIndexOf("</"+A)),k[A]=F),F<I}function T(E,I){for(var A in E)Object.prototype.hasOwnProperty.call(E,A)&&(I[A]=E[A])}function v(E,I,A,k){switch(E.charAt(I+2)){case"-":return E.charAt(I+3)==="-"?(F=E.indexOf("-->",I+4))>I?(A.comment(E,I+4,F-I-4),F+3):(k.error("Unclosed comment"),-1):-1;default:if(E.substr(I+3,6)=="CDATA["){var F=E.indexOf("]]>",I+9);return A.startCDATA(),A.characters(E,I+9,F-I-9),A.endCDATA(),F+3}var V=function(G,U){var W,st=[],K=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(K.lastIndex=U,K.exec(G);W=K.exec(G);)if(st.push(W),W[1])return st}(E,I),Y=V.length;if(Y>1&&/!doctype/i.test(V[0][0])){var N=V[1][0],q=!1,B=!1;Y>3&&(/^public$/i.test(V[2][0])?(q=V[3][0],B=Y>4&&V[4][0]):/^system$/i.test(V[2][0])&&(B=V[3][0]));var H=V[Y-1];return A.startDTD(N,q,B),A.endDTD(),H.index+H[0].length}}return-1}function O(E,I,A){var k=E.indexOf("?>",I);if(k){var F=E.substring(I,k).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return F?(F[0].length,A.processingInstruction(F[1],F[2]),k+2):-1}return-1}function M(){this.attributeNames={}}u.prototype=new Error,u.prototype.name=u.name,g.prototype={parse:function(E,I,A){var k=this.domBuilder;k.startDocument(),T(I,I={}),function(F,V,Y,N,q){function B(_t){var Lt=_t.slice(1,-1);return Object.hasOwnProperty.call(Y,Lt)?Y[Lt]:Lt.charAt(0)==="#"?function(Gt){if(Gt>65535){var kt=55296+((Gt-=65536)>>10),Ct=56320+(1023&Gt);return String.fromCharCode(kt,Ct)}return String.fromCharCode(Gt)}(parseInt(Lt.substr(1).replace("x","0x"))):(q.error("entity not found:"+_t),_t)}function H(_t){if(_t>mt){var Lt=F.substring(mt,_t).replace(/&#?\w+;/g,B);K&&G(mt),N.characters(Lt,0,_t-mt),mt=_t}}function G(_t,Lt){for(;_t>=W&&(Lt=st.exec(F));)U=Lt.index,W=U+Lt[0].length,K.lineNumber++;K.columnNumber=_t-U+1}for(var U=0,W=0,st=/.*(?:\r\n?|\n)|.*$/g,K=N.locator,gt=[{currentNSMap:V}],X={},mt=0;;){try{var nt=F.indexOf("<",mt);if(nt<0){if(!F.substr(mt).match(/^\s*$/)){var tt=N.doc,jt=tt.createTextNode(F.substr(mt));tt.appendChild(jt),N.currentElement=jt}return}switch(nt>mt&&H(nt),F.charAt(nt+1)){case"/":var ut=F.indexOf(">",nt+3),D=F.substring(nt+2,ut).replace(/[ \t\n\r]+$/g,""),z=gt.pop();ut<0?(D=F.substring(nt+2).replace(/[\s<].*/,""),q.error("end tag name: "+D+" is not complete:"+z.tagName),ut=nt+1+D.length):D.match(/\s</)&&(D=D.replace(/[\s<].*/,""),q.error("end tag name: "+D+" maybe not complete"),ut=nt+1+D.length);var Z=z.localNSMap,rt=z.tagName==D;if(rt||z.tagName&&z.tagName.toLowerCase()==D.toLowerCase()){if(N.endElement(z.uri,z.localName,D),Z)for(var J in Z)Object.prototype.hasOwnProperty.call(Z,J)&&N.endPrefixMapping(J);rt||q.fatalError("end tag name: "+D+" is not match the current start tagName:"+z.tagName)}else gt.push(z);ut++;break;case"?":K&&G(nt),ut=O(F,nt,N);break;case"!":K&&G(nt),ut=v(F,nt,N,q);break;default:K&&G(nt);var Q=new M,yt=gt[gt.length-1].currentNSMap,bt=(ut=_(F,nt,Q,yt,B,q),Q.length);if(!Q.closed&&S(F,ut,Q.tagName,X)&&(Q.closed=!0,Y.nbsp||q.warning("unclosed xml attribute")),K&&bt){for(var It=p(K,{}),At=0;At<bt;At++){var re=Q[At];G(re.offset),re.locator=p(K,{})}N.locator=It,w(Q,N,yt)&&gt.push(Q),N.locator=K}else w(Q,N,yt)&&gt.push(Q);o.isHTML(Q.uri)&&!Q.closed?ut=R(F,ut,Q.tagName,B,N):ut++}}catch(_t){if(_t instanceof u)throw _t;q.error("element parse error: "+_t),ut=-1}ut>mt?mt=ut:H(Math.max(nt,mt)+1)}}(E,I,A,k,this.errorHandler),k.endDocument()}},M.prototype={setTagName:function(E){if(!h.test(E))throw new Error("invalid tagName:"+E);this.tagName=E},addValue:function(E,I,A){if(!h.test(E))throw new Error("invalid attribute:"+E);this.attributeNames[E]=this.length,this[this.length++]={qName:E,value:I,offset:A}},length:0,getLocalName:function(E){return this[E].localName},getLocator:function(E){return this[E].locator},getQName:function(E){return this[E].qName},getURI:function(E){return this[E].uri},getValue:function(E){return this[E].value}},n.XMLReader=g,n.ParseError=u},function(i,n,s){s.r(n),s.d(n,"servicesVersion",function(){return Ms}),s.d(n,"servicesDate",function(){return Ps});var o=s(2),a={getLogger:function(c){if(d===void 0)var d={env:{VERBOSE:!1}};d.env.VERBOSE?o.enableAll():o.disableAll();var f=c||"default";return o.getLogger(f)}},l={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(c,d){if(Object.keys(arguments).length===0)return"Message indefined !";var f=Array.prototype.slice.call(arguments),x=f.shift(),C=f,P=this[x];try{P=Array.isArray(C)&&C.length>0?P.replace("%var%",C.join(" - ")):P.replace("%var%","%var% (not specified)")}catch{}return P}},h={normalyzeParameters:function(c){var d=null;if(c){var f=[];for(var x in c)if(c.hasOwnProperty(x)){var C=c[x];C||(C=""),f.push(x+"="+C)}d=f.join("&")}return d},normalyzeUrl:function(c,d,f){var x=c;if(c){if(c.split("?").length-1>=2){var C=c.search(/\?/)+1;x=c.substring(0,C)+c.slice(C).replace(/\?/g,"&")}var P=c.indexOf("?");P===-1&&(x+="?"),P!==-1&&P!==c.length-1&&(x+="&")}return d&&(x+=typeof d=="string"?d=d.replace("?",""):this.normalyzeParameters(d)),f&&(x=encodeURIComponent(x)),x},indent:function(c,d){return new Array((c||0)+1).join("	")+d}},u=s(6),g=s.n(u);function p(c){return(p=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d})(c)}var _,w={call:function(c){var d=a.getLogger("XHR");if(d.trace("[XHR::call()]"),g.a.polyfill(),!c.url)throw new Error("missing parameter : url is not defined !");if(!c.method)throw new Error("missing parameter : method is not defined !");c.format||(c.format="text");var f={};switch(f.url=c.url,f.data=c.data?c.data:null,f.method=c.method,f.timeOut=c.timeOut||0,f.scope=c.scope||this,f.proxy=c.proxy||null,f.content=c.content||null,f.headers=c.headers||{referer:"http://localhost"},c.method){case"DELETE":case"GET":break;case"PUT":case"POST":f.content=c.content?c.content:"application/x-www-form-urlencoded",f.headers=c.headers?c.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(c.format){case"text":this.__call(f).then(function(x){d.trace(x),c.onResponse.call(this,x)}).catch(function(x){c.onFailure.call(this,x)});break;case"json":this.__callJSON(f).then(function(x){d.trace(x),c.onResponse.call(this,x)}).catch(function(x){c.onFailure.call(this,x)});break;case"xml":this.__callXML(f).then(function(x){d.trace(x),c.onResponse.call(this,x)}).catch(function(x){c.onFailure.call(this,x)});break;default:throw new Error("This output Format is not yet supported !")}},__call:function(c){var d=a.getLogger("XHR");return d.trace("[XHR::__call()]"),new Promise(function(f,x){var C=c.method==="POST"||c.method==="PUT"?1:0;c.data&&(p(c.data)==="object"&&Object.keys(c.data).length||typeof c.data=="string"&&c.data.length)&&!C&&(c.url=h.normalyzeUrl(c.url,c.data)),d.trace("URL = ",c.url);var P=null;if(typeof window>"u"){var j=s(3),ot={headers:{Referer:"https://localhost"}};return c.data&&typeof c.data=="string"&&C&&(ot={method:c.method,body:c.data,headers:{"Content-Type":c.content,Referer:"https://localhost"}}),j(c.url,ot).then(function(vt){if(vt.ok)f(vt.text());else{var fe="Errors Occured on Http Request (status : '"+vt.statusText+"' | url : '"+vt.url+"')",qe=vt.status;x({message:fe,status:qe})}}).catch(function(vt){x({message:vt,status:-1})})}if(window.XMLHttpRequest){d.trace("XMLHttpRequest"),(P=new XMLHttpRequest).open(c.method,c.url,!0),P.overrideMimeType=c.content;var dt=null;c.timeOut>0&&(d.trace("XHR - TimeOut actif !"),dt=window.setTimeout(function(){x({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})},c.timeOut)),C&&(d.trace("data = ",c.data),P.setRequestHeader("Content-type",c.content)),P.onerror=function(vt){console.log(vt),x(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},P.ontimeout=function(vt){console.log(vt),x(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},P.onreadystatechange=function(vt){if(P.readyState===4)if(P.status===200)window.clearTimeout(dt),f(P.response);else{var fe="Errors Occured on Http Request (status : '"+vt.target.statusText+"' | url : '"+vt.target.responseURL+"' | response : '"+vt.target.response+"')",qe=vt.target.status;x({message:fe,status:qe})}};var it=c.data&&C?c.data:null;P.send(it)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");d.trace("XDomainRequest"),(P=new XDomainRequest).open(c.method,c.url),P.overrideMimeType=c.content,c.timeOut>0&&(P.timeout=c.timeout,d.trace("XHR - TimeOut actif !")),C&&P.setRequestHeader("Content-type",c.content),P.onerror=function(){x(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},P.ontimeout=function(){x(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},P.onload=function(vt){if(P.status===200)f(P.responseText);else{var fe="Errors Occured on Http Request (status : '"+vt.target.statusText+"' | url : '"+vt.target.responseURL+"')",qe=vt.target.status;x({message:fe,status:qe})}};var Ot=c.data&&C?c.data:null;P.send(Ot)}})},__callJSON:function(c){return this.__call(c).then(JSON.parse).catch(function(d){console.log("_callJSON failed on : ",c.url,d)})},__callXML:function(c){return this.__call(c).then(function(d){var f;return typeof window>"u"?f=new(s(4)).DOMParser().parseFromString(d,"text/xml"):window.DOMParser?f=new window.DOMParser().parseFromString(d,"text/xml"):((f=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,f.loadXML(d)),f}).catch(function(d){console.log("__callXML failed on : ",c.url,d)})}},R={uuid:(_=Math.floor(Date.now()),function(){return _++}),call:function(c){var d=a.getLogger("JSONP");if(d.trace("[JSONP::call ()]"),!c)throw d.error("missing parameter : options !"),new Error("missing parameter : options !");if(!c.url)throw d.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(c.timeOut||(d.info("setting 'options.timeOut' default value"),c.timeOut=0),!c.onResponse)throw d.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var f=typeof c.callbackSuffix=="string"?c.callbackSuffix:this.uuid(),x=!1,C=!1,P=c.url.indexOf("callback=");if(P!==-1){x=!0;var j=c.url.indexOf("&",P);j===-1&&(j=c.url.length);var ot=c.url.substring(P+9,j);ot&&(C=!0,c.callbackName=ot,d.info("setting 'options.callbackName' value ("+c.callbackName+") from 'options.url' parameter"))}if(!x){var dt=c.url.indexOf("?");dt===-1?c.url=c.url+"?callback=":dt===c.url.length?c.url=c.url+"callback=":c.url=c.url+"&callback=",d.info("setting callback default key in 'options.url' : "+c.url)}var it=!!c.callbackName||C;if(C||(c.callbackName||(d.info("setting 'options.callbackName' default value"),c.callbackName="callback",(f||f==="")&&(c.callbackName+=f)),c.url=c.url.replace("callback=","callback="+c.callbackName),d.info("setting callback function name in 'options.url' : "+c.url)),c.onTimeOut||(d.info("setting 'options.onTimeOut' default value"),c.onTimeOut=function(){console.log("TimeOut while invoking url : "+c.url)}),!it){var Ot=this,vt=null;c.timeOut>0&&(vt=window.setTimeout(function(){window[c.callbackName]=function(){},c.onTimeOut(),Ot._deleteScript(f)},c.timeOut)),window[c.callbackName]=function(fe){window.clearTimeout(vt),c.onResponse(fe),Ot._deleteScript(f)}}this._createScript(f,c.url)},_createScript:function(c,d){var f,x=document.getElementById("results"+c);(f=document.createElement("script")).setAttribute("type","text/javascript"),f.setAttribute("src",d),f.setAttribute("charset","UTF-8"),f.setAttribute("id","results"+c),f.setAttribute("async","true");var C=document.documentElement||document.getElementsByTagName("head")[0];x===null?C.appendChild(f):C.replaceChild(f,x)},_deleteScript:function(c){var d=document.getElementById("results"+c);if(d){var f=d.parentNode||document.documentElement;if(!f)return;f.removeChild(d)}}},S={send:function(c){var d=c||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if(typeof window<"u"||c.protocol!=="JSONP"){if(c.protocol==="XHR"||c.format==="json"?d.wrap=!1:c.protocol==="JSONP"&&c.format==="xml"&&(d.wrap=!0),d.callback=null,d.output=d.wrap?"json":null,d.wrap){var f={};f.output=d.output,f.callback=d.callback,delete f.callback,d.url=h.normalyzeUrl(c.url,f)}switch(d.protocol){case"XHR":c.method==="GET"&&c.nocache&&(d.url=h.normalyzeUrl(d.url,{t:new Date().getTime()})),w.call(d);break;case"JSONP":d.data&&(d.url=h.normalyzeUrl(d.url,d.data)),R.call(d);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}else console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS")}};function T(c){if(!(this instanceof T))throw new TypeError("ErrorService constructor cannot be called as a function.");var d=c;typeof c=="string"||c instanceof String?(this.message=c,this.status=-1,this.type=T.TYPE_UNKERR):(this.message=d.message||"undefined!?",this.type=d.type,this.status=d.status||-1),this.name="ErrorService",this.stack=new Error().stack}T.TYPE_SRVERR="SERVICE_ERROR",T.TYPE_USEERR="USAGE_ERROR",T.TYPE_UNKERR="UNKNOWN_ERROR",T.prototype=Object.create(Error.prototype,{constructor:{value:T,writable:!0,configurable:!0}});var v=T,O=s(0);function M(c){if(!(this instanceof M))throw new TypeError(l.getMessage("CLASS_CONSTRUCTOR"));for(var d in this.logger=a.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(f){console.log("onSuccess - la reponse est la suivante : ",f)},onFailure:function(f){f.status!==200&&f.status?console.log("onFailure - Erreur (",f.status,") : ",f.message):console.log("onFailure : ",f.message)}},c)c.hasOwnProperty(d)&&(this.options[d]=c[d]);if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(f){console.log("onSuccess - la réponse brute du service est la suivante : ",f)}),this.options.onSuccess===null||typeof this.options.onSuccess!="function")throw new Error(l.getMessage("PARAM_MISSING","onSuccess()"));switch(this.options.httpMethod=typeof c.httpMethod=="string"?c.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(l.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(l.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol=typeof c.protocol=="string"?c.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(l.getMessage("PARAM_UNKNOWN","protocol"))}if(typeof window>"u"&&this.options.protocol==="JSONP")throw new Error(l.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));this.options.protocol==="JSONP"&&(this.options.httpMethod="GET"),this.options.nocache=c.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}M.prototype={constructor:M,call:function(){this.logger.trace("CommonService::call ()");var c=this;function d(P){this.logger.trace("CommonService::onBuildRequest : ",P),this.callService.call(c,C,f)}function f(P){this.logger.trace("CommonService::onCallService : ",P),this.analyzeResponse.call(c,C,x)}function x(P){if(this.logger.trace("CommonService::onAnalyzeResponse : ",P),!P)return C.call(this,new v("Analyse de la reponse en échec !?"));this.options.onSuccess.call(this,P)}function C(P){this.logger.trace("CommonService::onError()");var j=P;j instanceof v||(j=new v(P.message)),this.options.onFailure.call(this,j)}(function(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(c,C,d)}).call(c)},buildRequest:function(c,d){this.logger.error("overwritten method !"),c&&c.call(this,"This method must be overwritten !"),d.call(this,"This method must be overwritten !")},callService:function(c,d){var f=null,x=this.request,C=!(!this.options.proxyURL||this.options.protocol!=="XHR"),P={"gp-access-lib":O.version};this.options.apiKey&&(P.apiKey=this.options.apiKey),this.options.serverUrl=h.normalyzeUrl(this.options.serverUrl,P,!1),C&&(this.options.httpMethod==="GET"&&(f=this.options.proxyURL+h.normalyzeUrl(this.options.serverUrl,this.request,!0),x=null),this.options.httpMethod==="POST"&&(f=this.options.proxyURL+h.normalyzeUrl(this.options.serverUrl,null,!0),x=this.request));var j=this,ot={url:f||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:this.options.protocol!=="XHR",callbackSuffix:this.options.callbackSuffix,data:x,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(dt){j.logger.trace("callService::onResponse()");var it=null;if(j.options.protocol==="XHR"&&(j.logger.trace("Response XHR",dt),it=dt),j.options.protocol==="JSONP"){if(j.logger.trace("Response JSON",dt),!dt)return void c.call(j,new v("Le contenu de la reponse est vide !?"));if(dt.http){if(dt.http.status!==200)return void c.call(j,new v({status:dt.http.status,message:dt.http.error,type:v.TYPE_SRVERR}));it=dt.xml,j.options.rawResponse&&(it=dt)}else it=dt}if(typeof j.options.onBeforeParse=="function"){var Ot=j.options.onBeforeParse(it);typeof Ot=="string"&&(it=Ot)}j.response=it,d.call(j,it)},onFailure:function(dt){j.logger.trace("callService::onFailure()"),dt.type=v.TYPE_SRVERR,c.call(j,new v(dt))},onTimeOut:function(){j.logger.trace("callService::onTimeOut()"),c.call(j,new v("TimeOut!"))}};S.send(ot)},analyzeResponse:function(c,d){this.logger.error("overwritten method !"),c&&c.call(this,"This method must be overwritten !"),d.call(this,"This method must be overwritten !")}};var E=M,I={ssl:!0,newUrl:function(c){return(I.ssl===!1?"http://":"https://")+"data.geopf.fr"+c},Alti:{new_key:{"elevation-json":"/altimetrie/1.0/calcul/alti/rest/elevation.json","elevation-xml":"/altimetrie/1.0/calcul/alti/rest/elevation.xml","profil-json":"/altimetrie/1.0/calcul/alti/rest/elevationLine.json","profil-xml":"/altimetrie/1.0/calcul/alti/rest/elevationLine.xml"},newUrl:function(){return{"elevation-json":I.newUrl(this.new_key["elevation-json"]),"elevation-xml":I.newUrl(this.new_key["elevation-xml"]),"profil-json":I.newUrl(this.new_key["profil-json"]),"profil-xml":I.newUrl(this.new_key["profil-xml"])}}},ProcessIsoCurve:{new_key:"/navigation/isochrone",newUrl:function(){return I.newUrl(this.new_key)}},Config:{_key:"https://raw.githubusercontent.com/IGNF/geoportal-configuration/new-url/dist/",url:function(c){Array.isArray(c)||(c=c.split(","));for(var d=[],f=0;f<c.length;f++)d[f]=this._key+c[f]+"Config.json";return d}},AutoComplete:{new_key:"/geocodage/completion",newUrl:function(){return I.newUrl(this.new_key)}},ReverseGeocode:{new_key:"/geocodage/reverse",newUrl:function(){return I.newUrl(this.new_key)}},Geocode:{new_key:"/geocodage/search",newUrl:function(){return I.newUrl(this.new_key)}},Route:{new_key:"/navigation/itineraire",newUrl:function(){return I.newUrl(this.new_key)}}},A=I;function k(){if(!(this instanceof k))throw new TypeError("ConfigInterface constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.tileMatrixSets={}}k.prototype={constructor:k,isKeyConfLoaded:function(c){if(c)return!!this.generalOptions.apiKeys[c]},getLayersId:function(c){return this.generalOptions.apiKeys[c]},getLayerId:function(c,d){if(c&&d){var f=null;if(this.layers){var x=this.layers;for(var C in x)if(x.hasOwnProperty(C)){var P=C.split("$");if(c===P[0]&&P[1]){var j=P[1].split(":");if(P[1].split(";")[1]===d.toUpperCase()){f=C;break}if(j[2]===d.toUpperCase()){f=C;break}}}}if(f)return f}},getLayersConf:function(c){var d={},f=this.getLayersId(c);if(f)for(var x=0;x<f.length;x++){var C=f[x];d[C]=this.layers[C]}return d},getLayerConf:function(c){if(this.layers)return this.layers[c]},getLayerParams:function(c,d){var f={};if((d==="WMS"||Object.keys(this.tileMatrixSets).length!==0)&&Object.keys(this.layers).length!==0){var x=this.getLayerId(c,d);if(x){var C=this.getLayerConf(x),P=this.getLayerKey(x);if(P.length===0)return;for(var j=0;j<P.length;j++)C.serviceParams.serverUrl[P[j]]&&(f.url=C.serviceParams.serverUrl[P[j]]);if(/\/v\//.test(f.url)?f.styles=" ":f.styles=C.styles[0].name,f.version=C.serviceParams.version,f.format=C.formats[0].name,f.projection=C.defaultProjection,f.minScale=C.globalConstraint.minScaleDenominator,f.maxScale=C.globalConstraint.maxScaleDenominator,f.extent=C.globalConstraint.bbox,f.legends=C.legends,f.title=C.title,f.description=C.description,d==="WMS"&&(f.metadata=C.metadata),C.wmtsOptions){f.tileMatrixSetLimits=C.wmtsOptions.tileMatrixSetLimits;var ot=C.wmtsOptions.tileMatrixSetLink;if(ot){f.TMSLink=ot;var dt=this.getTMSConf(ot);f.matrixIds=Object.keys(dt.tileMatrices),f.tileMatrices=dt.tileMatrices,f.nativeResolutions=dt.nativeResolutions||this.getTMSConf("PM").nativeResolutions}}}}return f},getLayerKey:function(c){var d=[];if(this.generalOptions&&this.generalOptions.apiKeys&&Object.keys(this.generalOptions.apiKeys).length!==0){var f=this.generalOptions.apiKeys;for(var x in f)f[x].forEach(function(C){C===c&&d.push(x)})}return d},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(c){if(this.tileMatrixSets)return this.tileMatrixSets[c]},getGlobalConstraints:function(c){var d={};if(c){var f=this.getLayerConf(c);d.projection=f.defaultProjection,d.minScale=f.globalConstraint.minScaleDenominator,d.maxScale=f.globalConstraint.maxScaleDenominator,d.extent=f.globalConstraint.bbox}return d}};var F=k;function V(c){return(V=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d})(c)}function Y(c,d){var f=Object.keys(c);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(c);d&&(x=x.filter(function(C){return Object.getOwnPropertyDescriptor(c,C).enumerable})),f.push.apply(f,x)}return f}function N(c){for(var d=1;d<arguments.length;d++){var f=arguments[d]!=null?arguments[d]:{};d%2?Y(Object(f),!0).forEach(function(x){q(c,x,f[x])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(f)):Y(Object(f)).forEach(function(x){Object.defineProperty(c,x,Object.getOwnPropertyDescriptor(f,x))})}return c}function q(c,d,f){return(d=function(x){var C=function(P,j){if(V(P)!="object"||!P)return P;var ot=P[Symbol.toPrimitive];if(ot!==void 0){var dt=ot.call(P,j||"default");if(V(dt)!="object")return dt;throw new TypeError("@@toPrimitive must return a primitive value.")}return(j==="string"?String:Number)(P)}(x,"string");return V(C)=="symbol"?C:C+""}(d))in c?Object.defineProperty(c,d,{value:f,enumerable:!0,configurable:!0,writable:!0}):c[d]=f,c}function B(c){if(!(this instanceof B))throw new TypeError(l.getMessage("CLASS_CONSTRUCTOR","Config"));if(this.CLASSNAME="Config",this.logger=a.getLogger("Gp.Config"),this.logger.trace("[Constructeur Config (options)]"),c.onSuccess===null||typeof c.onSuccess!="function")throw new Error(l.getMessage("PARAM_MISSING","onSuccess()"));c.apiKey||c.customConfigFile||(c.apiKey="full"),this.options={},this.options.onSuccess=c.onSuccess,this.options.onFailure=c.onFailure,this.options.sync=c.sync||!1,this.options.listConfigUrls=c.customConfigFile?[c.customConfigFile]:Array.isArray(c.apiKey)?A.Config.url(c.apiKey):A.Config.url(c.apiKey.split(","))}B.prototype=Object.create(E.prototype,{}),B.prototype.constructor=B,B.prototype.buildRequest=function(c,d){this.listConfigUrls=this.options.listConfigUrls,this.listConfigUrls?d.call(this,this.listConfigUrls):c.call(this,new Error("url by default not found !"))},B.prototype.callService=function(c,d){this.options.sync?G.call(this,c,d):H.call(this,c,d)};var H=function(c,d){var f=this;this.listConfigResults=[];var x=null;if(typeof window>"u"){var C=s(3);x=C}else x=window.fetch;for(var P=function(it){return x(it,{credentials:"same-origin"}).then(function(Ot){if(Ot.ok)return Ot.json().then(function(vt){return vt}).catch(function(vt){throw new Error("Exception Json : "+vt)});throw new Error("Exception HTTP : "+Ot.status+" (status code) !")}).catch(function(Ot){return new Promise(function(vt,fe){fe(Ot)})})},j=[],ot=0;ot<this.listConfigUrls.length;ot++){var dt=this.listConfigUrls[ot];j.push(P(dt))}Promise.all(j).then(function(it){if(!it)throw new Error("results config empty !?");it.forEach(function(Ot){f.listConfigResults.push(Ot)})}).then(function(){d.call(f,f.listConfigResults)}).catch(function(it){c.call(f,it)})},G=function(c,d){this.listConfigResults=[];for(var f=0;f<this.listConfigUrls.length;f++){var x=this.listConfigUrls[f],C=new XMLHttpRequest;if(C.open("GET",x,!1),C.send(null),C.status===200){var P=JSON.parse(C.responseText);this.listConfigResults.push(P)}}this.listConfigResults.length!==0?d.call(this,this.listConfigResults):c.call(this,new Error("..."))};B.prototype.analyzeResponse=function(c,d){var f=function(j){for(var ot={},dt={},it={},Ot=0;Ot<j.length;Ot++){if(!j[Ot].generalOptions||!j[Ot].layers)return;dt=N(N({},dt),j[Ot].generalOptions.apiKeys),ot=N(N({},ot),j[Ot].layers),it=N(N({},it),j[Ot].tileMatrixSets)}return{generalOptions:{apiKeys:dt},layers:ot,tileMatrixSets:it}}(this.listConfigResults);if(f){var x=new F;Object.assign(x,f);var C=typeof window<"u"?window:{};if(C.Gp||(C.Gp={}),C.Gp.Config)for(var P in Object.assign(C.Gp.Config,x),x)C.Gp.Config[P]=x[P];else C.Gp.Config=x;d.call(this,C.Gp.Config)}else c.call(this,new Error("configuration structure not conforme !"))};var U=B;function W(c){if(!(this instanceof W))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=a.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=c||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json",this.resource=this.options.resource,this.measures=this.options.measures||!1}W.CLASSNAME="AltiRequest",W.prototype={constructor:W,setPositions:function(c){for(var d=[],f=0;f<c.length;f++){var x=c[f];x.lon&&x.lat&&d.push(x)}this.positions=d},getPositions:function(c){if(!c)return this.positions;var d=this.positions.length-1;return c>d||c<d?(this.logger.warn("index out of range !"),this.positions):this.positions[c]},addPositions:function(c){for(var d=0;d<c.length;d++){var f=c[d];f.lon&&f.lat&&this.positions.push(c[d])}},getLon:function(){for(var c=[],d=0;d<this.positions.length;d++)c.push(this.positions[d].lon);return this.logger.trace(c),c.join(this.delimiter)},getLat:function(){for(var c=[],d=0;d<this.positions.length;d++)c.push(this.positions[d].lat);return this.logger.trace(c),c.join(this.delimiter)}},W.prototype.getData=function(){var c=[];return c.push({k:"lon",v:this.getLon()}),c.push({k:"lat",v:this.getLat()}),c.push({k:"delimiter",v:this.delimiter}),c.push({k:"indent",v:this.indent}),c.push({k:"crs",v:this.crs}),c.push({k:"format",v:this.format}),c};var st=W;function K(c){if(!(this instanceof K))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",st.apply(this,arguments),this.logger=a.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}K.prototype=Object.create(st.prototype,{zonly:{get:function(){return this._zonly},set:function(c){this._zonly=c}}}),K.prototype.constructor=K,K.prototype.getData=function(){var c=[];return c.push({k:"lon",v:this.getLon()}),c.push({k:"lat",v:this.getLat()}),c.push({k:"indent",v:this.indent}),c.push({k:"crs",v:this.crs}),c.push({k:"zonly",v:this.zonly}),c.push({k:"format",v:this.format}),c.push({k:"resource",v:this.resource}),c};var gt=K;function X(c){if(!(this instanceof X))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",st.apply(this,arguments),this.logger=a.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}X.prototype=Object.create(st.prototype,{sampling:{get:function(){return this._sampling},set:function(c){this._sampling=c}}}),X.prototype.constructor=X,X.prototype.getData=function(){var c=[];return c.push({k:"lon",v:this.getLon()}),c.push({k:"lat",v:this.getLat()}),c.push({k:"indent",v:this.indent}),c.push({k:"crs",v:this.crs}),c.push({k:"sampling",v:this.sampling}),c.push({k:"format",v:this.format}),c.push({k:"resource",v:this.resource}),c};var mt=X;function nt(c){if(this.logger=a.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof nt))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=c||{},!this.options)throw new Error(l.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(l.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new gt(this.options.param);break;case"Profil":this.DataObject=new mt(this.options.param);break;default:throw new Error(l.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}nt.prototype={requestString:null,constructor:nt,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'&resource=__RESOURCE__&measures=__MEASURES__",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:`lon=__LON__
lat=__LAT__
indent=__INDENT__
crs='__CRS__'
resource='__RESOURCE__'
measures='__MEASURES__'
`,input:{point:`zonly=__ZONLY__
`,profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var c="";return this.method==="POST"?c=this.template.post.value:this.method==="GET"&&(c=this.template.get.value),c=(c=(c=(c=(c=(c=c.replace(/__LON__/g,this.DataObject.getLon())).replace(/__LAT__/g,this.DataObject.getLat())).replace(/__INDENT__/g,this.DataObject.indent)).replace(/__CRS__/g,this.DataObject.crs)).replace(/__RESOURCE__/g,this.DataObject.resource)).replace(/__MEASURES__/g,this.DataObject.measures),c+=this.__addDataInputs(),this.logger.trace("traduction tmpl",c),this.requestString=c,this.requestString},__addDataInputs:function(){var c;if(this.logger.trace("AltiRequestREST::addDataInput ()"),this.method==="POST")c=this.template.post;else{if(this.method!=="GET")throw new Error("No other HTTP method supported by the service !");c=this.template.get}if(this.DataObject.CLASSNAME==="AltiElevationRequest")return c.input.point.replace(/__ZONLY__/g,this.DataObject.zonly.toString());if(this.DataObject.CLASSNAME==="AltiProfilRequest")return c.input.profil.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}};var tt=nt;function jt(c){if(this.logger=a.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof jt))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=c||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}jt.prototype={requestString:null,constructor:jt,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=<!-- __DATAINPUTS__ -->",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs><!-- __DATAINPUTS__ --></wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var c="";if(this.method==="POST")c=this.template.post.value;else{if(this.method!=="GET")return this.logger.error("No other method supported by the service !"),!1;c=this.template.get.value}return c=(c=(c=(c=(c=c.replace(/__SERVICE__/g,this.paramservice)).replace(/__VERSION__/g,this.paramversion)).replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput)).replace(/__IDENTIFIER__/g,this.paramidentifier)).replace(/__REQUEST__/g,this.paramrequest),this.method==="POST"&&(c=(c=c.replace(/__NAMESPACE__/g,this.namespaceByDefault)).replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),(c=c.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()))?(this.requestString=c,this.logger.trace("traduction tmpl",c),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var c,d=this.method==="GET"?this.template.get.input:this.template.post.input,f=this.method==="GET"?";":"",x="",C=this,P=this.DataObject.getData(),j=0;j<P.length;j++)c=j,f&&(f=c===P.length-1?"":";"),x=x.concat(C.__addDataInput(d,P[c].k,P[c].v),f);return x},__addDataInput:function(c,d,f){var x=c;return x=(x=x.replace(/__KEY__/g,d)).replace(/__DATA__/g,f)},setMethod:function(c){c==="GET"||c==="POST"?this.method=c:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}};var ut=jt,D={build:function(c){if(a.getLogger("AltiRequestWPS").trace(["AltiRequestWPS::build()"]),!c)throw new Error(l.getMessage("PARAM_EMPTY","options"));if(!c.type)throw new Error(l.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var d=null;switch(c.type){case"Elevation":c.wps.identifier="gs:WPSElevation",d=new gt(c.param);break;case"Profil":c.wps.identifier="gs:WPSLineElevation",d=new mt(c.param);break;default:throw new Error(l.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var f={data:d,method:c.method,param:c.wps},x=new ut(f);if(!x.processRequestString())throw new Error("Enable to process request !");return x.requestString}},z={build:function(c){a.getLogger("AltiRequestFactory").trace(["AltiRequestFactory::build()"]);var d=null,f={type:c.sampling?"Profil":"Elevation",method:c.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null,measures:null}};f.param.positions=c.positions,f.param.format=c.outputFormat,f.param.sampling=c.sampling,f.param.zonly=c.zonly,f.param.measures=c.measures,f.param.resource=c.resource;var x=!(c.onError===null||typeof c.onError!="function"),C=!(c.onSuccess===null||typeof c.onSuccess!="function"),P=null;switch(c.api){case"REST":var j=new tt(f);if(!j.processRequestString()){if(P="Error in process request (rest) !",x)return void c.onError.call(c.scope,new v(P));throw new Error(P)}d=j.requestString;break;case"WPS":if(f.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},!(d=D.build(f))){if(P="Error in process request (wps) !",x)return void c.onError.call(c.scope,new v(P));throw new Error(P)}break;default:if(P="Type of API is not supported by service (REST or WPS) !",x)return void c.onError.call(c.scope,new v(P));throw new Error(P)}return C&&c.onSuccess.call(c.scope,d),d}};function Z(c){if(!(this instanceof Z))throw new TypeError("XML constructor cannot be called as a function.");this.logger=a.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,c&&(c.xmlString&&typeof c.xmlString=="string"&&(this.xmlString=c.xmlString,this.xmlDoc=rt(c.xmlString)),c.reader&&this.setReader(c.reader))}function rt(c){if(typeof window>"u")return new(s(4)).DOMParser().parseFromString(c,"text/xml");var d,f,x="Erreur lors du parsing de la réponse du service : XML non conforme";if(window.ActiveXObject){(f=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,f.loadXML(c);var C=f.parseError;if(C.errorCode)throw C.line&&C.linepos&&(x+="( ligne "+C.line+", colonne "+C.linepos),C.reason&&(x+=":  "+C.reason+")"),new Error(x);return f}if(window.DOMParser){d=new window.DOMParser;try{f=d.parseFromString(c,"text/xml")}catch(dt){throw dt.message==="SyntaxError"?new Error(x):new Error("Erreur lors du parsing de la réponse du service : "+dt.message)}if(f.getElementsByTagName("parsererror").length>0)for(var P=f.getElementsByTagName("parsererror"),j=0;j<P.length;j++){var ot=P[j].innerHTML;if(ot.indexOf("Huge input lookup")===-1)throw x+="("+ot+")",new Error(x)}else if(!f.documentElement)throw new Error(x);return f}throw new Error("Incompatible DOM Parser pour ce navigateur !")}Z.prototype={constructor:Z,getXMLString:function(){return this.xmlString},setXMLString:function(c){c&&typeof c=="string"&&(this.xmlString=c,this.xmlDoc=rt(c))},getReader:function(){return this.reader},setReader:function(c){c&&c.read&&typeof c.read=="function"&&(this.reader=c)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(c){this.xmlDoc=c},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=rt(this.xmlString)),this.xmlDoc){var c,d=function(f){var x;return f.nodeType===9?x=f.documentElement:f.nodeType===1&&(x=f),x}(this.xmlDoc);return d?(this.reader&&this.reader.read?c=this.reader.read(d):(c={})[d.nodeName]=function f(x){var C={};if(x.attributes.length>0){var P=function(vt){if(vt.attributes.length>0){for(var fe={},qe=vt.attributes,pr=0;pr<qe.length;pr++){var Ns=qe[pr];fe[Ns.nodeName]=Ns.nodeValue}return fe}}(x);C.attributes=P}if(x.hasChildNodes()){for(var j,ot={},dt=x.childNodes,it=0;it<dt.length;it++)if((j=dt[it]).nodeType===3)C.textContent=j.nodeValue;else if(j.nodeType===1)if(ot=f(j),C[j.nodeName]){if(!Array.isArray(C[j.nodeName])){var Ot=C[j.nodeName];C[j.nodeName]=[],C[j.nodeName].push(Ot)}C[j.nodeName].push(ot)}else C[j.nodeName]=ot}return C}(d),c):{}}}};var J=Z;function Q(){if(!(this instanceof Q))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}Q.prototype={constructor:Q};var yt=Q;function bt(){if(!(this instanceof bt))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}bt.prototype={constructor:bt};var It=bt;function At(){if(!(this instanceof At))throw new TypeError("Measure constructor cannot be called as a function.");this.source_name=null,this.source_measure=null,this.z=null,this.acc=null}At.prototype={constructor:At};var re=At,_t={};_t.READERS={elevations:function(c){var d=new yt;if(c.hasChildNodes())for(var f,x,C=c.childNodes,P=0;P<C.length;P++)f=C[P],_t.READERS[f.nodeName]&&(x=_t.READERS[f.nodeName](f),d.elevations.push(x));return d},elevation:function(c){var d=new It;if(c.hasChildNodes())for(var f,x=c.childNodes,C=0;C<x.length;C++)f=x[C],_t.READERS[f.nodeName]&&_t.READERS[f.nodeName](f,d);return d},lat:function(c,d){var f=c.firstChild;if(!f||f.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : latitude attendue mais absente");d.lat=parseFloat(f.nodeValue)},lon:function(c,d){var f=c.firstChild;if(!f||f.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : longitude attendue mais absente");d.lon=parseFloat(f.nodeValue)},z:function(c,d){var f=c.firstChild;if(!f||f.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : altitude attendue mais absente");if(!d)return(d=new It).z=parseFloat(f.nodeValue),d;d.z=parseFloat(f.nodeValue)},acc:function(c,d){var f=c.firstChild;if(!f||f.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : précision (acc) attendue mais absente");d.acc=parseFloat(f.nodeValue)},source_name:function(c,d){var f=c.firstChild;if(!f||f.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : source_name attendue mais absente");d.source_name=f.nodeValue},source_measure:function(c,d){var f=c.firstChild;if(!f||f.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : source_measure attendue mais absente");d.source_measure=f.nodeValue},measures:function(c,d){var f;if(d.measures=[],c.hasChildNodes())for(var x,C=c.childNodes,P=0;P<C.length;P++){f=new re,x=C[P].childNodes;for(var j=0;j<x.length;j++){if(!_t.READERS[x[j].nodeName])throw new Error("Erreur dans la lecture de la réponse du service : measures attendues mais absentes");_t.READERS[x[j].nodeName](x[j],f)}d.measures.push(f)}},exceptionreport:function(c){var d={};if(c.hasChildNodes())for(var f,x=c.childNodes,C=0;C<x.length;C++)(f=x[C]).nodeName==="Exception"&&(d.exceptionReport=_t.READERS.exception(f));return d},exception:function(c){var d={},f=c.getAttribute("exceptionCode");f&&(d.exceptionCode=f);var x=c.firstChild;return x&&x.nodeType===3&&(d.exception=x.nodeValue),d},error:function(c){var d={error:{}};if(c.hasChildNodes())for(var f,x=c.childNodes,C=0;C<x.length;C++){var P;(f=x[C]).nodeType===1&&f.nodeName==="code"&&(P=f.firstChild)&&P.nodeType===3&&(d.error.code=P.nodeValue),f.nodeType===1&&f.nodeName==="description"&&(P=f.firstChild)&&P.nodeType===3&&(d.error.description=P.nodeValue)}return d}},_t.read=function(c){if(c.nodeName==="elevations")return _t.READERS.elevations(c);if(c.nodeName==="ExceptionReport")return _t.READERS.exceptionreport(c);if(c.nodeName==="error")return _t.READERS.error(c);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var Lt=_t;function Gt(c){return(Gt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d})(c)}var kt={build:function(c){var d=a.getLogger("AltiResponseFactory");d.trace(["AltiResponseFactory::build()"]);var f=null;if(c.response){if(c.rawResponse)d.trace("analyze response : raw"),f=c.response;else{switch(c.outputFormat){case"xml":d.trace("analyze response : xml");try{var x=new J({reader:Lt});if(typeof c.response=="string"?x.setXMLString(c.response):x.setXMLDoc(c.response),!(f=x.parse()))throw new Error(l.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(vt){var C=vt.message;return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_EXCEPTION",C),status:200,type:v.TYPE_SRVERR}))}break;case"json":d.trace("analyze response : json"),d.trace("analyze response : ",Gt(c.response));var P=null;if((P=typeof c.response=="string"?JSON.parse(c.response):c.response)&&P.error)return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_EXCEPTION",P.error.description),status:200,type:v.TYPE_SRVERR}));if(P){var j,ot=P.elevations,dt=new yt;if(Array.isArray(ot)&&ot.length)for(var it=0;it<ot.length;it++)j=new It,Gt(ot[it])==="object"?(ot[it].lon&&(j.lon=ot[it].lon),ot[it].lat&&(j.lat=ot[it].lat),ot[it].z&&(j.z=ot[it].z),ot[it].acc&&(j.acc=ot[it].acc),ot[it].measures&&(j.measures=ot[it].measures)):typeof ot[it]=="number"&&(j.z=ot[it]),Array.isArray(dt.elevations)&&dt.elevations.push(j);f=dt}if(!f)return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:v.TYPE_UNKERR,status:-1}));break;default:return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:v.TYPE_UNKERR,status:-1}))}if(f.exceptionReport)return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_EXCEPTION",f.exceptionReport),type:v.TYPE_SRVERR,status:200}));if(f.error){var Ot=f.error.description;return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_EXCEPTION",Ot),type:v.TYPE_SRVERR,status:200}))}}c.onSuccess.call(c.scope,f)}else c.onError.call(c.scope,new v(l.getMessage("SERVICE_RESPONSE_EMPTY")))}};function Ct(c){if(!(this instanceof Ct))throw new TypeError(l.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",E.apply(this,arguments),this.logger=a.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!c.positions)throw new Error(l.getMessage("PARAM_MISSING","positions"));if(c.positions.length===0)throw new Error(l.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=c.positions,this.options.outputFormat=typeof c.outputFormat=="string"?c.outputFormat.toLowerCase():"xml",this.options.resource=c.resource||"ign_rge_alti_wld",this.options.sampling=c.sampling||null,this.options.api=typeof c.api=="string"?c.api.toUpperCase():"REST",this.options.api==="REST"&&(this.options.httpMethod="GET"),this.options.zonly=c.zonly||!1,this.options.measures=c.measures||!1,!this.options.serverUrl){var d=A.Alti.newUrl(),f=null;switch(this.options.api){case"WPS":f=d.wps;break;case"REST":var x=(c.sampling?"profil":"elevation")+"-"+this.options.outputFormat;f=d[x];break;default:throw new Error(l.getMessage("PARAM_UNKNOWN","api"))}if(!f)throw new Error("Url by default not found !");this.options.serverUrl=f,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var C=this.options.serverUrl.lastIndexOf(".");if(C!==-1){var P=this.options.serverUrl.substring(C+1);if(P&&P.length<5)switch(this.logger.trace("Server Extension URL : "+P),P.toLowerCase()){case"json":case"xml":this.options.outputFormat=P.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}Ct.prototype=Object.create(E.prototype,{}),Ct.prototype.constructor=Ct,Ct.prototype.buildRequest=function(c,d){var f={httpMethod:this.options.httpMethod,onSuccess:function(x){this.request=x,d.call(this,this.request)},onError:c,scope:this,resource:this.options.resource,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly,measures:this.options.measures};z.build(f)},Ct.prototype.analyzeResponse=function(c,d){if(this.response){var f={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:c,onSuccess:d,scope:this};kt.build(f)}else c.call(this,new v(l.getMessage("SERVICE_RESPONSE_EMPTY")))};var Zt=Ct;function Yt(c){if(!(this instanceof Yt))throw new TypeError("GeocodeParamREST constructor cannot be called as a function.");if(this.logger=a.getLogger(),this.logger.trace("[Constructeur GeocodeParamREST ()]"),this.options=c||{},!this.options.geocodeMethod||this.options.geocodeMethod!=="search"&&this.options.geocodeMethod!=="reverse")throw new Error("Error geocodeMethod not valid");this.geocodeMethod=this.options.geocodeMethod,this.query=this.options!==void 0?this.options.query:null,this.searchGeometry=this.options.searchGeometry||null,this.index=this.options.index||null,this.lon=this.options.position&&this.options.position.lon?this.options.position.lon:null,this.lat=this.options.position&&this.options.position.lat?this.options.position.lat:null,this.maxResp=this.options.maxResp||null,this.returnTrueGeometry=this.options.returnTrueGeometry||null,this.filters=this.options.filters||{}}Yt.CLASSNAME="GeocodeParamREST",Yt.prototype={constructor:Yt,getFilters:function(){var c={};for(var d in this.filters)this.filters.hasOwnProperty(d)&&(c[d]=this.filters[d]);return c},getIndex:function(){return this.index===void 0?null:this.index==="StreetAddress"?"address":this.index==="CadastralParcel"?"parcel":this.index==="PositionOfInterest"?"poi":this.index==="location"?"location":this.index},getSearchGeometry:function(){return JSON.stringify(this.searchGeometry)}},Yt.prototype.getParams=function(){var c=[];this.geocodeMethod==="search"&&c.push({k:"q",v:this.query}),this.index&&c.push({k:"index",v:this.getIndex()}),this.geocodeMethod==="reverse"&&this.searchGeometry&&c.push({k:"searchgeom",v:this.getSearchGeometry()}),this.lon&&this.lat&&(c.push({k:"lon",v:this.lon}),c.push({k:"lat",v:this.lat})),this.maxResp&&c.push({k:"limit",v:this.maxResp}),this.returnTrueGeometry&&c.push({k:"returntruegeometry",v:this.returnTrueGeometry});var d=this.getFilters();for(var f in d)c.push({k:f,v:d[f]});return c};var he=Yt;function Jt(c){if(this.logger=a.getLogger("GeocodeRequestREST"),this.logger.trace("[Constructeur GeocodeRequestREST ()]"),!(this instanceof Jt))throw new TypeError("GeocodeRequestREST constructor cannot be called as a function.");if(!c)throw new Error(l.getMessage("PARAM_EMPTY","options"));this.settings=c}Jt.prototype={requestString:null,constructor:Jt,processRequestString:function(){for(var c="",d=new he(this.settings).getParams(),f=0;f<d.length;f++){var x=d[f];c&&(c+="&"),c+=x.k+"="+x.v}if(!this.settings.geocodeMethod||this.settings.geocodeMethod!=="search"&&this.settings.geocodeMethod!=="reverse")throw new Error("Error geocodeMethod not valid");return this.requestString="?"+c,this.logger.trace(this.requestString),this.requestString}};var se=Jt,ue={build:function(c){var d=a.getLogger("GeocodeRequestFactory");d.trace(["GeocodeRequestFactory::build()"]);var f=new se(c||{});if(!f.processRequestString())throw new Error("Error process request (rest) !");var x=f.requestString;return d.trace(x),x}};function oe(){if(!(this instanceof oe))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}oe.prototype={constructor:oe};var Ut=oe;function de(){if(!(this instanceof de))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position=null,this.matchType=null,this.placeAttributes={},this.type=null,this.accuracy=null,this.CLASSNAME="GeocodedLocation"}de.prototype={constructor:de};var xi=de;function Te(){if(!(this instanceof Te))throw new TypeError("GeocodeResponseParser constructor cannot be called as a function.")}function Fe(c,d){var f=new xi;if(c.geometry&&c.geometry.type==="Point"&&(f.position={lon:c.geometry.coordinates[0],lat:c.geometry.coordinates[1]}),c.properties){for(var x in c.properties)x==="score"?f.accuracy=c.properties[x]:x==="_type"?c.properties[x]==="address"?f.type="StreetAddress":c.properties[x]==="poi"?f.type="PositionOfInterest":c.properties[x]!=="parcel"&&c.properties[x]!=="cadastral"||(f.type="CadastralParcel"):f.placeAttributes[x]=c.properties[x];c.properties._type==="address"&&(f.matchType=c.properties.number!==void 0&&c.properties.number!==null?"street number":"street")}d.locations.push(f)}Te.prototype={constructor:Te,parse:function(c){var d=new Ut,f=JSON.parse(c);if(f.type==="FeatureCollection")for(var x=0;x<f.features.length;++x)Fe(f.features[x],d);else{if(f.type!=="Feature"){if(f.type==="SERVICE_ERROR")return{exceptionReport:f};var C=l.getMessage("SERVICE_RESPONSE_ANALYSE",f.type);throw new v({message:C,type:v.TYPE_UNKERR,status:200})}Fe(f,d)}return d}};var Ge=Te,ae={build:function(c){var d=null;if(c.response){if(c.rawResponse)d=c.response;else{try{if(!(d=new Ge().parse(c.response)))throw new Error("L'analyse de la réponse du service !?")}catch(x){var f=x.message;return typeof c.response=="string"?f+="('"+c.response+"')":f+="('"+c.response.documentElement.innerHTML+"')",void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_ANALYSE",f),type:v.TYPE_UNKERR,status:-1}))}if(d.exceptionReport)return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_EXCEPTION",d.exceptionReport),type:v.TYPE_SRVERR,status:200}))}c.onSuccess.call(c.scope,d)}else c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_EMPTY"),type:v.TYPE_SRVERR,status:-1}))}};function Ue(c){return(Ue=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d})(c)}function m(c){if(!(this instanceof m))throw new TypeError(l.getMessage("CLASS_CONSTRUCTOR","Geocode"));this.CLASSNAME="Geocode",this.logger=a.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]");var d=this.patchOptionConvertor(c);if(d.serverUrl||(d.serverUrl=A.Geocode.newUrl()),E.apply(this,[d]),!d.hasOwnProperty("query"))throw new Error(l.getMessage("PARAM_MISSING","query"));if(this.options.query=d.query,d.index||(this.options.index=d.index="StreetAddress"),d.filters)for(var f=Object.keys(d.filters),x=0;x<f.length;x++){var C=f[x];(d.filters[C]===void 0||Ue(d.filters[C])==="object"&&Object.keys(d.filters[C]).length===0||typeof d.filters[C]=="string"&&d.filters[C].length===0||Array.isArray(d.filters[C])&&d.filters[C].length===0)&&delete this.options.filters[C]}this.options.index=d.index||"StreetAddress",this.options.maximumResponses=d.maximumResponses||20}m.prototype=Object.create(E.prototype,{}),m.prototype.constructor=m,m.prototype.patchOptionConvertor=function(c){var d=c;return d.hasOwnProperty("location")&&(this.logger.warn("The parameter 'location' is deprecated"),d.query||(d.query=d.location),delete d.location),d.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),d.filters||(d.filters=d.filterOptions,d.filters.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),d.index||(Array.isArray(d.filters.type)&&d.filters.type.length>0?d.index=d.filters.type[0]:d.index=d.filters.type),delete d.filters.type),d.filters.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),delete d.filters.bbox)),delete d.filterOptions),d.position&&(d.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),d.position.lon||(d.position.lon=d.position.x),delete d.position.x),d.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),d.position.lat||(d.position.lat=d.position.y),delete d.position.y)),d.returnFreeForm&&(this.logger.warn("The parameter 'returnFreeForm' is deprecated"),delete d.returnFreeForm),d.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete d.srs),d},m.prototype.buildRequest=function(c,d){var f={httpMethod:this.options.httpMethod,geocodeMethod:"search",query:this.options.query,index:this.options.index,returnTrueGeometry:this.options.returnTrueGeometry,position:this.options.position,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=ue.build(f),this.request?d.call(this,this.request):c.call(this,new v(l.getMessage("SERVICE_REQUEST_BUILD")))},m.prototype.analyzeResponse=function(c,d){if(this.response){var f={response:this.response,rawResponse:this.options.rawResponse,onError:c,onSuccess:d,scope:this};ae.build(f)}else c.call(this,new v(l.getMessage("SERVICE_RESPONSE_EMPTY")))};var y=m;function b(c){return(b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d})(c)}function L(c){if(!(this instanceof L))throw new TypeError(l.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));this.CLASSNAME="ReverseGeocode",this.logger=a.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]");var d=this.patchOptionConvertor(c);if(d.serverUrl||(d.serverUrl=A.ReverseGeocode.newUrl()),E.apply(this,[d]),d.searchGeometry)this.options.searchGeometry=d.searchGeometry;else if(!d.position)throw new Error(l.getMessage("PARAM_MISSING","searchGeometry"));if(d.index||(this.options.index=d.index="StreetAddress"),d.filters)for(var f=Object.keys(d.filters),x=0;x<f.length;x++){var C=f[x];(d.filters[C]===void 0||b(d.filters[C])==="object"&&Object.keys(d.filters[C]).length===0||typeof d.filters[C]=="string"&&d.filters[C].length===0||Array.isArray(d.filters[C])&&d.filters[C].length===0)&&delete this.options.filters[C]}this.options.position=d.position,this.options.index=d.index||"StreetAddress",this.options.maximumResponses=d.maximumResponses||20}L.prototype=Object.create(E.prototype,{}),L.prototype.constructor=L,L.prototype.patchOptionConvertor=function(c){var d=c;return d.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),d.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),d.index||(Array.isArray(d.filterOptions.type)&&d.filterOptions.type.length>0?d.index=d.filterOptions.type[0]:d.index=d.filterOptions.type),delete d.filterOptions.type),d.filterOptions.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),d.searchGeometry||(d.searchGeometry=this.bbox2Json(d.filterOptions.bbox)),delete d.filterOptions.bbox),d.filterOptions.circle&&(this.logger.warn("The parameter 'filterOptions.circle' is deprecated"),d.searchGeometry||(d.searchGeometry=this.circle2Json(d.filterOptions.circle)),delete d.filterOptions.circle),d.filterOptions.polygon&&(this.logger.warn("The parameter 'filterOptions.polygon' is deprecated"),d.searchGeometry||(d.searchGeometry=this.polygon2Json(d.filterOptions.polygon)),delete d.filterOptions.polygon),!d.filters&&Object.keys(d.filterOptions).length>0&&(d.filters=d.filterOptions),delete d.filterOptions),d.position&&(d.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),d.position.lon||(d.position.lon=d.position.x),delete d.position.x),d.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),d.position.lat||(d.position.lat=d.position.y),delete d.position.y)),d.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete d.srs),d},L.prototype.buildRequest=function(c,d){var f={httpMethod:this.options.httpMethod,geocodeMethod:"reverse",searchGeometry:this.options.searchGeometry,index:this.options.index,position:this.options.position,returnTrueGeometry:this.options.returnTrueGeometry,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=ue.build(f),this.request?d.call(this,this.request):c.call(this,new v(l.getMessage("SERVICE_REQUEST_BUILD")))},L.prototype.analyzeResponse=function(c,d){if(this.response){var f={response:this.response,rawResponse:this.options.rawResponse,onError:c,onSuccess:d,scope:this};ae.build(f)}else c.call(this,new v(l.getMessage("SERVICE_RESPONSE_EMPTY")))},L.prototype.bbox2Json=function(c){return{type:"Polygon",coordinates:[[[c.left,c.top],[c.right,c.top],[c.right,c.bottom],[c.left,c.bottom],[c.left,c.top]]]}},L.prototype.circle2Json=function(c){return{type:"Circle",radius:c.radius,coordinates:[c.x,c.y]}},L.prototype.polygon2Json=function(c){for(var d={type:"Polygon",coordinates:[[]]},f=0;f<c.length;++f)d.coordinates[0].push([c[f].x,c[f].y]);return d},L.geoEPSG=["EPSG:4326"];var $=L;function et(){if(!(this instanceof et))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}et.prototype={constructor:et};var at=et;function ht(){if(!(this instanceof ht))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}ht.prototype={constructor:ht};var Tt=ht,Vt={build:function(c){var d=a.getLogger("AutoCompleteResponseFactory");d.trace(["AutoCompleteResponseFactory::build()"]);var f=null;if(c.response){if(c.rawResponse)d.trace("analyze response : raw"),f=c.response;else{var x=null;if(x=typeof c.response=="string"?JSON.parse(c.response):c.response){if(x.error)return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_EXCEPTION",x.error.description),status:x.error.code,type:v.TYPE_SRVERR}));if(f=new at,!x.results||!Array.isArray(x.results))return void c.onError.call(c.scope,new v(l.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var C=null,P=0;P<x.results.length;P++){var j=x.results[P];C=new Tt,j&&(j.country==="StreetAddress"?(C.street=j.street,C.type="StreetAddress"):j.country==="PositionOfInterest"&&(C.poi=j.street,C.type="PositionOfInterest",C.poiType=j.poiType),C.position&&(C.position.x=j.x,C.position.y=j.y),C.kind=j.kind,C.commune=j.city,C.fullText=j.fulltext,C.postalCode=j.zipcode,C.classification=j.classification),f.suggestedLocations.push(C)}if(!f.suggestedLocations.length)return void c.onError.call(c.scope,new v(l.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!f)return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:v.TYPE_UNKERR,status:-1}));if(f.exceptionReport)return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_EXCEPTION",f.exceptionReport),type:v.TYPE_SRVERR,status:200}))}c.onSuccess.call(c.scope,f)}else c.onError.call(c.scope,new v(l.getMessage("SERVICE_RESPONSE_EMPTY")))}};function Rt(c){if(!(this instanceof Rt))throw new TypeError(l.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));this.CLASSNAME="AutoComplete",this.logger=a.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]");var d=this.patchOptionConvertor(c);if(d.serverUrl||(d.serverUrl=A.AutoComplete.newUrl()),E.apply(this,arguments),!d.text)throw new Error(l.getMessage("PARAM_MISSING","text"));this.options.text=d.text,d.type||(d.type=["StreetAddress,PositionOfInterest"]),this.options.type=d.type,this.options.territory=d.terr||"",this.options.maximumResponses=d.maximumResponses||10,this.options.protocol==="XHR"&&this.options.httpMethod==="POST"&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}Rt.prototype=Object.create(E.prototype,{}),Rt.prototype.constructor=Rt,Rt.prototype.patchOptionConvertor=function(c){var d=c;return d.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),d.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),d.type||(d.type=d.filterOptions.type)),d.filterOptions.territory&&(this.logger.warn("The parameter 'filterOptions.territory' is deprecated"),d.terr||(d.terr=d.filterOptions.territory)),delete d.filterOptions),d},Rt.prototype.buildRequest=function(c,d){var f="";this.options.territory&&(f=this.options.territory);var x="";this.options.type&&(x=this.options.type.join(",")),this.request=h.normalyzeParameters({text:encodeURIComponent(this.options.text),type:x,terr:f,maximumResponses:this.options.maximumResponses}),this.request?d.call(this,this.request):c.call(this,new v(l.getMessage("SERVICE_REQUEST_BUILD")))},Rt.prototype.analyzeResponse=function(c,d){if(this.response){var f={response:this.response,rawResponse:this.options.rawResponse,onSuccess:d,onError:c,scope:this};Vt.build(f)}else c.call(this,new v(l.getMessage("SERVICE_RESPONSE_EMPTY")))};var ee=Rt;function Dt(c){if(!(this instanceof Dt))throw new TypeError("RouteParamREST constructor cannot be called as a function.");this.logger=a.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=c||{},this.resource=this.options.resource,this.start=this.options.startPoint.x+","+this.options.startPoint.y,this.end=this.options.endPoint.x+","+this.options.endPoint.y,this.intermediates=this.options.viaPoints,this.profile=this.options.graph,this.crs=this.options.srs,this.constraints=this.options.constraints,this.optimization=this.options.routePreference,this.getSteps=this.options.geometryInInstructions?"true":"false",this.distanceUnit=this.options.distanceUnit,this.timeUnit=this.options.timeUnit,this.waysAttributes=this.options.waysAttributes}Dt.CLASSNAME="RouteParamREST",Dt.prototype={constructor:Dt,getIntermediates:function(){var c=[];if(this.intermediates.length!==0)for(var d=0;d<this.intermediates.length;d++){var f=this.intermediates[d];c.push(f.x+","+f.y)}return c.join("|")},getWaysAttributes:function(){return this.waysAttributes.join("|")},getProfile:function(){return this.profile},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getOptimization:function(){return this.optimization?this.optimization:""},getConstraints:function(){var c=[];if(this.constraints.length!==0)for(var d=0;d<this.constraints.length;d++)c.push(JSON.stringify(this.constraints[d]));return c.join("|")}},Dt.prototype.getParams=function(){var c=[];return c.push({k:"resource",v:this.resource}),c.push({k:"start",v:this.start}),c.push({k:"end",v:this.end}),c.push({k:"geometryFormat",v:"geojson"}),this.optimization&&c.push({k:"optimization",v:this.getOptimization()}),this.intermediates&&c.push({k:"intermediates",v:this.getIntermediates()}),this.profile&&c.push({k:"profile",v:this.getProfile()}),this.constraints&&c.push({k:"constraints",v:this.getConstraints()}),this.crs&&c.push({k:"crs",v:this.crs}),this.distanceUnit&&c.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.timeUnit&&c.push({k:"timeUnit",v:this.timeUnit}),this.waysAttributes&&c.push({k:"waysAttributes",v:this.getWaysAttributes()}),c};var Ft=Dt;function Mt(c){if(this.logger=a.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof Mt))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!c)throw new Error(l.getMessage("PARAM_EMPTY","options"));this.settings=c}Mt.prototype={requestString:null,constructor:Mt,processRequestString:function(){this.logger.warn(" PROTOTYPE !");for(var c=new Ft(this.settings).getParams(),d="",f=0;f<c.length;f++){var x=c[f];d&&(d+="&"),d+=x.k+"="+x.v}return this.logger.trace(d),this.requestString=d,this.requestString}};var Xt=Mt,we={build:function(c){a.getLogger("RouteRequestFactory").trace(["RouteRequestFactory::build()"]);var d=c||{},f=!(c.onError===null||typeof c.onError!="function"),x=null,C=new Xt(d);if(!C.processRequestString()){if(x="Error process request (rest) !",f)return void c.onError.call(c.scope,new v(x));throw new Error(x)}return C.requestString}};function Ie(){if(!(this instanceof Ie))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}Ie.prototype={constructor:Ie};var Yi=Ie;function me(){if(!(this instanceof me))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}me.prototype={constructor:me};var Vi=me,Ga={build:function(c){var d=a.getLogger("RouteResponseFactory");d.trace("RouteResponseFactory::build()");var f=null;if(c.response){if(c.rawResponse)d.trace("analyze response : raw"),f=c.response;else{var x;if(d.trace("analyze response : json"),x=typeof c.response=="string"?JSON.parse(c.response):c.response){if(x.message)return void c.onError.call(c.scope,new v(l.getMessage("SERVICE_RESPONSE_EXCEPTION",x.message)));var C=[],P=[],j=[];if((f=new Yi).hasOwnProperty("totalTime")&&(f.totalTime=parseFloat(x.duration)),f.hasOwnProperty("totalDistance")&&(f.totalDistance=parseFloat(x.distance)),f.hasOwnProperty("bbox")&&(f.bbox.left=parseFloat(x.bbox[0]),f.bbox.bottom=parseFloat(x.bbox[1]),f.bbox.right=parseFloat(x.bbox[2]),f.bbox.top=parseFloat(x.bbox[3])),f.hasOwnProperty("routeGeometry")&&!c.geometryInInstructions&&(f.routeGeometry=x.geometry),f.hasOwnProperty("routeInstructions")&&c.geometryInInstructions){var ot,dt=x.portions;if(Array.isArray(dt)&&dt.length)for(ot=0;ot<dt.length;ot++)C.push(dt[ot]);if(C.length)for(ot=0;ot<C.length;ot++)P.push(C[ot].steps);if(P.length)for(ot=0;ot<P.length;ot++)j=j.concat(P[ot]);j.forEach(function(it){switch(f.routeInstructions.push(new Vi),f.routeInstructions[f.routeInstructions.length-1].duration=it.duration,f.routeInstructions[f.routeInstructions.length-1].distance=it.distance,f.routeInstructions[f.routeInstructions.length-1].code="",f.routeInstructions[f.routeInstructions.length-1].instruction="",f.routeInstructions[f.routeInstructions.length-1].geometry=it.geometry,it.name==="Valeur non renseignée"&&(it.name=""),it.instruction.type){case"turn":f.routeInstructions[f.routeInstructions.length-1].instruction+="Tourner";break;case"new name":f.routeInstructions[f.routeInstructions.length-1].instruction+="Continuer tout droit";break;case"depart":f.routeInstructions[f.routeInstructions.length-1].instruction+="Départ";break;case"arrive":f.routeInstructions[f.routeInstructions.length-1].instruction+="Arrivée";break;case"merge":f.routeInstructions[f.routeInstructions.length-1].instruction+="Rejoindre";break;case"ramp":case"on ramp":f.routeInstructions[f.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"off ramp":f.routeInstructions[f.routeInstructions.length-1].instruction+="Prendre la sortie";break;case"fork":f.routeInstructions[f.routeInstructions.length-1].instruction+="Sur la bifurcation, prendre";break;case"end of road":f.routeInstructions[f.routeInstructions.length-1].instruction+="À la fin de la route, prendre";break;case"use lane":f.routeInstructions[f.routeInstructions.length-1].instruction+="Utiliser la file";break;case"continue":f.routeInstructions[f.routeInstructions.length-1].instruction+="Continuer";break;case"roundabout":case"rotary":f.routeInstructions[f.routeInstructions.length-1].instruction+="Au rond-point";break;case"roundabout turn":f.routeInstructions[f.routeInstructions.length-1].instruction+="Au rond point, tourner";break;case"notification":f.routeInstructions[f.routeInstructions.length-1].instruction+="";break;default:f.routeInstructions[f.routeInstructions.length-1].instruction+="?"+it.instruction.type+"?"}if(it.instruction.modifier)switch(it.instruction.modifier){case"uturn":f.routeInstructions[f.routeInstructions.length-1].instruction="Faire demi-tour";break;case"sharp right":f.routeInstructions[f.routeInstructions.length-1].instruction+=" complètement à droite";break;case"right":f.routeInstructions[f.routeInstructions.length-1].instruction+=" à droite";break;case"slight right":f.routeInstructions[f.routeInstructions.length-1].instruction+=" légèrement à droite";break;case"straight":f.routeInstructions[f.routeInstructions.length-1].instruction="Continuer tout droit";break;case"slight left":f.routeInstructions[f.routeInstructions.length-1].instruction+=" lègèrement à gauche";break;case"left":f.routeInstructions[f.routeInstructions.length-1].instruction+=" à gauche";break;case"sharp left":f.routeInstructions[f.routeInstructions.length-1].instruction+=" complètement à gauche";break;default:f.routeInstructions[f.routeInstructions.length-1].instruction+=" ?"+it.instruction.modifier+"?"}it.instruction.exit&&(f.routeInstructions[f.routeInstructions.length-1].instruction+="".concat(it.instruction.exit,"e sortie")),it.attributes.name&&((it.attributes.name.nom_1_droite||it.attributes.name.toponyme)&&(f.routeInstructions[f.routeInstructions.length-1].instruction+=" sur"),it.attributes.name.nom_1_droite&&(f.routeInstructions[f.routeInstructions.length-1].instruction+=" ".concat(it.attributes.name.nom_1_droite)),it.attributes.name.toponyme&&(f.routeInstructions[f.routeInstructions.length-1].instruction+=" ".concat(it.attributes.name.toponyme)))})}}if(!f)return void c.onError.call(c.scope,new v(l.getMessage("SERVICE_RESPONSE_ANALYSE","json")));if(f.exceptionReport)return void c.onError.call(c.scope,new v(l.getMessage("SERVICE_RESPONSE_EXCEPTION_2")))}c.onSuccess.call(c.scope,f)}else c.onError.call(c.scope,new v(l.getMessage("SERVICE_RESPONSE_EMPTY")))}};function ii(c){if(!(this instanceof ii))throw new TypeError(l.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",E.apply(this,arguments),this.logger=a.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!c.startPoint)throw new Error(l.getMessage("PARAM_MISSING","startPoint"));if(c.startPoint.x===null)throw new Error(l.getMessage("PARAM_MISSING","startPoint.x"));if(c.startPoint.y===null)throw new Error(l.getMessage("PARAM_MISSING","startPoint.y"));if(!c.endPoint)throw new Error(l.getMessage("PARAM_MISSING","endPoint"));if(c.endPoint.x===null)throw new Error(l.getMessage("PARAM_MISSING","endPoint.x"));if(c.endPoint.y===null)throw new Error(l.getMessage("PARAM_MISSING","endPoint.y"));if(c.outputFormat&&c.outputFormat!=="json"&&this.logger.warn("options.outputFormat could only be json"),this.options.outputFormat="json",this.options.resource=c.resource||"bdtopo-osrm",this.options.startPoint=c.startPoint,this.options.endPoint=c.endPoint,this.options.viaPoints=c.viaPoints||[],this.options.routePreference=c.routePreference||"fastest",c.graph?(c.graph==="Voiture"&&(this.options.graph="car"),c.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],c.constraints){if(!Array.isArray(c.constraints))throw new Error(l.getMessage("PARAM_TYPE","constraints"));for(var d=0;d<c.constraints.length;d++)this.options.constraints.push(c.constraints[d])}var f={},x={},C={};if(c.exclusions&&c.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var P=0;P<c.exclusions.length;P++)typeof c.exclusions[P]=="string"&&(c.exclusions[P]=c.exclusions[P].toLowerCase(),c.exclusions[P]==="toll"&&(C.constraintType="banned",C.key="wayType",C.operator="=",C.value="autoroute",this.options.constraints.push(C)),c.exclusions[P]==="tunnel"&&(f.constraintType="banned",f.key="wayType",f.operator="=",f.value="tunnel",this.options.constraints.push(f)),c.exclusions[P]==="bridge"&&(x.constraintType="banned",x.key="wayType",x.operator="=",x.value="pont",this.options.constraints.push(x)))}if(this.options.geometryInInstructions=c.geometryInInstructions||!1,this.options.provideBbox=c.provideBbox||!0,this.options.distanceUnit=c.distanceUnit||"m",this.options.timeUnit=c.timeUnit||"second",this.options.expectedStartTime=null,this.options.srs=c.srs||"EPSG:4326",this.options.waysAttributes=c.waysAttributes||[],!this.options.serverUrl){var j=A.Route.newUrl();if(!j)throw new Error("Url by default not found !");this.options.serverUrl=j,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}ii.prototype=Object.create(E.prototype,{}),ii.prototype.constructor=ii,ii.prototype.buildRequest=function(c,d){var f={resource:this.options.resource,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,constraints:this.options.constraints,distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs,waysAttributes:this.options.waysAttributes};this.request=we.build(f),this.request?d.call(this,this.request):c.call(this,new v(l.getMessage("SERVICE_REQUEST_BUILD")))},ii.prototype.analyzeResponse=function(c,d){if(this.response){var f={distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:c,onSuccess:d,scope:this,geometryInInstructions:this.options.geometryInInstructions};Ga.build(f)}else c.call(this,new v(l.getMessage("SERVICE_RESPONSE_EMPTY")))};var Ua=ii;function bi(c){if(!(this instanceof bi))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");this.logger=a.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam ()]"),this.options=c||{},this.id=this.options.id,this.resource=this.options.resource,this.point=this.options.position,this.crs=this.options.srs,this.profile=this.options.graph,this.constraints=this.options.constraints,this.reverse=this.options.reverse,this.timeUnit=this.options.timeUnit,this.distanceUnit=this.options.distanceUnit,this.options.method==="distance"?(this.costType="distance",this.costValue=this.options.distance,this.distanceUnit==="m"&&this.costValue>=5e4&&(this.distanceUnit="km",this.costValue/=1e3)):(this.costType="time",this.costValue=this.options.time)}bi.CLASSNAME="ProcessIsoCurveParam",bi.prototype={constructor:bi,getLocation:function(){return this.point.x+","+this.point.y},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getConstraints:function(){var c=[];if(this.constraints.length!==0)for(var d=0;d<this.constraints.length;d++)c.push(JSON.stringify(this.constraints[d]));return c.join("|")},getDirection:function(){return this.reverse?"arrival":"departure"}},bi.prototype.getParams=function(){var c=[];return c.push({k:"resource",v:this.resource}),c.push({k:"point",v:this.getLocation()}),c.push({k:"direction",v:this.getDirection()}),c.push({k:"costType",v:this.costType}),c.push({k:"costValue",v:this.costValue}),c.push({k:"profile",v:this.profile}),c.push({k:"timeUnit",v:this.timeUnit}),c.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.crs&&c.push({k:"crs",v:this.crs}),this.constraints&&c.push({k:"constraints",v:this.getConstraints()}),c};var qa=bi;function Rn(c){if(this.logger=a.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest ()]"),!(this instanceof Rn))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!c)throw new Error(l.getMessage("PARAM_EMPTY","options"));this.settings=c,this.mode=this.settings.httpMethod||"GET"}Rn.prototype={requestString:null,constructor:Rn,processRequestString:function(){var c="",d=0;switch(this.mode){case"GET":this.logger.trace("Process GET Request");var f=new qa(this.settings).getParams();for(d=0;d<f.length;d++){var x=f[d];c&&(c+="&"),c+=x.k+"="+x.v}break;case"POST":this.logger.trace("Process POST Request");var C={};C.resource=this.settings.resource,C.point=this.settings.position.x+","+this.settings.position.y,this.settings.method==="distance"?(C.costType="distance",C.costValue=this.settings.distance):(C.costType="time",C.costValue=this.settings.time),C.profile=this.settings.graph,this.settings.reverse?C.direction="arrival":C.direction="departure",C.constraints=this.settings.constraints,C.distanceUnit=this.settings.distanceUnit,C.timeUnit=this.settings.timeUnit,C.crs=this.settings.srs,c=JSON.stringify(C);break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(c),this.requestString=c,this.requestString}};var ja=Rn;function Sn(){if(!(this instanceof Sn))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}Sn.prototype={constructor:Sn};var Ls=Sn,Xa={build:function(c){var d=a.getLogger("ProcessIsoCurveResponseFactory");d.trace(["ProcessIsoCurveResponseFactory::build()"]);var f=null;if(c.response){if(c.rawResponse)d.trace("analyze response : raw"),f=c.response;else{var x;if(d.trace("analyze response : json"),x=typeof c.response=="string"?JSON.parse(c.response):c.response,f=new Ls,!x)return void c.onError.call(c.scope,new v(l.getMessage("SERVICE_RESPONSE_ANALYSE",c.response)));x.costType==="distance"?(f.time="",f.distance=x.costValue):(f.time=x.costValue,f.distance=""),f.message="",f.id="",f.srs=x.crs,f.geometry=x.geometry;var C=x.point.split(",");if(f.location&&(f.location.x=C[0],f.location.y=C[1]),f.exceptionReport)return void c.onError.call(c.scope,new v({message:l.getMessage("SERVICE_RESPONSE_EXCEPTION",f.exceptionReport),type:v.TYPE_SRVERR,status:200}))}c.onSuccess.call(c.scope,f)}else c.onError.call(c.scope,new v(l.getMessage("SERVICE_RESPONSE_EMPTY")))}};function ni(c){if(!(this instanceof ni))throw new TypeError(l.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",E.apply(this,arguments),this.logger=a.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve (options)]"),!c.position)throw new Error(l.getMessage("PARAM_MISSING","position"));if(c.position.x===null)throw new Error(l.getMessage("PARAM_MISSING","position.x"));if(c.position.y===null)throw new Error(l.getMessage("PARAM_MISSING","position.y"));if(!c.time&&!c.distance)throw new Error("Parameter (s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!c.time&&c.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),c.time&&!c.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",this.options.resource=c.resource||"bdtopo-valhalla",this.options.exclusions=c.exclusions||[],this.options.reverse=c.reverse||!1,this.options.srs=c.srs||"EPSG:4326",this.options.distanceUnit=c.distanceUnit||"m",this.options.timeUnit=c.timeUnit||"second",c.smoothing&&this.logger.warn("options.smoothing is DEPRECATED"),this.options.smoothing=!1,c.holes&&this.logger.warn("options.holes is DEPRECATED"),this.options.holes=!1,c.graph?(c.graph==="Voiture"&&(this.options.graph="car"),c.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],c.constraints){if(!Array.isArray(c.constraints))throw new Error(l.getMessage("PARAM_TYPE","constraints"));for(var d=0;d<c.constraints.length;d++)this.options.constraints.push(c.constraints[d])}var f={},x={},C={};if(c.exclusions&&c.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var P=0;P<c.exclusions.length;P++)typeof c.exclusions[P]=="string"&&(c.exclusions[P]=c.exclusions[P].toLowerCase(),c.exclusions[P]==="toll"&&(C.constraintType="banned",C.key="wayType",C.operator="=",C.value="autoroute",this.options.constraints.push(C)),c.exclusions[P]==="tunnel"&&(f.constraintType="banned",f.key="wayType",f.operator="=",f.value="tunnel",this.options.constraints.push(f)),c.exclusions[P]==="bridge"&&(x.constraintType="banned",x.key="wayType",x.operator="=",x.value="pont",this.options.constraints.push(x)))}if(this.options.outputFormat=typeof c.outputFormat=="string"?c.outputFormat.toLowerCase():"json",c.outputFormat&&c.outputFormat!=="json")throw new Error(l.getMessage("PARAM_NOT_SUPPORT","outputFormat"));if(this.options.outputFormat="json",!this.options.serverUrl){var j=A.ProcessIsoCurve.newUrl();if(!j)throw new Error("Url by default not found !");this.options.serverUrl=j,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}ni.prototype=Object.create(E.prototype,{}),ni.prototype.constructor=ni,ni.prototype.buildRequest=function(c,d){try{var f=new ja(this.options);if(!f.processRequestString())throw new Error(l.getMessage("SERVICE_REQUEST_BUILD"));this.request=f.requestString}catch(x){return void c.call(this,new v(x.message))}d.call(this,this.request)},ni.prototype.analyzeResponse=function(c,d){if(this.response){var f={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:d,onError:c,scope:this};Xa.build(f)}else c.call(this,new v(l.getMessage("SERVICE_RESPONSE_EMPTY")))};var za=ni,Ya={getConfig:function(c){new U(c).call()},getAltitude:function(c){new Zt(c).call()},geocode:function(c){new y(c).call()},reverseGeocode:function(c){new $(c).call()},autoComplete:function(c){new ee(c).call()},route:function(c){new Ua(c).call()},isoCurve:function(c){new za(c).call()}},Ms=O.version,Ps=O.date,Wt={};Wt.servicesVersion=Ms,Wt.servicesDate=Ps,Wt.Protocols={},Wt.Protocols.XHR=w,Wt.Services=Ya,Wt.Services.DefaultUrl=A,Wt.Services.AltiResponse=yt,Wt.Services.Alti={},Wt.Services.Alti.Elevation=It,Wt.Services.AutoCompleteResponse=at,Wt.Services.AutoComplete={},Wt.Services.AutoComplete.SuggestedLocation=Tt,Wt.Services.Config=U,Wt.Services.IsoCurveResponse=Ls,Wt.Services.RouteResponse=Yi,Wt.Services.Route={},Wt.Services.Route.RouteInstruction=Vi,Wt.Error=v,Wt.Helper=h,n.default=Wt}]).default})})(Do);var es=Do.exports;const Dr=(r,t,e,i=!1)=>{const n=[];return window.$barry.calculateToll||n.push("toll"),new Promise(s=>{es.Services.route({startPoint:{x:r[0],y:r[1]},endPoint:{x:t[0],y:t[1]},graph:window.$barry.calculateTransport,exclusions:n,routePreference:window.$barry.calculateMode=="time"?"fastest":"shortest",geometryInInstructions:i,apiKey:"calcul",onSuccess:o=>{o.key=e,s(o)},onFailure:o=>{alert(o)}})})},$t={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ft(){throw new Error("Unimplemented abstract method.")}let el=0;function xt(r){return r.ol_uid||(r.ol_uid=String(++el))}function ks(r){return r[0]>0&&r[1]>0}function il(r,t,e){return e===void 0&&(e=[0,0]),e[0]=r[0]*t+.5|0,e[1]=r[1]*t+.5|0,e}function le(r,t){return Array.isArray(r)?r:(t===void 0?t=[r,r]:(t[0]=r,t[1]=r),t)}class nr{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=le(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new nr({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ft()}getImage(t){return ft()}getHitDetectionImage(){return ft()}getPixelRatio(t){return 1}getImageState(){return ft()}getImageSize(){return ft()}getOrigin(){return ft()}getSize(){return ft()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=le(t)}listenImageChange(t){ft()}load(){ft()}unlistenImageChange(t){ft()}}function Bt(r,t,e){return Math.min(Math.max(r,t),e)}function nl(r,t,e,i,n,s){const o=n-e,a=s-i;if(o!==0||a!==0){const l=((r-e)*o+(t-i)*a)/(o*o+a*a);l>1?(e=n,i=s):l>0&&(e+=o*l,i+=a*l)}return di(r,t,e,i)}function di(r,t,e,i){const n=e-r,s=i-t;return n*n+s*s}function rl(r){const t=r.length;for(let i=0;i<t;i++){let n=i,s=Math.abs(r[i][i]);for(let a=i+1;a<t;a++){const l=Math.abs(r[a][i]);l>s&&(s=l,n=a)}if(s===0)return null;const o=r[n];r[n]=r[i],r[i]=o;for(let a=i+1;a<t;a++){const l=-r[a][i]/r[i][i];for(let h=i;h<t+1;h++)i==h?r[a][h]=0:r[a][h]+=l*r[i][h]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=r[i][t]/r[i][i];for(let n=i-1;n>=0;n--)r[n][t]-=r[n][i]*e[i]}return e}function Un(r){return r*Math.PI/180}function Ni(r,t){const e=r%t;return e*t<0?e+t:e}function Pe(r,t,e){return r+e*(t-r)}function ko(r,t){const e=Math.pow(10,t);return Math.round(r*e)/e}function Tn(r,t){return Math.floor(ko(r,t))}function In(r,t){return Math.ceil(ko(r,t))}const sl=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,ol=/^([a-z]*)$|^hsla?\(.*\)$/i;function Fo(r){return typeof r=="string"?r:Go(r)}function al(r){const t=document.createElement("div");if(t.style.color=r,t.style.color!==""){document.body.appendChild(t);const e=getComputedStyle(t).color;return document.body.removeChild(t),e}else return""}const ll=function(){const t={};let e=0;return function(i){let n;if(t.hasOwnProperty(i))n=t[i];else{if(e>=1024){let s=0;for(const o in t)s++&3||(delete t[o],--e)}n=cl(i),t[i]=n,++e}return n}}();function qn(r){return Array.isArray(r)?r:ll(r)}function cl(r){let t,e,i,n,s;if(ol.exec(r)&&(r=al(r)),sl.exec(r)){const o=r.length-1;let a;o<=4?a=1:a=2;const l=o===4||o===8;t=parseInt(r.substr(1+0*a,a),16),e=parseInt(r.substr(1+1*a,a),16),i=parseInt(r.substr(1+2*a,a),16),l?n=parseInt(r.substr(1+3*a,a),16):n=255,a==1&&(t=(t<<4)+t,e=(e<<4)+e,i=(i<<4)+i,l&&(n=(n<<4)+n)),s=[t,e,i,n/255]}else r.startsWith("rgba(")?(s=r.slice(5,-1).split(",").map(Number),Fs(s)):r.startsWith("rgb(")?(s=r.slice(4,-1).split(",").map(Number),s.push(1),Fs(s)):wt(!1,14);return s}function Fs(r){return r[0]=Bt(r[0]+.5|0,0,255),r[1]=Bt(r[1]+.5|0,0,255),r[2]=Bt(r[2]+.5|0,0,255),r[3]=Bt(r[3],0,1),r}function Go(r){let t=r[0];t!=(t|0)&&(t=t+.5|0);let e=r[1];e!=(e|0)&&(e=e+.5|0);let i=r[2];i!=(i|0)&&(i=i+.5|0);const n=r[3]===void 0?1:Math.round(r[3]*100)/100;return"rgba("+t+","+e+","+i+","+n+")"}function ve(r){return Array.isArray(r)?Go(r):r}const Je=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",hl=Je.includes("firefox"),ul=Je.includes("safari")&&!Je.includes("chrom");ul&&(Je.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Je));const dl=Je.includes("webkit")&&!Je.includes("edge"),fl=Je.includes("macintosh"),Uo=typeof devicePixelRatio<"u"?devicePixelRatio:1,is=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,gl=typeof Image<"u"&&Image.prototype.decode,qo=function(){let r=!1;try{const t=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return r}();function ce(r,t,e,i){let n;return e&&e.length?n=e.shift():is?n=new OffscreenCanvas(r||300,t||300):n=document.createElement("canvas"),r&&(n.width=r),t&&(n.height=t),n.getContext("2d",i)}function jo(r){const t=r.canvas;t.width=1,t.height=1,r.clearRect(0,0,1,1)}function Gs(r,t){const e=t.parentNode;e&&e.replaceChild(r,t)}function kr(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function pl(r){for(;r.lastChild;)r.removeChild(r.lastChild)}function ml(r,t){const e=r.childNodes;for(let i=0;;++i){const n=e[i],s=t[i];if(!n&&!s)break;if(n!==s){if(!n){r.appendChild(s);continue}if(!s){r.removeChild(n),--i;continue}r.insertBefore(s,n)}}}class ke{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Fi={PROPERTYCHANGE:"propertychange"};class ns{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function _l(r,t,e){let i,n;e=e||pi;let s=0,o=r.length,a=!1;for(;s<o;)i=s+(o-s>>1),n=+e(r[i],t),n<0?s=i+1:(o=i,a=!n);return a?s:~s}function pi(r,t){return r>t?1:r<t?-1:0}function rs(r,t,e){const i=r.length;if(r[0]<=t)return 0;if(t<=r[i-1])return i-1;{let n;if(e>0){for(n=1;n<i;++n)if(r[n]<t)return n-1}else if(e<0){for(n=1;n<i;++n)if(r[n]<=t)return n}else for(n=1;n<i;++n){if(r[n]==t)return n;if(r[n]<t)return typeof e=="function"?e(t,r[n-1],r[n])>0?n-1:n:r[n-1]-t<t-r[n]?n-1:n}return i-1}}function yl(r,t,e){for(;t<e;){const i=r[t];r[t]=r[e],r[e]=i,++t,--e}}function Ne(r,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let n=0;n<i;n++)r[r.length]=e[n]}function Ei(r,t){const e=r.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(r[i]!==t[i])return!1;return!0}function wl(r,t,e){const i=t||pi;return r.every(function(n,s){if(s===0)return!0;const o=i(r[s-1],n);return!(o>0||o===0)})}function tn(){return!0}function rr(){return!1}function mi(){}function El(r){let t=!1,e,i,n;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==n||!Ei(s,i))&&(t=!0,n=this,i=s,e=r.apply(this,arguments)),e}}function pn(r){for(const t in r)delete r[t]}function Gi(r){let t;for(t in r)return!1;return!t}class sr extends ns{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),n=i[t]||(i[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const s=e?new ke(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,u=n.length;h<u;++h)if("handleEvent"in n[h]?l=n[h].handleEvent(s):l=n[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,mi);delete o[i]}return l}disposeInternal(){this.listeners_&&pn(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){const i=this.listeners_&&this.listeners_[t];if(i){const n=i.indexOf(e);n!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[n]=mi,++this.pendingRemovals_[t]):(i.splice(n,1),i.length===0&&delete this.listeners_[t]))}}}const pt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function Et(r,t,e,i,n){if(i&&i!==r&&(e=e.bind(i)),n){const o=e;e=function(){r.removeEventListener(t,e),o.apply(this,arguments)}}const s={target:r,type:t,listener:e};return r.addEventListener(t,e),s}function jn(r,t,e,i){return Et(r,t,e,i,!0)}function Nt(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),pn(r))}class mn extends sr{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(pt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=Et(this,t[s],e);return n}else return Et(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const n=t.length;i=new Array(n);for(let s=0;s<n;++s)i[s]=jn(this,t[s],e)}else i=jn(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)vl(i);else if(Array.isArray(t))for(let n=0,s=t.length;n<s;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}}mn.prototype.on;mn.prototype.once;mn.prototype.un;function vl(r){if(Array.isArray(r))for(let t=0,e=r.length;t<e;++t)Nt(r[t]);else Nt(r)}class Us extends ke{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class Ce extends mn{constructor(t){super(),this.on,this.once,this.un,xt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new Us(i,t,e)),i=Fi.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new Us(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const n=this.values_||(this.values_={});if(i)n[t]=e;else{const s=n[t];n[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Gi(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}const An="ol-hidden",or="ol-unselectable",ss="ol-control",qs="ol-collapsed",xl=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),js=["style","variant","weight","size","lineHeight","family"],Xo=function(r){const t=r.match(xl);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,n=js.length;i<n;++i){const s=t[i+1];s!==void 0&&(e[js[i]]=s)}return e.families=e.family.split(/,\s?/),e},zo="10px sans-serif",De="#000",Xn="round",en=[],nn=0,Ui="round",rn=10,sn="#000",on="center",zn="middle",li=[0,0,0,0],an=1,Le=new Ce;let Ii=null,Fr;const Gr={},bl=function(){const t="32px ",e=["monospace","serif"],i=e.length,n="wmytzilWMYTZIL@#/&?$%10";let s,o;function a(h,u,g){let p=!0;for(let _=0;_<i;++_){const w=e[_];if(o=Yn(h+" "+u+" "+t+w,n),g!=w){const R=Yn(h+" "+u+" "+t+g+","+w,n);p=p&&R!=o}}return!!p}function l(){let h=!0;const u=Le.getKeys();for(let g=0,p=u.length;g<p;++g){const _=u[g];Le.get(_)<100&&(a.apply(this,_.split(`
`))?(pn(Gr),Ii=null,Fr=void 0,Le.set(_,100)):(Le.set(_,Le.get(_)+1,!0),h=!1))}h&&(clearInterval(s),s=void 0)}return function(h){const u=Xo(h);if(!u)return;const g=u.families;for(let p=0,_=g.length;p<_;++p){const w=g[p],R=u.style+`
`+u.weight+`
`+w;Le.get(R)===void 0&&(Le.set(R,100,!0),a(u.style,u.weight,w)||(Le.set(R,0,!0),s===void 0&&(s=setInterval(l,32))))}}}(),Rl=function(){let r;return function(t){let e=Gr[t];if(e==null){if(is){const i=Xo(t),n=Yo(t,"Žg");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else r||(r=document.createElement("div"),r.innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=t,document.body.appendChild(r),e=r.offsetHeight,document.body.removeChild(r);Gr[t]=e}return e}}();function Yo(r,t){return Ii||(Ii=ce(1,1)),r!=Fr&&(Ii.font=r,Fr=Ii.font),Ii.measureText(t)}function Yn(r,t){return Yo(r,t).width}function Xs(r,t,e){if(t in e)return e[t];const i=t.split(`
`).reduce((n,s)=>Math.max(n,Yn(r,s)),0);return e[t]=i,i}function Sl(r,t){const e=[],i=[],n=[];let s=0,o=0,a=0,l=0;for(let h=0,u=t.length;h<=u;h+=2){const g=t[h];if(g===`
`||h===u){s=Math.max(s,o),n.push(o),o=0,a+=l;continue}const p=t[h+1]||r.font,_=Yn(p,g);e.push(_),o+=_;const w=Rl(p);i.push(w),l=Math.max(l,w)}return{width:s,height:a,widths:e,heights:i,lineWidths:n}}function Cl(r,t,e,i,n,s,o,a,l,h,u){r.save(),e!==1&&(r.globalAlpha*=e),t&&r.setTransform.apply(r,t),i.contextInstructions?(r.translate(l,h),r.scale(u[0],u[1]),Tl(i,r)):u[0]<0||u[1]<0?(r.translate(l,h),r.scale(u[0],u[1]),r.drawImage(i,n,s,o,a,0,0,o,a)):r.drawImage(i,n,s,o,a,l,h,o*u[0],a*u[1]),r.restore()}function Tl(r,t){const e=r.contextInstructions;for(let i=0,n=e.length;i<n;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}class ar extends nr{constructor(t){const e=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:1,rotateWithView:e,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius!==void 0?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new ar({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,n=ce(i.size*t,i.size*t);this.draw_(i,n,t),e=n.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return $t.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let n=this.radius_,s=this.radius2_===void 0?n:this.radius2_;if(n<s){const I=n;n=s,s=I}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),h=Math.sqrt(s*s-l*l),u=n-h,g=Math.sqrt(l*l+u*u),p=g/l;if(t==="miter"&&p<=i)return p*e;const _=e/2/p,w=e/2*(u/g),S=Math.sqrt((n+_)*(n+_)+w*w)-n;if(this.radius2_===void 0||t==="bevel")return S*2;const T=n*Math.sin(a),v=Math.sqrt(n*n-T*T),O=s-v,E=Math.sqrt(T*T+O*O)/T;if(E<=i){const I=E*e/2-s-n;return 2*Math.max(S,I)}return S*2}createRenderOptions(){let t=Ui,e=0,i=null,n=0,s,o=0;this.stroke_&&(s=this.stroke_.getColor(),s===null&&(s=sn),s=ve(s),o=this.stroke_.getWidth(),o===void 0&&(o=an),i=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=Ui),e=this.stroke_.getMiterLimit(),e===void 0&&(e=rn));const a=this.calculateLineJoinSize_(t,o,e),l=Math.max(this.radius_,this.radius2_||0),h=Math.ceil(2*l+a);return{strokeStyle:s,strokeWidth:o,size:h,lineDash:i,lineDashOffset:n,lineJoin:t,miterLimit:e}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let n=this.fill_.getColor();n===null&&(n=De),e.fillStyle=ve(n),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if(typeof e=="string"&&(e=qn(e)),e===null?i=1:Array.isArray(e)&&(i=e.length===4?e[3]:1),i===0){const n=ce(t.size,t.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(t,n)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const n=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=s+a*o,h=a%2===0?i:n;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=De,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}class _n extends ar{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new _n({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}class ji{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null}clone(){const t=this.getColor();return new ji({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}class Il{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];!(t++&3)&&!i.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,i){const n=zs(t,e,i);return n in this.cache_?this.cache_[n]:null}set(t,e,i,n){const s=zs(t,e,i);this.cache_[s]=n,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function zs(r,t,e){const i=e?Fo(e):"null";return t+":"+r+":"+i}const Vn=new Il;function Vo(r,t,e){const i=r;let n=!0,s=!1,o=!1;const a=[jn(i,pt.LOAD,function(){o=!0,s||t()})];return i.src&&gl?(s=!0,i.decode().then(function(){n&&t()}).catch(function(l){n&&(o?t():e())})):a.push(jn(i,pt.ERROR,e)),function(){n=!1,a.forEach(Nt)}}let Wi=null;class Al extends sr{constructor(t,e,i,n,s,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=s,this.size_=i,this.src_=e,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===$t.LOADED){Wi||(Wi=ce(1,1)),Wi.drawImage(this.image_,0,0);try{Wi.getImageData(0,0,1,1),this.tainted_=!1}catch{Wi=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(pt.CHANGE)}handleImageError_(){this.imageState_=$t.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=$t.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=ce(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===$t.IDLE){this.image_||this.initializeImage_(),this.imageState_=$t.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=Vo(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==$t.LOADED)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const n=i.getContext("2d");n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=Fo(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Ol(r,t,e,i,n,s){let o=Vn.get(t,i,s);return o||(o=new Al(r,t,e,i,n,s),Vn.set(t,i,s,o)),o}class lr extends nr{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,n=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:n,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;this.imgSize_=t.imgSize;let a=t.src;wt(!(a!==void 0&&o),4),wt(!o||o&&this.imgSize_,5),(a===void 0||a.length===0)&&o&&(a=o.src||xt(o)),wt(a!==void 0&&a.length>0,6);const l=t.src!==void 0?$t.IDLE:$t.LOADED;this.color_=t.color!==void 0?qn(t.color):null,this.iconImage_=Ol(o,a,this.imgSize_!==void 0?this.imgSize_:null,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null}clone(){const t=this.getScale();return new lr({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=n[0]),this.anchorYUnits_=="fraction"&&(t[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+n[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}listenImageChange(t){this.iconImage_.addEventListener(pt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(pt.CHANGE,t)}}class yn{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new yn({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class Qe{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Ys,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new Qe({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Ys,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Ll(r){let t;if(typeof r=="function")t=r;else{let e;Array.isArray(r)?e=r:(wt(typeof r.getZIndex=="function",41),e=[r]),t=function(){return e}}return t}let mr=null;function Ml(r,t){if(!mr){const e=new ji({color:"rgba(255,255,255,0.4)"}),i=new yn({color:"#3399CC",width:1.25});mr=[new Qe({image:new _n({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return mr}function Ys(r){return r.getGeometry()}const Pl="#333";class os{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=le(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new ji({color:Pl}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding}clone(){const t=this.getScale();return new os({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=le(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}new Array(6);function be(){return[1,0,0,1,0,0]}function Nl(r,t,e,i,n,s,o){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r[4]=s,r[5]=o,r}function Dl(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function Kt(r,t){const e=t[0],i=t[1];return t[0]=r[0]*e+r[2]*i+r[4],t[1]=r[1]*e+r[3]*i+r[5],t}function kl(r,t,e){return Nl(r,t,0,0,e,0,0)}function ti(r,t,e,i,n,s,o,a){const l=Math.sin(s),h=Math.cos(s);return r[0]=i*h,r[1]=n*l,r[2]=-i*l,r[3]=n*h,r[4]=o*i*h-a*i*l+t,r[5]=o*n*l+a*n*h+e,r}function as(r,t){const e=Fl(t);wt(e!==0,32);const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return r[0]=o/e,r[1]=-n/e,r[2]=-s/e,r[3]=i/e,r[4]=(s*l-o*a)/e,r[5]=-(i*l-n*a)/e,r}function Fl(r){return r[0]*r[3]-r[1]*r[2]}let Vs;function Wo(r){const t="matrix("+r.join(", ")+")";if(is)return t;const e=Vs||(Vs=document.createElement("div"));return e.style.transform=t,e.style.transform}const ln={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Bo{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||ln[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const wn=6378137,Pi=Math.PI*wn,Gl=[-Pi,-Pi,Pi,Pi],Ul=[-180,-85,180,85],On=wn*Math.log(Math.tan(Math.PI/2));class Ri extends Bo{constructor(t){super({code:t,units:"m",extent:Gl,global:!0,worldExtent:Ul,getPointResolution:function(e,i){return e/Math.cosh(i[1]/wn)}})}}const Ws=[new Ri("EPSG:3857"),new Ri("EPSG:102100"),new Ri("EPSG:102113"),new Ri("EPSG:900913"),new Ri("http://www.opengis.net/def/crs/EPSG/0/3857"),new Ri("http://www.opengis.net/gml/srs/epsg.xml#3857")];function ql(r,t,e){const i=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(i));for(let n=0;n<i;n+=e){t[n]=Pi*r[n]/180;let s=wn*Math.log(Math.tan(Math.PI*(+r[n+1]+90)/360));s>On?s=On:s<-On&&(s=-On),t[n+1]=s}return t}function jl(r,t,e){const i=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(i));for(let n=0;n<i;n+=e)t[n]=180*r[n]/Pi,t[n+1]=360*Math.atan(Math.exp(r[n+1]/wn))/Math.PI-90;return t}const Xl=6378137,Bs=[-180,-90,180,90],zl=Math.PI*Xl/180;class ri extends Bo{constructor(t,e){super({code:t,units:"degrees",extent:Bs,axisOrientation:e,global:!0,metersPerUnit:zl,worldExtent:Bs})}}const $s=[new ri("CRS:84"),new ri("EPSG:4326","neu"),new ri("urn:ogc:def:crs:OGC:1.3:CRS84"),new ri("urn:ogc:def:crs:OGC:2:84"),new ri("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ri("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ri("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Ur={};function Yl(r){return Ur[r]||Ur[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Vl(r,t){Ur[r]=t}let Di={};function Wn(r,t,e){const i=r.getCode(),n=t.getCode();i in Di||(Di[i]={}),Di[i][n]=e}function Wl(r,t){let e;return r in Di&&t in Di[r]&&(e=Di[r][t]),e}function Bl(r,t){return r[0]+=+t[0],r[1]+=+t[1],r}function Bn(r,t){let e=!0;for(let i=r.length-1;i>=0;--i)if(r[i]!=t[i]){e=!1;break}return e}function ls(r,t){const e=Math.cos(t),i=Math.sin(t),n=r[0]*e-r[1]*i,s=r[1]*e+r[0]*i;return r[0]=n,r[1]=s,r}function $l(r,t){return r[0]*=t,r[1]*=t,r}function $o(r,t){if(t.canWrapX()){const e=Pt(t.getExtent()),i=Hl(r,t,e);i&&(r[0]-=i*e)}return r}function Hl(r,t,e){const i=t.getExtent();let n=0;return t.canWrapX()&&(r[0]<i[0]||r[0]>i[2])&&(e=e||Pt(i),n=Math.floor((r[0]-i[0])/e)),n}const Kl=63710088e-1;function Hs(r,t,e){e=e||Kl;const i=Un(r[1]),n=Un(t[1]),s=(n-i)/2,o=Un(t[0]-r[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(n);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}let qr=!0;function Zl(r){qr=!1}function cs(r,t,e){if(t!==void 0){for(let i=0,n=r.length;i<n;++i)t[i]=r[i];t=t}else t=r.slice();return t}function Ho(r,t,e){if(t!==void 0&&r!==t){for(let i=0,n=r.length;i<n;++i)t[i]=r[i];r=t}return r}function Jl(r){Vl(r.getCode(),r),Wn(r,r,cs)}function Ql(r){r.forEach(Jl)}function zt(r){return typeof r=="string"?Yl(r):r||null}function Ks(r,t,e,i){r=zt(r);let n;const s=r.getPointResolutionFunc();if(s)n=s(t,e);else{const o=r.getUnits();if(o=="degrees"&&!i||i=="degrees")n=t;else{const a=cr(r,zt("EPSG:4326"));if(a===Ho&&o!=="degrees")n=t*r.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const u=Hs(h.slice(0,2),h.slice(2,4)),g=Hs(h.slice(4,6),h.slice(6,8));n=(u+g)/2}const l=r.getMetersPerUnit();l!==void 0&&(n/=l)}}return n}function Zs(r){Ql(r),r.forEach(function(t){r.forEach(function(e){t!==e&&Wn(t,e,cs)})})}function tc(r,t,e,i){r.forEach(function(n){t.forEach(function(s){Wn(n,s,e),Wn(s,n,i)})})}function hs(r,t){return r?typeof r=="string"?zt(r):r:zt(t)}function ai(r,t){if(r===t)return!0;const e=r.getUnits()===t.getUnits();return(r.getCode()===t.getCode()||cr(r,t)===cs)&&e}function cr(r,t){const e=r.getCode(),i=t.getCode();let n=Wl(e,i);return n||(n=Ho),n}function cn(r,t){const e=zt(r),i=zt(t);return cr(e,i)}function us(r,t,e){return cn(t,e)(r,void 0,r.length)}function Ko(r,t,e,i){const n=cn(t,e);return Ja(r,n,void 0)}let pe=null;function ec(r){pe=zt(r)}function Zo(){return pe}function ic(){ec("EPSG:4326")}function jr(r,t){return pe?us(r,t,pe):r}function Me(r,t){return pe?us(r,pe,t):(qr&&!Bn(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&(qr=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r)}function Xr(r,t){return pe?Ko(r,t,pe):r}function ci(r,t){return pe?Ko(r,pe,t):r}function nc(r,t){if(!pe)return r;const e=zt(t).getUnits(),i=pe.getUnits();return e&&i?r*ln[e]/ln[i]:r}function rc(){Zs(Ws),Zs($s),tc($s,Ws,ql,jl)}rc();function fi(r,t,e,i,n,s){s=s||[];let o=0;for(let a=t;a<e;a+=i){const l=r[a],h=r[a+1];s[o++]=n[0]*l+n[2]*h+n[4],s[o++]=n[1]*l+n[3]*h+n[5]}return s&&s.length!=o&&(s.length=o),s}function Jo(r,t,e,i,n,s,o){o=o||[];const a=Math.cos(n),l=Math.sin(n),h=s[0],u=s[1];let g=0;for(let p=t;p<e;p+=i){const _=r[p]-h,w=r[p+1]-u;o[g++]=h+_*a-w*l,o[g++]=u+_*l+w*a;for(let R=p+2;R<p+i;++R)o[g++]=r[R]}return o&&o.length!=g&&(o.length=g),o}function sc(r,t,e,i,n,s,o,a){a=a||[];const l=o[0],h=o[1];let u=0;for(let g=t;g<e;g+=i){const p=r[g]-l,_=r[g+1]-h;a[u++]=l+n*p,a[u++]=h+s*_;for(let w=g+2;w<g+i;++w)a[u++]=r[w]}return a&&a.length!=u&&(a.length=u),a}function oc(r,t,e,i,n,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=i){o[a++]=r[l]+n,o[a++]=r[l+1]+s;for(let h=l+2;h<l+i;++h)o[a++]=r[h]}return o&&o.length!=a&&(o.length=a),o}const Js=be();class Qo extends Ce{constructor(){super(),this.extent_=ge(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=El(function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return ft()}closestPointXY(t,e,i,n){return ft()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return ft()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&gn(e),this.extentRevision_=this.getRevision()}return Ka(this.extent_,t)}rotate(t,e){ft()}scale(t,e,i){ft()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return ft()}getType(){return ft()}applyTransform(t){ft()}intersectsExtent(t){return ft()}translate(t,e){ft()}transform(t,e){const i=zt(t),n=i.getUnits()=="tile-pixels"?function(s,o,a){const l=i.getExtent(),h=i.getWorldExtent(),u=Se(h)/Se(l);return ti(Js,h[0],h[3],u,-u,0,0,0),fi(s,0,s.length,a,Js,o),cn(i,e)(s,o,a)}:cn(i,e);return this.applyTransform(n),this}}class vi extends Qo{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return Oo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return ft()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=Qs(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){ft()}setLayout(t,e,i){let n;if(t)n=Qs(t);else{for(let s=0;s<i;++s)if(e.length===0){this.layout="XY",this.stride=2;return}else e=e[0];n=e.length,t=ac(n)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();Jo(i,0,i.length,n,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=gi(this.getExtent()));const n=this.getFlatCoordinates();if(n){const s=this.getStride();sc(n,0,n.length,s,t,e,i,n),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();oc(i,0,i.length,n,t,e,i),this.changed()}}}function ac(r){let t;return r==2?t="XY":r==3?t="XYZ":r==4&&(t="XYZM"),t}function Qs(r){let t;return r=="XY"?t=2:r=="XYZ"||r=="XYM"?t=3:r=="XYZM"&&(t=4),t}function lc(r,t,e){const i=r.getFlatCoordinates();if(i){const n=r.getStride();return fi(i,0,i.length,n,t,e)}else return null}function cc(r,t,e,i){for(let n=0,s=e.length;n<s;++n)r[t++]=e[n];return t}function hr(r,t,e,i){for(let n=0,s=e.length;n<s;++n){const o=e[n];for(let a=0;a<i;++a)r[t++]=o[a]}return t}function ds(r,t,e,i,n){n=n||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=hr(r,t,e[o],i);n[s++]=l,t=l}return n.length=s,n}function hc(r,t,e,i,n){n=n||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=ds(r,t,e[o],i,n[s]);l.length===0&&(l[0]=t),n[s++]=l,t=l[l.length-1]}return n.length=s,n}class $n extends Qo{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Nt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(Et(this.geometries_[t],pt.CHANGE,this.changed,this))}clone(){const t=new $n(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<yi(this.getExtent(),t,e))return n;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)n=s[o].closestPointXY(t,e,i,n);return n}containsXY(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)if(i[n].containsXY(t,e))return!0;return!1}computeExtent(t){gn(t);const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)Lo(t,e[i].getExtent());return t}getGeometries(){return to(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let n=!1;for(let s=0,o=i.length;s<o;++s){const a=i[s],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(n=!0)}if(n){const s=new $n(null);return s.setGeometriesArray(e),s}else return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].rotate(t,e);this.changed()}scale(t,e,i){i||(i=gi(this.getExtent()));const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(to(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function to(r){const t=[];for(let e=0,i=r.length;e<i;++e)t.push(r[e].clone());return t}function eo(r,t,e,i,n,s,o){const a=r[t],l=r[t+1],h=r[e]-a,u=r[e+1]-l;let g;if(h===0&&u===0)g=t;else{const p=((n-a)*h+(s-l)*u)/(h*h+u*u);if(p>1)g=e;else if(p>0){for(let _=0;_<i;++_)o[_]=Pe(r[t+_],r[e+_],p);o.length=i;return}else g=t}for(let p=0;p<i;++p)o[p]=r[g+p];o.length=i}function fs(r,t,e,i,n){let s=r[t],o=r[t+1];for(t+=i;t<e;t+=i){const a=r[t],l=r[t+1],h=di(s,o,a,l);h>n&&(n=h),s=a,o=l}return n}function gs(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s){const a=e[s];n=fs(r,t,a,i,n),t=a}return n}function uc(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s){const a=e[s];n=gs(r,t,a,i,n),t=a[a.length-1]}return n}function ps(r,t,e,i,n,s,o,a,l,h,u){if(t==e)return h;let g,p;if(n===0)if(p=di(o,a,r[t],r[t+1]),p<h){for(g=0;g<i;++g)l[g]=r[t+g];return l.length=i,p}else return h;u=u||[NaN,NaN];let _=t+i;for(;_<e;)if(eo(r,_-i,_,i,o,a,u),p=di(o,a,u[0],u[1]),p<h){for(h=p,g=0;g<i;++g)l[g]=u[g];l.length=i,_+=i}else _+=i*Math.max((Math.sqrt(p)-Math.sqrt(h))/n|0,1);if(s&&(eo(r,e-i,t,i,o,a,u),p=di(o,a,u[0],u[1]),p<h)){for(h=p,g=0;g<i;++g)l[g]=u[g];l.length=i}return h}function ms(r,t,e,i,n,s,o,a,l,h,u){u=u||[NaN,NaN];for(let g=0,p=e.length;g<p;++g){const _=e[g];h=ps(r,t,_,i,n,s,o,a,l,h,u),t=_}return h}function dc(r,t,e,i,n,s,o,a,l,h,u){u=u||[NaN,NaN];for(let g=0,p=e.length;g<p;++g){const _=e[g];h=ms(r,t,_,i,n,s,o,a,l,h,u),t=_[_.length-1]}return h}function _s(r,t,e,i,n,s,o){const a=(e-t)/i;if(a<3){for(;t<e;t+=i)s[o++]=r[t],s[o++]=r[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-i];let u=0;for(;h.length>0;){const g=h.pop(),p=h.pop();let _=0;const w=r[p],R=r[p+1],S=r[g],T=r[g+1];for(let v=p+i;v<g;v+=i){const O=r[v],M=r[v+1],E=nl(O,M,w,R,S,T);E>_&&(u=v,_=E)}_>n&&(l[(u-t)/i]=1,p+i<u&&h.push(p,u),u+i<g&&h.push(u,g))}for(let g=0;g<a;++g)l[g]&&(s[o++]=r[t+g*i],s[o++]=r[t+g*i+1]);return o}function fc(r,t,e,i,n,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l];o=_s(r,t,u,i,n,s,o),a.push(o),t=u}return o}function oi(r,t){return t*Math.round(r/t)}function gc(r,t,e,i,n,s,o){if(t==e)return o;let a=oi(r[t],n),l=oi(r[t+1],n);t+=i,s[o++]=a,s[o++]=l;let h,u;do if(h=oi(r[t],n),u=oi(r[t+1],n),t+=i,t==e)return s[o++]=h,s[o++]=u,o;while(h==a&&u==l);for(;t<e;){const g=oi(r[t],n),p=oi(r[t+1],n);if(t+=i,g==h&&p==u)continue;const _=h-a,w=u-l,R=g-a,S=p-l;if(_*S==w*R&&(_<0&&R<_||_==R||_>0&&R>_)&&(w<0&&S<w||w==S||w>0&&S>w)){h=g,u=p;continue}s[o++]=h,s[o++]=u,a=h,l=u,h=g,u=p}return s[o++]=h,s[o++]=u,o}function ta(r,t,e,i,n,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l];o=gc(r,t,u,i,n,s,o),a.push(o),t=u}return o}function pc(r,t,e,i,n,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l],g=[];o=ta(r,t,u,i,n,s,o,g),a.push(g),t=u[u.length-1]}return o}function He(r,t,e,i,n){n=n!==void 0?n:[];let s=0;for(let o=t;o<e;o+=i)n[s++]=r.slice(o,o+i);return n.length=s,n}function hn(r,t,e,i,n){n=n!==void 0?n:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];n[s++]=He(r,t,l,i,n[s]),t=l}return n.length=s,n}function zr(r,t,e,i,n){n=n!==void 0?n:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];n[s++]=l.length===1&&l[0]===t?[]:hn(r,t,l,i,n[s]),t=l[l.length-1]}return n.length=s,n}function ea(r,t,e,i){let n=0,s=r[e-i],o=r[e-i+1];for(;t<e;t+=i){const a=r[t],l=r[t+1];n+=o*a-s*l,s=a,o=l}return n/2}function ia(r,t,e,i){let n=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];n+=ea(r,t,a,i),t=a}return n}function mc(r,t,e,i){let n=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];n+=ia(r,t,a,i),t=a[a.length-1]}return n}class un extends vi{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new un(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){return n<yi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ps(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))}getArea(){return ea(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return He(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=_s(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new un(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=hr(this.flatCoordinates,0,t,this.stride),this.changed()}}function na(r,t,e,i,n){let s;for(t+=i;t<e;t+=i)if(s=n(r.slice(t-i,t),r.slice(t,t+i)),s)return s;return!1}function ra(r,t,e,i,n,s,o){let a,l;const h=(e-t)/i;if(h===1)a=t;else if(h===2)a=t,l=n;else if(h!==0){let u=r[t],g=r[t+1],p=0;const _=[0];for(let S=t+i;S<e;S+=i){const T=r[S],v=r[S+1];p+=Math.sqrt((T-u)*(T-u)+(v-g)*(v-g)),_.push(p),u=T,g=v}const w=n*p,R=_l(_,w);R<0?(l=(w-_[-R-2])/(_[-R-1]-_[-R-2]),a=t+(-R-2)*i):a=t+R*i}o=o>1?o:2,s=s||new Array(o);for(let u=0;u<o;++u)s[u]=a===void 0?NaN:l===void 0?r[a+u]:Pe(r[a+u],r[a+i+u],l);return s}function Yr(r,t,e,i,n,s){if(e==t)return null;let o;if(n<r[t+i-1])return s?(o=r.slice(t,t+i),o[i-1]=n,o):null;if(r[e-1]<n)return s?(o=r.slice(e-i,e),o[i-1]=n,o):null;if(n==r[t+i-1])return r.slice(t,t+i);let a=t/i,l=e/i;for(;a<l;){const p=a+l>>1;n<r[(p+1)*i-1]?l=p:a=p+1}const h=r[a*i-1];if(n==h)return r.slice((a-1)*i,(a-1)*i+i);const u=r[(a+1)*i-1],g=(n-h)/(u-h);o=[];for(let p=0;p<i-1;++p)o.push(Pe(r[(a-1)*i+p],r[a*i+p],g));return o.push(n),o}function _c(r,t,e,i,n,s,o){if(o)return Yr(r,t,e[e.length-1],i,n,s);let a;if(n<r[i-1])return s?(a=r.slice(0,i),a[i-1]=n,a):null;if(r[r.length-1]<n)return s?(a=r.slice(r.length-i),a[i-1]=n,a):null;for(let l=0,h=e.length;l<h;++l){const u=e[l];if(t!=u){if(n<r[t+i-1])return null;if(n<=r[u-1])return Yr(r,t,u,i,n,!1);t=u}}return null}function yc(r,t,e,i,n){return!Po(n,function(o){return!hi(r,t,e,i,o[0],o[1])})}function hi(r,t,e,i,n,s){let o=0,a=r[e-i],l=r[e-i+1];for(;t<e;t+=i){const h=r[t],u=r[t+1];l<=s?u>s&&(h-a)*(s-l)-(n-a)*(u-l)>0&&o++:u<=s&&(h-a)*(s-l)-(n-a)*(u-l)<0&&o--,a=h,l=u}return o!==0}function ys(r,t,e,i,n,s){if(e.length===0||!hi(r,t,e[0],i,n,s))return!1;for(let o=1,a=e.length;o<a;++o)if(hi(r,e[o-1],e[o],i,n,s))return!1;return!0}function wc(r,t,e,i,n,s){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(ys(r,t,l,i,n,s))return!0;t=l[l.length-1]}return!1}function ur(r,t,e,i,n){const s=Mo(ge(),r,t,e,i);return ie(n,s)?Mi(n,s)||s[0]>=n[0]&&s[2]<=n[2]||s[1]>=n[1]&&s[3]<=n[3]?!0:na(r,t,e,i,function(o,a){return Za(n,o,a)}):!1}function Ec(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s){if(ur(r,t,e[s],i,n))return!0;t=e[s]}return!1}function sa(r,t,e,i,n){return!!(ur(r,t,e,i,n)||hi(r,t,e,i,n[0],n[1])||hi(r,t,e,i,n[0],n[3])||hi(r,t,e,i,n[2],n[1])||hi(r,t,e,i,n[2],n[3]))}function oa(r,t,e,i,n){if(!sa(r,t,e[0],i,n))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(yc(r,e[s-1],e[s],i,n)&&!ur(r,e[s-1],e[s],i,n))return!1;return!0}function vc(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(oa(r,t,a,i,n))return!0;t=a[a.length-1]}return!1}function aa(r,t,e,i){let n=r[t],s=r[t+1],o=0;for(let a=t+i;a<e;a+=i){const l=r[a],h=r[a+1];o+=Math.sqrt((l-n)*(l-n)+(h-s)*(h-s)),n=l,s=h}return o}class qi extends vi{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){this.flatCoordinates?Ne(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new qi(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<yi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(fs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ps(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))}forEachSegment(t){return na(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Yr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return He(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return ra(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return aa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=_s(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new qi(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return ur(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=hr(this.flatCoordinates,0,t,this.stride),this.changed()}}class Hn extends vi{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{let n=this.getLayout();const s=t,o=[],a=[];for(let l=0,h=s.length;l<h;++l){const u=s[l];l===0&&(n=u.getLayout()),Ne(o,u.getFlatCoordinates()),a.push(o.length)}this.setFlatCoordinates(n,o),this.ends_=a}}appendLineString(t){this.flatCoordinates?Ne(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new Hn(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<yi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gs(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ms(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,_c(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return hn(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new qi(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new qi(t.slice(s,l),i);n.push(h),s=l}return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const n=this.ends_,s=this.stride;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=ra(e,i,l,s,.5);Ne(t,h),i=l}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=fc(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new Hn(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return Ec(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=ds(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class _i extends vi{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new _i(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const s=this.flatCoordinates,o=di(t,e,s[0],s[1]);if(o<n){const a=this.stride;for(let l=0;l<a;++l)i[l]=s[l];return i.length=a,o}else return n}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return Ba(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return Qr(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=cc(this.flatCoordinates,0,t,this.stride),this.changed()}}class dr extends vi{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?Ne(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new dr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<yi(this.getExtent(),t,e))return n;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const h=di(t,e,s[a],s[a+1]);if(h<n){n=h;for(let u=0;u<o;++u)i[u]=s[a+u];i.length=o}}return n}getCoordinates(){return He(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new _i(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,n=[];for(let s=0,o=t.length;s<o;s+=i){const a=new _i(t.slice(s,s+i),e);n.push(a)}return n}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let n=0,s=e.length;n<s;n+=i){const o=e[n],a=e[n+1];if(Qr(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=hr(this.flatCoordinates,0,t,this.stride),this.changed()}}function la(r,t,e,i,n,s,o){let a,l,h,u,g,p,_;const w=n[s+1],R=[];for(let v=0,O=e.length;v<O;++v){const M=e[v];for(u=r[M-i],p=r[M-i+1],a=t;a<M;a+=i)g=r[a],_=r[a+1],(w<=p&&_<=w||p<=w&&w<=_)&&(h=(w-p)/(_-p)*(g-u)+u,R.push(h)),u=g,p=_}let S=NaN,T=-1/0;for(R.sort(pi),u=R[0],a=1,l=R.length;a<l;++a){g=R[a];const v=Math.abs(g-u);v>T&&(h=(u+g)/2,ys(r,t,e,i,h,w)&&(S=h,T=v)),u=g}return isNaN(S)&&(S=n[s]),o?(o.push(S,w,T),o):[S,w,T]}function xc(r,t,e,i,n){let s=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];s=la(r,t,l,i,n,2*o,s),t=l[l.length-1]}return s}function bc(r,t,e,i){for(;t<e-i;){for(let n=0;n<i;++n){const s=r[t+n];r[t+n]=r[e-i+n],r[e-i+n]=s}t+=i,e-=i}}function ca(r,t,e,i){let n=0,s=r[e-i],o=r[e-i+1];for(;t<e;t+=i){const a=r[t],l=r[t+1];n+=(a-s)*(l+o),s=a,o=l}return n===0?void 0:n>0}function ha(r,t,e,i,n){n=n!==void 0?n:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=ca(r,t,a,i);if(s===0){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;t=a}return!0}function Rc(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(!ha(r,t,a,i,n))return!1;a.length&&(t=a[a.length-1])}return!0}function Vr(r,t,e,i,n){n=n!==void 0?n:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=ca(r,t,a,i);(s===0?n&&l||!n&&!l:n&&!l||!n&&l)&&bc(r,t,a,i),t=a}return t}function io(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s)t=Vr(r,t,e[s],i,n);return t}class ei extends vi{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Ne(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ei(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<yi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(gs(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ms(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return ys(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return ia(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Vr(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,hn(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=gi(this.getExtent());this.flatInteriorPoint_=la(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new _i(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new un(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new un(e.slice(s,l),t);n.push(h),s=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;ha(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Vr(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=ta(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new ei(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return oa(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=ds(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function no(r){const t=r[0],e=r[1],i=r[2],n=r[3],s=[t,e,t,n,i,n,i,e,t,e];return new ei(s,"XY",[s.length])}function Sc(r,t,e,i){const n=[];let s=ge();for(let o=0,a=e.length;o<a;++o){const l=e[o];s=Oo(r,t,l[0],i),n.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return n}class Kn extends vi{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){let n=this.getLayout();const s=t,o=[],a=[];for(let l=0,h=s.length;l<h;++l){const u=s[l];l===0&&(n=u.getLayout());const g=o.length,p=u.getEnds();for(let _=0,w=p.length;_<w;++_)p[_]+=g;Ne(o,u.getFlatCoordinates()),a.push(p)}e=n,t=o,i=a}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;Ne(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let n=0,s=e.length;n<s;++n)e[n]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=this.endss_[n].slice();const i=new Kn(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,n){return n<yi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(uc(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),dc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return wc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return mc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),io(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,zr(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=Sc(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=xc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new dr(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Rc(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=io(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=pc(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new Kn(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const s=this.endss_[t-1];e=s[s.length-1]}const i=this.endss_[t].slice(),n=i[i.length-1];if(e!==0)for(let s=0,o=i.length;s<o;++s)i[s]-=e;return new ei(this.flatCoordinates.slice(e,n),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(s!==0)for(let g=0,p=l.length;g<p;++g)l[g]-=s;const u=new ei(e.slice(s,h),t,l);n.push(u),s=h}return n}getType(){return"MultiPolygon"}intersectsExtent(t){return vc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=hc(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const n=i[i.length-1];this.flatCoordinates.length=n.length===0?0:n[n.length-1]}this.changed()}}const ne={ADD:"add",REMOVE:"remove"},ro={LENGTH:"length"};class Ln extends ke{constructor(t,e,i){super(t),this.element=e,this.index=i}}class xe extends Ce{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(ro.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Ln(ne.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Ln(ne.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t>=i){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Ln(ne.REMOVE,n,t)),this.dispatchEvent(new Ln(ne.ADD,e,t))}updateLength_(){this.set(ro.LENGTH,this.array_.length)}assertUnique_(t,e){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===t&&i!==e)throw new Io(58)}}const Ze={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class En extends Ce{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new En(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Nt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=Et(t,pt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Cc(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Cc(r){if(typeof r=="function")return r;{let t;return Array.isArray(r)?t=r:(wt(typeof r.getZIndex=="function",41),t=[r]),function(){return t}}}const St={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class ua extends Ce{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[St.OPACITY]=t.opacity!==void 0?t.opacity:1,wt(typeof e[St.OPACITY]=="number",64),e[St.VISIBLE]=t.visible!==void 0?t.visible:!0,e[St.Z_INDEX]=t.zIndex,e[St.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[St.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[St.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[St.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=Bt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return ft()}getLayerStatesArray(t){return ft()}getExtent(){return this.get(St.EXTENT)}getMaxResolution(){return this.get(St.MAX_RESOLUTION)}getMinResolution(){return this.get(St.MIN_RESOLUTION)}getMinZoom(){return this.get(St.MIN_ZOOM)}getMaxZoom(){return this.get(St.MAX_ZOOM)}getOpacity(){return this.get(St.OPACITY)}getSourceState(){return ft()}getVisible(){return this.get(St.VISIBLE)}getZIndex(){return this.get(St.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(St.EXTENT,t)}setMaxResolution(t){this.set(St.MAX_RESOLUTION,t)}setMinResolution(t){this.set(St.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(St.MAX_ZOOM,t)}setMinZoom(t){this.set(St.MIN_ZOOM,t)}setOpacity(t){wt(typeof t=="number",64),this.set(St.OPACITY,t)}setVisible(t){this.set(St.VISIBLE,t)}setZIndex(t){this.set(St.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class fr extends ua{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(St.SOURCE,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(St.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Nt(this.sourceChangeKey_),this.sourceChangeKey_=null);const t=this.getSource();t&&(this.sourceChangeKey_=Et(t,pt.CHANGE,this.handleSourceChange_,this)),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(e=>e([]))}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}render(t,e){const i=this.getRenderer();if(i.prepareFrame(t))return this.rendered=!0,i.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(St.MAP,t)}getMapInternal(){return this.get(St.MAP)}setMap(t){this.mapPrecomposeKey_&&(Nt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Nt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=Et(t,Ze.PRECOMPOSE,function(e){const n=e.frameState.layerStatesArray,s=this.getLayerState(!1);wt(!n.some(function(o){return o.layer===s.layer}),67),n.push(s)},this),this.mapRenderKey_=Et(this,pt.CHANGE,t.render,t),this.changed())}setSource(t){this.set(St.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function ws(r,t){if(!r.visible)return!1;const e=t.resolution;if(e<r.minResolution||e>=r.maxResolution)return!1;const i=t.zoom;return i>r.minZoom&&i<=r.maxZoom}function Tc(r,t,e,i,n){da(r,t,e||0,i||r.length-1,n||Ic)}function da(r,t,e,i,n){for(;i>e;){if(i-e>600){var s=i-e+1,o=t-e+1,a=Math.log(s),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1),u=Math.max(e,Math.floor(t-o*l/s+h)),g=Math.min(i,Math.floor(t+(s-o)*l/s+h));da(r,t,u,g,n)}var p=r[t],_=e,w=i;for(Bi(r,e,t),n(r[i],p)>0&&Bi(r,e,i);_<w;){for(Bi(r,_,w),_++,w--;n(r[_],p)<0;)_++;for(;n(r[w],p)>0;)w--}n(r[e],p)===0?Bi(r,e,w):(w++,Bi(r,w,i)),w<=t&&(e=w+1),t<=w&&(i=w-1)}}function Bi(r,t,e){var i=r[t];r[t]=r[e],r[e]=i}function Ic(r,t){return r<t?-1:r>t?1:0}let fa=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!Pn(t,e))return i;const n=this.toBBox,s=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],l=e.leaf?n(a):a;Pn(t,l)&&(e.leaf?i.push(a):yr(t,l)?this._all(a,i):s.push(a))}e=s.pop()}return i}collides(t){let e=this.data;if(!Pn(t,e))return!1;const i=[];for(;e;){for(let n=0;n<e.children.length;n++){const s=e.children[n],o=e.leaf?this.toBBox(s):s;if(Pn(t,o)){if(e.leaf||yr(t,o))return!0;i.push(s)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Ai([]),this}remove(t,e){if(!t)return this;let i=this.data;const n=this.toBBox(t),s=[],o=[];let a,l,h;for(;i||s.length;){if(i||(i=s.pop(),l=s[s.length-1],a=o.pop(),h=!0),i.leaf){const u=Ac(t,i.children,e);if(u!==-1)return i.children.splice(u,1),s.push(i),this._condense(s),this}!h&&!i.leaf&&yr(i,n)?(s.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,n){const s=i-e+1;let o=this._maxEntries,a;if(s<=o)return a=Ai(t.slice(e,i+1)),Si(a,this.toBBox),a;n||(n=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,n-1))),a=Ai([]),a.leaf=!1,a.height=n;const l=Math.ceil(s/o),h=l*Math.ceil(Math.sqrt(o));so(t,e,i,h,this.compareMinX);for(let u=e;u<=i;u+=h){const g=Math.min(u+h-1,i);so(t,u,g,l,this.compareMinY);for(let p=u;p<=g;p+=l){const _=Math.min(p+l-1,g);a.children.push(this._build(t,p,_,n-1))}}return Si(a,this.toBBox),a}_chooseSubtree(t,e,i,n){for(;n.push(e),!(e.leaf||n.length-1===i);){let s=1/0,o=1/0,a;for(let l=0;l<e.children.length;l++){const h=e.children[l],u=_r(h),g=Mc(t,h)-u;g<o?(o=g,s=u<s?u:s,a=h):g===o&&u<s&&(s=u,a=h)}e=a||e.children[0]}return e}_insert(t,e,i){const n=i?t:this.toBBox(t),s=[],o=this._chooseSubtree(n,this.data,e,s);for(o.children.push(t),Hi(o,n);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(n,s,e)}_split(t,e){const i=t[e],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);const o=this._chooseSplitIndex(i,s,n),a=Ai(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,Si(i,this.toBBox),Si(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)}_splitRoot(t,e){this.data=Ai([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Si(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let n,s=1/0,o=1/0;for(let a=e;a<=i-e;a++){const l=$i(t,0,a,this.toBBox),h=$i(t,a,i,this.toBBox),u=Pc(l,h),g=_r(l)+_r(h);u<s?(s=u,n=a,o=g<o?g:o):u===s&&g<o&&(o=g,n=a)}return n||i-e}_chooseSplitAxis(t,e,i){const n=t.leaf?this.compareMinX:Oc,s=t.leaf?this.compareMinY:Lc,o=this._allDistMargin(t,e,i,n),a=this._allDistMargin(t,e,i,s);o<a&&t.children.sort(n)}_allDistMargin(t,e,i,n){t.children.sort(n);const s=this.toBBox,o=$i(t,0,e,s),a=$i(t,i-e,i,s);let l=Mn(o)+Mn(a);for(let h=e;h<i-e;h++){const u=t.children[h];Hi(o,t.leaf?s(u):u),l+=Mn(o)}for(let h=i-e-1;h>=e;h--){const u=t.children[h];Hi(a,t.leaf?s(u):u),l+=Mn(a)}return l}_adjustParentBBoxes(t,e,i){for(let n=i;n>=0;n--)Hi(e[n],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():Si(t[e],this.toBBox)}};function Ac(r,t,e){if(!e)return t.indexOf(r);for(let i=0;i<t.length;i++)if(e(r,t[i]))return i;return-1}function Si(r,t){$i(r,0,r.children.length,t,r)}function $i(r,t,e,i,n){n||(n=Ai(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s=t;s<e;s++){const o=r.children[s];Hi(n,r.leaf?i(o):o)}return n}function Hi(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r}function Oc(r,t){return r.minX-t.minX}function Lc(r,t){return r.minY-t.minY}function _r(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function Mn(r){return r.maxX-r.minX+(r.maxY-r.minY)}function Mc(r,t){return(Math.max(t.maxX,r.maxX)-Math.min(t.minX,r.minX))*(Math.max(t.maxY,r.maxY)-Math.min(t.minY,r.minY))}function Pc(r,t){const e=Math.max(r.minX,t.minX),i=Math.max(r.minY,t.minY),n=Math.min(r.maxX,t.maxX),s=Math.min(r.maxY,t.maxY);return Math.max(0,n-e)*Math.max(0,s-i)}function yr(r,t){return r.minX<=t.minX&&r.minY<=t.minY&&t.maxX<=r.maxX&&t.maxY<=r.maxY}function Pn(r,t){return t.minX<=r.maxX&&t.minY<=r.maxY&&t.maxX>=r.minX&&t.maxY>=r.minY}function Ai(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function so(r,t,e,i,n){const s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=i)continue;const o=t+Math.ceil((e-t)/i/2)*i;Tc(r,o,t,e,n),s.push(t,o,o,e)}}function oo(r){return new Qe({fill:dn(r,""),stroke:fn(r,""),text:Nc(r),image:Dc(r)})}function dn(r,t){const e=r[t+"fill-color"];if(e)return new ji({color:e})}function fn(r,t){const e=r[t+"stroke-width"],i=r[t+"stroke-color"];if(!(!e&&!i))return new yn({width:e,color:i,lineCap:r[t+"stroke-line-cap"],lineJoin:r[t+"stroke-line-join"],lineDash:r[t+"stroke-line-dash"],lineDashOffset:r[t+"stroke-line-dash-offset"],miterLimit:r[t+"stroke-miter-limit"]})}function Nc(r){const t=r["text-value"];return t?new os({text:t,font:r["text-font"],maxAngle:r["text-max-angle"],offsetX:r["text-offset-x"],offsetY:r["text-offset-y"],overflow:r["text-overflow"],placement:r["text-placement"],scale:r["text-scale"],rotateWithView:r["text-rotate-with-view"],rotation:r["text-rotation"],textAlign:r["text-align"],justify:r["text-justify"],textBaseline:r["text-baseline"],padding:r["text-padding"],fill:dn(r,"text-"),backgroundFill:dn(r,"text-background-"),stroke:fn(r,"text-"),backgroundStroke:fn(r,"text-background-")}):void 0}function Dc(r){const t=r["icon-src"],e=r["icon-img"];if(t||e)return new lr({src:t,img:e,imgSize:r["icon-img-size"],anchor:r["icon-anchor"],anchorOrigin:r["icon-anchor-origin"],anchorXUnits:r["icon-anchor-x-units"],anchorYUnits:r["icon-anchor-y-units"],color:r["icon-color"],crossOrigin:r["icon-cross-origin"],offset:r["icon-offset"],displacement:r["icon-displacement"],opacity:r["icon-opacity"],scale:r["icon-scale"],rotation:r["icon-rotation"],rotateWithView:r["icon-rotate-with-view"],size:r["icon-size"],declutterMode:r["icon-declutter-mode"]});const i=r["shape-points"];if(i){const s="shape-";return new ar({points:i,fill:dn(r,s),stroke:fn(r,s),radius:r["shape-radius"],radius1:r["shape-radius1"],radius2:r["shape-radius2"],angle:r["shape-angle"],displacement:r["shape-displacement"],rotation:r["shape-rotation"],rotateWithView:r["shape-rotate-with-view"],scale:r["shape-scale"],declutterMode:r["shape-declutter-mode"]})}const n=r["circle-radius"];if(n){const s="circle-";return new _n({radius:n,fill:dn(r,s),stroke:fn(r,s),displacement:r["circle-displacement"],scale:r["circle-scale"],rotation:r["circle-rotation"],rotateWithView:r["circle-rotate-with-view"],declutterMode:r["circle-declutter-mode"]})}}const ao={RENDER_ORDER:"renderOrder"};class kc extends fr{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter!==void 0?t.declutter:!1,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(ao.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new fa(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(ao.RENDER_ORDER,t)}setStyle(t){let e;if(t===void 0)e=Ml;else if(t===null)e=null;else if(typeof t=="function")e=t;else if(t instanceof Qe)e=t;else if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let s=0;s<i;++s){const o=t[s];o instanceof Qe?n[s]=o:n[s]=oo(o)}e=n}else e=oo(t);this.style_=e,this.styleFunction_=t===null?void 0:Ll(this.style_),this.changed()}}const lt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Nn=[lt.FILL],Ke=[lt.STROKE],ui=[lt.BEGIN_PATH],lo=[lt.CLOSE_PATH];class ga{drawCustom(t,e,i,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class vn extends ga{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=t.length;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],Jn(i,n)&&(s[o++]=n[0],s[o++]=n[1]);return o}appendFlatLineCoordinates(t,e,i,n,s,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=n);let u=t[e],g=t[e+1];const p=this.tmpCoordinate_;let _=!0,w,R,S;for(w=e+n;w<i;w+=n)p[0]=t[w],p[1]=t[w+1],S=Or(h,p),S!==R?(_&&(a[l++]=u,a[l++]=g,_=!1),a[l++]=p[0],a[l++]=p[1]):S===Ht.INTERSECTING?(a[l++]=p[0],a[l++]=p[1],_=!1):_=!0,u=p[0],g=p[1],R=S;return(s&&_||w===e+n)&&(a[l++]=u,a[l++]=g),l}drawCustomCoordinates_(t,e,i,n,s){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(t,e,l,n,!1,!1);s.push(h),e=l}return e}drawCustom(t,e,i,n){this.beginGeometry(t,e);const s=t.getType(),o=t.getStride(),a=this.coordinates.length;let l,h,u,g,p;switch(s){case"MultiPolygon":l=t.getOrientedFlatCoordinates(),g=[];const _=t.getEndss();p=0;for(let w=0,R=_.length;w<R;++w){const S=[];p=this.drawCustomCoordinates_(l,p,_[w],o,S),g.push(S)}this.instructions.push([lt.CUSTOM,a,g,t,i,zr]),this.hitDetectionInstructions.push([lt.CUSTOM,a,g,t,n||i,zr]);break;case"Polygon":case"MultiLineString":u=[],l=s=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),p=this.drawCustomCoordinates_(l,0,t.getEnds(),o,u),this.instructions.push([lt.CUSTOM,a,u,t,i,hn]),this.hitDetectionInstructions.push([lt.CUSTOM,a,u,t,n||i,hn]);break;case"LineString":case"Circle":l=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([lt.CUSTOM,a,h,t,i,He]),this.hitDetectionInstructions.push([lt.CUSTOM,a,h,t,n||i,He]);break;case"MultiPoint":l=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(l,o),h>a&&(this.instructions.push([lt.CUSTOM,a,h,t,i,He]),this.hitDetectionInstructions.push([lt.CUSTOM,a,h,t,n||i,He]));break;case"Point":l=t.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),h=this.coordinates.length,this.instructions.push([lt.CUSTOM,a,h,t,i]),this.hitDetectionInstructions.push([lt.CUSTOM,a,h,t,n||i]);break}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[lt.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[lt.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let n,s,o=-1;for(e=0;e<i;++e)n=t[e],s=n[0],s==lt.END_GEOMETRY?o=e:s==lt.BEGIN_GEOMETRY&&(n[2]=e,yl(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const n=t.getColor();i.fillStyle=ve(n||De)}else i.fillStyle=void 0;if(e){const n=e.getColor();i.strokeStyle=ve(n||sn);const s=e.getLineCap();i.lineCap=s!==void 0?s:Xn;const o=e.getLineDash();i.lineDash=o?o.slice():en;const a=e.getLineDashOffset();i.lineDashOffset=a||nn;const l=e.getLineJoin();i.lineJoin=l!==void 0?l:Ui;const h=e.getWidth();i.lineWidth=h!==void 0?h:an;const u=e.getMiterLimit();i.miterLimit=u!==void 0?u:rn,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[lt.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[lt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,s=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||s!=t.currentLineDash&&!Ei(t.currentLineDash,s)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=s,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[lt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=Ao(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;Jr(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Fc extends vn{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([lt.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([lt.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([lt.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([lt.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class Gc extends vn{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),a=[lt.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(t,e){const i=this.state,n=i.strokeStyle,s=i.lineWidth;if(n===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([lt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,en,nn],ui);const o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(Ke),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state,n=i.strokeStyle,s=i.lineWidth;if(n===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([lt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],ui);const o=t.getEnds(),a=t.getFlatCoordinates(),l=t.getStride();let h=0;for(let u=0,g=o.length;u<g;++u)h=this.drawFlatCoordinates_(a,h,o[u],l);this.hitDetectionInstructions.push(Ke),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Ke),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Ke),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(ui)}}class co extends vn{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=i.length;this.instructions.push(ui),this.hitDetectionInstructions.push(ui);for(let h=0;h<l;++h){const u=i[h],g=this.coordinates.length,p=this.appendFlatLineCoordinates(t,e,u,n,!0,!a),_=[lt.MOVE_TO_LINE_TO,g,p];this.instructions.push(_),this.hitDetectionInstructions.push(_),a&&(this.instructions.push(lo),this.hitDetectionInstructions.push(lo)),e=u}return o&&(this.instructions.push(Nn),this.hitDetectionInstructions.push(Nn)),a&&(this.instructions.push(Ke),this.hitDetectionInstructions.push(Ke)),e}drawCircle(t,e){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(n===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([lt.SET_FILL_STYLE,De]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([lt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getFlatCoordinates(),a=t.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const h=[lt.CIRCLE,l];this.instructions.push(ui,h),this.hitDetectionInstructions.push(ui,h),i.fillStyle!==void 0&&(this.instructions.push(Nn),this.hitDetectionInstructions.push(Nn)),i.strokeStyle!==void 0&&(this.instructions.push(Ke),this.hitDetectionInstructions.push(Ke)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(n===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([lt.SET_FILL_STYLE,De]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([lt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getEnds(),a=t.getOrientedFlatCoordinates(),l=t.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(n===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([lt.SET_FILL_STYLE,De]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([lt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getEndss(),a=t.getOrientedFlatCoordinates(),l=t.getStride();let h=0;for(let u=0,g=o.length;u<g;++u)h=this.drawFlatCoordinatess_(a,h,o[u],l);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=oi(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}function Uc(r,t,e,i,n){let s=e,o=e,a=0,l=0,h=e,u,g,p,_,w,R,S,T,v,O;for(g=e;g<i;g+=n){const M=t[g],E=t[g+1];w!==void 0&&(v=M-w,O=E-R,_=Math.sqrt(v*v+O*O),S!==void 0&&(l+=p,u=Math.acos((S*v+T*O)/(p*_)),u>r&&(l>a&&(a=l,s=h,o=g),l=0,h=g-n)),p=_,S=v,T=O),w=M,R=E}return l+=_,l>a?[h,g]:[s,o]}const Ji={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class qc extends vn{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const i=this.textFillState_,n=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!i&&!n)return;const o=this.coordinates;let a=o.length;const l=t.getType();let h=null,u=t.getStride();if(s.placement==="line"&&(l=="LineString"||l=="MultiLineString"||l=="Polygon"||l=="MultiPolygon")){if(!ie(this.getBufferedMaxExtent(),t.getExtent()))return;let g;if(h=t.getFlatCoordinates(),l=="LineString")g=[h.length];else if(l=="MultiLineString")g=t.getEnds();else if(l=="Polygon")g=t.getEnds().slice(0,1);else if(l=="MultiPolygon"){const R=t.getEndss();g=[];for(let S=0,T=R.length;S<T;++S)g.push(R[S][0])}this.beginGeometry(t,e);const p=s.textAlign;let _=0,w;for(let R=0,S=g.length;R<S;++R){if(p==null){const v=Uc(s.maxAngle,h,_,g[R],u);_=v[0],w=v[1]}else w=g[R];for(let v=_;v<w;v+=u)o.push(h[v],h[v+1]);const T=o.length;_=g[R],this.drawChars_(a,T),a=T}this.endGeometry(e)}else{let g=s.overflow?null:[];switch(l){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),u=2;break;case"Polygon":h=t.getFlatInteriorPoint(),s.overflow||g.push(h[2]/this.resolution),u=3;break;case"MultiPolygon":const S=t.getFlatInteriorPoints();h=[];for(let T=0,v=S.length;T<v;T+=3)s.overflow||g.push(S[T+2]/this.resolution),h.push(S[T],S[T+1]);if(h.length===0)return;u=2;break}const p=this.appendFlatPointCoordinates(h,u);if(p===a)return;if(g&&(p-a)/2!==h.length/u){let S=a/2;g=g.filter((T,v)=>{const O=o[(S+v)*2]===h[v*u]&&o[(S+v)*2+1]===h[v*u+1];return O||--S,O})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let _=s.padding;if(_!=li&&(s.scale[0]<0||s.scale[1]<0)){let S=s.padding[0],T=s.padding[1],v=s.padding[2],O=s.padding[3];s.scale[0]<0&&(T=-T,O=-O),s.scale[1]<0&&(S=-S,v=-v),_=[S,T,v,O]}const w=this.pixelRatio;this.instructions.push([lt.DRAW_IMAGE,a,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,_==li?li:_.map(function(S){return S*w}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,g]);const R=1/w;this.hitDetectionInstructions.push([lt.DRAW_IMAGE,a,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[R,R],NaN,void 0,this.declutterImageWithText_,_,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,g]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||on,justify:e.justify,textBaseline:e.textBaseline||zn,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=Ji[n.textBaseline],u=this.textOffsetY_*l,g=this.text_,p=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([lt.DRAW_CHARS,t,e,h,n.overflow,a,n.maxAngle,l,u,s,p*l,g,o,1]),this.hitDetectionInstructions.push([lt.DRAW_CHARS,t,e,h,n.overflow,a,n.maxAngle,1,u,s,p,g,o,1/l])}setTextStyle(t,e){let i,n,s;if(!t)this.text_="";else{const o=t.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=ve(o.getColor()||De)):(n=null,this.textFillState_=n);const a=t.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const w=a.getLineDash(),R=a.getLineDashOffset(),S=a.getWidth(),T=a.getMiterLimit();s.lineCap=a.getLineCap()||Xn,s.lineDash=w?w.slice():en,s.lineDashOffset=R===void 0?nn:R,s.lineJoin=a.getLineJoin()||Ui,s.lineWidth=S===void 0?an:S,s.miterLimit=T===void 0?rn:T,s.strokeStyle=ve(a.getColor()||sn)}i=this.textState_;const l=t.getFont()||zo;bl(l);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=l,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||zn,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||li,i.scale=h===void 0?[1,1]:h;const u=t.getOffsetX(),g=t.getOffsetY(),p=t.getRotateWithView(),_=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=g===void 0?0:g,this.textRotateWithView_=p===void 0?!1:p,this.textRotation_=_===void 0?0:_,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:xt(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n?typeof n.fillStyle=="string"?n.fillStyle:"|"+xt(n.fillStyle):""}this.declutterImageWithText_=e}}const jc={Circle:co,Default:vn,Image:Fc,LineString:Gc,Polygon:co,Text:qc};class ho{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const s=i[n].finish();t[e][n]=s}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let s=n[e];if(s===void 0){const o=jc[e];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=s}return s}}class Xc extends mn{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return ft()}getData(t){return null}prepareFrame(t){return ft()}renderFrame(t,e){return ft()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(function(n,s){const o=this.loadedTileCallback.bind(this,i,n);return t.forEachLoadedTile(e,n,s,o)}).bind(this)}forEachFeatureAtCoordinate(t,e,i,n,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){t.target.getState()===$t.LOADED&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=$t.LOADED&&e!=$t.ERROR&&t.addEventListener(pt.CHANGE,this.boundHandleImageChange_),e==$t.IDLE&&(t.load(),e=t.getState()),e==$t.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}class pa extends ke{constructor(t,e,i,n){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=n}}const uo=[];let Oi=null;function zc(){const r=document.createElement("canvas");r.width=1,r.height=1,Oi=r.getContext("2d")}class ma extends Xc{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=be(),this.pixelTransform=be(),this.inversePixelTransform=be(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){Oi||zc(),Oi.clearRect(0,0,1,1);let n;try{Oi.drawImage(t,e,i,1,1,0,0,1,1),n=Oi.getImageData(0,0,1,1).data}catch{return Oi=null,null}return n}getBackground(t){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const n=this.getLayer().getClassName();let s,o;if(t&&t.className===n&&(!i||t&&t.style.backgroundColor&&Ei(qn(t.style.backgroundColor),qn(i)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){s=document.createElement("div"),s.className=n;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=ce();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const n=wi(i),s=er(i),o=tr(i),a=Qn(i);Kt(e.coordinateToPixelTransform,n),Kt(e.coordinateToPixelTransform,s),Kt(e.coordinateToPixelTransform,o),Kt(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;Kt(l,n),Kt(l,s),Kt(l,o),Kt(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,i){const n=this.getLayer();if(n.hasListener(t)){const s=new pa(t,this.inversePixelTransform,i,e);n.dispatchEvent(s)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_(Ze.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(Ze.POSTRENDER,t,e)}getRenderTransform(t,e,i,n,s,o,a){const l=s/2,h=o/2,u=n/e,g=-u,p=-t[0]+a,_=-t[1];return ti(this.tempTransform,l,h,u,g,-i,p,_)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function Yc(r,t,e,i,n,s,o,a,l,h,u,g){let p=r[t],_=r[t+1],w=0,R=0,S=0,T=0;function v(){w=p,R=_,t+=i,p=r[t],_=r[t+1],T+=S,S=Math.sqrt((p-w)*(p-w)+(_-R)*(_-R))}do v();while(t<e-i&&T+S<s);let O=S===0?0:(s-T)/S;const M=Pe(w,p,O),E=Pe(R,_,O),I=t-i,A=T,k=s+a*l(h,n,u);for(;t<e-i&&T+S<k;)v();O=S===0?0:(k-T)/S;const F=Pe(w,p,O),V=Pe(R,_,O);let Y;if(g){const G=[M,E,F,V];Jo(G,0,4,2,g,G,G),Y=G[0]>G[2]}else Y=M>F;const N=Math.PI,q=[],B=I+i===t;t=I,S=0,T=A,p=r[t],_=r[t+1];let H;if(B){v(),H=Math.atan2(_-R,p-w),Y&&(H+=H>0?-N:N);const G=(F+M)/2,U=(V+E)/2;return q[0]=[G,U,(k-s)/2,H,n],q}n=n.replace(/\n/g," ");for(let G=0,U=n.length;G<U;){v();let W=Math.atan2(_-R,p-w);if(Y&&(W+=W>0?-N:N),H!==void 0){let nt=W-H;if(nt+=nt>N?-2*N:nt<-N?2*N:0,Math.abs(nt)>o)return null}H=W;const st=G;let K=0;for(;G<U;++G){const nt=Y?U-G-1:G,tt=a*l(h,n[nt],u);if(t+i<e&&T+S<s+K+tt/2)break;K+=tt}if(G===st)continue;const gt=Y?n.substring(U-st,U-G):n.substring(st,G);O=S===0?0:(s+K/2-T)/S;const X=Pe(w,p,O),mt=Pe(R,_,O);q.push([X,mt,K/2,W,gt]),s+=K}return q}const Ci=ge(),je=[],Ae=[],Oe=[],Xe=[];function fo(r){return r[3].declutterBox}const Vc=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function go(r,t){return(t==="start"||t==="end")&&!Vc.test(r)&&(t=t==="start"?"left":"right"),Ji[t]}function Wc(r,t,e){return e>0&&r.push(`
`,""),r.push(t,""),r}class Bc{constructor(t,e,i,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=be(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,n){const s=t+e+i+n;if(this.labels_[s])return this.labels_[s];const o=n?this.strokeStates[n]:null,a=i?this.fillStates[i]:null,l=this.textStates[e],h=this.pixelRatio,u=[l.scale[0]*h,l.scale[1]*h],g=Array.isArray(t),p=l.justify?Ji[l.justify]:go(Array.isArray(t)?t[0]:t,l.textAlign||on),_=n&&o.lineWidth?o.lineWidth:0,w=g?t:t.split(`
`).reduce(Wc,[]),{width:R,height:S,widths:T,heights:v,lineWidths:O}=Sl(l,w),M=R+_,E=[],I=(M+2)*u[0],A=(S+_)*u[1],k={width:I<0?Math.floor(I):Math.ceil(I),height:A<0?Math.floor(A):Math.ceil(A),contextInstructions:E};(u[0]!=1||u[1]!=1)&&E.push("scale",u),n&&(E.push("strokeStyle",o.strokeStyle),E.push("lineWidth",_),E.push("lineCap",o.lineCap),E.push("lineJoin",o.lineJoin),E.push("miterLimit",o.miterLimit),E.push("setLineDash",[o.lineDash]),E.push("lineDashOffset",o.lineDashOffset)),i&&E.push("fillStyle",a.fillStyle),E.push("textBaseline","middle"),E.push("textAlign","center");const F=.5-p;let V=p*M+F*_;const Y=[],N=[];let q=0,B=0,H=0,G=0,U;for(let W=0,st=w.length;W<st;W+=2){const K=w[W];if(K===`
`){B+=q,q=0,V=p*M+F*_,++G;continue}const gt=w[W+1]||l.font;gt!==U&&(n&&Y.push("font",gt),i&&N.push("font",gt),U=gt),q=Math.max(q,v[H]);const X=[K,V+F*T[H]+p*(T[H]-O[G]),.5*(_+q)+B];V+=T[H],n&&Y.push("strokeText",X),i&&N.push("fillText",X),++H}return Array.prototype.push.apply(E,Y),Array.prototype.push.apply(E,N),this.labels_[s]=k,k}replayTextBackground_(t,e,i,n,s,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,s,o,a,l,h,u,g,p,_,w,R,S){a*=p[0],l*=p[1];let T=i-a,v=n-l;const O=s+h>t?t-h:s,M=o+u>e?e-u:o,E=w[3]+O*p[0]+w[1],I=w[0]+M*p[1]+w[2],A=T-w[3],k=v-w[0];(R||g!==0)&&(je[0]=A,Xe[0]=A,je[1]=k,Ae[1]=k,Ae[0]=A+E,Oe[0]=Ae[0],Oe[1]=k+I,Xe[1]=Oe[1]);let F;return g!==0?(F=ti(be(),i,n,1,1,g,-i,-n),Kt(F,je),Kt(F,Ae),Kt(F,Oe),Kt(F,Xe),Re(Math.min(je[0],Ae[0],Oe[0],Xe[0]),Math.min(je[1],Ae[1],Oe[1],Xe[1]),Math.max(je[0],Ae[0],Oe[0],Xe[0]),Math.max(je[1],Ae[1],Oe[1],Xe[1]),Ci)):Re(Math.min(A,A+E),Math.min(k,k+I),Math.max(A,A+E),Math.max(k,k+I),Ci),_&&(T=Math.round(T),v=Math.round(v)),{drawImageX:T,drawImageY:v,drawImageW:O,drawImageH:M,originX:h,originY:u,declutterBox:{minX:Ci[0],minY:Ci[1],maxX:Ci[2],maxY:Ci[3],value:S},canvasTransform:F,scale:p}}replayImageOrLabel_(t,e,i,n,s,o,a){const l=!!(o||a),h=n.declutterBox,u=t.canvas,g=a?a[2]*n.scale[0]/2:0;return h.minX-g<=u.width/e&&h.maxX+g>=0&&h.minY-g<=u.height/e&&h.maxY+g>=0&&(l&&this.replayTextBackground_(t,je,Ae,Oe,Xe,o,a),Cl(t,n.canvasTransform,s,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){if(this.alignFill_){const e=Kt(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){const s=this.textStates[e],o=this.createLabel(t,e,n,i),a=this.strokeStates[i],l=this.pixelRatio,h=go(Array.isArray(t)?t[0]:t,s.textAlign||on),u=Ji[s.textBaseline||zn],g=a&&a.lineWidth?a.lineWidth:0,p=o.width/l-2*s.scale[0],_=h*p+2*(.5-h)*g,w=u*o.height/l+2*(.5-u)*g;return{label:o,anchorX:_,anchorY:w}}execute_(t,e,i,n,s,o,a,l){let h;this.pixelCoordinates_&&Ei(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=fi(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Dl(this.renderedTransform_,i));let u=0;const g=n.length;let p=0,_,w,R,S,T,v,O,M,E,I,A,k,F=0,V=0,Y=null,N=null;const q=this.coordinateCache_,B=this.viewRotation_,H=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,G={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:B},U=this.instructions!=n||this.overlaps?0:200;let W,st,K,gt;for(;u<g;){const X=n[u];switch(X[0]){case lt.BEGIN_GEOMETRY:W=X[1],gt=X[3],W.getGeometry()?a!==void 0&&!ie(a,gt.getExtent())?u=X[2]+1:++u:u=X[2];break;case lt.BEGIN_PATH:F>U&&(this.fill_(t),F=0),V>U&&(t.stroke(),V=0),!F&&!V&&(t.beginPath(),S=NaN,T=NaN),++u;break;case lt.CIRCLE:p=X[1];const nt=h[p],tt=h[p+1],jt=h[p+2],ut=h[p+3],D=jt-nt,z=ut-tt,Z=Math.sqrt(D*D+z*z);t.moveTo(nt+Z,tt),t.arc(nt,tt,Z,0,2*Math.PI,!0),++u;break;case lt.CLOSE_PATH:t.closePath(),++u;break;case lt.CUSTOM:p=X[1],_=X[2];const rt=X[3],J=X[4],Q=X.length==6?X[5]:void 0;G.geometry=rt,G.feature=W,u in q||(q[u]=[]);const yt=q[u];Q?Q(h,p,_,2,yt):(yt[0]=h[p],yt[1]=h[p+1],yt.length=2),J(yt,G),++u;break;case lt.DRAW_IMAGE:p=X[1],_=X[2],M=X[3],w=X[4],R=X[5];let bt=X[6];const It=X[7],At=X[8],re=X[9],_t=X[10];let Lt=X[11];const Gt=X[12];let kt=X[13];const Ct=X[14],Zt=X[15];if(!M&&X.length>=20){E=X[19],I=X[20],A=X[21],k=X[22];const at=this.drawLabelWithPointPlacement_(E,I,A,k);M=at.label,X[3]=M;const ht=X[23];w=(at.anchorX-ht)*this.pixelRatio,X[4]=w;const Tt=X[24];R=(at.anchorY-Tt)*this.pixelRatio,X[5]=R,bt=M.height,X[6]=bt,kt=M.width,X[13]=kt}let Yt;X.length>25&&(Yt=X[25]);let he,Jt,se;X.length>17?(he=X[16],Jt=X[17],se=X[18]):(he=li,Jt=!1,se=!1),_t&&H?Lt+=B:!_t&&!H&&(Lt-=B);let ue=0;for(;p<_;p+=2){if(Yt&&Yt[ue++]<kt/this.pixelRatio)continue;const at=this.calculateImageOrLabelDimensions_(M.width,M.height,h[p],h[p+1],kt,bt,w,R,At,re,Lt,Gt,s,he,Jt||se,W),ht=[t,e,M,at,It,Jt?Y:null,se?N:null];if(l){if(Ct==="none")continue;if(Ct==="obstacle"){l.insert(at.declutterBox);continue}else{let Tt,Vt;if(Zt){const Rt=_-p;if(!Zt[Rt]){Zt[Rt]=ht;continue}if(Tt=Zt[Rt],delete Zt[Rt],Vt=fo(Tt),l.collides(Vt))continue}if(l.collides(at.declutterBox))continue;Tt&&(l.insert(Vt),this.replayImageOrLabel_.apply(this,Tt)),l.insert(at.declutterBox)}}this.replayImageOrLabel_.apply(this,ht)}++u;break;case lt.DRAW_CHARS:const oe=X[1],Ut=X[2],de=X[3],xi=X[4];k=X[5];const Te=X[6],Fe=X[7],Ge=X[8];A=X[9];const ae=X[10];E=X[11],I=X[12];const Ue=[X[13],X[13]],m=this.textStates[I],y=m.font,b=[m.scale[0]*Fe,m.scale[1]*Fe];let L;y in this.widths_?L=this.widths_[y]:(L={},this.widths_[y]=L);const $=aa(h,oe,Ut,2),et=Math.abs(b[0])*Xs(y,E,L);if(xi||et<=$){const at=this.textStates[I].textAlign,ht=($-et)*Ji[at],Tt=Yc(h,oe,Ut,2,E,ht,Te,Math.abs(b[0]),Xs,y,L,H?0:this.viewRotation_);t:if(Tt){const Vt=[];let Rt,ee,Dt,Ft,Mt;if(A)for(Rt=0,ee=Tt.length;Rt<ee;++Rt){Mt=Tt[Rt],Dt=Mt[4],Ft=this.createLabel(Dt,I,"",A),w=Mt[2]+(b[0]<0?-ae:ae),R=de*Ft.height+(.5-de)*2*ae*b[1]/b[0]-Ge;const Xt=this.calculateImageOrLabelDimensions_(Ft.width,Ft.height,Mt[0],Mt[1],Ft.width,Ft.height,w,R,0,0,Mt[3],Ue,!1,li,!1,W);if(l&&l.collides(Xt.declutterBox))break t;Vt.push([t,e,Ft,Xt,1,null,null])}if(k)for(Rt=0,ee=Tt.length;Rt<ee;++Rt){Mt=Tt[Rt],Dt=Mt[4],Ft=this.createLabel(Dt,I,k,""),w=Mt[2],R=de*Ft.height-Ge;const Xt=this.calculateImageOrLabelDimensions_(Ft.width,Ft.height,Mt[0],Mt[1],Ft.width,Ft.height,w,R,0,0,Mt[3],Ue,!1,li,!1,W);if(l&&l.collides(Xt.declutterBox))break t;Vt.push([t,e,Ft,Xt,1,null,null])}l&&l.load(Vt.map(fo));for(let Xt=0,we=Vt.length;Xt<we;++Xt)this.replayImageOrLabel_.apply(this,Vt[Xt])}}++u;break;case lt.END_GEOMETRY:if(o!==void 0){W=X[1];const at=o(W,gt);if(at)return at}++u;break;case lt.FILL:U?F++:this.fill_(t),++u;break;case lt.MOVE_TO_LINE_TO:for(p=X[1],_=X[2],st=h[p],K=h[p+1],v=st+.5|0,O=K+.5|0,(v!==S||O!==T)&&(t.moveTo(st,K),S=v,T=O),p+=2;p<_;p+=2)st=h[p],K=h[p+1],v=st+.5|0,O=K+.5|0,(p==_-2||v!==S||O!==T)&&(t.lineTo(st,K),S=v,T=O);++u;break;case lt.SET_FILL_STYLE:Y=X,this.alignFill_=X[2],F&&(this.fill_(t),F=0,V&&(t.stroke(),V=0)),t.fillStyle=X[1],++u;break;case lt.SET_STROKE_STYLE:N=X,V&&(t.stroke(),V=0),this.setStrokeStyle_(t,X),++u;break;case lt.STROKE:U?V++:t.stroke(),++u;break;default:++u;break}}F&&this.fill_(t),V&&t.stroke()}execute(t,e,i,n,s,o){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,s,void 0,void 0,o)}executeHitDetection(t,e,i,n,s){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,s)}}const wr=["Polygon","Circle","LineString","Image","Text","Default"];class po{constructor(t,e,i,n,s,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=be(),this.createExecutors_(s)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];i===void 0&&(i={},this.executorsByZIndex_[e]=i);const n=t[e];for(const s in n){const o=n[s];i[s]=new Bc(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let n=0,s=t.length;n<s;++n)if(t[n]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,s,o){n=Math.round(n);const a=n*2+1,l=ti(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=ce(a,a));const u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):h||u.clearRect(0,0,a,a);let g;this.renderBuffer_!==void 0&&(g=ge(),Ki(g,t),Jr(g,e*(this.renderBuffer_+n),g));const p=$c(n);let _;function w(E,I){const A=u.getImageData(0,0,a,a).data;for(let k=0,F=p.length;k<F;k++)if(A[p[k]]>0){if(!o||_!=="Image"&&_!=="Text"||o.includes(E)){const V=(p[k]-3)/4,Y=n-V%a,N=n-(V/a|0),q=s(E,I,Y*Y+N*N);if(q)return q}u.clearRect(0,0,a,a);break}}const R=Object.keys(this.executorsByZIndex_).map(Number);R.sort(pi);let S,T,v,O,M;for(S=R.length-1;S>=0;--S){const E=R[S].toString();for(v=this.executorsByZIndex_[E],T=wr.length-1;T>=0;--T)if(_=wr[T],O=v[_],O!==void 0&&(M=O.executeHitDetection(u,l,i,w,g),M))return M}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],s=e[2],o=e[3],a=[i,n,i,o,s,o,s,n];return fi(a,0,8,2,t,a),a}isEmpty(){return Gi(this.executorsByZIndex_)}execute(t,e,i,n,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(pi),this.maxExtent_&&(t.save(),this.clip(t,i)),o=o||wr;let h,u,g,p,_,w;for(a&&l.reverse(),h=0,u=l.length;h<u;++h){const R=l[h].toString();for(_=this.executorsByZIndex_[R],g=0,p=o.length;g<p;++g){const S=o[g];w=_[S],w!==void 0&&w.execute(t,e,i,n,s,a)}}this.maxExtent_&&t.restore()}}const Er={};function $c(r){if(Er[r]!==void 0)return Er[r];const t=r*2+1,e=r*r,i=new Array(e+1);for(let s=0;s<=r;++s)for(let o=0;o<=r;++o){const a=s*s+o*o;if(a>e)break;let l=i[a];l||(l=[],i[a]=l),l.push(((r+s)*t+(r+o))*4+3),s>0&&l.push(((r-s)*t+(r+o))*4+3),o>0&&(l.push(((r+s)*t+(r-o))*4+3),s>0&&l.push(((r-s)*t+(r-o))*4+3))}const n=[];for(let s=0,o=i.length;s<o;++s)i[s]&&n.push(...i[s]);return Er[r]=n,n}const te={ANIMATING:0,INTERACTING:1};class Hc extends ga{constructor(t,e,i,n,s,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=be()}drawImages_(t,e,i,n){if(!this.image_)return;const s=fi(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.imageRotateWithView_&&(h+=this.viewRotation_);for(let u=0,g=s.length;u<g;u+=2){const p=s[u]-this.imageAnchorX_,_=s[u+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const w=p+this.imageAnchorX_,R=_+this.imageAnchorY_;ti(a,w,R,1,1,h,-w,-R),o.setTransform.apply(o,a),o.translate(w,R),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,p,_,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=fi(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<i;e+=n){const l=s[e]+this.textOffsetX_,h=s[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,i,n,s){const o=this.context_,a=fi(t,e,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return s&&o.closePath(),i}drawRings_(t,e,i,n){for(let s=0,o=i.length;s<o;++s)e=this.moveToLineTo_(t,e,i[s],n,!0);return e}drawCircle(t){if(ie(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=lc(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],s=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);!i||!ie(this.extent_,i.getExtent())||(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ie(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(ie(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getFlatCoordinates();let s=0;const o=t.getEnds(),a=t.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)s=this.moveToLineTo_(n,s,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ie(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ie(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const s=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=s.length;a<l;++a){const h=s[a];n=this.drawRings_(i,n,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),Ei(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:on;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:ve(i||De)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),n=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),u=s||en;this.strokeState_={lineCap:n!==void 0?n:Xn,lineDash:this.pixelRatio_===1?u:u.map(g=>g*this.pixelRatio_),lineDashOffset:(o||nn)*this.pixelRatio_,lineJoin:a!==void 0?a:Ui,lineWidth:(l!==void 0?l:an)*this.pixelRatio_,miterLimit:h!==void 0?h:rn,strokeStyle:ve(i||sn)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const _=e.getColor();this.textFillState_={fillStyle:ve(_||De)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const _=i.getColor(),w=i.getLineCap(),R=i.getLineDash(),S=i.getLineDashOffset(),T=i.getLineJoin(),v=i.getWidth(),O=i.getMiterLimit();this.textStrokeState_={lineCap:w!==void 0?w:Xn,lineDash:R||en,lineDashOffset:S||nn,lineJoin:T!==void 0?T:Ui,lineWidth:v!==void 0?v:an,miterLimit:O!==void 0?O:rn,strokeStyle:ve(_||sn)}}const n=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),u=t.getText(),g=t.getTextAlign(),p=t.getTextBaseline();this.textState_={font:n!==void 0?n:zo,textAlign:g!==void 0?g:on,textBaseline:p!==void 0?p:zn},this.text_=u!==void 0?Array.isArray(u)?u.reduce((_,w,R)=>_+=R%2?" ":w,""):u:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const Ee=.5;function Kc(r,t,e,i,n,s,o){const a=r[0]*Ee,l=r[1]*Ee,h=ce(a,l);h.imageSmoothingEnabled=!1;const u=h.canvas,g=new Hc(h,Ee,n,null,o),p=e.length,_=Math.floor((256*256*256-1)/p),w={};for(let S=1;S<=p;++S){const T=e[S-1],v=T.getStyleFunction()||i;if(!i)continue;let O=v(T,s);if(!O)continue;Array.isArray(O)||(O=[O]);const E="#"+("000000"+(S*_).toString(16)).slice(-6);for(let I=0,A=O.length;I<A;++I){const k=O[I],F=k.getGeometryFunction()(T);if(!F||!ie(n,F.getExtent()))continue;const V=k.clone(),Y=V.getFill();Y&&Y.setColor(E);const N=V.getStroke();N&&(N.setColor(E),N.setLineDash(null)),V.setText(void 0);const q=k.getImage();if(q&&q.getOpacity()!==0){const G=q.getImageSize();if(!G)continue;const U=ce(G[0],G[1],void 0,{alpha:!1}),W=U.canvas;U.fillStyle=E,U.fillRect(0,0,W.width,W.height),V.setImage(new lr({img:W,imgSize:G,anchor:q.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:q.getOrigin(),opacity:1,size:q.getSize(),scale:q.getScale(),rotation:q.getRotation(),rotateWithView:q.getRotateWithView()}))}const B=V.getZIndex()||0;let H=w[B];H||(H={},w[B]=H,H.Polygon=[],H.Circle=[],H.LineString=[],H.Point=[]),H[F.getType().replace("Multi","")].push(F,V)}}const R=Object.keys(w).map(Number).sort(pi);for(let S=0,T=R.length;S<T;++S){const v=w[R[S]];for(const O in v){const M=v[O];for(let E=0,I=M.length;E<I;E+=2){g.setStyle(M[E+1]);for(let A=0,k=t.length;A<k;++A)g.setTransform(t[A]),g.drawGeometry(M[E])}}}return h.getImageData(0,0,u.width,u.height)}function Zc(r,t,e){const i=[];if(e){const n=Math.floor(Math.round(r[0])*Ee),s=Math.floor(Math.round(r[1])*Ee),o=(Bt(n,0,e.width-1)+Bt(s,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],u=e.data[o+2]+256*(l+256*a),g=Math.floor((256*256*256-1)/t.length);u&&u%g===0&&i.push(t[u/g-1])}return i}const Jc=.5,_a={Point:ah,LineString:rh,Polygon:ch,MultiPoint:lh,MultiLineString:sh,MultiPolygon:oh,GeometryCollection:nh,Circle:eh};function Qc(r,t){return parseInt(xt(r),10)-parseInt(xt(t),10)}function th(r,t){const e=Wr(r,t);return e*e}function Wr(r,t){return Jc*r/t}function eh(r,t,e,i,n){const s=e.getFill(),o=e.getStroke();if(s||o){const l=r.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(t,i)}const a=e.getText();if(a&&a.getText()){const l=(n||r).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}}function mo(r,t,e,i,n,s,o){let a=!1;const l=e.getImage();if(l){const h=l.getImageState();h==$t.LOADED||h==$t.ERROR?l.unlistenImageChange(n):(h==$t.IDLE&&l.load(),l.listenImageChange(n),a=!0)}return ih(r,t,e,i,s,o),a}function ih(r,t,e,i,n,s){const o=e.getGeometryFunction()(t);if(!o)return;const a=o.simplifyTransformed(i,n);if(e.getRenderer())ya(r,a,e,t);else{const h=_a[a.getType()];h(r,a,e,t,s)}}function ya(r,t,e,i){if(t.getType()=="GeometryCollection"){const s=t.getGeometries();for(let o=0,a=s.length;o<a;++o)ya(r,s[o],e,i);return}r.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer())}function nh(r,t,e,i,n){const s=t.getGeometriesArray();let o,a;for(o=0,a=s.length;o<a;++o){const l=_a[s[o].getType()];l(r,s[o],e,i,n)}}function rh(r,t,e,i,n){const s=e.getStroke();if(s){const a=r.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(t,i)}const o=e.getText();if(o&&o.getText()){const a=(n||r).getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}}function sh(r,t,e,i,n){const s=e.getStroke();if(s){const a=r.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(t,i)}const o=e.getText();if(o&&o.getText()){const a=(n||r).getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}}function oh(r,t,e,i,n){const s=e.getFill(),o=e.getStroke();if(o||s){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(t,i)}const a=e.getText();if(a&&a.getText()){const l=(n||r).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}}function ah(r,t,e,i,n){const s=e.getImage(),o=e.getText();let a;if(s){if(s.getImageState()!=$t.LOADED)return;let l=r;if(n){const u=s.getDeclutterMode();if(u!=="none")if(l=n,u==="obstacle"){const g=r.getBuilder(e.getZIndex(),"Image");g.setImageStyle(s,a),g.drawPoint(t,i)}else o&&o.getText()&&(a={})}const h=l.getBuilder(e.getZIndex(),"Image");h.setImageStyle(s,a),h.drawPoint(t,i)}if(o&&o.getText()){let l=r;n&&(l=n);const h=l.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(t,i)}}function lh(r,t,e,i,n){const s=e.getImage(),o=e.getText();let a;if(s){if(s.getImageState()!=$t.LOADED)return;let l=r;if(n){const u=s.getDeclutterMode();if(u!=="none")if(l=n,u==="obstacle"){const g=r.getBuilder(e.getZIndex(),"Image");g.setImageStyle(s,a),g.drawMultiPoint(t,i)}else o&&o.getText()&&(a={})}const h=l.getBuilder(e.getZIndex(),"Image");h.setImageStyle(s,a),h.drawMultiPoint(t,i)}if(o&&o.getText()){let l=r;n&&(l=n);const h=l.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(t,i)}}function ch(r,t,e,i,n){const s=e.getFill(),o=e.getStroke();if(s||o){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(t,i)}const a=e.getText();if(a&&a.getText()){const l=(n||r).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}}class hh extends ma{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=ge(),this.wrappedRenderedExtent_=ge(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const n=e.extent,s=e.viewState,o=s.center,a=s.resolution,l=s.projection,h=s.rotation,u=l.getExtent(),g=this.getLayer().getSource(),p=e.pixelRatio,_=e.viewHints,w=!(_[te.ANIMATING]||_[te.INTERACTING]),R=this.compositionContext_,S=Math.round(e.size[0]*p),T=Math.round(e.size[1]*p),v=g.getWrapX()&&l.canWrapX(),O=v?Pt(u):null,M=v?Math.ceil((n[2]-u[2])/O)+1:1;let E=v?Math.floor((n[0]-u[0])/O):0;do{const I=this.getRenderTransform(o,a,h,p,S,T,E*O);t.execute(R,1,I,h,w,void 0,i)}while(++E<M)}setupCompositionContext_(){if(this.opacity_!==1){const t=ce(this.context.canvas.width,this.context.canvas.height,uo);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,jo(this.compositionContext_),uo.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,n=t.layerStatesArray[t.layerIndex];kl(this.pixelTransform,1/i,1/i),as(this.inversePixelTransform,this.pixelTransform);const s=Wo(this.pixelTransform);this.useContainer(e,s,this.getBackground(t));const o=this.context,a=o.canvas,l=this.replayGroup_,h=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!h||h.isEmpty()))return null;const u=Math.round(t.size[0]*i),g=Math.round(t.size[1]*i);a.width!=u||a.height!=g?(a.width=u,a.height=g,a.style.transform!==s&&(a.style.transform=s)):this.containerReused||o.clearRect(0,0,u,g),this.preRender(o,t);const p=t.viewState,_=p.projection;this.opacity_=n.opacity,this.setupCompositionContext_();let w=!1,R=!0;if(n.extent&&this.clipping){const S=ci(n.extent,_);R=ie(S,t.extent),w=R&&!Mi(S,t.extent),w&&this.clipUnrotated(this.compositionContext_,t,S)}return R&&this.renderWorlds(l,t),w&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==p.rotation&&(this.renderedRotation_=p.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise((function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];Kt(this.pixelTransform,i);const n=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),u=[],g=i[0]*Ee,p=i[1]*Ee;u.push(this.getRenderTransform(n,s,o,Ee,g,p,0).slice());const _=h.getSource(),w=a.getExtent();if(_.getWrapX()&&a.canWrapX()&&!Mi(w,l)){let R=l[0];const S=Pt(w);let T=0,v;for(;R<w[0];)--T,v=S*T,u.push(this.getRenderTransform(n,s,o,Ee,g,p,v).slice()),R+=S;for(T=0,R=l[2];R>w[2];)++T,v=S*T,u.push(this.getRenderTransform(n,s,o,Ee,g,p,v).slice()),R-=S}this.hitDetectionImageData_=Kc(i,u,this.renderedFeatures_,h.getStyleFunction(),l,s,o)}e(Zc(t,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))}forEachFeatureAtCoordinate(t,e,i,n,s){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},u=function(_,w,R){const S=xt(_),T=h[S];if(T){if(T!==!0&&R<T.distanceSq){if(R===0)return h[S]=!0,s.splice(s.lastIndexOf(T),1),n(_,l,w);T.geometry=w,T.distanceSq=R}}else{if(R===0)return h[S]=!0,n(_,l,w);s.push(h[S]={feature:_,layer:l,geometry:w,distanceSq:R,callback:n})}};let g;const p=[this.replayGroup_];return this.declutterExecutorGroup&&p.push(this.declutterExecutorGroup),p.some(_=>g=_.forEachFeatureAtCoordinate(t,o,a,i,u,_===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(w=>w.value):null)),g}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const n=t.viewHints[te.ANIMATING],s=t.viewHints[te.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,u=h.projection,g=h.resolution,p=t.pixelRatio,_=e.getRevision(),w=e.getRenderBuffer();let R=e.getRenderOrder();R===void 0&&(R=Qc);const S=h.center.slice(),T=Jr(l,w*g),v=T.slice(),O=[T.slice()],M=u.getExtent();if(i.getWrapX()&&u.canWrapX()&&!Mi(M,t.extent)){const G=Pt(M),U=Math.max(Pt(T)/2,G);T[0]=M[0]-U,T[2]=M[2]+U,$o(S,u);const W=No(O[0],u);W[0]<M[0]&&W[2]<M[2]?O.push([W[0]+G,W[1],W[2]+G,W[3]]):W[0]>M[0]&&W[2]>M[2]&&O.push([W[0]-G,W[1],W[2]-G,W[3]])}if(this.ready&&this.renderedResolution_==g&&this.renderedRevision_==_&&this.renderedRenderOrder_==R&&Mi(this.wrappedRenderedExtent_,T))return Ei(this.renderedExtent_,v)||(this.hitDetectionImageData_=null,this.renderedExtent_=v),this.renderedCenter_=S,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const E=new ho(Wr(g,p),T,g,p);let I;this.getLayer().getDeclutter()&&(I=new ho(Wr(g,p),T,g,p));const A=Zo();let k;if(A){for(let G=0,U=O.length;G<U;++G){const W=O[G],st=Xr(W,u);i.loadFeatures(st,nc(g,u),A)}k=cr(A,u)}else for(let G=0,U=O.length;G<U;++G)i.loadFeatures(O[G],g,u);const F=th(g,p);let V=!0;const Y=(function(G){let U;const W=G.getStyleFunction()||e.getStyleFunction();if(W&&(U=W(G,g)),U){const st=this.renderFeature(G,F,U,E,k,I);V=V&&!st}}).bind(this),N=Xr(T,u),q=i.getFeaturesInExtent(N);R&&q.sort(R);for(let G=0,U=q.length;G<U;++G)Y(q[G]);this.renderedFeatures_=q,this.ready=V;const B=E.finish(),H=new po(T,g,p,i.getOverlaps(),B,e.getRenderBuffer());return I&&(this.declutterExecutorGroup=new po(T,g,p,i.getOverlaps(),I.finish(),e.getRenderBuffer())),this.renderedResolution_=g,this.renderedRevision_=_,this.renderedRenderOrder_=R,this.renderedExtent_=v,this.wrappedRenderedExtent_=T,this.renderedCenter_=S,this.renderedProjection_=u,this.replayGroup_=H,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,s,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,h=i.length;l<h;++l)a=mo(n,t,i[l],e,this.boundHandleStyleImageChange_,s,o)||a;else a=mo(n,t,i,e,this.boundHandleStyleImageChange_,s,o);return a}}class Es extends kc{constructor(t){super(t)}createRenderer(){return new hh(this)}}class _o{constructor(t){this.rbush_=new fa(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[xt(e)]=i}load(t,e){const i=new Array(e.length);for(let n=0,s=e.length;n<s;n++){const o=t[n],a=e[n],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[n]=l,this.items_[xt(a)]=l}this.rbush_.load(i)}remove(t){const e=xt(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[xt(e)],n=[i.minX,i.minY,i.maxX,i.maxY];Qi(n,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,s=t.length;n<s;n++)if(i=e(t[n]),i)return i;return i}isEmpty(){return Gi(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Re(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class wa extends Ce{constructor(t){super(),this.projection=zt(t.projection),this.attributions_=yo(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,n){e.viewResolver=i,e.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return ft()}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=yo(t),this.changed()}setState(t){this.state_=t,this.changed()}}function yo(r){return r?Array.isArray(r)?function(t){return r}:typeof r=="function"?r:function(t){return[r]}:null}const _e={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function uh(r,t){return[[-1/0,-1/0,1/0,1/0]]}let dh=!1;function fh(r,t,e,i,n,s,o){const a=new XMLHttpRequest;a.open("GET",typeof r=="function"?r(e,i,n):r,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=dh,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let u;h=="json"||h=="text"?u=a.responseText:h=="xml"?(u=a.responseXML,u||(u=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(u=a.response),u?s(t.readFeatures(u,{extent:e,featureProjection:n}),t.readProjection(u)):o()}else o()},a.onerror=o,a.send()}function wo(r,t){return function(e,i,n,s,o){const a=this;fh(r,t,e,i,n,function(l,h){a.addFeatures(l),s!==void 0&&s(l)},o||mi)}}class ze extends ke{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class Ea extends wa{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=mi,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(wt(this.format_,7),this.loader_=wo(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:uh;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new _o:null,this.loadedExtentsRtree_=new _o,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),!e&&i===void 0&&(i=new xe(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=xt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new ze(_e.ADDFEATURE,t))}setupChangeEvents_(t,e){this.featureChangeKeys_[t]=[Et(e,pt.CHANGE,this.handleFeatureChange_,this),Et(e,Fi.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;const n=e.getId();return n!==void 0&&(n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=e),i&&(wt(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],n=[];for(let s=0,o=t.length;s<o;s++){const a=t[s],l=xt(a);this.addToIndex_(l,a)&&i.push(a)}for(let s=0,o=i.length;s<o;s++){const a=i[s],l=xt(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const u=h.getExtent();e.push(u),n.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(_e.ADDFEATURE))for(let s=0,o=i.length;s<o;s++)this.dispatchEvent(new ze(_e.ADDFEATURE,i[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(_e.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(_e.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(ne.ADD,(function(i){e||(e=!0,this.addFeature(i.element),e=!1)}).bind(this)),t.addEventListener(ne.REMOVE,(function(i){e||(e=!0,this.removeFeature(i.element),e=!1)}).bind(this)),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(Nt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=(function(n){this.removeFeatureInternal(n)}).bind(this);this.featuresRtree_.forEach(i);for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new ze(_e.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(n){if(n.getGeometry().intersectsCoordinate(t))return e(n)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){if(i.getGeometry().intersectsExtent(t)){const s=e(i);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Gi(this.nullGeometryFeatures_)||Ne(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const n=Qa(t,e);return[].concat(...n.map(s=>this.featuresRtree_.getInExtent(s)))}else return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],n=t[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||tn,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const u=h.getGeometry(),g=a;if(a=u.closestPointXY(i,n,o,a),a<g){s=h;const p=Math.sqrt(a);l[0]=i-p,l[1]=n-p,l[2]=i+p,l[3]=n+p}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=xt(e),n=e.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const o=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const s=e.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new ze(_e.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:xt(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Gi(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const n=this.loadedExtentsRtree_,s=this.strategy_(t,e,i);for(let o=0,a=s.length;o<a;++o){const l=s[o];n.forEachInExtent(l,function(u){return Mi(u.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new ze(_e.FEATURESLOADSTART)),this.loader_.call(this,l,e,i,(function(u){--this.loadingExtentsCount_,this.dispatchEvent(new ze(_e.FEATURESLOADEND,void 0,u))}).bind(this),(function(){--this.loadingExtentsCount_,this.dispatchEvent(new ze(_e.FEATURESLOADERROR))}).bind(this)),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(n){if(Qi(n.extent,t))return i=n,!0}),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=xt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=xt(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(Nt),delete this.featureChangeKeys_[e];const n=t.getId();return n!==void 0&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.dispatchEvent(new ze(_e.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){wt(this.format_,7),this.url_=t,this.setLoader(wo(t,this.format_))}}class Be extends ke{constructor(t,e){super(t),this.layer=e}}const vr={LAYERS:"layers"};class Xi extends ua{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(vr.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new xe(i.slice(),{unique:!0}):wt(typeof i.getArray=="function",43):i=new xe(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Nt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(Et(t,ne.ADD,this.handleLayersAdd_,this),Et(t,ne.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(Nt);pn(this.listenerKeys_);const e=t.getArray();for(let i=0,n=e.length;i<n;i++){const s=e[i];this.registerLayerListeners_(s),this.dispatchEvent(new Be("addlayer",s))}this.changed()}registerLayerListeners_(t){const e=[Et(t,Fi.PROPERTYCHANGE,this.handleLayerChange_,this),Et(t,pt.CHANGE,this.handleLayerChange_,this)];t instanceof Xi&&e.push(Et(t,"addlayer",this.handleLayerGroupAdd_,this),Et(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[xt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Be("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Be("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Be("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=xt(e);this.listenerKeys_[i].forEach(Nt),delete this.listenerKeys_[i],this.dispatchEvent(new Be("removelayer",e)),this.changed()}getLayers(){return this.get(vr.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let n=0,s=i.length;n<s;++n)this.dispatchEvent(new Be("removelayer",i[n]))}this.set(vr.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const n=this.getLayerState();let s=n.zIndex;!t&&n.zIndex===void 0&&(s=0);for(let o=i,a=e.length;o<a;o++){const l=e[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),n.extent!==void 0&&(l.extent!==void 0?l.extent=Zi(l.extent,n.extent):l.extent=n.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}class gh{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?zt(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=zt(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return ft()}readFeature(t,e){return ft()}readFeatures(t,e){return ft()}readGeometry(t,e){return ft()}readProjection(t){return ft()}writeFeature(t,e){return ft()}writeFeatures(t,e){return ft()}writeGeometry(t,e){return ft()}}function va(r,t,e){const i=e?zt(e.featureProjection):null,n=e?zt(e.dataProjection):null;let s;if(i&&n&&!ai(i,n)?s=(t?r.clone():r).transform(t?i:n,t?n:i):s=r,t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,u=l.length;h<u;++h)l[h]=Math.round(l[h]*o)/o;return l};s===r&&(s=r.clone()),s.applyTransform(a)}return s}const ct={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function xa(r){return Math.pow(r,3)}function zi(r){return 1-xa(1-r)}function ph(r){return 3*r*r-2*r*r*r}function mh(r){return r}class ba extends sr{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(pt.CHANGE)}release(){this.state===ct.ERROR&&this.setState(ct.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==ct.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==ct.LOADED){t.interimTile=null;break}else t.getState()==ct.LOADING?e=t:t.getState()==ct.IDLE?e.interimTile=t.interimTile:e=t;t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==ct.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){ft()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const n=e-i+1e3/60;return n>=this.transition_?1:xa(n/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}class Ra extends ba{constructor(t,e,i,n,s,o){super(t,e,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=ct.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=ct.ERROR,this.unlistenImage_(),this.image_=_h(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=ct.LOADED:this.state=ct.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==ct.ERROR&&(this.state=ct.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==ct.IDLE&&(this.state=ct.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Vo(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function _h(){const r=ce(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}const yh=.5,wh=10,Eo=.25;class Eh{constructor(t,e,i,n,s,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=cn(this.targetProj_,this.sourceProj_);this.transformInv_=function(v){const O=v[0]+"/"+v[1];return a[O]||(a[O]=l(v)),a[O]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Pt(n)==Pt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Pt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Pt(this.targetProj_.getExtent()):null;const h=wi(i),u=er(i),g=tr(i),p=Qn(i),_=this.transformInv_(h),w=this.transformInv_(u),R=this.transformInv_(g),S=this.transformInv_(p),T=wh+(o?Math.max(0,Math.ceil(Math.log2(Lr(i)/(o*o*256*256)))):0);if(this.addQuad_(h,u,g,p,_,w,R,S,T),this.wrapsXInSource_){let v=1/0;this.triangles_.forEach(function(O,M,E){v=Math.min(v,O.source[0][0],O.source[1][0],O.source[2][0])}),this.triangles_.forEach((function(O){if(Math.max(O.source[0][0],O.source[1][0],O.source[2][0])-v>this.sourceWorldWidth_/2){const M=[[O.source[0][0],O.source[0][1]],[O.source[1][0],O.source[1][1]],[O.source[2][0],O.source[2][1]]];M[0][0]-v>this.sourceWorldWidth_/2&&(M[0][0]-=this.sourceWorldWidth_),M[1][0]-v>this.sourceWorldWidth_/2&&(M[1][0]-=this.sourceWorldWidth_),M[2][0]-v>this.sourceWorldWidth_/2&&(M[2][0]-=this.sourceWorldWidth_);const E=Math.min(M[0][0],M[1][0],M[2][0]);Math.max(M[0][0],M[1][0],M[2][0])-E<this.sourceWorldWidth_/2&&(O.source=M)}}).bind(this))}a={}}addTriangle_(t,e,i,n,s,o){this.triangles_.push({source:[n,s,o],target:[t,e,i]})}addQuad_(t,e,i,n,s,o,a,l,h){const u=Ar([s,o,a,l]),g=this.sourceWorldWidth_?Pt(u)/this.sourceWorldWidth_:null,p=this.sourceWorldWidth_,_=this.sourceProj_.canWrapX()&&g>.5&&g<1;let w=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const S=Ar([t,e,i,n]);w=Pt(S)/this.targetWorldWidth_>Eo||w}!_&&this.sourceProj_.isGlobal()&&g&&(w=g>Eo||w)}if(!w&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!ie(u,this.maxSourceExtent_))return;let R=0;if(!w&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)w=!0;else if(R=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),R!=1&&R!=2&&R!=4&&R!=8)return}if(h>0){if(!w){const S=[(t[0]+i[0])/2,(t[1]+i[1])/2],T=this.transformInv_(S);let v;_?v=(Ni(s[0],p)+Ni(a[0],p))/2-Ni(T[0],p):v=(s[0]+a[0])/2-T[0];const O=(s[1]+a[1])/2-T[1];w=v*v+O*O>this.errorThresholdSquared_}if(w){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const S=[(e[0]+i[0])/2,(e[1]+i[1])/2],T=this.transformInv_(S),v=[(n[0]+t[0])/2,(n[1]+t[1])/2],O=this.transformInv_(v);this.addQuad_(t,e,S,v,s,o,T,O,h-1),this.addQuad_(v,S,i,n,O,T,a,l,h-1)}else{const S=[(t[0]+e[0])/2,(t[1]+e[1])/2],T=this.transformInv_(S),v=[(i[0]+n[0])/2,(i[1]+n[1])/2],O=this.transformInv_(v);this.addQuad_(t,S,v,n,s,T,O,l,h-1),this.addQuad_(S,e,i,v,T,o,a,O,h-1)}return}}if(_){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}R&11||this.addTriangle_(t,i,n,s,a,l),R&14||this.addTriangle_(t,i,e,s,a,o),R&&(R&13||this.addTriangle_(e,n,t,o,l,s),R&7||this.addTriangle_(e,n,i,o,l,a))}calculateSourceExtent(){const t=ge();return this.triangles_.forEach(function(e,i,n){const s=e.source;Ki(t,s[0]),Ki(t,s[1]),Ki(t,s[2])}),t}getTriangles(){return this.triangles_}}let xr;const Sa=[];function vo(r,t,e,i,n){r.beginPath(),r.moveTo(0,0),r.lineTo(t,e),r.lineTo(i,n),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(t,i)+1,Math.max(e,n)),r.restore()}function br(r,t){return Math.abs(r[t*4]-210)>2||Math.abs(r[t*4+3]-.75*255)>2}function vh(){if(xr===void 0){const r=document.createElement("canvas").getContext("2d");r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",vo(r,4,5,4,0),vo(r,4,5,0,5);const t=r.getImageData(0,0,3,3).data;xr=br(t,0)||br(t,4)||br(t,8)}return xr}function xo(r,t,e,i){const n=us(e,t,r);let s=Ks(t,i,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=r.getMetersPerUnit();a!==void 0&&(s/=a);const l=r.getExtent();if(!l||Jn(l,n)){const h=Ks(r,s,n)/s;isFinite(h)&&h>0&&(s/=h)}return s}function xh(r,t,e,i){const n=gi(e);let s=xo(r,t,n,i);return(!isFinite(s)||s<=0)&&Po(e,function(o){return s=xo(r,t,o,i),isFinite(s)&&s>0}),s}function bh(r,t,e,i,n,s,o,a,l,h,u,g){const p=ce(Math.round(e*r),Math.round(e*t),Sa);if(g||(p.imageSmoothingEnabled=!1),l.length===0)return p.canvas;p.scale(e,e);function _(M){return Math.round(M*e)/e}p.globalCompositeOperation="lighter";const w=ge();l.forEach(function(M,E,I){Lo(w,M.extent)});const R=Pt(w),S=Se(w),T=ce(Math.round(e*R/i),Math.round(e*S/i));g||(T.imageSmoothingEnabled=!1);const v=e/i;l.forEach(function(M,E,I){const A=M.extent[0]-w[0],k=-(M.extent[3]-w[3]),F=Pt(M.extent),V=Se(M.extent);M.image.width>0&&M.image.height>0&&T.drawImage(M.image,h,h,M.image.width-2*h,M.image.height-2*h,A*v,k*v,F*v,V*v)});const O=wi(o);return a.getTriangles().forEach(function(M,E,I){const A=M.source,k=M.target;let F=A[0][0],V=A[0][1],Y=A[1][0],N=A[1][1],q=A[2][0],B=A[2][1];const H=_((k[0][0]-O[0])/s),G=_(-(k[0][1]-O[1])/s),U=_((k[1][0]-O[0])/s),W=_(-(k[1][1]-O[1])/s),st=_((k[2][0]-O[0])/s),K=_(-(k[2][1]-O[1])/s),gt=F,X=V;F=0,V=0,Y-=gt,N-=X,q-=gt,B-=X;const mt=[[Y,N,0,0,U-H],[q,B,0,0,st-H],[0,0,Y,N,W-G],[0,0,q,B,K-G]],nt=rl(mt);if(nt){if(p.save(),p.beginPath(),vh()||!g){p.moveTo(U,W);const tt=4,jt=H-U,ut=G-W;for(let D=0;D<tt;D++)p.lineTo(U+_((D+1)*jt/tt),W+_(D*ut/(tt-1))),D!=tt-1&&p.lineTo(U+_((D+1)*jt/tt),W+_((D+1)*ut/(tt-1)));p.lineTo(st,K)}else p.moveTo(U,W),p.lineTo(H,G),p.lineTo(st,K);p.clip(),p.transform(nt[0],nt[2],nt[1],nt[3],H,G),p.translate(w[0]-gt,w[3]-X),p.scale(i/e,-i/e),p.drawImage(T.canvas,0,0),p.restore()}}),u&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,a.getTriangles().forEach(function(M,E,I){const A=M.target,k=(A[0][0]-O[0])/s,F=-(A[0][1]-O[1])/s,V=(A[1][0]-O[0])/s,Y=-(A[1][1]-O[1])/s,N=(A[2][0]-O[0])/s,q=-(A[2][1]-O[1])/s;p.beginPath(),p.moveTo(V,Y),p.lineTo(k,F),p.lineTo(N,q),p.closePath(),p.stroke()}),p.restore()),p.canvas}class Br extends ba{constructor(t,e,i,n,s,o,a,l,h,u,g,p){super(s,ct.IDLE,{interpolate:!!p}),this.renderEdges_=g!==void 0?g:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const _=n.getTileCoordExtent(this.wrappedTileCoord_),w=this.targetTileGrid_.getExtent();let R=this.sourceTileGrid_.getExtent();const S=w?Zi(_,w):_;if(Lr(S)===0){this.state=ct.EMPTY;return}const T=t.getExtent();T&&(R?R=Zi(R,T):R=T);const v=n.getResolution(this.wrappedTileCoord_[0]),O=xh(t,i,S,v);if(!isFinite(O)||O<=0){this.state=ct.EMPTY;return}const M=u!==void 0?u:yh;if(this.triangulation_=new Eh(t,i,S,R,O*M,v),this.triangulation_.getTriangles().length===0){this.state=ct.EMPTY;return}this.sourceZ_=e.getZForResolution(O);let E=this.triangulation_.calculateSourceExtent();if(R&&(t.canWrapX()?(E[1]=Bt(E[1],R[1],R[3]),E[3]=Bt(E[3],R[1],R[3])):E=Zi(E,R)),!Lr(E))this.state=ct.EMPTY;else{const I=e.getTileRangeForExtentAndZ(E,this.sourceZ_);for(let A=I.minX;A<=I.maxX;A++)for(let k=I.minY;k<=I.maxY;k++){const F=h(this.sourceZ_,A,k,a);F&&this.sourceTiles_.push(F)}this.sourceTiles_.length===0&&(this.state=ct.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach((function(e,i,n){e&&e.getState()==ct.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}).bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=ct.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=bh(n,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=ct.LOADED}this.changed()}load(){if(this.state==ct.IDLE){this.state=ct.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((function(e,i,n){const s=e.getState();if(s==ct.IDLE||s==ct.LOADING){t++;const o=Et(e,pt.CHANGE,function(a){const l=e.getState();(l==ct.LOADED||l==ct.ERROR||l==ct.EMPTY)&&(Nt(o),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}).bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,i,n){e.getState()==ct.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Nt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(jo(this.canvas_.getContext("2d")),Sa.push(this.canvas_),this.canvas_=null),super.release()}}class vs{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Ti(r,t,e,i,n){return n!==void 0?(n.minX=r,n.maxX=t,n.minY=e,n.maxY=i,n):new vs(r,t,e,i)}class Rh extends ma{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=ge(),this.tmpTileRange_=new vs(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return i==ct.LOADED||i==ct.EMPTY||i==ct.ERROR&&!n}getTile(t,e,i,n){const s=n.pixelRatio,o=n.viewState.projection,a=this.getLayer();let h=a.getSource().getTile(t,e,i,s,o);return h.getState()==ct.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),n=Kt(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!Jn(s,n))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=i.getRenderSource(),u=h.getTileGridForProjection(l.projection),g=h.getTilePixelRatio(e.pixelRatio);for(let p=u.getZForResolution(l.resolution);p>=u.getMinZoom();--p){const _=u.getTileCoordForCoordAndZ(n,p),w=h.getTile(p,_[1],_[2],o,a);if(!(w instanceof Ra||w instanceof Br)||w instanceof Br&&w.getState()===ct.EMPTY)return null;if(w.getState()!==ct.LOADED)continue;const R=u.getOrigin(p),S=le(u.getTileSize(p)),T=u.getResolution(p),v=Math.floor(g*((n[0]-R[0])/T-_[1]*S[0])),O=Math.floor(g*((R[1]-n[1])/T-_[2]*S[1])),M=Math.round(g*h.getGutterForProjection(l.projection));return this.getImageData(w.getImage(),v+M,O+M)}return null}loadedTileCallback(t,e,i){return this.isDrawableTile(i)?super.loadedTileCallback(t,e,i):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],n=t.viewState,s=n.projection,o=n.resolution,a=n.center,l=n.rotation,h=t.pixelRatio,u=this.getLayer(),g=u.getSource(),p=g.getRevision(),_=g.getTileGridForProjection(s),w=_.getZForResolution(o,g.zDirection),R=_.getResolution(w);let S=t.extent;const T=t.viewState.resolution,v=g.getTilePixelRatio(h),O=Math.round(Pt(S)/T*h),M=Math.round(Se(S)/T*h),E=i.extent&&ci(i.extent,s);E&&(S=Zi(S,ci(i.extent,s)));const I=R*O/2/v,A=R*M/2/v,k=[a[0]-I,a[1]-A,a[0]+I,a[1]+A],F=_.getTileRangeForExtentAndZ(S,w),V={};V[w]={};const Y=this.createLoadedTileFinder(g,s,V),N=this.tmpExtent,q=this.tmpTileRange_;this.newTiles_=!1;const B=l?Pr(n.center,T,l,t.size):void 0;for(let mt=F.minX;mt<=F.maxX;++mt)for(let nt=F.minY;nt<=F.maxY;++nt){if(l&&!_.tileCoordIntersectsViewport([w,mt,nt],B))continue;const tt=this.getTile(w,mt,nt,t);if(this.isDrawableTile(tt)){const D=xt(this);if(tt.getState()==ct.LOADED){V[w][tt.tileCoord.toString()]=tt;let z=tt.inTransition(D);z&&i.opacity!==1&&(tt.endTransition(D),z=!1),!this.newTiles_&&(z||!this.renderedTiles.includes(tt))&&(this.newTiles_=!0)}if(tt.getAlpha(D,t.time)===1)continue}const jt=_.getTileCoordChildTileRange(tt.tileCoord,q,N);let ut=!1;jt&&(ut=Y(w+1,jt)),ut||_.forEachTileCoordParentTileRange(tt.tileCoord,Y,q,N)}const H=R/o*h/v;ti(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-O/2,-M/2);const G=Wo(this.pixelTransform);this.useContainer(e,G,this.getBackground(t));const U=this.context,W=U.canvas;as(this.inversePixelTransform,this.pixelTransform),ti(this.tempTransform,O/2,M/2,H,H,0,-O/2,-M/2),W.width!=O||W.height!=M?(W.width=O,W.height=M):this.containerReused||U.clearRect(0,0,O,M),E&&this.clipUnrotated(U,t,E),g.getInterpolate()||(U.imageSmoothingEnabled=!1),this.preRender(U,t),this.renderedTiles.length=0;let st=Object.keys(V).map(Number);st.sort(pi);let K,gt,X;i.opacity===1&&(!this.containerReused||g.getOpaque(t.viewState.projection))?st=st.reverse():(K=[],gt=[]);for(let mt=st.length-1;mt>=0;--mt){const nt=st[mt],tt=g.getTilePixelSize(nt,h,s),ut=_.getResolution(nt)/R,D=tt[0]*ut*H,z=tt[1]*ut*H,Z=_.getTileCoordForCoordAndZ(wi(k),nt),rt=_.getTileCoordExtent(Z),J=Kt(this.tempTransform,[v*(rt[0]-k[0])/R,v*(k[3]-rt[3])/R]),Q=v*g.getGutterForProjection(s),yt=V[nt];for(const bt in yt){const It=yt[bt],At=It.tileCoord,re=Z[1]-At[1],_t=Math.round(J[0]-(re-1)*D),Lt=Z[2]-At[2],Gt=Math.round(J[1]-(Lt-1)*z),kt=Math.round(J[0]-re*D),Ct=Math.round(J[1]-Lt*z),Zt=_t-kt,Yt=Gt-Ct,he=w===nt,Jt=he&&It.getAlpha(xt(this),t.time)!==1;let se=!1;if(!Jt)if(K){X=[kt,Ct,kt+Zt,Ct,kt+Zt,Ct+Yt,kt,Ct+Yt];for(let ue=0,oe=K.length;ue<oe;++ue)if(w!==nt&&nt<gt[ue]){const Ut=K[ue];ie([kt,Ct,kt+Zt,Ct+Yt],[Ut[0],Ut[3],Ut[4],Ut[7]])&&(se||(U.save(),se=!0),U.beginPath(),U.moveTo(X[0],X[1]),U.lineTo(X[2],X[3]),U.lineTo(X[4],X[5]),U.lineTo(X[6],X[7]),U.moveTo(Ut[6],Ut[7]),U.lineTo(Ut[4],Ut[5]),U.lineTo(Ut[2],Ut[3]),U.lineTo(Ut[0],Ut[1]),U.clip())}K.push(X),gt.push(nt)}else U.clearRect(kt,Ct,Zt,Yt);this.drawTileImage(It,t,kt,Ct,Zt,Yt,Q,he),K&&!Jt?(se&&U.restore(),this.renderedTiles.unshift(It)):this.renderedTiles.push(It),this.updateUsedTiles(t.usedTiles,g,It)}}return this.renderedRevision=p,this.renderedResolution=R,this.extentChanged=!this.renderedExtent_||!Qi(this.renderedExtent_,k),this.renderedExtent_=k,this.renderedPixelRatio=h,this.renderedProjection=s,this.manageTilePyramid(t,g,_,h,s,S,w,u.getPreload()),this.scheduleExpireCache(t,g),this.postRender(U,t),i.extent&&U.restore(),U.imageSmoothingEnabled=!0,G!==W.style.transform&&(W.style.transform=G),this.container}drawTileImage(t,e,i,n,s,o,a,l){const h=this.getTileImage(t);if(!h)return;const u=xt(this),g=e.layerStatesArray[e.layerIndex],p=g.opacity*(l?t.getAlpha(u,e.time):1),_=p!==this.context.globalAlpha;_&&(this.context.save(),this.context.globalAlpha=p),this.context.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,n,s,o),_&&this.context.restore(),p!==g.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=(function(n,s,o){const a=xt(n);a in o.usedTiles&&n.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const n=xt(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}manageTilePyramid(t,e,i,n,s,o,a,l,h){const u=xt(e);u in t.wantedTiles||(t.wantedTiles[u]={});const g=t.wantedTiles[u],p=t.tileQueue,_=i.getMinZoom(),w=t.viewState.rotation,R=w?Pr(t.viewState.center,t.viewState.resolution,w,t.size):void 0;let S=0,T,v,O,M,E,I;for(I=_;I<=a;++I)for(v=i.getTileRangeForExtentAndZ(o,I,v),O=i.getResolution(I),M=v.minX;M<=v.maxX;++M)for(E=v.minY;E<=v.maxY;++E)w&&!i.tileCoordIntersectsViewport([I,M,E],R)||(a-I<=l?(++S,T=e.getTile(I,M,E,n,s),T.getState()==ct.IDLE&&(g[T.getKey()]=!0,p.isKeyQueued(T.getKey())||p.enqueue([T,u,i.getTileCoordCenter(T.tileCoord),O])),h!==void 0&&h(T)):e.useTile(I,M,E,s));e.updateCacheSize(S,s)}}const Dn={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Sh{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return wt(i!==void 0,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return wt(e!==void 0,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){wt(!(t in this.entries_),16);const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}function bo(r,t,e,i){return i!==void 0?(i[0]=r,i[1]=t,i[2]=e,i):[r,t,e]}function gr(r,t,e){return r+"/"+t+"/"+e}function Ca(r){return gr(r[0],r[1],r[2])}function Ch(r){return r.split("/").map(Number)}function Th(r){return(r[1]<<r[0])+r[2]}function Ih(r,t){const e=r[0],i=r[1],n=r[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(i,n):!0}class Ta extends Sh{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),i=Ch(t)[0];this.forEach((function(n){n.tileCoord[0]!==i&&(this.remove(Ca(n.tileCoord)),n.release())}).bind(this))}}const Ah=42,xs=256,Oh=[0,0,0],Ye=5;class Ia{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,wt(wl(this.resolutions_,function(n,s){return s-n}),17);let e;if(!t.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!e)e=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,wt(this.origins_.length==this.resolutions_.length,20));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=wi(i)),wt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,wt(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:xs,wt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map(function(n,s){const o=new vs(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const n=this.getTileRangeForExtentAndZ(t,e);for(let s=n.minX,o=n.maxX;s<=o;++s)for(let a=n.minY,l=n.maxY;a<=l;++a)i([e,s,a])}forEachTileCoordParentTileRange(t,e,i,n){let s,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,n);h>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),a=Math.floor(a/2),s=Ti(o,o,a,a,i)):s=this.getTileRangeForExtentAndZ(l,h,i),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return Ti(s,s+1,o,o+1,e)}const n=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const n=t[0],s=t[1],o=t[2];if(e===n)return Ti(s,o,s,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-n),h=Math.floor(s*l),u=Math.floor(o*l);if(e<n)return Ti(h,h,u,u,i);const g=Math.floor(l*(s+1))-1,p=Math.floor(l*(o+1))-1;return Ti(h,g,u,p,i)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,i)}getTileRangeExtent(t,e,i){const n=this.getOrigin(t),s=this.getResolution(t),o=le(this.getTileSize(t),this.tmpSize_),a=n[0]+e.minX*o[0]*s,l=n[0]+(e.maxX+1)*o[0]*s,h=n[1]+e.minY*o[1]*s,u=n[1]+(e.maxY+1)*o[1]*s;return Re(a,h,l,u,i)}getTileRangeForExtentAndZ(t,e,i){const n=Oh;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);const s=n[1],o=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),Ti(s,n[1],o,n[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=le(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=le(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*s[0]*n,a=i[1]-(t[2]+1)*s[1]*n,l=o+s[0]*n,h=a+s[1]*n;return Re(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,n,s){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=le(this.getTileSize(o),this.tmpSize_);let u=a*(t-l[0])/i/h[0],g=a*(l[1]-e)/i/h[1];return n?(u=In(u,Ye)-1,g=In(g,Ye)-1):(u=Tn(u,Ye),g=Tn(g,Ye)),bo(o,u,g,s)}getTileCoordForXYAndZ_(t,e,i,n,s){const o=this.getOrigin(i),a=this.getResolution(i),l=le(this.getTileSize(i),this.tmpSize_);let h=(t-o[0])/a/l[0],u=(o[1]-e)/a/l[1];return n?(h=In(h,Ye)-1,u=In(u,Ye)-1):(h=Tn(h,Ye),u=Tn(u,Ye)),bo(i,h,u,s)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=rs(this.resolutions_,t,e||0);return Bt(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return sa(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let n=this.minZoom;n<e;++n)i[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=i}}const Rr={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function Aa(r){let t=r.getDefaultTileGrid();return t||(t=Nh(r),r.setDefaultTileGrid(t)),t}function Lh(r,t,e){const i=t[0],n=r.getTileCoordCenter(t),s=bs(e);if(Jn(s,n))return t;{const o=Pt(s),a=Math.ceil((s[0]-n[0])/o);return n[0]+=o*a,r.getTileCoordForCoordAndZ(n,i)}}function Mh(r,t,e,i){i=i!==void 0?i:"top-left";const n=Oa(r,t,e);return new Ia({extent:r,origin:Ha(r,i),resolutions:n,tileSize:e})}function Ph(r){const t=r||{},e=t.extent||zt("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Oa(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Ia(i)}function Oa(r,t,e,i){t=t!==void 0?t:Ah,e=le(e!==void 0?e:xs);const n=Se(r),s=Pt(r);i=i>0?i:Math.max(s/e[0],n/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function Nh(r,t,e,i){const n=bs(r);return Mh(n,t,e,i)}function bs(r){r=zt(r);let t=r.getExtent();if(!t){const e=180*ln.degrees/r.getMetersPerUnit();t=Re(-e,-e,e,e)}return t}class Dh extends wa{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&le(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new Ta(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,n){const s=this.getTileCacheForProjection(t);if(!s)return!1;let o=!0,a,l,h;for(let u=i.minX;u<=i.maxX;++u)for(let g=i.minY;g<=i.maxY;++g)l=gr(e,u,g),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===ct.LOADED,h&&(h=n(a)!==!1)),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(t,e,i,n,s){return ft()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:Aa(t)}getTileCacheForProjection(t){const e=this.getProjection();return wt(e===null||ai(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(e),o=le(n.getTileSize(t),this.tmpSize);return s==1?o:il(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=Lh(i,t,e)),Ih(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,n){}}class kh extends ke{constructor(t,e){super(t),this.tile=e}}function Fh(r,t){const e=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return r.replace(e,o[0].toString()).replace(i,o[1].toString()).replace(n,o[2].toString()).replace(s,function(){const h=o[0],u=t.getFullTileRange(h);return wt(u,55),(u.getHeight()-o[2]-1).toString()})}}function Gh(r,t){const e=r.length,i=new Array(e);for(let n=0;n<e;++n)i[n]=Fh(r[n],t);return Uh(i)}function Uh(r){return r.length===1?r[0]:function(t,e,i){if(t){const n=Th(t),s=Ni(n,r.length);return r[s](t,e,i)}else return}}function qh(r){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(r);if(e){const i=e[1].charCodeAt(0),n=e[2].charCodeAt(0);let s;for(s=i;s<=n;++s)t.push(r.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(r),e){const i=parseInt(e[2],10);for(let n=parseInt(e[1],10);n<=i;n++)t.push(r.replace(e[0],n.toString()));return t}return t.push(r),t}class Rs extends Dh{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Rs.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=xt(e),n=e.getState();let s;n==ct.LOADING?(this.tileLoadingKeys_[i]=!0,s=Rr.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==ct.ERROR?Rr.TILELOADERROR:n==ct.LOADED?Rr.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new kh(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=qh(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Gh(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const n=gr(t,e,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}class jh extends gh{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(kn(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(kn(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return ft()}readFeaturesFromObject(t,e){return ft()}readGeometry(t,e){return this.readGeometryFromObject(kn(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return ft()}readProjection(t){return this.readProjectionFromObject(kn(t))}readProjectionFromObject(t){return ft()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return ft()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return ft()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return ft()}}function kn(r){if(typeof r=="string"){const t=JSON.parse(r);return t||null}else return r!==null?r:null}class Xh extends jh{constructor(t){t=t||{},super(),this.dataProjection=zt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=zt(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const n=$r(i.geometry,e),s=new En;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&s.setGeometryName(i.geometry_name),s.setGeometry(n),"id"in i&&s.setId(i.id),i.properties&&s.setProperties(i.properties,!0),s}readFeaturesFromObject(t,e){const i=t;let n=null;if(i.type==="FeatureCollection"){const s=t;n=[];const o=s.features;for(let a=0,l=o.length;a<l;++a)n.push(this.readFeatureFromObject(o[a],e))}else n=[this.readFeatureFromObject(t,e)];return n}readGeometryFromObject(t,e){return $r(t,e)}readProjectionFromObject(t){const e=t.crs;let i;return e?e.type=="name"?i=zt(e.properties.name):e.type==="EPSG"?i=zt("EPSG:"+e.properties.code):wt(!1,36):i=this.dataProjection,i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},n=t.getId();if(n!==void 0&&(i.id=n),!t.hasProperties())return i;const s=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=Hr(o,e),delete s[t.getGeometryName()]),Gi(s)||(i.properties=s),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let n=0,s=t.length;n<s;++n)i.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return Hr(t,this.adaptOptions(e))}}function $r(r,t){if(!r)return null;let e;switch(r.type){case"Point":{e=Yh(r);break}case"LineString":{e=Vh(r);break}case"Polygon":{e=Hh(r);break}case"MultiPoint":{e=Bh(r);break}case"MultiLineString":{e=Wh(r);break}case"MultiPolygon":{e=$h(r);break}case"GeometryCollection":{e=zh(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return va(e,!1,t)}function zh(r,t){const e=r.geometries.map(function(i){return $r(i,t)});return new $n(e)}function Yh(r){return new _i(r.coordinates)}function Vh(r){return new qi(r.coordinates)}function Wh(r){return new Hn(r.coordinates)}function Bh(r){return new dr(r.coordinates)}function $h(r){return new Kn(r.coordinates)}function Hh(r){return new ei(r.coordinates)}function Hr(r,t){r=va(r,!0,t);const e=r.getType();let i;switch(e){case"Point":{i=eu(r);break}case"LineString":{i=Zh(r);break}case"Polygon":{i=iu(r,t);break}case"MultiPoint":{i=Qh(r);break}case"MultiLineString":{i=Jh(r);break}case"MultiPolygon":{i=tu(r,t);break}case"GeometryCollection":{i=Kh(r,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function Kh(r,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(i){return Hr(i,t)})}}function Zh(r,t){return{type:"LineString",coordinates:r.getCoordinates()}}function Jh(r,t){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function Qh(r,t){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function tu(r,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(e)}}function eu(r,t){return{type:"Point",coordinates:r.getCoordinates()}}function iu(r,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(e)}}class nu extends ns{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){ft()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;ti(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),as(n,i)}forEachFeatureAtCoordinate(t,e,i,n,s,o,a,l){let h;const u=e.viewState;function g(M,E,I,A){return s.call(o,E,M?I:null,A)}const p=u.projection,_=$o(t.slice(),p),w=[[0,0]];if(p.canWrapX()&&n){const M=p.getExtent(),E=Pt(M);w.push([-E,0],[E,0])}const R=e.layerStatesArray,S=R.length,T=[],v=[];for(let M=0;M<w.length;M++)for(let E=S-1;E>=0;--E){const I=R[E],A=I.layer;if(A.hasRenderer()&&ws(I,u)&&a.call(l,A)){const k=A.getRenderer(),F=A.getSource();if(k&&F){const V=F.getWrapX()?_:t,Y=g.bind(null,I.managed);v[0]=V[0]+w[M][0],v[1]=V[1]+w[M][1],h=k.forEachFeatureAtCoordinate(v,e,i,Y,T)}if(h)return h}}if(T.length===0)return;const O=1/T.length;return T.forEach((M,E)=>M.distanceSq+=E*O),T.sort((M,E)=>M.distanceSq-E.distanceSq),T.some(M=>h=M.callback(M.feature,M.layer,M.geometry)),h}hasFeatureAtCoordinate(t,e,i,n,s,o){return this.forEachFeatureAtCoordinate(t,e,i,n,tn,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(t){ft()}scheduleExpireIconCache(t){Vn.canExpireCache()&&t.postRenderFunctions.push(ru)}}function ru(r,t){Vn.expire()}class su extends nu{constructor(t){super(t),this.fontChangeListenerKey_=Et(Le,Fi.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=or+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const n=new pa(t,void 0,e);i.dispatchEvent(n)}}disposeInternal(){Nt(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(Ze.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),i=t.viewState;this.children_.length=0;const n=[];let s=null;for(let o=0,a=e.length;o<a;++o){const l=e[o];t.layerIndex=o;const h=l.layer,u=h.getSourceState();if(!ws(l,i)||u!="ready"&&u!="undefined"){h.unrender();continue}const g=h.render(t,s);g&&(g!==s&&(this.children_.push(g),s=g),"getDeclutter"in h&&n.push(h))}for(let o=n.length-1;o>=0;--o)n[o].renderDeclutter(t);ml(this.element_,this.children_),this.dispatchRenderEvent(Ze.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}}class Li extends ke{constructor(t,e,i){super(t),this.map=e,this.frameState=i!==void 0?i:null}}class Ve extends Li{constructor(t,e,i,n,s,o){super(t,e,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const qt={SINGLECLICK:"singleclick",CLICK:pt.CLICK,DBLCLICK:pt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},Kr={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class ou extends sr{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=Et(i,Kr.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=Et(i,Kr.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(pt.TOUCHMOVE,this.boundHandleTouchMove_,qo?{passive:!1}:!1)}emulateClick_(t){let e=new Ve(qt.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new Ve(qt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout((function(){this.clickTimeoutId_=void 0;const i=new Ve(qt.SINGLECLICK,this.map_,t);this.dispatchEvent(i)}).bind(this),250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==qt.POINTERUP||e.type==qt.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==e.target){delete this.trackedTouches_[n];break}}else(e.type==qt.POINTERDOWN||e.type==qt.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new Ve(qt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Nt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new Ve(qt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.down_={};for(const i in t){const n=t[i];this.down_[i]=typeof n=="function"?mi:n}if(this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(Et(i,qt.POINTERMOVE,this.handlePointerMove_,this),Et(i,qt.POINTERUP,this.handlePointerUp_,this),Et(this.element_,qt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(Et(this.element_.getRootNode(),qt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new Ve(qt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new Ve(qt.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Nt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(pt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Nt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Nt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const We={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Qt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Zn=1/0;class au{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,pn(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(t){wt(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=Zn?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,n=e.length,s=e[t],o=i[t],a=t;for(;t<n>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),u=h<n&&i[h]<i[l]?h:l;e[t]=e[u],i[t]=i[u],t=u}e[t]=s,i[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const i=this.elements_,n=this.priorities_,s=i[e],o=n[e];for(;e>t;){const a=this.getParentIndex_(e);if(n[a]>o)i[e]=i[a],n[e]=n[a],e=a;else break}i[e]=s,n[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let n=0;const s=e.length;let o,a,l;for(a=0;a<s;++a)o=e[a],l=t(o),l==Zn?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=l,e[n++]=o);e.length=n,i.length=n,this.heapify_()}}class lu extends au{constructor(t,e){super(function(i){return t.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(pt.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===ct.LOADED||i===ct.ERROR||i===ct.EMPTY){i!==ct.ERROR&&e.removeEventListener(pt.CHANGE,this.boundHandleTileChange_);const n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i=0,n,s,o;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),n=s.getState(),n===ct.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,s.load())}}function cu(r,t,e,i,n){if(!r||!(e in r.wantedTiles)||!r.wantedTiles[e][t.getKey()])return Zn;const s=r.viewState.center,o=i[0]-s[0],a=i[1]-s[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}const ye={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Ro(r,t,e){return function(i,n,s,o,a){if(!i)return;if(!n&&!t)return i;const l=t?0:s[0]*n,h=t?0:s[1]*n,u=a?a[0]:0,g=a?a[1]:0;let p=r[0]+l/2+u,_=r[2]-l/2+u,w=r[1]+h/2+g,R=r[3]-h/2+g;p>_&&(p=(_+p)/2,_=p),w>R&&(w=(R+w)/2,R=w);let S=Bt(i[0],p,_),T=Bt(i[1],w,R);if(o&&e&&n){const v=30*n;S+=-v*Math.log(1+Math.max(0,p-i[0])/v)+v*Math.log(1+Math.max(0,i[0]-_)/v),T+=-v*Math.log(1+Math.max(0,w-i[1])/v)+v*Math.log(1+Math.max(0,i[1]-R)/v)}return[S,T]}}function hu(r){return r}function Ss(r,t,e,i){const n=Pt(t)/e[0],s=Se(t)/e[1];return i?Math.min(r,Math.max(n,s)):Math.min(r,Math.min(n,s))}function Cs(r,t,e){let i=Math.min(r,t);const n=50;return i*=Math.log(1+n*Math.max(0,r/t-1))/n+1,e&&(i=Math.max(i,e),i/=Math.log(1+n*Math.max(0,e/r-1))/n+1),Bt(i,e/2,t*2)}function uu(r,t,e,i){return t=t!==void 0?t:!0,function(n,s,o,a){if(n!==void 0){const l=r[0],h=r[r.length-1],u=e?Ss(l,e,o,i):l;if(a)return t?Cs(n,u,h):Bt(n,h,u);const g=Math.min(u,n),p=Math.floor(rs(r,g,s));return r[p]>u&&p<r.length-1?r[p+1]:r[p]}else return}}function du(r,t,e,i,n,s){return i=i!==void 0?i:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const u=n?Ss(t,n,l,s):t;if(h)return i?Cs(o,u,e):Bt(o,e,u);const g=1e-9,p=Math.ceil(Math.log(t/u)/Math.log(r)-g),_=-a*(.5-g)+.5,w=Math.min(u,o),R=Math.floor(Math.log(t/w)/Math.log(r)+_),S=Math.max(p,R),T=t/Math.pow(r,S);return Bt(T,e,u)}else return}}function So(r,t,e,i,n){return e=e!==void 0?e:!0,function(s,o,a,l){if(s!==void 0){const h=i?Ss(r,i,a,n):r;return!e||!l?Bt(s,t,h):Cs(s,h,t)}else return}}function Ts(r){if(r!==void 0)return 0}function Co(r){if(r!==void 0)return r}function fu(r){const t=2*Math.PI/r;return function(e,i){if(i)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function gu(r){return r=r||Un(5),function(t,e){if(e)return t;if(t!==void 0)return Math.abs(t)<=r?0:t}}const Sr=0;class $e extends Ce{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=hs(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Zl(),t.center&&(t.center=Me(t.center,this.projection_)),t.extent&&(t.extent=ci(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in ye)delete e[a];this.setProperties(e,!0);const i=mu(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const n=pu(t),s=i.constraint,o=_u(t);this.constraints_={center:n,resolution:s,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenter();if(i){const n=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution(),o=s/2*(n[3]-e[3]+e[1]-n[1]),a=s/2*(n[0]-e[0]+e[2]-n[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=Me(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=Me(n.anchor,this.getProjection())),e[i]=n}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,i;e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e);let n=0;for(;n<e&&!this.isDef();++n){const u=arguments[n];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(n===e){i&&Fn(i,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;n<e;++n){const u=arguments[n],g={start:s,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||ph,callback:i};if(u.center&&(g.sourceCenter=o,g.targetCenter=u.center.slice(),o=g.targetCenter),u.zoom!==void 0?(g.sourceResolution=a,g.targetResolution=this.getResolutionForZoom(u.zoom),a=g.targetResolution):u.resolution&&(g.sourceResolution=a,g.targetResolution=u.resolution,a=g.targetResolution),u.rotation!==void 0){g.sourceRotation=l;const p=Ni(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;g.targetRotation=l+p,l=g.targetRotation}yu(g)?g.complete=!0:s+=g.duration,h.push(g)}this.animations_.push(h),this.setHint(te.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[te.ANIMATING]>0}getInteracting(){return this.hints_[te.INTERACTING]>0}cancelAnimations(){this.setHint(te.ANIMATING,-this.hints_[te.ANIMATING]);let t;for(let e=0,i=this.animations_.length;e<i;++e){const n=this.animations_[e];if(n[0].callback&&Fn(n[0].callback,!1),!t)for(let s=0,o=n.length;s<o;++s){const a=n[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let s=!0;for(let o=0,a=n.length;o<a;++o){const l=n[o];if(l.complete)continue;const h=t-l.start;let u=l.duration>0?h/l.duration:1;u>=1?(l.complete=!0,u=1):s=!1;const g=l.easing(u);if(l.sourceCenter){const p=l.sourceCenter[0],_=l.sourceCenter[1],w=l.targetCenter[0],R=l.targetCenter[1];this.nextCenter_=l.targetCenter;const S=p+g*(w-p),T=_+g*(R-_);this.targetCenter_=[S,T]}if(l.sourceResolution&&l.targetResolution){const p=g===1?l.targetResolution:l.sourceResolution+g*(l.targetResolution-l.sourceResolution);if(l.anchor){const _=this.getViewportSize_(this.getRotation()),w=this.constraints_.resolution(p,0,_,!0);this.targetCenter_=this.calculateCenterZoom(w,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=p,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const p=g===1?Ni(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+g*(l.targetRotation-l.sourceRotation);if(l.anchor){const _=this.constraints_.rotation(p,!0);this.targetCenter_=this.calculateCenterRotate(_,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=p}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[i]=null,this.setHint(te.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&Fn(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const n=this.getCenterInternal();return n!==void 0&&(i=[n[0]-e[0],n[1]-e[1]],ls(i,t-this.getRotation()),Bl(i,e)),i}calculateCenterZoom(t,e){let i;const n=this.getCenterInternal(),s=this.getResolution();if(n!==void 0&&s!==void 0){const o=e[0]-t*(e[0]-n[0])/s,a=e[1]-t*(e[1]-n[1])/s;i=[o,a]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],n=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(n*Math.cos(t))]}else return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&jr(t,this.getProjection())}getCenterInternal(){return this.get(ye.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return Xr(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();wt(e,1);const i=this.getResolution();wt(i!==void 0,2);const n=this.getRotation();return wt(n!==void 0,3),Mr(e,i,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(ye.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(ci(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=Pt(t)/e[0],n=Se(t)/e[1];return Math.max(i,n)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(e/i)/Math.log(t);return function(s){return e/Math.pow(t,s*n)}}getRotation(){return this.get(ye.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(i/n)/e;return function(o){return Math.log(i/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();n=Cr(n,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,i)}return{center:n.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,i,n;if(this.resolutions_){const s=rs(this.resolutions_,t,1);e=s,i=this.resolutions_[s],s==this.resolutions_.length-1?n=2:n=i/this.resolutions_[s+1]}else i=this.maxResolution_,n=this.zoomFactor_;return e+Math.log(i/t)/Math.log(n)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=Bt(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(i,Bt(t-e,0,1))}else return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(wt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function",24),Array.isArray(t)){wt(!ts(t),25);const n=ci(t,this.getProjection());i=no(n)}else if(t.getType()==="Circle"){const n=ci(t.getExtent(),this.getProjection());i=no(n),i.rotate(this.getRotation(),gi(n))}else{const n=Zo();n?i=t.clone().transform(n,this.getProjection()):i=t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),n=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,u=-1/0;for(let g=0,p=s.length;g<p;g+=o){const _=s[g]*i-s[g+1]*n,w=s[g]*n+s[g+1]*i;a=Math.min(a,_),l=Math.min(l,w),h=Math.max(h,_),u=Math.max(u,w)}return[a,l,h,u]}fitInternal(t,e){e=e||{};let i=e.size;i||(i=this.getViewportSizeMinusPadding_());const n=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),u=Math.sin(h),g=Math.cos(h),p=gi(a);p[0]+=(n[1]-n[3])/2*l,p[1]+=(n[0]-n[2])/2*l;const _=p[0]*g-p[1]*u,w=p[1]*g+p[0]*u,R=this.getConstrainedCenter([_,w],l),S=e.callback?e.callback:mi;e.duration!==void 0?this.animateInternal({resolution:l,center:R,duration:e.duration,easing:e.easing},S):(this.targetResolution_=l,this.targetCenter_=R,this.applyTargetState_(!1,!0),Fn(S,!0))}centerOn(t,e,i){this.centerOnInternal(Me(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(Cr(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,n){let s;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-i),l=Cr(t,n,[a[0]/2+o[3],a[1]/2+o[0]],e,i);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=jr(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Me(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,n,i);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Me(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Me(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,i),s=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,s,i),a=this.constraints_.center(this.targetCenter_,o,s,i,this.calculateCenterShift(this.targetCenter_,o,n,s));this.get(ye.ROTATION)!==n&&this.set(ye.ROTATION,n),this.get(ye.RESOLUTION)!==o&&(this.set(ye.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(ye.CENTER)||!Bn(this.get(ye.CENTER),a))&&this.set(ye.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=t!==void 0?t:200;const n=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}i=i||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!Bn(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:zi,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(te.INTERACTING,1)}endInteraction(t,e,i){i=i&&Me(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.setHint(te.INTERACTING,-1),this.resolveConstraints(t,e,i)}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}}function Fn(r,t){setTimeout(function(){r(t)},0)}function pu(r){if(r.extent!==void 0){const e=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return Ro(r.extent,r.constrainOnlyCenter,e)}const t=hs(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Ro(e,!1,!1)}return hu}function mu(r){let t,e,i,o=r.minZoom!==void 0?r.minZoom:Sr,a=r.maxZoom!==void 0?r.maxZoom:28;const l=r.zoomFactor!==void 0?r.zoomFactor:2,h=r.multiWorld!==void 0?r.multiWorld:!1,u=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,g=r.showFullExtent!==void 0?r.showFullExtent:!1,p=hs(r.projection,"EPSG:3857"),_=p.getExtent();let w=r.constrainOnlyCenter,R=r.extent;if(!h&&!R&&p.isGlobal()&&(w=!1,R=_),r.resolutions!==void 0){const S=r.resolutions;e=S[o],i=S[a]!==void 0?S[a]:S[S.length-1],r.constrainResolution?t=uu(S,u,!w&&R,g):t=So(e,i,u,!w&&R,g)}else{const T=(_?Math.max(Pt(_),Se(_)):360*ln.degrees/p.getMetersPerUnit())/xs/Math.pow(2,Sr),v=T/Math.pow(2,28-Sr);e=r.maxResolution,e!==void 0?o=0:e=T/Math.pow(l,o),i=r.minResolution,i===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?i=e/Math.pow(l,a):i=T/Math.pow(l,a):i=v),a=o+Math.floor(Math.log(e/i)/Math.log(l)),i=e/Math.pow(l,a-o),r.constrainResolution?t=du(l,e,i,u,!w&&R,g):t=So(e,i,u,!w&&R,g)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:o,zoomFactor:l}}function _u(r){if(r.enableRotation!==void 0?r.enableRotation:!0){const e=r.constrainRotation;return e===void 0||e===!0?gu():e===!1?Co:typeof e=="number"?fu(e):Co}else return Ts}function yu(r){return!(r.sourceCenter&&r.targetCenter&&!Bn(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function Cr(r,t,e,i,n){const s=Math.cos(-n);let o=Math.sin(-n),a=r[0]*s-r[1]*o,l=r[1]*s+r[0]*o;a+=(t[0]/2-e[0])*i,l+=(e[1]-t[1]/2)*i,o=-o;const h=a*s-l*o,u=l*s+a*o;return[h,u]}class Is extends Ce{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){kr(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&kr(this.element);for(let e=0,i=this.listenerKeys.length;e<i;++e)Nt(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==mi&&this.listenerKeys.push(Et(t,We.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class wu extends Is{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",i=t.tipLabel!==void 0?t.tipLabel:"Attributions",n=t.expandClassName!==void 0?t.expandClassName:e+"-expand",s=t.collapseLabel!==void 0?t.collapseLabel:"›",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(pt.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+or+" "+ss+(this.collapsed_&&this.collapsible_?" "+qs:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=h,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e={},i=[];let n=!0;const s=t.layerStatesArray;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(!ws(l,t.viewState))continue;const h=l.layer.getSource();if(!h)continue;const u=h.getAttributions();if(!u)continue;const g=u(t);if(g)if(n=n&&h.getAttributionsCollapsible()!==!1,Array.isArray(g))for(let p=0,_=g.length;p<_;++p)g[p]in e||(i.push(g[p]),e[g[p]]=!0);else g in e||(i.push(g),e[g]=!0)}return this.overrideCollapsible_||this.setCollapsible(n),i}updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Ei(e,this.renderedAttributions_)){pl(this.ulElement_);for(let n=0,s=e.length;n<s;++n){const o=document.createElement("li");o.innerHTML=e[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(qs),this.collapsed_?Gs(this.collapseLabel_,this.label_):Gs(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class Eu extends Is{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",i=t.label!==void 0?t.label:"⇧",n=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const s=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(pt.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+or+" "+ss,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(An)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:zi}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const s=this.element.classList.contains(An);!s&&i===0?this.element.classList.add(An):s&&i!==0&&this.element.classList.remove(An)}this.label_.style.transform=n}this.rotation_=i}}class vu extends Is{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",i=t.delta!==void 0?t.delta:1,n=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",s=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=n,u.setAttribute("type","button"),u.title=l,u.appendChild(typeof o=="string"?document.createTextNode(o):o),u.addEventListener(pt.CLICK,this.handleClick_.bind(this,i),!1);const g=document.createElement("button");g.className=s,g.setAttribute("type","button"),g.title=h,g.appendChild(typeof a=="string"?document.createTextNode(a):a),g.addEventListener(pt.CLICK,this.handleClick_.bind(this,-i),!1);const p=e+" "+or+" "+ss,_=this.element;_.className=p,_.appendChild(u),_.appendChild(g),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(n!==void 0){const s=i.getConstrainedZoom(n+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:s,duration:this.duration_,easing:zi})):i.setZoom(s)}}}function xu(r){r=r||{};const t=new xe;return(r.zoom!==void 0?r.zoom:!0)&&t.push(new vu(r.zoomOptions)),(r.rotate!==void 0?r.rotate:!0)&&t.push(new Eu(r.rotateOptions)),(r.attribution!==void 0?r.attribution:!0)&&t.push(new wu(r.attributionOptions)),t}const To={ACTIVE:"active"};class xn extends Ce{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(To.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(To.ACTIVE,t)}setMap(t){this.map_=t}}function bu(r,t,e){const i=r.getCenterInternal();if(i){const n=[i[0]+t[0],i[1]+t[1]];r.animateInternal({duration:e!==void 0?e:250,easing:mh,center:r.getConstrainedCenter(n)})}}function As(r,t,e,i){const n=r.getZoom();if(n===void 0)return;const s=r.getConstrainedZoom(n+t),o=r.getResolutionForZoom(s);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:o,anchor:e,duration:i!==void 0?i:250,easing:zi})}class Ru extends xn{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==qt.DBLCLICK){const i=t.originalEvent,n=t.map,s=t.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=n.getView();As(a,o,s,this.duration_),i.preventDefault(),e=!0}return!e}}class bn extends xn{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==qt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==qt.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==qt.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==qt.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function Os(r){const t=r.length;let e=0,i=0;for(let n=0;n<t;n++)e+=r[n].clientX,i+=r[n].clientY;return[e/t,i/t]}function Zr(r){const t=arguments;return function(e){let i=!0;for(let n=0,s=t.length;n<s&&(i=i&&t[n](e),!!i);++n);return i}}const Su=function(r){const t=r.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Cu=function(r){const t=r.map.getTargetElement(),e=r.map.getOwnerDocument().activeElement;return t.contains(e)},La=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?Cu(r):!0},Tu=tn,Ma=function(r){const t=r.originalEvent;return t.button==0&&!(dl&&fl&&t.ctrlKey)},Pa=function(r){const t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Iu=function(r){const t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Na=function(r){const t=r.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},Tr=function(r){const t=r.originalEvent;return wt(t!==void 0,56),t.pointerType=="mouse"},Au=function(r){const t=r.originalEvent;return wt(t!==void 0,56),t.isPrimary&&t.button===0};class Ou extends bn{constructor(t){super({stopDown:rr}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:Zr(Pa,Au);this.condition_=t.onFocusOnly?Zr(La,e):e,this.noKinetic_=!1}handleDragEvent(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const e=this.targetPointers,i=Os(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const n=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],o=t.map.getView();$l(n,o.getResolution()),ls(n,o.getRotation()),o.adjustCenterInternal(n)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-n*Math.cos(s),a[1]-n*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:zi})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1}}class Lu extends bn{constructor(t){t=t||{},super({stopDown:rr}),this.condition_=t.condition?t.condition:Su,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Tr(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===Ts)return;const n=e.getSize(),s=t.pixel,o=Math.atan2(n[1]/2-s[1],s[0]-n[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return Tr(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Tr(t)&&Ma(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class Mu extends ns{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(t[0],e[0])+i,n.top=Math.min(t[1],e[1])+i,n.width=Math.abs(e[0]-t[0])+i,n.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new ei([n])}getGeometry(){return this.geometry_}}const Gn={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Ir extends ke{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}class Pu extends bn{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new Mu(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:Ma,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const n=i[0]-e[0],s=i[1]-e[1];return n*n+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Ir(Gn.BOXDRAG,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Ir(e?Gn.BOXEND:Gn.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Ir(Gn.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}}class Nu extends Pu{constructor(t){t=t||{};const e=t.condition?t.condition:Iu;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const s=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(s),a=i.getResolution()/o;n=n.clone(),n.scale(a*a)}i.fitInternal(n,{duration:this.duration_,easing:zi})}}const si={LEFT:37,UP:38,RIGHT:39,DOWN:40};class Du extends xn{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return Pa(e)&&Na(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==pt.KEYDOWN){const i=t.originalEvent,n=i.keyCode;if(this.condition_(t)&&(n==si.DOWN||n==si.LEFT||n==si.RIGHT||n==si.UP)){const o=t.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;n==si.DOWN?h=-a:n==si.LEFT?l=-a:n==si.RIGHT?l=a:h=a;const u=[l,h];ls(u,o.getRotation()),bu(o,u,this.duration_),i.preventDefault(),e=!0}}return!e}}class ku extends xn{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:Na,this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==pt.KEYDOWN||t.type==pt.KEYPRESS){const i=t.originalEvent,n=i.charCode;if(this.condition_(t)&&(n==43||n==45)){const s=t.map,o=n==43?this.delta_:-this.delta_,a=s.getView();As(a,o,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}}class Fu{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const n=this.points_[e+2]-this.points_[i+2];if(n<1e3/60)return!1;const s=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class Gu extends xn{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:Tu;this.condition_=t.onFocusOnly?Zr(La,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==pt.WHEEL)return!0;const i=t.map,n=t.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let s;if(t.type==pt.WHEEL&&(s=n.deltaY,hl&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Uo),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-Bt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),As(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class Uu extends bn{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=rr),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],n=this.targetPointers[1],s=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const u=s-this.lastAngle_;this.rotationDelta_+=u,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=u}this.lastAngle_=s;const o=t.map,a=o.getView();if(a.getConstraints().rotation===Ts)return;const l=o.getViewport().getBoundingClientRect(),h=Os(this.targetPointers);h[0]-=l.left,h[1]-=l.top,this.anchor_=o.getCoordinateFromPixelInternal(h),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1}}class qu extends bn{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=rr),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],n=this.targetPointers[1],s=i.clientX-n.clientX,o=i.clientY-n.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e);const u=l.getViewport().getBoundingClientRect(),g=Os(this.targetPointers);g[0]-=u.left,g[1]-=u.top,this.anchor_=l.getCoordinateFromPixelInternal(g),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const i=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,n),!1}else return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1}}function ju(r){r=r||{};const t=new xe,e=new Fu(-.005,.05,100);return(r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0)&&t.push(new Lu),(r.doubleClickZoom!==void 0?r.doubleClickZoom:!0)&&t.push(new Ru({delta:r.zoomDelta,duration:r.zoomDuration})),(r.dragPan!==void 0?r.dragPan:!0)&&t.push(new Ou({onFocusOnly:r.onFocusOnly,kinetic:e})),(r.pinchRotate!==void 0?r.pinchRotate:!0)&&t.push(new Uu),(r.pinchZoom!==void 0?r.pinchZoom:!0)&&t.push(new qu({duration:r.zoomDuration})),(r.keyboard!==void 0?r.keyboard:!0)&&(t.push(new Du),t.push(new ku({delta:r.zoomDelta,duration:r.zoomDuration}))),(r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0)&&t.push(new Gu({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(r.shiftDragZoom!==void 0?r.shiftDragZoom:!0)&&t.push(new Nu({duration:r.zoomDuration})),t}function Da(r){if(r instanceof fr){r.setMapInternal(null);return}r instanceof Xi&&r.getLayers().forEach(Da)}function ka(r,t){if(r instanceof fr){r.setMapInternal(t);return}if(r instanceof Xi){const e=r.getLayers().getArray();for(let i=0,n=e.length;i<n;++i)ka(e[i],t)}}class Xu extends Ce{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=zu(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:Uo,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=be(),this.pixelToCoordinateTransform_=be(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.controls=e.controls||xu(),this.interactions=e.interactions||ju({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new lu(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Qt.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Qt.VIEW,this.handleViewChanged_),this.addChangeListener(Qt.SIZE,this.handleSizeChanged_),this.addChangeListener(Qt.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof $e)&&t.view.then(function(n){i.setView(new $e(n))}),this.controls.addEventListener(ne.ADD,(function(n){n.element.setMap(this)}).bind(this)),this.controls.addEventListener(ne.REMOVE,(function(n){n.element.setMap(null)}).bind(this)),this.interactions.addEventListener(ne.ADD,(function(n){n.element.setMap(this)}).bind(this)),this.interactions.addEventListener(ne.REMOVE,(function(n){n.element.setMap(null)}).bind(this)),this.overlays_.addEventListener(ne.ADD,(function(n){this.addOverlayInternal_(n.element)}).bind(this)),this.overlays_.addEventListener(ne.REMOVE,(function(n){const s=n.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],n.element.setMap(null)}).bind(this)),this.controls.forEach((function(n){n.setMap(this)}).bind(this)),this.interactions.forEach((function(n){n.setMap(this)}).bind(this)),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){ka(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(t);i=i!==void 0?i:{};const s=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:tn,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,s,a,e,null,o,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(n){i.push(n)},e),i}getAllLayers(){const t=[];function e(i){i.forEach(function(n){n instanceof Xi?e(n.getLayers()):t.push(n)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const n=e.layerFilter!==void 0?e.layerFilter:tn,s=e.hitTolerance!==void 0?e.hitTolerance:0,o=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,s,o,n,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),i="changedTouches"in t?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]}getTarget(){return this.get(Qt.TARGET)}getTargetElement(){const t=this.getTarget();return t!==void 0?typeof t=="string"?document.getElementById(t):t:null}getCoordinateFromPixel(t){return jr(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?Kt(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Qt.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof xe){e.setLayers(t);return}const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const n=t[e];if(!n.visible)continue;const s=n.layer.getRenderer();if(s&&!s.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Me(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?Kt(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Qt.SIZE)}getView(){return this.get(Qt.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,n){return cu(this.frameState_,t,e,i,n)}handleBrowserEvent(t,e){e=e||t.type;const i=new Ve(e,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===Kr.POINTERDOWN||i===pt.WHEEL||i===pt.KEYDOWN){const n=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=e.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===n?n.documentElement:s).contains(o))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const n=this.getInteractions().getArray().slice();for(let s=n.length-1;s>=0;s--){const o=n[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let n=this.maxTilesLoading_,s=n;if(t){const o=t.viewHints;if(o[te.ANIMATING]||o[te.INTERACTING]){const a=Date.now()-t.time>8;n=a?0:8,s=a?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,s))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(Ze.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(Ze.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Li(We.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Li(We.LOADSTART,this,t))));const i=this.postRenderFunctions_;for(let n=0,s=i.length;n<s;++n)i[n](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,i=this.targetChangeHandlerKeys_.length;e<i;++e)Nt(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(pt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(pt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,kr(this.viewport_)}const t=this.getTargetElement();if(!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new su(this)),this.mapBrowserEventHandler_=new ou(this,this.moveTolerance_);for(const n in qt)this.mapBrowserEventHandler_.addEventListener(qt[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(pt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(pt.WHEEL,this.boundHandleBrowserEvent_,qo?{passive:!1}:!1);const e=this.getOwnerDocument().defaultView,i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[Et(i,pt.KEYDOWN,this.handleBrowserEvent,this),Et(i,pt.KEYPRESS,this.handleBrowserEvent,this),Et(e,pt.RESIZE,this.updateSize,this)]}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Nt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Nt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=Et(t,Fi.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=Et(t,pt.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Nt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Be("addlayer",t)),this.layerGroupPropertyListenerKeys_=[Et(t,Fi.PROPERTYCHANGE,this.render,this),Et(t,pt.CHANGE,this.render,this),Et(t,"addlayer",this.handleLayerAdd_,this),Et(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const n=t[e].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){Da(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),n=this.frameState_;let s=null;if(e!==void 0&&ks(e)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Mr(a.center,a.resolution,a.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:xt(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=Mr(a.nextCenter,a.nextResolution,l,e)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),n&&(!this.previousExtent_||!ts(this.previousExtent_)&&!Qi(s.extent,this.previousExtent_))&&(this.dispatchEvent(new Li(We.MOVESTART,this,n)),this.previousExtent_=gn(this.previousExtent_)),this.previousExtent_&&!s.viewHints[te.ANIMATING]&&!s.viewHints[te.INTERACTING]&&!Qi(s.extent,this.previousExtent_)&&(this.dispatchEvent(new Li(We.MOVEEND,this,s)),Ao(s.extent,this.previousExtent_))),this.dispatchEvent(new Li(We.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(We.LOADSTART)||this.hasListener(We.LOADEND)||this.hasListener(Ze.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Be("removelayer",e)),this.set(Qt.LAYERGROUP,t)}setSize(t){this.set(Qt.SIZE,t)}setTarget(t){this.set(Qt.TARGET,t)}setView(t){if(!t||t instanceof $e){this.set(Qt.VIEW,t);return}this.set(Qt.VIEW,new $e);const e=this;t.then(function(i){e.setView(new $e(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const i=getComputedStyle(t),n=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),s=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(n)&&!isNaN(s)&&(e=[n,s],!ks(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(e),this.updateViewportSize_()}updateViewportSize_(){const t=this.getView();if(t){let e;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(e=[parseInt(i.width,10),parseInt(i.height,10)]),t.setViewportSize(e)}}}function zu(r){let t=null;r.keyboardEventTarget!==void 0&&(t=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);const e={},i=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new Xi({layers:r.layers});e[Qt.LAYERGROUP]=i,e[Qt.TARGET]=r.target,e[Qt.VIEW]=r.view instanceof $e?r.view:new $e;let n;r.controls!==void 0&&(Array.isArray(r.controls)?n=new xe(r.controls.slice()):(wt(typeof r.controls.getArray=="function",47),n=r.controls));let s;r.interactions!==void 0&&(Array.isArray(r.interactions)?s=new xe(r.interactions.slice()):(wt(typeof r.interactions.getArray=="function",48),s=r.interactions));let o;return r.overlays!==void 0?Array.isArray(r.overlays)?o=new xe(r.overlays.slice()):(wt(typeof r.overlays.getArray=="function",49),o=r.overlays):o=new xe,{controls:n,interactions:s,keyboardEventTarget:t,overlays:o,values:e}}class Yu extends Rs{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Vu,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Ra,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const n in this.tileCacheForProjection){const s=this.tileCacheForProjection[n];s.expireCache(s==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!ai(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!ai(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||ai(e,t)))return this.tileGrid;{const i=xt(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=Aa(t)),this.tileGridForProjection[i]}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||ai(e,t))return this.tileCache;{const i=xt(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Ta(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}}createTile_(t,e,i,n,s,o){const a=[t,e,i],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,n,s):void 0,u=new this.tileClass(a,h!==void 0?ct.IDLE:ct.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(pt.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,e,i,n,s){const o=this.getProjection();if(!o||!s||ai(o,s))return this.getTileInternal(t,e,i,n,o||s);{const a=this.getTileCacheForProjection(s),l=[t,e,i];let h;const u=Ca(l);a.containsKey(u)&&(h=a.get(u));const g=this.getKey();if(h&&h.key==g)return h;{const p=this.getTileGridForProjection(o),_=this.getTileGridForProjection(s),w=this.getTileCoordForTileUrlFunction(l,s),R=new Br(o,p,s,_,l,w,this.getTilePixelRatio(n),this.getGutter(),(function(S,T,v,O){return this.getTileInternal(S,T,v,O,o)}).bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return R.key=g,h?(R.interimTile=h,R.refreshInterimChain(),a.replace(u,R)):a.set(u,R),R}}}getTileInternal(t,e,i,n,s){let o=null;const a=gr(t,e,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,i,n,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,i,n,s,l),h.getState()==ct.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const i=zt(t);if(i){const n=xt(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function Vu(r,t){r.getImage().src=t}class Wu extends fr{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(Dn.PRELOAD)}setPreload(t){this.set(Dn.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(Dn.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(Dn.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class Bu extends Wu{constructor(t){super(t)}createRenderer(){return new Rh(this)}}class $u extends Yu{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:Ph({extent:bs(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const Hu='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Ku extends $u{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[Hu];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",n=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:n,wrapX:t.wrapX,zDirection:t.zDirection})}}const ki=(r,t,e,i,n=5)=>{const s=[r,t];typeof window.$barry.layers[i]<"u"&&window.$barry.map.removeLayer(window.$barry.layers[i]),i.startsWith("place")&&(window.$barry.places[i]=s,window.$barry.canCalculate());const o=new _i(s),a=new En(o);a.setId(i);const l=new Es({source:new Ea({features:[a]}),style:new Qe({image:new _n({radius:n,fill:new ji({color:e})})})});window.$barry.layers[i]=l,window.$barry.map.addLayer(l)},Zu=(r,t,e,i=3)=>{typeof window.$barry.layers[e]<"u"&&window.$barry.map.removeLayer(window.$barry.layers[e]);const n=new Xh,s=new En({geometry:n.readGeometry(r)});s.setId(e),s.setStyle(new Qe({stroke:new yn({color:t,width:i})}));const o=new Ea({features:[s]}),a=new Es({source:o});window.$barry.layers[e]=a,window.$barry.map.addLayer(a)},Ju=(r,t,e)=>{const i=Object.keys(window.$barry.places),n=[];for(let s=0;s<i.length;s++)i[s].startsWith("place")&&n.push(new Promise(o=>{Dr(window.$barry.places[i[s]],r,s).then(a=>{const l=a.totalTime,h=Math.floor(l/3600),u=Math.floor(l/60%60);Zu(a.routeGeometry,window.$barry.roadColor,`route_${a.key}`),window.$barry.log(`
<span onmouseenter="window.$barry.showNav('route_${a.key}', 1);"
      onmouseleave="window.$barry.showNav('route_${a.key}', 0)"
      onclick="window.$barry.zoom([[${a.bbox.top}, ${a.bbox.left}],[${a.bbox.bottom}, ${a.bbox.right}]])"
>
  De 
  <b>
    ${document.querySelector(`input[data-city="${i[s]}"]`).value}
  </b>
  , il y 
  <b>
    ${Math.round(100*Number.parseFloat(a.totalDistance)/1e3)/100}
  </b>
  km en
  <b>
    ${h} h ${u<10?`0${u}`:u}
  </b>
</span>`),o()})}));window.$barry.log("Je calcule le trajet pour chaque ville.",1),Promise.all(n).then(()=>{ki(r[0],r[1],t,e)})},Qu=r=>new Promise(t=>{es.Services.reverseGeocode({position:{x:r[0],y:r[1]},filterOptions:{type:["PositionOfInterest"],circle:{x:r[0],y:r[1],radius:4}},apiKey:"calcul",onSuccess:e=>{let i=!1;e.locations.forEach((n,s)=>{var o,a;(a=(o=n.placeAttributes)==null?void 0:o.extrafields)!=null&&a.cleabs.startsWith("COMMUNE_")&&!i&&(i=!0,window.$barry.log(`On se retrouve donc à <b>${n.placeAttributes.name}</b>`),t([n.position.lon,n.position.lat]))}),t(r)},onFailure:e=>{alert(e),t(r)}})}),td=()=>new Promise((r,t)=>{window.$barry.log("Je calcule tous les chemins !",1);const e=[],i=Object.keys(window.$barry.places);for(let n=0;n<i.length;n++)for(let s=n+1;s<i.length;s++)i[n].startsWith("place")&&i[s].startsWith("place")&&e.push(Dr(window.$barry.places[i[n]],window.$barry.places[i[s]],`${i[n]};${i[s]}`));Promise.all(e).then(n=>{let s=0,o=0,a=n[0].key;for(let h=0;h<n.length;h++){const u=Number.parseFloat(n[h].totalTime),g=Number.parseFloat(n[h].totalDistance),p=Math.floor(u/3600),_=Math.floor(u/60%60),w=n[h].key.split(";");window.$barry.log(`Entre "${document.querySelector(`input[data-city="${w[0]}"]`).value}" et "${document.querySelector(`input[data-city="${w[1]}"]`).value}" il y a ${Math.round(100*g/1e3)/100} km en ${p}h${_<10?`0${_}`:_}`,1),(window.$barry.calculateMode==="time"&&u>o||window.$barry.calculateMode==="distance"&&g>s)&&(s=g,o=u,a=n[h].key)}const l=a.split(";");window.$barry.log(`Le trajet le plus long (en ${window.$barry.calculateMode==="time"?"temps":"distance"}) est donc entre "${document.querySelector(`input[data-city="${l[0]}"]`).value}" et "${document.querySelector(`input[data-city="${l[1]}"]`).value}"`,1),window.$barry.log("Je calcule le point à mi-temps.",1),l.length>1?Dr(window.$barry.places[l[0]],window.$barry.places[l[1]],"",!0).then(h=>{let u=null;const g=h.routeInstructions.length;let p=0,_=0;const w=Math.round(o/2),R=Math.round(s/2);for(let S=0;S<g&&(_+=Number.parseFloat(h.routeInstructions[S].distance),p+=Number.parseFloat(h.routeInstructions[S].duration),u=h.routeInstructions[S],!(window.$barry.calculateMode==="time"&&p>w||window.$barry.calculateMode==="distance"&&_>R));S++);if(u!=null){let S=0;window.$barry.calculateMode==="time"?S=(p-w)/Number.parseFloat(u.duration):window.$barry.calculateMode==="distance"&&(S=(_-R)/Number.parseFloat(u.distance)),window.$barry.log("Le point est trouvé.",1),r(u.geometry.coordinates[Math.round((1-S)*u.geometry.coordinates.length)])}}):t("Pas de point trouvé")})});function ed(){return new Promise(r=>{const t=Object.keys(window.$barry.places);let e=0,i=0;for(let n=0;n<t.length;n++)t[n].startsWith("place")&&(e+=Number.parseFloat(window.$barry.places[t[n]][0]),i+=Number.parseFloat(window.$barry.places[t[n]][1]));e/=t.length,i/=t.length,window.$barry.log("Je fais la moyenne des coordonnées des villes.",1),r([e,i])})}const id=()=>new Promise(r=>{const t=window.$barry.calcBox();window.$barry.log("Je détermine les latitudes et longitudes minimales et maximales pour définir un cadre et je calcule le centre du cadre.",1),r([(t[1][1]+t[0][1])/2,(t[1][0]+t[0][0])/2])});window.$barry.calculate=()=>{window.$barry.$logContent.innerHTML="",window.$barry.$log.classList.remove("hide"),window.$barry.$spinner.classList.remove("hide"),window.$barry.$rappel.classList.add("hide");const r=[];r.push(window.$barry.calculateMode),document.querySelectorAll(".address").forEach((n,s)=>{const o=n.querySelector("input").value;o==""?window.$barry.removeAddress(n.id):(r.push(o),n.querySelectorAll("button").forEach((a,l)=>a.classList.add("hide")))}),window.location.hash=btoa(r.join("|")),window.$barry.log("C'est parti pour rechercher votre point de rencontre équitable");const t=[td(),ed(),id()],e=["longMiddle","average","center"],i=[13,2,1];Promise.all(t).then(n=>{window.$barry.log("J'ai fini les différents calculs, je prend maintenant la moyenne des coordonnées.",1);let s=0,o=0,a=0;Object.keys(window.$barry.places).length>2?(n.map((l,h)=>{for(let u=0;u<i[h];u++)s+=Number.parseFloat(l[0]),o+=Number.parseFloat(l[1]),a++;ki(l[0],l[1],window.$barry.methods[e[h]].color,e[h])}),s/=a,o/=a):(s=n[0][0],o=n[0][1],ki(s,o,window.$barry.methods[e[0]].color,e[0])),window.$barry.log(`On se retrouve à [${s}, ${o}]`,1),window.$barry.log("Je cherche la ville la plus proche du point.",1),ki(s,o,window.$barry.resultColor,"result"),Qu([s,o]).then(l=>{l[0]===l[1]&&l[0]===0?window.$barry.log("Pas de ville trouvée proche, je suis désolé mais va falloir le faire à la main."):(Ju(l,window.$barry.resultColor,"result"),ir(),window.$barry.meetPoint=l,window.$barry.$pois.classList.remove("hide")),window.$barry.$spinner.classList.add("hide"),window.$barry.$calculate.classList.add("hide"),window.$barry.$newsearch.classList.remove("hide")})})};window.$barry.canCalculate=()=>{Object.keys(window.$barry.places).length>1?window.$barry.$calculate.classList.remove("hide"):window.$barry.$calculate.classList.add("hide")};window.$barry.canPlace=r=>{window.$barry.addressToCalc[r]=!0};window.$barry.changeCalcMode=()=>{window.$barry.calculateMode==="time"?window.$barry.calculateMode="distance":window.$barry.calculateMode="time"};window.$barry.changeCalcTransport=()=>{window.$barry.calculateTransport==="car"?window.$barry.calculateTransport="pedestrian":window.$barry.calculateTransport="car"};window.$barry.changeCalcToll=()=>{window.$barry.calculateToll=!window.$barry.calculateToll};window.$barry.changeLogMode=()=>{window.$barry.$log.querySelectorAll(".log-1").forEach((r,t)=>{window.$barry.$toggleLogMode.checked?r.classList.remove("hide"):r.classList.add("hide")})};window.$barry.log=(r,t)=>{let e=t;typeof t>"u"&&(e=0),window.$barry.$logContent.innerHTML+=`<p class="log-${e}${e>0?" hide":""}">${r}</p>`};window.$barry.managePOI=r=>{Object.keys(window.$barry.layers).forEach((t,e)=>{t.startsWith("poi_")&&window.$barry.map.removeLayer(window.$barry.layers[t])});for(const t in window.$barry.pois){const e=window.$barry.pois[t];e.categories.includes(r)&&ki(e.longitude,e.latitude,"#131282",`poi_${e.identifier}`,3)}};window.$barry.newAddress=r=>{if(typeof r<"u"){const e=document.getElementById(r);e.querySelector(".plus").classList.toggle("hide"),e.querySelector(".minus").classList.toggle("hide")}const t=document.createElement("div");t.classList.add("address"),t.id=`address_${window.$barry.addressesCount}`,t.innerHTML=`
<input type="text"
       placeholder="Adresse postale"
       onfocus="window.$barry.canPlace('place_${window.$barry.addressesCount}')"
       onblur="window.$barry.placePoint(this.value, 'place_${window.$barry.addressesCount}');"
       onkeydown="window.$barry.calcAddress(event, '${window.$barry.addressesCount}', this.value)"
       data-city="place_${window.$barry.addressesCount}" />
<button class="minus hide" 
        onclick="window.$barry.removeAddress('address_${window.$barry.addressesCount}')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
    </svg>
</button>
<button class="plus" 
        onclick="window.$barry.newAddress('address_${window.$barry.addressesCount}')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
    </svg>
</button>
      `,window.$barry.$addressesWrapper.appendChild(t),window.$barry.addressesCount++,window.$barry.nbPlaces++};const Fa=()=>{ir([[51.31133241804094,-4.369239747680932],[42.14745185055437,8.623599144082085]])};window.$barry.newSearch=()=>{window.$barry.$log.classList.add("hide"),window.$barry.$newsearch.classList.add("hide"),window.$barry.$rappel.classList.remove("hide"),document.querySelectorAll(".address").forEach((r,t)=>{r.parentNode.removeChild(r)}),window.$barry.addressesCount=0,window.$barry.places={},Object.keys(window.$barry.layers).forEach((r,t)=>{window.$barry.map.removeLayer(window.$barry.layers[r])}),window.$barry.layers={},window.$barry.newAddress(),Fa(),window.$barry.$pois.classList.remove("hide"),window.$barry.pois=[],window.location.hash=""};const nd=(r,t)=>{if(r.trim()!=="")return es.Services.geocode({location:r,ssl:!0,apiKey:"essentiels",onSuccess:e=>{ki(e.locations[0].position.lon,e.locations[0].position.lat,window.$barry.addressColor,t)},onFailure:e=>{alert(e)}});window.$barry.canCalculate()};window.$barry.placePoint=(r,t)=>{window.$barry.addressToCalc[t]&&window.$barry.$newsearch.classList.contains("hide")&&(window.$barry.addressToCalc[t]=!1,window.$barry.$calculate.classList.add("hide"),nd(r,t))};window.$barry.removeAddress=r=>{let t=r;window.$barry.nbPlaces--;const e=document.getElementById(r);e.parentNode.removeChild(e),t=r.replace("address_","place_"),delete window.$barry.places[t],window.$barry.map.removeLayer(window.$barry.layers[t]),delete window.$barry.layers[t]};window.$barry.showPOI=r=>{document.querySelectorAll("#pois a").forEach((t,e)=>t.classList.remove("active")),document.querySelector(`#pois a[data-cat="${r}"]`).classList.add("active"),Object.keys(window.$barry.pois).length==0?window.$barry.tourisme().then(t=>{t.forEach((e,i)=>{window.$barry.pois[`poi_${e.identifier}`]=e}),window.$barry.managePOI(r)}):window.$barry.managePOI(r)};window.$barry.showNav=(r,t)=>{Object.keys(window.$barry.layers).forEach((e,i)=>{e.startsWith("route_")&&window.$barry.layers[e].setVisible(t===1?e.startsWith(r):!0)})};window.$barry.toggleConfiguration=()=>{window.$barry.$configuration.classList.toggle("hide"),window.$barry.$reduceConfiguration.classList.toggle("hide"),window.$barry.$augmentConfiguration.classList.toggle("hide")};window.$barry.toggleWelcome=()=>{window.$barry.$welcome.querySelector("div").classList.toggle("hide"),window.$barry.$reduceWelcome.classList.toggle("hide"),window.$barry.$augmentWelcome.classList.toggle("hide")};window.$barry.tourisme=()=>{const r=new URL(window.$barry.urlTourismAPI),t=window.$barry.meetPoint,e={lat_min:Number.parseFloat(t[1])-.2,lat_max:Number.parseFloat(t[1])+.2,lng_min:Number.parseFloat(t[0])-.3,lng_max:Number.parseFloat(t[0])+.3};Object.keys(e).forEach((n,s)=>r.searchParams.append(n,e[n]));const i=[[e.lat_min,e.lng_min],[e.lat_max,e.lng_max]];return ir(i),fetch(r).then(n=>n.text()).then(n=>{try{return JSON.parse(n)}catch{return n}})};window.$barry.zoom=r=>{ir(r)};const rd=()=>{window.$barry.layers={},ic(),window.$barry.map=new Xu({target:"map",layers:[new Bu({source:new Ku})],view:new $e({center:[2.213749,46.927638],zoom:2})}),window.$barry.map.on("pointermove",r=>{window.$barry.map.forEachFeatureAtPixel(r.pixel,t=>{if(t.id_.startsWith("poi_")){const e=window.$barry.pois[t.id_];window.$barry.$popin.innerHTML=`
<h3>${e.label}</h3>
<p>${e.description}</p>
<ul>
  <li>
    ${e.address.replace(/\|/g,"<br />")}<br />${e.postcode} ${e.city}
  </li>
  <li>
    <a href="tel:${e.phone}">${e.phone}</a>
  </li>
  <li>
    <a href="mailto:${e.mail}">${e.mail}</a>
  </li>
</ul>
`,window.$barry.$popin.classList.remove("hide")}else window.$barry.$popin.classList.add("hide")},{layerFilter:t=>t.type===new Es().type,hitTolerance:6})})};rd();Fa();window.$barry.newAddress();if(window.location.hash!==""){const r=atob(window.location.hash.substring(1)).split("|");r.length>1&&(window.$barry.calculateMode=r.shift(),window.$barry.calculateMode!=="time"&&(window.$barry.$toggleCalcMode.checked=!0),r.forEach((t,e)=>{const i=window.$barry.addressesCount-1;window.$barry.canPlace(`place_${i}`),window.$barry.placePoint(t,`place_${i}`);const n=document.getElementById(`address_${i}`);n.querySelector("input").value=t,n.querySelector(".plus").classList.add("hide"),n.querySelector(".minus").classList.remove("hide"),window.$barry.newAddress()}))}
