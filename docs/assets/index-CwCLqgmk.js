(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();window.$barry={methods:{longMiddle:{label:"Le mi-chemin en temps sur le plus long trajet entre toutes les villes",color:"#10b981"},average:{label:"La moyenne des coordonnées des villes",color:"#3b82f6"},center:{label:"Le centre du cadre dans lequel toutes les villes sont présentes",color:"#f59e0b"}},addressColor:"#111827",resultColor:"#EF4444",roadColor:"#47695B",calculateMode:"time",calculateTransport:"car",calculateToll:!0,addressesCount:0,places:{},layers:{},addressToCalc:{},urlTourismAPI:"https://titi.gougouzian.fr",tourismCategory:["Sports","Cultural","Hotel","Food","Camping","Event","Tour"],pois:{},$addressesWrapper:document.getElementById("addresses-wrapper"),$augmentConfiguration:document.getElementById("augmentConfiguration"),$augmentWelcome:document.getElementById("augmentWelcome"),$calculate:document.getElementById("calculate"),$configuration:document.getElementById("configuration"),$log:document.getElementById("log"),$logContent:document.getElementById("log-content"),$newsearch:document.getElementById("newsearch"),$reduceConfiguration:document.getElementById("reduceConfiguration"),$reduceWelcome:document.getElementById("reduceWelcome"),$pois:document.getElementById("pois"),$rappel:document.getElementById("rappel"),$spinner:document.getElementById("spinner"),$toggleCalcMode:document.getElementById("toggleCalcMode"),$toggleLogMode:document.getElementById("toggleLogMode"),$welcome:document.getElementById("welcome"),$popin:document.getElementById("popin")};window.$barry.calcAddress=(s,t,e)=>{if(s.key=="Enter"){if(e!="")window.$barry.canPlace(`place_${t}`),window.$barry.placePoint(e,`place_${t}`),window.$barry.newAddress(`address_${window.$barry.addressesCount-1}`),document.querySelector(`#address_${window.$barry.addressesCount-1} input`).focus();else if(Object.keys(window.$barry.places).length>0){window.$barry.removeAddress(`address_${t}`);const i=document.querySelectorAll(".address");i[i.length-1].querySelector(".plus").classList.remove("hide"),i[i.length-1].querySelector(".minus").classList.add("hide")}}};window.$barry.calcBox=()=>{const s=Object.keys(window.$barry.places);let t=99,e=-99,i=99,n=-99;for(let r=0;r<s.length;r++)if(s[r].startsWith("place")){const o=parseFloat(window.$barry.places[s[r]][0]),l=parseFloat(window.$barry.places[s[r]][1]);t>o&&(t=o),e<o&&(e=o),i>l&&(i=l),n<l&&(n=l)}return[[i,t],[n,e]]};const Vt={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},Al={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection"};class Ol extends Error{constructor(t){const e=Al[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}const ta=Ol;function mt(s,t){if(!s)throw new ta(t)}function ks(s){const t=de();for(let e=0,i=s.length;e<i;++e)qi(t,s[e]);return t}function Pl(s,t,e){const i=Math.min.apply(null,s),n=Math.min.apply(null,t),r=Math.max.apply(null,s),o=Math.max.apply(null,t);return Se(i,n,r,o,e)}function ar(s,t,e){return e?(e[0]=s[0]-t,e[1]=s[1]-t,e[2]=s[2]+t,e[3]=s[3]+t,e):[s[0]-t,s[1]-t,s[2]+t,s[3]+t]}function ea(s,t){return t?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t):s.slice()}function yi(s,t,e){let i,n;return t<s[0]?i=s[0]-t:s[2]<t?i=t-s[2]:i=0,e<s[1]?n=s[1]-e:s[3]<e?n=e-s[3]:n=0,i*i+n*n}function rs(s,t){return lr(s,t[0],t[1])}function Di(s,t){return s[0]<=t[0]&&t[2]<=s[2]&&s[1]<=t[1]&&t[3]<=s[3]}function lr(s,t,e){return s[0]<=t&&t<=s[2]&&s[1]<=e&&e<=s[3]}function Gs(s,t){const e=s[0],i=s[1],n=s[2],r=s[3],o=t[0],l=t[1];let h=Vt.UNKNOWN;return o<e?h=h|Vt.LEFT:o>n&&(h=h|Vt.RIGHT),l<i?h=h|Vt.BELOW:l>r&&(h=h|Vt.ABOVE),h===Vt.UNKNOWN&&(h=Vt.INTERSECTING),h}function de(){return[1/0,1/0,-1/0,-1/0]}function Se(s,t,e,i,n){return n?(n[0]=s,n[1]=t,n[2]=e,n[3]=i,n):[s,t,e,i]}function fn(s){return Se(1/0,1/0,-1/0,-1/0,s)}function Ml(s,t){const e=s[0],i=s[1];return Se(e,i,e,i,t)}function ia(s,t,e,i,n){const r=fn(n);return sa(r,s,t,e,i)}function Ji(s,t){return s[0]==t[0]&&s[2]==t[2]&&s[1]==t[1]&&s[3]==t[3]}function na(s,t){return t[0]<s[0]&&(s[0]=t[0]),t[2]>s[2]&&(s[2]=t[2]),t[1]<s[1]&&(s[1]=t[1]),t[3]>s[3]&&(s[3]=t[3]),s}function qi(s,t){t[0]<s[0]&&(s[0]=t[0]),t[0]>s[2]&&(s[2]=t[0]),t[1]<s[1]&&(s[1]=t[1]),t[1]>s[3]&&(s[3]=t[1])}function sa(s,t,e,i,n){for(;e<i;e+=n)Ll(s,t[e],t[e+1]);return s}function Ll(s,t,e){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}function ra(s,t){let e;return e=t(os(s)),e||(e=t(as(s)),e)||(e=t(ls(s)),e)||(e=t(wi(s)),e)?e:!1}function Us(s){let t=0;return hr(s)||(t=Mt(s)*Ce(s)),t}function os(s){return[s[0],s[1]]}function as(s){return[s[2],s[1]]}function fi(s){return[(s[0]+s[2])/2,(s[1]+s[3])/2]}function Dl(s,t){let e;return t==="bottom-left"?e=os(s):t==="bottom-right"?e=as(s):t==="top-left"?e=wi(s):t==="top-right"?e=ls(s):mt(!1,13),e}function Xs(s,t,e,i,n){const[r,o,l,h,u,f,g,p]=js(s,t,e,i);return Se(Math.min(r,l,u,g),Math.min(o,h,f,p),Math.max(r,l,u,g),Math.max(o,h,f,p),n)}function js(s,t,e,i){const n=t*i[0]/2,r=t*i[1]/2,o=Math.cos(e),l=Math.sin(e),h=n*o,u=n*l,f=r*o,g=r*l,p=s[0],m=s[1];return[p-h+g,m-u-f,p-h-g,m-u+f,p+h-g,m+u+f,p+h+g,m+u-f,p-h+g,m-u-f]}function Ce(s){return s[3]-s[1]}function Zi(s,t,e){const i=e||de();return ne(s,t)?(s[0]>t[0]?i[0]=s[0]:i[0]=t[0],s[1]>t[1]?i[1]=s[1]:i[1]=t[1],s[2]<t[2]?i[2]=s[2]:i[2]=t[2],s[3]<t[3]?i[3]=s[3]:i[3]=t[3]):fn(i),i}function wi(s){return[s[0],s[3]]}function ls(s){return[s[2],s[3]]}function Mt(s){return s[2]-s[0]}function ne(s,t){return s[0]<=t[2]&&s[2]>=t[0]&&s[1]<=t[3]&&s[3]>=t[1]}function hr(s){return s[2]<s[0]||s[3]<s[1]}function Nl(s,t){return t?(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t):s}function Fl(s,t,e){let i=!1;const n=Gs(s,t),r=Gs(s,e);if(n===Vt.INTERSECTING||r===Vt.INTERSECTING)i=!0;else{const o=s[0],l=s[1],h=s[2],u=s[3],f=t[0],g=t[1],p=e[0],m=e[1],E=(m-g)/(p-f);let x,v;r&Vt.ABOVE&&!(n&Vt.ABOVE)&&(x=p-(m-u)/E,i=x>=o&&x<=h),!i&&r&Vt.RIGHT&&!(n&Vt.RIGHT)&&(v=m-(p-h)*E,i=v>=l&&v<=u),!i&&r&Vt.BELOW&&!(n&Vt.BELOW)&&(x=p-(m-l)/E,i=x>=o&&x<=h),!i&&r&Vt.LEFT&&!(n&Vt.LEFT)&&(v=m-(p-o)*E,i=v>=l&&v<=u)}return i}function kl(s,t,e,i){let n=[];if(i>1){const l=s[2]-s[0],h=s[3]-s[1];for(let u=0;u<i;++u)n.push(s[0]+l*u/i,s[1],s[2],s[1]+h*u/i,s[2]-l*u/i,s[3],s[0],s[3]-h*u/i)}else n=[s[0],s[1],s[2],s[1],s[2],s[3],s[0],s[3]];t(n,n,2);const r=[],o=[];for(let l=0,h=n.length;l<h;l+=2)r.push(n[l]),o.push(n[l+1]);return Pl(r,o,e)}function oa(s,t){const e=t.getExtent(),i=fi(s);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const n=Mt(e),o=Math.floor((i[0]-e[0])/n)*n;s[0]-=o,s[2]-=o}return s}function Gl(s,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(s[0])||!isFinite(s[2]))return[[e[0],s[1],e[2],s[3]]];oa(s,t);const i=Mt(e);if(Mt(s)>i)return[[e[0],s[1],e[2],s[3]]];if(s[0]<e[0])return[[s[0]+i,s[1],e[2],s[3]],[e[0],s[1],s[2],s[3]]];if(s[2]>e[2])return[[s[0],s[1],e[2],s[3]],[e[0],s[1],s[2]-i,s[3]]]}return[s]}const hs=s=>{typeof s>"u"&&(s=window.$barry.calcBox());var t=ks([[s[0][1],s[0][0]],[s[1][1],s[1][0]]]);window.$barry.map.getView().fit(t,{size:window.$barry.map.getSize(),padding:[50,50,50,50],duration:2e3})};var Ys=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},aa={exports:{}},zi={},Rs={},no;function Ul(){if(no)return Rs;no=1;var s=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,t=new RegExp("[\\-\\.0-9"+s.source.slice(1,-1)+"\\u00B7\\u0300-\\u036F\\u203F-\\u2040]"),e=new RegExp("^"+s.source+t.source+"*(?::"+s.source+t.source+"*)?$"),i=0,n=1,r=2,o=3,l=4,h=5,u=6,f=7;function g(){}g.prototype={parse:function(S,O,N){var z=this.domBuilder;z.startDocument(),b(O,O={}),p(S,O,N,z,this.errorHandler),z.endDocument()}};function p(S,O,N,z,U){function Y(_t){if(_t>65535){_t-=65536;var Ot=55296+(_t>>10),It=56320+(_t&1023);return String.fromCharCode(Ot,It)}else return String.fromCharCode(_t)}function V(_t){var Ot=_t.slice(1,-1);return Ot in N?N[Ot]:Ot.charAt(0)==="#"?Y(parseInt(Ot.substr(1).replace("x","0x"))):(U.error("entity not found:"+_t),_t)}function B(_t){if(_t>yt){var Ot=S.substring(yt,_t).replace(/&#?\w+;/g,V);tt&&M(yt),z.characters(Ot,0,_t-yt),yt=_t}}function M(_t,Ot){for(;_t>=$&&(Ot=lt.exec(S));)F=Ot.index,$=F+Ot[0].length,tt.lineNumber++;tt.columnNumber=_t-F+1}for(var F=0,$=0,lt=/.*(?:\r\n?|\n)|.*$/g,tt=z.locator,ot=[{currentNSMap:O}],j={},yt=0;;){try{var et=S.indexOf("<",yt);if(et<0){if(!S.substr(yt).match(/^\s*$/)){var ft=z.doc,At=ft.createTextNode(S.substr(yt));ft.appendChild(At),z.currentElement=At}return}switch(et>yt&&B(et),S.charAt(et+1)){case"/":var ut=S.indexOf(">",et+3),Et=S.substring(et+2,ut),it=ot.pop();ut<0?(Et=S.substring(et+2).replace(/[\s<].*/,""),U.error("end tag name: "+Et+" is not complete:"+it.tagName),ut=et+1+Et.length):Et.match(/\s</)&&(Et=Et.replace(/[\s<].*/,""),U.error("end tag name: "+Et+" maybe not complete"),ut=et+1+Et.length);var k=it.localNSMap,W=it.tagName==Et,Q=W||it.tagName&&it.tagName.toLowerCase()==Et.toLowerCase();if(Q){if(z.endElement(it.uri,it.localName,Et),k)for(var J in k)z.endPrefixMapping(J);W||U.fatalError("end tag name: "+Et+" is not match the current start tagName:"+it.tagName)}else ot.push(it);ut++;break;case"?":tt&&M(et),ut=A(S,et,z);break;case"!":tt&&M(et),ut=P(S,et,z,U);break;default:tt&&M(et);var H=new L,st=ot[ot.length-1].currentNSMap,ut=E(S,et,H,st,V,U),Rt=H.length;if(!H.closed&&C(S,ut,H.tagName,j)&&(H.closed=!0,N.nbsp||U.warning("unclosed xml attribute")),tt&&Rt){for(var bt=m(tt,{}),Tt=0;Tt<Rt;Tt++){var Xt=H[Tt];M(Xt.offset),Xt.locator=m(tt,{})}z.locator=bt,x(H,z,st)&&ot.push(H),z.locator=tt}else x(H,z,st)&&ot.push(H);H.uri==="http://www.w3.org/1999/xhtml"&&!H.closed?ut=v(S,ut,H.tagName,V,z):ut++}}catch(_t){U.error("element parse error: "+_t),ut=-1}ut>yt?yt=ut:B(Math.max(et,yt)+1)}}function m(S,O){return O.lineNumber=S.lineNumber,O.columnNumber=S.columnNumber,O}function E(S,O,N,z,U,Y){for(var V,B,M=++O,F=i;;){var $=S.charAt(M);switch($){case"=":if(F===n)V=S.slice(O,M),F=o;else if(F===r)F=o;else throw new Error("attribute equal must after attrName");break;case"'":case'"':if(F===o||F===n)if(F===n&&(Y.warning('attribute value must after "="'),V=S.slice(O,M)),O=M+1,M=S.indexOf($,O),M>0)B=S.slice(O,M).replace(/&#?\w+;/g,U),N.add(V,B,O-1),F=h;else throw new Error("attribute value no end '"+$+"' match");else if(F==l)B=S.slice(O,M).replace(/&#?\w+;/g,U),N.add(V,B,O),Y.warning('attribute "'+V+'" missed start quot('+$+")!!"),O=M+1,F=h;else throw new Error('attribute value must after "="');break;case"/":switch(F){case i:N.setTagName(S.slice(O,M));case h:case u:case f:F=f,N.closed=!0;case l:case n:case r:break;default:throw new Error("attribute invalid close char('/')")}break;case"":return Y.error("unexpected end of input"),F==i&&N.setTagName(S.slice(O,M)),M;case">":switch(F){case i:N.setTagName(S.slice(O,M));case h:case u:case f:break;case l:case n:B=S.slice(O,M),B.slice(-1)==="/"&&(N.closed=!0,B=B.slice(0,-1));case r:F===r&&(B=V),F==l?(Y.warning('attribute "'+B+'" missed quot(")!!'),N.add(V,B.replace(/&#?\w+;/g,U),O)):((z[""]!=="http://www.w3.org/1999/xhtml"||!B.match(/^(?:disabled|checked|selected)$/i))&&Y.warning('attribute "'+B+'" missed value!! "'+B+'" instead!!'),N.add(B,B,O));break;case o:throw new Error("attribute value missed!!")}return M;case"":$=" ";default:if($<=" ")switch(F){case i:N.setTagName(S.slice(O,M)),F=u;break;case n:V=S.slice(O,M),F=r;break;case l:var B=S.slice(O,M).replace(/&#?\w+;/g,U);Y.warning('attribute "'+B+'" missed quot(")!!'),N.add(V,B,O);case h:F=u;break}else switch(F){case r:N.tagName,(z[""]!=="http://www.w3.org/1999/xhtml"||!V.match(/^(?:disabled|checked|selected)$/i))&&Y.warning('attribute "'+V+'" missed value!! "'+V+'" instead2!!'),N.add(V,V,O),O=M,F=n;break;case h:Y.warning('attribute space is required"'+V+'"!!');case u:F=n,O=M;break;case o:F=l,O=M;break;case f:throw new Error("elements closed character '/' and '>' must be connected to")}}M++}}function x(S,O,N){for(var z=S.tagName,U=null,lt=S.length;lt--;){var Y=S[lt],V=Y.qName,B=Y.value,tt=V.indexOf(":");if(tt>0)var M=Y.prefix=V.slice(0,tt),F=V.slice(tt+1),$=M==="xmlns"&&F;else F=V,M=null,$=V==="xmlns"&&"";Y.localName=F,$!==!1&&(U==null&&(U={},b(N,N={})),N[$]=U[$]=B,Y.uri="http://www.w3.org/2000/xmlns/",O.startPrefixMapping($,B))}for(var lt=S.length;lt--;){Y=S[lt];var M=Y.prefix;M&&(M==="xml"&&(Y.uri="http://www.w3.org/XML/1998/namespace"),M!=="xmlns"&&(Y.uri=N[M||""]))}var tt=z.indexOf(":");tt>0?(M=S.prefix=z.slice(0,tt),F=S.localName=z.slice(tt+1)):(M=null,F=S.localName=z);var ot=S.uri=N[M||""];if(O.startElement(ot,F,z,S),S.closed){if(O.endElement(ot,F,z),U)for(M in U)O.endPrefixMapping(M)}else return S.currentNSMap=N,S.localNSMap=U,!0}function v(S,O,N,z,U){if(/^(?:script|textarea)$/i.test(N)){var Y=S.indexOf("</"+N+">",O),V=S.substring(O+1,Y);if(/[&<]/.test(V))return/^script$/i.test(N)?(U.characters(V,0,V.length),Y):(V=V.replace(/&#?\w+;/g,z),U.characters(V,0,V.length),Y)}return O+1}function C(S,O,N,z){var U=z[N];return U==null&&(U=S.lastIndexOf("</"+N+">"),U<O&&(U=S.lastIndexOf("</"+N)),z[N]=U),U<O}function b(S,O){for(var N in S)O[N]=S[N]}function P(S,O,N,z){var U=S.charAt(O+2);switch(U){case"-":if(S.charAt(O+3)==="-"){var Y=S.indexOf("-->",O+4);return Y>O?(N.comment(S,O+4,Y-O-4),Y+3):(z.error("Unclosed comment"),-1)}else return-1;default:if(S.substr(O+3,6)=="CDATA["){var Y=S.indexOf("]]>",O+9);return N.startCDATA(),N.characters(S,O+9,Y-O-9),N.endCDATA(),Y+3}var V=K(S,O),B=V.length;if(B>1&&/!doctype/i.test(V[0][0])){var M=V[1][0],F=B>3&&/^public$/i.test(V[2][0])&&V[3][0],$=B>4&&V[4][0],lt=V[B-1];return N.startDTD(M,F&&F.replace(/^(['"])(.*?)\1$/,"$2"),$&&$.replace(/^(['"])(.*?)\1$/,"$2")),N.endDTD(),lt.index+lt[0].length}}return-1}function A(S,O,N){var z=S.indexOf("?>",O);if(z){var U=S.substring(O,z).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);return U?(U[0].length,N.processingInstruction(U[1],U[2]),z+2):-1}return-1}function L(S){}L.prototype={setTagName:function(S){if(!e.test(S))throw new Error("invalid tagName:"+S);this.tagName=S},add:function(S,O,N){if(!e.test(S))throw new Error("invalid attribute:"+S);this[this.length++]={qName:S,value:O,offset:N}},length:0,getLocalName:function(S){return this[S].localName},getLocator:function(S){return this[S].locator},getQName:function(S){return this[S].qName},getURI:function(S){return this[S].uri},getValue:function(S){return this[S].value}};function X(S,O){return S.__proto__=O,S}X({},X.prototype)instanceof X||(X=function(S,O){function N(){}N.prototype=O,N=new N;for(O in S)N[O]=S[O];return N});function K(S,O){var N,z=[],U=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(U.lastIndex=O,U.exec(S);N=U.exec(S);)if(z.push(N),N[1])return z}return Rs.XMLReader=g,Rs}var Pn={},so;function ro(){if(so)return Pn;so=1;function s(y,w){for(var T in y)w[T]=y[T]}function t(y,w){var T=y.prototype;if(Object.create){var D=Object.create(w.prototype);T.__proto__=D}if(!(T instanceof w)){let dt=function(){};var Z=dt;dt.prototype=w.prototype,dt=new dt,s(T,dt),y.prototype=T=dt}T.constructor!=y&&(typeof y!="function"&&console.error("unknow Class:"+y),T.constructor=y)}var e="http://www.w3.org/1999/xhtml",i={},n=i.ELEMENT_NODE=1,r=i.ATTRIBUTE_NODE=2,o=i.TEXT_NODE=3,l=i.CDATA_SECTION_NODE=4,h=i.ENTITY_REFERENCE_NODE=5,u=i.ENTITY_NODE=6,f=i.PROCESSING_INSTRUCTION_NODE=7,g=i.COMMENT_NODE=8,p=i.DOCUMENT_NODE=9,m=i.DOCUMENT_TYPE_NODE=10,E=i.DOCUMENT_FRAGMENT_NODE=11,x=i.NOTATION_NODE=12,v={},C={};v.INDEX_SIZE_ERR=(C[1]="Index size error",1),v.DOMSTRING_SIZE_ERR=(C[2]="DOMString size error",2);var b=v.HIERARCHY_REQUEST_ERR=(C[3]="Hierarchy request error",3);v.WRONG_DOCUMENT_ERR=(C[4]="Wrong document",4),v.INVALID_CHARACTER_ERR=(C[5]="Invalid character",5),v.NO_DATA_ALLOWED_ERR=(C[6]="No data allowed",6),v.NO_MODIFICATION_ALLOWED_ERR=(C[7]="No modification allowed",7);var P=v.NOT_FOUND_ERR=(C[8]="Not found",8);v.NOT_SUPPORTED_ERR=(C[9]="Not supported",9);var A=v.INUSE_ATTRIBUTE_ERR=(C[10]="Attribute in use",10);v.INVALID_STATE_ERR=(C[11]="Invalid state",11),v.SYNTAX_ERR=(C[12]="Syntax error",12),v.INVALID_MODIFICATION_ERR=(C[13]="Invalid modification",13),v.NAMESPACE_ERR=(C[14]="Invalid namespace",14),v.INVALID_ACCESS_ERR=(C[15]="Invalid access",15);function L(y,w){if(w instanceof Error)var T=w;else T=this,Error.call(this,C[y]),this.message=C[y],Error.captureStackTrace&&Error.captureStackTrace(this,L);return T.code=y,w&&(this.message=this.message+": "+w),T}L.prototype=Error.prototype,s(v,L);function X(){}X.prototype={length:0,item:function(y){return this[y]||null},toString:function(y,w){for(var T=[],D=0;D<this.length;D++)Xt(this[D],T,y,w);return T.join("")}};function K(y,w){this._node=y,this._refresh=w,S(this)}function S(y){var w=y._node._inc||y._node.ownerDocument._inc;if(y._inc!=w){var T=y._refresh(y._node);It(y,"length",T.length),s(T,y),y._inc=w}}K.prototype.item=function(y){return S(this),this[y]},t(K,X);function O(){}function N(y,w){for(var T=y.length;T--;)if(y[T]===w)return T}function z(y,w,T,D){if(D?w[N(w,D)]=T:w[w.length++]=T,y){T.ownerElement=y;var Z=y.ownerDocument;Z&&(D&&lt(Z,y,D),$(Z,y,T))}}function U(y,w,T){var D=N(w,T);if(D>=0){for(var Z=w.length-1;D<Z;)w[D]=w[++D];if(w.length=Z,y){var dt=y.ownerDocument;dt&&(lt(dt,y,T),T.ownerElement=null)}}else throw L(P,new Error(y.tagName+"@"+T))}O.prototype={length:0,item:X.prototype.item,getNamedItem:function(y){for(var w=this.length;w--;){var T=this[w];if(T.nodeName==y)return T}},setNamedItem:function(y){var w=y.ownerElement;if(w&&w!=this._ownerElement)throw new L(A);var T=this.getNamedItem(y.nodeName);return z(this._ownerElement,this,y,T),T},setNamedItemNS:function(y){var w=y.ownerElement,T;if(w&&w!=this._ownerElement)throw new L(A);return T=this.getNamedItemNS(y.namespaceURI,y.localName),z(this._ownerElement,this,y,T),T},removeNamedItem:function(y){var w=this.getNamedItem(y);return U(this._ownerElement,this,w),w},removeNamedItemNS:function(y,w){var T=this.getNamedItemNS(y,w);return U(this._ownerElement,this,T),T},getNamedItemNS:function(y,w){for(var T=this.length;T--;){var D=this[T];if(D.localName==w&&D.namespaceURI==y)return D}return null}};function Y(y){if(this._features={},y)for(var w in y)this._features=y[w]}Y.prototype={hasFeature:function(y,w){var T=this._features[y.toLowerCase()];return!!(T&&(!w||w in T))},createDocument:function(y,w,T){var D=new F;if(D.implementation=this,D.childNodes=new X,D.doctype=T,T&&D.appendChild(T),w){var Z=D.createElementNS(y,w);D.appendChild(Z)}return D},createDocumentType:function(y,w,T){var D=new W;return D.name=y,D.nodeName=y,D.publicId=w,D.systemId=T,D}};function V(){}V.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(y,w){return j(this,y,w)},replaceChild:function(y,w){this.insertBefore(y,w),w&&this.removeChild(w)},removeChild:function(y){return ot(this,y)},appendChild:function(y){return this.insertBefore(y,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(y){return Ot(this.ownerDocument||this,this,y)},normalize:function(){for(var y=this.firstChild;y;){var w=y.nextSibling;w&&w.nodeType==o&&y.nodeType==o?(this.removeChild(w),y.appendData(w.data)):(y.normalize(),y=w)}},isSupported:function(y,w){return this.ownerDocument.implementation.hasFeature(y,w)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(y){for(var w=this;w;){var T=w._nsMap;if(T){for(var D in T)if(T[D]==y)return D}w=w.nodeType==r?w.ownerDocument:w.parentNode}return null},lookupNamespaceURI:function(y){for(var w=this;w;){var T=w._nsMap;if(T&&y in T)return T[y];w=w.nodeType==r?w.ownerDocument:w.parentNode}return null},isDefaultNamespace:function(y){var w=this.lookupPrefix(y);return w==null}};function B(y){return y=="<"&&"&lt;"||y==">"&&"&gt;"||y=="&"&&"&amp;"||y=='"'&&"&quot;"||"&#"+y.charCodeAt()+";"}s(i,V),s(i,V.prototype);function M(y,w){if(w(y))return!0;if(y=y.firstChild)do if(M(y,w))return!0;while(y=y.nextSibling)}function F(){}function $(y,w,T){y&&y._inc++;var D=T.namespaceURI;D=="http://www.w3.org/2000/xmlns/"&&(w._nsMap[T.prefix?T.localName:""]=T.value)}function lt(y,w,T,D){y&&y._inc++;var Z=T.namespaceURI;Z=="http://www.w3.org/2000/xmlns/"&&delete w._nsMap[T.prefix?T.localName:""]}function tt(y,w,T){if(y&&y._inc){y._inc++;var D=w.childNodes;if(T)D[D.length++]=T;else{for(var Z=w.firstChild,dt=0;Z;)D[dt++]=Z,Z=Z.nextSibling;D.length=dt}}}function ot(y,w){var T=w.previousSibling,D=w.nextSibling;return T?T.nextSibling=D:y.firstChild=D,D?D.previousSibling=T:y.lastChild=T,tt(y.ownerDocument,y),w}function j(y,w,T){var D=w.parentNode;if(D&&D.removeChild(w),w.nodeType===E){var Z=w.firstChild;if(Z==null)return w;var dt=w.lastChild}else Z=dt=w;var Dt=T?T.previousSibling:y.lastChild;Z.previousSibling=Dt,dt.nextSibling=T,Dt?Dt.nextSibling=Z:y.firstChild=Z,T==null?y.lastChild=dt:T.previousSibling=dt;do Z.parentNode=y;while(Z!==dt&&(Z=Z.nextSibling));return tt(y.ownerDocument||y,y),w.nodeType==E&&(w.firstChild=w.lastChild=null),w}function yt(y,w){var T=w.parentNode;if(T){var D=y.lastChild;T.removeChild(w);var D=y.lastChild}var D=y.lastChild;return w.parentNode=y,w.previousSibling=D,w.nextSibling=null,D?D.nextSibling=w:y.firstChild=w,y.lastChild=w,tt(y.ownerDocument,y,w),w}F.prototype={nodeName:"#document",nodeType:p,doctype:null,documentElement:null,_inc:1,insertBefore:function(y,w){if(y.nodeType==E){for(var T=y.firstChild;T;){var D=T.nextSibling;this.insertBefore(T,w),T=D}return y}return this.documentElement==null&&y.nodeType==n&&(this.documentElement=y),j(this,y,w),y.ownerDocument=this,y},removeChild:function(y){return this.documentElement==y&&(this.documentElement=null),ot(this,y)},importNode:function(y,w){return _t(this,y,w)},getElementById:function(y){var w=null;return M(this.documentElement,function(T){if(T.nodeType==n&&T.getAttribute("id")==y)return w=T,!0}),w},createElement:function(y){var w=new et;w.ownerDocument=this,w.nodeName=y,w.tagName=y,w.childNodes=new X;var T=w.attributes=new O;return T._ownerElement=w,w},createDocumentFragment:function(){var y=new st;return y.ownerDocument=this,y.childNodes=new X,y},createTextNode:function(y){var w=new Et;return w.ownerDocument=this,w.appendData(y),w},createComment:function(y){var w=new it;return w.ownerDocument=this,w.appendData(y),w},createCDATASection:function(y){var w=new k;return w.ownerDocument=this,w.appendData(y),w},createProcessingInstruction:function(y,w){var T=new ut;return T.ownerDocument=this,T.tagName=T.target=y,T.nodeValue=T.data=w,T},createAttribute:function(y){var w=new ft;return w.ownerDocument=this,w.name=y,w.nodeName=y,w.localName=y,w.specified=!0,w},createEntityReference:function(y){var w=new H;return w.ownerDocument=this,w.nodeName=y,w},createElementNS:function(y,w){var T=new et,D=w.split(":"),Z=T.attributes=new O;return T.childNodes=new X,T.ownerDocument=this,T.nodeName=w,T.tagName=w,T.namespaceURI=y,D.length==2?(T.prefix=D[0],T.localName=D[1]):T.localName=w,Z._ownerElement=T,T},createAttributeNS:function(y,w){var T=new ft,D=w.split(":");return T.ownerDocument=this,T.nodeName=w,T.name=w,T.namespaceURI=y,T.specified=!0,D.length==2?(T.prefix=D[0],T.localName=D[1]):T.localName=w,T}},t(F,V);function et(){this._nsMap={}}et.prototype={nodeType:n,hasAttribute:function(y){return this.getAttributeNode(y)!=null},getAttribute:function(y){var w=this.getAttributeNode(y);return w&&w.value||""},getAttributeNode:function(y){return this.attributes.getNamedItem(y)},setAttribute:function(y,w){var T=this.ownerDocument.createAttribute(y);T.value=T.nodeValue=""+w,this.setAttributeNode(T)},removeAttribute:function(y){var w=this.getAttributeNode(y);w&&this.removeAttributeNode(w)},appendChild:function(y){return y.nodeType===E?this.insertBefore(y,null):yt(this,y)},setAttributeNode:function(y){return this.attributes.setNamedItem(y)},setAttributeNodeNS:function(y){return this.attributes.setNamedItemNS(y)},removeAttributeNode:function(y){return this.attributes.removeNamedItem(y.nodeName)},removeAttributeNS:function(y,w){var T=this.getAttributeNodeNS(y,w);T&&this.removeAttributeNode(T)},hasAttributeNS:function(y,w){return this.getAttributeNodeNS(y,w)!=null},getAttributeNS:function(y,w){var T=this.getAttributeNodeNS(y,w);return T&&T.value||""},setAttributeNS:function(y,w,T){var D=this.ownerDocument.createAttributeNS(y,w);D.value=D.nodeValue=""+T,this.setAttributeNode(D)},getAttributeNodeNS:function(y,w){return this.attributes.getNamedItemNS(y,w)},getElementsByTagName:function(y){return new K(this,function(w){var T=[];return M(w,function(D){D!==w&&D.nodeType==n&&(y==="*"||D.tagName==y)&&T.push(D)}),T})},getElementsByTagNameNS:function(y,w){return new K(this,function(T){var D=[];return M(T,function(Z){Z!==T&&Z.nodeType===n&&(y==="*"||Z.namespaceURI===y)&&(w==="*"||Z.localName==w)&&D.push(Z)}),D})}},F.prototype.getElementsByTagName=et.prototype.getElementsByTagName,F.prototype.getElementsByTagNameNS=et.prototype.getElementsByTagNameNS,t(et,V);function ft(){}ft.prototype.nodeType=r,t(ft,V);function At(){}At.prototype={data:"",substringData:function(y,w){return this.data.substring(y,y+w)},appendData:function(y){y=this.data+y,this.nodeValue=this.data=y,this.length=y.length},insertData:function(y,w){this.replaceData(y,0,w)},appendChild:function(y){throw new Error(C[b])},deleteData:function(y,w){this.replaceData(y,w,"")},replaceData:function(y,w,T){var D=this.data.substring(0,y),Z=this.data.substring(y+w);T=D+T+Z,this.nodeValue=this.data=T,this.length=T.length}},t(At,V);function Et(){}Et.prototype={nodeName:"#text",nodeType:o,splitText:function(y){var w=this.data,T=w.substring(y);w=w.substring(0,y),this.data=this.nodeValue=w,this.length=w.length;var D=this.ownerDocument.createTextNode(T);return this.parentNode&&this.parentNode.insertBefore(D,this.nextSibling),D}},t(Et,At);function it(){}it.prototype={nodeName:"#comment",nodeType:g},t(it,At);function k(){}k.prototype={nodeName:"#cdata-section",nodeType:l},t(k,At);function W(){}W.prototype.nodeType=m,t(W,V);function Q(){}Q.prototype.nodeType=x,t(Q,V);function J(){}J.prototype.nodeType=u,t(J,V);function H(){}H.prototype.nodeType=h,t(H,V);function st(){}st.prototype.nodeName="#document-fragment",st.prototype.nodeType=E,t(st,V);function ut(){}ut.prototype.nodeType=f,t(ut,V);function Rt(){}Rt.prototype.serializeToString=function(y,w,T){return bt.call(y,w,T)},V.prototype.toString=bt;function bt(y,w){var T=[],D=this.nodeType==9?this.documentElement:this,Z=D.prefix,dt=D.namespaceURI;if(dt&&Z==null){var Z=D.lookupPrefix(dt);if(Z==null)var Dt=[{namespace:dt,prefix:null}]}return Xt(this,T,y,w,Dt),T.join("")}function Tt(y,w,T){var D=y.prefix||"",Z=y.namespaceURI;if(!D&&!Z||D==="xml"&&Z==="http://www.w3.org/XML/1998/namespace"||Z=="http://www.w3.org/2000/xmlns/")return!1;for(var dt=T.length;dt--;){var Dt=T[dt];if(Dt.prefix==D)return Dt.namespace!=Z}return!0}function Xt(y,w,T,D,Z){if(D)if(y=D(y),y){if(typeof y=="string"){w.push(y);return}}else return;switch(y.nodeType){case n:Z||(Z=[]),Z.length;var dt=y.attributes,Dt=dt.length,Nt=y.firstChild,Pt=y.tagName;T=e===y.namespaceURI||T,w.push("<",Pt);for(var $t=0;$t<Dt;$t++){var jt=dt.item($t);jt.prefix=="xmlns"?Z.push({prefix:jt.localName,namespace:jt.value}):jt.nodeName=="xmlns"&&Z.push({prefix:"",namespace:jt.value})}for(var $t=0;$t<Dt;$t++){var jt=dt.item($t);if(Tt(jt,T,Z)){var Yt=jt.prefix||"",he=jt.namespaceURI,ge=Yt?" xmlns:"+Yt:" xmlns";w.push(ge,'="',he,'"'),Z.push({prefix:Yt,namespace:he})}Xt(jt,w,T,D,Z)}if(Tt(y,T,Z)){var Yt=y.prefix||"",he=y.namespaceURI,ge=Yt?" xmlns:"+Yt:" xmlns";w.push(ge,'="',he,'"'),Z.push({prefix:Yt,namespace:he})}if(Nt||T&&!/^(?:meta|link|img|br|hr|input)$/i.test(Pt)){if(w.push(">"),T&&/^script$/i.test(Pt))for(;Nt;)Nt.data?w.push(Nt.data):Xt(Nt,w,T,D,Z),Nt=Nt.nextSibling;else for(;Nt;)Xt(Nt,w,T,D,Z),Nt=Nt.nextSibling;w.push("</",Pt,">")}else w.push("/>");return;case p:case E:for(var Nt=y.firstChild;Nt;)Xt(Nt,w,T,D,Z),Nt=Nt.nextSibling;return;case r:return w.push(" ",y.name,'="',y.value.replace(/[<&"]/g,B),'"');case o:return w.push(y.data.replace(/[<&]/g,B));case l:return w.push("<![CDATA[",y.data,"]]>");case g:return w.push("<!--",y.data,"-->");case m:var ye=y.publicId,re=y.systemId;if(w.push("<!DOCTYPE ",y.name),ye)w.push(' PUBLIC "',ye),re&&re!="."&&w.push('" "',re),w.push('">');else if(re&&re!=".")w.push(' SYSTEM "',re,'">');else{var oe=y.internalSubset;oe&&w.push(" [",oe,"]"),w.push(">")}return;case f:return w.push("<?",y.target," ",y.data,"?>");case h:return w.push("&",y.nodeName,";");default:w.push("??",y.nodeName)}}function _t(y,w,T){var D;switch(w.nodeType){case n:D=w.cloneNode(!1),D.ownerDocument=y;case E:break;case r:T=!0;break}if(D||(D=w.cloneNode(!1)),D.ownerDocument=y,D.parentNode=null,T)for(var Z=w.firstChild;Z;)D.appendChild(_t(y,Z,T)),Z=Z.nextSibling;return D}function Ot(y,w,T){var D=new w.constructor;for(var Z in w){var dt=w[Z];typeof dt!="object"&&dt!=D[Z]&&(D[Z]=dt)}switch(w.childNodes&&(D.childNodes=new X),D.ownerDocument=y,D.nodeType){case n:var Dt=w.attributes,Pt=D.attributes=new O,$t=Dt.length;Pt._ownerElement=D;for(var jt=0;jt<$t;jt++)D.setAttributeNode(Ot(y,Dt.item(jt),!0));break;case r:T=!0}if(T)for(var Yt=w.firstChild;Yt;)D.appendChild(Ot(y,Yt,T)),Yt=Yt.nextSibling;return D}function It(y,w,T){y[w]=T}try{if(Object.defineProperty){let y=function(w){switch(w.nodeType){case n:case E:var T=[];for(w=w.firstChild;w;)w.nodeType!==7&&w.nodeType!==8&&T.push(y(w)),w=w.nextSibling;return T.join("");default:return w.nodeValue}};var qt=y;Object.defineProperty(K.prototype,"length",{get:function(){return S(this),this.$$length}}),Object.defineProperty(V.prototype,"textContent",{get:function(){return y(this)},set:function(w){switch(this.nodeType){case n:case E:for(;this.firstChild;)this.removeChild(this.firstChild);(w||String(w))&&this.appendChild(this.ownerDocument.createTextNode(w));break;default:this.data=w,this.value=w,this.nodeValue=w}}}),It=function(w,T,D){w["$$"+T]=D}}}catch{}return Pn.DOMImplementation=Y,Pn.XMLSerializer=Rt,Pn}var oo;function Xl(){if(oo)return zi;oo=1;function s(u){this.options=u||{locator:{}}}s.prototype.parseFromString=function(u,f){var g=this.options,p=new l,m=g.domBuilder||new e,E=g.errorHandler,x=g.locator,v=g.xmlns||{},C={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return x&&m.setDocumentLocator(x),p.errorHandler=t(E,m,x),p.domBuilder=g.domBuilder||m,/\/x?html?$/.test(f)&&(C.nbsp=" ",C.copy="©",v[""]="http://www.w3.org/1999/xhtml"),v.xml=v.xml||"http://www.w3.org/XML/1998/namespace",u?p.parse(u,v,C):p.errorHandler.error("invalid doc source"),m.doc};function t(u,f,g){if(!u){if(f instanceof e)return f;u=f}var p={},m=u instanceof Function;g=g||{};function E(x){var v=u[x];!v&&m&&(v=u.length==2?function(C){u(x,C)}:u),p[x]=v&&function(C){v("[xmldom "+x+"]	"+C+n(g))}||function(){}}return E("warning"),E("error"),E("fatalError"),p}function e(){this.cdata=!1}function i(u,f){f.lineNumber=u.lineNumber,f.columnNumber=u.columnNumber}e.prototype={startDocument:function(){this.doc=new h().createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(u,f,g,p){var m=this.doc,E=m.createElementNS(u,g||f),x=p.length;o(this,E),this.currentElement=E,this.locator&&i(this.locator,E);for(var v=0;v<x;v++){var u=p.getURI(v),C=p.getValue(v),g=p.getQName(v),b=m.createAttributeNS(u,g);this.locator&&i(p.getLocator(v),b),b.value=b.nodeValue=C,E.setAttributeNode(b)}},endElement:function(u,f,g){var p=this.currentElement;p.tagName,this.currentElement=p.parentNode},startPrefixMapping:function(u,f){},endPrefixMapping:function(u){},processingInstruction:function(u,f){var g=this.doc.createProcessingInstruction(u,f);this.locator&&i(this.locator,g),o(this,g)},ignorableWhitespace:function(u,f,g){},characters:function(u,f,g){if(u=r.apply(this,arguments),u){if(this.cdata)var p=this.doc.createCDATASection(u);else var p=this.doc.createTextNode(u);this.currentElement?this.currentElement.appendChild(p):/^\s*$/.test(u)&&this.doc.appendChild(p),this.locator&&i(this.locator,p)}},skippedEntity:function(u){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(u){(this.locator=u)&&(u.lineNumber=0)},comment:function(u,f,g){u=r.apply(this,arguments);var p=this.doc.createComment(u);this.locator&&i(this.locator,p),o(this,p)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(u,f,g){var p=this.doc.implementation;if(p&&p.createDocumentType){var m=p.createDocumentType(u,f,g);this.locator&&i(this.locator,m),o(this,m)}},warning:function(u){console.warn("[xmldom warning]	"+u,n(this.locator))},error:function(u){console.error("[xmldom error]	"+u,n(this.locator))},fatalError:function(u){throw console.error("[xmldom fatalError]	"+u,n(this.locator)),u}};function n(u){if(u)return`
@`+(u.systemId||"")+"#[line:"+u.lineNumber+",col:"+u.columnNumber+"]"}function r(u,f,g){return typeof u=="string"?u.substr(f,g):u.length>=f+g||f?new java.lang.String(u,f,g)+"":u}"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(u){e.prototype[u]=function(){return null}});function o(u,f){u.currentElement?u.currentElement.appendChild(f):u.doc.appendChild(f)}var l=Ul().XMLReader,h=zi.DOMImplementation=ro().DOMImplementation;return zi.XMLSerializer=ro().XMLSerializer,zi.DOMParser=s,zi}var Mn={exports:{}},ao;function jl(){return ao||(ao=1,function(s,t){var e=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof Ys<"u")return Ys;throw new Error("unable to locate global object")},i=e();s.exports=t=i.fetch,i.fetch&&(t.default=i.fetch.bind(i)),t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response}(Mn,Mn.exports)),Mn.exports}/*!
 * @brief Geoportal resources access library
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * copyright CeCILL-B
 * copyright IGN
 * @author IGN
 * @version 3.2.0
 * @date 04/10/2022
 *
 */(function(s,t){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4
 */(function(e,i){s.exports=i(Xl(),jl())})(Ys,function(e,i){return function(n){var r={};function o(l){if(r[l])return r[l].exports;var h=r[l]={i:l,l:!1,exports:{}};return n[l].call(h.exports,h,h.exports,o),h.l=!0,h.exports}return o.m=n,o.c=r,o.d=function(l,h,u){o.o(l,h)||Object.defineProperty(l,h,{enumerable:!0,get:u})},o.r=function(l){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(l,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(l,"__esModule",{value:!0})},o.t=function(l,h){if(1&h&&(l=o(l)),8&h||4&h&&typeof l=="object"&&l&&l.__esModule)return l;var u=Object.create(null);if(o.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:l}),2&h&&typeof l!="string")for(var f in l)o.d(u,f,(function(g){return l[g]}).bind(null,f));return u},o.n=function(l){var h=l&&l.__esModule?function(){return l.default}:function(){return l};return o.d(h,"a",h),h},o.o=function(l,h){return Object.prototype.hasOwnProperty.call(l,h)},o.p="",o(o.s=4)}([function(n){n.exports=JSON.parse(`{"name":"geoportal-access-lib","version":"3.2.0","date":"04/10/2022","description":"French Geoportal resources access library","module":"src/Gp.js","main":"dist/GpServices-src.js","homepage":"https://github.com/IGNF/geoportal-access-lib#readme","scripts":{"clean":"echo \\"Warning: no yet implemented!\\" && exit 0","setup":"npm install","cover":"nyc --reporter=lcov --reporter=text npm run test","eslint":"eslint src/","build":"webpack --mode=none","build:prod":"webpack --mode=production","build:dev":"webpack --mode=development","test":"mocha-webpack --reporter mochawesome --reporter-options reportDir=test-report,reportFilename=index --webpack-config ./test/webpack/webpack.test.js --glob \\"test_*.js\\" test/spec/","test:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.js","test:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.docker.js","test:end-to-end:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.js","test:end-to-end:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.docker.js","sample":"npm run sample:serve","sample:serve":"webpack-dev-server --mode=none --open-page samples/index-src.html --https --content-base . --output-public-path '/dist/' --port 9001 --open","sample:serve:prod":"webpack-dev-server --mode=production --open-page samples/index-prod.html --content-base . --output-public-path '/dist/' --port 9001 --open","sample:serve:dev":"webpack-dev-server --mode=development --open-page samples/index-map.html --content-base . --output-public-path '/dist/' --port 9001 --open","doc":"npm run doc:serve","doc:serve":"webpack-dev-server --content-base jsdoc --port 9001 --open"},"nyc":{"include":["src/**/*.js"],"instrument":false,"sourceMap":false},"repository":{"type":"git","url":"https://github.com/IGNF/geoportal-access-lib.git"},"keywords":["geoportail","webservice","javascript","es6"],"author":"IGNF","license":"CECILL-B","dependencies":{"es6-promise":"^4.2.4","node-fetch":"^2.6.1","xmldom":"^0.1.27"},"devDependencies":{"@babel/core":"^7.12.10","@babel/plugin-transform-template-literals":"^7.12.1","@babel/preset-env":"^7.12.11","babel-loader":"^8.2.2","chai":"^4.1.2","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.1.2","eslint":"^7.18.0","eslint-config-standard":"^16.0.2","eslint-loader":"^4.0.2","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^5.0.0","glob":"^7.1.2","handlebars-layouts":"^3.1.4","handlebars-webpack-plugin":"^1.4.1","html-webpack-plugin":"^4.5.1","istanbul-instrumenter-loader":"^3.0.1","jsdoc-webpack-plugin":"^0.3.0","loglevel":"^1.6.1","mocha":"^7.2.0","mocha-loader":"^5.1.5","mocha-webpack":"^2.0.0-beta.0","mochawesome":"^6.2.1","nyc":"^15.1.0","path":"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0","sinon":"^9.2.4","sinon-es6":"0.0.3","speed-measure-webpack-plugin":"^1.4.2","string-template":"^1.0.0","terser-webpack-plugin":"^2.3.8","webpack":"^4.46.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^2.5.2","webpack-shell-plugin":"^0.5.0"},"bundledDependencies":[],"peerDependencies":{},"optionalDependencies":{}}`)},function(n,r,o){var l,h;(function(u,f){(h=typeof(l=function(){var g=function(){},p=typeof window<"u"&&window.navigator!==void 0&&/Trident\/|MSIE /.test(window.navigator.userAgent),m=["trace","debug","info","warn","error"];function E(S,O){var N=S[O];if(typeof N.bind=="function")return N.bind(S);try{return Function.prototype.bind.call(N,S)}catch{return function(){return Function.prototype.apply.apply(N,[S,arguments])}}}function x(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function v(S){return S==="debug"&&(S="log"),typeof console<"u"&&(S==="trace"&&p?x:console[S]!==void 0?E(console,S):console.log!==void 0?E(console,"log"):g)}function C(S,O){for(var N=0;N<m.length;N++){var z=m[N];this[z]=N<S?g:this.methodFactory(z,S,O)}this.log=this.debug}function b(S,O,N){return function(){typeof console<"u"&&(C.call(this,O,N),this[S].apply(this,arguments))}}function P(S,O,N){return v(S)||b.apply(this,arguments)}function A(S,O,N){var z,U=this;O=O??"WARN";var Y="loglevel";function V(){var M;if(typeof window<"u"&&Y){try{M=window.localStorage[Y]}catch{}if(M===void 0)try{var F=window.document.cookie,$=F.indexOf(encodeURIComponent(Y)+"=");$!==-1&&(M=/^([^;]+)/.exec(F.slice($))[1])}catch{}return U.levels[M]===void 0&&(M=void 0),M}}typeof S=="string"?Y+=":"+S:typeof S=="symbol"&&(Y=void 0),U.name=S,U.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},U.methodFactory=N||P,U.getLevel=function(){return z},U.setLevel=function(M,F){if(typeof M=="string"&&U.levels[M.toUpperCase()]!==void 0&&(M=U.levels[M.toUpperCase()]),!(typeof M=="number"&&M>=0&&M<=U.levels.SILENT))throw"log.setLevel() called with invalid level: "+M;if(z=M,F!==!1&&function($){var lt=(m[$]||"silent").toUpperCase();if(typeof window<"u"&&Y){try{return void(window.localStorage[Y]=lt)}catch{}try{window.document.cookie=encodeURIComponent(Y)+"="+lt+";"}catch{}}}(M),C.call(U,M,S),typeof console>"u"&&M<U.levels.SILENT)return"No console available for logging"},U.setDefaultLevel=function(M){O=M,V()||U.setLevel(M,!1)},U.resetLevel=function(){U.setLevel(O,!1),function(){if(typeof window<"u"&&Y){try{return void window.localStorage.removeItem(Y)}catch{}try{window.document.cookie=encodeURIComponent(Y)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}()},U.enableAll=function(M){U.setLevel(U.levels.TRACE,M)},U.disableAll=function(M){U.setLevel(U.levels.SILENT,M)};var B=V();B==null&&(B=O),U.setLevel(B,!1)}var L=new A,X={};L.getLogger=function(S){if(typeof S!="symbol"&&typeof S!="string"||S==="")throw new TypeError("You must supply a name when creating a logger.");var O=X[S];return O||(O=X[S]=new A(S,L.getLevel(),L.methodFactory)),O};var K=typeof window<"u"?window.log:void 0;return L.noConflict=function(){return typeof window<"u"&&window.log===L&&(window.log=K),L},L.getLoggers=function(){return X},L.default=L,L})=="function"?l.call(r,o,r,n):l)===void 0||(n.exports=h)})()},function(n,r){n.exports=e},function(n,r,o){(function(l,h){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var u;u=function(){function f(k){return typeof k=="function"}var g=Array.isArray?Array.isArray:function(k){return Object.prototype.toString.call(k)==="[object Array]"},p=0,m=void 0,E=void 0,x=function(k,W){X[p]=k,X[p+1]=W,(p+=2)===2&&(E?E(K):U())},v=typeof window<"u"?window:void 0,C=v||{},b=C.MutationObserver||C.WebKitMutationObserver,P=typeof self>"u"&&l!==void 0&&{}.toString.call(l)==="[object process]",A=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function L(){var k=setTimeout;return function(){return k(K,1)}}var X=new Array(1e3);function K(){for(var k=0;k<p;k+=2)(0,X[k])(X[k+1]),X[k]=void 0,X[k+1]=void 0;p=0}var S,O,N,z,U=void 0;function Y(k,W){var Q=this,J=new this.constructor(M);J[B]===void 0&&At(J);var H=Q._state;if(H){var st=arguments[H-1];x(function(){return et(H,J,st,Q._result)})}else j(Q,J,k,W);return J}function V(k){if(k&&typeof k=="object"&&k.constructor===this)return k;var W=new this(M);return $(W,k),W}P?U=function(){return l.nextTick(K)}:b?(O=0,N=new b(K),z=document.createTextNode(""),N.observe(z,{characterData:!0}),U=function(){z.data=O=++O%2}):A?((S=new MessageChannel).port1.onmessage=K,U=function(){return S.port2.postMessage(0)}):U=v===void 0?function(){try{var k=Function("return this")().require("vertx");return(m=k.runOnLoop||k.runOnContext)!==void 0?function(){m(K)}:L()}catch{return L()}}():L();var B=Math.random().toString(36).substring(2);function M(){}function F(k,W,Q){W.constructor===k.constructor&&Q===Y&&W.constructor.resolve===V?function(J,H){H._state===1?tt(J,H._result):H._state===2?ot(J,H._result):j(H,void 0,function(st){return $(J,st)},function(st){return ot(J,st)})}(k,W):Q===void 0?tt(k,W):f(Q)?function(J,H,st){x(function(ut){var Rt=!1,bt=function(Tt,Xt,_t,Ot){try{Tt.call(Xt,_t,Ot)}catch(It){return It}}(st,H,function(Tt){Rt||(Rt=!0,H!==Tt?$(ut,Tt):tt(ut,Tt))},function(Tt){Rt||(Rt=!0,ot(ut,Tt))},ut._label);!Rt&&bt&&(Rt=!0,ot(ut,bt))},J)}(k,W,Q):tt(k,W)}function $(k,W){if(k===W)ot(k,new TypeError("You cannot resolve a promise with itself"));else if(H=typeof(J=W),J===null||H!=="object"&&H!=="function")tt(k,W);else{var Q=void 0;try{Q=W.then}catch(st){return void ot(k,st)}F(k,W,Q)}var J,H}function lt(k){k._onerror&&k._onerror(k._result),yt(k)}function tt(k,W){k._state===void 0&&(k._result=W,k._state=1,k._subscribers.length!==0&&x(yt,k))}function ot(k,W){k._state===void 0&&(k._state=2,k._result=W,x(lt,k))}function j(k,W,Q,J){var H=k._subscribers,st=H.length;k._onerror=null,H[st]=W,H[st+1]=Q,H[st+2]=J,st===0&&k._state&&x(yt,k)}function yt(k){var W=k._subscribers,Q=k._state;if(W.length!==0){for(var J=void 0,H=void 0,st=k._result,ut=0;ut<W.length;ut+=3)J=W[ut],H=W[ut+Q],J?et(Q,J,H,st):H(st);k._subscribers.length=0}}function et(k,W,Q,J){var H=f(Q),st=void 0,ut=void 0,Rt=!0;if(H){try{st=Q(J)}catch(bt){Rt=!1,ut=bt}if(W===st)return void ot(W,new TypeError("A promises callback cannot return that same promise."))}else st=J;W._state!==void 0||(H&&Rt?$(W,st):Rt===!1?ot(W,ut):k===1?tt(W,st):k===2&&ot(W,st))}var ft=0;function At(k){k[B]=ft++,k._state=void 0,k._result=void 0,k._subscribers=[]}var Et=function(){function k(W,Q){this._instanceConstructor=W,this.promise=new W(M),this.promise[B]||At(this.promise),g(Q)?(this.length=Q.length,this._remaining=Q.length,this._result=new Array(this.length),this.length===0?tt(this.promise,this._result):(this.length=this.length||0,this._enumerate(Q),this._remaining===0&&tt(this.promise,this._result))):ot(this.promise,new Error("Array Methods must be provided an Array"))}return k.prototype._enumerate=function(W){for(var Q=0;this._state===void 0&&Q<W.length;Q++)this._eachEntry(W[Q],Q)},k.prototype._eachEntry=function(W,Q){var J=this._instanceConstructor,H=J.resolve;if(H===V){var st=void 0,ut=void 0,Rt=!1;try{st=W.then}catch(Tt){Rt=!0,ut=Tt}if(st===Y&&W._state!==void 0)this._settledAt(W._state,Q,W._result);else if(typeof st!="function")this._remaining--,this._result[Q]=W;else if(J===it){var bt=new J(M);Rt?ot(bt,ut):F(bt,W,st),this._willSettleAt(bt,Q)}else this._willSettleAt(new J(function(Tt){return Tt(W)}),Q)}else this._willSettleAt(H(W),Q)},k.prototype._settledAt=function(W,Q,J){var H=this.promise;H._state===void 0&&(this._remaining--,W===2?ot(H,J):this._result[Q]=J),this._remaining===0&&tt(H,this._result)},k.prototype._willSettleAt=function(W,Q){var J=this;j(W,void 0,function(H){return J._settledAt(1,Q,H)},function(H){return J._settledAt(2,Q,H)})},k}(),it=function(){function k(W){this[B]=ft++,this._result=this._state=void 0,this._subscribers=[],M!==W&&(typeof W!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof k?function(Q,J){try{J(function(H){$(Q,H)},function(H){ot(Q,H)})}catch(H){ot(Q,H)}}(this,W):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return k.prototype.catch=function(W){return this.then(null,W)},k.prototype.finally=function(W){var Q=this.constructor;return f(W)?this.then(function(J){return Q.resolve(W()).then(function(){return J})},function(J){return Q.resolve(W()).then(function(){throw J})}):this.then(W,W)},k}();return it.prototype.then=Y,it.all=function(k){return new Et(this,k).promise},it.race=function(k){var W=this;return g(k)?new W(function(Q,J){for(var H=k.length,st=0;st<H;st++)W.resolve(k[st]).then(Q,J)}):new W(function(Q,J){return J(new TypeError("You must pass an array to race."))})},it.resolve=V,it.reject=function(k){var W=new this(M);return ot(W,k),W},it._setScheduler=function(k){E=k},it._setAsap=function(k){x=k},it._asap=x,it.polyfill=function(){var k=void 0;if(h!==void 0)k=h;else if(typeof self<"u")k=self;else try{k=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var W=k.Promise;if(W){var Q=null;try{Q=Object.prototype.toString.call(W.resolve())}catch{}if(Q==="[object Promise]"&&!W.cast)return}k.Promise=it},it.Promise=it,it},n.exports=u()}).call(this,o(5),o(6))},function(n,r,o){n.exports=o(8)},function(n,r){var o,l,h=n.exports={};function u(){throw new Error("setTimeout has not been defined")}function f(){throw new Error("clearTimeout has not been defined")}function g(A){if(o===setTimeout)return setTimeout(A,0);if((o===u||!o)&&setTimeout)return o=setTimeout,setTimeout(A,0);try{return o(A,0)}catch{try{return o.call(null,A,0)}catch{return o.call(this,A,0)}}}(function(){try{o=typeof setTimeout=="function"?setTimeout:u}catch{o=u}try{l=typeof clearTimeout=="function"?clearTimeout:f}catch{l=f}})();var p,m=[],E=!1,x=-1;function v(){E&&p&&(E=!1,p.length?m=p.concat(m):x=-1,m.length&&C())}function C(){if(!E){var A=g(v);E=!0;for(var L=m.length;L;){for(p=m,m=[];++x<L;)p&&p[x].run();x=-1,L=m.length}p=null,E=!1,function(X){if(l===clearTimeout)return clearTimeout(X);if((l===f||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(X);try{l(X)}catch{try{return l.call(null,X)}catch{return l.call(this,X)}}}(A)}}function b(A,L){this.fun=A,this.array=L}function P(){}h.nextTick=function(A){var L=new Array(arguments.length-1);if(arguments.length>1)for(var X=1;X<arguments.length;X++)L[X-1]=arguments[X];m.push(new b(A,L)),m.length!==1||E||g(C)},b.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=P,h.addListener=P,h.once=P,h.off=P,h.removeListener=P,h.removeAllListeners=P,h.emit=P,h.prependListener=P,h.prependOnceListener=P,h.listeners=function(A){return[]},h.binding=function(A){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(A){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(n,r){var o;o=function(){return this}();try{o=o||new Function("return this")()}catch{typeof window=="object"&&(o=window)}n.exports=o},function(n,r){n.exports=i},function(n,r,o){o.r(r),o.d(r,"servicesVersion",function(){return to}),o.d(r,"servicesDate",function(){return eo});var l=o(1),h={getLogger:function(a){"true".match(/true/)?l.disableAll():l.enableAll();var c=a||"default";return l.getLogger(c)}},u={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(a,c){if(Object.keys(arguments).length===0)return"Message indefined !";var d=Array.prototype.slice.call(arguments),_=d.shift(),R=d,I=this[_];try{I=Array.isArray(R)&&R.length>0?I.replace("%var%",R.join(" - ")):I.replace("%var%","%var% (not specified)")}catch{}return I}};function f(a){if(!(this instanceof f))throw new TypeError("ErrorService constructor cannot be called as a function.");var c=a;typeof a=="string"||a instanceof String?(this.message=a,this.status=-1,this.type=f.TYPE_UNKERR):(this.message=c.message||"undefined!?",this.type=c.type,this.status=c.status||-1),this.name="ErrorService",this.stack=new Error().stack}f.TYPE_SRVERR="SERVICE_ERROR",f.TYPE_USEERR="USAGE_ERROR",f.TYPE_UNKERR="UNKNOWN_ERROR",f.prototype=Object.create(Error.prototype,{constructor:{value:f,writable:!0,configurable:!0}});var g=f,p={normalyzeParameters:function(a){var c=null;if(a){var d=[];for(var _ in a)if(a.hasOwnProperty(_)){var R=a[_];R||(R=""),d.push(_+"="+R)}c=d.join("&")}return c},normalyzeUrl:function(a,c,d){var _=a;if(a){var R=a.indexOf("?");R===-1&&(_+="?"),R!==-1&&R!==a.length-1&&(_+="&")}return c&&(_+=typeof c=="string"?c:this.normalyzeParameters(c)),d&&(_=encodeURIComponent(_)),_},indent:function(a,c){return new Array((a||0)+1).join("	")+c}},m=o(3),E=o.n(m);function x(a){return(x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}var v,C={call:function(a){var c=h.getLogger("XHR");if(c.trace("[XHR::call()]"),E.a.polyfill(),!a.url)throw new Error("missing parameter : url is not defined !");if(!a.method)throw new Error("missing parameter : method is not defined !");a.format||(a.format="text");var d={};switch(d.url=a.url,d.data=a.data?a.data:null,d.method=a.method,d.timeOut=a.timeOut||0,d.scope=a.scope||this,d.proxy=a.proxy||null,d.content=a.content||null,d.headers=a.headers||{referer:"http://localhost"},a.method){case"DELETE":case"GET":break;case"PUT":case"POST":d.content=a.content?a.content:"application/x-www-form-urlencoded",d.headers=a.headers?a.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(a.format){case"text":this.__call(d).then(function(_){c.trace(_),a.onResponse.call(this,_)}).catch(function(_){a.onFailure.call(this,_)});break;case"json":this.__callJSON(d).then(function(_){c.trace(_),a.onResponse.call(this,_)}).catch(function(_){a.onFailure.call(this,_)});break;case"xml":this.__callXML(d).then(function(_){c.trace(_),a.onResponse.call(this,_)}).catch(function(_){a.onFailure.call(this,_)});break;default:throw new Error("This output Format is not yet supported !")}},__call:function(a){var c=h.getLogger("XHR");return c.trace("[XHR::__call()]"),new Promise(function(d,_){var R=a.method==="POST"||a.method==="PUT"?1:0;a.data&&(x(a.data)==="object"&&Object.keys(a.data).length||typeof a.data=="string"&&a.data.length)&&!R&&(a.scope.CLASSNAME==="Geocode"||a.scope.CLASSNAME==="ReverseGeocode"?a.url=a.url+a.data:a.url=p.normalyzeUrl(a.url,a.data)),c.trace("URL = ",a.url);var I=null;if(typeof window>"u"){var G=o(7),q={headers:{Referer:"https://localhost"}};return a.data&&typeof a.data=="string"&&R&&(q={method:a.method,body:a.data,headers:{"Content-Type":a.content,Referer:"https://localhost"}}),G(a.url,q).then(function(wt){if(wt.ok)d(wt.text());else{var we="Errors Occured on Http Request (status : '"+wt.statusText+"' | url : '"+wt.url+"')",Xe=wt.status;_({message:we,status:Xe})}}).catch(function(wt){_({message:wt,status:-1})})}if(window.XMLHttpRequest){c.trace("XMLHttpRequest"),(I=new XMLHttpRequest).open(a.method,a.url,!0),I.overrideMimeType=a.content;var pt=null;a.timeOut>0&&(c.trace("XHR - TimeOut actif !"),pt=window.setTimeout(function(){_({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})},a.timeOut)),R&&(c.trace("data = ",a.data),I.setRequestHeader("Content-type",a.content)),I.onerror=function(wt){console.log(wt),_(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},I.ontimeout=function(wt){console.log(wt),_(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},I.onreadystatechange=function(wt){if(I.readyState===4)if(I.status===200)window.clearTimeout(pt),d(I.response);else{var we="Errors Occured on Http Request (status : '"+wt.target.statusText+"' | url : '"+wt.target.responseURL+"' | response : '"+wt.target.response+"')",Xe=wt.target.status;_({message:we,status:Xe})}};var ht=a.data&&R?a.data:null;I.send(ht)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");c.trace("XDomainRequest"),(I=new XDomainRequest).open(a.method,a.url),I.overrideMimeType=a.content,a.timeOut>0&&(I.timeout=a.timeout,c.trace("XHR - TimeOut actif !")),R&&I.setRequestHeader("Content-type",a.content),I.onerror=function(){_(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},I.ontimeout=function(){_(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},I.onload=function(wt){if(I.status===200)d(I.responseText);else{var we="Errors Occured on Http Request (status : '"+wt.target.statusText+"' | url : '"+wt.target.responseURL+"')",Xe=wt.target.status;_({message:we,status:Xe})}};var Ht=a.data&&R?a.data:null;I.send(Ht)}})},__callJSON:function(a){return this.__call(a).then(JSON.parse).catch(function(c){console.log("_callJSON failed on : ",a.url,c)})},__callXML:function(a){return this.__call(a).then(function(c){var d;return typeof window>"u"?d=new(o(2)).DOMParser().parseFromString(c,"text/xml"):window.DOMParser?d=new window.DOMParser().parseFromString(c,"text/xml"):((d=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,d.loadXML(c)),d}).catch(function(c){console.log("__callXML failed on : ",a.url,c)})}},b={uuid:(v=Math.floor(Date.now()),function(){return v++}),call:function(a){var c=h.getLogger("JSONP");if(c.trace("[JSONP::call ()]"),!a)throw c.error("missing parameter : options !"),new Error("missing parameter : options !");if(!a.url)throw c.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(a.timeOut||(c.info("setting 'options.timeOut' default value"),a.timeOut=0),!a.onResponse)throw c.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var d=typeof a.callbackSuffix=="string"?a.callbackSuffix:this.uuid(),_=!1,R=!1,I=a.url.indexOf("callback=");if(I!==-1){_=!0;var G=a.url.indexOf("&",I);G===-1&&(G=a.url.length);var q=a.url.substring(I+9,G);q&&(R=!0,a.callbackName=q,c.info("setting 'options.callbackName' value ("+a.callbackName+") from 'options.url' parameter"))}if(!_){var pt=a.url.indexOf("?");pt===-1?a.url=a.url+"?callback=":pt===a.url.length?a.url=a.url+"callback=":a.url=a.url+"&callback=",c.info("setting callback default key in 'options.url' : "+a.url)}var ht=!!a.callbackName||R;if(R||(a.callbackName||(c.info("setting 'options.callbackName' default value"),a.callbackName="callback",(d||d==="")&&(a.callbackName+=d)),a.url=a.url.replace("callback=","callback="+a.callbackName),c.info("setting callback function name in 'options.url' : "+a.url)),a.onTimeOut||(c.info("setting 'options.onTimeOut' default value"),a.onTimeOut=function(){console.log("TimeOut while invoking url : "+a.url)}),!ht){var Ht=this,wt=null;a.timeOut>0&&(wt=window.setTimeout(function(){window[a.callbackName]=function(){},a.onTimeOut(),Ht._deleteScript(d)},a.timeOut)),window[a.callbackName]=function(we){window.clearTimeout(wt),a.onResponse(we),Ht._deleteScript(d)}}this._createScript(d,a.url)},_createScript:function(a,c){var d,_=document.getElementById("results"+a);(d=document.createElement("script")).setAttribute("type","text/javascript"),d.setAttribute("src",c),d.setAttribute("charset","UTF-8"),d.setAttribute("id","results"+a),d.setAttribute("async","true");var R=document.documentElement||document.getElementsByTagName("head")[0];_===null?R.appendChild(d):R.replaceChild(d,_)},_deleteScript:function(a){var c=document.getElementById("results"+a);if(c){var d=c.parentNode||document.documentElement;if(!d)return;d.removeChild(c)}}},P={send:function(a){var c=a||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if(typeof window<"u"||a.protocol!=="JSONP"){if(a.protocol==="XHR"||a.format==="json"?c.wrap=!1:a.protocol==="JSONP"&&a.format==="xml"&&(c.wrap=!0),c.callback=null,c.output=c.wrap?"json":null,c.wrap){var d={};d.output=c.output,d.callback=c.callback,delete d.callback,c.url=p.normalyzeUrl(a.url,d)}switch(c.protocol){case"XHR":a.method==="GET"&&a.nocache&&(c.url=p.normalyzeUrl(c.url,{t:new Date().getTime()})),C.call(c);break;case"JSONP":c.data&&(c.url=p.normalyzeUrl(c.url,c.data)),b.call(c);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}else console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS")}},A={ssl:!0,url:function(a,c){return(A.ssl===!1?"http://":"https://")+"wxs.ign.fr".concat("/",a,c)},Alti:{_key:{"elevation-json":"/alti/rest/elevation.json","elevation-xml":"/alti/rest/elevation.xml","profil-json":"/alti/rest/elevationLine.json","profil-xml":"/alti/rest/elevationLine.xml",wps:"/alti/wps"},url:function(a){return{"elevation-json":A.url(a,this._key["elevation-json"]),"elevation-xml":A.url(a,this._key["elevation-xml"]),"profil-json":A.url(a,this._key["profil-json"]),"profil-xml":A.url(a,this._key["profil-xml"]),wps:A.url(a,this._key.wps)}}},ProcessIsoCurve:{_key:"/geoportail/isochrone/rest/1.0.0/isochrone",url:function(a){return A.url(a,this._key)}},AutoComplete:{_key:"/ols/apis/completion",url:function(a){return A.url(a,this._key)}},ReverseGeocode:{_key:"/geoportail/ols",url:function(a){return A.url(a,this._key)}},AutoConf:{_key:{apiKey:"/autoconf",apiKeys:"/autoconf?keys=%KEYS%",aggregate:"/autoconf/id/"},url:function(a){var c="";if(Array.isArray(a)&&a.length>0){c=a[0];for(var d=1;d<a.length;d++)c+=","+a[d]}return{apiKey:A.url(a,this._key.apiKey),apiKeys:A.url(a[0],this._key.apiKeys).replace("%KEYS%",c),aggregate:A.url(a,this._key.aggregate)}}},Geocode:{_key:"/geoportail/ols",url:function(a){return A.url(a,this._key)}},Route:{_key:"/geoportail/itineraire/rest/1.0.0/route",url:function(a){return A.url(a,this._key)}}},L=A,X=o(0);function K(a){if(!(this instanceof K))throw new TypeError(u.getMessage("CLASS_CONSTRUCTOR"));for(var c in this.logger=h.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(_){console.log("onSuccess - la reponse est la suivante : ",_)},onFailure:function(_){_.status!==200&&_.status?console.log("onFailure - Erreur (",_.status,") : ",_.message):console.log("onFailure : ",_.message)}},a)a.hasOwnProperty(c)&&(this.options[c]=a[c]);if(!this.options.apiKey&&!this.options.serverUrl)throw new Error(u.getMessage("PARAM_MISSING","apiKey","serverUrl"));if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(_){console.log("onSuccess - la réponse brute du service est la suivante : ",_)}),this.options.onSuccess===null||typeof this.options.onSuccess!="function")throw new Error(u.getMessage("PARAM_MISSING","onSuccess()"));if(!this.options.serverUrl){L.ssl=this.options.ssl;var d=L[this.CLASSNAME].url(this.options.apiKey);typeof d=="string"?this.options.serverUrl=d:this.logger.trace("URL par defaut à determiner au niveau du composant...")}switch(this.options.httpMethod=typeof a.httpMethod=="string"?a.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(u.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(u.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol=typeof a.protocol=="string"?a.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(u.getMessage("PARAM_UNKNOWN","protocol"))}if(typeof window>"u"&&this.options.protocol==="JSONP")throw new Error(u.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));this.options.protocol==="JSONP"&&(this.options.httpMethod="GET"),this.options.nocache=a.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}K.prototype={constructor:K,call:function(){this.logger.trace("CommonService::call ()");var a=this;function c(I){this.logger.trace("CommonService::onBuildRequest : ",I),this.callService.call(a,R,d)}function d(I){this.logger.trace("CommonService::onCallService : ",I),this.analyzeResponse.call(a,R,_)}function _(I){if(this.logger.trace("CommonService::onAnalyzeResponse : ",I),!I)return R.call(this,new g("Analyse de la reponse en échec !?"));this.options.onSuccess.call(this,I)}function R(I){this.logger.trace("CommonService::onError()");var G=I;G instanceof g||(G=new g(I.message)),this.options.onFailure.call(this,G)}(function(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(a,R,c)}).call(a)},buildRequest:function(a,c){this.logger.error("overwritten method !"),a&&a.call(this,"This method must be overwritten !"),c.call(this,"This method must be overwritten !")},callService:function(a,c){var d=null,_=this.request,R=!(!this.options.proxyURL||this.options.protocol!=="XHR");this.CLASSNAME!=="Geocode"&&this.CLASSNAME!=="ReverseGeocode"&&this.CLASSNAME!=="AutoComplete"&&(this.options.serverUrl=p.normalyzeUrl(this.options.serverUrl,{"gp-access-lib":X.version},!1)),R&&(this.options.httpMethod==="GET"&&(d=this.options.proxyURL+p.normalyzeUrl(this.options.serverUrl,this.request,!0),_=null),this.options.httpMethod==="POST"&&(d=this.options.proxyURL+p.normalyzeUrl(this.options.serverUrl,null,!0),_=this.request));var I=this,G={url:d||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:this.options.protocol!=="XHR",callbackSuffix:this.options.callbackSuffix,data:_,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(q){I.logger.trace("callService::onResponse()");var pt=null;if(I.options.protocol==="XHR"&&(I.logger.trace("Response XHR",q),pt=q),I.options.protocol==="JSONP"){if(I.logger.trace("Response JSON",q),!q)return void a.call(I,new g("Le contenu de la reponse est vide !?"));if(q.http){if(q.http.status!==200)return void a.call(I,new g({status:q.http.status,message:q.http.error,type:g.TYPE_SRVERR}));pt=q.xml,I.options.rawResponse&&(pt=q)}else pt=q}if(typeof I.options.onBeforeParse=="function"){var ht=I.options.onBeforeParse(pt);typeof ht=="string"&&(pt=ht)}I.response=pt,c.call(I,pt)},onFailure:function(q){I.logger.trace("callService::onFailure()"),q.type=g.TYPE_SRVERR,a.call(I,new g(q))},onTimeOut:function(){I.logger.trace("callService::onTimeOut()"),a.call(I,new g("TimeOut!"))}};P.send(G)},analyzeResponse:function(a,c){this.logger.error("overwritten method !"),a&&a.call(this,"This method must be overwritten !"),c.call(this,"This method must be overwritten !")}};var S=K;function O(a){if(!(this instanceof O))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=h.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=a||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json"}O.CLASSNAME="AltiRequest",O.prototype={constructor:O,setPositions:function(a){for(var c=[],d=0;d<a.length;d++){var _=a[d];_.lon&&_.lat&&c.push(_)}this.positions=c},getPositions:function(a){if(!a)return this.positions;var c=this.positions.length-1;return a>c||a<c?(this.logger.warn("index out of range !"),this.positions):this.positions[a]},addPositions:function(a){for(var c=0;c<a.length;c++){var d=a[c];d.lon&&d.lat&&this.positions.push(a[c])}},getLon:function(){for(var a=[],c=0;c<this.positions.length;c++)a.push(this.positions[c].lon);return this.logger.trace(a),a.join(this.delimiter)},getLat:function(){for(var a=[],c=0;c<this.positions.length;c++)a.push(this.positions[c].lat);return this.logger.trace(a),a.join(this.delimiter)}},O.prototype.getData=function(){var a=[];return a.push({k:"lon",v:this.getLon()}),a.push({k:"lat",v:this.getLat()}),a.push({k:"delimiter",v:this.delimiter}),a.push({k:"indent",v:this.indent}),a.push({k:"crs",v:this.crs}),a.push({k:"format",v:this.format}),a};var N=O;function z(a){if(!(this instanceof z))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",N.apply(this,arguments),this.logger=h.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}z.prototype=Object.create(N.prototype,{zonly:{get:function(){return this._zonly},set:function(a){this._zonly=a}}}),z.prototype.constructor=z,z.prototype.getData=function(){var a=[];return a.push({k:"lon",v:this.getLon()}),a.push({k:"lat",v:this.getLat()}),a.push({k:"indent",v:this.indent}),a.push({k:"crs",v:this.crs}),a.push({k:"zonly",v:this.zonly}),a.push({k:"format",v:this.format}),a};var U=z;function Y(a){if(!(this instanceof Y))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",N.apply(this,arguments),this.logger=h.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}Y.prototype=Object.create(N.prototype,{sampling:{get:function(){return this._sampling},set:function(a){this._sampling=a}}}),Y.prototype.constructor=Y,Y.prototype.getData=function(){var a=[];return a.push({k:"lon",v:this.getLon()}),a.push({k:"lat",v:this.getLat()}),a.push({k:"indent",v:this.indent}),a.push({k:"crs",v:this.crs}),a.push({k:"sampling",v:this.sampling}),a.push({k:"format",v:this.format}),a};var V=Y;function B(a){if(this.logger=h.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof B))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=a||{},!this.options)throw new Error(u.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(u.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new U(this.options.param);break;case"Profil":this.DataObject=new V(this.options.param);break;default:throw new Error(u.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}B.prototype={requestString:null,constructor:B,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:`lon=__LON__
lat=__LAT__
indent=__INDENT__
crs='__CRS__'
`,input:{point:"zonly=__ZONLY__",profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var a="";return this.method==="POST"?a=this.template.post.value:this.method==="GET"&&(a=this.template.get.value),a=(a=(a=(a=a.replace(/__LON__/g,this.DataObject.getLon())).replace(/__LAT__/g,this.DataObject.getLat())).replace(/__INDENT__/g,this.DataObject.indent)).replace(/__CRS__/g,this.DataObject.crs),a+=this.__addDataInputs(),this.logger.trace("traduction tmpl",a),this.requestString=a,this.requestString},__addDataInputs:function(){var a;if(this.logger.trace("AltiRequestREST::addDataInput ()"),this.method==="POST")a=this.template.post;else{if(this.method!=="GET")throw new Error("No other HTTP method supported by the service !");a=this.template.get}if(this.DataObject.CLASSNAME==="AltiElevationRequest")return a.input.point.replace(/__ZONLY__/g,this.DataObject.zonly);if(this.DataObject.CLASSNAME==="AltiProfilRequest")return a.input.profil.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}};var M=B;function F(a){if(this.logger=h.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof F))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=a||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}F.prototype={requestString:null,constructor:F,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=<!-- __DATAINPUTS__ -->",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs><!-- __DATAINPUTS__ --></wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var a="";if(this.method==="POST")a=this.template.post.value;else{if(this.method!=="GET")return this.logger.error("No other method supported by the service !"),!1;a=this.template.get.value}return a=(a=(a=(a=(a=a.replace(/__SERVICE__/g,this.paramservice)).replace(/__VERSION__/g,this.paramversion)).replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput)).replace(/__IDENTIFIER__/g,this.paramidentifier)).replace(/__REQUEST__/g,this.paramrequest),this.method==="POST"&&(a=(a=a.replace(/__NAMESPACE__/g,this.namespaceByDefault)).replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),(a=a.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()))?(this.requestString=a,this.logger.trace("traduction tmpl",a),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var a,c=this.method==="GET"?this.template.get.input:this.template.post.input,d=this.method==="GET"?";":"",_="",R=this,I=this.DataObject.getData(),G=0;G<I.length;G++)a=G,d&&(d=a===I.length-1?"":";"),_=_.concat(R.__addDataInput(c,I[a].k,I[a].v),d);return _},__addDataInput:function(a,c,d){var _=a;return _=(_=_.replace(/__KEY__/g,c)).replace(/__DATA__/g,d)},setMethod:function(a){a==="GET"||a==="POST"?this.method=a:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}};var $=F,lt={build:function(a){if(h.getLogger("AltiRequestWPS").trace(["AltiRequestWPS::build()"]),!a)throw new Error(u.getMessage("PARAM_EMPTY","options"));if(!a.type)throw new Error(u.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var c=null;switch(a.type){case"Elevation":a.wps.identifier="gs:WPSElevation",c=new U(a.param);break;case"Profil":a.wps.identifier="gs:WPSLineElevation",c=new V(a.param);break;default:throw new Error(u.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var d={data:c,method:a.method,param:a.wps},_=new $(d);if(!_.processRequestString())throw new Error("Enable to process request !");return _.requestString}},tt={build:function(a){h.getLogger("AltiRequestFactory").trace(["AltiRequestFactory::build()"]);var c=null,d={type:a.sampling?"Profil":"Elevation",method:a.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null}};d.param.positions=a.positions,d.param.format=a.outputFormat,d.param.sampling=a.sampling,d.param.zonly=a.zonly;var _=!(a.onError===null||typeof a.onError!="function"),R=!(a.onSuccess===null||typeof a.onSuccess!="function"),I=null;switch(a.api){case"REST":var G=new M(d);if(!G.processRequestString()){if(I="Error in process request (rest) !",_)return void a.onError.call(a.scope,new g(I));throw new Error(I)}c=G.requestString;break;case"WPS":if(d.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},!(c=lt.build(d))){if(I="Error in process request (wps) !",_)return void a.onError.call(a.scope,new g(I));throw new Error(I)}break;default:if(I="Type of API is not supported by service (REST or WPS) !",_)return void a.onError.call(a.scope,new g(I));throw new Error(I)}return R&&a.onSuccess.call(a.scope,c),c}};function ot(a){if(!(this instanceof ot))throw new TypeError("XML constructor cannot be called as a function.");this.logger=h.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,a&&(a.xmlString&&typeof a.xmlString=="string"&&(this.xmlString=a.xmlString,this.xmlDoc=j(a.xmlString)),a.reader&&this.setReader(a.reader))}function j(a){if(typeof window>"u")return new(o(2)).DOMParser().parseFromString(a,"text/xml");var c,d,_="Erreur lors du parsing de la réponse du service : XML non conforme";if(window.ActiveXObject){(d=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,d.loadXML(a);var R=d.parseError;if(R.errorCode)throw R.line&&R.linepos&&(_+="( ligne "+R.line+", colonne "+R.linepos),R.reason&&(_+=":  "+R.reason+")"),new Error(_);return d}if(window.DOMParser){c=new window.DOMParser;try{d=c.parseFromString(a,"text/xml")}catch(pt){throw pt.message==="SyntaxError"?new Error(_):new Error("Erreur lors du parsing de la réponse du service : "+pt.message)}if(d.getElementsByTagName("parsererror").length>0)for(var I=d.getElementsByTagName("parsererror"),G=0;G<I.length;G++){var q=I[G].innerHTML;if(q.indexOf("Huge input lookup")===-1)throw _+="("+q+")",new Error(_)}else if(!d.documentElement)throw new Error(_);return d}throw new Error("Incompatible DOM Parser pour ce navigateur !")}ot.prototype={constructor:ot,getXMLString:function(){return this.xmlString},setXMLString:function(a){a&&typeof a=="string"&&(this.xmlString=a,this.xmlDoc=j(a))},getReader:function(){return this.reader},setReader:function(a){a&&a.read&&typeof a.read=="function"&&(this.reader=a)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(a){this.xmlDoc=a},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=j(this.xmlString)),this.xmlDoc){var a,c=function(d){var _;return d.nodeType===9?_=d.documentElement:d.nodeType===1&&(_=d),_}(this.xmlDoc);return c?(this.reader&&this.reader.read?a=this.reader.read(c):(a={})[c.nodeName]=function d(_){var R={};if(_.attributes.length>0){var I=function(wt){if(wt.attributes.length>0){for(var we={},Xe=wt.attributes,xs=0;xs<Xe.length;xs++){var io=Xe[xs];we[io.nodeName]=io.nodeValue}return we}}(_);R.attributes=I}if(_.hasChildNodes()){for(var G,q={},pt=_.childNodes,ht=0;ht<pt.length;ht++)if((G=pt[ht]).nodeType===3)R.textContent=G.nodeValue;else if(G.nodeType===1)if(q=d(G),R[G.nodeName]){if(!Array.isArray(R[G.nodeName])){var Ht=R[G.nodeName];R[G.nodeName]=[],R[G.nodeName].push(Ht)}R[G.nodeName].push(q)}else R[G.nodeName]=q}return R}(c),a):{}}}};var yt=ot;function et(){if(!(this instanceof et))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}et.prototype={constructor:et};var ft=et;function At(){if(!(this instanceof At))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}At.prototype={constructor:At};var Et=At,it={};it.READERS={elevations:function(a){var c=new ft;if(a.hasChildNodes())for(var d,_,R=a.childNodes,I=0;I<R.length;I++)d=R[I],it.READERS[d.nodeName]&&(_=it.READERS[d.nodeName](d),c.elevations.push(_));return c},elevation:function(a){var c=new Et;if(a.hasChildNodes())for(var d,_=a.childNodes,R=0;R<_.length;R++)d=_[R],it.READERS[d.nodeName]&&it.READERS[d.nodeName](d,c);return c},lat:function(a,c){var d=a.firstChild;if(!d||d.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : latitude attendue mais absente");c.lat=parseFloat(d.nodeValue)},lon:function(a,c){var d=a.firstChild;if(!d||d.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : longitude attendue mais absente");c.lon=parseFloat(d.nodeValue)},z:function(a,c){var d=a.firstChild;if(!d||d.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : altitude attendue mais absente");if(!c)return(c=new Et).z=parseFloat(d.nodeValue),c;c.z=parseFloat(d.nodeValue)},acc:function(a,c){var d=a.firstChild;if(!d||d.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : précision (acc) attendue mais absente");c.acc=parseFloat(d.nodeValue)},exceptionreport:function(a){var c={};if(a.hasChildNodes())for(var d,_=a.childNodes,R=0;R<_.length;R++)(d=_[R]).nodeName==="Exception"&&(c.exceptionReport=it.READERS.exception(d));return c},exception:function(a){var c={},d=a.getAttribute("exceptionCode");d&&(c.exceptionCode=d);var _=a.firstChild;return _&&_.nodeType===3&&(c.exception=_.nodeValue),c},error:function(a){var c={error:{}};if(a.hasChildNodes())for(var d,_=a.childNodes,R=0;R<_.length;R++){var I;(d=_[R]).nodeType===1&&d.nodeName==="code"&&(I=d.firstChild)&&I.nodeType===3&&(c.error.code=I.nodeValue),d.nodeType===1&&d.nodeName==="description"&&(I=d.firstChild)&&I.nodeType===3&&(c.error.description=I.nodeValue)}return c}},it.read=function(a){if(a.nodeName==="elevations")return it.READERS.elevations(a);if(a.nodeName==="ExceptionReport")return it.READERS.exceptionreport(a);if(a.nodeName==="error")return it.READERS.error(a);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var k=it;function W(a){return(W=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}var Q={build:function(a){var c=h.getLogger("AltiResponseFactory");c.trace(["AltiResponseFactory::build()"]);var d=null;if(a.response){if(a.rawResponse)c.trace("analyze response : raw"),d=a.response;else{switch(a.outputFormat){case"xml":c.trace("analyze response : xml");try{var _=new yt({reader:k});if(typeof a.response=="string"?_.setXMLString(a.response):_.setXMLDoc(a.response),!(d=_.parse()))throw new Error(u.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(wt){var R=wt.message;return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EXCEPTION",R),status:200,type:g.TYPE_SRVERR}))}break;case"json":c.trace("analyze response : json"),c.trace("analyze response : ",W(a.response));var I=null;if((I=typeof a.response=="string"?JSON.parse(a.response):a.response)&&I.error)return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EXCEPTION",I.error.description),status:200,type:g.TYPE_SRVERR}));if(I){var G,q=I.elevations,pt=new ft;if(Array.isArray(q)&&q.length)for(var ht=0;ht<q.length;ht++)G=new Et,W(q[ht])==="object"?(q[ht].lon&&(G.lon=q[ht].lon),q[ht].lat&&(G.lat=q[ht].lat),q[ht].z&&(G.z=q[ht].z),q[ht].acc&&(G.acc=q[ht].acc)):typeof q[ht]=="number"&&(G.z=q[ht]),Array.isArray(pt.elevations)&&pt.elevations.push(G);d=pt}if(!d)return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:g.TYPE_UNKERR,status:-1}));break;default:return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:g.TYPE_UNKERR,status:-1}))}if(d.exceptionReport)return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EXCEPTION",d.exceptionReport),type:g.TYPE_SRVERR,status:200}));if(d.error){var Ht=d.error.description;return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EXCEPTION",Ht),type:g.TYPE_SRVERR,status:200}))}}a.onSuccess.call(a.scope,d)}else a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))}};function J(a){if(!(this instanceof J))throw new TypeError(u.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",S.apply(this,arguments),this.logger=h.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!a.positions)throw new Error(u.getMessage("PARAM_MISSING","positions"));if(a.positions.length===0)throw new Error(u.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=a.positions,this.options.outputFormat=typeof a.outputFormat=="string"?a.outputFormat.toLowerCase():"xml",this.options.sampling=a.sampling||null,this.options.api=typeof a.api=="string"?a.api.toUpperCase():"REST",this.options.api==="REST"&&(this.options.httpMethod="GET"),this.options.zonly=a.zonly||!1,!this.options.serverUrl){var c=L.Alti.url(this.options.apiKey),d=null;switch(this.options.api){case"WPS":d=c.wps;break;case"REST":var _=(a.sampling?"profil":"elevation")+"-"+this.options.outputFormat;d=c[_];break;default:throw new Error(u.getMessage("PARAM_UNKNOWN","api"))}if(!d)throw new Error("Url by default not found !");this.options.serverUrl=d,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var R=this.options.serverUrl.lastIndexOf(".");if(R!==-1){var I=this.options.serverUrl.substring(R+1);if(I&&I.length<5)switch(this.logger.trace("Server Extension URL : "+I),I.toLowerCase()){case"json":case"xml":this.options.outputFormat=I.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}J.prototype=Object.create(S.prototype,{}),J.prototype.constructor=J,J.prototype.buildRequest=function(a,c){var d={httpMethod:this.options.httpMethod,onSuccess:function(_){this.request=_,c.call(this,this.request)},onError:a,scope:this,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly};tt.build(d)},J.prototype.analyzeResponse=function(a,c){if(this.response){var d={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:a,onSuccess:c,scope:this};Q.build(d)}else a.call(this,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))};var H=J;function st(){if(!(this instanceof st))throw new TypeError("AutoConfResponse constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.territories={},this.tileMatrixSets={},this.services={}}st.prototype={constructor:st,isConfLoaded:function(a){if(a)return!!this.generalOptions.apiKeys[a]},getLayersId:function(a){return this.generalOptions.apiKeys[a]},getLayersConf:function(a){var c={},d=this.getLayersId(a);if(d)for(var _=0;_<d.length;_++){var R=d[_];c[R]=this.layers[R]}return c},getLayerConf:function(a){if(this.layers)return this.layers[a]},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(a){if(this.tileMatrixSets)return this.tileMatrixSets[a]},getTerritories:function(){return this.territories},getTerritoryConf:function(a){if(this.territories)return this.territories[a]},getServices:function(){return this.services},getServiceConf:function(a){if(this.services)return this.services[a]}};var ut=st;function Rt(){if(!(this instanceof Rt))throw new TypeError("Constraint constructor cannot be called as a function.");this.crs=null,this.bbox={left:null,right:null,top:null,bottom:null},this.minScaleDenominator=null,this.maxScaleDenominator=null,this.temporalExtent=[null,null]}Rt.prototype={constructor:Rt};var bt=Rt;function Tt(){if(!(this instanceof Tt))throw new TypeError("Format constructor cannot be called as a function.");this.current=null,this.name=null}Tt.prototype={constructor:Tt};var Xt=Tt;function _t(){if(!(this instanceof _t))throw new TypeError("Layer constructor cannot be called as a function.")}_t.prototype={constructor:_t,getName:function(){return this.name},getTitle:function(){return this.title},getDescription:function(){return this.description},getLayerId:function(){return this.layerId},getQuicklookUrl:function(){return this.quicklookUrl},getDefaultProjection:function(){return this.defaultProjection},getProjections:function(){var a=[];return a.push(this.defaultProjection),a.concat(this.additionalProjections)},getBBOX:function(){if(this.globalConstraint)return this.globalConstraint.bbox},getMinScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.minScaleDenominator},getMaxScaleDenominator:function(){if(this.globalConstraint)return this.globalConstraint.maxScaleDenominator},getTMSID:function(){if(this.wmtsOptions)return this.wmtsOptions.tileMatrixSetLink},getServiceParams:function(){return this.serviceParams},getServerUrl:function(a){if(a&&this.serviceParams&&this.serviceParams.serverUrl)return this.serviceParams.serverUrl[a]},getLegends:function(){return this.legends},getMetadata:function(){return this.metadata},getStyles:function(){return this.styles},getDefaultStyle:function(){if(this.styles){for(var a,c=this.styles,d=0;d<c.length;d++)if(c[d].current===!0){a=c[d].name;break}return a}},getThematics:function(){return this.thematics},getDefaultFormat:function(){if(this.formats){for(var a,c=this.formats,d=0;d<c.length;d++)if(c[d].current===!0){a=c[d].name;break}return a}},getConstraints:function(){return this.constraints},getOriginators:function(){return this.originators},getDimensions:function(){return this.dimensions},getAggregatedLayers:function(){if(this.isAggregate)return this.aggregatedLayers}};var Ot=_t;function It(){if(!(this instanceof It))throw new TypeError("Legend constructor cannot be called as a function.");this.format=null,this.url=null,this.minScaleDenominator=null}It.prototype={constructor:It};var qt=It;function y(){if(!(this instanceof y))throw new TypeError("Metadata constructor cannot be called as a function.");this.format=null,this.url=null}y.prototype={constructor:y};var w=y;function T(){if(!(this instanceof T))throw new TypeError("Originator constructor cannot be called as a function.");this.name=null,this.attribution=null,this.logo=null,this.url=null,this.constraints=[]}T.prototype={constructor:T};var D=T;function Z(){if(!(this instanceof Z))throw new TypeError("Service constructor cannot be called as a function.");this.title=null,this.serverUrl=null,this.version=null}Z.prototype={constructor:Z};var dt=Z;function Dt(){if(!(this instanceof Dt))throw new TypeError("Style constructor cannot be called as a function.");this.name=null,this.title=null,this.current=null,this.url=null}Dt.prototype={constructor:Dt};var Pt=Dt;function $t(){if(!(this instanceof $t))throw new TypeError("Territory constructor cannot be called as a function.");this.isDefault=null,this.defaultCRS=null,this.additionalCRS=[],this.geoBBOX={left:null,right:null,top:null,bottom:null},this.geoCenter={lon:null,lat:null},this.defaultOptions={resolution:null,minScaleDenominator:null,maxScaleDenominator:null},this.defaultLayers=[]}$t.prototype={constructor:$t};var jt=$t;function Yt(){if(!(this instanceof Yt))throw new TypeError("Thematic constructor cannot be called as a function.");this.inspire=null,this.name=null}Yt.prototype={constructor:Yt};var he=Yt;function ge(){if(!(this instanceof ge))throw new TypeError("TileMatrixSet constructor cannot be called as a function.");this.projection=null,this.nativeResolutions=[],this.matrixIds=[],this.tileMatrices={}}ge.prototype={constructor:ge,getResolutions:function(){return this.nativeResolutions},getMatrixIds:function(){return this.matrixIds},getProjection:function(){return this.projection},getTileMatrices:function(){return this.tileMatrices},getTopLeftCorner:function(){var a,c=this.getTileMatrices();if(c){for(var d in c)if(c.hasOwnProperty(d)){a=c[d].topLeftCorner;break}}return a}};var Nt=ge;function ye(){if(!(this instanceof ye))throw new TypeError("TileMatrix constructor cannot be called as a function.");this.matrixId=null,this.matrixHeight=null,this.matrixWidth=null,this.scaleDenominator=null,this.tileHeight=null,this.tileWidth=null,this.topLeftCorner=null}ye.prototype={constructor:ye,getTopLeftCorner:function(){return this.topLeftCorner},getScaleDenominator:function(){return this.scaleDenominator},getTileHeight:function(){return this.tileHeight},getTileWidth:function(){return this.tileWidth},getMatrixHeight:function(){return this.matrixHeight},getMatrixWidth:function(){return this.matrixWidth}};var re=ye;function oe(){if(!(this instanceof oe))throw new TypeError("TileMatrixLimit constructor cannot be called as a function.");this.minTileRow=null,this.maxTileRow=null,this.minTileCol=null,this.maxTileCol=null}oe.prototype={constructor:oe};var Fe=oe;function be(a){return(be=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}var Ft={};function Zt(a,c){if(a.hasChildNodes())for(var d,_,R,I=a.childNodes,G=0;G<I.length;G++)(d=I[G]).nodeType===1&&(_=d.localName||d.baseName||d.nodeName,R=d.prefix||Ft.DEFAULTPREFIX,Ft.READERS[R][_]?(0,Ft.READERS[R][_])(d,c):Zt(d,c))}function nt(a){var c,d="";return a.hasChildNodes()&&((c=a.firstChild).nodeType!==3&&c.nodeType!==4||(d=c.nodeValue)),d}Ft.VERSION="1.1.0",Ft.NAMESPACES={xmlns:"http://www.opengis.net/context",gpp:"http://api.ign.fr/geoportail",ows:"http://www.opengis.net/ows/2.0",sld:"http://www.opengis.net/sld",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},Ft.SCHEMALOCATION=["http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf/autoconf.xsd","http://www.opengis.net/context http://wxs.ign.fr/schemas/extContext.xsd http://api.ign.fr/geoportail http://wxs.ign.fr/schemas/autoconf.xsd"],Ft.DEFAULTPREFIX="context",Ft.READERS={context:{ViewContext:function(a){(function(d){if(d.attributes.length>0){var _=function(q){if(q.attributes.length>0){for(var pt={},ht=q.attributes,Ht=0;Ht<ht.length;Ht++){var wt=ht[Ht];pt[wt.nodeName]=wt.nodeValue}return pt}}(d);for(var R in _)if(_.hasOwnProperty(R)){if(R==="version"&&_.version!==Ft.VERSION)return void console.log("[AutoConfResponseReader] autoconf version is not the expected one : there may be errors in parsing");if(R==="xmlns"){if(_[R]!==Ft.NAMESPACES.xmlns)return void console.log("[AutoConfResponseReader] autoconf response default namespace is not the expected one");continue}var I=R.split(":")[0],G=R.split(":")[1];if(I==="xmlns"&&G&&Ft.NAMESPACES[G]&&Ft.NAMESPACES[G]!==_[R])return void console.log("[AutoConfResponseReader] autoconf response "+R+" namespace is not the expected one");if(G==="schemaLocation"&&_[R]!==Ft.SCHEMALOCATION[0]&&_[R]!==Ft.SCHEMALOCATION[1])return void console.log("[AutoConfResponseReader] autoconf response schema location is not the expected one")}}})(a);var c=new ut;return Zt(a,c),c},Title:function(a,c){c&&c.generalOptions?c.generalOptions.title=nt(a):c&&c.lyr&&(c.lyr.title=nt(a))},Abstract:function(a,c){c&&c.lyr&&(c.lyr.description=nt(a))},Server:function(a,c){var d=a.getAttribute("service"),_=a.getAttribute("title"),R=a.getAttribute("version");if(d)if(c&&c.services&&be(c.services)==="object"&&!c.services[d]){var I=new dt;I.title=_,I.version=R,Zt(a,I),c.services[d]=I}else c&&c.lyr&&(c.lyr.serviceParams||(c.lyr.serviceParams={}),c.lyr.serviceParams.id=d,c.lyr.serviceParams.version=R)},OnlineResource:function(a,c){c&&c.hasOwnProperty("serverUrl")&&(c.serverUrl=a.getAttribute("xlink:href"))},LayerList:function(a,c){if(Zt(a,c),c&&c.layers&&c.generalOptions&&c.services){for(var d in c.layers)if(c.layers.hasOwnProperty(d)){var _=c.layers[d],R=_.apiKeys;if(R&&Array.isArray(R))for(var I=0;I<R.length;I++){var G=R[I];c.generalOptions.apiKeys&&(c.generalOptions.apiKeys[G]&&Array.isArray(c.generalOptions.apiKeys[G])||(c.generalOptions.apiKeys[G]=[]),c.generalOptions.apiKeys[G].push(d))}var q=_.serviceParams;if(q&&q.id&&!c.services[q.id]){var pt=new dt;q.serverUrl&&(pt.serverUrl=q.serverUrl),q.version&&(pt.version=q.version),c.services[q.id]=pt}if(_.wmtsOptions&&_.wmtsOptions.tileMatrixSetLink&&c.tileMatrixSets){var ht=_.wmtsOptions.tileMatrixSetLink,Ht=c.tileMatrixSets;for(var wt in Ht)Ht.hasOwnProperty(wt)&&wt===ht&&(_.defaultProjection=Ht[wt].projection)}}}},Layer:function(a,c){if(c&&c.layers){var d={lyr:new Ot,lyrId:null},_=a.getAttribute("hidden");d.lyr.hidden=_==="1";var R=a.getAttribute("queryable");if(d.lyr.queryable=R==="1",Zt(a,d),d.lyrId){if(d.lyr.serviceParams&&d.lyr.serviceParams.id){var I=d.lyr.serviceParams.id;if(I.toUpperCase().indexOf("OPENLS")!==-1||I.toUpperCase().indexOf("ELEVATION")!==-1){var G=d.lyrId.split("$")[0];d.lyrId=G+"$"+I}}d.lyr.layerId=d.lyrId,c.layers[d.lyrId]=d.lyr}}},Name:function(a,c){c&&c.lyr&&(c.lyr.name=nt(a))},SRS:function(a,c){c&&c.lyr&&(c.lyr.defaultProjection=nt(a))},Format:function(a,c){if(c&&c.lyr){var d=new Xt,_=a.getAttribute("current");d.current=_==="1",d.name=nt(a),c.lyr.formats&&Array.isArray(c.lyr.formats)||(c.lyr.formats=[]),c.lyr.formats.push(d)}},Style:function(a,c){if(c&&c.lyr){var d=new Pt,_=a.getAttribute("current");if(d.current=_==="1"||_===1,a.hasChildNodes)for(var R,I,G=a.childNodes,q=0;q<G.length;q++)(R=G[q]).nodeType===1&&((I=R.localName||R.baseName||R.nodeName)==="Name"?d.name=nt(R):I==="Title"?d.title=nt(R):I==="URL"&&(d.url=nt(R)));c.lyr.styles&&Array.isArray(c.lyr.styles)||(c.lyr.styles=[]),c.lyr.styles.push(d)}},Dimension:function(a,c){var d=a.getAttribute("name"),_=nt(a);c&&c.lyr&&(c.lyr.dimensions||(c.lyr.dimensions={}),d==="Type"?c.lyr.dimensions.type=_:d==="VisibilityRange"?c.lyr.dimensions.visibilityRange=_:d==="VisibilityMode "?c.lyr.dimensions.visibilityMode=_:d==="GeometricType"?c.lyr.dimensions.geometricType=_:d==="NoDataValue"&&(c.lyr.dimensions.noDataValue=_))}},gpp:{Theme:function(a,c){c&&c.generalOptions&&c.generalOptions.hasOwnProperty("theme")&&(c.generalOptions.theme=nt(a))},defaultGMLGFIStyleUrl:function(a,c){c&&c.generalOptions&&c.generalOptions.hasOwnProperty("defaultGMLGFIStyle")&&(c.generalOptions.defaultGMLGFIStyle=nt(a))},Territory:function(a,c){var d=a.getAttribute("id");if(d){var _=new jt,R=a.getAttribute("default");_.isDefault=R==="1",Zt(a,_),c&&c.territories&&be(c.territories)==="object"&&(c.territories[d]=_)}},defaultCRS:function(a,c){c&&c.hasOwnProperty("defaultCRS")&&(c.defaultCRS=nt(a))},AdditionalCRS:function(a,c){var d=nt(a);d&&c&&(Array.isArray(c.additionalCRS)?c.additionalCRS.push(d):(c.additionalProjections&&Array.isArray(c.additionalProjections)||(c.additionalProjections=[]),c.additionalProjections.push(d)))},DefaultLayer:function(a,c){var d=a.getAttribute("layerId");d&&c&&Array.isArray(c.defaultLayers)&&c.defaultLayers.push(d)},BoundingBox:function(a,c){if(c){var d=nt(a).split(",");if(d.length===4){var _={left:parseFloat(d[0]),right:parseFloat(d[2]),top:parseFloat(d[3]),bottom:parseFloat(d[1])},R=a.getAttribute("minT"),I=a.getAttribute("maxT");if(c.hasOwnProperty("geoBBOX"))c.geoBBOX=_;else if(c.hasOwnProperty("bbox"))if(c.bbox.left||c.bbox.right||c.bbox.top||c.bbox.bottom){c.multiConstraints||(c.multiConstraints=[]);var G=new bt;G.bbox=_,G.temporalExtent=[R,I],c.multiConstraints.push(G)}else c.bbox=_,c.temporalExtent=[R,I];else c.globalConstraint||(c.globalConstraint=new bt),c.globalConstraint.bbox=_,c.globalConstraint.temporalExtent=[R,I]}}},Resolution:function(a,c){var d=nt(a);d&&c&&c.defaultOptions&&c.defaultOptions.hasOwnProperty("resolution")&&(c.defaultOptions.resolution=parseFloat(d))},x:function(a,c){var d=nt(a);d&&c&&c.geoCenter&&c.geoCenter.hasOwnProperty("lon")&&(c.geoCenter.lon=parseFloat(d))},y:function(a,c){var d=nt(a);d&&c&&c.geoCenter&&c.geoCenter.hasOwnProperty("lat")&&(c.geoCenter.lat=parseFloat(d))},Resolutions:function(a,c){c&&c.generalOptions&&c.generalOptions.hasOwnProperty("wgs84Resolutions")&&(c.generalOptions.wgs84Resolutions=nt(a).split(","))},Layer:function(a,c){if(c&&c.hasOwnProperty("lyrId")&&c.lyr){c.lyrId=a.getAttribute("id");var d=a.getAttribute("aggregate"),_=a.getAttribute("more");(d||_)&&(c.lyr.isAggregate=!0),Zt(a,c.lyr)}},Constraint:function(a,c){var d=new bt;if(Zt(a,d),c)if(c.constraints&&Array.isArray(c.constraints)||(c.constraints=[]),d.multiConstraints&&Array.isArray(d.multiConstraints)){var _=new bt;_.crs=d.crs,_.bbox=d.bbox,_.minScaleDenominator=d.minScaleDenominator,_.maxScaleDenominator=d.maxScaleDenominator,_.temporalExtent=d.temporalExtent,c.constraints.push(_);for(var R=0;R<d.multiConstraints.length;R++)(_=new bt).crs=d.crs,_.minScaleDenominator=d.minScaleDenominator,_.maxScaleDenominator=d.maxScaleDenominator,_.bbox=d.multiConstraints[R].bbox,_.temporalExtent=d.multiConstraints[R].temporalExtent,c.constraints.push(_)}else c.constraints.push(d)},CRS:function(a,c){c&&c.hasOwnProperty("crs")&&(c.crs=nt(a))},Thematic:function(a,c){if(c){var d=new he;d.inspire=!1,d.name=nt(a),c.thematics&&Array.isArray(c.thematics)||(c.thematics=[]),c.thematics.push(d)}},InspireThematic:function(a,c){if(c){var d=new he;d.inspire=!0,d.name=nt(a),c.thematics&&Array.isArray(c.thematics)||(c.thematics=[]),c.thematics.push(d)}},Originator:function(a,c){if(c){var d=new D;d.name=a.getAttribute("name"),Zt(a,d),c.originators&&Array.isArray(c.originators)||(c.originators=[]),c.originators.push(d)}},Attribution:function(a,c){c&&c.hasOwnProperty("attribution")&&(c.attribution=nt(a))},Logo:function(a,c){c&&c.hasOwnProperty("logo")&&(c.logo=nt(a))},URL:function(a,c){c&&c.hasOwnProperty("url")&&(c.url=nt(a))},Legend:function(a,c){var d=new qt;Zt(a,d),c&&(c.legends&&Array.isArray(c.legends)||(c.legends=[]),c.legends.push(d))},LegendURL:function(a,c){if(c&&c.hasOwnProperty("format")&&(c.format=a.getAttribute("format"),a.hasChildNodes)){var d=a.childNodes[0];(d.localName||d.baseName||d.nodeName)==="OnlineResource"&&c.hasOwnProperty("url")&&(c.url=d.getAttribute("xlink:href"))}},QuickLook:function(a,c){if(a.hasChildNodes){var d=a.childNodes[0];(d.localName||d.baseName||d.nodeName)==="OnlineResource"&&c&&(c.quicklookUrl=d.getAttribute("xlink:href"))}},MetadataURL:function(a,c){if(c){var d=new w;if(d.format=a.getAttribute("format"),a.hasChildNodes){var _=a.childNodes[0];(_.localName||_.baseName||_.nodeName)==="OnlineResource"&&(d.url=_.getAttribute("xlink:href"))}c.metadata||(c.metadata=[]),c.metadata.push(d)}},Key:function(a,c){if(c){var d=a.getAttribute("id");c.apiKeys&&Array.isArray(c.apiKeys)||(c.apiKeys=[]),c.apiKeys.push(d);var _=nt(a);c.serviceParams||(c.serviceParams={}),c.serviceParams.serverUrl||(c.serviceParams.serverUrl={}),c.serviceParams.serverUrl[d]||(c.serviceParams.serverUrl[d]=_)}}},ows:{Identifier:function(a,c){c&&c.hasOwnProperty("TMS")?c.identifier=nt(a):c&&c.hasOwnProperty("matrixId")&&(c.matrixId=nt(a))},SupportedCRS:function(a,c){c&&c.TMS&&c.TMS.hasOwnProperty("projection")&&(c.TMS.projection=nt(a))}},sld:{MinScaleDenominator:function(a,c){var d=nt(a);d&&c&&(c.hasOwnProperty("defaultOptions")?c.defaultOptions.minScaleDenominator=parseFloat(d):c.lyr?(c.lyr.globalConstraint||(c.lyr.globalConstraint=new bt),c.lyr.globalConstraint.minScaleDenominator=parseFloat(d)):c.hasOwnProperty("minScaleDenominator")&&(c.minScaleDenominator=parseFloat(d)))},MaxScaleDenominator:function(a,c){var d=nt(a);d&&c&&(c.hasOwnProperty("defaultOptions")?c.defaultOptions.maxScaleDenominator=parseFloat(d):c.lyr?(c.lyr.globalConstraint||(c.lyr.globalConstraint=new bt),c.lyr.globalConstraint.maxScaleDenominator=parseFloat(d)):c.hasOwnProperty("maxScaleDenominator")&&(c.maxScaleDenominator=parseFloat(d)))}},wmts:{TileMatrixSetLimits:function(a,c){if(c){var d={};Zt(a,d),c.wmtsOptions||(c.wmtsOptions={}),c.wmtsOptions.tileMatrixSetLimits=d}},TileMatrixLimits:function(a,c){var d,_=new Fe;if(a.hasChildNodes){for(var R=a.childNodes,I=0;I<R.length;I++){var G=R[I],q=G.localName||G.baseName||G.nodeName;q==="TileMatrix"?d=nt(G):q==="MinTileRow"?_.minTileRow=nt(G):q==="MaxTileRow"?_.maxTileRow=nt(G):q==="MinTileCol"?_.minTileCol=nt(G):q==="MaxTileCol"&&(_.maxTileCol=nt(G))}d&&c&&!c[d]&&(c[d]=_)}},TileMatrixSet:function(a,c){if(c&&c.tileMatrixSets){var d={};d.TMS=new Nt,d.resolutions=[],Zt(a,d);var _=d.TMS.tileMatrices;for(var R in _)_.hasOwnProperty(R)&&d.TMS.matrixIds.push(R);if((d.TMS.getProjection()==="IGNF:WGS84G"||d.TMS.getProjection()==="EPSG:4326")&&c.generalOptions&&Array.isArray(c.generalOptions.wgs84Resolutions))for(var I=c.generalOptions.wgs84Resolutions,G=0;G<I.length;G++)d.resolutions[G]=parseFloat(I[G]);Array.isArray(d.resolutions)&&d.resolutions.sort!==void 0&&d.resolutions.sort(function(q,pt){return pt-q}),d.TMS.nativeResolutions=d.resolutions,c.tileMatrixSets[d.identifier]=d.TMS}else c&&!c.wmtsOptions&&(c.wmtsOptions={}),c.wmtsOptions.tileMatrixSetLink=nt(a)},TileMatrix:function(a,c){if(c){var d=new re;if(Zt(a,d),c.TMS&&c.TMS.getProjection()){var _=c.TMS.getProjection();if(_==="EPSG:3857"||_==="EPSG:2154"){var R=28e-5*d.scaleDenominator;c.resolutions&&Array.isArray(c.resolutions)&&c.resolutions.push(R)}}c.TMS&&c.TMS.tileMatrices&&(c.TMS.tileMatrices[d.matrixId]=d)}},ScaleDenominator:function(a,c){var d=nt(a);d&&c&&c.hasOwnProperty("scaleDenominator")&&(c.scaleDenominator=parseFloat(d))},TopLeftCorner:function(a,c){var d=nt(a).split(" ");d&&c&&(c.topLeftCorner={},c.topLeftCorner.x=parseFloat(d[0]),c.topLeftCorner.y=parseFloat(d[1]))},TileWidth:function(a,c){var d=nt(a);d&&c&&c.hasOwnProperty("tileWidth")&&(c.tileWidth=parseInt(d,10))},TileHeight:function(a,c){var d=nt(a);d&&c&&c.hasOwnProperty("tileHeight")&&(c.tileHeight=parseInt(d,10))},MatrixWidth:function(a,c){var d=nt(a);d&&c&&c.hasOwnProperty("matrixWidth")&&(c.matrixWidth=parseInt(d,10))},MatrixHeight:function(a,c){var d=nt(a);d&&c&&c.hasOwnProperty("matrixHeight")&&(c.matrixHeight=parseInt(d,10))}},serviceException:function(a){var c={};if(a.hasChildNodes())for(var d,_=a.childNodes,R=0;R<_.length;R++)(d=_[R]).nodeName==="exception"&&(c.exceptionReport=Ft.READERS.exception(d));return c},exception:function(a){var c={},d=a.getAttribute("code");d&&(c.exceptionCode=d);var _=a.firstChild;return _&&_.nodeType===3&&(c.exception=_.nodeValue),c}},Ft.read=function(a){if(a.nodeName==="ViewContext"){var c=a.prefix||Ft.DEFAULTPREFIX;return Ft.READERS[c][a.nodeName](a)}if(a.nodeName==="serviceException")return Ft.READERS[a.nodeName](a);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var ke=Ft,ee={build:function(a){h.getLogger("AutoConfResponseFactory").trace(["AutoConfResponseFactory::build()"]);var c=null;if(a.response){if(a.rawResponse)c=a.response;else{try{var d=new yt({reader:ke});typeof a.response=="string"?d.setXMLString(a.response):d.setXMLDoc(a.response),c=d.parse()}catch(q){var _=q.message;return typeof a.response=="string"?_+=`
 (raw response service'`+a.response+"')":_+=`
 (raw response service'`+a.response.documentElement.innerHTML+"')",void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EXCEPTION",_),status:200,type:g.TYPE_SRVERR}))}var R=!0;for(var I in c)c.hasOwnProperty(I)&&(R=!1);if(R)return void a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_EMPTY_2")));if(c.exceptionReport)return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EXCEPTION",c.exceptionReport),type:g.TYPE_SRVERR,status:200}))}var G=typeof window<"u"?window:{};G.Gp||(G.Gp={}),G.Gp.Config?this.mergeConfig(G.Gp.Config,c,a.layerId):G.Gp.Config=c,a.onSuccess.call(a.scope,G.Gp.Config)}else a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))},mergeConfig:function(a,c,d){if(c&&a){for(var _ in c)if(c.hasOwnProperty(_)){if(_==="generalOptions")for(var R in c[_].apiKeys)c[_].apiKeys.hasOwnProperty(R)&&!a.generalOptions.apiKeys[R]&&(a.generalOptions.apiKeys[R]=c[_].apiKeys[R]);else if(a[_])for(var I in c[_])c[_].hasOwnProperty(I)&&!a[_][I]&&(a[_][I]=c[_][I])}if(d){var G=[];for(var q in c.layers)c.layers.hasOwnProperty(q)&&G.push(q);a.layers[d]&&(a.layers[d].aggregatedLayers=G)}}}};function Kt(a){if(!(this instanceof Kt))throw new TypeError(u.getMessage("CLASS_CONSTRUCTOR","AutoConf"));if(this.CLASSNAME="AutoConf",a||(a={}),a.protocol=a.protocol||"JSONP",S.apply(this,arguments),this.logger=h.getLogger("Gp.Services.AutoConf"),this.logger.trace("[Constructeur AutoConf (options)]"),(typeof this.options.apiKey=="string"||this.options.apiKey instanceof String)&&Array.isArray(this.options.apiKey.split(","))&&this.options.apiKey.split(",").length>1&&(this.options.apiKey=this.options.apiKey.split(",")),!this.options.serverUrl&&!this.options.serverUrl){var c=L.AutoConf.url(this.options.apiKey);this.options.layerId?this.options.serverUrl=c.aggregate+this.options.layerId:Array.isArray(this.options.apiKey)&&this.options.apiKey.length>0?this.options.serverUrl=c.apiKeys:this.options.serverUrl=c.apiKey}this.options.protocol==="XHR"&&this.options.httpMethod==="POST"&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"xml"}Kt.prototype=Object.create(S.prototype,{}),Kt.prototype.constructor=Kt,Kt.prototype.buildRequest=function(a,c){var d=typeof window<"u"?window:{};if(d.Gp&&d.Gp.Config&&d.Gp.Config.generalOptions&&d.Gp.Config.layers&&d.Gp.Config.generalOptions.apiKeys[this.options.apiKey]){if(!this.options.layerId)return this.logger.warn("Gp.Config existe déjà pour cette clé"),void this.options.onSuccess.call(this,d.Gp.Config);if(d.Gp.Config.layers[this.options.layerId]&&d.Gp.Config.layers[this.options.layerId].aggregatedLayers)return this.logger.warn("Gp.Config existe déjà pour cette clé et cette couche"),void this.options.onSuccess.call(this,d.Gp.Config)}this.request="",this.options.serverUrl.indexOf("http://")!==-1&&this.layerId&&(this.request=p.normalyzeParameters({layerId:this.layerId})),this.request||this.request===""?c.call(this,this.request):a.call(this,new g(u.getMessage("SERVICE_REQUEST_BUILD")))},Kt.prototype.analyzeResponse=function(a,c){if(this.response){var d={layerId:this.options.layerId,response:this.response,rawResponse:this.options.rawResponse,onSuccess:c,onError:a,scope:this};ee.build(d)}else a.call(this,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))};var te=Kt;function pe(a){if(!(this instanceof pe))throw new TypeError("GeocodeParamREST constructor cannot be called as a function.");if(this.logger=h.getLogger(),this.logger.trace("[Constructeur GeocodeParamREST ()]"),this.options=a||{},!this.options.geocodeMethod||this.options.geocodeMethod!=="search"&&this.options.geocodeMethod!=="reverse")throw new Error("Error geocodeMethod not valid");this.geocodeMethod=this.options.geocodeMethod,this.query=this.options!==void 0?this.options.query:null,this.searchGeometry=this.options.searchGeometry||null,this.index=this.options.index||null,this.lon=this.options.position&&this.options.position.lon?this.options.position.lon:null,this.lat=this.options.position&&this.options.position.lat?this.options.position.lat:null,this.maxResp=this.options.maxResp||null,this.returnTrueGeometry=this.options.returnTrueGeometry||null,this.filters=this.options.filters||{}}pe.CLASSNAME="GeocodeParamREST",pe.prototype={constructor:pe,getFilters:function(){var a={};for(var c in this.filters)this.filters.hasOwnProperty(c)&&(a[c]=this.filters[c]);return a},getIndex:function(){return this.index===void 0?null:this.index==="StreetAddress"?"address":this.index==="CadastralParcel"?"parcel":this.index==="PositionOfInterest"?"poi":this.index==="location"?"location":this.index},getSearchGeometry:function(){return JSON.stringify(this.searchGeometry)}},pe.prototype.getParams=function(){var a=[];this.geocodeMethod==="search"&&a.push({k:"q",v:this.query}),this.index&&a.push({k:"index",v:this.getIndex()}),this.geocodeMethod==="reverse"&&a.push({k:"searchgeom",v:this.getSearchGeometry()}),this.lon&&this.lat&&(a.push({k:"lon",v:this.lon}),a.push({k:"lat",v:this.lat})),this.maxResp&&a.push({k:"limit",v:this.maxResp}),this.returnTrueGeometry&&a.push({k:"returntruegeometry",v:this.returnTrueGeometry});var c=this.getFilters();for(var d in c)a.push({k:d,v:c[d]});return a};var xi=pe;function Wt(a){if(this.logger=h.getLogger("GeocodeRequestREST"),this.logger.trace("[Constructeur GeocodeRequestREST ()]"),!(this instanceof Wt))throw new TypeError("GeocodeRequestREST constructor cannot be called as a function.");if(!a)throw new Error(u.getMessage("PARAM_EMPTY","options"));this.settings=a}Wt.prototype={requestString:null,constructor:Wt,processRequestString:function(){for(var a="",c=new xi(this.settings).getParams(),d=0;d<c.length;d++){var _=c[d];a&&(a+="&"),a+=_.k+"="+_.v}if(!this.settings.geocodeMethod||this.settings.geocodeMethod!=="search"&&this.settings.geocodeMethod!=="reverse")throw new Error("Error geocodeMethod not valid");return this.requestString="?"+a,this.logger.trace(this.requestString),this.requestString}};var ie=Wt,ce={build:function(a){var c=h.getLogger("GeocodeRequestFactory");c.trace(["GeocodeRequestFactory::build()"]);var d=new ie(a||{});if(!d.processRequestString())throw new Error("Error process request (rest) !");var _=d.requestString;return c.trace(_),_}};function Ri(){if(!(this instanceof Ri))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}Ri.prototype={constructor:Ri};var dl=Ri;function xn(){if(!(this instanceof xn))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position=null,this.matchType=null,this.placeAttributes={},this.type=null,this.accuracy=null,this.CLASSNAME="GeocodedLocation"}xn.prototype={constructor:xn};var fl=xn;function Rn(){if(!(this instanceof Rn))throw new TypeError("GeocodeResponseParser constructor cannot be called as a function.")}function $r(a,c){var d=new fl;if(a.geometry&&a.geometry.type==="Point"&&(d.position={lon:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]}),a.properties){for(var _ in a.properties)_==="_score"?d.accuracy=a.properties[_]:_==="_type"?a.properties[_]==="address"?d.type="StreetAddress":a.properties[_]==="poi"?d.type="PositionOfInterest":a.properties[_]==="parcel"&&(d.type="CadastralParcel"):d.placeAttributes[_]=a.properties[_];a.properties._type==="address"&&(d.matchType=a.properties.number!==void 0&&a.properties.number!==null?"street number":"street")}c.locations.push(d)}Rn.prototype={constructor:Rn,parse:function(a){var c=new dl,d=JSON.parse(a);if(d.type==="FeatureCollection")for(var _=0;_<d.features.length;++_)$r(d.features[_],c);else{if(d.type!=="Feature"){if(d.type==="SERVICE_ERROR")return{exceptionReport:d};var R=u.getMessage("SERVICE_RESPONSE_ANALYSE",d.type);throw new g({message:R,type:g.TYPE_UNKERR,status:200})}$r(d,c)}return c}};var gl=Rn,Vr={build:function(a){var c=null;if(a.response){if(a.rawResponse)c=a.response;else{try{if(!(c=new gl().parse(a.response)))throw new Error("L'analyse de la réponse du service !?")}catch(_){var d=_.message;return typeof a.response=="string"?d+="('"+a.response+"')":d+="('"+a.response.documentElement.innerHTML+"')",void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_ANALYSE",d),type:g.TYPE_UNKERR,status:-1}))}if(c.exceptionReport)return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EXCEPTION",c.exceptionReport),type:g.TYPE_SRVERR,status:200}))}a.onSuccess.call(a.scope,c)}else a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EMPTY"),type:g.TYPE_SRVERR,status:-1}))}};function Br(a){return(Br=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}function Ge(a){if(!(this instanceof Ge))throw new TypeError(u.getMessage("CLASS_CONSTRUCTOR","Geocode"));this.CLASSNAME="Geocode",this.logger=h.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]");var c=this.patchOptionConvertor(a);if(c.serverUrl=c.serverUrl||"https://wxs.ign.fr/calcul/geoportail/geocodage/rest/0.1/search",S.apply(this,[c]),!c.hasOwnProperty("query"))throw new Error(u.getMessage("PARAM_MISSING","query"));if(this.options.query=c.query,c.index||(this.options.index=c.index="StreetAddress"),c.filters)for(var d=Object.keys(c.filters),_=0;_<d.length;_++){var R=d[_];(c.filters[R]===void 0||Br(c.filters[R])==="object"&&Object.keys(c.filters[R]).length===0||typeof c.filters[R]=="string"&&c.filters[R].length===0||Array.isArray(c.filters[R])&&c.filters[R].length===0)&&delete this.options.filters[R]}this.options.index=c.index||"StreetAddress",this.options.maximumResponses=c.maximumResponses||20}Ge.prototype=Object.create(S.prototype,{}),Ge.prototype.constructor=Ge,Ge.prototype.patchOptionConvertor=function(a){var c=a;return c.hasOwnProperty("location")&&(this.logger.warn("The parameter 'location' is deprecated"),c.query||(c.query=c.location),delete c.location),c.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),c.filters||(c.filters=c.filterOptions,c.filters.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),c.index||(Array.isArray(c.filters.type)&&c.filters.type.length>0?c.index=c.filters.type[0]:c.index=c.filters.type),delete c.filters.type),c.filters.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),delete c.filters.bbox)),delete c.filterOptions),c.position&&(c.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),c.position.lon||(c.position.lon=c.position.x),delete c.position.x),c.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),c.position.lat||(c.position.lat=c.position.y),delete c.position.y)),c.returnFreeForm&&(this.logger.warn("The parameter 'returnFreeForm' is deprecated"),delete c.returnFreeForm),c.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete c.srs),c},Ge.prototype.buildRequest=function(a,c){var d={httpMethod:this.options.httpMethod,geocodeMethod:"search",query:this.options.query,index:this.options.index,returnTrueGeometry:this.options.returnTrueGeometry,position:this.options.position,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=ce.build(d),this.request?c.call(this,this.request):a.call(this,new g(u.getMessage("SERVICE_REQUEST_BUILD")))},Ge.prototype.analyzeResponse=function(a,c){if(this.response){var d={response:this.response,rawResponse:this.options.rawResponse,onError:a,onSuccess:c,scope:this};Vr.build(d)}else a.call(this,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))};var pl=Ge;function Kr(a){return(Kr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c})(a)}function ue(a){if(!(this instanceof ue))throw new TypeError(u.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));this.CLASSNAME="ReverseGeocode",this.logger=h.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]");var c=this.patchOptionConvertor(a);if(c.serverUrl=c.serverUrl||"https://wxs.ign.fr/calcul/geoportail/geocodage/rest/0.1/reverse",S.apply(this,[c]),!c.searchGeometry)throw new Error(u.getMessage("PARAM_MISSING","searchGeometry"));if(this.options.searchGeometry=c.searchGeometry,c.index||(this.options.index=c.index="StreetAddress"),c.filters)for(var d=Object.keys(c.filters),_=0;_<d.length;_++){var R=d[_];(c.filters[R]===void 0||Kr(c.filters[R])==="object"&&Object.keys(c.filters[R]).length===0||typeof c.filters[R]=="string"&&c.filters[R].length===0||Array.isArray(c.filters[R])&&c.filters[R].length===0)&&delete this.options.filters[R]}this.options.position=c.position,this.options.index=c.index||"StreetAddress",this.options.maximumResponses=c.maximumResponses||20}ue.prototype=Object.create(S.prototype,{}),ue.prototype.constructor=ue,ue.prototype.patchOptionConvertor=function(a){var c=a;return c.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),c.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),c.index||(Array.isArray(c.filterOptions.type)&&c.filterOptions.type.length>0?c.index=c.filterOptions.type[0]:c.index=c.filterOptions.type),delete c.filterOptions.type),c.filterOptions.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),c.searchGeometry||(c.searchGeometry=this.bbox2Json(c.filterOptions.bbox)),delete c.filterOptions.bbox),c.filterOptions.circle&&(this.logger.warn("The parameter 'filterOptions.circle' is deprecated"),c.searchGeometry||(c.searchGeometry=this.circle2Json(c.filterOptions.circle)),delete c.filterOptions.circle),c.filterOptions.polygon&&(this.logger.warn("The parameter 'filterOptions.polygon' is deprecated"),c.searchGeometry||(c.searchGeometry=this.polygon2Json(c.filterOptions.polygon)),delete c.filterOptions.polygon),!c.filters&&Object.keys(c.filterOptions).length>0&&(c.filters=c.filterOptions),delete c.filterOptions),c.position&&(c.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),c.position.lon||(c.position.lon=c.position.x),delete c.position.x),c.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),c.position.lat||(c.position.lat=c.position.y),delete c.position.y)),c.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete c.srs),c},ue.prototype.buildRequest=function(a,c){var d={httpMethod:this.options.httpMethod,geocodeMethod:"reverse",searchGeometry:this.options.searchGeometry,index:this.options.index,position:this.options.position,returnTrueGeometry:this.options.returnTrueGeometry,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=ce.build(d),this.request?c.call(this,this.request):a.call(this,new g(u.getMessage("SERVICE_REQUEST_BUILD")))},ue.prototype.analyzeResponse=function(a,c){if(this.response){var d={response:this.response,rawResponse:this.options.rawResponse,onError:a,onSuccess:c,scope:this};Vr.build(d)}else a.call(this,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))},ue.prototype.bbox2Json=function(a){return{type:"Polygon",coordinates:[[[a.left,a.top],[a.right,a.top],[a.right,a.bottom],[a.left,a.bottom],[a.left,a.top]]]}},ue.prototype.circle2Json=function(a){return{type:"Circle",radius:a.radius,coordinates:[a.x,a.y]}},ue.prototype.polygon2Json=function(a){for(var c={type:"Polygon",coordinates:[[]]},d=0;d<a.length;++d)c.coordinates[0].push([a[d].x,a[d].y]);return c},ue.geoEPSG=["EPSG:4326"];var ml=ue;function Sn(){if(!(this instanceof Sn))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}Sn.prototype={constructor:Sn};var qr=Sn;function Cn(){if(!(this instanceof Cn))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}Cn.prototype={constructor:Cn};var Zr=Cn,_l={build:function(a){var c=h.getLogger("AutoCompleteResponseFactory");c.trace(["AutoCompleteResponseFactory::build()"]);var d=null;if(a.response){if(a.rawResponse)c.trace("analyze response : raw"),d=a.response;else{var _=null;if(_=typeof a.response=="string"?JSON.parse(a.response):a.response){if(_.error)return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EXCEPTION",_.error.description),status:_.error.code,type:g.TYPE_SRVERR}));if(d=new qr,!_.results||!Array.isArray(_.results))return void a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var R=null,I=0;I<_.results.length;I++){var G=_.results[I];R=new Zr,G&&(G.country==="StreetAddress"?(R.street=G.street,R.type="StreetAddress"):G.country==="PositionOfInterest"&&(R.poi=G.street,R.kind=G.kind,R.type="PositionOfInterest"),R.position&&(R.position.x=G.x,R.position.y=G.y),R.commune=G.city,R.fullText=G.fulltext,R.postalCode=G.zipcode,R.classification=G.classification),d.suggestedLocations.push(R)}if(!d.suggestedLocations.length)return void a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!d)return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:g.TYPE_UNKERR,status:-1}));if(d.exceptionReport)return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EXCEPTION",d.exceptionReport),type:g.TYPE_SRVERR,status:200}))}a.onSuccess.call(a.scope,d)}else a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))}};function Ue(a){if(!(this instanceof Ue))throw new TypeError(u.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));this.CLASSNAME="AutoComplete",this.logger=h.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]");var c=this.patchOptionConvertor(a);if(c.serverUrl=c.serverUrl||"https://wxs.ign.fr/calcul/geoportail/geocodage/rest/0.1/completion",S.apply(this,arguments),!c.text)throw new Error(u.getMessage("PARAM_MISSING","text"));this.options.text=c.text,c.type||(c.type=["StreetAddress,PositionOfInterest"]),this.options.type=c.type,this.options.territory=c.territory||"",this.options.maximumResponses=c.maximumResponses||10,this.options.protocol==="XHR"&&this.options.httpMethod==="POST"&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}Ue.prototype=Object.create(S.prototype,{}),Ue.prototype.constructor=Ue,Ue.prototype.patchOptionConvertor=function(a){var c=a;return c.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),c.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),c.type||(c.type=c.filterOptions.type)),c.filterOptions.territory&&(this.logger.warn("The parameter 'filterOptions.territory' is deprecated"),c.terr||(c.terr=c.filterOptions.territory)),delete c.filterOptions),c},Ue.prototype.buildRequest=function(a,c){var d="";this.options.territory&&(d=this.options.territory);var _="";this.options.type&&(_=this.options.type.join(",")),this.request=p.normalyzeParameters({text:encodeURIComponent(this.options.text),type:_,terr:d,maximumResponses:this.options.maximumResponses}),this.request?c.call(this,this.request):a.call(this,new g(u.getMessage("SERVICE_REQUEST_BUILD")))},Ue.prototype.analyzeResponse=function(a,c){if(this.response){var d={response:this.response,rawResponse:this.options.rawResponse,onSuccess:c,onError:a,scope:this};_l.build(d)}else a.call(this,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))};var yl=Ue;function Si(a){if(!(this instanceof Si))throw new TypeError("RouteParamREST constructor cannot be called as a function.");this.logger=h.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=a||{},this.resource=this.options.resource,this.start=this.options.startPoint.x+","+this.options.startPoint.y,this.end=this.options.endPoint.x+","+this.options.endPoint.y,this.intermediates=this.options.viaPoints,this.profile=this.options.graph,this.crs=this.options.srs,this.constraints=this.options.constraints,this.optimization=this.options.routePreference,this.getSteps=this.options.geometryInInstructions?"true":"false",this.distanceUnit=this.options.distanceUnit,this.timeUnit=this.options.timeUnit,this.waysAttributes=this.options.waysAttributes}Si.CLASSNAME="RouteParamREST",Si.prototype={constructor:Si,getIntermediates:function(){var a=[];if(this.intermediates.length!==0)for(var c=0;c<this.intermediates.length;c++){var d=this.intermediates[c];a.push(d.x+","+d.y)}return a.join("|")},getWaysAttributes:function(){return this.waysAttributes.join("|")},getProfile:function(){return this.profile},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getOptimization:function(){return this.optimization?this.optimization:""},getConstraints:function(){var a=[];if(this.constraints.length!==0)for(var c=0;c<this.constraints.length;c++)a.push(JSON.stringify(this.constraints[c]));return a.join("|")}},Si.prototype.getParams=function(){var a=[];return a.push({k:"resource",v:this.resource}),a.push({k:"start",v:this.start}),a.push({k:"end",v:this.end}),a.push({k:"geometryFormat",v:"geojson"}),this.optimization&&a.push({k:"optimization",v:this.getOptimization()}),this.intermediates&&a.push({k:"intermediates",v:this.getIntermediates()}),this.profile&&a.push({k:"profile",v:this.getProfile()}),this.constraints&&a.push({k:"constraints",v:this.getConstraints()}),this.crs&&a.push({k:"crs",v:this.crs}),this.distanceUnit&&a.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.timeUnit&&a.push({k:"timeUnit",v:this.timeUnit}),this.waysAttributes&&a.push({k:"waysAttributes",v:this.getWaysAttributes()}),a};var wl=Si;function Tn(a){if(this.logger=h.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof Tn))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!a)throw new Error(u.getMessage("PARAM_EMPTY","options"));this.settings=a}Tn.prototype={requestString:null,constructor:Tn,processRequestString:function(){this.logger.warn(" PROTOTYPE !");for(var a=new wl(this.settings).getParams(),c="",d=0;d<a.length;d++){var _=a[d];c&&(c+="&"),c+=_.k+"="+_.v}return this.logger.trace(c),this.requestString=c,this.requestString}};var El=Tn,vl={build:function(a){h.getLogger("RouteRequestFactory").trace(["RouteRequestFactory::build()"]);var c=a||{},d=!(a.onError===null||typeof a.onError!="function"),_=null,R=new El(c);if(!R.processRequestString()){if(_="Error process request (rest) !",d)return void a.onError.call(a.scope,new g(_));throw new Error(_)}return R.requestString}};function bn(){if(!(this instanceof bn))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}bn.prototype={constructor:bn};var Hr=bn;function In(){if(!(this instanceof In))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}In.prototype={constructor:In};var Jr=In,xl={build:function(a){var c=h.getLogger("RouteResponseFactory");c.trace("RouteResponseFactory::build()");var d=null;if(a.response){if(a.rawResponse)c.trace("analyze response : raw"),d=a.response;else{var _;if(c.trace("analyze response : json"),_=typeof a.response=="string"?JSON.parse(a.response):a.response){if(_.message)return void a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_EXCEPTION",_.message)));var R=[],I=[],G=[];if((d=new Hr).hasOwnProperty("totalTime")&&(d.totalTime=parseFloat(_.duration)),d.hasOwnProperty("totalDistance")&&(d.totalDistance=parseFloat(_.distance)),d.hasOwnProperty("bbox")&&(d.bbox.left=parseFloat(_.bbox[0]),d.bbox.bottom=parseFloat(_.bbox[1]),d.bbox.right=parseFloat(_.bbox[2]),d.bbox.top=parseFloat(_.bbox[3])),d.hasOwnProperty("routeGeometry")&&!a.geometryInInstructions&&(d.routeGeometry=_.geometry),d.hasOwnProperty("routeInstructions")&&a.geometryInInstructions){var q,pt=_.portions;if(Array.isArray(pt)&&pt.length)for(q=0;q<pt.length;q++)R.push(pt[q]);if(R.length)for(q=0;q<R.length;q++)I.push(R[q].steps);if(I.length)for(q=0;q<I.length;q++)G=G.concat(I[q]);G.forEach(function(ht){switch(d.routeInstructions.push(new Jr),d.routeInstructions[d.routeInstructions.length-1].duration=ht.duration,d.routeInstructions[d.routeInstructions.length-1].distance=ht.distance,d.routeInstructions[d.routeInstructions.length-1].code="",d.routeInstructions[d.routeInstructions.length-1].instruction="",d.routeInstructions[d.routeInstructions.length-1].geometry=ht.geometry,ht.name==="Valeur non renseignée"&&(ht.name=""),ht.instruction.type){case"turn":d.routeInstructions[d.routeInstructions.length-1].instruction+="Tourner";break;case"new name":d.routeInstructions[d.routeInstructions.length-1].instruction+="Continuer tout droit";break;case"depart":d.routeInstructions[d.routeInstructions.length-1].instruction+="Départ";break;case"arrive":d.routeInstructions[d.routeInstructions.length-1].instruction+="Arrivée";break;case"merge":d.routeInstructions[d.routeInstructions.length-1].instruction+="Rejoindre";break;case"ramp":case"on ramp":d.routeInstructions[d.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"off ramp":d.routeInstructions[d.routeInstructions.length-1].instruction+="Prendre la sortie";break;case"fork":d.routeInstructions[d.routeInstructions.length-1].instruction+="Sur la bifurcation, prendre";break;case"end of road":d.routeInstructions[d.routeInstructions.length-1].instruction+="À la fin de la route, prendre";break;case"use lane":d.routeInstructions[d.routeInstructions.length-1].instruction+="Utiliser la file";break;case"continue":d.routeInstructions[d.routeInstructions.length-1].instruction+="Continuer";break;case"roundabout":case"rotary":d.routeInstructions[d.routeInstructions.length-1].instruction+="Au rond-point";break;case"roundabout turn":d.routeInstructions[d.routeInstructions.length-1].instruction+="Au rond point, tourner";break;case"notification":d.routeInstructions[d.routeInstructions.length-1].instruction+="";break;default:d.routeInstructions[d.routeInstructions.length-1].instruction+="?"+ht.instruction.type+"?"}if(ht.instruction.modifier)switch(ht.instruction.modifier){case"uturn":d.routeInstructions[d.routeInstructions.length-1].instruction="Faire demi-tour";break;case"sharp right":d.routeInstructions[d.routeInstructions.length-1].instruction+=" complètement à droite";break;case"right":d.routeInstructions[d.routeInstructions.length-1].instruction+=" à droite";break;case"slight right":d.routeInstructions[d.routeInstructions.length-1].instruction+=" légèrement à droite";break;case"straight":d.routeInstructions[d.routeInstructions.length-1].instruction="Continuer tout droit";break;case"slight left":d.routeInstructions[d.routeInstructions.length-1].instruction+=" lègèrement à gauche";break;case"left":d.routeInstructions[d.routeInstructions.length-1].instruction+=" à gauche";break;case"sharp left":d.routeInstructions[d.routeInstructions.length-1].instruction+=" complètement à gauche";break;default:d.routeInstructions[d.routeInstructions.length-1].instruction+=" ?"+ht.instruction.modifier+"?"}ht.instruction.exit&&(d.routeInstructions[d.routeInstructions.length-1].instruction+="".concat(ht.instruction.exit,"e sortie")),ht.attributes.name&&((ht.attributes.name.nom_1_droite||ht.attributes.name.toponyme)&&(d.routeInstructions[d.routeInstructions.length-1].instruction+=" sur"),ht.attributes.name.nom_1_droite&&(d.routeInstructions[d.routeInstructions.length-1].instruction+=" ".concat(ht.attributes.name.nom_1_droite)),ht.attributes.name.toponyme&&(d.routeInstructions[d.routeInstructions.length-1].instruction+=" ".concat(ht.attributes.name.toponyme)))})}}if(!d)return void a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_ANALYSE","json")));if(d.exceptionReport)return void a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_EXCEPTION_2")))}a.onSuccess.call(a.scope,d)}else a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))}};function ei(a){if(!(this instanceof ei))throw new TypeError(u.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",S.apply(this,arguments),this.logger=h.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!a.startPoint)throw new Error(u.getMessage("PARAM_MISSING","startPoint"));if(a.startPoint.x===null)throw new Error(u.getMessage("PARAM_MISSING","startPoint.x"));if(a.startPoint.y===null)throw new Error(u.getMessage("PARAM_MISSING","startPoint.y"));if(!a.endPoint)throw new Error(u.getMessage("PARAM_MISSING","endPoint"));if(a.endPoint.x===null)throw new Error(u.getMessage("PARAM_MISSING","endPoint.x"));if(a.endPoint.y===null)throw new Error(u.getMessage("PARAM_MISSING","endPoint.y"));if(a.outputFormat&&a.outputFormat!=="json"&&this.logger.warn("options.outputFormat could only be json"),this.options.outputFormat="json",this.options.resource=a.resource||"bdtopo-osrm",this.options.startPoint=a.startPoint,this.options.endPoint=a.endPoint,this.options.viaPoints=a.viaPoints||[],this.options.routePreference=a.routePreference||"fastest",a.graph?(a.graph==="Voiture"&&(this.options.graph="car"),a.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],a.constraints){if(!Array.isArray(a.constraints))throw new Error(u.getMessage("PARAM_TYPE","constraints"));for(var c=0;c<a.constraints.length;c++)this.options.constraints.push(a.constraints[c])}var d={},_={},R={};if(a.exclusions&&a.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var I=0;I<a.exclusions.length;I++)typeof a.exclusions[I]=="string"&&(a.exclusions[I]=a.exclusions[I].toLowerCase(),a.exclusions[I]==="toll"&&(R.constraintType="banned",R.key="wayType",R.operator="=",R.value="autoroute",this.options.constraints.push(R)),a.exclusions[I]==="tunnel"&&(d.constraintType="banned",d.key="wayType",d.operator="=",d.value="tunnel",this.options.constraints.push(d)),a.exclusions[I]==="bridge"&&(_.constraintType="banned",_.key="wayType",_.operator="=",_.value="pont",this.options.constraints.push(_)))}if(this.options.geometryInInstructions=a.geometryInInstructions||!1,this.options.provideBbox=a.provideBbox||!0,this.options.distanceUnit=a.distanceUnit||"m",this.options.timeUnit=a.timeUnit||"second",this.options.expectedStartTime=null,this.options.srs=a.srs||"EPSG:4326",this.options.waysAttributes=a.waysAttributes||[],!this.options.serverUrl){var G=L.Route.url(this.options.apiKey);if(!G)throw new Error("Url by default not found !");this.options.serverUrl=G,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}ei.prototype=Object.create(S.prototype,{}),ei.prototype.constructor=ei,ei.prototype.buildRequest=function(a,c){var d={resource:this.options.resource,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,constraints:this.options.constraints,distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs,waysAttributes:this.options.waysAttributes};this.request=vl.build(d),this.request?c.call(this,this.request):a.call(this,new g(u.getMessage("SERVICE_REQUEST_BUILD")))},ei.prototype.analyzeResponse=function(a,c){if(this.response){var d={distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:a,onSuccess:c,scope:this,geometryInInstructions:this.options.geometryInInstructions};xl.build(d)}else a.call(this,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))};var Rl=ei;function Ci(a){if(!(this instanceof Ci))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");this.logger=h.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam ()]"),this.options=a||{},this.id=this.options.id,this.resource=this.options.resource,this.point=this.options.position,this.crs=this.options.srs,this.profile=this.options.graph,this.constraints=this.options.constraints,this.reverse=this.options.reverse,this.timeUnit=this.options.timeUnit,this.distanceUnit=this.options.distanceUnit,this.options.method==="distance"?(this.costType="distance",this.costValue=this.options.distance):(this.costType="time",this.costValue=this.options.time)}Ci.CLASSNAME="ProcessIsoCurveParam",Ci.prototype={constructor:Ci,getLocation:function(){return this.point.x+","+this.point.y},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getConstraints:function(){var a=[];if(this.constraints.length!==0)for(var c=0;c<this.constraints.length;c++)a.push(JSON.stringify(this.constraints[c]));return a.join("|")},getDirection:function(){return this.reverse?"arrival":"departure"}},Ci.prototype.getParams=function(){var a=[];return a.push({k:"resource",v:this.resource}),a.push({k:"point",v:this.getLocation()}),a.push({k:"direction",v:this.getDirection()}),a.push({k:"costType",v:this.costType}),a.push({k:"costValue",v:this.costValue}),a.push({k:"profile",v:this.profile}),a.push({k:"timeUnit",v:this.timeUnit}),a.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.crs&&a.push({k:"crs",v:this.crs}),this.constraints&&a.push({k:"constraints",v:this.getConstraints()}),a};var Sl=Ci;function An(a){if(this.logger=h.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest ()]"),!(this instanceof An))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!a)throw new Error(u.getMessage("PARAM_EMPTY","options"));this.settings=a,this.mode=this.settings.httpMethod||"GET"}An.prototype={requestString:null,constructor:An,processRequestString:function(){var a="",c=0;switch(this.mode){case"GET":this.logger.trace("Process GET Request");var d=new Sl(this.settings).getParams();for(c=0;c<d.length;c++){var _=d[c];a&&(a+="&"),a+=_.k+"="+_.v}break;case"POST":this.logger.trace("Process POST Request");var R={};R.resource=this.settings.resource,R.point=this.settings.position.x+","+this.settings.position.y,this.settings.method==="distance"?(R.costType="distance",R.costValue=this.settings.distance):(R.costType="time",R.costValue=this.settings.time),R.profile=this.settings.graph,this.settings.reverse?R.direction="arrival":R.direction="departure",R.constraints=this.settings.constraints,R.distanceUnit=this.settings.distanceUnit,R.timeUnit=this.settings.timeUnit,R.crs=this.settings.srs,a=JSON.stringify(R);break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(a),this.requestString=a,this.requestString}};var Cl=An;function On(){if(!(this instanceof On))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}On.prototype={constructor:On};var Qr=On,Tl={build:function(a){var c=h.getLogger("ProcessIsoCurveResponseFactory");c.trace(["ProcessIsoCurveResponseFactory::build()"]);var d=null;if(a.response){if(a.rawResponse)c.trace("analyze response : raw"),d=a.response;else{var _;if(c.trace("analyze response : json"),_=typeof a.response=="string"?JSON.parse(a.response):a.response,d=new Qr,!_)return void a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_ANALYSE",a.response)));_.costType==="distance"?(d.time="",d.distance=_.costValue):(d.time=_.costValue,d.distance=""),d.message="",d.id="",d.srs=_.crs,d.geometry=_.geometry;var R=_.point.split(",");if(d.location&&(d.location.x=R[0],d.location.y=R[1]),d.exceptionReport)return void a.onError.call(a.scope,new g({message:u.getMessage("SERVICE_RESPONSE_EXCEPTION",d.exceptionReport),type:g.TYPE_SRVERR,status:200}))}a.onSuccess.call(a.scope,d)}else a.onError.call(a.scope,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))}};function ii(a){if(!(this instanceof ii))throw new TypeError(u.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",S.apply(this,arguments),this.logger=h.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve (options)]"),!a.position)throw new Error(u.getMessage("PARAM_MISSING","position"));if(a.position.x===null)throw new Error(u.getMessage("PARAM_MISSING","position.x"));if(a.position.y===null)throw new Error(u.getMessage("PARAM_MISSING","position.y"));if(!a.time&&!a.distance)throw new Error("Parameter (s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!a.time&&a.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),a.time&&!a.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",this.options.resource=a.resource||"bdtopo-iso",this.options.exclusions=a.exclusions||[],this.options.reverse=a.reverse||!1,this.options.srs=a.srs||"EPSG:4326",this.options.distanceUnit=a.distanceUnit||"m",this.options.timeUnit=a.timeUnit||"second",a.smoothing&&this.logger.warn("options.smoothing is DEPRECATED"),this.options.smoothing=!1,a.holes&&this.logger.warn("options.holes is DEPRECATED"),this.options.holes=!1,a.graph?(a.graph==="Voiture"&&(this.options.graph="car"),a.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],a.constraints){if(!Array.isArray(a.constraints))throw new Error(u.getMessage("PARAM_TYPE","constraints"));for(var c=0;c<a.constraints.length;c++)this.options.constraints.push(a.constraints[c])}var d={},_={},R={};if(a.exclusions&&a.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var I=0;I<a.exclusions.length;I++)typeof a.exclusions[I]=="string"&&(a.exclusions[I]=a.exclusions[I].toLowerCase(),a.exclusions[I]==="toll"&&(R.constraintType="banned",R.key="wayType",R.operator="=",R.value="autoroute",this.options.constraints.push(R)),a.exclusions[I]==="tunnel"&&(d.constraintType="banned",d.key="wayType",d.operator="=",d.value="tunnel",this.options.constraints.push(d)),a.exclusions[I]==="bridge"&&(_.constraintType="banned",_.key="wayType",_.operator="=",_.value="pont",this.options.constraints.push(_)))}if(this.options.outputFormat=typeof a.outputFormat=="string"?a.outputFormat.toLowerCase():"json",a.outputFormat&&a.outputFormat!=="json")throw new Error(u.getMessage("PARAM_NOT_SUPPORT","outputFormat"));if(this.options.outputFormat="json",!this.options.serverUrl){var G=L.ProcessIsoCurve.url(this.options.apiKey);if(!G)throw new Error("Url by default not found !");this.options.serverUrl=G,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}ii.prototype=Object.create(S.prototype,{}),ii.prototype.constructor=ii,ii.prototype.buildRequest=function(a,c){try{var d=new Cl(this.options);if(!d.processRequestString())throw new Error(u.getMessage("SERVICE_REQUEST_BUILD"));this.request=d.requestString}catch(_){return void a.call(this,new g(_.message))}c.call(this,this.request)},ii.prototype.analyzeResponse=function(a,c){if(this.response){var d={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:c,onError:a,scope:this};Tl.build(d)}else a.call(this,new g(u.getMessage("SERVICE_RESPONSE_EMPTY")))};var bl=ii,Il={getConfig:function(a){new te(a).call()},getAltitude:function(a){new H(a).call()},geocode:function(a){new pl(a).call()},reverseGeocode:function(a){new ml(a).call()},autoComplete:function(a){new yl(a).call()},route:function(a){new Rl(a).call()},isoCurve:function(a){new bl(a).call()}},to=X.version,eo=X.date,vt={};vt.servicesVersion=to,vt.servicesDate=eo,vt.Protocols={},vt.Protocols.XHR=C,vt.Services=Il,vt.Services.DefaultUrl=L,vt.Services.AltiResponse=ft,vt.Services.Alti={},vt.Services.Alti.Elevation=Et,vt.Services.AutoCompleteResponse=qr,vt.Services.AutoComplete={},vt.Services.AutoComplete.SuggestedLocation=Zr,vt.Services.GetConfigResponse=ut,vt.Services.Config={},vt.Services.Config.Constraint=bt,vt.Services.Config.Format=Xt,vt.Services.Config.Layer=Ot,vt.Services.Config.Legend=qt,vt.Services.Config.Metadata=w,vt.Services.Config.Originator=D,vt.Services.Config.Service=dt,vt.Services.Config.Style=Pt,vt.Services.Config.Territory=jt,vt.Services.Config.Thematic=he,vt.Services.Config.TileMatrix=re,vt.Services.Config.TileMatrixLimit=Fe,vt.Services.Config.TileMatrixSet=Nt,vt.Services.IsoCurveResponse=Qr,vt.Services.RouteResponse=Hr,vt.Services.Route={},vt.Services.Route.RouteInstruction=Jr,vt.Error=g,vt.Helper=p,r.default=vt}]).default})})(aa);var cr=aa.exports;const Ws=(s,t,e,i=!1)=>{let n=[];return window.$barry.calculateToll||n.push("toll"),new Promise(r=>{cr.Services.route({startPoint:{x:s[0],y:s[1]},endPoint:{x:t[0],y:t[1]},graph:window.$barry.calculateTransport,exclusions:n,routePreference:window.$barry.calculateMode=="time"?"fastest":"shortest",geometryInInstructions:i,apiKey:"calcul",onSuccess:o=>{o.key=e,r(o)},onFailure:o=>{alert(o)}})})},zt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function ct(){throw new Error("Unimplemented abstract method.")}let Yl=0;function St(s){return s.ol_uid||(s.ol_uid=String(++Yl))}function lo(s){return s[0]>0&&s[1]>0}function Wl(s,t,e){return e===void 0&&(e=[0,0]),e[0]=s[0]*t+.5|0,e[1]=s[1]*t+.5|0,e}function ae(s,t){return Array.isArray(s)?s:(t===void 0?t=[s,s]:(t[0]=s,t[1]=s),t)}class cs{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=ae(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new cs({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return ct()}getImage(t){return ct()}getHitDetectionImage(){return ct()}getPixelRatio(t){return 1}getImageState(){return ct()}getImageSize(){return ct()}getOrigin(){return ct()}getSize(){return ct()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ae(t)}listenImageChange(t){ct()}load(){ct()}unlistenImageChange(t){ct()}}function Ut(s,t,e){return Math.min(Math.max(s,t),e)}function zl(s,t,e,i,n,r){const o=n-e,l=r-i;if(o!==0||l!==0){const h=((s-e)*o+(t-i)*l)/(o*o+l*l);h>1?(e=n,i=r):h>0&&(e+=o*h,i+=l*h)}return ui(s,t,e,i)}function ui(s,t,e,i){const n=e-s,r=i-t;return n*n+r*r}function $l(s){const t=s.length;for(let i=0;i<t;i++){let n=i,r=Math.abs(s[i][i]);for(let l=i+1;l<t;l++){const h=Math.abs(s[l][i]);h>r&&(r=h,n=l)}if(r===0)return null;const o=s[n];s[n]=s[i],s[i]=o;for(let l=i+1;l<t;l++){const h=-s[l][i]/s[i][i];for(let u=i;u<t+1;u++)i==u?s[l][u]=0:s[l][u]+=h*s[i][u]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=s[i][t]/s[i][i];for(let n=i-1;n>=0;n--)s[n][t]-=s[n][i]*e[i]}return e}function $n(s){return s*Math.PI/180}function Fi(s,t){const e=s%t;return e*t<0?e+t:e}function Me(s,t,e){return s+e*(t-s)}function la(s,t){const e=Math.pow(10,t);return Math.round(s*e)/e}function Ln(s,t){return Math.floor(la(s,t))}function Dn(s,t){return Math.ceil(la(s,t))}const Vl=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Bl=/^([a-z]*)$|^hsla?\(.*\)$/i;function ha(s){return typeof s=="string"?s:ca(s)}function Kl(s){const t=document.createElement("div");if(t.style.color=s,t.style.color!==""){document.body.appendChild(t);const e=getComputedStyle(t).color;return document.body.removeChild(t),e}else return""}const ql=function(){const t={};let e=0;return function(i){let n;if(t.hasOwnProperty(i))n=t[i];else{if(e>=1024){let r=0;for(const o in t)r++&3||(delete t[o],--e)}n=Zl(i),t[i]=n,++e}return n}}();function Vn(s){return Array.isArray(s)?s:ql(s)}function Zl(s){let t,e,i,n,r;if(Bl.exec(s)&&(s=Kl(s)),Vl.exec(s)){const o=s.length-1;let l;o<=4?l=1:l=2;const h=o===4||o===8;t=parseInt(s.substr(1+0*l,l),16),e=parseInt(s.substr(1+1*l,l),16),i=parseInt(s.substr(1+2*l,l),16),h?n=parseInt(s.substr(1+3*l,l),16):n=255,l==1&&(t=(t<<4)+t,e=(e<<4)+e,i=(i<<4)+i,h&&(n=(n<<4)+n)),r=[t,e,i,n/255]}else s.startsWith("rgba(")?(r=s.slice(5,-1).split(",").map(Number),ho(r)):s.startsWith("rgb(")?(r=s.slice(4,-1).split(",").map(Number),r.push(1),ho(r)):mt(!1,14);return r}function ho(s){return s[0]=Ut(s[0]+.5|0,0,255),s[1]=Ut(s[1]+.5|0,0,255),s[2]=Ut(s[2]+.5|0,0,255),s[3]=Ut(s[3],0,1),s}function ca(s){let t=s[0];t!=(t|0)&&(t=t+.5|0);let e=s[1];e!=(e|0)&&(e=e+.5|0);let i=s[2];i!=(i|0)&&(i=i+.5|0);const n=s[3]===void 0?1:Math.round(s[3]*100)/100;return"rgba("+t+","+e+","+i+","+n+")"}function ve(s){return Array.isArray(s)?ca(s):s}const Je=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",Hl=Je.includes("firefox"),Jl=Je.includes("safari")&&!Je.includes("chrom");Jl&&(Je.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(Je));const Ql=Je.includes("webkit")&&!Je.includes("edge"),th=Je.includes("macintosh"),ua=typeof devicePixelRatio<"u"?devicePixelRatio:1,ur=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,eh=typeof Image<"u"&&Image.prototype.decode,da=function(){let s=!1;try{const t=Object.defineProperty({},"passive",{get:function(){s=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return s}();function le(s,t,e,i){let n;return e&&e.length?n=e.shift():ur?n=new OffscreenCanvas(s||300,t||300):n=document.createElement("canvas"),s&&(n.width=s),t&&(n.height=t),n.getContext("2d",i)}function fa(s){const t=s.canvas;t.width=1,t.height=1,s.clearRect(0,0,1,1)}function co(s,t){const e=t.parentNode;e&&e.replaceChild(s,t)}function zs(s){return s&&s.parentNode?s.parentNode.removeChild(s):null}function ih(s){for(;s.lastChild;)s.removeChild(s.lastChild)}function nh(s,t){const e=s.childNodes;for(let i=0;;++i){const n=e[i],r=t[i];if(!n&&!r)break;if(n!==r){if(!n){s.appendChild(r);continue}if(!r){s.removeChild(n),--i;continue}s.insertBefore(r,n)}}}class Ne{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Ui={PROPERTYCHANGE:"propertychange"};class dr{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function sh(s,t,e){let i,n;e=e||gi;let r=0,o=s.length,l=!1;for(;r<o;)i=r+(o-r>>1),n=+e(s[i],t),n<0?r=i+1:(o=i,l=!n);return l?r:~r}function gi(s,t){return s>t?1:s<t?-1:0}function fr(s,t,e){const i=s.length;if(s[0]<=t)return 0;if(t<=s[i-1])return i-1;{let n;if(e>0){for(n=1;n<i;++n)if(s[n]<t)return n-1}else if(e<0){for(n=1;n<i;++n)if(s[n]<=t)return n}else for(n=1;n<i;++n){if(s[n]==t)return n;if(s[n]<t)return typeof e=="function"?e(t,s[n-1],s[n])>0?n-1:n:s[n-1]-t<t-s[n]?n-1:n}return i-1}}function rh(s,t,e){for(;t<e;){const i=s[t];s[t]=s[e],s[e]=i,++t,--e}}function Le(s,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let n=0;n<i;n++)s[s.length]=e[n]}function Ei(s,t){const e=s.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(s[i]!==t[i])return!1;return!0}function oh(s,t,e){const i=t||gi;return s.every(function(n,r){if(r===0)return!0;const o=i(s[r-1],n);return!(o>0||e&&o===0)})}function Qi(){return!0}function us(){return!1}function pi(){}function ah(s){let t=!1,e,i,n;return function(){const r=Array.prototype.slice.call(arguments);return(!t||this!==n||!Ei(r,i))&&(t=!0,n=this,i=r,e=s.apply(this,arguments)),e}}function gn(s){for(const t in s)delete s[t]}function Xi(s){let t;for(t in s)return!1;return!t}class ds extends dr{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),n=i[t]||(i[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const r=e?new Ne(t):t;r.target||(r.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),l=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,l[i]=0),++o[i];let h;for(let u=0,f=n.length;u<f;++u)if("handleEvent"in n[u]?h=n[u].handleEvent(r):h=n[u].call(this,r),h===!1||r.propagationStopped){h=!1;break}if(--o[i]===0){let u=l[i];for(delete l[i];u--;)this.removeEventListener(i,pi);delete o[i]}return h}disposeInternal(){this.listeners_&&gn(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){const i=this.listeners_&&this.listeners_[t];if(i){const n=i.indexOf(e);n!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[n]=pi,++this.pendingRemovals_[t]):(i.splice(n,1),i.length===0&&delete this.listeners_[t]))}}}const gt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function xt(s,t,e,i,n){if(i&&i!==s&&(e=e.bind(i)),n){const o=e;e=function(){s.removeEventListener(t,e),o.apply(this,arguments)}}const r={target:s,type:t,listener:e};return s.addEventListener(t,e),r}function Bn(s,t,e,i){return xt(s,t,e,i,!0)}function Lt(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),gn(s))}class pn extends ds{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(gt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let r=0;r<i;++r)n[r]=xt(this,t[r],e);return n}else return xt(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const n=t.length;i=new Array(n);for(let r=0;r<n;++r)i[r]=Bn(this,t[r],e)}else i=Bn(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)lh(i);else if(Array.isArray(t))for(let n=0,r=t.length;n<r;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}}pn.prototype.on;pn.prototype.once;pn.prototype.un;function lh(s){if(Array.isArray(s))for(let t=0,e=s.length;t<e;++t)Lt(s[t]);else Lt(s)}class uo extends Ne{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class Te extends pn{constructor(t){super(),this.on,this.once,this.un,St(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new uo(i,t,e)),i=Ui.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new uo(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const n=this.values_||(this.values_={});if(i)n[t]=e;else{const r=n[t];n[t]=e,r!==e&&this.notify(t,r)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Xi(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}const Nn="ol-hidden",fs="ol-unselectable",gr="ol-control",fo="ol-collapsed",hh=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),go=["style","variant","weight","size","lineHeight","family"],ga=function(s){const t=s.match(hh);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,n=go.length;i<n;++i){const r=t[i+1];r!==void 0&&(e[go[i]]=r)}return e.families=e.family.split(/,\s?/),e},pa="10px sans-serif",De="#000",Kn="round",tn=[],en=0,ji="round",nn=10,sn="#000",rn="center",qn="middle",ai=[0,0,0,0],on=1,Oe=new Te;let Oi=null,$s;const Vs={},ch=function(){const t="32px ",e=["monospace","serif"],i=e.length,n="wmytzilWMYTZIL@#/&?$%10";let r,o;function l(u,f,g){let p=!0;for(let m=0;m<i;++m){const E=e[m];if(o=Zn(u+" "+f+" "+t+E,n),g!=E){const x=Zn(u+" "+f+" "+t+g+","+E,n);p=p&&x!=o}}return!!p}function h(){let u=!0;const f=Oe.getKeys();for(let g=0,p=f.length;g<p;++g){const m=f[g];Oe.get(m)<100&&(l.apply(this,m.split(`
`))?(gn(Vs),Oi=null,$s=void 0,Oe.set(m,100)):(Oe.set(m,Oe.get(m)+1,!0),u=!1))}u&&(clearInterval(r),r=void 0)}return function(u){const f=ga(u);if(!f)return;const g=f.families;for(let p=0,m=g.length;p<m;++p){const E=g[p],x=f.style+`
`+f.weight+`
`+E;Oe.get(x)===void 0&&(Oe.set(x,100,!0),l(f.style,f.weight,E)||(Oe.set(x,0,!0),r===void 0&&(r=setInterval(h,32))))}}}(),uh=function(){let s;return function(t){let e=Vs[t];if(e==null){if(ur){const i=ga(t),n=ma(t,"Žg");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else s||(s=document.createElement("div"),s.innerHTML="M",s.style.minHeight="0",s.style.maxHeight="none",s.style.height="auto",s.style.padding="0",s.style.border="none",s.style.position="absolute",s.style.display="block",s.style.left="-99999px"),s.style.font=t,document.body.appendChild(s),e=s.offsetHeight,document.body.removeChild(s);Vs[t]=e}return e}}();function ma(s,t){return Oi||(Oi=le(1,1)),s!=$s&&(Oi.font=s,$s=Oi.font),Oi.measureText(t)}function Zn(s,t){return ma(s,t).width}function po(s,t,e){if(t in e)return e[t];const i=t.split(`
`).reduce((n,r)=>Math.max(n,Zn(s,r)),0);return e[t]=i,i}function dh(s,t){const e=[],i=[],n=[];let r=0,o=0,l=0,h=0;for(let u=0,f=t.length;u<=f;u+=2){const g=t[u];if(g===`
`||u===f){r=Math.max(r,o),n.push(o),o=0,l+=h;continue}const p=t[u+1]||s.font,m=Zn(p,g);e.push(m),o+=m;const E=uh(p);i.push(E),h=Math.max(h,E)}return{width:r,height:l,widths:e,heights:i,lineWidths:n}}function fh(s,t,e,i,n,r,o,l,h,u,f){s.save(),e!==1&&(s.globalAlpha*=e),t&&s.setTransform.apply(s,t),i.contextInstructions?(s.translate(h,u),s.scale(f[0],f[1]),gh(i,s)):f[0]<0||f[1]<0?(s.translate(h,u),s.scale(f[0],f[1]),s.drawImage(i,n,r,o,l,0,0,o,l)):s.drawImage(i,n,r,o,l,h,u,o*f[0],l*f[1]),s.restore()}function gh(s,t){const e=s.contextInstructions;for(let i=0,n=e.length;i<n;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}class gs extends cs{constructor(t){const e=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:1,rotateWithView:e,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius!==void 0?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new gs({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,n=le(i.size*t,i.size*t);this.draw_(i,n,t),e=n.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return zt.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let n=this.radius_,r=this.radius2_===void 0?n:this.radius2_;if(n<r){const X=n;n=r,r=X}const o=this.radius2_===void 0?this.points_:this.points_*2,l=2*Math.PI/o,h=r*Math.sin(l),u=Math.sqrt(r*r-h*h),f=n-u,g=Math.sqrt(h*h+f*f),p=g/h;if(t==="miter"&&p<=i)return p*e;const m=e/2/p,E=e/2*(f/g),v=Math.sqrt((n+m)*(n+m)+E*E)-n;if(this.radius2_===void 0||t==="bevel")return v*2;const C=n*Math.sin(l),b=Math.sqrt(n*n-C*C),P=r-b,L=Math.sqrt(C*C+P*P)/C;if(L<=i){const X=L*e/2-r-n;return 2*Math.max(v,X)}return v*2}createRenderOptions(){let t=ji,e=0,i=null,n=0,r,o=0;this.stroke_&&(r=this.stroke_.getColor(),r===null&&(r=sn),r=ve(r),o=this.stroke_.getWidth(),o===void 0&&(o=on),i=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=ji),e=this.stroke_.getMiterLimit(),e===void 0&&(e=nn));const l=this.calculateLineJoinSize_(t,o,e),h=Math.max(this.radius_,this.radius2_||0),u=Math.ceil(2*h+l);return{strokeStyle:r,strokeWidth:o,size:u,lineDash:i,lineDashOffset:n,lineJoin:t,miterLimit:e}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let n=this.fill_.getColor();n===null&&(n=De),e.fillStyle=ve(n),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if(typeof e=="string"&&(e=Vn(e)),e===null?i=1:Array.isArray(e)&&(i=e.length===4?e[3]:1),i===0){const n=le(t.size,t.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(t,n)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const n=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const r=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let l=0;l<e;l++){const h=r+l*o,u=l%2===0?i:n;t.lineTo(u*Math.cos(h),u*Math.sin(h))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=De,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}class pr extends gs{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new pr({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}const mr=pr;class _r{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null}clone(){const t=this.getColor();return new _r({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}const ps=_r;class ph{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];!(t++&3)&&!i.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,i){const n=mo(t,e,i);return n in this.cache_?this.cache_[n]:null}set(t,e,i,n){const r=mo(t,e,i);this.cache_[r]=n,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function mo(s,t,e){const i=e?ha(e):"null";return t+":"+s+":"+i}const Hn=new ph;function _a(s,t,e){const i=s;let n=!0,r=!1,o=!1;const l=[Bn(i,gt.LOAD,function(){o=!0,r||t()})];return i.src&&eh?(r=!0,i.decode().then(function(){n&&t()}).catch(function(h){n&&(o?t():e())})):l.push(Bn(i,gt.ERROR,e)),function(){n=!1,l.forEach(Lt)}}let $i=null;class mh extends ds{constructor(t,e,i,n,r,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=r,this.size_=i,this.src_=e,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===zt.LOADED){$i||($i=le(1,1)),$i.drawImage(this.image_,0,0);try{$i.getImageData(0,0,1,1),this.tainted_=!1}catch{$i=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(gt.CHANGE)}handleImageError_(){this.imageState_=zt.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=zt.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=le(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===zt.IDLE){this.image_||this.initializeImage_(),this.imageState_=zt.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=_a(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==zt.LOADED)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const n=i.getContext("2d");n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=ha(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function _h(s,t,e,i,n,r){let o=Hn.get(t,i,r);return o||(o=new mh(s,t,e,i,n,r),Hn.set(t,i,r,o)),o}class yr extends cs{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,n=t.scale!==void 0?t.scale:1,r=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:n,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:r,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;this.imgSize_=t.imgSize;let l=t.src;mt(!(l!==void 0&&o),4),mt(!o||o&&this.imgSize_,5),(l===void 0||l.length===0)&&o&&(l=o.src||St(o)),mt(l!==void 0&&l.length>0,6);const h=t.src!==void 0?zt.IDLE:zt.LOADED;this.color_=t.color!==void 0?Vn(t.color):null,this.iconImage_=_h(o,l,this.imgSize_!==void 0?this.imgSize_:null,this.crossOrigin_,h,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null}clone(){const t=this.getScale();return new yr({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=n[0]),this.anchorYUnits_=="fraction"&&(t[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+n[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}listenImageChange(t){this.iconImage_.addEventListener(gt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(gt.CHANGE,t)}}const ya=yr;class mn{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new mn({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class ms{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=_o,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new ms({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=_o,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function yh(s){let t;if(typeof s=="function")t=s;else{let e;Array.isArray(s)?e=s:(mt(typeof s.getZIndex=="function",41),e=[s]),t=function(){return e}}return t}let Ss=null;function wh(s,t){if(!Ss){const e=new ps({color:"rgba(255,255,255,0.4)"}),i=new mn({color:"#3399CC",width:1.25});Ss=[new ms({image:new mr({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return Ss}function _o(s){return s.getGeometry()}const an=ms,Eh="#333";class wr{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=ae(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new ps({color:Eh}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding}clone(){const t=this.getScale();return new wr({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ae(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}const vh=wr;new Array(6);function Re(){return[1,0,0,1,0,0]}function xh(s,t,e,i,n,r,o){return s[0]=t,s[1]=e,s[2]=i,s[3]=n,s[4]=r,s[5]=o,s}function Rh(s,t){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s}function Bt(s,t){const e=t[0],i=t[1];return t[0]=s[0]*e+s[2]*i+s[4],t[1]=s[1]*e+s[3]*i+s[5],t}function Sh(s,t,e){return xh(s,t,0,0,e,0,0)}function Qe(s,t,e,i,n,r,o,l){const h=Math.sin(r),u=Math.cos(r);return s[0]=i*u,s[1]=n*h,s[2]=-i*h,s[3]=n*u,s[4]=o*i*u-l*i*h+t,s[5]=o*n*h+l*n*u+e,s}function Er(s,t){const e=Ch(t);mt(e!==0,32);const i=t[0],n=t[1],r=t[2],o=t[3],l=t[4],h=t[5];return s[0]=o/e,s[1]=-n/e,s[2]=-r/e,s[3]=i/e,s[4]=(r*h-o*l)/e,s[5]=-(i*h-n*l)/e,s}function Ch(s){return s[0]*s[3]-s[1]*s[2]}let yo;function wa(s){const t="matrix("+s.join(", ")+")";if(ur)return t;const e=yo||(yo=document.createElement("div"));return e.style.transform=t,e.style.transform}const mi={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class Ea{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||mi[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const _n=6378137,Ni=Math.PI*_n,Th=[-Ni,-Ni,Ni,Ni],bh=[-180,-85,180,85],Fn=_n*Math.log(Math.tan(Math.PI/2));class Ti extends Ea{constructor(t){super({code:t,units:"m",extent:Th,global:!0,worldExtent:bh,getPointResolution:function(e,i){return e/Math.cosh(i[1]/_n)}})}}const wo=[new Ti("EPSG:3857"),new Ti("EPSG:102100"),new Ti("EPSG:102113"),new Ti("EPSG:900913"),new Ti("http://www.opengis.net/def/crs/EPSG/0/3857"),new Ti("http://www.opengis.net/gml/srs/epsg.xml#3857")];function Ih(s,t,e){const i=s.length;e=e>1?e:2,t===void 0&&(e>2?t=s.slice():t=new Array(i));for(let n=0;n<i;n+=e){t[n]=Ni*s[n]/180;let r=_n*Math.log(Math.tan(Math.PI*(+s[n+1]+90)/360));r>Fn?r=Fn:r<-Fn&&(r=-Fn),t[n+1]=r}return t}function Ah(s,t,e){const i=s.length;e=e>1?e:2,t===void 0&&(e>2?t=s.slice():t=new Array(i));for(let n=0;n<i;n+=e)t[n]=180*s[n]/Ni,t[n+1]=360*Math.atan(Math.exp(s[n+1]/_n))/Math.PI-90;return t}const Oh=6378137,Eo=[-180,-90,180,90],Ph=Math.PI*Oh/180;class ni extends Ea{constructor(t,e){super({code:t,units:"degrees",extent:Eo,axisOrientation:e,global:!0,metersPerUnit:Ph,worldExtent:Eo})}}const vo=[new ni("CRS:84"),new ni("EPSG:4326","neu"),new ni("urn:ogc:def:crs:OGC:1.3:CRS84"),new ni("urn:ogc:def:crs:OGC:2:84"),new ni("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new ni("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ni("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Bs={};function Mh(s){return Bs[s]||Bs[s.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Lh(s,t){Bs[s]=t}let ki={};function Jn(s,t,e){const i=s.getCode(),n=t.getCode();i in ki||(ki[i]={}),ki[i][n]=e}function Dh(s,t){let e;return s in ki&&t in ki[s]&&(e=ki[s][t]),e}function Nh(s,t){return s[0]+=+t[0],s[1]+=+t[1],s}function Qn(s,t){let e=!0;for(let i=s.length-1;i>=0;--i)if(s[i]!=t[i]){e=!1;break}return e}function vr(s,t){const e=Math.cos(t),i=Math.sin(t),n=s[0]*e-s[1]*i,r=s[1]*e+s[0]*i;return s[0]=n,s[1]=r,s}function Fh(s,t){return s[0]*=t,s[1]*=t,s}function va(s,t){if(t.canWrapX()){const e=Mt(t.getExtent()),i=kh(s,t,e);i&&(s[0]-=i*e)}return s}function kh(s,t,e){const i=t.getExtent();let n=0;return t.canWrapX()&&(s[0]<i[0]||s[0]>i[2])&&(e=e||Mt(i),n=Math.floor((s[0]-i[0])/e)),n}const Gh=63710088e-1;function xo(s,t,e){e=e||Gh;const i=$n(s[1]),n=$n(t[1]),r=(n-i)/2,o=$n(t[0]-s[0])/2,l=Math.sin(r)*Math.sin(r)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(n);return 2*e*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))}let Ks=!0;function Uh(s){Ks=!(s===void 0?!0:s)}function xr(s,t,e){if(t!==void 0){for(let i=0,n=s.length;i<n;++i)t[i]=s[i];t=t}else t=s.slice();return t}function xa(s,t,e){if(t!==void 0&&s!==t){for(let i=0,n=s.length;i<n;++i)t[i]=s[i];s=t}return s}function Xh(s){Lh(s.getCode(),s),Jn(s,s,xr)}function jh(s){s.forEach(Xh)}function Gt(s){return typeof s=="string"?Mh(s):s||null}function Ro(s,t,e,i){s=Gt(s);let n;const r=s.getPointResolutionFunc();if(r){if(n=r(t,e),i&&i!==s.getUnits()){const o=s.getMetersPerUnit();o&&(n=n*o/mi[i])}}else{const o=s.getUnits();if(o=="degrees"&&!i||i=="degrees")n=t;else{const l=_s(s,Gt("EPSG:4326"));if(l===xa&&o!=="degrees")n=t*s.getMetersPerUnit();else{let u=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];u=l(u,u,2);const f=xo(u.slice(0,2),u.slice(2,4)),g=xo(u.slice(4,6),u.slice(6,8));n=(f+g)/2}const h=i?mi[i]:s.getMetersPerUnit();h!==void 0&&(n/=h)}}return n}function So(s){jh(s),s.forEach(function(t){s.forEach(function(e){t!==e&&Jn(t,e,xr)})})}function Yh(s,t,e,i){s.forEach(function(n){t.forEach(function(r){Jn(n,r,e),Jn(r,n,i)})})}function Rr(s,t){return s?typeof s=="string"?Gt(s):s:Gt(t)}function oi(s,t){if(s===t)return!0;const e=s.getUnits()===t.getUnits();return(s.getCode()===t.getCode()||_s(s,t)===xr)&&e}function _s(s,t){const e=s.getCode(),i=t.getCode();let n=Dh(e,i);return n||(n=xa),n}function ln(s,t){const e=Gt(s),i=Gt(t);return _s(e,i)}function Sr(s,t,e){return ln(t,e)(s,void 0,s.length)}function Ra(s,t,e,i){const n=ln(t,e);return kl(s,n,void 0,i)}let fe=null;function Wh(s){fe=Gt(s)}function Sa(){return fe}function zh(){Wh("EPSG:4326")}function qs(s,t){return fe?Sr(s,t,fe):s}function Pe(s,t){return fe?Sr(s,fe,t):(Ks&&!Qn(s,[0,0])&&s[0]>=-180&&s[0]<=180&&s[1]>=-90&&s[1]<=90&&(Ks=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),s)}function Zs(s,t){return fe?Ra(s,t,fe):s}function li(s,t){return fe?Ra(s,fe,t):s}function $h(s,t){if(!fe)return s;const e=Gt(t).getUnits(),i=fe.getUnits();return e&&i?s*mi[e]/mi[i]:s}function Vh(){So(wo),So(vo),Yh(vo,wo,Ih,Ah)}Vh();function di(s,t,e,i,n,r){r=r||[];let o=0;for(let l=t;l<e;l+=i){const h=s[l],u=s[l+1];r[o++]=n[0]*h+n[2]*u+n[4],r[o++]=n[1]*h+n[3]*u+n[5]}return r&&r.length!=o&&(r.length=o),r}function Ca(s,t,e,i,n,r,o){o=o||[];const l=Math.cos(n),h=Math.sin(n),u=r[0],f=r[1];let g=0;for(let p=t;p<e;p+=i){const m=s[p]-u,E=s[p+1]-f;o[g++]=u+m*l-E*h,o[g++]=f+m*h+E*l;for(let x=p+2;x<p+i;++x)o[g++]=s[x]}return o&&o.length!=g&&(o.length=g),o}function Bh(s,t,e,i,n,r,o,l){l=l||[];const h=o[0],u=o[1];let f=0;for(let g=t;g<e;g+=i){const p=s[g]-h,m=s[g+1]-u;l[f++]=h+n*p,l[f++]=u+r*m;for(let E=g+2;E<g+i;++E)l[f++]=s[E]}return l&&l.length!=f&&(l.length=f),l}function Kh(s,t,e,i,n,r,o){o=o||[];let l=0;for(let h=t;h<e;h+=i){o[l++]=s[h]+n,o[l++]=s[h+1]+r;for(let u=h+2;u<h+i;++u)o[l++]=s[u]}return o&&o.length!=l&&(o.length=l),o}const Co=Re();class Ta extends Te{constructor(){super(),this.extent_=de(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=ah(function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return ct()}closestPointXY(t,e,i,n){return ct()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return ct()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&fn(e),this.extentRevision_=this.getRevision()}return Nl(this.extent_,t)}rotate(t,e){ct()}scale(t,e,i){ct()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return ct()}getType(){return ct()}applyTransform(t){ct()}intersectsExtent(t){return ct()}translate(t,e){ct()}transform(t,e){const i=Gt(t),n=i.getUnits()=="tile-pixels"?function(r,o,l){const h=i.getExtent(),u=i.getWorldExtent(),f=Ce(u)/Ce(h);return Qe(Co,u[0],u[3],f,-f,0,0,0),di(r,0,r.length,l,Co,o),ln(i,e)(r,o,l)}:ln(i,e);return this.applyTransform(n),this}}class vi extends Ta{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return ia(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return ct()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=To(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){ct()}setLayout(t,e,i){let n;if(t)n=To(t);else{for(let r=0;r<i;++r)if(e.length===0){this.layout="XY",this.stride=2;return}else e=e[0];n=e.length,t=qh(n)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();Ca(i,0,i.length,n,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=fi(this.getExtent()));const n=this.getFlatCoordinates();if(n){const r=this.getStride();Bh(n,0,n.length,r,t,e,i,n),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();Kh(i,0,i.length,n,t,e,i),this.changed()}}}function qh(s){let t;return s==2?t="XY":s==3?t="XYZ":s==4&&(t="XYZM"),t}function To(s){let t;return s=="XY"?t=2:s=="XYZ"||s=="XYM"?t=3:s=="XYZM"&&(t=4),t}function Zh(s,t,e){const i=s.getFlatCoordinates();if(i){const n=s.getStride();return di(i,0,i.length,n,t,e)}else return null}function Hh(s,t,e,i){for(let n=0,r=e.length;n<r;++n)s[t++]=e[n];return t}function ys(s,t,e,i){for(let n=0,r=e.length;n<r;++n){const o=e[n];for(let l=0;l<i;++l)s[t++]=o[l]}return t}function Cr(s,t,e,i,n){n=n||[];let r=0;for(let o=0,l=e.length;o<l;++o){const h=ys(s,t,e[o],i);n[r++]=h,t=h}return n.length=r,n}function Jh(s,t,e,i,n){n=n||[];let r=0;for(let o=0,l=e.length;o<l;++o){const h=Cr(s,t,e[o],i,n[r]);h.length===0&&(h[0]=t),n[r++]=h,t=h[h.length-1]}return n.length=r,n}class ts extends Ta{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Lt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(xt(this.geometries_[t],gt.CHANGE,this.changed,this))}clone(){const t=new ts(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<yi(this.getExtent(),t,e))return n;const r=this.geometries_;for(let o=0,l=r.length;o<l;++o)n=r[o].closestPointXY(t,e,i,n);return n}containsXY(t,e){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)if(i[n].containsXY(t,e))return!0;return!1}computeExtent(t){fn(t);const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)na(t,e[i].getExtent());return t}getGeometries(){return bo(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let n=!1;for(let r=0,o=i.length;r<o;++r){const l=i[r],h=l.getSimplifiedGeometry(t);e.push(h),h!==l&&(n=!0)}if(n){const r=new ts(null);return r.setGeometriesArray(e),r}else return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].rotate(t,e);this.changed()}scale(t,e,i){i||(i=fi(this.getExtent()));const n=this.geometries_;for(let r=0,o=n.length;r<o;++r)n[r].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(bo(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let n=0,r=i.length;n<r;++n)i[n].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function bo(s){const t=[];for(let e=0,i=s.length;e<i;++e)t.push(s[e].clone());return t}const Qh=ts;function Io(s,t,e,i,n,r,o){const l=s[t],h=s[t+1],u=s[e]-l,f=s[e+1]-h;let g;if(u===0&&f===0)g=t;else{const p=((n-l)*u+(r-h)*f)/(u*u+f*f);if(p>1)g=e;else if(p>0){for(let m=0;m<i;++m)o[m]=Me(s[t+m],s[e+m],p);o.length=i;return}else g=t}for(let p=0;p<i;++p)o[p]=s[g+p];o.length=i}function Tr(s,t,e,i,n){let r=s[t],o=s[t+1];for(t+=i;t<e;t+=i){const l=s[t],h=s[t+1],u=ui(r,o,l,h);u>n&&(n=u),r=l,o=h}return n}function br(s,t,e,i,n){for(let r=0,o=e.length;r<o;++r){const l=e[r];n=Tr(s,t,l,i,n),t=l}return n}function tc(s,t,e,i,n){for(let r=0,o=e.length;r<o;++r){const l=e[r];n=br(s,t,l,i,n),t=l[l.length-1]}return n}function Ir(s,t,e,i,n,r,o,l,h,u,f){if(t==e)return u;let g,p;if(n===0)if(p=ui(o,l,s[t],s[t+1]),p<u){for(g=0;g<i;++g)h[g]=s[t+g];return h.length=i,p}else return u;f=f||[NaN,NaN];let m=t+i;for(;m<e;)if(Io(s,m-i,m,i,o,l,f),p=ui(o,l,f[0],f[1]),p<u){for(u=p,g=0;g<i;++g)h[g]=f[g];h.length=i,m+=i}else m+=i*Math.max((Math.sqrt(p)-Math.sqrt(u))/n|0,1);if(r&&(Io(s,e-i,t,i,o,l,f),p=ui(o,l,f[0],f[1]),p<u)){for(u=p,g=0;g<i;++g)h[g]=f[g];h.length=i}return u}function Ar(s,t,e,i,n,r,o,l,h,u,f){f=f||[NaN,NaN];for(let g=0,p=e.length;g<p;++g){const m=e[g];u=Ir(s,t,m,i,n,r,o,l,h,u,f),t=m}return u}function ec(s,t,e,i,n,r,o,l,h,u,f){f=f||[NaN,NaN];for(let g=0,p=e.length;g<p;++g){const m=e[g];u=Ar(s,t,m,i,n,r,o,l,h,u,f),t=m[m.length-1]}return u}function Or(s,t,e,i,n,r,o){const l=(e-t)/i;if(l<3){for(;t<e;t+=i)r[o++]=s[t],r[o++]=s[t+1];return o}const h=new Array(l);h[0]=1,h[l-1]=1;const u=[t,e-i];let f=0;for(;u.length>0;){const g=u.pop(),p=u.pop();let m=0;const E=s[p],x=s[p+1],v=s[g],C=s[g+1];for(let b=p+i;b<g;b+=i){const P=s[b],A=s[b+1],L=zl(P,A,E,x,v,C);L>m&&(f=b,m=L)}m>n&&(h[(f-t)/i]=1,p+i<f&&u.push(p,f),f+i<g&&u.push(f,g))}for(let g=0;g<l;++g)h[g]&&(r[o++]=s[t+g*i],r[o++]=s[t+g*i+1]);return o}function ic(s,t,e,i,n,r,o,l){for(let h=0,u=e.length;h<u;++h){const f=e[h];o=Or(s,t,f,i,n,r,o),l.push(o),t=f}return o}function ri(s,t){return t*Math.round(s/t)}function nc(s,t,e,i,n,r,o){if(t==e)return o;let l=ri(s[t],n),h=ri(s[t+1],n);t+=i,r[o++]=l,r[o++]=h;let u,f;do if(u=ri(s[t],n),f=ri(s[t+1],n),t+=i,t==e)return r[o++]=u,r[o++]=f,o;while(u==l&&f==h);for(;t<e;){const g=ri(s[t],n),p=ri(s[t+1],n);if(t+=i,g==u&&p==f)continue;const m=u-l,E=f-h,x=g-l,v=p-h;if(m*v==E*x&&(m<0&&x<m||m==x||m>0&&x>m)&&(E<0&&v<E||E==v||E>0&&v>E)){u=g,f=p;continue}r[o++]=u,r[o++]=f,l=u,h=f,u=g,f=p}return r[o++]=u,r[o++]=f,o}function ba(s,t,e,i,n,r,o,l){for(let h=0,u=e.length;h<u;++h){const f=e[h];o=nc(s,t,f,i,n,r,o),l.push(o),t=f}return o}function sc(s,t,e,i,n,r,o,l){for(let h=0,u=e.length;h<u;++h){const f=e[h],g=[];o=ba(s,t,f,i,n,r,o,g),l.push(g),t=f[f.length-1]}return o}function qe(s,t,e,i,n){n=n!==void 0?n:[];let r=0;for(let o=t;o<e;o+=i)n[r++]=s.slice(o,o+i);return n.length=r,n}function hn(s,t,e,i,n){n=n!==void 0?n:[];let r=0;for(let o=0,l=e.length;o<l;++o){const h=e[o];n[r++]=qe(s,t,h,i,n[r]),t=h}return n.length=r,n}function Hs(s,t,e,i,n){n=n!==void 0?n:[];let r=0;for(let o=0,l=e.length;o<l;++o){const h=e[o];n[r++]=h.length===1&&h[0]===t?[]:hn(s,t,h,i,n[r]),t=h[h.length-1]}return n.length=r,n}function Ia(s,t,e,i){let n=0,r=s[e-i],o=s[e-i+1];for(;t<e;t+=i){const l=s[t],h=s[t+1];n+=o*l-r*h,r=l,o=h}return n/2}function Aa(s,t,e,i){let n=0;for(let r=0,o=e.length;r<o;++r){const l=e[r];n+=Ia(s,t,l,i),t=l}return n}function rc(s,t,e,i){let n=0;for(let r=0,o=e.length;r<o;++r){const l=e[r];n+=Aa(s,t,l,i),t=l[l.length-1]}return n}class cn extends vi{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new cn(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){return n<yi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Tr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ir(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))}getArea(){return Ia(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return qe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Or(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new cn(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ys(this.flatCoordinates,0,t,this.stride),this.changed()}}function Oa(s,t,e,i,n){let r;for(t+=i;t<e;t+=i)if(r=n(s.slice(t-i,t),s.slice(t,t+i)),r)return r;return!1}function Pa(s,t,e,i,n,r,o){let l,h;const u=(e-t)/i;if(u===1)l=t;else if(u===2)l=t,h=n;else if(u!==0){let f=s[t],g=s[t+1],p=0;const m=[0];for(let v=t+i;v<e;v+=i){const C=s[v],b=s[v+1];p+=Math.sqrt((C-f)*(C-f)+(b-g)*(b-g)),m.push(p),f=C,g=b}const E=n*p,x=sh(m,E);x<0?(h=(E-m[-x-2])/(m[-x-1]-m[-x-2]),l=t+(-x-2)*i):l=t+x*i}o=o>1?o:2,r=r||new Array(o);for(let f=0;f<o;++f)r[f]=l===void 0?NaN:h===void 0?s[l+f]:Me(s[l+f],s[l+i+f],h);return r}function Js(s,t,e,i,n,r){if(e==t)return null;let o;if(n<s[t+i-1])return r?(o=s.slice(t,t+i),o[i-1]=n,o):null;if(s[e-1]<n)return r?(o=s.slice(e-i,e),o[i-1]=n,o):null;if(n==s[t+i-1])return s.slice(t,t+i);let l=t/i,h=e/i;for(;l<h;){const p=l+h>>1;n<s[(p+1)*i-1]?h=p:l=p+1}const u=s[l*i-1];if(n==u)return s.slice((l-1)*i,(l-1)*i+i);const f=s[(l+1)*i-1],g=(n-u)/(f-u);o=[];for(let p=0;p<i-1;++p)o.push(Me(s[(l-1)*i+p],s[l*i+p],g));return o.push(n),o}function oc(s,t,e,i,n,r,o){if(o)return Js(s,t,e[e.length-1],i,n,r);let l;if(n<s[i-1])return r?(l=s.slice(0,i),l[i-1]=n,l):null;if(s[s.length-1]<n)return r?(l=s.slice(s.length-i),l[i-1]=n,l):null;for(let h=0,u=e.length;h<u;++h){const f=e[h];if(t!=f){if(n<s[t+i-1])return null;if(n<=s[f-1])return Js(s,t,f,i,n,!1);t=f}}return null}function ac(s,t,e,i,n){return!ra(n,function(o){return!hi(s,t,e,i,o[0],o[1])})}function hi(s,t,e,i,n,r){let o=0,l=s[e-i],h=s[e-i+1];for(;t<e;t+=i){const u=s[t],f=s[t+1];h<=r?f>r&&(u-l)*(r-h)-(n-l)*(f-h)>0&&o++:f<=r&&(u-l)*(r-h)-(n-l)*(f-h)<0&&o--,l=u,h=f}return o!==0}function Pr(s,t,e,i,n,r){if(e.length===0||!hi(s,t,e[0],i,n,r))return!1;for(let o=1,l=e.length;o<l;++o)if(hi(s,e[o-1],e[o],i,n,r))return!1;return!0}function lc(s,t,e,i,n,r){if(e.length===0)return!1;for(let o=0,l=e.length;o<l;++o){const h=e[o];if(Pr(s,t,h,i,n,r))return!0;t=h[h.length-1]}return!1}function ws(s,t,e,i,n){const r=sa(de(),s,t,e,i);return ne(n,r)?Di(n,r)||r[0]>=n[0]&&r[2]<=n[2]||r[1]>=n[1]&&r[3]<=n[3]?!0:Oa(s,t,e,i,function(o,l){return Fl(n,o,l)}):!1}function hc(s,t,e,i,n){for(let r=0,o=e.length;r<o;++r){if(ws(s,t,e[r],i,n))return!0;t=e[r]}return!1}function Ma(s,t,e,i,n){return!!(ws(s,t,e,i,n)||hi(s,t,e,i,n[0],n[1])||hi(s,t,e,i,n[0],n[3])||hi(s,t,e,i,n[2],n[1])||hi(s,t,e,i,n[2],n[3]))}function La(s,t,e,i,n){if(!Ma(s,t,e[0],i,n))return!1;if(e.length===1)return!0;for(let r=1,o=e.length;r<o;++r)if(ac(s,e[r-1],e[r],i,n)&&!ws(s,e[r-1],e[r],i,n))return!1;return!0}function cc(s,t,e,i,n){for(let r=0,o=e.length;r<o;++r){const l=e[r];if(La(s,t,l,i,n))return!0;t=l[l.length-1]}return!1}function Da(s,t,e,i){let n=s[t],r=s[t+1],o=0;for(let l=t+i;l<e;l+=i){const h=s[l],u=s[l+1];o+=Math.sqrt((h-n)*(h-n)+(u-r)*(u-r)),n=h,r=u}return o}class es extends vi{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){this.flatCoordinates?Le(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new es(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<yi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Tr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ir(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))}forEachSegment(t){return Oa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Js(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return qe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return Pa(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return Da(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Or(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new es(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return ws(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ys(this.flatCoordinates,0,t,this.stride),this.changed()}}const Qs=es;class is extends vi{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{let n=this.getLayout();const r=t,o=[],l=[];for(let h=0,u=r.length;h<u;++h){const f=r[h];h===0&&(n=f.getLayout()),Le(o,f.getFlatCoordinates()),l.push(o.length)}this.setFlatCoordinates(n,o),this.ends_=l}}appendLineString(t){this.flatCoordinates?Le(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new is(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<yi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(br(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ar(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,oc(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return hn(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Qs(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[];let r=0;for(let o=0,l=e.length;o<l;++o){const h=e[o],u=new Qs(t.slice(r,h),i);n.push(u),r=h}return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const n=this.ends_,r=this.stride;for(let o=0,l=n.length;o<l;++o){const h=n[o],u=Pa(e,i,h,r,.5);Le(t,u),i=h}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=ic(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new is(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return hc(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Cr(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}const uc=is;class _i extends vi{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new _i(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const r=this.flatCoordinates,o=ui(t,e,r[0],r[1]);if(o<n){const l=this.stride;for(let h=0;h<l;++h)i[h]=r[h];return i.length=l,o}else return n}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return Ml(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return lr(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=Hh(this.flatCoordinates,0,t,this.stride),this.changed()}}class Mr extends vi{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?Le(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new Mr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<yi(this.getExtent(),t,e))return n;const r=this.flatCoordinates,o=this.stride;for(let l=0,h=r.length;l<h;l+=o){const u=ui(t,e,r[l],r[l+1]);if(u<n){n=u;for(let f=0;f<o;++f)i[f]=r[l+f];i.length=o}}return n}getCoordinates(){return qe(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new _i(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,n=[];for(let r=0,o=t.length;r<o;r+=i){const l=new _i(t.slice(r,r+i),e);n.push(l)}return n}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let n=0,r=e.length;n<r;n+=i){const o=e[n],l=e[n+1];if(lr(t,o,l))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ys(this.flatCoordinates,0,t,this.stride),this.changed()}}const Na=Mr;function Fa(s,t,e,i,n,r,o){let l,h,u,f,g,p,m;const E=n[r+1],x=[];for(let b=0,P=e.length;b<P;++b){const A=e[b];for(f=s[A-i],p=s[A-i+1],l=t;l<A;l+=i)g=s[l],m=s[l+1],(E<=p&&m<=E||p<=E&&E<=m)&&(u=(E-p)/(m-p)*(g-f)+f,x.push(u)),f=g,p=m}let v=NaN,C=-1/0;for(x.sort(gi),f=x[0],l=1,h=x.length;l<h;++l){g=x[l];const b=Math.abs(g-f);b>C&&(u=(f+g)/2,Pr(s,t,e,i,u,E)&&(v=u,C=b)),f=g}return isNaN(v)&&(v=n[r]),o?(o.push(v,E,C),o):[v,E,C]}function dc(s,t,e,i,n){let r=[];for(let o=0,l=e.length;o<l;++o){const h=e[o];r=Fa(s,t,h,i,n,2*o,r),t=h[h.length-1]}return r}function fc(s,t,e,i){for(;t<e-i;){for(let n=0;n<i;++n){const r=s[t+n];s[t+n]=s[e-i+n],s[e-i+n]=r}t+=i,e-=i}}function ka(s,t,e,i){let n=0,r=s[e-i],o=s[e-i+1];for(;t<e;t+=i){const l=s[t],h=s[t+1];n+=(l-r)*(h+o),r=l,o=h}return n===0?void 0:n>0}function Ga(s,t,e,i,n){n=n!==void 0?n:!1;for(let r=0,o=e.length;r<o;++r){const l=e[r],h=ka(s,t,l,i);if(r===0){if(n&&h||!n&&!h)return!1}else if(n&&!h||!n&&h)return!1;t=l}return!0}function gc(s,t,e,i,n){for(let r=0,o=e.length;r<o;++r){const l=e[r];if(!Ga(s,t,l,i,n))return!1;l.length&&(t=l[l.length-1])}return!0}function tr(s,t,e,i,n){n=n!==void 0?n:!1;for(let r=0,o=e.length;r<o;++r){const l=e[r],h=ka(s,t,l,i);(r===0?n&&h||!n&&!h:n&&!h||!n&&h)&&fc(s,t,l,i),t=l}return t}function Ao(s,t,e,i,n){for(let r=0,o=e.length;r<o;++r)t=tr(s,t,e[r],i,n);return t}class ti extends vi{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Le(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new ti(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<yi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(br(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Ar(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return Pr(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return Aa(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),tr(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,hn(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=fi(this.getExtent());this.flatInteriorPoint_=Fa(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new _i(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new cn(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[];let r=0;for(let o=0,l=i.length;o<l;++o){const h=i[o],u=new cn(e.slice(r,h),t);n.push(u),r=h}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Ga(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=tr(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=ba(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new ti(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return La(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=Cr(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function Oo(s){const t=s[0],e=s[1],i=s[2],n=s[3],r=[t,e,t,n,i,n,i,e,t,e];return new ti(r,"XY",[r.length])}function pc(s,t,e,i){const n=[];let r=de();for(let o=0,l=e.length;o<l;++o){const h=e[o];r=ia(s,t,h[0],i),n.push((r[0]+r[2])/2,(r[1]+r[3])/2),t=h[h.length-1]}return n}class ns extends vi{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){let n=this.getLayout();const r=t,o=[],l=[];for(let h=0,u=r.length;h<u;++h){const f=r[h];h===0&&(n=f.getLayout());const g=o.length,p=f.getEnds();for(let m=0,E=p.length;m<E;++m)p[m]+=g;Le(o,f.getFlatCoordinates()),l.push(p)}e=n,t=o,i=l}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;Le(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let n=0,r=e.length;n<r;++n)e[n]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=this.endss_[n].slice();const i=new ns(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,n){return n<yi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(tc(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),ec(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return lc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return rc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Ao(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Hs(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=pc(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=dc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Na(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;gc(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Ao(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=sc(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new ns(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const r=this.endss_[t-1];e=r[r.length-1]}const i=this.endss_[t].slice(),n=i[i.length-1];if(e!==0)for(let r=0,o=i.length;r<o;++r)i[r]-=e;return new ti(this.flatCoordinates.slice(e,n),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[];let r=0;for(let o=0,l=i.length;o<l;++o){const h=i[o].slice(),u=h[h.length-1];if(r!==0)for(let g=0,p=h.length;g<p;++g)h[g]-=r;const f=new ti(e.slice(r,u),t,h);n.push(f),r=u}return n}getType(){return"MultiPolygon"}intersectsExtent(t){return cc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=Jh(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const n=i[i.length-1];this.flatCoordinates.length=n.length===0?0:n[n.length-1]}this.changed()}}const mc=ns,se={ADD:"add",REMOVE:"remove"},Po={LENGTH:"length"};class kn extends Ne{constructor(t,e,i){super(t),this.element=e,this.index=i}}class xe extends Te{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(Po.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new kn(se.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new kn(se.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t>=i){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new kn(se.REMOVE,n,t)),this.dispatchEvent(new kn(se.ADD,e,t))}updateLength_(){this.set(Po.LENGTH,this.array_.length)}assertUnique_(t,e){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===t&&i!==e)throw new ta(58)}}const He={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class yn extends Te{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new yn(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Lt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=xt(t,gt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?_c(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function _c(s){if(typeof s=="function")return s;{let t;return Array.isArray(s)?t=s:(mt(typeof s.getZIndex=="function",41),t=[s]),function(){return t}}}const Ct={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class Ua extends Te{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Ct.OPACITY]=t.opacity!==void 0?t.opacity:1,mt(typeof e[Ct.OPACITY]=="number",64),e[Ct.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Ct.Z_INDEX]=t.zIndex,e[Ct.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Ct.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Ct.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Ct.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=Ut(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return ct()}getLayerStatesArray(t){return ct()}getExtent(){return this.get(Ct.EXTENT)}getMaxResolution(){return this.get(Ct.MAX_RESOLUTION)}getMinResolution(){return this.get(Ct.MIN_RESOLUTION)}getMinZoom(){return this.get(Ct.MIN_ZOOM)}getMaxZoom(){return this.get(Ct.MAX_ZOOM)}getOpacity(){return this.get(Ct.OPACITY)}getSourceState(){return ct()}getVisible(){return this.get(Ct.VISIBLE)}getZIndex(){return this.get(Ct.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Ct.EXTENT,t)}setMaxResolution(t){this.set(Ct.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Ct.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Ct.MAX_ZOOM,t)}setMinZoom(t){this.set(Ct.MIN_ZOOM,t)}setOpacity(t){mt(typeof t=="number",64),this.set(Ct.OPACITY,t)}setVisible(t){this.set(Ct.VISIBLE,t)}setZIndex(t){this.set(Ct.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class Es extends Ua{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Ct.SOURCE,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Ct.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&(Lt(this.sourceChangeKey_),this.sourceChangeKey_=null);const t=this.getSource();t&&(this.sourceChangeKey_=xt(t,gt.CHANGE,this.handleSourceChange_,this)),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(e=>e([]))}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}render(t,e){const i=this.getRenderer();if(i.prepareFrame(t))return this.rendered=!0,i.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(Ct.MAP,t)}getMapInternal(){return this.get(Ct.MAP)}setMap(t){this.mapPrecomposeKey_&&(Lt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(Lt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=xt(t,He.PRECOMPOSE,function(e){const n=e.frameState.layerStatesArray,r=this.getLayerState(!1);mt(!n.some(function(o){return o.layer===r.layer}),67),n.push(r)},this),this.mapRenderKey_=xt(this,gt.CHANGE,t.render,t),this.changed())}setSource(t){this.set(Ct.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Lr(s,t){if(!s.visible)return!1;const e=t.resolution;if(e<s.minResolution||e>=s.maxResolution)return!1;const i=t.zoom;return i>s.minZoom&&i<=s.maxZoom}function yc(s,t,e,i,n){Xa(s,t,e||0,i||s.length-1,n||wc)}function Xa(s,t,e,i,n){for(;i>e;){if(i-e>600){var r=i-e+1,o=t-e+1,l=Math.log(r),h=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*h*(r-h)/r)*(o-r/2<0?-1:1),f=Math.max(e,Math.floor(t-o*h/r+u)),g=Math.min(i,Math.floor(t+(r-o)*h/r+u));Xa(s,t,f,g,n)}var p=s[t],m=e,E=i;for(Vi(s,e,t),n(s[i],p)>0&&Vi(s,e,i);m<E;){for(Vi(s,m,E),m++,E--;n(s[m],p)<0;)m++;for(;n(s[E],p)>0;)E--}n(s[e],p)===0?Vi(s,e,E):(E++,Vi(s,E,i)),E<=t&&(e=E+1),t<=E&&(i=E-1)}}function Vi(s,t,e){var i=s[t];s[t]=s[e],s[e]=i}function wc(s,t){return s<t?-1:s>t?1:0}let ja=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!Un(t,e))return i;const n=this.toBBox,r=[];for(;e;){for(let o=0;o<e.children.length;o++){const l=e.children[o],h=e.leaf?n(l):l;Un(t,h)&&(e.leaf?i.push(l):Ts(t,h)?this._all(l,i):r.push(l))}e=r.pop()}return i}collides(t){let e=this.data;if(!Un(t,e))return!1;const i=[];for(;e;){for(let n=0;n<e.children.length;n++){const r=e.children[n],o=e.leaf?this.toBBox(r):r;if(Un(t,o)){if(e.leaf||Ts(t,o))return!0;i.push(r)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Pi([]),this}remove(t,e){if(!t)return this;let i=this.data;const n=this.toBBox(t),r=[],o=[];let l,h,u;for(;i||r.length;){if(i||(i=r.pop(),h=r[r.length-1],l=o.pop(),u=!0),i.leaf){const f=Ec(t,i.children,e);if(f!==-1)return i.children.splice(f,1),r.push(i),this._condense(r),this}!u&&!i.leaf&&Ts(i,n)?(r.push(i),o.push(l),l=0,h=i,i=i.children[0]):h?(l++,i=h.children[l],u=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,n){const r=i-e+1;let o=this._maxEntries,l;if(r<=o)return l=Pi(t.slice(e,i+1)),bi(l,this.toBBox),l;n||(n=Math.ceil(Math.log(r)/Math.log(o)),o=Math.ceil(r/Math.pow(o,n-1))),l=Pi([]),l.leaf=!1,l.height=n;const h=Math.ceil(r/o),u=h*Math.ceil(Math.sqrt(o));Mo(t,e,i,u,this.compareMinX);for(let f=e;f<=i;f+=u){const g=Math.min(f+u-1,i);Mo(t,f,g,h,this.compareMinY);for(let p=f;p<=g;p+=h){const m=Math.min(p+h-1,g);l.children.push(this._build(t,p,m,n-1))}}return bi(l,this.toBBox),l}_chooseSubtree(t,e,i,n){for(;n.push(e),!(e.leaf||n.length-1===i);){let r=1/0,o=1/0,l;for(let h=0;h<e.children.length;h++){const u=e.children[h],f=Cs(u),g=Rc(t,u)-f;g<o?(o=g,r=f<r?f:r,l=u):g===o&&f<r&&(r=f,l=u)}e=l||e.children[0]}return e}_insert(t,e,i){const n=i?t:this.toBBox(t),r=[],o=this._chooseSubtree(n,this.data,e,r);for(o.children.push(t),Ki(o,n);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(n,r,e)}_split(t,e){const i=t[e],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const o=this._chooseSplitIndex(i,r,n),l=Pi(i.children.splice(o,i.children.length-o));l.height=i.height,l.leaf=i.leaf,bi(i,this.toBBox),bi(l,this.toBBox),e?t[e-1].children.push(l):this._splitRoot(i,l)}_splitRoot(t,e){this.data=Pi([t,e]),this.data.height=t.height+1,this.data.leaf=!1,bi(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let n,r=1/0,o=1/0;for(let l=e;l<=i-e;l++){const h=Bi(t,0,l,this.toBBox),u=Bi(t,l,i,this.toBBox),f=Sc(h,u),g=Cs(h)+Cs(u);f<r?(r=f,n=l,o=g<o?g:o):f===r&&g<o&&(o=g,n=l)}return n||i-e}_chooseSplitAxis(t,e,i){const n=t.leaf?this.compareMinX:vc,r=t.leaf?this.compareMinY:xc,o=this._allDistMargin(t,e,i,n),l=this._allDistMargin(t,e,i,r);o<l&&t.children.sort(n)}_allDistMargin(t,e,i,n){t.children.sort(n);const r=this.toBBox,o=Bi(t,0,e,r),l=Bi(t,i-e,i,r);let h=Gn(o)+Gn(l);for(let u=e;u<i-e;u++){const f=t.children[u];Ki(o,t.leaf?r(f):f),h+=Gn(o)}for(let u=i-e-1;u>=e;u--){const f=t.children[u];Ki(l,t.leaf?r(f):f),h+=Gn(l)}return h}_adjustParentBBoxes(t,e,i){for(let n=i;n>=0;n--)Ki(e[n],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():bi(t[e],this.toBBox)}};function Ec(s,t,e){if(!e)return t.indexOf(s);for(let i=0;i<t.length;i++)if(e(s,t[i]))return i;return-1}function bi(s,t){Bi(s,0,s.children.length,t,s)}function Bi(s,t,e,i,n){n||(n=Pi(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=t;r<e;r++){const o=s.children[r];Ki(n,s.leaf?i(o):o)}return n}function Ki(s,t){return s.minX=Math.min(s.minX,t.minX),s.minY=Math.min(s.minY,t.minY),s.maxX=Math.max(s.maxX,t.maxX),s.maxY=Math.max(s.maxY,t.maxY),s}function vc(s,t){return s.minX-t.minX}function xc(s,t){return s.minY-t.minY}function Cs(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function Gn(s){return s.maxX-s.minX+(s.maxY-s.minY)}function Rc(s,t){return(Math.max(t.maxX,s.maxX)-Math.min(t.minX,s.minX))*(Math.max(t.maxY,s.maxY)-Math.min(t.minY,s.minY))}function Sc(s,t){const e=Math.max(s.minX,t.minX),i=Math.max(s.minY,t.minY),n=Math.min(s.maxX,t.maxX),r=Math.min(s.maxY,t.maxY);return Math.max(0,n-e)*Math.max(0,r-i)}function Ts(s,t){return s.minX<=t.minX&&s.minY<=t.minY&&t.maxX<=s.maxX&&t.maxY<=s.maxY}function Un(s,t){return t.minX<=s.maxX&&t.minY<=s.maxY&&t.maxX>=s.minX&&t.maxY>=s.minY}function Pi(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Mo(s,t,e,i,n){const r=[t,e];for(;r.length;){if(e=r.pop(),t=r.pop(),e-t<=i)continue;const o=t+Math.ceil((e-t)/i/2)*i;yc(s,o,t,e,n),r.push(t,o,o,e)}}function Lo(s){return new an({fill:un(s,""),stroke:dn(s,""),text:Cc(s),image:Tc(s)})}function un(s,t){const e=s[t+"fill-color"];if(e)return new ps({color:e})}function dn(s,t){const e=s[t+"stroke-width"],i=s[t+"stroke-color"];if(!(!e&&!i))return new mn({width:e,color:i,lineCap:s[t+"stroke-line-cap"],lineJoin:s[t+"stroke-line-join"],lineDash:s[t+"stroke-line-dash"],lineDashOffset:s[t+"stroke-line-dash-offset"],miterLimit:s[t+"stroke-miter-limit"]})}function Cc(s){const t=s["text-value"];return t?new vh({text:t,font:s["text-font"],maxAngle:s["text-max-angle"],offsetX:s["text-offset-x"],offsetY:s["text-offset-y"],overflow:s["text-overflow"],placement:s["text-placement"],scale:s["text-scale"],rotateWithView:s["text-rotate-with-view"],rotation:s["text-rotation"],textAlign:s["text-align"],justify:s["text-justify"],textBaseline:s["text-baseline"],padding:s["text-padding"],fill:un(s,"text-"),backgroundFill:un(s,"text-background-"),stroke:dn(s,"text-"),backgroundStroke:dn(s,"text-background-")}):void 0}function Tc(s){const t=s["icon-src"],e=s["icon-img"];if(t||e)return new ya({src:t,img:e,imgSize:s["icon-img-size"],anchor:s["icon-anchor"],anchorOrigin:s["icon-anchor-origin"],anchorXUnits:s["icon-anchor-x-units"],anchorYUnits:s["icon-anchor-y-units"],color:s["icon-color"],crossOrigin:s["icon-cross-origin"],offset:s["icon-offset"],displacement:s["icon-displacement"],opacity:s["icon-opacity"],scale:s["icon-scale"],rotation:s["icon-rotation"],rotateWithView:s["icon-rotate-with-view"],size:s["icon-size"],declutterMode:s["icon-declutter-mode"]});const i=s["shape-points"];if(i){const r="shape-";return new gs({points:i,fill:un(s,r),stroke:dn(s,r),radius:s["shape-radius"],radius1:s["shape-radius1"],radius2:s["shape-radius2"],angle:s["shape-angle"],displacement:s["shape-displacement"],rotation:s["shape-rotation"],rotateWithView:s["shape-rotate-with-view"],scale:s["shape-scale"],declutterMode:s["shape-declutter-mode"]})}const n=s["circle-radius"];if(n){const r="circle-";return new mr({radius:n,fill:un(s,r),stroke:dn(s,r),displacement:s["circle-displacement"],scale:s["circle-scale"],rotation:s["circle-rotation"],rotateWithView:s["circle-rotate-with-view"],declutterMode:s["circle-declutter-mode"]})}}const Do={RENDER_ORDER:"renderOrder"};class bc extends Es{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter!==void 0?t.declutter:!1,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(Do.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new ja(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(Do.RENDER_ORDER,t)}setStyle(t){let e;if(t===void 0)e=wh;else if(t===null)e=null;else if(typeof t=="function")e=t;else if(t instanceof an)e=t;else if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let r=0;r<i;++r){const o=t[r];o instanceof an?n[r]=o:n[r]=Lo(o)}e=n}else e=Lo(t);this.style_=e,this.styleFunction_=t===null?void 0:yh(this.style_),this.changed()}}const rt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Xn=[rt.FILL],Ze=[rt.STROKE],ci=[rt.BEGIN_PATH],No=[rt.CLOSE_PATH];class Ya{drawCustom(t,e,i,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class wn extends Ya{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,r=this.coordinates;let o=r.length;for(let l=0,h=t.length;l<h;l+=e)n[0]=t[l],n[1]=t[l+1],rs(i,n)&&(r[o++]=n[0],r[o++]=n[1]);return o}appendFlatLineCoordinates(t,e,i,n,r,o){const l=this.coordinates;let h=l.length;const u=this.getBufferedMaxExtent();o&&(e+=n);let f=t[e],g=t[e+1];const p=this.tmpCoordinate_;let m=!0,E,x,v;for(E=e+n;E<i;E+=n)p[0]=t[E],p[1]=t[E+1],v=Gs(u,p),v!==x?(m&&(l[h++]=f,l[h++]=g,m=!1),l[h++]=p[0],l[h++]=p[1]):v===Vt.INTERSECTING?(l[h++]=p[0],l[h++]=p[1],m=!1):m=!0,f=p[0],g=p[1],x=v;return(r&&m||E===e+n)&&(l[h++]=f,l[h++]=g),h}drawCustomCoordinates_(t,e,i,n,r){for(let o=0,l=i.length;o<l;++o){const h=i[o],u=this.appendFlatLineCoordinates(t,e,h,n,!1,!1);r.push(u),e=h}return e}drawCustom(t,e,i,n){this.beginGeometry(t,e);const r=t.getType(),o=t.getStride(),l=this.coordinates.length;let h,u,f,g,p;switch(r){case"MultiPolygon":h=t.getOrientedFlatCoordinates(),g=[];const m=t.getEndss();p=0;for(let E=0,x=m.length;E<x;++E){const v=[];p=this.drawCustomCoordinates_(h,p,m[E],o,v),g.push(v)}this.instructions.push([rt.CUSTOM,l,g,t,i,Hs]),this.hitDetectionInstructions.push([rt.CUSTOM,l,g,t,n||i,Hs]);break;case"Polygon":case"MultiLineString":f=[],h=r=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),p=this.drawCustomCoordinates_(h,0,t.getEnds(),o,f),this.instructions.push([rt.CUSTOM,l,f,t,i,hn]),this.hitDetectionInstructions.push([rt.CUSTOM,l,f,t,n||i,hn]);break;case"LineString":case"Circle":h=t.getFlatCoordinates(),u=this.appendFlatLineCoordinates(h,0,h.length,o,!1,!1),this.instructions.push([rt.CUSTOM,l,u,t,i,qe]),this.hitDetectionInstructions.push([rt.CUSTOM,l,u,t,n||i,qe]);break;case"MultiPoint":h=t.getFlatCoordinates(),u=this.appendFlatPointCoordinates(h,o),u>l&&(this.instructions.push([rt.CUSTOM,l,u,t,i,qe]),this.hitDetectionInstructions.push([rt.CUSTOM,l,u,t,n||i,qe]));break;case"Point":h=t.getFlatCoordinates(),this.coordinates.push(h[0],h[1]),u=this.coordinates.length,this.instructions.push([rt.CUSTOM,l,u,t,i]),this.hitDetectionInstructions.push([rt.CUSTOM,l,u,t,n||i]);break}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[rt.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[rt.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let n,r,o=-1;for(e=0;e<i;++e)n=t[e],r=n[0],r==rt.END_GEOMETRY?o=e:r==rt.BEGIN_GEOMETRY&&(n[2]=e,rh(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const n=t.getColor();i.fillStyle=ve(n||De)}else i.fillStyle=void 0;if(e){const n=e.getColor();i.strokeStyle=ve(n||sn);const r=e.getLineCap();i.lineCap=r!==void 0?r:Kn;const o=e.getLineDash();i.lineDash=o?o.slice():tn;const l=e.getLineDashOffset();i.lineDashOffset=l||en;const h=e.getLineJoin();i.lineJoin=h!==void 0?h:ji;const u=e.getWidth();i.lineWidth=u!==void 0?u:on;const f=e.getMiterLimit();i.miterLimit=f!==void 0?f:nn,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[rt.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[rt.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,r=t.lineDash,o=t.lineDashOffset,l=t.lineJoin,h=t.lineWidth,u=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||r!=t.currentLineDash&&!Ei(t.currentLineDash,r)||t.currentLineDashOffset!=o||t.currentLineJoin!=l||t.currentLineWidth!=h||t.currentMiterLimit!=u)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=r,t.currentLineDashOffset=o,t.currentLineJoin=l,t.currentLineWidth=h,t.currentMiterLimit=u)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[rt.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=ea(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;ar(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Ic extends wn{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([rt.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),r=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([rt.DRAW_IMAGE,r,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([rt.DRAW_IMAGE,r,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),r=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=r[0],this.originY_=r[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}const Ac=Ic;class Oc extends wn{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const r=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),l=[rt.MOVE_TO_LINE_TO,r,o];return this.instructions.push(l),this.hitDetectionInstructions.push(l),i}drawLineString(t,e){const i=this.state,n=i.strokeStyle,r=i.lineWidth;if(n===void 0||r===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,tn,en],ci);const o=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(o,0,o.length,l),this.hitDetectionInstructions.push(Ze),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state,n=i.strokeStyle,r=i.lineWidth;if(n===void 0||r===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],ci);const o=t.getEnds(),l=t.getFlatCoordinates(),h=t.getStride();let u=0;for(let f=0,g=o.length;f<g;++f)u=this.drawFlatCoordinates_(l,u,o[f],h);this.hitDetectionInstructions.push(Ze),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(Ze),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(Ze),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(ci)}}const Pc=Oc;class Mc extends wn{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const r=this.state,o=r.fillStyle!==void 0,l=r.strokeStyle!==void 0,h=i.length;this.instructions.push(ci),this.hitDetectionInstructions.push(ci);for(let u=0;u<h;++u){const f=i[u],g=this.coordinates.length,p=this.appendFlatLineCoordinates(t,e,f,n,!0,!l),m=[rt.MOVE_TO_LINE_TO,g,p];this.instructions.push(m),this.hitDetectionInstructions.push(m),l&&(this.instructions.push(No),this.hitDetectionInstructions.push(No)),e=f}return o&&(this.instructions.push(Xn),this.hitDetectionInstructions.push(Xn)),l&&(this.instructions.push(Ze),this.hitDetectionInstructions.push(Ze)),e}drawCircle(t,e){const i=this.state,n=i.fillStyle,r=i.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,De]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getFlatCoordinates(),l=t.getStride(),h=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,l,!1,!1);const u=[rt.CIRCLE,h];this.instructions.push(ci,u),this.hitDetectionInstructions.push(ci,u),i.fillStyle!==void 0&&(this.instructions.push(Xn),this.hitDetectionInstructions.push(Xn)),i.strokeStyle!==void 0&&(this.instructions.push(Ze),this.hitDetectionInstructions.push(Ze)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state,n=i.fillStyle,r=i.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,De]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getEnds(),l=t.getOrientedFlatCoordinates(),h=t.getStride();this.drawFlatCoordinatess_(l,0,o,h),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state,n=i.fillStyle,r=i.strokeStyle;if(n===void 0&&r===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_FILL_STYLE,De]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([rt.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getEndss(),l=t.getOrientedFlatCoordinates(),h=t.getStride();let u=0;for(let f=0,g=o.length;f<g;++f)u=this.drawFlatCoordinatess_(l,u,o[f],h);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=ri(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}const Fo=Mc;function Lc(s,t,e,i,n){let r=e,o=e,l=0,h=0,u=e,f,g,p,m,E,x,v,C,b,P;for(g=e;g<i;g+=n){const A=t[g],L=t[g+1];E!==void 0&&(b=A-E,P=L-x,m=Math.sqrt(b*b+P*P),v!==void 0&&(h+=p,f=Math.acos((v*b+C*P)/(p*m)),f>s&&(h>l&&(l=h,r=u,o=g),h=0,u=g-n)),p=m,v=b,C=P),E=A,x=L}return h+=m,h>l?[u,g]:[r,o]}const Hi={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class Dc extends wn{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const i=this.textFillState_,n=this.textStrokeState_,r=this.textState_;if(this.text_===""||!r||!i&&!n)return;const o=this.coordinates;let l=o.length;const h=t.getType();let u=null,f=t.getStride();if(r.placement==="line"&&(h=="LineString"||h=="MultiLineString"||h=="Polygon"||h=="MultiPolygon")){if(!ne(this.getBufferedMaxExtent(),t.getExtent()))return;let g;if(u=t.getFlatCoordinates(),h=="LineString")g=[u.length];else if(h=="MultiLineString")g=t.getEnds();else if(h=="Polygon")g=t.getEnds().slice(0,1);else if(h=="MultiPolygon"){const x=t.getEndss();g=[];for(let v=0,C=x.length;v<C;++v)g.push(x[v][0])}this.beginGeometry(t,e);const p=r.textAlign;let m=0,E;for(let x=0,v=g.length;x<v;++x){if(p==null){const b=Lc(r.maxAngle,u,m,g[x],f);m=b[0],E=b[1]}else E=g[x];for(let b=m;b<E;b+=f)o.push(u[b],u[b+1]);const C=o.length;m=g[x],this.drawChars_(l,C),l=C}this.endGeometry(e)}else{let g=r.overflow?null:[];switch(h){case"Point":case"MultiPoint":u=t.getFlatCoordinates();break;case"LineString":u=t.getFlatMidpoint();break;case"Circle":u=t.getCenter();break;case"MultiLineString":u=t.getFlatMidpoints(),f=2;break;case"Polygon":u=t.getFlatInteriorPoint(),r.overflow||g.push(u[2]/this.resolution),f=3;break;case"MultiPolygon":const v=t.getFlatInteriorPoints();u=[];for(let C=0,b=v.length;C<b;C+=3)r.overflow||g.push(v[C+2]/this.resolution),u.push(v[C],v[C+1]);if(u.length===0)return;f=2;break}const p=this.appendFlatPointCoordinates(u,f);if(p===l)return;if(g&&(p-l)/2!==u.length/f){let v=l/2;g=g.filter((C,b)=>{const P=o[(v+b)*2]===u[b*f]&&o[(v+b)*2+1]===u[b*f+1];return P||--v,P})}this.saveTextStates_(),(r.backgroundFill||r.backgroundStroke)&&(this.setFillStrokeStyle(r.backgroundFill,r.backgroundStroke),r.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),r.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let m=r.padding;if(m!=ai&&(r.scale[0]<0||r.scale[1]<0)){let v=r.padding[0],C=r.padding[1],b=r.padding[2],P=r.padding[3];r.scale[0]<0&&(C=-C,P=-P),r.scale[1]<0&&(v=-v,b=-b),m=[v,C,b,P]}const E=this.pixelRatio;this.instructions.push([rt.DRAW_IMAGE,l,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,m==ai?ai:m.map(function(v){return v*E}),!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,g]);const x=1/E;this.hitDetectionInstructions.push([rt.DRAW_IMAGE,l,p,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[x,x],NaN,void 0,this.declutterImageWithText_,m,!!r.backgroundFill,!!r.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,g]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const r=this.textKey_;r in this.textStates||(this.textStates[r]={font:e.font,textAlign:e.textAlign||rn,justify:e.justify,textBaseline:e.textBaseline||qn,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,n=this.textState_,r=this.strokeKey_,o=this.textKey_,l=this.fillKey_;this.saveTextStates_();const h=this.pixelRatio,u=Hi[n.textBaseline],f=this.textOffsetY_*h,g=this.text_,p=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([rt.DRAW_CHARS,t,e,u,n.overflow,l,n.maxAngle,h,f,r,p*h,g,o,1]),this.hitDetectionInstructions.push([rt.DRAW_CHARS,t,e,u,n.overflow,l,n.maxAngle,1,f,r,p,g,o,1/h])}setTextStyle(t,e){let i,n,r;if(!t)this.text_="";else{const o=t.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=ve(o.getColor()||De)):(n=null,this.textFillState_=n);const l=t.getStroke();if(!l)r=null,this.textStrokeState_=r;else{r=this.textStrokeState_,r||(r={},this.textStrokeState_=r);const E=l.getLineDash(),x=l.getLineDashOffset(),v=l.getWidth(),C=l.getMiterLimit();r.lineCap=l.getLineCap()||Kn,r.lineDash=E?E.slice():tn,r.lineDashOffset=x===void 0?en:x,r.lineJoin=l.getLineJoin()||ji,r.lineWidth=v===void 0?on:v,r.miterLimit=C===void 0?nn:C,r.strokeStyle=ve(l.getColor()||sn)}i=this.textState_;const h=t.getFont()||pa;ch(h);const u=t.getScaleArray();i.overflow=t.getOverflow(),i.font=h,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||qn,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||ai,i.scale=u===void 0?[1,1]:u;const f=t.getOffsetX(),g=t.getOffsetY(),p=t.getRotateWithView(),m=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=f===void 0?0:f,this.textOffsetY_=g===void 0?0:g,this.textRotateWithView_=p===void 0?!1:p,this.textRotation_=m===void 0?0:m,this.strokeKey_=r?(typeof r.strokeStyle=="string"?r.strokeStyle:St(r.strokeStyle))+r.lineCap+r.lineDashOffset+"|"+r.lineWidth+r.lineJoin+r.miterLimit+"["+r.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n?typeof n.fillStyle=="string"?n.fillStyle:"|"+St(n.fillStyle):""}this.declutterImageWithText_=e}}const Nc={Circle:Fo,Default:wn,Image:Ac,LineString:Pc,Polygon:Fo,Text:Dc};class ko{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const r=i[n].finish();t[e][n]=r}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let r=n[e];if(r===void 0){const o=Nc[e];r=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=r}return r}}class Fc extends pn{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return ct()}getData(t){return null}prepareFrame(t){return ct()}renderFrame(t,e){return ct()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(function(n,r){const o=this.loadedTileCallback.bind(this,i,n);return t.forEachLoadedTile(e,n,r,o)}).bind(this)}forEachFeatureAtCoordinate(t,e,i,n,r){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){t.target.getState()===zt.LOADED&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=zt.LOADED&&e!=zt.ERROR&&t.addEventListener(gt.CHANGE,this.boundHandleImageChange_),e==zt.IDLE&&(t.load(),e=t.getState()),e==zt.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}class Wa extends Ne{constructor(t,e,i,n){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=n}}const Go=[];let Mi=null;function kc(){const s=document.createElement("canvas");s.width=1,s.height=1,Mi=s.getContext("2d")}class za extends Fc{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Re(),this.pixelTransform=Re(),this.inversePixelTransform=Re(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){Mi||kc(),Mi.clearRect(0,0,1,1);let n;try{Mi.drawImage(t,e,i,1,1,0,0,1,1),n=Mi.getImageData(0,0,1,1).data}catch{return Mi=null,null}return n}getBackground(t){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const n=this.getLayer().getClassName();let r,o;if(t&&t.className===n&&(!i||t&&t.style.backgroundColor&&Ei(Vn(t.style.backgroundColor),Vn(i)))){const l=t.firstElementChild;l instanceof HTMLCanvasElement&&(o=l.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){r=document.createElement("div"),r.className=n;let l=r.style;l.position="absolute",l.width="100%",l.height="100%",o=le();const h=o.canvas;r.appendChild(h),l=h.style,l.position="absolute",l.left="0",l.transformOrigin="top left",this.container=r,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const n=wi(i),r=ls(i),o=as(i),l=os(i);Bt(e.coordinateToPixelTransform,n),Bt(e.coordinateToPixelTransform,r),Bt(e.coordinateToPixelTransform,o),Bt(e.coordinateToPixelTransform,l);const h=this.inversePixelTransform;Bt(h,n),Bt(h,r),Bt(h,o),Bt(h,l),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(r[0]),Math.round(r[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(l[0]),Math.round(l[1])),t.clip()}dispatchRenderEvent_(t,e,i){const n=this.getLayer();if(n.hasListener(t)){const r=new Wa(t,this.inversePixelTransform,i,e);n.dispatchEvent(r)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_(He.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(He.POSTRENDER,t,e)}getRenderTransform(t,e,i,n,r,o,l){const h=r/2,u=o/2,f=n/e,g=-f,p=-t[0]+l,m=-t[1];return Qe(this.tempTransform,h,u,f,g,-i,p,m)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function Gc(s,t,e,i,n,r,o,l,h,u,f,g){let p=s[t],m=s[t+1],E=0,x=0,v=0,C=0;function b(){E=p,x=m,t+=i,p=s[t],m=s[t+1],C+=v,v=Math.sqrt((p-E)*(p-E)+(m-x)*(m-x))}do b();while(t<e-i&&C+v<r);let P=v===0?0:(r-C)/v;const A=Me(E,p,P),L=Me(x,m,P),X=t-i,K=C,S=r+l*h(u,n,f);for(;t<e-i&&C+v<S;)b();P=v===0?0:(S-C)/v;const O=Me(E,p,P),N=Me(x,m,P);let z;if(g){const M=[A,L,O,N];Ca(M,0,4,2,g,M,M),z=M[0]>M[2]}else z=A>O;const U=Math.PI,Y=[],V=X+i===t;t=X,v=0,C=K,p=s[t],m=s[t+1];let B;if(V){b(),B=Math.atan2(m-x,p-E),z&&(B+=B>0?-U:U);const M=(O+A)/2,F=(N+L)/2;return Y[0]=[M,F,(S-r)/2,B,n],Y}n=n.replace(/\n/g," ");for(let M=0,F=n.length;M<F;){b();let $=Math.atan2(m-x,p-E);if(z&&($+=$>0?-U:U),B!==void 0){let et=$-B;if(et+=et>U?-2*U:et<-U?2*U:0,Math.abs(et)>o)return null}B=$;const lt=M;let tt=0;for(;M<F;++M){const et=z?F-M-1:M,ft=l*h(u,n[et],f);if(t+i<e&&C+v<r+tt+ft/2)break;tt+=ft}if(M===lt)continue;const ot=z?n.substring(F-lt,F-M):n.substring(lt,M);P=v===0?0:(r+tt/2-C)/v;const j=Me(E,p,P),yt=Me(x,m,P);Y.push([j,yt,tt/2,$,ot]),r+=tt}return Y}const Ii=de(),je=[],Ie=[],Ae=[],Ye=[];function Uo(s){return s[3].declutterBox}const Uc=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function Xo(s,t){return(t==="start"||t==="end")&&!Uc.test(s)&&(t=t==="start"?"left":"right"),Hi[t]}function Xc(s,t,e){return e>0&&s.push(`
`,""),s.push(t,""),s}class jc{constructor(t,e,i,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=Re(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,n){const r=t+e+i+n;if(this.labels_[r])return this.labels_[r];const o=n?this.strokeStates[n]:null,l=i?this.fillStates[i]:null,h=this.textStates[e],u=this.pixelRatio,f=[h.scale[0]*u,h.scale[1]*u],g=Array.isArray(t),p=h.justify?Hi[h.justify]:Xo(Array.isArray(t)?t[0]:t,h.textAlign||rn),m=n&&o.lineWidth?o.lineWidth:0,E=g?t:t.split(`
`).reduce(Xc,[]),{width:x,height:v,widths:C,heights:b,lineWidths:P}=dh(h,E),A=x+m,L=[],X=(A+2)*f[0],K=(v+m)*f[1],S={width:X<0?Math.floor(X):Math.ceil(X),height:K<0?Math.floor(K):Math.ceil(K),contextInstructions:L};(f[0]!=1||f[1]!=1)&&L.push("scale",f),n&&(L.push("strokeStyle",o.strokeStyle),L.push("lineWidth",m),L.push("lineCap",o.lineCap),L.push("lineJoin",o.lineJoin),L.push("miterLimit",o.miterLimit),L.push("setLineDash",[o.lineDash]),L.push("lineDashOffset",o.lineDashOffset)),i&&L.push("fillStyle",l.fillStyle),L.push("textBaseline","middle"),L.push("textAlign","center");const O=.5-p;let N=p*A+O*m;const z=[],U=[];let Y=0,V=0,B=0,M=0,F;for(let $=0,lt=E.length;$<lt;$+=2){const tt=E[$];if(tt===`
`){V+=Y,Y=0,N=p*A+O*m,++M;continue}const ot=E[$+1]||h.font;ot!==F&&(n&&z.push("font",ot),i&&U.push("font",ot),F=ot),Y=Math.max(Y,b[B]);const j=[tt,N+O*C[B]+p*(C[B]-P[M]),.5*(m+Y)+V];N+=C[B],n&&z.push("strokeText",j),i&&U.push("fillText",j),++B}return Array.prototype.push.apply(L,z),Array.prototype.push.apply(L,U),this.labels_[r]=S,S}replayTextBackground_(t,e,i,n,r,o,l){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,r),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),l&&(this.setStrokeStyle_(t,l),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,r,o,l,h,u,f,g,p,m,E,x,v){l*=p[0],h*=p[1];let C=i-l,b=n-h;const P=r+u>t?t-u:r,A=o+f>e?e-f:o,L=E[3]+P*p[0]+E[1],X=E[0]+A*p[1]+E[2],K=C-E[3],S=b-E[0];(x||g!==0)&&(je[0]=K,Ye[0]=K,je[1]=S,Ie[1]=S,Ie[0]=K+L,Ae[0]=Ie[0],Ae[1]=S+X,Ye[1]=Ae[1]);let O;return g!==0?(O=Qe(Re(),i,n,1,1,g,-i,-n),Bt(O,je),Bt(O,Ie),Bt(O,Ae),Bt(O,Ye),Se(Math.min(je[0],Ie[0],Ae[0],Ye[0]),Math.min(je[1],Ie[1],Ae[1],Ye[1]),Math.max(je[0],Ie[0],Ae[0],Ye[0]),Math.max(je[1],Ie[1],Ae[1],Ye[1]),Ii)):Se(Math.min(K,K+L),Math.min(S,S+X),Math.max(K,K+L),Math.max(S,S+X),Ii),m&&(C=Math.round(C),b=Math.round(b)),{drawImageX:C,drawImageY:b,drawImageW:P,drawImageH:A,originX:u,originY:f,declutterBox:{minX:Ii[0],minY:Ii[1],maxX:Ii[2],maxY:Ii[3],value:v},canvasTransform:O,scale:p}}replayImageOrLabel_(t,e,i,n,r,o,l){const h=!!(o||l),u=n.declutterBox,f=t.canvas,g=l?l[2]*n.scale[0]/2:0;return u.minX-g<=f.width/e&&u.maxX+g>=0&&u.minY-g<=f.height/e&&u.maxY+g>=0&&(h&&this.replayTextBackground_(t,je,Ie,Ae,Ye,o,l),fh(t,n.canvasTransform,r,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){if(this.alignFill_){const e=Bt(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){const r=this.textStates[e],o=this.createLabel(t,e,n,i),l=this.strokeStates[i],h=this.pixelRatio,u=Xo(Array.isArray(t)?t[0]:t,r.textAlign||rn),f=Hi[r.textBaseline||qn],g=l&&l.lineWidth?l.lineWidth:0,p=o.width/h-2*r.scale[0],m=u*p+2*(.5-u)*g,E=f*o.height/h+2*(.5-f)*g;return{label:o,anchorX:m,anchorY:E}}execute_(t,e,i,n,r,o,l,h){let u;this.pixelCoordinates_&&Ei(i,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=di(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Rh(this.renderedTransform_,i));let f=0;const g=n.length;let p=0,m,E,x,v,C,b,P,A,L,X,K,S,O=0,N=0,z=null,U=null;const Y=this.coordinateCache_,V=this.viewRotation_,B=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,M={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:V},F=this.instructions!=n||this.overlaps?0:200;let $,lt,tt,ot;for(;f<g;){const j=n[f];switch(j[0]){case rt.BEGIN_GEOMETRY:$=j[1],ot=j[3],$.getGeometry()?l!==void 0&&!ne(l,ot.getExtent())?f=j[2]+1:++f:f=j[2];break;case rt.BEGIN_PATH:O>F&&(this.fill_(t),O=0),N>F&&(t.stroke(),N=0),!O&&!N&&(t.beginPath(),v=NaN,C=NaN),++f;break;case rt.CIRCLE:p=j[1];const et=u[p],ft=u[p+1],At=u[p+2],Et=u[p+3],it=At-et,k=Et-ft,W=Math.sqrt(it*it+k*k);t.moveTo(et+W,ft),t.arc(et,ft,W,0,2*Math.PI,!0),++f;break;case rt.CLOSE_PATH:t.closePath(),++f;break;case rt.CUSTOM:p=j[1],m=j[2];const Q=j[3],J=j[4],H=j.length==6?j[5]:void 0;M.geometry=Q,M.feature=$,f in Y||(Y[f]=[]);const st=Y[f];H?H(u,p,m,2,st):(st[0]=u[p],st[1]=u[p+1],st.length=2),J(st,M),++f;break;case rt.DRAW_IMAGE:p=j[1],m=j[2],A=j[3],E=j[4],x=j[5];let ut=j[6];const Rt=j[7],bt=j[8],Tt=j[9],Xt=j[10];let _t=j[11];const Ot=j[12];let It=j[13];const qt=j[14],y=j[15];if(!A&&j.length>=20){L=j[19],X=j[20],K=j[21],S=j[22];const nt=this.drawLabelWithPointPlacement_(L,X,K,S);A=nt.label,j[3]=A;const ke=j[23];E=(nt.anchorX-ke)*this.pixelRatio,j[4]=E;const ee=j[24];x=(nt.anchorY-ee)*this.pixelRatio,j[5]=x,ut=A.height,j[6]=ut,It=A.width,j[13]=It}let w;j.length>25&&(w=j[25]);let T,D,Z;j.length>17?(T=j[16],D=j[17],Z=j[18]):(T=ai,D=!1,Z=!1),Xt&&B?_t+=V:!Xt&&!B&&(_t-=V);let dt=0;for(;p<m;p+=2){if(w&&w[dt++]<It/this.pixelRatio)continue;const nt=this.calculateImageOrLabelDimensions_(A.width,A.height,u[p],u[p+1],It,ut,E,x,bt,Tt,_t,Ot,r,T,D||Z,$),ke=[t,e,A,nt,Rt,D?z:null,Z?U:null];if(h){if(qt==="none")continue;if(qt==="obstacle"){h.insert(nt.declutterBox);continue}else{let ee,Kt;if(y){const te=m-p;if(!y[te]){y[te]=ke;continue}if(ee=y[te],delete y[te],Kt=Uo(ee),h.collides(Kt))continue}if(h.collides(nt.declutterBox))continue;ee&&(h.insert(Kt),this.replayImageOrLabel_.apply(this,ee)),h.insert(nt.declutterBox)}}this.replayImageOrLabel_.apply(this,ke)}++f;break;case rt.DRAW_CHARS:const Dt=j[1],Pt=j[2],$t=j[3],jt=j[4];S=j[5];const Yt=j[6],he=j[7],ge=j[8];K=j[9];const Nt=j[10];L=j[11],X=j[12];const ye=[j[13],j[13]],re=this.textStates[X],oe=re.font,Fe=[re.scale[0]*he,re.scale[1]*he];let be;oe in this.widths_?be=this.widths_[oe]:(be={},this.widths_[oe]=be);const Ft=Da(u,Dt,Pt,2),Zt=Math.abs(Fe[0])*po(oe,L,be);if(jt||Zt<=Ft){const nt=this.textStates[X].textAlign,ke=(Ft-Zt)*Hi[nt],ee=Gc(u,Dt,Pt,2,L,ke,Yt,Math.abs(Fe[0]),po,oe,be,B?0:this.viewRotation_);t:if(ee){const Kt=[];let te,pe,xi,Wt,ie;if(K)for(te=0,pe=ee.length;te<pe;++te){ie=ee[te],xi=ie[4],Wt=this.createLabel(xi,X,"",K),E=ie[2]+(Fe[0]<0?-Nt:Nt),x=$t*Wt.height+(.5-$t)*2*Nt*Fe[1]/Fe[0]-ge;const ce=this.calculateImageOrLabelDimensions_(Wt.width,Wt.height,ie[0],ie[1],Wt.width,Wt.height,E,x,0,0,ie[3],ye,!1,ai,!1,$);if(h&&h.collides(ce.declutterBox))break t;Kt.push([t,e,Wt,ce,1,null,null])}if(S)for(te=0,pe=ee.length;te<pe;++te){ie=ee[te],xi=ie[4],Wt=this.createLabel(xi,X,S,""),E=ie[2],x=$t*Wt.height-ge;const ce=this.calculateImageOrLabelDimensions_(Wt.width,Wt.height,ie[0],ie[1],Wt.width,Wt.height,E,x,0,0,ie[3],ye,!1,ai,!1,$);if(h&&h.collides(ce.declutterBox))break t;Kt.push([t,e,Wt,ce,1,null,null])}h&&h.load(Kt.map(Uo));for(let ce=0,Ri=Kt.length;ce<Ri;++ce)this.replayImageOrLabel_.apply(this,Kt[ce])}}++f;break;case rt.END_GEOMETRY:if(o!==void 0){$=j[1];const nt=o($,ot);if(nt)return nt}++f;break;case rt.FILL:F?O++:this.fill_(t),++f;break;case rt.MOVE_TO_LINE_TO:for(p=j[1],m=j[2],lt=u[p],tt=u[p+1],b=lt+.5|0,P=tt+.5|0,(b!==v||P!==C)&&(t.moveTo(lt,tt),v=b,C=P),p+=2;p<m;p+=2)lt=u[p],tt=u[p+1],b=lt+.5|0,P=tt+.5|0,(p==m-2||b!==v||P!==C)&&(t.lineTo(lt,tt),v=b,C=P);++f;break;case rt.SET_FILL_STYLE:z=j,this.alignFill_=j[2],O&&(this.fill_(t),O=0,N&&(t.stroke(),N=0)),t.fillStyle=j[1],++f;break;case rt.SET_STROKE_STYLE:U=j,N&&(t.stroke(),N=0),this.setStrokeStyle_(t,j),++f;break;case rt.STROKE:F?N++:t.stroke(),++f;break;default:++f;break}}O&&this.fill_(t),N&&t.stroke()}execute(t,e,i,n,r,o){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,r,void 0,void 0,o)}executeHitDetection(t,e,i,n,r){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,r)}}const bs=["Polygon","Circle","LineString","Image","Text","Default"];class jo{constructor(t,e,i,n,r,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Re(),this.createExecutors_(r)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];i===void 0&&(i={},this.executorsByZIndex_[e]=i);const n=t[e];for(const r in n){const o=n[r];i[r]=new jc(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let n=0,r=t.length;n<r;++n)if(t[n]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,r,o){n=Math.round(n);const l=n*2+1,h=Qe(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),u=!this.hitDetectionContext_;u&&(this.hitDetectionContext_=le(l,l));const f=this.hitDetectionContext_;f.canvas.width!==l||f.canvas.height!==l?(f.canvas.width=l,f.canvas.height=l):u||f.clearRect(0,0,l,l);let g;this.renderBuffer_!==void 0&&(g=de(),qi(g,t),ar(g,e*(this.renderBuffer_+n),g));const p=Yc(n);let m;function E(L,X){const K=f.getImageData(0,0,l,l).data;for(let S=0,O=p.length;S<O;S++)if(K[p[S]]>0){if(!o||m!=="Image"&&m!=="Text"||o.includes(L)){const N=(p[S]-3)/4,z=n-N%l,U=n-(N/l|0),Y=r(L,X,z*z+U*U);if(Y)return Y}f.clearRect(0,0,l,l);break}}const x=Object.keys(this.executorsByZIndex_).map(Number);x.sort(gi);let v,C,b,P,A;for(v=x.length-1;v>=0;--v){const L=x[v].toString();for(b=this.executorsByZIndex_[L],C=bs.length-1;C>=0;--C)if(m=bs[C],P=b[m],P!==void 0&&(A=P.executeHitDetection(f,h,i,E,g),A))return A}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],r=e[2],o=e[3],l=[i,n,i,o,r,o,r,n];return di(l,0,8,2,t,l),l}isEmpty(){return Xi(this.executorsByZIndex_)}execute(t,e,i,n,r,o,l){const h=Object.keys(this.executorsByZIndex_).map(Number);h.sort(gi),this.maxExtent_&&(t.save(),this.clip(t,i)),o=o||bs;let u,f,g,p,m,E;for(l&&h.reverse(),u=0,f=h.length;u<f;++u){const x=h[u].toString();for(m=this.executorsByZIndex_[x],g=0,p=o.length;g<p;++g){const v=o[g];E=m[v],E!==void 0&&E.execute(t,e,i,n,r,l)}}this.maxExtent_&&t.restore()}}const Is={};function Yc(s){if(Is[s]!==void 0)return Is[s];const t=s*2+1,e=s*s,i=new Array(e+1);for(let r=0;r<=s;++r)for(let o=0;o<=s;++o){const l=r*r+o*o;if(l>e)break;let h=i[l];h||(h=[],i[l]=h),h.push(((s+r)*t+(s+o))*4+3),r>0&&h.push(((s-r)*t+(s+o))*4+3),o>0&&(h.push(((s+r)*t+(s-o))*4+3),r>0&&h.push(((s-r)*t+(s-o))*4+3))}const n=[];for(let r=0,o=i.length;r<o;++r)i[r]&&n.push(...i[r]);return Is[s]=n,n}const Qt={ANIMATING:0,INTERACTING:1};class Wc extends Ya{constructor(t,e,i,n,r,o,l){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.viewRotation_=r,this.squaredTolerance_=o,this.userTransform_=l,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Re()}drawImages_(t,e,i,n){if(!this.image_)return;const r=di(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,l=this.tmpLocalTransform_,h=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=h*this.imageOpacity_);let u=this.imageRotation_;this.imageRotateWithView_&&(u+=this.viewRotation_);for(let f=0,g=r.length;f<g;f+=2){const p=r[f]-this.imageAnchorX_,m=r[f+1]-this.imageAnchorY_;if(u!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const E=p+this.imageAnchorX_,x=m+this.imageAnchorY_;Qe(l,E,x,1,1,u,-E,-x),o.setTransform.apply(o,l),o.translate(E,x),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,p,m,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=h)}drawText_(t,e,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const r=di(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let l=this.textRotation_;for(this.textRotateWithView_&&(l+=this.viewRotation_);e<i;e+=n){const h=r[e]+this.textOffsetX_,u=r[e+1]+this.textOffsetY_;l!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.translate(h-this.textOffsetX_,u-this.textOffsetY_),o.rotate(l),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,h,u),this.textFillState_&&o.fillText(this.text_,h,u))}}moveToLineTo_(t,e,i,n,r){const o=this.context_,l=di(t,e,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(l[0],l[1]);let h=l.length;r&&(h-=2);for(let u=2;u<h;u+=2)o.lineTo(l[u],l[u+1]);return r&&o.closePath(),i}drawRings_(t,e,i,n){for(let r=0,o=i.length;r<o;++r)e=this.moveToLineTo_(t,e,i[r],n,!0);return e}drawCircle(t){if(ne(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=Zh(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],r=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],r,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);!i||!ne(this.extent_,i.getExtent())||(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ne(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(ne(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getFlatCoordinates();let r=0;const o=t.getEnds(),l=t.getStride();i.beginPath();for(let h=0,u=o.length;h<u;++h)r=this.moveToLineTo_(n,r,o[h],l,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ne(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!ne(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const r=t.getEndss(),o=t.getStride();e.beginPath();for(let l=0,h=r.length;l<h;++l){const u=r[l];n=this.drawRings_(i,n,u,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),Ei(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:rn;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:ve(i||De)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),n=e.getLineCap(),r=e.getLineDash(),o=e.getLineDashOffset(),l=e.getLineJoin(),h=e.getWidth(),u=e.getMiterLimit(),f=r||tn;this.strokeState_={lineCap:n!==void 0?n:Kn,lineDash:this.pixelRatio_===1?f:f.map(g=>g*this.pixelRatio_),lineDashOffset:(o||en)*this.pixelRatio_,lineJoin:l!==void 0?l:ji,lineWidth:(h!==void 0?h:on)*this.pixelRatio_,miterLimit:u!==void 0?u:nn,strokeStyle:ve(i||sn)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),r=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=r[0],this.imageOriginY_=r[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const m=e.getColor();this.textFillState_={fillStyle:ve(m||De)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const m=i.getColor(),E=i.getLineCap(),x=i.getLineDash(),v=i.getLineDashOffset(),C=i.getLineJoin(),b=i.getWidth(),P=i.getMiterLimit();this.textStrokeState_={lineCap:E!==void 0?E:Kn,lineDash:x||tn,lineDashOffset:v||en,lineJoin:C!==void 0?C:ji,lineWidth:b!==void 0?b:on,miterLimit:P!==void 0?P:nn,strokeStyle:ve(m||sn)}}const n=t.getFont(),r=t.getOffsetX(),o=t.getOffsetY(),l=t.getRotateWithView(),h=t.getRotation(),u=t.getScaleArray(),f=t.getText(),g=t.getTextAlign(),p=t.getTextBaseline();this.textState_={font:n!==void 0?n:pa,textAlign:g!==void 0?g:rn,textBaseline:p!==void 0?p:qn},this.text_=f!==void 0?Array.isArray(f)?f.reduce((m,E,x)=>m+=x%2?" ":E,""):f:"",this.textOffsetX_=r!==void 0?this.pixelRatio_*r:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=l!==void 0?l:!1,this.textRotation_=h!==void 0?h:0,this.textScale_=[this.pixelRatio_*u[0],this.pixelRatio_*u[1]]}}}const Ee=.5;function zc(s,t,e,i,n,r,o){const l=s[0]*Ee,h=s[1]*Ee,u=le(l,h);u.imageSmoothingEnabled=!1;const f=u.canvas,g=new Wc(u,Ee,n,null,o),p=e.length,m=Math.floor((256*256*256-1)/p),E={};for(let v=1;v<=p;++v){const C=e[v-1],b=C.getStyleFunction()||i;if(!i)continue;let P=b(C,r);if(!P)continue;Array.isArray(P)||(P=[P]);const L="#"+("000000"+(v*m).toString(16)).slice(-6);for(let X=0,K=P.length;X<K;++X){const S=P[X],O=S.getGeometryFunction()(C);if(!O||!ne(n,O.getExtent()))continue;const N=S.clone(),z=N.getFill();z&&z.setColor(L);const U=N.getStroke();U&&(U.setColor(L),U.setLineDash(null)),N.setText(void 0);const Y=S.getImage();if(Y&&Y.getOpacity()!==0){const M=Y.getImageSize();if(!M)continue;const F=le(M[0],M[1],void 0,{alpha:!1}),$=F.canvas;F.fillStyle=L,F.fillRect(0,0,$.width,$.height),N.setImage(new ya({img:$,imgSize:M,anchor:Y.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:Y.getOrigin(),opacity:1,size:Y.getSize(),scale:Y.getScale(),rotation:Y.getRotation(),rotateWithView:Y.getRotateWithView()}))}const V=N.getZIndex()||0;let B=E[V];B||(B={},E[V]=B,B.Polygon=[],B.Circle=[],B.LineString=[],B.Point=[]),B[O.getType().replace("Multi","")].push(O,N)}}const x=Object.keys(E).map(Number).sort(gi);for(let v=0,C=x.length;v<C;++v){const b=E[x[v]];for(const P in b){const A=b[P];for(let L=0,X=A.length;L<X;L+=2){g.setStyle(A[L+1]);for(let K=0,S=t.length;K<S;++K)g.setTransform(t[K]),g.drawGeometry(A[L])}}}return u.getImageData(0,0,f.width,f.height)}function $c(s,t,e){const i=[];if(e){const n=Math.floor(Math.round(s[0])*Ee),r=Math.floor(Math.round(s[1])*Ee),o=(Ut(n,0,e.width-1)+Ut(r,0,e.height-1)*e.width)*4,l=e.data[o],h=e.data[o+1],f=e.data[o+2]+256*(h+256*l),g=Math.floor((256*256*256-1)/t.length);f&&f%g===0&&i.push(t[f/g-1])}return i}const Vc=.5,$a={Point:eu,LineString:Jc,Polygon:nu,MultiPoint:iu,MultiLineString:Qc,MultiPolygon:tu,GeometryCollection:Hc,Circle:qc};function Bc(s,t){return parseInt(St(s),10)-parseInt(St(t),10)}function Kc(s,t){const e=er(s,t);return e*e}function er(s,t){return Vc*s/t}function qc(s,t,e,i,n){const r=e.getFill(),o=e.getStroke();if(r||o){const h=s.getBuilder(e.getZIndex(),"Circle");h.setFillStrokeStyle(r,o),h.drawCircle(t,i)}const l=e.getText();if(l&&l.getText()){const h=(n||s).getBuilder(e.getZIndex(),"Text");h.setTextStyle(l),h.drawText(t,i)}}function Yo(s,t,e,i,n,r,o){let l=!1;const h=e.getImage();if(h){const u=h.getImageState();u==zt.LOADED||u==zt.ERROR?h.unlistenImageChange(n):(u==zt.IDLE&&h.load(),h.listenImageChange(n),l=!0)}return Zc(s,t,e,i,r,o),l}function Zc(s,t,e,i,n,r){const o=e.getGeometryFunction()(t);if(!o)return;const l=o.simplifyTransformed(i,n);if(e.getRenderer())Va(s,l,e,t);else{const u=$a[l.getType()];u(s,l,e,t,r)}}function Va(s,t,e,i){if(t.getType()=="GeometryCollection"){const r=t.getGeometries();for(let o=0,l=r.length;o<l;++o)Va(s,r[o],e,i);return}s.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer())}function Hc(s,t,e,i,n){const r=t.getGeometriesArray();let o,l;for(o=0,l=r.length;o<l;++o){const h=$a[r[o].getType()];h(s,r[o],e,i,n)}}function Jc(s,t,e,i,n){const r=e.getStroke();if(r){const l=s.getBuilder(e.getZIndex(),"LineString");l.setFillStrokeStyle(null,r),l.drawLineString(t,i)}const o=e.getText();if(o&&o.getText()){const l=(n||s).getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i)}}function Qc(s,t,e,i,n){const r=e.getStroke();if(r){const l=s.getBuilder(e.getZIndex(),"LineString");l.setFillStrokeStyle(null,r),l.drawMultiLineString(t,i)}const o=e.getText();if(o&&o.getText()){const l=(n||s).getBuilder(e.getZIndex(),"Text");l.setTextStyle(o),l.drawText(t,i)}}function tu(s,t,e,i,n){const r=e.getFill(),o=e.getStroke();if(o||r){const h=s.getBuilder(e.getZIndex(),"Polygon");h.setFillStrokeStyle(r,o),h.drawMultiPolygon(t,i)}const l=e.getText();if(l&&l.getText()){const h=(n||s).getBuilder(e.getZIndex(),"Text");h.setTextStyle(l),h.drawText(t,i)}}function eu(s,t,e,i,n){const r=e.getImage(),o=e.getText();let l;if(r){if(r.getImageState()!=zt.LOADED)return;let h=s;if(n){const f=r.getDeclutterMode();if(f!=="none")if(h=n,f==="obstacle"){const g=s.getBuilder(e.getZIndex(),"Image");g.setImageStyle(r,l),g.drawPoint(t,i)}else o&&o.getText()&&(l={})}const u=h.getBuilder(e.getZIndex(),"Image");u.setImageStyle(r,l),u.drawPoint(t,i)}if(o&&o.getText()){let h=s;n&&(h=n);const u=h.getBuilder(e.getZIndex(),"Text");u.setTextStyle(o,l),u.drawText(t,i)}}function iu(s,t,e,i,n){const r=e.getImage(),o=e.getText();let l;if(r){if(r.getImageState()!=zt.LOADED)return;let h=s;if(n){const f=r.getDeclutterMode();if(f!=="none")if(h=n,f==="obstacle"){const g=s.getBuilder(e.getZIndex(),"Image");g.setImageStyle(r,l),g.drawMultiPoint(t,i)}else o&&o.getText()&&(l={})}const u=h.getBuilder(e.getZIndex(),"Image");u.setImageStyle(r,l),u.drawMultiPoint(t,i)}if(o&&o.getText()){let h=s;n&&(h=n);const u=h.getBuilder(e.getZIndex(),"Text");u.setTextStyle(o,l),u.drawText(t,i)}}function nu(s,t,e,i,n){const r=e.getFill(),o=e.getStroke();if(r||o){const h=s.getBuilder(e.getZIndex(),"Polygon");h.setFillStrokeStyle(r,o),h.drawPolygon(t,i)}const l=e.getText();if(l&&l.getText()){const h=(n||s).getBuilder(e.getZIndex(),"Text");h.setTextStyle(l),h.drawText(t,i)}}class su extends za{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=de(),this.wrappedRenderedExtent_=de(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const n=e.extent,r=e.viewState,o=r.center,l=r.resolution,h=r.projection,u=r.rotation,f=h.getExtent(),g=this.getLayer().getSource(),p=e.pixelRatio,m=e.viewHints,E=!(m[Qt.ANIMATING]||m[Qt.INTERACTING]),x=this.compositionContext_,v=Math.round(e.size[0]*p),C=Math.round(e.size[1]*p),b=g.getWrapX()&&h.canWrapX(),P=b?Mt(f):null,A=b?Math.ceil((n[2]-f[2])/P)+1:1;let L=b?Math.floor((n[0]-f[0])/P):0;do{const X=this.getRenderTransform(o,l,u,p,v,C,L*P);t.execute(x,1,X,u,E,void 0,i)}while(++L<A)}setupCompositionContext_(){if(this.opacity_!==1){const t=le(this.context.canvas.width,this.context.canvas.height,Go);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,fa(this.compositionContext_),Go.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,n=t.layerStatesArray[t.layerIndex];Sh(this.pixelTransform,1/i,1/i),Er(this.inversePixelTransform,this.pixelTransform);const r=wa(this.pixelTransform);this.useContainer(e,r,this.getBackground(t));const o=this.context,l=o.canvas,h=this.replayGroup_,u=this.declutterExecutorGroup;if((!h||h.isEmpty())&&(!u||u.isEmpty()))return null;const f=Math.round(t.size[0]*i),g=Math.round(t.size[1]*i);l.width!=f||l.height!=g?(l.width=f,l.height=g,l.style.transform!==r&&(l.style.transform=r)):this.containerReused||o.clearRect(0,0,f,g),this.preRender(o,t);const p=t.viewState,m=p.projection;this.opacity_=n.opacity,this.setupCompositionContext_();let E=!1,x=!0;if(n.extent&&this.clipping){const v=li(n.extent,m);x=ne(v,t.extent),E=x&&!Di(v,t.extent),E&&this.clipUnrotated(this.compositionContext_,t,v)}return x&&this.renderWorlds(h,t),E&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==p.rotation&&(this.renderedRotation_=p.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise((function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];Bt(this.pixelTransform,i);const n=this.renderedCenter_,r=this.renderedResolution_,o=this.renderedRotation_,l=this.renderedProjection_,h=this.wrappedRenderedExtent_,u=this.getLayer(),f=[],g=i[0]*Ee,p=i[1]*Ee;f.push(this.getRenderTransform(n,r,o,Ee,g,p,0).slice());const m=u.getSource(),E=l.getExtent();if(m.getWrapX()&&l.canWrapX()&&!Di(E,h)){let x=h[0];const v=Mt(E);let C=0,b;for(;x<E[0];)--C,b=v*C,f.push(this.getRenderTransform(n,r,o,Ee,g,p,b).slice()),x+=v;for(C=0,x=h[2];x>E[2];)++C,b=v*C,f.push(this.getRenderTransform(n,r,o,Ee,g,p,b).slice()),x-=v}this.hitDetectionImageData_=zc(i,f,this.renderedFeatures_,u.getStyleFunction(),h,r,o)}e($c(t,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))}forEachFeatureAtCoordinate(t,e,i,n,r){if(!this.replayGroup_)return;const o=e.viewState.resolution,l=e.viewState.rotation,h=this.getLayer(),u={},f=function(m,E,x){const v=St(m),C=u[v];if(C){if(C!==!0&&x<C.distanceSq){if(x===0)return u[v]=!0,r.splice(r.lastIndexOf(C),1),n(m,h,E);C.geometry=E,C.distanceSq=x}}else{if(x===0)return u[v]=!0,n(m,h,E);r.push(u[v]={feature:m,layer:h,geometry:E,distanceSq:x,callback:n})}};let g;const p=[this.replayGroup_];return this.declutterExecutorGroup&&p.push(this.declutterExecutorGroup),p.some(m=>g=m.forEachFeatureAtCoordinate(t,o,l,i,f,m===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(E=>E.value):null)),g}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const n=t.viewHints[Qt.ANIMATING],r=t.viewHints[Qt.INTERACTING],o=e.getUpdateWhileAnimating(),l=e.getUpdateWhileInteracting();if(this.ready&&!o&&n||!l&&r)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const h=t.extent,u=t.viewState,f=u.projection,g=u.resolution,p=t.pixelRatio,m=e.getRevision(),E=e.getRenderBuffer();let x=e.getRenderOrder();x===void 0&&(x=Bc);const v=u.center.slice(),C=ar(h,E*g),b=C.slice(),P=[C.slice()],A=f.getExtent();if(i.getWrapX()&&f.canWrapX()&&!Di(A,t.extent)){const M=Mt(A),F=Math.max(Mt(C)/2,M);C[0]=A[0]-F,C[2]=A[2]+F,va(v,f);const $=oa(P[0],f);$[0]<A[0]&&$[2]<A[2]?P.push([$[0]+M,$[1],$[2]+M,$[3]]):$[0]>A[0]&&$[2]>A[2]&&P.push([$[0]-M,$[1],$[2]-M,$[3]])}if(this.ready&&this.renderedResolution_==g&&this.renderedRevision_==m&&this.renderedRenderOrder_==x&&Di(this.wrappedRenderedExtent_,C))return Ei(this.renderedExtent_,b)||(this.hitDetectionImageData_=null,this.renderedExtent_=b),this.renderedCenter_=v,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const L=new ko(er(g,p),C,g,p);let X;this.getLayer().getDeclutter()&&(X=new ko(er(g,p),C,g,p));const K=Sa();let S;if(K){for(let M=0,F=P.length;M<F;++M){const $=P[M],lt=Zs($,f);i.loadFeatures(lt,$h(g,f),K)}S=_s(K,f)}else for(let M=0,F=P.length;M<F;++M)i.loadFeatures(P[M],g,f);const O=Kc(g,p);let N=!0;const z=(function(M){let F;const $=M.getStyleFunction()||e.getStyleFunction();if($&&(F=$(M,g)),F){const lt=this.renderFeature(M,O,F,L,S,X);N=N&&!lt}}).bind(this),U=Zs(C,f),Y=i.getFeaturesInExtent(U);x&&Y.sort(x);for(let M=0,F=Y.length;M<F;++M)z(Y[M]);this.renderedFeatures_=Y,this.ready=N;const V=L.finish(),B=new jo(C,g,p,i.getOverlaps(),V,e.getRenderBuffer());return X&&(this.declutterExecutorGroup=new jo(C,g,p,i.getOverlaps(),X.finish(),e.getRenderBuffer())),this.renderedResolution_=g,this.renderedRevision_=m,this.renderedRenderOrder_=x,this.renderedExtent_=b,this.wrappedRenderedExtent_=C,this.renderedCenter_=v,this.renderedProjection_=f,this.replayGroup_=B,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,r,o){if(!i)return!1;let l=!1;if(Array.isArray(i))for(let h=0,u=i.length;h<u;++h)l=Yo(n,t,i[h],e,this.boundHandleStyleImageChange_,r,o)||l;else l=Yo(n,t,i,e,this.boundHandleStyleImageChange_,r,o);return l}}class ru extends bc{constructor(t){super(t)}createRenderer(){return new su(this)}}const Dr=ru;class Wo{constructor(t){this.rbush_=new ja(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[St(e)]=i}load(t,e){const i=new Array(e.length);for(let n=0,r=e.length;n<r;n++){const o=t[n],l=e[n],h={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:l};i[n]=h,this.items_[St(l)]=h}this.rbush_.load(i)}remove(t){const e=St(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[St(e)],n=[i.minX,i.minY,i.maxX,i.maxY];Ji(n,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,r=t.length;n<r;n++)if(i=e(t[n]),i)return i;return i}isEmpty(){return Xi(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Se(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class Ba extends Te{constructor(t){super(),this.projection=Gt(t.projection),this.attributions_=zo(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,n){e.viewResolver=i,e.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return ct()}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=zo(t),this.changed()}setState(t){this.state_=t,this.changed()}}function zo(s){return s?Array.isArray(s)?function(t){return s}:typeof s=="function"?s:function(t){return[s]}:null}const me={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function ou(s,t){return[[-1/0,-1/0,1/0,1/0]]}let au=!1;function lu(s,t,e,i,n,r,o){const l=new XMLHttpRequest;l.open("GET",typeof s=="function"?s(e,i,n):s,!0),t.getType()=="arraybuffer"&&(l.responseType="arraybuffer"),l.withCredentials=au,l.onload=function(h){if(!l.status||l.status>=200&&l.status<300){const u=t.getType();let f;u=="json"||u=="text"?f=l.responseText:u=="xml"?(f=l.responseXML,f||(f=new DOMParser().parseFromString(l.responseText,"application/xml"))):u=="arraybuffer"&&(f=l.response),f?r(t.readFeatures(f,{extent:e,featureProjection:n}),t.readProjection(f)):o()}else o()},l.onerror=o,l.send()}function $o(s,t){return function(e,i,n,r,o){const l=this;lu(s,t,e,i,n,function(h,u){l.addFeatures(h),r!==void 0&&r(h)},o||pi)}}class We extends Ne{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class Ka extends Ba{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=pi,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(mt(this.format_,7),this.loader_=$o(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:ou;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Wo:null,this.loadedExtentsRtree_=new Wo,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),!e&&i===void 0&&(i=new xe(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=St(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new We(me.ADDFEATURE,t))}setupChangeEvents_(t,e){this.featureChangeKeys_[t]=[xt(e,gt.CHANGE,this.handleFeatureChange_,this),xt(e,Ui.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;const n=e.getId();return n!==void 0&&(n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=e),i&&(mt(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],n=[];for(let r=0,o=t.length;r<o;r++){const l=t[r],h=St(l);this.addToIndex_(h,l)&&i.push(l)}for(let r=0,o=i.length;r<o;r++){const l=i[r],h=St(l);this.setupChangeEvents_(h,l);const u=l.getGeometry();if(u){const f=u.getExtent();e.push(f),n.push(l)}else this.nullGeometryFeatures_[h]=l}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(me.ADDFEATURE))for(let r=0,o=i.length;r<o;r++)this.dispatchEvent(new We(me.ADDFEATURE,i[r]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(me.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(me.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(se.ADD,(function(i){e||(e=!0,this.addFeature(i.element),e=!1)}).bind(this)),t.addEventListener(se.REMOVE,(function(i){e||(e=!0,this.removeFeature(i.element),e=!1)}).bind(this)),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(Lt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=(function(n){this.removeFeatureInternal(n)}).bind(this);this.featuresRtree_.forEach(i);for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new We(me.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(n){if(n.getGeometry().intersectsCoordinate(t))return e(n)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){if(i.getGeometry().intersectsExtent(t)){const r=e(i);if(r)return r}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Xi(this.nullGeometryFeatures_)||Le(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const n=Gl(t,e);return[].concat(...n.map(r=>this.featuresRtree_.getInExtent(r)))}else return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],n=t[1];let r=null;const o=[NaN,NaN];let l=1/0;const h=[-1/0,-1/0,1/0,1/0];return e=e||Qi,this.featuresRtree_.forEachInExtent(h,function(u){if(e(u)){const f=u.getGeometry(),g=l;if(l=f.closestPointXY(i,n,o,l),l<g){r=u;const p=Math.sqrt(l);h[0]=i-p,h[1]=n-p,h[2]=i+p,h[3]=n+p}}}),r}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=St(e),n=e.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const o=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const r=e.getId();if(r!==void 0){const o=r.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new We(me.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:St(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Xi(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const n=this.loadedExtentsRtree_,r=this.strategy_(t,e,i);for(let o=0,l=r.length;o<l;++o){const h=r[o];n.forEachInExtent(h,function(f){return Di(f.extent,h)})||(++this.loadingExtentsCount_,this.dispatchEvent(new We(me.FEATURESLOADSTART)),this.loader_.call(this,h,e,i,(function(f){--this.loadingExtentsCount_,this.dispatchEvent(new We(me.FEATURESLOADEND,void 0,f))}).bind(this),(function(){--this.loadingExtentsCount_,this.dispatchEvent(new We(me.FEATURESLOADERROR))}).bind(this)),n.insert(h,{extent:h.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(n){if(Ji(n.extent,t))return i=n,!0}),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=St(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=St(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(Lt),delete this.featureChangeKeys_[e];const n=t.getId();return n!==void 0&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.dispatchEvent(new We(me.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){mt(this.format_,7),this.url_=t,this.setLoader($o(t,this.format_))}}class Be extends Ne{constructor(t,e){super(t),this.layer=e}}const As={LAYERS:"layers"};class Yi extends Ua{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(As.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new xe(i.slice(),{unique:!0}):mt(typeof i.getArray=="function",43):i=new xe(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(Lt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(xt(t,se.ADD,this.handleLayersAdd_,this),xt(t,se.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(Lt);gn(this.listenerKeys_);const e=t.getArray();for(let i=0,n=e.length;i<n;i++){const r=e[i];this.registerLayerListeners_(r),this.dispatchEvent(new Be("addlayer",r))}this.changed()}registerLayerListeners_(t){const e=[xt(t,Ui.PROPERTYCHANGE,this.handleLayerChange_,this),xt(t,gt.CHANGE,this.handleLayerChange_,this)];t instanceof Yi&&e.push(xt(t,"addlayer",this.handleLayerGroupAdd_,this),xt(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[St(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new Be("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new Be("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new Be("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=St(e);this.listenerKeys_[i].forEach(Lt),delete this.listenerKeys_[i],this.dispatchEvent(new Be("removelayer",e)),this.changed()}getLayers(){return this.get(As.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let n=0,r=i.length;n<r;++n)this.dispatchEvent(new Be("removelayer",i[n]))}this.set(As.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const n=this.getLayerState();let r=n.zIndex;!t&&n.zIndex===void 0&&(r=0);for(let o=i,l=e.length;o<l;o++){const h=e[o];h.opacity*=n.opacity,h.visible=h.visible&&n.visible,h.maxResolution=Math.min(h.maxResolution,n.maxResolution),h.minResolution=Math.max(h.minResolution,n.minResolution),h.minZoom=Math.max(h.minZoom,n.minZoom),h.maxZoom=Math.min(h.maxZoom,n.maxZoom),n.extent!==void 0&&(h.extent!==void 0?h.extent=Zi(h.extent,n.extent):h.extent=n.extent),h.zIndex===void 0&&(h.zIndex=r)}return e}getSourceState(){return"ready"}}class hu{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?Gt(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=Gt(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return ct()}readFeature(t,e){return ct()}readFeatures(t,e){return ct()}readGeometry(t,e){return ct()}readProjection(t){return ct()}writeFeature(t,e){return ct()}writeFeatures(t,e){return ct()}writeGeometry(t,e){return ct()}}function qa(s,t,e){const i=e?Gt(e.featureProjection):null,n=e?Gt(e.dataProjection):null;let r;if(i&&n&&!oi(i,n)?r=(t?s.clone():s).transform(t?i:n,t?n:i):r=s,t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),l=function(h){for(let u=0,f=h.length;u<f;++u)h[u]=Math.round(h[u]*o)/o;return h};r===s&&(r=s.clone()),r.applyTransform(l)}return r}const at={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Za(s){return Math.pow(s,3)}function Wi(s){return 1-Za(1-s)}function cu(s){return 3*s*s-2*s*s*s}function uu(s){return s}class Ha extends ds{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(gt.CHANGE)}release(){this.state===at.ERROR&&this.setState(at.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==at.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==at.LOADED){t.interimTile=null;break}else t.getState()==at.LOADING?e=t:t.getState()==at.IDLE?e.interimTile=t.interimTile:e=t;t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==at.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){ct()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const n=e-i+1e3/60;return n>=this.transition_?1:Za(n/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}class Ja extends Ha{constructor(t,e,i,n,r,o){super(t,e,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=r}getImage(){return this.image_}setImage(t){this.image_=t,this.state=at.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=at.ERROR,this.unlistenImage_(),this.image_=du(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=at.LOADED:this.state=at.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==at.ERROR&&(this.state=at.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==at.IDLE&&(this.state=at.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=_a(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function du(){const s=le(1,1);return s.fillStyle="rgba(0,0,0,0)",s.fillRect(0,0,1,1),s.canvas}const fu=.5,gu=10,Vo=.25;class pu{constructor(t,e,i,n,r,o){this.sourceProj_=t,this.targetProj_=e;let l={};const h=ln(this.targetProj_,this.sourceProj_);this.transformInv_=function(b){const P=b[0]+"/"+b[1];return l[P]||(l[P]=h(b)),l[P]},this.maxSourceExtent_=n,this.errorThresholdSquared_=r*r,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Mt(n)==Mt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Mt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Mt(this.targetProj_.getExtent()):null;const u=wi(i),f=ls(i),g=as(i),p=os(i),m=this.transformInv_(u),E=this.transformInv_(f),x=this.transformInv_(g),v=this.transformInv_(p),C=gu+(o?Math.max(0,Math.ceil(Math.log2(Us(i)/(o*o*256*256)))):0);if(this.addQuad_(u,f,g,p,m,E,x,v,C),this.wrapsXInSource_){let b=1/0;this.triangles_.forEach(function(P,A,L){b=Math.min(b,P.source[0][0],P.source[1][0],P.source[2][0])}),this.triangles_.forEach((function(P){if(Math.max(P.source[0][0],P.source[1][0],P.source[2][0])-b>this.sourceWorldWidth_/2){const A=[[P.source[0][0],P.source[0][1]],[P.source[1][0],P.source[1][1]],[P.source[2][0],P.source[2][1]]];A[0][0]-b>this.sourceWorldWidth_/2&&(A[0][0]-=this.sourceWorldWidth_),A[1][0]-b>this.sourceWorldWidth_/2&&(A[1][0]-=this.sourceWorldWidth_),A[2][0]-b>this.sourceWorldWidth_/2&&(A[2][0]-=this.sourceWorldWidth_);const L=Math.min(A[0][0],A[1][0],A[2][0]);Math.max(A[0][0],A[1][0],A[2][0])-L<this.sourceWorldWidth_/2&&(P.source=A)}}).bind(this))}l={}}addTriangle_(t,e,i,n,r,o){this.triangles_.push({source:[n,r,o],target:[t,e,i]})}addQuad_(t,e,i,n,r,o,l,h,u){const f=ks([r,o,l,h]),g=this.sourceWorldWidth_?Mt(f)/this.sourceWorldWidth_:null,p=this.sourceWorldWidth_,m=this.sourceProj_.canWrapX()&&g>.5&&g<1;let E=!1;if(u>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const v=ks([t,e,i,n]);E=Mt(v)/this.targetWorldWidth_>Vo||E}!m&&this.sourceProj_.isGlobal()&&g&&(E=g>Vo||E)}if(!E&&this.maxSourceExtent_&&isFinite(f[0])&&isFinite(f[1])&&isFinite(f[2])&&isFinite(f[3])&&!ne(f,this.maxSourceExtent_))return;let x=0;if(!E&&(!isFinite(r[0])||!isFinite(r[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(l[0])||!isFinite(l[1])||!isFinite(h[0])||!isFinite(h[1]))){if(u>0)E=!0;else if(x=(!isFinite(r[0])||!isFinite(r[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(l[0])||!isFinite(l[1])?2:0)+(!isFinite(h[0])||!isFinite(h[1])?1:0),x!=1&&x!=2&&x!=4&&x!=8)return}if(u>0){if(!E){const v=[(t[0]+i[0])/2,(t[1]+i[1])/2],C=this.transformInv_(v);let b;m?b=(Fi(r[0],p)+Fi(l[0],p))/2-Fi(C[0],p):b=(r[0]+l[0])/2-C[0];const P=(r[1]+l[1])/2-C[1];E=b*b+P*P>this.errorThresholdSquared_}if(E){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const v=[(e[0]+i[0])/2,(e[1]+i[1])/2],C=this.transformInv_(v),b=[(n[0]+t[0])/2,(n[1]+t[1])/2],P=this.transformInv_(b);this.addQuad_(t,e,v,b,r,o,C,P,u-1),this.addQuad_(b,v,i,n,P,C,l,h,u-1)}else{const v=[(t[0]+e[0])/2,(t[1]+e[1])/2],C=this.transformInv_(v),b=[(i[0]+n[0])/2,(i[1]+n[1])/2],P=this.transformInv_(b);this.addQuad_(t,v,b,n,r,C,P,h,u-1),this.addQuad_(v,e,i,b,C,o,l,P,u-1)}return}}if(m){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}x&11||this.addTriangle_(t,i,n,r,l,h),x&14||this.addTriangle_(t,i,e,r,l,o),x&&(x&13||this.addTriangle_(e,n,t,o,h,r),x&7||this.addTriangle_(e,n,i,o,h,l))}calculateSourceExtent(){const t=de();return this.triangles_.forEach(function(e,i,n){const r=e.source;qi(t,r[0]),qi(t,r[1]),qi(t,r[2])}),t}getTriangles(){return this.triangles_}}let Os;const Qa=[];function Bo(s,t,e,i,n){s.beginPath(),s.moveTo(0,0),s.lineTo(t,e),s.lineTo(i,n),s.closePath(),s.save(),s.clip(),s.fillRect(0,0,Math.max(t,i)+1,Math.max(e,n)),s.restore()}function Ps(s,t){return Math.abs(s[t*4]-210)>2||Math.abs(s[t*4+3]-.75*255)>2}function mu(){if(Os===void 0){const s=document.createElement("canvas").getContext("2d");s.globalCompositeOperation="lighter",s.fillStyle="rgba(210, 0, 0, 0.75)",Bo(s,4,5,4,0),Bo(s,4,5,0,5);const t=s.getImageData(0,0,3,3).data;Os=Ps(t,0)||Ps(t,4)||Ps(t,8)}return Os}function Ko(s,t,e,i){const n=Sr(e,t,s);let r=Ro(t,i,e);const o=t.getMetersPerUnit();o!==void 0&&(r*=o);const l=s.getMetersPerUnit();l!==void 0&&(r/=l);const h=s.getExtent();if(!h||rs(h,n)){const u=Ro(s,r,n)/r;isFinite(u)&&u>0&&(r/=u)}return r}function _u(s,t,e,i){const n=fi(e);let r=Ko(s,t,n,i);return(!isFinite(r)||r<=0)&&ra(e,function(o){return r=Ko(s,t,o,i),isFinite(r)&&r>0}),r}function yu(s,t,e,i,n,r,o,l,h,u,f,g){const p=le(Math.round(e*s),Math.round(e*t),Qa);if(g||(p.imageSmoothingEnabled=!1),h.length===0)return p.canvas;p.scale(e,e);function m(A){return Math.round(A*e)/e}p.globalCompositeOperation="lighter";const E=de();h.forEach(function(A,L,X){na(E,A.extent)});const x=Mt(E),v=Ce(E),C=le(Math.round(e*x/i),Math.round(e*v/i));g||(C.imageSmoothingEnabled=!1);const b=e/i;h.forEach(function(A,L,X){const K=A.extent[0]-E[0],S=-(A.extent[3]-E[3]),O=Mt(A.extent),N=Ce(A.extent);A.image.width>0&&A.image.height>0&&C.drawImage(A.image,u,u,A.image.width-2*u,A.image.height-2*u,K*b,S*b,O*b,N*b)});const P=wi(o);return l.getTriangles().forEach(function(A,L,X){const K=A.source,S=A.target;let O=K[0][0],N=K[0][1],z=K[1][0],U=K[1][1],Y=K[2][0],V=K[2][1];const B=m((S[0][0]-P[0])/r),M=m(-(S[0][1]-P[1])/r),F=m((S[1][0]-P[0])/r),$=m(-(S[1][1]-P[1])/r),lt=m((S[2][0]-P[0])/r),tt=m(-(S[2][1]-P[1])/r),ot=O,j=N;O=0,N=0,z-=ot,U-=j,Y-=ot,V-=j;const yt=[[z,U,0,0,F-B],[Y,V,0,0,lt-B],[0,0,z,U,$-M],[0,0,Y,V,tt-M]],et=$l(yt);if(et){if(p.save(),p.beginPath(),mu()||!g){p.moveTo(F,$);const ft=4,At=B-F,Et=M-$;for(let it=0;it<ft;it++)p.lineTo(F+m((it+1)*At/ft),$+m(it*Et/(ft-1))),it!=ft-1&&p.lineTo(F+m((it+1)*At/ft),$+m((it+1)*Et/(ft-1)));p.lineTo(lt,tt)}else p.moveTo(F,$),p.lineTo(B,M),p.lineTo(lt,tt);p.clip(),p.transform(et[0],et[2],et[1],et[3],B,M),p.translate(E[0]-ot,E[3]-j),p.scale(i/e,-i/e),p.drawImage(C.canvas,0,0),p.restore()}}),f&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,l.getTriangles().forEach(function(A,L,X){const K=A.target,S=(K[0][0]-P[0])/r,O=-(K[0][1]-P[1])/r,N=(K[1][0]-P[0])/r,z=-(K[1][1]-P[1])/r,U=(K[2][0]-P[0])/r,Y=-(K[2][1]-P[1])/r;p.beginPath(),p.moveTo(N,z),p.lineTo(S,O),p.lineTo(U,Y),p.closePath(),p.stroke()}),p.restore()),p.canvas}class ir extends Ha{constructor(t,e,i,n,r,o,l,h,u,f,g,p){super(r,at.IDLE,{interpolate:!!p}),this.renderEdges_=g!==void 0?g:!1,this.pixelRatio_=l,this.gutter_=h,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=o||r,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const m=n.getTileCoordExtent(this.wrappedTileCoord_),E=this.targetTileGrid_.getExtent();let x=this.sourceTileGrid_.getExtent();const v=E?Zi(m,E):m;if(Us(v)===0){this.state=at.EMPTY;return}const C=t.getExtent();C&&(x?x=Zi(x,C):x=C);const b=n.getResolution(this.wrappedTileCoord_[0]),P=_u(t,i,v,b);if(!isFinite(P)||P<=0){this.state=at.EMPTY;return}const A=f!==void 0?f:fu;if(this.triangulation_=new pu(t,i,v,x,P*A,b),this.triangulation_.getTriangles().length===0){this.state=at.EMPTY;return}this.sourceZ_=e.getZForResolution(P);let L=this.triangulation_.calculateSourceExtent();if(x&&(t.canWrapX()?(L[1]=Ut(L[1],x[1],x[3]),L[3]=Ut(L[3],x[1],x[3])):L=Zi(L,x)),!Us(L))this.state=at.EMPTY;else{const X=e.getTileRangeForExtentAndZ(L,this.sourceZ_);for(let K=X.minX;K<=X.maxX;K++)for(let S=X.minY;S<=X.maxY;S++){const O=u(this.sourceZ_,K,S,l);O&&this.sourceTiles_.push(O)}this.sourceTiles_.length===0&&(this.state=at.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach((function(e,i,n){e&&e.getState()==at.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}).bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=at.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),n=typeof i=="number"?i:i[0],r=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(e),l=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=yu(n,r,this.pixelRatio_,l,this.sourceTileGrid_.getExtent(),o,h,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=at.LOADED}this.changed()}load(){if(this.state==at.IDLE){this.state=at.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((function(e,i,n){const r=e.getState();if(r==at.IDLE||r==at.LOADING){t++;const o=xt(e,gt.CHANGE,function(l){const h=e.getState();(h==at.LOADED||h==at.ERROR||h==at.EMPTY)&&(Lt(o),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}).bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,i,n){e.getState()==at.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(Lt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(fa(this.canvas_.getContext("2d")),Qa.push(this.canvas_),this.canvas_=null),super.release()}}class Nr{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Ai(s,t,e,i,n){return n!==void 0?(n.minX=s,n.maxX=t,n.minY=e,n.maxY=i,n):new Nr(s,t,e,i)}class wu extends za{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=de(),this.tmpTileRange_=new Nr(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return i==at.LOADED||i==at.EMPTY||i==at.ERROR&&!n}getTile(t,e,i,n){const r=n.pixelRatio,o=n.viewState.projection,l=this.getLayer();let u=l.getSource().getTile(t,e,i,r,o);return u.getState()==at.ERROR&&l.getUseInterimTilesOnError()&&l.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(u)||(u=u.getInterimTile()),u}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),n=Bt(e.pixelToCoordinateTransform,t.slice()),r=i.getExtent();if(r&&!rs(r,n))return null;const o=e.pixelRatio,l=e.viewState.projection,h=e.viewState,u=i.getRenderSource(),f=u.getTileGridForProjection(h.projection),g=u.getTilePixelRatio(e.pixelRatio);for(let p=f.getZForResolution(h.resolution);p>=f.getMinZoom();--p){const m=f.getTileCoordForCoordAndZ(n,p),E=u.getTile(p,m[1],m[2],o,l);if(!(E instanceof Ja||E instanceof ir)||E instanceof ir&&E.getState()===at.EMPTY)return null;if(E.getState()!==at.LOADED)continue;const x=f.getOrigin(p),v=ae(f.getTileSize(p)),C=f.getResolution(p),b=Math.floor(g*((n[0]-x[0])/C-m[1]*v[0])),P=Math.floor(g*((x[1]-n[1])/C-m[2]*v[1])),A=Math.round(g*u.getGutterForProjection(h.projection));return this.getImageData(E.getImage(),b+A,P+A)}return null}loadedTileCallback(t,e,i){return this.isDrawableTile(i)?super.loadedTileCallback(t,e,i):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],n=t.viewState,r=n.projection,o=n.resolution,l=n.center,h=n.rotation,u=t.pixelRatio,f=this.getLayer(),g=f.getSource(),p=g.getRevision(),m=g.getTileGridForProjection(r),E=m.getZForResolution(o,g.zDirection),x=m.getResolution(E);let v=t.extent;const C=t.viewState.resolution,b=g.getTilePixelRatio(u),P=Math.round(Mt(v)/C*u),A=Math.round(Ce(v)/C*u),L=i.extent&&li(i.extent,r);L&&(v=Zi(v,li(i.extent,r)));const X=x*P/2/b,K=x*A/2/b,S=[l[0]-X,l[1]-K,l[0]+X,l[1]+K],O=m.getTileRangeForExtentAndZ(v,E),N={};N[E]={};const z=this.createLoadedTileFinder(g,r,N),U=this.tmpExtent,Y=this.tmpTileRange_;this.newTiles_=!1;const V=h?js(n.center,C,h,t.size):void 0;for(let yt=O.minX;yt<=O.maxX;++yt)for(let et=O.minY;et<=O.maxY;++et){if(h&&!m.tileCoordIntersectsViewport([E,yt,et],V))continue;const ft=this.getTile(E,yt,et,t);if(this.isDrawableTile(ft)){const it=St(this);if(ft.getState()==at.LOADED){N[E][ft.tileCoord.toString()]=ft;let k=ft.inTransition(it);k&&i.opacity!==1&&(ft.endTransition(it),k=!1),!this.newTiles_&&(k||!this.renderedTiles.includes(ft))&&(this.newTiles_=!0)}if(ft.getAlpha(it,t.time)===1)continue}const At=m.getTileCoordChildTileRange(ft.tileCoord,Y,U);let Et=!1;At&&(Et=z(E+1,At)),Et||m.forEachTileCoordParentTileRange(ft.tileCoord,z,Y,U)}const B=x/o*u/b;Qe(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/u,1/u,h,-P/2,-A/2);const M=wa(this.pixelTransform);this.useContainer(e,M,this.getBackground(t));const F=this.context,$=F.canvas;Er(this.inversePixelTransform,this.pixelTransform),Qe(this.tempTransform,P/2,A/2,B,B,0,-P/2,-A/2),$.width!=P||$.height!=A?($.width=P,$.height=A):this.containerReused||F.clearRect(0,0,P,A),L&&this.clipUnrotated(F,t,L),g.getInterpolate()||(F.imageSmoothingEnabled=!1),this.preRender(F,t),this.renderedTiles.length=0;let lt=Object.keys(N).map(Number);lt.sort(gi);let tt,ot,j;i.opacity===1&&(!this.containerReused||g.getOpaque(t.viewState.projection))?lt=lt.reverse():(tt=[],ot=[]);for(let yt=lt.length-1;yt>=0;--yt){const et=lt[yt],ft=g.getTilePixelSize(et,u,r),Et=m.getResolution(et)/x,it=ft[0]*Et*B,k=ft[1]*Et*B,W=m.getTileCoordForCoordAndZ(wi(S),et),Q=m.getTileCoordExtent(W),J=Bt(this.tempTransform,[b*(Q[0]-S[0])/x,b*(S[3]-Q[3])/x]),H=b*g.getGutterForProjection(r),st=N[et];for(const ut in st){const Rt=st[ut],bt=Rt.tileCoord,Tt=W[1]-bt[1],Xt=Math.round(J[0]-(Tt-1)*it),_t=W[2]-bt[2],Ot=Math.round(J[1]-(_t-1)*k),It=Math.round(J[0]-Tt*it),qt=Math.round(J[1]-_t*k),y=Xt-It,w=Ot-qt,T=E===et,D=T&&Rt.getAlpha(St(this),t.time)!==1;let Z=!1;if(!D)if(tt){j=[It,qt,It+y,qt,It+y,qt+w,It,qt+w];for(let dt=0,Dt=tt.length;dt<Dt;++dt)if(E!==et&&et<ot[dt]){const Pt=tt[dt];ne([It,qt,It+y,qt+w],[Pt[0],Pt[3],Pt[4],Pt[7]])&&(Z||(F.save(),Z=!0),F.beginPath(),F.moveTo(j[0],j[1]),F.lineTo(j[2],j[3]),F.lineTo(j[4],j[5]),F.lineTo(j[6],j[7]),F.moveTo(Pt[6],Pt[7]),F.lineTo(Pt[4],Pt[5]),F.lineTo(Pt[2],Pt[3]),F.lineTo(Pt[0],Pt[1]),F.clip())}tt.push(j),ot.push(et)}else F.clearRect(It,qt,y,w);this.drawTileImage(Rt,t,It,qt,y,w,H,T),tt&&!D?(Z&&F.restore(),this.renderedTiles.unshift(Rt)):this.renderedTiles.push(Rt),this.updateUsedTiles(t.usedTiles,g,Rt)}}return this.renderedRevision=p,this.renderedResolution=x,this.extentChanged=!this.renderedExtent_||!Ji(this.renderedExtent_,S),this.renderedExtent_=S,this.renderedPixelRatio=u,this.renderedProjection=r,this.manageTilePyramid(t,g,m,u,r,v,E,f.getPreload()),this.scheduleExpireCache(t,g),this.postRender(F,t),i.extent&&F.restore(),F.imageSmoothingEnabled=!0,M!==$.style.transform&&($.style.transform=M),this.container}drawTileImage(t,e,i,n,r,o,l,h){const u=this.getTileImage(t);if(!u)return;const f=St(this),g=e.layerStatesArray[e.layerIndex],p=g.opacity*(h?t.getAlpha(f,e.time):1),m=p!==this.context.globalAlpha;m&&(this.context.save(),this.context.globalAlpha=p),this.context.drawImage(u,l,l,u.width-2*l,u.height-2*l,i,n,r,o),m&&this.context.restore(),p!==g.opacity?e.animate=!0:h&&t.endTransition(f)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=(function(n,r,o){const l=St(n);l in o.usedTiles&&n.expireCache(o.viewState.projection,o.usedTiles[l])}).bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const n=St(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}manageTilePyramid(t,e,i,n,r,o,l,h,u){const f=St(e);f in t.wantedTiles||(t.wantedTiles[f]={});const g=t.wantedTiles[f],p=t.tileQueue,m=i.getMinZoom(),E=t.viewState.rotation,x=E?js(t.viewState.center,t.viewState.resolution,E,t.size):void 0;let v=0,C,b,P,A,L,X;for(X=m;X<=l;++X)for(b=i.getTileRangeForExtentAndZ(o,X,b),P=i.getResolution(X),A=b.minX;A<=b.maxX;++A)for(L=b.minY;L<=b.maxY;++L)E&&!i.tileCoordIntersectsViewport([X,A,L],x)||(l-X<=h?(++v,C=e.getTile(X,A,L,n,r),C.getState()==at.IDLE&&(g[C.getKey()]=!0,p.isKeyQueued(C.getKey())||p.enqueue([C,f,i.getTileCoordCenter(C.tileCoord),P])),u!==void 0&&u(C)):e.useTile(X,A,L,r));e.updateCacheSize(v,r)}}const jn={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class Eu{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return mt(i!==void 0,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return mt(e!==void 0,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){mt(!(t in this.entries_),16);const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}function qo(s,t,e,i){return i!==void 0?(i[0]=s,i[1]=t,i[2]=e,i):[s,t,e]}function vs(s,t,e){return s+"/"+t+"/"+e}function tl(s){return vs(s[0],s[1],s[2])}function vu(s){return s.split("/").map(Number)}function xu(s){return(s[1]<<s[0])+s[2]}function Ru(s,t){const e=s[0],i=s[1],n=s[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const r=t.getFullTileRange(e);return r?r.containsXY(i,n):!0}class el extends Eu{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),i=vu(t)[0];this.forEach((function(n){n.tileCoord[0]!==i&&(this.remove(tl(n.tileCoord)),n.release())}).bind(this))}}const Su=42,Fr=256,Cu=[0,0,0],ze=5;class Tu{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,mt(oh(this.resolutions_,function(n,r){return r-n},!0),17);let e;if(!t.origins){for(let n=0,r=this.resolutions_.length-1;n<r;++n)if(!e)e=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,mt(this.origins_.length==this.resolutions_.length,20));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=wi(i)),mt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,mt(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Fr,mt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map(function(n,r){const o=new Nr(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const l=this.getTileRangeForExtentAndZ(i,r);o.minX=Math.max(l.minX,o.minX),o.maxX=Math.min(l.maxX,o.maxX),o.minY=Math.max(l.minY,o.minY),o.maxY=Math.min(l.maxY,o.maxY)}return o},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const n=this.getTileRangeForExtentAndZ(t,e);for(let r=n.minX,o=n.maxX;r<=o;++r)for(let l=n.minY,h=n.maxY;l<=h;++l)i([e,r,l])}forEachTileCoordParentTileRange(t,e,i,n){let r,o,l,h=null,u=t[0]-1;for(this.zoomFactor_===2?(o=t[1],l=t[2]):h=this.getTileCoordExtent(t,n);u>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),l=Math.floor(l/2),r=Ai(o,o,l,l,i)):r=this.getTileRangeForExtentAndZ(h,u,i),e(u,r))return!0;--u}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const r=t[1]*2,o=t[2]*2;return Ai(r,r+1,o,o+1,e)}const n=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const n=t[0],r=t[1],o=t[2];if(e===n)return Ai(r,o,r,o,i);if(this.zoomFactor_){const h=Math.pow(this.zoomFactor_,e-n),u=Math.floor(r*h),f=Math.floor(o*h);if(e<n)return Ai(u,u,f,f,i);const g=Math.floor(h*(r+1))-1,p=Math.floor(h*(o+1))-1;return Ai(u,g,f,p,i)}const l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,e,i)}getTileRangeExtent(t,e,i){const n=this.getOrigin(t),r=this.getResolution(t),o=ae(this.getTileSize(t),this.tmpSize_),l=n[0]+e.minX*o[0]*r,h=n[0]+(e.maxX+1)*o[0]*r,u=n[1]+e.minY*o[1]*r,f=n[1]+(e.maxY+1)*o[1]*r;return Se(l,u,h,f,i)}getTileRangeForExtentAndZ(t,e,i){const n=Cu;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);const r=n[1],o=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),Ai(r,n[1],o,n[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=ae(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),r=ae(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*r[0]*n,l=i[1]-(t[2]+1)*r[1]*n,h=o+r[0]*n,u=l+r[1]*n;return Se(o,l,h,u,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,n,r){const o=this.getZForResolution(i),l=i/this.getResolution(o),h=this.getOrigin(o),u=ae(this.getTileSize(o),this.tmpSize_);let f=l*(t-h[0])/i/u[0],g=l*(h[1]-e)/i/u[1];return n?(f=Dn(f,ze)-1,g=Dn(g,ze)-1):(f=Ln(f,ze),g=Ln(g,ze)),qo(o,f,g,r)}getTileCoordForXYAndZ_(t,e,i,n,r){const o=this.getOrigin(i),l=this.getResolution(i),h=ae(this.getTileSize(i),this.tmpSize_);let u=(t-o[0])/l/h[0],f=(o[1]-e)/l/h[1];return n?(u=Dn(u,ze)-1,f=Dn(f,ze)-1):(u=Ln(u,ze),f=Ln(f,ze)),qo(i,u,f,r)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=fr(this.resolutions_,t,e||0);return Ut(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return Ma(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let n=this.minZoom;n<e;++n)i[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=i}}const il=Tu,Ms={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function nl(s){let t=s.getDefaultTileGrid();return t||(t=Ou(s),s.setDefaultTileGrid(t)),t}function bu(s,t,e){const i=t[0],n=s.getTileCoordCenter(t),r=kr(e);if(rs(r,n))return t;{const o=Mt(r),l=Math.ceil((r[0]-n[0])/o);return n[0]+=o*l,s.getTileCoordForCoordAndZ(n,i)}}function Iu(s,t,e,i){i=i!==void 0?i:"top-left";const n=sl(s,t,e);return new il({extent:s,origin:Dl(s,i),resolutions:n,tileSize:e})}function Au(s){const t=s||{},e=t.extent||Gt("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:sl(e,t.maxZoom,t.tileSize,t.maxResolution)};return new il(i)}function sl(s,t,e,i){t=t!==void 0?t:Su,e=ae(e!==void 0?e:Fr);const n=Ce(s),r=Mt(s);i=i>0?i:Math.max(r/e[0],n/e[1]);const o=t+1,l=new Array(o);for(let h=0;h<o;++h)l[h]=i/Math.pow(2,h);return l}function Ou(s,t,e,i){const n=kr(s);return Iu(n,t,e,i)}function kr(s){s=Gt(s);let t=s.getExtent();if(!t){const e=180*mi.degrees/s.getMetersPerUnit();t=Se(-e,-e,e,e)}return t}class Pu extends Ba{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&ae(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new el(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,n){const r=this.getTileCacheForProjection(t);if(!r)return!1;let o=!0,l,h,u;for(let f=i.minX;f<=i.maxX;++f)for(let g=i.minY;g<=i.maxY;++g)h=vs(e,f,g),u=!1,r.containsKey(h)&&(l=r.get(h),u=l.getState()===at.LOADED,u&&(u=n(l)!==!1)),u||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(t,e,i,n,r){return ct()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:nl(t)}getTileCacheForProjection(t){const e=this.getProjection();return mt(e===null||oi(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const n=this.getTileGridForProjection(i),r=this.getTilePixelRatio(e),o=ae(n.getTileSize(t),this.tmpSize);return r==1?o:Wl(o,r,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=bu(i,t,e)),Ru(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,n){}}class Mu extends Ne{constructor(t,e){super(t),this.tile=e}}function Lu(s,t){const e=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,r=/\{-y\}/g;return function(o,l,h){if(o)return s.replace(e,o[0].toString()).replace(i,o[1].toString()).replace(n,o[2].toString()).replace(r,function(){const u=o[0],f=t.getFullTileRange(u);return mt(f,55),(f.getHeight()-o[2]-1).toString()})}}function Du(s,t){const e=s.length,i=new Array(e);for(let n=0;n<e;++n)i[n]=Lu(s[n],t);return Nu(i)}function Nu(s){return s.length===1?s[0]:function(t,e,i){if(t){const n=xu(t),r=Fi(n,s.length);return s[r](t,e,i)}else return}}function Fu(s){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(s);if(e){const i=e[1].charCodeAt(0),n=e[2].charCodeAt(0);let r;for(r=i;r<=n;++r)t.push(s.replace(e[0],String.fromCharCode(r)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(s),e){const i=parseInt(e[2],10);for(let n=parseInt(e[1],10);n<=i;n++)t.push(s.replace(e[0],n.toString()));return t}return t.push(s),t}class Gr extends Pu{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Gr.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=St(e),n=e.getState();let r;n==at.LOADING?(this.tileLoadingKeys_[i]=!0,r=Ms.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],r=n==at.ERROR?Ms.TILELOADERROR:n==at.LOADED?Ms.TILELOADEND:void 0),r!=null&&this.dispatchEvent(new Mu(r,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=Fu(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Du(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const n=vs(t,e,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}class ku extends hu{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Yn(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Yn(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return ct()}readFeaturesFromObject(t,e){return ct()}readGeometry(t,e){return this.readGeometryFromObject(Yn(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return ct()}readProjection(t){return this.readProjectionFromObject(Yn(t))}readProjectionFromObject(t){return ct()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return ct()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return ct()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return ct()}}function Yn(s){if(typeof s=="string"){const t=JSON.parse(s);return t||null}else return s!==null?s:null}class Gu extends ku{constructor(t){t=t||{},super(),this.dataProjection=Gt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=Gt(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const n=nr(i.geometry,e),r=new yn;return this.geometryName_?r.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&r.setGeometryName(i.geometry_name),r.setGeometry(n),"id"in i&&r.setId(i.id),i.properties&&r.setProperties(i.properties,!0),r}readFeaturesFromObject(t,e){const i=t;let n=null;if(i.type==="FeatureCollection"){const r=t;n=[];const o=r.features;for(let l=0,h=o.length;l<h;++l)n.push(this.readFeatureFromObject(o[l],e))}else n=[this.readFeatureFromObject(t,e)];return n}readGeometryFromObject(t,e){return nr(t,e)}readProjectionFromObject(t){const e=t.crs;let i;return e?e.type=="name"?i=Gt(e.properties.name):e.type==="EPSG"?i=Gt("EPSG:"+e.properties.code):mt(!1,36):i=this.dataProjection,i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},n=t.getId();if(n!==void 0&&(i.id=n),!t.hasProperties())return i;const r=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=sr(o,e),delete r[t.getGeometryName()]),Xi(r)||(i.properties=r),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let n=0,r=t.length;n<r;++n)i.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return sr(t,this.adaptOptions(e))}}function nr(s,t){if(!s)return null;let e;switch(s.type){case"Point":{e=Xu(s);break}case"LineString":{e=ju(s);break}case"Polygon":{e=$u(s);break}case"MultiPoint":{e=Wu(s);break}case"MultiLineString":{e=Yu(s);break}case"MultiPolygon":{e=zu(s);break}case"GeometryCollection":{e=Uu(s);break}default:throw new Error("Unsupported GeoJSON type: "+s.type)}return qa(e,!1,t)}function Uu(s,t){const e=s.geometries.map(function(i){return nr(i,t)});return new Qh(e)}function Xu(s){return new _i(s.coordinates)}function ju(s){return new Qs(s.coordinates)}function Yu(s){return new uc(s.coordinates)}function Wu(s){return new Na(s.coordinates)}function zu(s){return new mc(s.coordinates)}function $u(s){return new ti(s.coordinates)}function sr(s,t){s=qa(s,!0,t);const e=s.getType();let i;switch(e){case"Point":{i=Hu(s);break}case"LineString":{i=Bu(s);break}case"Polygon":{i=Ju(s,t);break}case"MultiPoint":{i=qu(s);break}case"MultiLineString":{i=Ku(s);break}case"MultiPolygon":{i=Zu(s,t);break}case"GeometryCollection":{i=Vu(s,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function Vu(s,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:s.getGeometriesArray().map(function(i){return sr(i,t)})}}function Bu(s,t){return{type:"LineString",coordinates:s.getCoordinates()}}function Ku(s,t){return{type:"MultiLineString",coordinates:s.getCoordinates()}}function qu(s,t){return{type:"MultiPoint",coordinates:s.getCoordinates()}}function Zu(s,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:s.getCoordinates(e)}}function Hu(s,t){return{type:"Point",coordinates:s.getCoordinates()}}function Ju(s,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:s.getCoordinates(e)}}class Qu extends dr{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){ct()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;Qe(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),Er(n,i)}forEachFeatureAtCoordinate(t,e,i,n,r,o,l,h){let u;const f=e.viewState;function g(A,L,X,K){return r.call(o,L,A?X:null,K)}const p=f.projection,m=va(t.slice(),p),E=[[0,0]];if(p.canWrapX()&&n){const A=p.getExtent(),L=Mt(A);E.push([-L,0],[L,0])}const x=e.layerStatesArray,v=x.length,C=[],b=[];for(let A=0;A<E.length;A++)for(let L=v-1;L>=0;--L){const X=x[L],K=X.layer;if(K.hasRenderer()&&Lr(X,f)&&l.call(h,K)){const S=K.getRenderer(),O=K.getSource();if(S&&O){const N=O.getWrapX()?m:t,z=g.bind(null,X.managed);b[0]=N[0]+E[A][0],b[1]=N[1]+E[A][1],u=S.forEachFeatureAtCoordinate(b,e,i,z,C)}if(u)return u}}if(C.length===0)return;const P=1/C.length;return C.forEach((A,L)=>A.distanceSq+=L*P),C.sort((A,L)=>A.distanceSq-L.distanceSq),C.some(A=>u=A.callback(A.feature,A.layer,A.geometry)),u}hasFeatureAtCoordinate(t,e,i,n,r,o){return this.forEachFeatureAtCoordinate(t,e,i,n,Qi,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(t){ct()}scheduleExpireIconCache(t){Hn.canExpireCache()&&t.postRenderFunctions.push(td)}}function td(s,t){Hn.expire()}class ed extends Qu{constructor(t){super(t),this.fontChangeListenerKey_=xt(Oe,Ui.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=fs+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const n=new Wa(t,void 0,e);i.dispatchEvent(n)}}disposeInternal(){Lt(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(He.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(o,l){return o.zIndex-l.zIndex}),i=t.viewState;this.children_.length=0;const n=[];let r=null;for(let o=0,l=e.length;o<l;++o){const h=e[o];t.layerIndex=o;const u=h.layer,f=u.getSourceState();if(!Lr(h,i)||f!="ready"&&f!="undefined"){u.unrender();continue}const g=u.render(t,r);g&&(g!==r&&(this.children_.push(g),r=g),"getDeclutter"in u&&n.push(u))}for(let o=n.length-1;o>=0;--o)n[o].renderDeclutter(t);nh(this.element_,this.children_),this.dispatchRenderEvent(He.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}}class Li extends Ne{constructor(t,e,i){super(t),this.map=e,this.frameState=i!==void 0?i:null}}class $e extends Li{constructor(t,e,i,n,r,o){super(t,e,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const kt={SINGLECLICK:"singleclick",CLICK:gt.CLICK,DBLCLICK:gt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},rr={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class id extends ds{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=xt(i,rr.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=xt(i,rr.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(gt.TOUCHMOVE,this.boundHandleTouchMove_,da?{passive:!1}:!1)}emulateClick_(t){let e=new $e(kt.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new $e(kt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout((function(){this.clickTimeoutId_=void 0;const i=new $e(kt.SINGLECLICK,this.map_,t);this.dispatchEvent(i)}).bind(this),250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==kt.POINTERUP||e.type==kt.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==e.target){delete this.trackedTouches_[n];break}}else(e.type==kt.POINTERDOWN||e.type==kt.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new $e(kt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(Lt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new $e(kt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.down_={};for(const i in t){const n=t[i];this.down_[i]=typeof n=="function"?pi:n}if(this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(xt(i,kt.POINTERMOVE,this.handlePointerMove_,this),xt(i,kt.POINTERUP,this.handlePointerUp_,this),xt(this.element_,kt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(xt(this.element_.getRootNode(),kt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new $e(kt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new $e(kt.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(Lt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(gt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(Lt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(Lt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const Ve={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},Jt={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},ss=1/0;class nd{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,gn(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(t){mt(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=ss?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,n=e.length,r=e[t],o=i[t],l=t;for(;t<n>>1;){const h=this.getLeftChildIndex_(t),u=this.getRightChildIndex_(t),f=u<n&&i[u]<i[h]?u:h;e[t]=e[f],i[t]=i[f],t=f}e[t]=r,i[t]=o,this.siftDown_(l,t)}siftDown_(t,e){const i=this.elements_,n=this.priorities_,r=i[e],o=n[e];for(;e>t;){const l=this.getParentIndex_(e);if(n[l]>o)i[e]=i[l],n[e]=n[l],e=l;else break}i[e]=r,n[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let n=0;const r=e.length;let o,l,h;for(l=0;l<r;++l)o=e[l],h=t(o),h==ss?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=h,e[n++]=o);e.length=n,i.length=n,this.heapify_()}}class sd extends nd{constructor(t,e){super(function(i){return t.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(gt.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===at.LOADED||i===at.ERROR||i===at.EMPTY){i!==at.ERROR&&e.removeEventListener(gt.CHANGE,this.boundHandleTileChange_);const n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i=0,n,r,o;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;)r=this.dequeue()[0],o=r.getKey(),n=r.getState(),n===at.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,r.load())}}function rd(s,t,e,i,n){if(!s||!(e in s.wantedTiles)||!s.wantedTiles[e][t.getKey()])return ss;const r=s.viewState.center,o=i[0]-r[0],l=i[1]-r[1];return 65536*Math.log(n)+Math.sqrt(o*o+l*l)/n}const _e={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Zo(s,t,e){return function(i,n,r,o,l){if(!i)return;if(!n&&!t)return i;const h=t?0:r[0]*n,u=t?0:r[1]*n,f=l?l[0]:0,g=l?l[1]:0;let p=s[0]+h/2+f,m=s[2]-h/2+f,E=s[1]+u/2+g,x=s[3]-u/2+g;p>m&&(p=(m+p)/2,m=p),E>x&&(E=(x+E)/2,x=E);let v=Ut(i[0],p,m),C=Ut(i[1],E,x);if(o&&e&&n){const b=30*n;v+=-b*Math.log(1+Math.max(0,p-i[0])/b)+b*Math.log(1+Math.max(0,i[0]-m)/b),C+=-b*Math.log(1+Math.max(0,E-i[1])/b)+b*Math.log(1+Math.max(0,i[1]-x)/b)}return[v,C]}}function od(s){return s}function Ur(s,t,e,i){const n=Mt(t)/e[0],r=Ce(t)/e[1];return i?Math.min(s,Math.max(n,r)):Math.min(s,Math.min(n,r))}function Xr(s,t,e){let i=Math.min(s,t);const n=50;return i*=Math.log(1+n*Math.max(0,s/t-1))/n+1,e&&(i=Math.max(i,e),i/=Math.log(1+n*Math.max(0,e/s-1))/n+1),Ut(i,e/2,t*2)}function ad(s,t,e,i){return t=t!==void 0?t:!0,function(n,r,o,l){if(n!==void 0){const h=s[0],u=s[s.length-1],f=e?Ur(h,e,o,i):h;if(l)return t?Xr(n,f,u):Ut(n,u,f);const g=Math.min(f,n),p=Math.floor(fr(s,g,r));return s[p]>f&&p<s.length-1?s[p+1]:s[p]}else return}}function ld(s,t,e,i,n,r){return i=i!==void 0?i:!0,e=e!==void 0?e:0,function(o,l,h,u){if(o!==void 0){const f=n?Ur(t,n,h,r):t;if(u)return i?Xr(o,f,e):Ut(o,e,f);const g=1e-9,p=Math.ceil(Math.log(t/f)/Math.log(s)-g),m=-l*(.5-g)+.5,E=Math.min(f,o),x=Math.floor(Math.log(t/E)/Math.log(s)+m),v=Math.max(p,x),C=t/Math.pow(s,v);return Ut(C,e,f)}else return}}function Ho(s,t,e,i,n){return e=e!==void 0?e:!0,function(r,o,l,h){if(r!==void 0){const u=i?Ur(s,i,l,n):s;return!e||!h?Ut(r,t,u):Xr(r,u,t)}else return}}function jr(s){if(s!==void 0)return 0}function Jo(s){if(s!==void 0)return s}function hd(s){const t=2*Math.PI/s;return function(e,i){if(i)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function cd(s){return s=s||$n(5),function(t,e){if(e)return t;if(t!==void 0)return Math.abs(t)<=s?0:t}}const Ls=0;class ud extends Te{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Rr(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Uh(),t.center&&(t.center=Pe(t.center,this.projection_)),t.extent&&(t.extent=li(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const l in _e)delete e[l];this.setProperties(e,!0);const i=fd(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const n=dd(t),r=i.constraint,o=gd(t);this.constraints_={center:n,resolution:r,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenter();if(i){const n=t||[0,0,0,0];e=e||[0,0,0,0];const r=this.getResolution(),o=r/2*(n[3]-e[3]+e[1]-n[1]),l=r/2*(n[0]-e[0]+e[2]-n[2]);this.setCenterInternal([i[0]+o,i[1]-l])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=Pe(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=Pe(n.anchor,this.getProjection())),e[i]=n}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,i;e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e);let n=0;for(;n<e&&!this.isDef();++n){const f=arguments[n];f.center&&this.setCenterInternal(f.center),f.zoom!==void 0?this.setZoom(f.zoom):f.resolution&&this.setResolution(f.resolution),f.rotation!==void 0&&this.setRotation(f.rotation)}if(n===e){i&&Wn(i,!0);return}let r=Date.now(),o=this.targetCenter_.slice(),l=this.targetResolution_,h=this.targetRotation_;const u=[];for(;n<e;++n){const f=arguments[n],g={start:r,complete:!1,anchor:f.anchor,duration:f.duration!==void 0?f.duration:1e3,easing:f.easing||cu,callback:i};if(f.center&&(g.sourceCenter=o,g.targetCenter=f.center.slice(),o=g.targetCenter),f.zoom!==void 0?(g.sourceResolution=l,g.targetResolution=this.getResolutionForZoom(f.zoom),l=g.targetResolution):f.resolution&&(g.sourceResolution=l,g.targetResolution=f.resolution,l=g.targetResolution),f.rotation!==void 0){g.sourceRotation=h;const p=Fi(f.rotation-h+Math.PI,2*Math.PI)-Math.PI;g.targetRotation=h+p,h=g.targetRotation}pd(g)?g.complete=!0:r+=g.duration,u.push(g)}this.animations_.push(u),this.setHint(Qt.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[Qt.ANIMATING]>0}getInteracting(){return this.hints_[Qt.INTERACTING]>0}cancelAnimations(){this.setHint(Qt.ANIMATING,-this.hints_[Qt.ANIMATING]);let t;for(let e=0,i=this.animations_.length;e<i;++e){const n=this.animations_[e];if(n[0].callback&&Wn(n[0].callback,!1),!t)for(let r=0,o=n.length;r<o;++r){const l=n[r];if(!l.complete){t=l.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let r=!0;for(let o=0,l=n.length;o<l;++o){const h=n[o];if(h.complete)continue;const u=t-h.start;let f=h.duration>0?u/h.duration:1;f>=1?(h.complete=!0,f=1):r=!1;const g=h.easing(f);if(h.sourceCenter){const p=h.sourceCenter[0],m=h.sourceCenter[1],E=h.targetCenter[0],x=h.targetCenter[1];this.nextCenter_=h.targetCenter;const v=p+g*(E-p),C=m+g*(x-m);this.targetCenter_=[v,C]}if(h.sourceResolution&&h.targetResolution){const p=g===1?h.targetResolution:h.sourceResolution+g*(h.targetResolution-h.sourceResolution);if(h.anchor){const m=this.getViewportSize_(this.getRotation()),E=this.constraints_.resolution(p,0,m,!0);this.targetCenter_=this.calculateCenterZoom(E,h.anchor)}this.nextResolution_=h.targetResolution,this.targetResolution_=p,this.applyTargetState_(!0)}if(h.sourceRotation!==void 0&&h.targetRotation!==void 0){const p=g===1?Fi(h.targetRotation+Math.PI,2*Math.PI)-Math.PI:h.sourceRotation+g*(h.targetRotation-h.sourceRotation);if(h.anchor){const m=this.constraints_.rotation(p,!0);this.targetCenter_=this.calculateCenterRotate(m,h.anchor)}this.nextRotation_=h.targetRotation,this.targetRotation_=p}if(this.applyTargetState_(!0),e=!0,!h.complete)break}if(r){this.animations_[i]=null,this.setHint(Qt.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&Wn(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const n=this.getCenterInternal();return n!==void 0&&(i=[n[0]-e[0],n[1]-e[1]],vr(i,t-this.getRotation()),Nh(i,e)),i}calculateCenterZoom(t,e){let i;const n=this.getCenterInternal(),r=this.getResolution();if(n!==void 0&&r!==void 0){const o=e[0]-t*(e[0]-n[0])/r,l=e[1]-t*(e[1]-n[1])/r;i=[o,l]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],n=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(n*Math.cos(t))]}else return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&qs(t,this.getProjection())}getCenterInternal(){return this.get(_e.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return Zs(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();mt(e,1);const i=this.getResolution();mt(i!==void 0,2);const n=this.getRotation();return mt(n!==void 0,3),Xs(e,i,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(_e.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(li(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=Mt(t)/e[0],n=Ce(t)/e[1];return Math.max(i,n)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(e/i)/Math.log(t);return function(r){return e/Math.pow(t,r*n)}}getRotation(){return this.get(_e.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,r=Math.log(i/n)/e;return function(o){return Math.log(i/o)/e/r}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const r=this.padding_;if(r){const o=this.getViewportSizeMinusPadding_();n=Ds(n,this.getViewportSize_(),[o[0]/2+r[3],o[1]/2+r[0]],e,i)}return{center:n.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,i,n;if(this.resolutions_){const r=fr(this.resolutions_,t,1);e=r,i=this.resolutions_[r],r==this.resolutions_.length-1?n=2:n=i/this.resolutions_[r+1]}else i=this.maxResolution_,n=this.zoomFactor_;return e+Math.log(i/t)/Math.log(n)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=Ut(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(i,Ut(t-e,0,1))}else return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(mt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function",24),Array.isArray(t)){mt(!hr(t),25);const n=li(t,this.getProjection());i=Oo(n)}else if(t.getType()==="Circle"){const n=li(t.getExtent(),this.getProjection());i=Oo(n),i.rotate(this.getRotation(),fi(n))}else{const n=Sa();n?i=t.clone().transform(n,this.getProjection()):i=t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),n=Math.sin(-e),r=t.getFlatCoordinates(),o=t.getStride();let l=1/0,h=1/0,u=-1/0,f=-1/0;for(let g=0,p=r.length;g<p;g+=o){const m=r[g]*i-r[g+1]*n,E=r[g]*n+r[g+1]*i;l=Math.min(l,m),h=Math.min(h,E),u=Math.max(u,m),f=Math.max(f,E)}return[l,h,u,f]}fitInternal(t,e){e=e||{};let i=e.size;i||(i=this.getViewportSizeMinusPadding_());const n=e.padding!==void 0?e.padding:[0,0,0,0],r=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const l=this.rotatedExtentForGeometry(t);let h=this.getResolutionForExtentInternal(l,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);h=isNaN(h)?o:Math.max(h,o),h=this.getConstrainedResolution(h,r?0:1);const u=this.getRotation(),f=Math.sin(u),g=Math.cos(u),p=fi(l);p[0]+=(n[1]-n[3])/2*h,p[1]+=(n[0]-n[2])/2*h;const m=p[0]*g-p[1]*f,E=p[1]*g+p[0]*f,x=this.getConstrainedCenter([m,E],h),v=e.callback?e.callback:pi;e.duration!==void 0?this.animateInternal({resolution:h,center:x,duration:e.duration,easing:e.easing},v):(this.targetResolution_=h,this.targetCenter_=x,this.applyTargetState_(!1,!0),Wn(v,!0))}centerOn(t,e,i){this.centerOnInternal(Pe(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(Ds(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,n){let r;const o=this.padding_;if(o&&t){const l=this.getViewportSizeMinusPadding_(-i),h=Ds(t,n,[l[0]/2+o[3],l[1]/2+o[0]],e,i);r=[t[0]-h[0],t[1]-h[1]]}return r}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=qs(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Pe(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),r=this.constraints_.resolution(this.targetResolution_*t,0,n,i);e&&(this.targetCenter_=this.calculateCenterZoom(r,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Pe(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Pe(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,i),r=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,r,i),l=this.constraints_.center(this.targetCenter_,o,r,i,this.calculateCenterShift(this.targetCenter_,o,n,r));this.get(_e.ROTATION)!==n&&this.set(_e.ROTATION,n),this.get(_e.RESOLUTION)!==o&&(this.set(_e.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!l||!this.get(_e.CENTER)||!Qn(this.get(_e.CENTER),l))&&this.set(_e.CENTER,l),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=t!==void 0?t:200;const n=e||0,r=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(r),l=this.constraints_.resolution(this.targetResolution_,n,o),h=this.constraints_.center(this.targetCenter_,l,o,!1,this.calculateCenterShift(this.targetCenter_,l,r,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=l,this.targetRotation_=r,this.targetCenter_=h,this.applyTargetState_();return}i=i||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==l||this.getRotation()!==r||!this.getCenterInternal()||!Qn(this.getCenterInternal(),h))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:r,center:h,resolution:l,duration:t,easing:Wi,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(Qt.INTERACTING,1)}endInteraction(t,e,i){i=i&&Pe(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.setHint(Qt.INTERACTING,-1),this.resolveConstraints(t,e,i)}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}}function Wn(s,t){setTimeout(function(){s(t)},0)}function dd(s){if(s.extent!==void 0){const e=s.smoothExtentConstraint!==void 0?s.smoothExtentConstraint:!0;return Zo(s.extent,s.constrainOnlyCenter,e)}const t=Rr(s.projection,"EPSG:3857");if(s.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Zo(e,!1,!1)}return od}function fd(s){let t,e,i,o=s.minZoom!==void 0?s.minZoom:Ls,l=s.maxZoom!==void 0?s.maxZoom:28;const h=s.zoomFactor!==void 0?s.zoomFactor:2,u=s.multiWorld!==void 0?s.multiWorld:!1,f=s.smoothResolutionConstraint!==void 0?s.smoothResolutionConstraint:!0,g=s.showFullExtent!==void 0?s.showFullExtent:!1,p=Rr(s.projection,"EPSG:3857"),m=p.getExtent();let E=s.constrainOnlyCenter,x=s.extent;if(!u&&!x&&p.isGlobal()&&(E=!1,x=m),s.resolutions!==void 0){const v=s.resolutions;e=v[o],i=v[l]!==void 0?v[l]:v[v.length-1],s.constrainResolution?t=ad(v,f,!E&&x,g):t=Ho(e,i,f,!E&&x,g)}else{const C=(m?Math.max(Mt(m),Ce(m)):360*mi.degrees/p.getMetersPerUnit())/Fr/Math.pow(2,Ls),b=C/Math.pow(2,28-Ls);e=s.maxResolution,e!==void 0?o=0:e=C/Math.pow(h,o),i=s.minResolution,i===void 0&&(s.maxZoom!==void 0?s.maxResolution!==void 0?i=e/Math.pow(h,l):i=C/Math.pow(h,l):i=b),l=o+Math.floor(Math.log(e/i)/Math.log(h)),i=e/Math.pow(h,l-o),s.constrainResolution?t=ld(h,e,i,f,!E&&x,g):t=Ho(e,i,f,!E&&x,g)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:o,zoomFactor:h}}function gd(s){if(s.enableRotation!==void 0?s.enableRotation:!0){const e=s.constrainRotation;return e===void 0||e===!0?cd():e===!1?Jo:typeof e=="number"?hd(e):Jo}else return jr}function pd(s){return!(s.sourceCenter&&s.targetCenter&&!Qn(s.sourceCenter,s.targetCenter)||s.sourceResolution!==s.targetResolution||s.sourceRotation!==s.targetRotation)}function Ds(s,t,e,i,n){const r=Math.cos(-n);let o=Math.sin(-n),l=s[0]*r-s[1]*o,h=s[1]*r+s[0]*o;l+=(t[0]/2-e[0])*i,h+=(e[1]-t[1]/2)*i,o=-o;const u=l*r-h*o,f=h*r+l*o;return[u,f]}const Ke=ud;class Yr extends Te{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){zs(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&zs(this.element);for(let e=0,i=this.listenerKeys.length;e<i;++e)Lt(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==pi&&this.listenerKeys.push(xt(t,Ve.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class md extends Yr{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",i=t.tipLabel!==void 0?t.tipLabel:"Attributions",n=t.expandClassName!==void 0?t.expandClassName:e+"-expand",r=t.collapseLabel!==void 0?t.collapseLabel:"›",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const l=t.label!==void 0?t.label:"i";typeof l=="string"?(this.label_=document.createElement("span"),this.label_.textContent=l,this.label_.className=n):this.label_=l;const h=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(h),this.toggleButton_.addEventListener(gt.CLICK,this.handleClick_.bind(this),!1);const u=e+" "+fs+" "+gr+(this.collapsed_&&this.collapsible_?" "+fo:"")+(this.collapsible_?"":" ol-uncollapsible"),f=this.element;f.className=u,f.appendChild(this.toggleButton_),f.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e={},i=[];let n=!0;const r=t.layerStatesArray;for(let o=0,l=r.length;o<l;++o){const h=r[o];if(!Lr(h,t.viewState))continue;const u=h.layer.getSource();if(!u)continue;const f=u.getAttributions();if(!f)continue;const g=f(t);if(g)if(n=n&&u.getAttributionsCollapsible()!==!1,Array.isArray(g))for(let p=0,m=g.length;p<m;++p)g[p]in e||(i.push(g[p]),e[g[p]]=!0);else g in e||(i.push(g),e[g]=!0)}return this.overrideCollapsible_||this.setCollapsible(n),i}updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Ei(e,this.renderedAttributions_)){ih(this.ulElement_);for(let n=0,r=e.length;n<r;++n){const o=document.createElement("li");o.innerHTML=e[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(fo),this.collapsed_?co(this.collapseLabel_,this.label_):co(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}const _d=md;class yd extends Yr{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",i=t.label!==void 0?t.label:"⇧",n=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const r=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(gt.CLICK,this.handleClick_.bind(this),!1);const l=e+" "+fs+" "+gr,h=this.element;h.className=l,h.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Nn)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:Wi}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Nn);!r&&i===0?this.element.classList.add(Nn):r&&i!==0&&this.element.classList.remove(Nn)}this.label_.style.transform=n}this.rotation_=i}}const wd=yd;class Ed extends Yr{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",i=t.delta!==void 0?t.delta:1,n=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",r=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",l=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",h=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",u=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",f=document.createElement("button");f.className=n,f.setAttribute("type","button"),f.title=h,f.appendChild(typeof o=="string"?document.createTextNode(o):o),f.addEventListener(gt.CLICK,this.handleClick_.bind(this,i),!1);const g=document.createElement("button");g.className=r,g.setAttribute("type","button"),g.title=u,g.appendChild(typeof l=="string"?document.createTextNode(l):l),g.addEventListener(gt.CLICK,this.handleClick_.bind(this,-i),!1);const p=e+" "+fs+" "+gr,m=this.element;m.className=p,m.appendChild(f),m.appendChild(g),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(n!==void 0){const r=i.getConstrainedZoom(n+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:Wi})):i.setZoom(r)}}}const vd=Ed;function xd(s){s=s||{};const t=new xe;return(s.zoom!==void 0?s.zoom:!0)&&t.push(new vd(s.zoomOptions)),(s.rotate!==void 0?s.rotate:!0)&&t.push(new wd(s.rotateOptions)),(s.attribution!==void 0?s.attribution:!0)&&t.push(new _d(s.attributionOptions)),t}const Qo={ACTIVE:"active"};class En extends Te{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Qo.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Qo.ACTIVE,t)}setMap(t){this.map_=t}}function Rd(s,t,e){const i=s.getCenterInternal();if(i){const n=[i[0]+t[0],i[1]+t[1]];s.animateInternal({duration:e!==void 0?e:250,easing:uu,center:s.getConstrainedCenter(n)})}}function Wr(s,t,e,i){const n=s.getZoom();if(n===void 0)return;const r=s.getConstrainedZoom(n+t),o=s.getResolutionForZoom(r);s.getAnimating()&&s.cancelAnimations(),s.animate({resolution:o,anchor:e,duration:i!==void 0?i:250,easing:Wi})}class Sd extends En{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==kt.DBLCLICK){const i=t.originalEvent,n=t.map,r=t.coordinate,o=i.shiftKey?-this.delta_:this.delta_,l=n.getView();Wr(l,o,r,this.duration_),i.preventDefault(),e=!0}return!e}}const Cd=Sd;class vn extends En{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==kt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==kt.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==kt.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==kt.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function zr(s){const t=s.length;let e=0,i=0;for(let n=0;n<t;n++)e+=s[n].clientX,i+=s[n].clientY;return[e/t,i/t]}function or(s){const t=arguments;return function(e){let i=!0;for(let n=0,r=t.length;n<r&&(i=i&&t[n](e),!!i);++n);return i}}const Td=function(s){const t=s.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},bd=function(s){const t=s.map.getTargetElement(),e=s.map.getOwnerDocument().activeElement;return t.contains(e)},rl=function(s){return s.map.getTargetElement().hasAttribute("tabindex")?bd(s):!0},Id=Qi,ol=function(s){const t=s.originalEvent;return t.button==0&&!(Ql&&th&&t.ctrlKey)},al=function(s){const t=s.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Ad=function(s){const t=s.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},ll=function(s){const t=s.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},Ns=function(s){const t=s.originalEvent;return mt(t!==void 0,56),t.pointerType=="mouse"},Od=function(s){const t=s.originalEvent;return mt(t!==void 0,56),t.isPrimary&&t.button===0};class Pd extends vn{constructor(t){super({stopDown:us}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:or(al,Od);this.condition_=t.onFocusOnly?or(rl,e):e,this.noKinetic_=!1}handleDragEvent(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const e=this.targetPointers,i=zr(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const n=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],o=t.map.getView();Fh(n,o.getResolution()),vr(n,o.getRotation()),o.adjustCenterInternal(n)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),l=e.getPixelFromCoordinateInternal(o),h=e.getCoordinateFromPixelInternal([l[0]-n*Math.cos(r),l[1]-n*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(h),duration:500,easing:Wi})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1}}const Md=Pd;class Ld extends vn{constructor(t){t=t||{},super({stopDown:us}),this.condition_=t.condition?t.condition:Td,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!Ns(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===jr)return;const n=e.getSize(),r=t.pixel,o=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);if(this.lastAngle_!==void 0){const l=o-this.lastAngle_;i.adjustRotationInternal(-l)}this.lastAngle_=o}handleUpEvent(t){return Ns(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return Ns(t)&&ol(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class Dd extends dr{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(t[0],e[0])+i,n.top=Math.min(t[1],e[1])+i,n.width=Math.abs(e[0]-t[0])+i,n.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new ti([n])}getGeometry(){return this.geometry_}}const zn={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Fs extends Ne{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}class Nd extends vn{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new Dd(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:ol,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const n=i[0]-e[0],r=i[1]-e[1];return n*n+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Fs(zn.BOXDRAG,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Fs(e?zn.BOXEND:zn.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Fs(zn.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}}class Fd extends Nd{constructor(t){t=t||{};const e=t.condition?t.condition:Ad;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(r),l=i.getResolution()/o;n=n.clone(),n.scale(l*l)}i.fitInternal(n,{duration:this.duration_,easing:Wi})}}const kd=Fd,si={LEFT:37,UP:38,RIGHT:39,DOWN:40};class Gd extends En{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return al(e)&&ll(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==gt.KEYDOWN){const i=t.originalEvent,n=i.keyCode;if(this.condition_(t)&&(n==si.DOWN||n==si.LEFT||n==si.RIGHT||n==si.UP)){const o=t.map.getView(),l=o.getResolution()*this.pixelDelta_;let h=0,u=0;n==si.DOWN?u=-l:n==si.LEFT?h=-l:n==si.RIGHT?h=l:u=l;const f=[h,u];vr(f,o.getRotation()),Rd(o,f,this.duration_),i.preventDefault(),e=!0}}return!e}}class Ud extends En{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:ll,this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==gt.KEYDOWN||t.type==gt.KEYPRESS){const i=t.originalEvent,n=i.charCode;if(this.condition_(t)&&(n==43||n==45)){const r=t.map,o=n==43?this.delta_:-this.delta_,l=r.getView();Wr(l,o,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}}const Xd=Ud;class jd{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const n=this.points_[e+2]-this.points_[i+2];if(n<1e3/60)return!1;const r=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class Yd extends En{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:Id;this.condition_=t.onFocusOnly?or(rl,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==gt.WHEEL)return!0;const i=t.map,n=t.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let r;if(t.type==gt.WHEEL&&(r=n.deltaY,Hl&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(r/=ua),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const l=i.getView();if(this.mode_==="trackpad"&&!(l.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(l.getAnimating()&&l.cancelAnimations(),l.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),l.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=r;const h=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),h),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-Ut(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Wr(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}const Wd=Yd;class zd extends vn{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=us),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const f=r-this.lastAngle_;this.rotationDelta_+=f,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=f}this.lastAngle_=r;const o=t.map,l=o.getView();if(l.getConstraints().rotation===jr)return;const h=o.getViewport().getBoundingClientRect(),u=zr(this.targetPointers);u[0]-=h.left,u[1]-=h.top,this.anchor_=o.getCoordinateFromPixelInternal(u),this.rotating_&&(o.render(),l.adjustRotationInternal(e,this.anchor_))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1}}class $d extends vn{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=us),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,o=i.clientY-n.clientY,l=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/l),this.lastDistance_=l;const h=t.map,u=h.getView();e!=1&&(this.lastScaleDelta_=e);const f=h.getViewport().getBoundingClientRect(),g=zr(this.targetPointers);g[0]-=f.left,g[1]-=f.top,this.anchor_=h.getCoordinateFromPixelInternal(g),h.render(),u.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const i=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,n),!1}else return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1}}const Vd=$d;function Bd(s){s=s||{};const t=new xe,e=new jd(-.005,.05,100);return(s.altShiftDragRotate!==void 0?s.altShiftDragRotate:!0)&&t.push(new Ld),(s.doubleClickZoom!==void 0?s.doubleClickZoom:!0)&&t.push(new Cd({delta:s.zoomDelta,duration:s.zoomDuration})),(s.dragPan!==void 0?s.dragPan:!0)&&t.push(new Md({onFocusOnly:s.onFocusOnly,kinetic:e})),(s.pinchRotate!==void 0?s.pinchRotate:!0)&&t.push(new zd),(s.pinchZoom!==void 0?s.pinchZoom:!0)&&t.push(new Vd({duration:s.zoomDuration})),(s.keyboard!==void 0?s.keyboard:!0)&&(t.push(new Gd),t.push(new Xd({delta:s.zoomDelta,duration:s.zoomDuration}))),(s.mouseWheelZoom!==void 0?s.mouseWheelZoom:!0)&&t.push(new Wd({onFocusOnly:s.onFocusOnly,duration:s.zoomDuration})),(s.shiftDragZoom!==void 0?s.shiftDragZoom:!0)&&t.push(new kd({duration:s.zoomDuration})),t}function hl(s){if(s instanceof Es){s.setMapInternal(null);return}s instanceof Yi&&s.getLayers().forEach(hl)}function cl(s,t){if(s instanceof Es){s.setMapInternal(t);return}if(s instanceof Yi){const e=s.getLayers().getArray();for(let i=0,n=e.length;i<n;++i)cl(e[i],t)}}class Kd extends Te{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=qd(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:ua,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Re(),this.pixelToCoordinateTransform_=Re(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.controls=e.controls||xd(),this.interactions=e.interactions||Bd({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new sd(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(Jt.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(Jt.VIEW,this.handleViewChanged_),this.addChangeListener(Jt.SIZE,this.handleSizeChanged_),this.addChangeListener(Jt.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof Ke)&&t.view.then(function(n){i.setView(new Ke(n))}),this.controls.addEventListener(se.ADD,(function(n){n.element.setMap(this)}).bind(this)),this.controls.addEventListener(se.REMOVE,(function(n){n.element.setMap(null)}).bind(this)),this.interactions.addEventListener(se.ADD,(function(n){n.element.setMap(this)}).bind(this)),this.interactions.addEventListener(se.REMOVE,(function(n){n.element.setMap(null)}).bind(this)),this.overlays_.addEventListener(se.ADD,(function(n){this.addOverlayInternal_(n.element)}).bind(this)),this.overlays_.addEventListener(se.REMOVE,(function(n){const r=n.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],n.element.setMap(null)}).bind(this)),this.controls.forEach((function(n){n.setMap(this)}).bind(this)),this.interactions.forEach((function(n){n.setMap(this)}).bind(this)),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){cl(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(t);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:Qi,l=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,r,l,e,null,o,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(n){i.push(n)},e),i}getAllLayers(){const t=[];function e(i){i.forEach(function(n){n instanceof Yi?e(n.getLayers()):t.push(n)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const n=e.layerFilter!==void 0?e.layerFilter:Qi,r=e.hitTolerance!==void 0?e.hitTolerance:0,o=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,o,n,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),i="changedTouches"in t?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]}getTarget(){return this.get(Jt.TARGET)}getTargetElement(){const t=this.getTarget();return t!==void 0?typeof t=="string"?document.getElementById(t):t:null}getCoordinateFromPixel(t){return qs(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?Bt(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(Jt.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof xe){e.setLayers(t);return}const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const n=t[e];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Pe(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?Bt(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(Jt.SIZE)}getView(){return this.get(Jt.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,n){return rd(this.frameState_,t,e,i,n)}handleBrowserEvent(t,e){e=e||t.type;const i=new $e(e,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===rr.POINTERDOWN||i===gt.WHEEL||i===gt.KEYDOWN){const n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=e.target;if(this.overlayContainerStopEvent_.contains(o)||!(r===n?n.documentElement:r).contains(o))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const n=this.getInteractions().getArray().slice();for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let n=this.maxTilesLoading_,r=n;if(t){const o=t.viewHints;if(o[Qt.ANIMATING]||o[Qt.INTERACTING]){const l=Date.now()-t.time>8;n=l?0:8,r=l?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,r))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(He.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(He.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new Li(Ve.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new Li(Ve.LOADSTART,this,t))));const i=this.postRenderFunctions_;for(let n=0,r=i.length;n<r;++n)i[n](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,i=this.targetChangeHandlerKeys_.length;e<i;++e)Lt(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(gt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(gt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,zs(this.viewport_)}const t=this.getTargetElement();if(!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new ed(this)),this.mapBrowserEventHandler_=new id(this,this.moveTolerance_);for(const n in kt)this.mapBrowserEventHandler_.addEventListener(kt[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(gt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(gt.WHEEL,this.boundHandleBrowserEvent_,da?{passive:!1}:!1);const e=this.getOwnerDocument().defaultView,i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[xt(i,gt.KEYDOWN,this.handleBrowserEvent,this),xt(i,gt.KEYPRESS,this.handleBrowserEvent,this),xt(e,gt.RESIZE,this.updateSize,this)]}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(Lt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(Lt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=xt(t,Ui.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=xt(t,gt.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(Lt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new Be("addlayer",t)),this.layerGroupPropertyListenerKeys_=[xt(t,Ui.PROPERTYCHANGE,this.render,this),xt(t,gt.CHANGE,this.render,this),xt(t,"addlayer",this.handleLayerAdd_,this),xt(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const n=t[e].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){hl(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),n=this.frameState_;let r=null;if(e!==void 0&&lo(e)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),l=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Xs(l.center,l.resolution,l.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:l,viewHints:o,wantedTiles:{},mapId:St(this),renderTargets:{}},l.nextCenter&&l.nextResolution){const h=isNaN(l.nextRotation)?l.rotation:l.nextRotation;r.nextExtent=Xs(l.nextCenter,l.nextResolution,h,e)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!hr(this.previousExtent_)&&!Ji(r.extent,this.previousExtent_))&&(this.dispatchEvent(new Li(Ve.MOVESTART,this,n)),this.previousExtent_=fn(this.previousExtent_)),this.previousExtent_&&!r.viewHints[Qt.ANIMATING]&&!r.viewHints[Qt.INTERACTING]&&!Ji(r.extent,this.previousExtent_)&&(this.dispatchEvent(new Li(Ve.MOVEEND,this,r)),ea(r.extent,this.previousExtent_))),this.dispatchEvent(new Li(Ve.POSTRENDER,this,r)),this.renderComplete_=this.hasListener(Ve.LOADSTART)||this.hasListener(Ve.LOADEND)||this.hasListener(He.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new Be("removelayer",e)),this.set(Jt.LAYERGROUP,t)}setSize(t){this.set(Jt.SIZE,t)}setTarget(t){this.set(Jt.TARGET,t)}setView(t){if(!t||t instanceof Ke){this.set(Jt.VIEW,t);return}this.set(Jt.VIEW,new Ke);const e=this;t.then(function(i){e.setView(new Ke(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const i=getComputedStyle(t),n=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),r=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(n)&&!isNaN(r)&&(e=[n,r],!lo(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(e),this.updateViewportSize_()}updateViewportSize_(){const t=this.getView();if(t){let e;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(e=[parseInt(i.width,10),parseInt(i.height,10)]),t.setViewportSize(e)}}}function qd(s){let t=null;s.keyboardEventTarget!==void 0&&(t=typeof s.keyboardEventTarget=="string"?document.getElementById(s.keyboardEventTarget):s.keyboardEventTarget);const e={},i=s.layers&&typeof s.layers.getLayers=="function"?s.layers:new Yi({layers:s.layers});e[Jt.LAYERGROUP]=i,e[Jt.TARGET]=s.target,e[Jt.VIEW]=s.view instanceof Ke?s.view:new Ke;let n;s.controls!==void 0&&(Array.isArray(s.controls)?n=new xe(s.controls.slice()):(mt(typeof s.controls.getArray=="function",47),n=s.controls));let r;s.interactions!==void 0&&(Array.isArray(s.interactions)?r=new xe(s.interactions.slice()):(mt(typeof s.interactions.getArray=="function",48),r=s.interactions));let o;return s.overlays!==void 0?Array.isArray(s.overlays)?o=new xe(s.overlays.slice()):(mt(typeof s.overlays.getArray=="function",49),o=s.overlays):o=new xe,{controls:n,interactions:r,keyboardEventTarget:t,overlays:o,values:e}}const Zd=Kd;class Hd extends Gr{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Jd,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Ja,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const n in this.tileCacheForProjection){const r=this.tileCacheForProjection[n];r.expireCache(r==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!oi(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!oi(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||oi(e,t)))return this.tileGrid;{const i=St(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=nl(t)),this.tileGridForProjection[i]}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||oi(e,t))return this.tileCache;{const i=St(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new el(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}}createTile_(t,e,i,n,r,o){const l=[t,e,i],h=this.getTileCoordForTileUrlFunction(l,r),u=h?this.tileUrlFunction(h,n,r):void 0,f=new this.tileClass(l,u!==void 0?at.IDLE:at.EMPTY,u!==void 0?u:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return f.key=o,f.addEventListener(gt.CHANGE,this.handleTileChange.bind(this)),f}getTile(t,e,i,n,r){const o=this.getProjection();if(!o||!r||oi(o,r))return this.getTileInternal(t,e,i,n,o||r);{const l=this.getTileCacheForProjection(r),h=[t,e,i];let u;const f=tl(h);l.containsKey(f)&&(u=l.get(f));const g=this.getKey();if(u&&u.key==g)return u;{const p=this.getTileGridForProjection(o),m=this.getTileGridForProjection(r),E=this.getTileCoordForTileUrlFunction(h,r),x=new ir(o,p,r,m,h,E,this.getTilePixelRatio(n),this.getGutter(),(function(v,C,b,P){return this.getTileInternal(v,C,b,P,o)}).bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return x.key=g,u?(x.interimTile=u,x.refreshInterimChain(),l.replace(f,x)):l.set(f,x),x}}}getTileInternal(t,e,i,n,r){let o=null;const l=vs(t,e,i),h=this.getKey();if(!this.tileCache.containsKey(l))o=this.createTile_(t,e,i,n,r,h),this.tileCache.set(l,o);else if(o=this.tileCache.get(l),o.key!=h){const u=o;o=this.createTile_(t,e,i,n,r,h),u.getState()==at.IDLE?o.interimTile=u.interimTile:o.interimTile=u,o.refreshInterimChain(),this.tileCache.replace(l,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const i=Gt(t);if(i){const n=St(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function Jd(s,t){s.getImage().src=t}class Qd extends Es{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(jn.PRELOAD)}setPreload(t){this.set(jn.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(jn.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(jn.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class tf extends Qd{constructor(t){super(t)}createRenderer(){return new wu(this)}}const ef=tf;class nf extends Hd{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:Au({extent:kr(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const sf='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class rf extends nf{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[sf];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",n=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:n,wrapX:t.wrapX,zDirection:t.zDirection})}}const Gi=(s,t,e,i,n=5)=>{let r=[s,t];typeof window.$barry.layers[i]<"u"&&window.$barry.map.removeLayer(window.$barry.layers[i]),i.startsWith("place")&&(window.$barry.places[i]=r,window.$barry.canCalculate());const o=new _i(r),l=new yn(o);l.setId(i);const h=new Dr({source:new Ka({features:[l]}),style:new an({image:new mr({radius:n,fill:new ps({color:e})})})});window.$barry.layers[i]=h,window.$barry.map.addLayer(h)},of=(s,t,e,i=3)=>{typeof window.$barry.layers[e]!=null&&window.$barry.map.removeLayer(window.$barry.layers[e]);const n=new Gu,r=new yn({geometry:n.readGeometry(s)});r.setId(e),r.setStyle(new an({stroke:new mn({color:t,width:i})}));var o=new Ka({features:[r]}),l=new Dr({source:o});window.$barry.layers[e]=l,window.$barry.map.addLayer(l)},af=(s,t,e)=>{const i=Object.keys(window.$barry.places);let n=[];for(let r=0;r<i.length;r++)i[r].startsWith("place")&&n.push(new Promise(o=>{Ws(window.$barry.places[i[r]],s,r).then(l=>{const h=l.totalTime,u=Math.floor(h/3600),f=Math.floor(h/60%60);of(l.routeGeometry,window.$barry.roadColor,`route_${l.key}`),window.$barry.log(`
<span onmouseenter="window.$barry.showNav('route_${l.key}', 1);"
      onmouseleave="window.$barry.showNav('route_${l.key}', 0)"
      onclick="window.$barry.zoom([[${l.bbox.top}, ${l.bbox.left}],[${l.bbox.bottom}, ${l.bbox.right}]])"
>
  De 
  <b>
    ${document.querySelector(`input[data-city="${i[r]}"]`).value}
  </b>
  , il y 
  <b>
    ${Math.round(100*parseFloat(l.totalDistance)/1e3)/100}
  </b>
  km en
  <b>
    ${u} h ${f<10?"0"+f:f}
  </b>
</span>`),o()})}));window.$barry.log("Je calcule le trajet pour chaque ville.",1),Promise.all(n).then(()=>{Gi(s[0],s[1],t,e)})},lf=s=>new Promise(t=>{cr.Services.reverseGeocode({position:{x:s[0],y:s[1]},filterOptions:{type:["PositionOfInterest"],circle:{x:s[0],y:s[1],radius:4}},apiKey:"calcul",onSuccess:function(e){let i=!1;e.locations.forEach(n=>{var r,o;(o=(r=n.placeAttributes)==null?void 0:r.extrafields)!=null&&o.cleabs.startsWith("COMMUNE_")&&!i&&(i=!0,window.$barry.log(`On se retrouve donc à <b>${n.placeAttributes.name}</b>`),t([n.position.lon,n.position.lat]))}),t(s)},onFailure:function(e){alert(e),t(s)}})}),hf=()=>new Promise((s,t)=>{window.$barry.log("Je calcule tous les chemins !",1);let e=[];const i=Object.keys(window.$barry.places);for(let n=0;n<i.length;n++)for(let r=n+1;r<i.length;r++)i[n].startsWith("place")&&i[r].startsWith("place")&&e.push(Ws(window.$barry.places[i[n]],window.$barry.places[i[r]],i[n]+";"+i[r]));Promise.all(e).then(n=>{let r=0,o=0,l=n[0].key;for(let u=0;u<n.length;u++){const f=parseFloat(n[u].totalTime),g=parseFloat(n[u].totalDistance),p=Math.floor(f/3600),m=Math.floor(f/60%60);let E=n[u].key.split(";");window.$barry.log(`Entre "${document.querySelector(`input[data-city="${E[0]}"]`).value}" et "${document.querySelector(`input[data-city="${E[1]}"]`).value}" il y a ${Math.round(100*g/1e3)/100} km en ${p}h${m<10?"0"+m:m}`,1),(window.$barry.calculateMode=="time"&&f>o||window.$barry.calculateMode=="distance"&&g>r)&&(r=g,o=f,l=n[u].key)}let h=l.split(";");window.$barry.log(`Le trajet le plus long (en ${window.$barry.calculateMode=="time"?"temps":"distance"}) est donc entre "${document.querySelector(`input[data-city="${h[0]}"]`).value}" et "${document.querySelector(`input[data-city="${h[1]}"]`).value}"`,1),window.$barry.log("Je calcule le point à mi-temps.",1),h.length>1?Ws(window.$barry.places[h[0]],window.$barry.places[h[1]],"",!0).then(u=>{let f=null;const g=u.routeInstructions.length;let p=0,m=0;const E=Math.round(o/2),x=Math.round(r/2);for(let v=0;v<g&&(m+=parseFloat(u.routeInstructions[v].distance),p+=parseFloat(u.routeInstructions[v].duration),f=u.routeInstructions[v],!(window.$barry.calculateMode=="time"&&p>E||window.$barry.calculateMode=="distance"&&m>x));v++);if(f!=null){let v=0;window.$barry.calculateMode=="time"?v=(p-E)/parseFloat(f.duration):window.$barry.calculateMode=="distance"&&(v=(m-x)/parseFloat(f.distance)),window.$barry.log("Le point est trouvé.",1),s(f.geometry.coordinates[Math.round((1-v)*f.geometry.coordinates.length)])}}):t("Pas de point trouvé")})});function cf(){return new Promise(s=>{const t=Object.keys(window.$barry.places);let e=0,i=0;for(let n=0;n<t.length;n++)t[n].startsWith("place")&&(e+=parseFloat(window.$barry.places[t[n]][0]),i+=parseFloat(window.$barry.places[t[n]][1]));e/=t.length,i/=t.length,window.$barry.log("Je fais la moyenne des coordonnées des villes.",1),s([e,i])})}const uf=()=>new Promise(s=>{const t=window.$barry.calcBox();window.$barry.log("Je détermine les latitudes et longitudes minimales et maximales pour définir un cadre et je calcule le centre du cadre.",1),s([(t[1][1]+t[0][1])/2,(t[1][0]+t[0][0])/2])});window.$barry.calculate=()=>{window.$barry.$logContent.innerHTML="",window.$barry.$log.classList.remove("hide"),window.$barry.$spinner.classList.remove("hide"),window.$barry.$rappel.classList.add("hide");let s=[];s.push(window.$barry.calculateMode),document.querySelectorAll(".address").forEach(n=>{const r=n.querySelector("input").value;r==""?window.$barry.removeAddress(n.id):(s.push(r),n.querySelectorAll("button").forEach(o=>o.classList.add("hide")))}),window.location.hash=btoa(s.join("|")),window.$barry.log("C'est parti pour rechercher votre point de rencontre équitable");let t=[hf(),cf(),uf()],e=["longMiddle","average","center"],i=[13,2,1];Promise.all(t).then(n=>{window.$barry.log("J'ai fini les différents calculs, je prend maintenant la moyenne des coordonnées.",1);let r=0,o=0,l=0;Object.keys(window.$barry.places).length>2?(n.map((h,u)=>{for(let f=0;f<i[u];f++)r+=parseFloat(h[0]),o+=parseFloat(h[1]),l++;Gi(h[0],h[1],window.$barry.methods[e[u]].color,e[u])}),r/=l,o/=l):(r=n[0][0],o=n[0][1],Gi(r,o,window.$barry.methods[e[0]].color,e[0])),window.$barry.log(`On se retrouve à [${r}, ${o}]`,1),window.$barry.log("Je cherche la ville la plus proche du point.",1),Gi(r,o,window.$barry.resultColor,"result"),lf([r,o]).then(h=>{h[0]==h[1]&&h[0]==0?window.$barry.log("Pas de ville trouvée proche, je suis désolé mais va falloir le faire à la main."):(af(h,window.$barry.resultColor,"result"),hs(),window.$barry.meetPoint=h,window.$barry.$pois.classList.remove("hide")),window.$barry.$spinner.classList.add("hide"),window.$barry.$calculate.classList.add("hide"),window.$barry.$newsearch.classList.remove("hide")})})};window.$barry.canCalculate=()=>{Object.keys(window.$barry.places).length>1?window.$barry.$calculate.classList.remove("hide"):window.$barry.$calculate.classList.add("hide")};window.$barry.canPlace=s=>{window.$barry.addressToCalc[s]=!0};window.$barry.changeCalcMode=()=>{window.$barry.calculateMode=="time"?window.$barry.calculateMode="distance":window.$barry.calculateMode="time"};window.$barry.changeCalcTransport=()=>{window.$barry.calculateTransport=="car"?window.$barry.calculateTransport="pedestrian":window.$barry.calculateTransport="car"};window.$barry.changeCalcToll=()=>{window.$barry.calculateToll=!window.$barry.calculateToll};window.$barry.changeLogMode=()=>{window.$barry.$log.querySelectorAll(".log-1").forEach(s=>{window.$barry.$toggleLogMode.checked?s.classList.remove("hide"):s.classList.add("hide")})};window.$barry.log=(s,t)=>{typeof t>"u"&&(t=0),window.$barry.$logContent.innerHTML+=`<p class="log-${t}${t>0?" hide":""}">${s}</p>`};window.$barry.managePOI=s=>{Object.keys(window.$barry.layers).forEach(t=>{t.startsWith("poi_")&&window.$barry.map.removeLayer(window.$barry.layers[t])});for(let t in window.$barry.pois){const e=window.$barry.pois[t];e.categories.includes(s)&&Gi(e.longitude,e.latitude,"#131282",`poi_${e.identifier}`,3)}};window.$barry.newAddress=s=>{if(typeof s<"u"){const e=document.getElementById(s);e.querySelector(".plus").classList.toggle("hide"),e.querySelector(".minus").classList.toggle("hide")}const t=document.createElement("div");t.classList.add("address"),t.id=`address_${window.$barry.addressesCount}`,t.innerHTML=`
<input type="text"
       placeholder="Adresse postale"
       onfocus="window.$barry.canPlace('place_${window.$barry.addressesCount}')"
       onblur="window.$barry.placePoint(this.value, 'place_${window.$barry.addressesCount}');"
       onkeydown="window.$barry.calcAddress(event, '${window.$barry.addressesCount}', this.value)"
       data-city="place_${window.$barry.addressesCount}" />
<button class="minus hide" 
        onclick="window.$barry.removeAddress('address_${window.$barry.addressesCount}')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
    </svg>
</button>
<button class="plus" 
        onclick="window.$barry.newAddress('address_${window.$barry.addressesCount}')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
    </svg>
</button>
      `,window.$barry.$addressesWrapper.appendChild(t),window.$barry.addressesCount++,window.$barry.nbPlaces++};const ul=()=>{hs([[51.31133241804094,-4.369239747680932],[42.14745185055437,8.623599144082085]])};window.$barry.newSearch=()=>{window.$barry.$log.classList.add("hide"),window.$barry.$newsearch.classList.add("hide"),window.$barry.$rappel.classList.remove("hide"),document.querySelectorAll(".address").forEach(s=>{s.parentNode.removeChild(s)}),window.$barry.addressesCount=0,window.$barry.places={},Object.keys(window.$barry.layers).forEach(s=>{window.$barry.map.removeLayer(window.$barry.layers[s])}),window.$barry.layers={},window.$barry.newAddress(),ul(),window.$barry.$pois.classList.remove("hide"),window.$barry.pois=[],window.location.hash=""};const df=(s,t)=>{if(s.trim()!="")return cr.Services.geocode({location:s,apiKey:"calcul",onSuccess:e=>{Gi(e.locations[0].position.lon,e.locations[0].position.lat,window.$barry.addressColor,t)},onFailure:e=>{alert(e)}});window.$barry.canCalculate()};window.$barry.placePoint=(s,t)=>{window.$barry.addressToCalc[t]&&window.$barry.$newsearch.classList.contains("hide")&&(window.$barry.addressToCalc[t]=!1,window.$barry.$calculate.classList.add("hide"),df(s,t))};window.$barry.removeAddress=s=>{window.$barry.nbPlaces--;const t=document.getElementById(s);t.parentNode.removeChild(t),s=s.replace("address_","place_"),delete window.$barry.places[s],window.$barry.map.removeLayer(window.$barry.layers[s]),delete window.$barry.layers[s]};window.$barry.showPOI=s=>{document.querySelectorAll("#pois a").forEach(t=>t.classList.remove("active")),document.querySelector(`#pois a[data-cat="${s}"]`).classList.add("active"),Object.keys(window.$barry.pois).length==0?window.$barry.tourisme().then(t=>{t.forEach(e=>{window.$barry.pois[`poi_${e.identifier}`]=e}),window.$barry.managePOI(s)}):window.$barry.managePOI(s)};window.$barry.showNav=(s,t)=>{Object.keys(window.$barry.layers).forEach(e=>{e.startsWith("route_")&&window.$barry.layers[e].setVisible(t==1?e.startsWith(s):!0)})};window.$barry.toggleConfiguration=()=>{window.$barry.$configuration.classList.toggle("hide"),window.$barry.$reduceConfiguration.classList.toggle("hide"),window.$barry.$augmentConfiguration.classList.toggle("hide")};window.$barry.toggleWelcome=()=>{window.$barry.$welcome.querySelector("div").classList.toggle("hide"),window.$barry.$reduceWelcome.classList.toggle("hide"),window.$barry.$augmentWelcome.classList.toggle("hide")};window.$barry.tourisme=()=>{let s=new URL(window.$barry.urlTourismAPI);const t=window.$barry.meetPoint,e={lat_min:parseFloat(t[1])-.2,lat_max:parseFloat(t[1])+.2,lng_min:parseFloat(t[0])-.3,lng_max:parseFloat(t[0])+.3};Object.keys(e).forEach(n=>s.searchParams.append(n,e[n]));const i=[[e.lat_min,e.lng_min],[e.lat_max,e.lng_max]];return hs(i),fetch(s).then(function(n){return n.text()}).then(function(n){try{return JSON.parse(n)}catch{return n}})};window.$barry.zoom=s=>{hs(s)};const ff=()=>{window.$barry.layers={},zh(),window.$barry.map=new Zd({target:"map",layers:[new ef({source:new rf})],view:new Ke({center:[2.213749,46.927638],zoom:2})}),window.$barry.map.on("pointermove",s=>{window.$barry.map.forEachFeatureAtPixel(s.pixel,t=>{if(t.id_.startsWith("poi_")){const e=window.$barry.pois[t.id_];window.$barry.$popin.innerHTML=`
<h3>${e.label}</h3>
<p>${e.description}</p>
<ul>
  <li>
    ${e.address.replace(/\|/g,"<br />")}<br />${e.postcode} ${e.city}
  </li>
  <li>
    <a href="tel:${e.phone}">${e.phone}</a>
  </li>
  <li>
    <a href="mailto:${e.mail}">${e.mail}</a>
  </li>
</ul>
`,window.$barry.$popin.classList.remove("hide")}else window.$barry.$popin.classList.add("hide")},{layerFilter:t=>t.type===new Dr().type,hitTolerance:6})})};ff();ul();window.$barry.newAddress();if(window.location.hash!=""){const s=atob(window.location.hash.substring(1)).split("|");s.length>1&&(window.$barry.calculateMode=s.shift(),window.$barry.calculateMode!="time"&&(window.$barry.$toggleCalcMode.checked=!0),s.forEach(t=>{const e=window.$barry.addressesCount-1;window.$barry.canPlace(`place_${e}`),window.$barry.placePoint(t,`place_${e}`);const i=document.getElementById(`address_${e}`);i.querySelector("input").value=t,i.querySelector(".plus").classList.add("hide"),i.querySelector(".minus").classList.remove("hide"),window.$barry.newAddress()}))}
