(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();window.$barry={methods:{longMiddle:{label:"Le mi-chemin en temps sur le plus long trajet entre toutes les villes",color:"#10b981"},average:{label:"La moyenne des coordonnées des villes",color:"#3b82f6"},center:{label:"Le centre du cadre dans lequel toutes les villes sont présentes",color:"#f59e0b"}},addressColor:"#111827",resultColor:"#EF4444",roadColor:"#47695B",calculateMode:"time",calculateTransport:"Voiture",calculateToll:!0,addressesCount:0,places:{},layers:{},addressToCalc:{},urlTourismAPI:"https://titi.gougouzian.fr",tourismCategory:["Sports","Cultural","Hotel","Food","Camping","Event","Tour"],pois:{},$addressesWrapper:document.getElementById("addresses-wrapper"),$augmentConfiguration:document.getElementById("augmentConfiguration"),$augmentWelcome:document.getElementById("augmentWelcome"),$calculate:document.getElementById("calculate"),$configuration:document.getElementById("configuration"),$log:document.getElementById("log"),$logContent:document.getElementById("log-content"),$newsearch:document.getElementById("newsearch"),$reduceConfiguration:document.getElementById("reduceConfiguration"),$reduceWelcome:document.getElementById("reduceWelcome"),$pois:document.getElementById("pois"),$rappel:document.getElementById("rappel"),$spinner:document.getElementById("spinner"),$toggleCalcMode:document.getElementById("toggleCalcMode"),$toggleLogMode:document.getElementById("toggleLogMode"),$welcome:document.getElementById("welcome"),$popin:document.getElementById("popin")};window.$barry.calcAddress=(r,t,e)=>{if(r.key==="Enter"){if(e!=="")window.$barry.canPlace(`place_${t}`),window.$barry.placePoint(e,`place_${t}`),window.$barry.newAddress(`address_${window.$barry.addressesCount-1}`),document.querySelector(`#address_${window.$barry.addressesCount-1} input`).focus();else if(Object.keys(window.$barry.places).length>0){window.$barry.removeAddress(`address_${t}`);const i=document.querySelectorAll(".address");i[i.length-1].querySelector(".plus").classList.remove("hide"),i[i.length-1].querySelector(".minus").classList.add("hide")}}};window.$barry.calcBox=()=>{const r=Object.keys(window.$barry.places);let t=99,e=-99,i=99,n=-99;for(let s=0;s<r.length;s++)if(r[s].startsWith("place")){const o=Number.parseFloat(window.$barry.places[r[s]][0]),a=Number.parseFloat(window.$barry.places[r[s]][1]);t>o&&(t=o),e<o&&(e=o),i>a&&(i=a),n<a&&(n=a)}return[[i,t],[n,e]]};const se={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16},Va={1:"The view center is not defined",2:"The view resolution is not defined",3:"The view rotation is not defined",4:"`image` and `src` cannot be provided at the same time",5:"`imgSize` must be set when `image` is provided",7:"`format` must be set when `url` is set",8:"Unknown `serverType` configured",9:"`url` must be configured or set using `#setUrl()`",10:"The default `geometryFunction` can only handle `Point` geometries",11:"`options.featureTypes` must be an Array",12:"`options.geometryName` must also be provided when `options.bbox` is set",13:"Invalid corner",14:"Invalid color",15:"Tried to get a value for a key that does not exist in the cache",16:"Tried to set a value for a key that is used already",17:"`resolutions` must be sorted in descending order",18:"Either `origin` or `origins` must be configured, never both",19:"Number of `tileSizes` and `resolutions` must be equal",20:"Number of `origins` and `resolutions` must be equal",22:"Either `tileSize` or `tileSizes` must be configured, never both",24:"Invalid extent or geometry provided as `geometry`",25:"Cannot fit empty extent provided as `geometry`",26:"Features must have an id set",27:"Features must have an id set",28:'`renderMode` must be `"hybrid"` or `"vector"`',30:"The passed `feature` was already added to the source",31:"Tried to enqueue an `element` that was already added to the queue",32:"Transformation matrix cannot be inverted",33:"Invalid units",34:"Invalid geometry layout",36:"Unknown SRS type",37:"Unknown geometry type found",38:"`styleMapValue` has an unknown type",39:"Unknown geometry type",40:"Expected `feature` to have a geometry",41:"Expected an `ol/style/Style` or an array of `ol/style/Style.js`",42:"Question unknown, the answer is 42",43:"Expected `layers` to be an array or a `Collection`",47:"Expected `controls` to be an array or an `ol/Collection`",48:"Expected `interactions` to be an array or an `ol/Collection`",49:"Expected `overlays` to be an array or an `ol/Collection`",50:"`options.featureTypes` should be an Array",51:"Either `url` or `tileJSON` options must be provided",52:"Unknown `serverType` configured",53:"Unknown `tierSizeCalculation` configured",55:"The {-y} placeholder requires a tile grid with extent",56:"mapBrowserEvent must originate from a pointer event",57:"At least 2 conditions are required",59:"Invalid command found in the PBF",60:"Missing or invalid `size`",61:"Cannot determine IIIF Image API version from provided image information JSON",62:"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`",64:"Layer opacity must be a number",66:"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has not been enabled. This is done by providing adequate shaders using the `hitVertexShader` and `hitFragmentShader` properties of `WebGLPointsLayerRenderer`",67:"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both",68:"A VectorTile source can only be rendered if it has a projection compatible with the view projection"};class Do extends Error{constructor(t){const e=Va[t];super(e),this.code=t,this.name="AssertionError",this.message=e}}function xt(r,t){if(!r)throw new Do(t)}function Gr(r){const t=Ce();for(let e=0,i=r.length;e<i;++e)ln(t,r[e]);return t}function Wa(r,t,e){const i=Math.min.apply(null,r),n=Math.min.apply(null,t),s=Math.max.apply(null,r),o=Math.max.apply(null,t);return Ue(i,n,s,o,e)}function as(r,t,e){return e?(e[0]=r[0]-t,e[1]=r[1]-t,e[2]=r[2]+t,e[3]=r[3]+t,e):[r[0]-t,r[1]-t,r[2]+t,r[3]+t]}function ko(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r.slice()}function Oi(r,t,e){let i,n;return t<r[0]?i=r[0]-t:r[2]<t?i=t-r[2]:i=0,e<r[1]?n=r[1]-e:r[3]<e?n=e-r[3]:n=0,i*i+n*n}function lr(r,t){return ls(r,t[0],t[1])}function Yi(r,t){return r[0]<=t[0]&&t[2]<=r[2]&&r[1]<=t[1]&&t[3]<=r[3]}function ls(r,t,e){return r[0]<=t&&t<=r[2]&&r[1]<=e&&e<=r[3]}function Ur(r,t){const e=r[0],i=r[1],n=r[2],s=r[3],o=t[0],a=t[1];let l=se.UNKNOWN;return o<e?l=l|se.LEFT:o>n&&(l=l|se.RIGHT),a<i?l=l|se.BELOW:a>s&&(l=l|se.ABOVE),l===se.UNKNOWN&&(l=se.INTERSECTING),l}function Ce(){return[1/0,1/0,-1/0,-1/0]}function Ue(r,t,e,i,n){return n?(n[0]=r,n[1]=t,n[2]=e,n[3]=i,n):[r,t,e,i]}function bn(r){return Ue(1/0,1/0,-1/0,-1/0,r)}function Ba(r,t){const e=r[0],i=r[1];return Ue(e,i,e,i,t)}function Fo(r,t,e,i,n){const s=bn(n);return Uo(s,r,t,e,i)}function un(r,t){return r[0]==t[0]&&r[2]==t[2]&&r[1]==t[1]&&r[3]==t[3]}function Go(r,t){return t[0]<r[0]&&(r[0]=t[0]),t[2]>r[2]&&(r[2]=t[2]),t[1]<r[1]&&(r[1]=t[1]),t[3]>r[3]&&(r[3]=t[3]),r}function ln(r,t){t[0]<r[0]&&(r[0]=t[0]),t[0]>r[2]&&(r[2]=t[0]),t[1]<r[1]&&(r[1]=t[1]),t[1]>r[3]&&(r[3]=t[1])}function Uo(r,t,e,i,n){for(;e<i;e+=n)Ha(r,t[e],t[e+1]);return r}function Ha(r,t,e){r[0]=Math.min(r[0],t),r[1]=Math.min(r[1],e),r[2]=Math.max(r[2],t),r[3]=Math.max(r[3],e)}function qo(r,t){let e;return e=t(cr(r)),e||(e=t(hr(r)),e)||(e=t(ur(r)),e)||(e=t(Mi(r)),e)?e:!1}function qr(r){let t=0;return cs(r)||(t=Ut(r)*qe(r)),t}function cr(r){return[r[0],r[1]]}function hr(r){return[r[2],r[1]]}function Si(r){return[(r[0]+r[2])/2,(r[1]+r[3])/2]}function $a(r,t){let e;return t==="bottom-left"?e=cr(r):t==="bottom-right"?e=hr(r):t==="top-left"?e=Mi(r):t==="top-right"?e=ur(r):xt(!1,13),e}function Xr(r,t,e,i,n){const[s,o,a,l,h,u,g,m]=jr(r,t,e,i);return Ue(Math.min(s,a,h,g),Math.min(o,l,u,m),Math.max(s,a,h,g),Math.max(o,l,u,m),n)}function jr(r,t,e,i){const n=t*i[0]/2,s=t*i[1]/2,o=Math.cos(e),a=Math.sin(e),l=n*o,h=n*a,u=s*o,g=s*a,m=r[0],y=r[1];return[m-l+g,y-h-u,m-l-g,y-h+u,m+l-g,y+h+u,m+l+g,y+h-u,m-l+g,y-h-u]}function qe(r){return r[3]-r[1]}function cn(r,t,e){const i=e||Ce();return me(r,t)?(r[0]>t[0]?i[0]=r[0]:i[0]=t[0],r[1]>t[1]?i[1]=r[1]:i[1]=t[1],r[2]<t[2]?i[2]=r[2]:i[2]=t[2],r[3]<t[3]?i[3]=r[3]:i[3]=t[3]):bn(i),i}function Mi(r){return[r[0],r[3]]}function ur(r){return[r[2],r[3]]}function Ut(r){return r[2]-r[0]}function me(r,t){return r[0]<=t[2]&&r[2]>=t[0]&&r[1]<=t[3]&&r[3]>=t[1]}function cs(r){return r[2]<r[0]||r[3]<r[1]}function Ka(r,t){return t?(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t):r}function Za(r,t,e){let i=!1;const n=Ur(r,t),s=Ur(r,e);if(n===se.INTERSECTING||s===se.INTERSECTING)i=!0;else{const o=r[0],a=r[1],l=r[2],h=r[3],u=t[0],g=t[1],m=e[0],y=e[1],w=(y-g)/(m-u);let E,v;s&se.ABOVE&&!(n&se.ABOVE)&&(E=m-(y-h)/w,i=E>=o&&E<=l),!i&&s&se.RIGHT&&!(n&se.RIGHT)&&(v=y-(m-l)*w,i=v>=a&&v<=h),!i&&s&se.BELOW&&!(n&se.BELOW)&&(E=m-(y-a)/w,i=E>=o&&E<=l),!i&&s&se.LEFT&&!(n&se.LEFT)&&(v=y-(m-o)*w,i=v>=a&&v<=h)}return i}function Ja(r,t,e,i){let n=[];n=[r[0],r[1],r[2],r[1],r[2],r[3],r[0],r[3]],t(n,n,2);const s=[],o=[];for(let a=0,l=n.length;a<l;a+=2)s.push(n[a]),o.push(n[a+1]);return Wa(s,o,e)}function Xo(r,t){const e=t.getExtent(),i=Si(r);if(t.canWrapX()&&(i[0]<e[0]||i[0]>=e[2])){const n=Ut(e),o=Math.floor((i[0]-e[0])/n)*n;r[0]-=o,r[2]-=o}return r}function Qa(r,t){if(t.canWrapX()){const e=t.getExtent();if(!isFinite(r[0])||!isFinite(r[2]))return[[e[0],r[1],e[2],r[3]]];Xo(r,t);const i=Ut(e);if(Ut(r)>i)return[[e[0],r[1],e[2],r[3]]];if(r[0]<e[0])return[[r[0]+i,r[1],e[2],r[3]],[e[0],r[1],r[2],r[3]]];if(r[2]>e[2])return[[r[0],r[1],e[2],r[3]],[e[0],r[1],r[2]-i,r[3]]]}return[r]}const dr=r=>{let t=r;typeof r>"u"&&(t=window.$barry.calcBox());const e=Gr([[t[0][1],t[0][0]],[t[1][1],t[1][0]]]);window.$barry.map.getView().fit(e,{size:window.$barry.map.getSize(),padding:[50,50,50,50],duration:2e3})};var Yr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},jo={exports:{}},kn={exports:{}},js;function tl(){return js||(js=1,function(r,t){var e=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof Yr<"u")return Yr;throw new Error("unable to locate global object")},i=e();r.exports=t=i.fetch,i.fetch&&(t.default=i.fetch.bind(i)),t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response}(kn,kn.exports)),kn.exports}/*!
 * @brief Geoportal resources access library
 *
 * This software is released under the licence CeCILL-B (Free BSD compatible)
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt
 * @see http://www.cecill.info/licences/Licence_CeCILL-B_V1-fr.txt
 * @see http://www.cecill.info/
 *
 * copyright CeCILL-B
 * copyright IGN
 * @author IGN
 * @version 3.4.6
 * @date 19/12/2024
 *
 */(function(r,t){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.4
 */(function(e,i){r.exports=i(tl())})(Yr,function(e){return function(i){var n={};function s(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return i[o].call(a.exports,a,a.exports,s),a.l=!0,a.exports}return s.m=i,s.c=n,s.d=function(o,a,l){s.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:l})},s.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},s.t=function(o,a){if(1&a&&(o=s(o)),8&a||4&a&&typeof o=="object"&&o&&o.__esModule)return o;var l=Object.create(null);if(s.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:o}),2&a&&typeof o!="string")for(var h in o)s.d(l,h,(function(u){return o[u]}).bind(null,h));return l},s.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return s.d(a,"a",a),a},s.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},s.p="",s(s.s=9)}([function(i,n,s){function o(E,v){return v===void 0&&(v=Object),v&&typeof v.getOwnPropertyDescriptors=="function"&&(E=v.create(null,v.getOwnPropertyDescriptors(E))),v&&typeof v.freeze=="function"?v.freeze(E):E}function a(E,v){return Object.prototype.hasOwnProperty.call(E,v)}var l=o({allowfullscreen:!0,async:!0,autofocus:!0,autoplay:!0,checked:!0,controls:!0,default:!0,defer:!0,disabled:!0,formnovalidate:!0,hidden:!0,ismap:!0,itemscope:!0,loop:!0,multiple:!0,muted:!0,nomodule:!0,novalidate:!0,open:!0,playsinline:!0,readonly:!0,required:!0,reversed:!0,selected:!0}),h=o({area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),u=o({script:!1,style:!1,textarea:!0,title:!0});function g(E){return E===m.HTML}var m=o({HTML:"text/html",XML_APPLICATION:"application/xml",XML_TEXT:"text/xml",XML_XHTML_APPLICATION:"application/xhtml+xml",XML_SVG_IMAGE:"image/svg+xml"}),y=Object.keys(m).map(function(E){return m[E]}),w=o({HTML:"http://www.w3.org/1999/xhtml",SVG:"http://www.w3.org/2000/svg",XML:"http://www.w3.org/XML/1998/namespace",XMLNS:"http://www.w3.org/2000/xmlns/"});n.assign=function(E,v){if(E===null||typeof E!="object")throw new TypeError("target is not an object");for(var x in v)a(v,x)&&(E[x]=v[x]);return E},n.find=function(E,v,x){if(x===void 0&&(x=Array.prototype),E&&typeof x.find=="function")return x.find.call(E,v);for(var S=0;S<E.length;S++)if(a(E,S)){var R=E[S];if(v.call(void 0,R,S,E))return R}},n.freeze=o,n.HTML_BOOLEAN_ATTRIBUTES=l,n.HTML_RAW_TEXT_ELEMENTS=u,n.HTML_VOID_ELEMENTS=h,n.hasDefaultHTMLNamespace=function(E){return g(E)||E===m.XML_XHTML_APPLICATION},n.hasOwn=a,n.isHTMLBooleanAttribute=function(E){return a(l,E.toLowerCase())},n.isHTMLRawTextElement=function(E){var v=E.toLowerCase();return a(u,v)&&!u[v]},n.isHTMLEscapableRawTextElement=function(E){var v=E.toLowerCase();return a(u,v)&&u[v]},n.isHTMLMimeType=g,n.isHTMLVoidElement=function(E){return a(h,E.toLowerCase())},n.isValidMimeType=function(E){return y.indexOf(E)>-1},n.MIME_TYPE=m,n.NAMESPACE=w},function(i){i.exports=JSON.parse(`{"name":"geoportal-access-lib","version":"3.4.6","date":"19/12/2024","description":"French Geoportal resources access library","module":"src/Gp.js","main":"dist/GpServices-src.js","homepage":"https://github.com/IGNF/geoportal-access-lib#readme","scripts":{"clean":"echo \\"Warning: no yet implemented!\\" && exit 0","setup":"npm install","cover":"nyc --reporter=lcov --reporter=text npm run test","eslint":"eslint src/","build":"webpack --mode=none","build:prod":"webpack --mode=production","build:dev":"webpack --mode=development","test":"npx instant-mocha --mode=development --reporter mochawesome --reporter-options reportDir=test-report,reportFilename=index --webpack-config ./test/webpack/webpack.test.js --glob \\"test_*.js\\" test/spec/","test:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.js","test:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.test.serve.docker.js","test:end-to-end:serve":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.js","test:end-to-end:serve:docker":"webpack-dev-server --hot --config ./test/webpack/webpack.end-to-end.serve.docker.js","sample":"npm run sample:serve","sample:serve":"webpack-dev-server --mode=none --open-page samples/index-src.html --https --content-base . --output-public-path '/dist/' --port 9001 --open","sample:serve:prod":"webpack-dev-server --mode=production --open-page samples/index-prod.html --content-base . --output-public-path '/dist/' --port 9001 --open","sample:serve:dev":"webpack-dev-server --mode=development --open-page samples/index-map.html --content-base . --output-public-path '/dist/' --port 9001 --open","doc":"npm run doc:serve","doc:serve":"webpack-dev-server --content-base jsdoc --port 9001 --open"},"engines":{"node":">=20"},"nyc":{"include":["src/**/*.js"],"instrument":false,"sourceMap":false},"repository":{"type":"git","url":"https://github.com/IGNF/geoportal-access-lib.git"},"keywords":["geoplateforme","geoportail","webservice","javascript","es6"],"author":"IGNF","license":"CECILL-B","dependencies":{"@xmldom/xmldom":"^0.9.6","es6-promise":"^4.2.4","node-fetch":"^2.6.1"},"devDependencies":{"@babel/core":"^7.12.10","@babel/plugin-transform-template-literals":"^7.12.1","@babel/preset-env":"^7.12.11","babel-loader":"^8.2.2","chai":"^4.1.2","clean-webpack-plugin":"^4.0.0","copy-webpack-plugin":"^5.1.2","eslint":"^7.18.0","eslint-config-standard":"^16.0.2","eslint-loader":"^4.0.2","eslint-plugin-import":"^2.22.1","eslint-plugin-node":"^11.1.0","eslint-plugin-promise":"^4.2.1","eslint-plugin-standard":"^5.0.0","glob":"^7.1.2","handlebars-layouts":"^3.1.4","handlebars-webpack-plugin":"^1.4.1","html-webpack-plugin":"^4.5.2","instant-mocha":"^1.5.3","istanbul-instrumenter-loader":"^3.0.1","jsdoc-webpack-plugin":"^0.3.0","loglevel":"^1.6.1","mocha":"^8.4.0","mocha-loader":"^5.1.5","mochawesome":"^6.2.1","nyc":"^15.1.0","path":"^0.12.7","replace-bundle-webpack-plugin":"^1.0.0","sinon":"^9.2.4","sinon-es6":"0.0.3","speed-measure-webpack-plugin":"^1.4.2","string-template":"^1.0.0","terser-webpack-plugin":"^4.2.3","webpack":"^4.47.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^2.5.2","webpack-shell-plugin":"^0.5.0"},"bundleDependencies":[]}`)},function(i,n,s){function o(E,v){E.prototype=Object.create(Error.prototype,{constructor:{value:E},name:{value:E.name,enumerable:!0,writable:v}})}var a=s(0).freeze({Error:"Error",IndexSizeError:"IndexSizeError",DomstringSizeError:"DomstringSizeError",HierarchyRequestError:"HierarchyRequestError",WrongDocumentError:"WrongDocumentError",InvalidCharacterError:"InvalidCharacterError",NoDataAllowedError:"NoDataAllowedError",NoModificationAllowedError:"NoModificationAllowedError",NotFoundError:"NotFoundError",NotSupportedError:"NotSupportedError",InUseAttributeError:"InUseAttributeError",InvalidStateError:"InvalidStateError",SyntaxError:"SyntaxError",InvalidModificationError:"InvalidModificationError",NamespaceError:"NamespaceError",InvalidAccessError:"InvalidAccessError",ValidationError:"ValidationError",TypeMismatchError:"TypeMismatchError",SecurityError:"SecurityError",NetworkError:"NetworkError",AbortError:"AbortError",URLMismatchError:"URLMismatchError",QuotaExceededError:"QuotaExceededError",TimeoutError:"TimeoutError",InvalidNodeTypeError:"InvalidNodeTypeError",DataCloneError:"DataCloneError",EncodingError:"EncodingError",NotReadableError:"NotReadableError",UnknownError:"UnknownError",ConstraintError:"ConstraintError",DataError:"DataError",TransactionInactiveError:"TransactionInactiveError",ReadOnlyError:"ReadOnlyError",VersionError:"VersionError",OperationError:"OperationError",NotAllowedError:"NotAllowedError",OptOutError:"OptOutError"}),l=Object.keys(a);function h(E){return typeof E=="number"&&E>=1&&E<=25}function u(E,v){var x;h(E)?(this.name=l[E],this.message=v||""):(this.message=E,this.name=typeof(x=v)=="string"&&x.substring(x.length-a.Error.length)===a.Error?v:a.Error),Error.captureStackTrace&&Error.captureStackTrace(this,u)}o(u,!0),Object.defineProperties(u.prototype,{code:{enumerable:!0,get:function(){var E=l.indexOf(this.name);return h(E)?E:0}}});for(var g={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25},m=Object.entries(g),y=0;y<m.length;y++)u[m[y][0]]=m[y][1];function w(E,v){this.message=E,this.locator=v,Error.captureStackTrace&&Error.captureStackTrace(this,w)}o(w),n.DOMException=u,n.DOMExceptionName=a,n.ExceptionCode=g,n.ParseError=w},function(i,n,s){var o,a;(function(){o=function(){var l=function(){},h="undefined",u=typeof window!==h&&typeof window.navigator!==h&&/Trident\/|MSIE /.test(window.navigator.userAgent),g=["trace","debug","info","warn","error"],m={},y=null;function w(F,W){var H=F[W];if(typeof H.bind=="function")return H.bind(F);try{return Function.prototype.bind.call(H,F)}catch{return function(){return Function.prototype.apply.apply(H,[F,arguments])}}}function E(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function v(F){return F==="debug"&&(F="log"),typeof console!==h&&(F==="trace"&&u?E:console[F]!==void 0?w(console,F):console.log!==void 0?w(console,"log"):l)}function x(){for(var F=this.getLevel(),W=0;W<g.length;W++){var H=g[W];this[H]=W<F?l:this.methodFactory(H,F,this.name)}if(this.log=this.debug,typeof console===h&&F<this.levels.SILENT)return"No console available for logging"}function S(F){return function(){typeof console!==h&&(x.call(this),this[F].apply(this,arguments))}}function R(F,W,H){return v(F)||S.apply(this,arguments)}function O(F,W){var H,N,z,I=this,L="loglevel";function U(M){var B=(g[M]||"silent").toUpperCase();if(typeof window!==h&&L){try{return void(window.localStorage[L]=B)}catch{}try{window.document.cookie=encodeURIComponent(L)+"="+B+";"}catch{}}}function J(){var M;if(typeof window!==h&&L){try{M=window.localStorage[L]}catch{}if(typeof M===h)try{var B=window.document.cookie,Z=encodeURIComponent(L),K=B.indexOf(Z+"=");K!==-1&&(M=/^([^;]+)/.exec(B.slice(K+Z.length+1))[1])}catch{}return I.levels[M]===void 0&&(M=void 0),M}}function Y(){if(typeof window!==h&&L){try{window.localStorage.removeItem(L)}catch{}try{window.document.cookie=encodeURIComponent(L)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch{}}}function P(M){var B=M;if(typeof B=="string"&&I.levels[B.toUpperCase()]!==void 0&&(B=I.levels[B.toUpperCase()]),typeof B=="number"&&B>=0&&B<=I.levels.SILENT)return B;throw new TypeError("log.setLevel() called with invalid level: "+M)}typeof F=="string"?L+=":"+F:typeof F=="symbol"&&(L=void 0),I.name=F,I.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},I.methodFactory=W||R,I.getLevel=function(){return z??N??H},I.setLevel=function(M,B){return z=P(M),B!==!1&&U(z),x.call(I)},I.setDefaultLevel=function(M){N=P(M),J()||I.setLevel(M,!1)},I.resetLevel=function(){z=null,Y(),x.call(I)},I.enableAll=function(M){I.setLevel(I.levels.TRACE,M)},I.disableAll=function(M){I.setLevel(I.levels.SILENT,M)},I.rebuild=function(){if(y!==I&&(H=P(y.getLevel())),x.call(I),y===I)for(var M in m)m[M].rebuild()},H=P(y?y.getLevel():"WARN");var X=J();X!=null&&(z=P(X)),x.call(I)}(y=new O).getLogger=function(F){if(typeof F!="symbol"&&typeof F!="string"||F==="")throw new TypeError("You must supply a name when creating a logger.");var W=m[F];return W||(W=m[F]=new O(F,y.methodFactory)),W};var k=typeof window!==h?window.log:void 0;return y.noConflict=function(){return typeof window!==h&&window.log===y&&(window.log=k),y},y.getLoggers=function(){return m},y.default=y,y},(a=typeof o=="function"?o.call(n,s,n,i):o)===void 0||(i.exports=a)})()},function(i,n){i.exports=e},function(i,n,s){var o=s(0);n.assign=o.assign,n.hasDefaultHTMLNamespace=o.hasDefaultHTMLNamespace,n.isHTMLMimeType=o.isHTMLMimeType,n.isValidMimeType=o.isValidMimeType,n.MIME_TYPE=o.MIME_TYPE,n.NAMESPACE=o.NAMESPACE;var a=s(2);n.DOMException=a.DOMException,n.DOMExceptionName=a.DOMExceptionName,n.ExceptionCode=a.ExceptionCode,n.ParseError=a.ParseError;var l=s(6);n.Attr=l.Attr,n.CDATASection=l.CDATASection,n.CharacterData=l.CharacterData,n.Comment=l.Comment,n.Document=l.Document,n.DocumentFragment=l.DocumentFragment,n.DocumentType=l.DocumentType,n.DOMImplementation=l.DOMImplementation,n.Element=l.Element,n.Entity=l.Entity,n.EntityReference=l.EntityReference,n.LiveNodeList=l.LiveNodeList,n.NamedNodeMap=l.NamedNodeMap,n.Node=l.Node,n.NodeList=l.NodeList,n.Notation=l.Notation,n.ProcessingInstruction=l.ProcessingInstruction,n.Text=l.Text,n.XMLSerializer=l.XMLSerializer;var h=s(12);n.DOMParser=h.DOMParser,n.onErrorStopParsing=h.onErrorStopParsing,n.onWarningStopParsing=h.onWarningStopParsing},function(i,n,s){var o=s(0),a=o.find,l=o.hasDefaultHTMLNamespace,h=o.hasOwn,u=o.isHTMLMimeType,g=o.isHTMLRawTextElement,m=o.isHTMLVoidElement,y=o.MIME_TYPE,w=o.NAMESPACE,E=Symbol(),v=s(2),x=v.DOMException,S=v.DOMExceptionName,R=s(7);function O(f){if(f!==E)throw new TypeError("Illegal constructor")}function k(f){return f!==""}function F(f,_){return h(f,_)||(f[_]=!0),f}function W(f){if(!f)return[];var _=function(b){return b?b.split(/[\t\n\f\r ]+/).filter(k):[]}(f);return Object.keys(_.reduce(F,{}))}function H(f){if(!R.QName_exact.test(f))throw new x(x.INVALID_CHARACTER_ERR,'invalid character in qualified name "'+f+'"')}function N(f,_){H(_),f=f||null;var b=null,A=_;if(_.indexOf(":")>=0){var V=_.split(":");b=V[0],A=V[1]}if(b!==null&&f===null)throw new x(x.NAMESPACE_ERR,"prefix is non-null and namespace is null");if(b==="xml"&&f!==o.NAMESPACE.XML)throw new x(x.NAMESPACE_ERR,'prefix is "xml" and namespace is not the XML namespace');if((b==="xmlns"||_==="xmlns")&&f!==o.NAMESPACE.XMLNS)throw new x(x.NAMESPACE_ERR,'either qualifiedName or prefix is "xmlns" and namespace is not the XMLNS namespace');if(f===o.NAMESPACE.XMLNS&&b!=="xmlns"&&_!=="xmlns")throw new x(x.NAMESPACE_ERR,'namespace is the XMLNS namespace and neither qualifiedName nor prefix is "xmlns"');return[f,b,A]}function z(f,_){for(var b in f)h(f,b)&&(_[b]=f[b])}function I(f,_){var b=f.prototype;if(!(b instanceof _)){let V=function(){};var A=V;V.prototype=_.prototype,z(b,V=new V),f.prototype=b=V}b.constructor!=f&&(typeof f!="function"&&console.error("unknown Class:"+f),b.constructor=f)}var L={},U=L.ELEMENT_NODE=1,J=L.ATTRIBUTE_NODE=2,Y=L.TEXT_NODE=3,P=L.CDATA_SECTION_NODE=4,X=L.ENTITY_REFERENCE_NODE=5,M=L.ENTITY_NODE=6,B=L.PROCESSING_INSTRUCTION_NODE=7,Z=L.COMMENT_NODE=8,K=L.DOCUMENT_NODE=9,q=L.DOCUMENT_TYPE_NODE=10,Q=L.DOCUMENT_FRAGMENT_NODE=11,lt=L.NOTATION_NODE=12,nt=o.freeze({DOCUMENT_POSITION_DISCONNECTED:1,DOCUMENT_POSITION_PRECEDING:2,DOCUMENT_POSITION_FOLLOWING:4,DOCUMENT_POSITION_CONTAINS:8,DOCUMENT_POSITION_CONTAINED_BY:16,DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC:32});function Gt(f){for(var _=[];f.parentNode||f.ownerElement;)f=f.parentNode||f.ownerElement,_.unshift(f);return _}function Rt(f,_){if(_.length<f.length)return Rt(_,f);var b=null;for(var A in f){if(f[A]!==_[A])return b;b=f[A]}return b}function _t(f){return f.guid||(f.guid=Math.random()),f.guid}function mt(){}function pt(f,_){this._node=f,this._refresh=_,G(this)}function G(f){var _=f._node._inc||f._node.ownerDocument._inc;if(f._inc!==_){var b=f._refresh(f._node);if(Qt(f,"length",b.length),!f.$$length||b.length<f.$$length)for(var A=b.length;A in f;A++)h(f,A)&&delete f[A];z(b,f),f._inc=_}}function j(){}function tt(f,_){for(var b=0;b<f.length;){if(f[b]===_)return b;b++}}function st(f,_,b,A){if(A?_[tt(_,A)]=b:(_[_.length]=b,_.length++),f){b.ownerElement=f;var V=f.ownerDocument;V&&(A&&Dt(V,f,A),function(at,At,vt){at&&at._inc++;var Yt=vt.namespaceURI;Yt===w.XMLNS&&(At._nsMap[vt.prefix?vt.localName:""]=vt.value)}(V,f,b))}}function et(f,_,b){var A=tt(_,b);if(A>=0){for(var V=_.length-1;A<=V;)_[A]=_[++A];if(_.length=V,f){var at=f.ownerDocument;at&&Dt(at,f,b),b.ownerElement=null}}}function rt(){}function it(f){O(f)}function Ot(f){return(f=="<"?"&lt;":f==">"&&"&gt;")||f=="&"&&"&amp;"||f=='"'&&"&quot;"||"&#"+f.charCodeAt()+";"}function Mt(f,_){if(_(f))return!0;if(f=f.firstChild)do if(Mt(f,_))return!0;while(f=f.nextSibling)}function It(f,_){O(f);var b=_||{};this.ownerDocument=this,this.contentType=b.contentType||y.XML_APPLICATION,this.type=u(this.contentType)?"html":"xml"}function Dt(f,_,b,A){f&&f._inc++,b.namespaceURI===w.XMLNS&&delete _._nsMap[b.prefix?b.localName:""]}function Nt(f,_,b){if(f&&f._inc){f._inc++;var A=_.childNodes;if(b&&!b.nextSibling)A[A.length++]=b;else{for(var V=_.firstChild,at=0;V;)A[at++]=V,V=V.nextSibling;A.length=at,delete A[A.length]}}}function kt(f,_){if(f!==_.parentNode)throw new x(x.NOT_FOUND_ERR,"child's parent is not parent");var b=_.previousSibling,A=_.nextSibling;return b?b.nextSibling=A:f.firstChild=A,A?A.previousSibling=b:f.lastChild=b,Nt(f.ownerDocument,f),_.parentNode=null,_.previousSibling=null,_.nextSibling=null,_}function Et(f){return f&&f.nodeType===it.DOCUMENT_TYPE_NODE}function bt(f){return f&&f.nodeType===it.ELEMENT_NODE}function ce(f){return f&&f.nodeType===it.TEXT_NODE}function Vt(f,_){var b=f.childNodes||[];if(a(b,bt)||Et(_))return!1;var A=a(b,Et);return!(_&&A&&b.indexOf(A)>b.indexOf(_))}function Jt(f,_){var b=f.childNodes||[];if(a(b,function(V){return bt(V)&&V!==_}))return!1;var A=a(b,Et);return!(_&&A&&b.indexOf(A)>b.indexOf(_))}function Tt(f,_,b){if(!function(A){return A&&(A.nodeType===it.DOCUMENT_NODE||A.nodeType===it.DOCUMENT_FRAGMENT_NODE||A.nodeType===it.ELEMENT_NODE)}(f))throw new x(x.HIERARCHY_REQUEST_ERR,"Unexpected parent node type "+f.nodeType);if(b&&b.parentNode!==f)throw new x(x.NOT_FOUND_ERR,"child not in parent");if(!function(A){return A&&(A.nodeType===it.CDATA_SECTION_NODE||A.nodeType===it.COMMENT_NODE||A.nodeType===it.DOCUMENT_FRAGMENT_NODE||A.nodeType===it.DOCUMENT_TYPE_NODE||A.nodeType===it.ELEMENT_NODE||A.nodeType===it.PROCESSING_INSTRUCTION_NODE||A.nodeType===it.TEXT_NODE)}(_)||Et(_)&&f.nodeType!==it.DOCUMENT_NODE)throw new x(x.HIERARCHY_REQUEST_ERR,"Unexpected node type "+_.nodeType+" for parent node type "+f.nodeType)}function ht(f,_,b){var A=f.childNodes||[],V=_.childNodes||[];if(_.nodeType===it.DOCUMENT_FRAGMENT_NODE){var at=V.filter(bt);if(at.length>1||a(V,ce))throw new x(x.HIERARCHY_REQUEST_ERR,"More than one element or text in fragment");if(at.length===1&&!Vt(f,b))throw new x(x.HIERARCHY_REQUEST_ERR,"Element in fragment can not be inserted before doctype")}if(bt(_)&&!Vt(f,b))throw new x(x.HIERARCHY_REQUEST_ERR,"Only one element can be added and only after doctype");if(Et(_)){if(a(A,Et))throw new x(x.HIERARCHY_REQUEST_ERR,"Only one doctype is allowed");var At=a(A,bt);if(b&&A.indexOf(At)<A.indexOf(b))throw new x(x.HIERARCHY_REQUEST_ERR,"Doctype can only be inserted before an element");if(!b&&At)throw new x(x.HIERARCHY_REQUEST_ERR,"Doctype can not be appended since element is present")}}function wt(f,_,b){var A=f.childNodes||[],V=_.childNodes||[];if(_.nodeType===it.DOCUMENT_FRAGMENT_NODE){var at=V.filter(bt);if(at.length>1||a(V,ce))throw new x(x.HIERARCHY_REQUEST_ERR,"More than one element or text in fragment");if(at.length===1&&!Jt(f,b))throw new x(x.HIERARCHY_REQUEST_ERR,"Element in fragment can not be inserted before doctype")}if(bt(_)&&!Jt(f,b))throw new x(x.HIERARCHY_REQUEST_ERR,"Only one element can be added and only after doctype");if(Et(_)){let Yt=function(Xt){return Et(Xt)&&Xt!==b};var vt=Yt;if(a(A,Yt))throw new x(x.HIERARCHY_REQUEST_ERR,"Only one doctype is allowed");var At=a(A,bt);if(b&&A.indexOf(At)<A.indexOf(b))throw new x(x.HIERARCHY_REQUEST_ERR,"Doctype can only be inserted before an element")}}function Wt(f,_,b,A){Tt(f,_,b),f.nodeType===it.DOCUMENT_NODE&&(A||ht)(f,_,b);var V=_.parentNode;if(V&&V.removeChild(_),_.nodeType===Q){var at=_.firstChild;if(at==null)return _;var At=_.lastChild}else at=At=_;var vt=b?b.previousSibling:f.lastChild;at.previousSibling=vt,At.nextSibling=b,vt?vt.nextSibling=at:f.firstChild=at,b==null?f.lastChild=At:b.previousSibling=At;do at.parentNode=f;while(at!==At&&(at=at.nextSibling));return Nt(f.ownerDocument||f,f,_),_.nodeType==Q&&(_.firstChild=_.lastChild=null),_}function ae(f){O(f),this._nsMap=Object.create(null)}function fe(f){O(f),this.namespaceURI=null,this.prefix=null,this.ownerElement=null}function Ie(f){O(f)}function ye(f){O(f)}function Ae(f){O(f)}function je(f){O(f)}function Oe(f){O(f)}function Ee(f){O(f)}function ee(f){O(f)}function Te(f){O(f)}function Re(f){O(f)}function Ht(f){O(f)}function ie(){}function ge(f){var _=[],b=this.nodeType===K&&this.documentElement||this,A=b.prefix,V=b.namespaceURI;if(V&&A==null&&(A=b.lookupPrefix(V))==null)var at=[{namespace:V,prefix:null}];return jt(this,_,f,at),_.join("")}function ne(f,_,b){var A=f.prefix||"",V=f.namespaceURI;if(!V||A==="xml"&&V===w.XML||V===w.XMLNS)return!1;for(var at=b.length;at--;){var At=b[at];if(At.prefix===A)return At.namespace!==V}return!0}function re(f,_,b){f.push(" ",_,'="',b.replace(/[<>&"\t\n\r]/g,Ot),'"')}function jt(f,_,b,A){A||(A=[]);var V=(f.nodeType===K?f:f.ownerDocument).type==="html";if(b){if(!(f=b(f)))return;if(typeof f=="string")return void _.push(f)}switch(f.nodeType){case U:var at=f.attributes,At=at.length,vt=f.firstChild,Yt=f.tagName,Xt=Yt;if(!V&&!f.prefix&&f.namespaceURI){for(var we,he=0;he<at.length;he++)if(at.item(he).name==="xmlns"){we=at.item(he).value;break}if(!we){for(var ze=A.length-1;ze>=0;ze--)if((Me=A[ze]).prefix===""&&Me.namespace===f.namespaceURI){we=Me.namespace;break}}if(we!==f.namespaceURI)for(ze=A.length-1;ze>=0;ze--){var Me;if((Me=A[ze]).namespace===f.namespaceURI){Me.prefix&&(Xt=Me.prefix+":"+Yt);break}}}_.push("<",Xt);for(var Ve=0;Ve<At;Ve++)(pe=at.item(Ve)).prefix=="xmlns"?A.push({prefix:pe.localName,namespace:pe.value}):pe.nodeName=="xmlns"&&A.push({prefix:"",namespace:pe.value});for(Ve=0;Ve<At;Ve++){var pe,We,Pi;ne(pe=at.item(Ve),0,A)&&(re(_,(We=pe.prefix||"")?"xmlns:"+We:"xmlns",Pi=pe.namespaceURI),A.push({prefix:We,namespace:Pi})),jt(pe,_,b,A)}Yt===Xt&&ne(f,0,A)&&(re(_,(We=f.prefix||"")?"xmlns:"+We:"xmlns",Pi=f.namespaceURI),A.push({prefix:We,namespace:Pi}));var Le=!vt;if(Le&&(V||f.namespaceURI===w.HTML)&&(Le=m(Yt)),Le)_.push("/>");else{if(_.push(">"),V&&g(Yt))for(;vt;)vt.data?_.push(vt.data):jt(vt,_,b,A.slice()),vt=vt.nextSibling;else for(;vt;)jt(vt,_,b,A.slice()),vt=vt.nextSibling;_.push("</",Xt,">")}return;case K:case Q:for(vt=f.firstChild;vt;)jt(vt,_,b,A.slice()),vt=vt.nextSibling;return;case J:return re(_,f.name,f.value);case Y:return _.push(f.data.replace(/[<&>]/g,Ot));case P:return _.push(R.CDATA_START,f.data,R.CDATA_END);case Z:return _.push(R.COMMENT_START,f.data,R.COMMENT_END);case q:var Dn=f.publicId,ei=f.systemId;return _.push(R.DOCTYPE_DECL_START," ",f.name),Dn?(_.push(" ",R.PUBLIC," ",Dn),ei&&ei!=="."&&_.push(" ",ei)):ei&&ei!=="."&&_.push(" ",R.SYSTEM," ",ei),f.internalSubset&&_.push(" [",f.internalSubset,"]"),void _.push(">");case B:return _.push("<?",f.target," ",f.data,"?>");case X:return _.push("&",f.nodeName,";");default:_.push("??",f.nodeName)}}function Ye(f,_,b){var A;switch(_.nodeType){case U:(A=_.cloneNode(!1)).ownerDocument=f;case Q:break;case J:b=!0}if(A||(A=_.cloneNode(!1)),A.ownerDocument=f,A.parentNode=null,b)for(var V=_.firstChild;V;)A.appendChild(Ye(f,V,b)),V=V.nextSibling;return A}function le(f,_,b){var A=new _.constructor(E);for(var V in _)if(h(_,V)){var at=_[V];typeof at!="object"&&at!=A[V]&&(A[V]=at)}switch(_.childNodes&&(A.childNodes=new mt),A.ownerDocument=f,A.nodeType){case U:var At=_.attributes,vt=A.attributes=new j,Yt=At.length;vt._ownerElement=A;for(var Xt=0;Xt<Yt;Xt++)A.setAttributeNode(le(f,At.item(Xt),!0));break;case J:b=!0}if(b)for(var we=_.firstChild;we;)A.appendChild(le(f,we,b)),we=we.nextSibling;return A}function Qt(f,_,b){f[_]=b}mt.prototype={length:0,item:function(f){return f>=0&&f<this.length?this[f]:null},toString:function(f){for(var _=[],b=0;b<this.length;b++)jt(this[b],_,f);return _.join("")},filter:function(f){return Array.prototype.filter.call(this,f)},indexOf:function(f){return Array.prototype.indexOf.call(this,f)}},mt.prototype[Symbol.iterator]=function(){var f=this,_=0;return{next:function(){return _<f.length?{value:f[_++],done:!1}:{done:!0}},return:function(){return{done:!0}}}},pt.prototype.item=function(f){return G(this),this[f]||null},I(pt,mt),j.prototype={length:0,item:mt.prototype.item,getNamedItem:function(f){this._ownerElement&&this._ownerElement._isInHTMLDocumentAndNamespace()&&(f=f.toLowerCase());for(var _=0;_<this.length;){var b=this[_];if(b.nodeName===f)return b;_++}return null},setNamedItem:function(f){var _=f.ownerElement;if(_&&_!==this._ownerElement)throw new x(x.INUSE_ATTRIBUTE_ERR);var b=this.getNamedItemNS(f.namespaceURI,f.localName);return b===f?f:(st(this._ownerElement,this,f,b),b)},setNamedItemNS:function(f){return this.setNamedItem(f)},removeNamedItem:function(f){var _=this.getNamedItem(f);if(!_)throw new x(x.NOT_FOUND_ERR,f);return et(this._ownerElement,this,_),_},removeNamedItemNS:function(f,_){var b=this.getNamedItemNS(f,_);if(!b)throw new x(x.NOT_FOUND_ERR,f?f+" : "+_:_);return et(this._ownerElement,this,b),b},getNamedItemNS:function(f,_){f||(f=null);for(var b=0;b<this.length;){var A=this[b];if(A.localName===_&&A.namespaceURI===f)return A;b++}return null}},j.prototype[Symbol.iterator]=function(){var f=this,_=0;return{next:function(){return _<f.length?{value:f[_++],done:!1}:{done:!0}},return:function(){return{done:!0}}}},rt.prototype={hasFeature:function(f,_){return!0},createDocument:function(f,_,b){var A=y.XML_APPLICATION;f===w.HTML?A=y.XML_XHTML_APPLICATION:f===w.SVG&&(A=y.XML_SVG_IMAGE);var V=new It(E,{contentType:A});if(V.implementation=this,V.childNodes=new mt,V.doctype=b||null,b&&V.appendChild(b),_){var at=V.createElementNS(f,_);V.appendChild(at)}return V},createDocumentType:function(f,_,b,A){H(f);var V=new Oe(E);return V.name=f,V.nodeName=f,V.publicId=_||"",V.systemId=b||"",V.internalSubset=A||"",V.childNodes=new mt,V},createHTMLDocument:function(f){var _=new It(E,{contentType:y.HTML});if(_.implementation=this,_.childNodes=new mt,f!==!1){_.doctype=this.createDocumentType("html"),_.doctype.ownerDocument=_,_.appendChild(_.doctype);var b=_.createElement("html");_.appendChild(b);var A=_.createElement("head");if(b.appendChild(A),typeof f=="string"){var V=_.createElement("title");V.appendChild(_.createTextNode(f)),A.appendChild(V)}b.appendChild(_.createElement("body"))}return _}},it.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,parentNode:null,get parentElement(){return this.parentNode&&this.parentNode.nodeType===this.ELEMENT_NODE?this.parentNode:null},childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,baseURI:"about:blank",get isConnected(){var f=this.getRootNode();return f&&f.nodeType===f.DOCUMENT_NODE},contains:function(f){if(!f)return!1;var _=f;do{if(this===_)return!0;_=f.parentNode}while(_);return!1},getRootNode:function(f){var _=this;do{if(!_.parentNode)return _;_=_.parentNode}while(_)},isEqualNode:function(f){if(!f||this.nodeType!==f.nodeType)return!1;switch(this.nodeType){case this.DOCUMENT_TYPE_NODE:if(this.name!==f.name||this.publicId!==f.publicId||this.systemId!==f.systemId)return!1;break;case this.ELEMENT_NODE:if(this.namespaceURI!==f.namespaceURI||this.prefix!==f.prefix||this.localName!==f.localName||this.attributes.length!==f.attributes.length)return!1;for(var _=0;_<this.attributes.length;_++){var b=this.attributes.item(_);if(!b.isEqualNode(f.getAttributeNodeNS(b.namespaceURI,b.localName)))return!1}break;case this.ATTRIBUTE_NODE:if(this.namespaceURI!==f.namespaceURI||this.localName!==f.localName||this.value!==f.value)return!1;break;case this.PROCESSING_INSTRUCTION_NODE:if(this.target!==f.target||this.data!==f.data)return!1;break;case this.TEXT_NODE:case this.COMMENT_NODE:if(this.data!==f.data)return!1}if(this.childNodes.length!==f.childNodes.length)return!1;for(_=0;_<this.childNodes.length;_++)if(!this.childNodes[_].isEqualNode(f.childNodes[_]))return!1;return!0},isSameNode:function(f){return this===f},insertBefore:function(f,_){return Wt(this,f,_)},replaceChild:function(f,_){Wt(this,f,_,wt),_&&this.removeChild(_)},removeChild:function(f){return kt(this,f)},appendChild:function(f){return this.insertBefore(f,null)},hasChildNodes:function(){return this.firstChild!=null},cloneNode:function(f){return le(this.ownerDocument||this,this,f)},normalize:function(){for(var f=this.firstChild;f;){var _=f.nextSibling;_&&_.nodeType==Y&&f.nodeType==Y?(this.removeChild(_),f.appendData(_.data)):(f.normalize(),f=_)}},isSupported:function(f,_){return this.ownerDocument.implementation.hasFeature(f,_)},lookupPrefix:function(f){for(var _=this;_;){var b=_._nsMap;if(b){for(var A in b)if(h(b,A)&&b[A]===f)return A}_=_.nodeType==J?_.ownerDocument:_.parentNode}return null},lookupNamespaceURI:function(f){for(var _=this;_;){var b=_._nsMap;if(b&&h(b,f))return b[f];_=_.nodeType==J?_.ownerDocument:_.parentNode}return null},isDefaultNamespace:function(f){return this.lookupPrefix(f)==null},compareDocumentPosition:function(f){if(this===f)return 0;var _=f,b=this,A=null,V=null;if(_ instanceof fe&&(_=(A=_).ownerElement),b instanceof fe&&(b=(V=b).ownerElement,A&&_&&b===_))for(var at,At=0;at=b.attributes[At];At++){if(at===A)return nt.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC+nt.DOCUMENT_POSITION_PRECEDING;if(at===V)return nt.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC+nt.DOCUMENT_POSITION_FOLLOWING}if(!_||!b||b.ownerDocument!==_.ownerDocument)return nt.DOCUMENT_POSITION_DISCONNECTED+nt.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC+(_t(b.ownerDocument)>_t(_.ownerDocument)?nt.DOCUMENT_POSITION_FOLLOWING:nt.DOCUMENT_POSITION_PRECEDING);var vt=Gt(_),Yt=Gt(b);if(!A&&Yt.indexOf(_)>=0||V&&_===b)return nt.DOCUMENT_POSITION_CONTAINS+nt.DOCUMENT_POSITION_PRECEDING;if(!V&&vt.indexOf(b)>=0||A&&_===b)return nt.DOCUMENT_POSITION_CONTAINED_BY+nt.DOCUMENT_POSITION_FOLLOWING;var Xt=Rt(Yt,vt);for(var we in Xt.childNodes){var he=Xt.childNodes[we];if(he===b)return nt.DOCUMENT_POSITION_FOLLOWING;if(he===_)return nt.DOCUMENT_POSITION_PRECEDING;if(Yt.indexOf(he)>=0)return nt.DOCUMENT_POSITION_FOLLOWING;if(vt.indexOf(he)>=0)return nt.DOCUMENT_POSITION_PRECEDING}return 0}},z(L,it),z(L,it.prototype),z(nt,it),z(nt,it.prototype),It.prototype={implementation:null,nodeName:"#document",nodeType:K,doctype:null,documentElement:null,_inc:1,insertBefore:function(f,_){if(f.nodeType===Q){for(var b=f.firstChild;b;){var A=b.nextSibling;this.insertBefore(b,_),b=A}return f}return Wt(this,f,_),f.ownerDocument=this,this.documentElement===null&&f.nodeType===U&&(this.documentElement=f),f},removeChild:function(f){var _=kt(this,f);return _===this.documentElement&&(this.documentElement=null),_},replaceChild:function(f,_){Wt(this,f,_,wt),f.ownerDocument=this,_&&this.removeChild(_),bt(f)&&(this.documentElement=f)},importNode:function(f,_){return Ye(this,f,_)},getElementById:function(f){var _=null;return Mt(this.documentElement,function(b){if(b.nodeType==U&&b.getAttribute("id")==f)return _=b,!0}),_},createElement:function(f){var _=new ae(E);return _.ownerDocument=this,this.type==="html"&&(f=f.toLowerCase()),l(this.contentType)&&(_.namespaceURI=w.HTML),_.nodeName=f,_.tagName=f,_.localName=f,_.childNodes=new mt,(_.attributes=new j)._ownerElement=_,_},createDocumentFragment:function(){var f=new Re(E);return f.ownerDocument=this,f.childNodes=new mt,f},createTextNode:function(f){var _=new ye(E);return _.ownerDocument=this,_.childNodes=new mt,_.appendData(f),_},createComment:function(f){var _=new Ae(E);return _.ownerDocument=this,_.childNodes=new mt,_.appendData(f),_},createCDATASection:function(f){var _=new je(E);return _.ownerDocument=this,_.childNodes=new mt,_.appendData(f),_},createProcessingInstruction:function(f,_){var b=new Ht(E);return b.ownerDocument=this,b.childNodes=new mt,b.nodeName=b.target=f,b.nodeValue=b.data=_,b},createAttribute:function(f){if(!R.QName_exact.test(f))throw new x(x.INVALID_CHARACTER_ERR,'invalid character in name "'+f+'"');return this.type==="html"&&(f=f.toLowerCase()),this._createAttribute(f)},_createAttribute:function(f){var _=new fe(E);return _.ownerDocument=this,_.childNodes=new mt,_.name=f,_.nodeName=f,_.localName=f,_.specified=!0,_},createEntityReference:function(f){if(!R.Name.test(f))throw new x(x.INVALID_CHARACTER_ERR,'not a valid xml name "'+f+'"');if(this.type==="html")throw new x("document is an html document",S.NotSupportedError);var _=new Te(E);return _.ownerDocument=this,_.childNodes=new mt,_.nodeName=f,_},createElementNS:function(f,_){var b=N(f,_),A=new ae(E),V=A.attributes=new j;return A.childNodes=new mt,A.ownerDocument=this,A.nodeName=_,A.tagName=_,A.namespaceURI=b[0],A.prefix=b[1],A.localName=b[2],V._ownerElement=A,A},createAttributeNS:function(f,_){var b=N(f,_),A=new fe(E);return A.ownerDocument=this,A.childNodes=new mt,A.nodeName=_,A.name=_,A.specified=!0,A.namespaceURI=b[0],A.prefix=b[1],A.localName=b[2],A}},I(It,it),ae.prototype={nodeType:U,attributes:null,getQualifiedName:function(){return this.prefix?this.prefix+":"+this.localName:this.localName},_isInHTMLDocumentAndNamespace:function(){return this.ownerDocument.type==="html"&&this.namespaceURI===w.HTML},hasAttribute:function(f){return!!this.getAttributeNode(f)},getAttribute:function(f){var _=this.getAttributeNode(f);return _?_.value:null},getAttributeNode:function(f){return this._isInHTMLDocumentAndNamespace()&&(f=f.toLowerCase()),this.attributes.getNamedItem(f)},setAttribute:function(f,_){this._isInHTMLDocumentAndNamespace()&&(f=f.toLowerCase());var b=this.getAttributeNode(f);b?b.value=b.nodeValue=""+_:((b=this.ownerDocument._createAttribute(f)).value=b.nodeValue=""+_,this.setAttributeNode(b))},removeAttribute:function(f){var _=this.getAttributeNode(f);_&&this.removeAttributeNode(_)},setAttributeNode:function(f){return this.attributes.setNamedItem(f)},setAttributeNodeNS:function(f){return this.attributes.setNamedItemNS(f)},removeAttributeNode:function(f){return this.attributes.removeNamedItem(f.nodeName)},removeAttributeNS:function(f,_){var b=this.getAttributeNodeNS(f,_);b&&this.removeAttributeNode(b)},hasAttributeNS:function(f,_){return this.getAttributeNodeNS(f,_)!=null},getAttributeNS:function(f,_){var b=this.getAttributeNodeNS(f,_);return b?b.value:null},setAttributeNS:function(f,_,b){var A=N(f,_)[2],V=this.getAttributeNodeNS(f,A);V?V.value=V.nodeValue=""+b:((V=this.ownerDocument.createAttributeNS(f,_)).value=V.nodeValue=""+b,this.setAttributeNode(V))},getAttributeNodeNS:function(f,_){return this.attributes.getNamedItemNS(f,_)},getElementsByClassName:function(f){var _=W(f);return new pt(this,function(b){var A=[];return _.length>0&&Mt(b,function(V){if(V!==b&&V.nodeType===U){var at=V.getAttribute("class");if(at){var At=f===at;if(!At){var vt=W(at);At=_.every((Yt=vt,function(Xt){return Yt&&Yt.indexOf(Xt)!==-1}))}At&&A.push(V)}}var Yt}),A})},getElementsByTagName:function(f){var _=(this.nodeType===K?this:this.ownerDocument).type==="html",b=f.toLowerCase();return new pt(this,function(A){var V=[];return Mt(A,function(at){at!==A&&at.nodeType===U&&(f==="*"||at.getQualifiedName()===(_&&at.namespaceURI===w.HTML?b:f))&&V.push(at)}),V})},getElementsByTagNameNS:function(f,_){return new pt(this,function(b){var A=[];return Mt(b,function(V){V===b||V.nodeType!==U||f!=="*"&&V.namespaceURI!==f||_!=="*"&&V.localName!=_||A.push(V)}),A})}},It.prototype.getElementsByClassName=ae.prototype.getElementsByClassName,It.prototype.getElementsByTagName=ae.prototype.getElementsByTagName,It.prototype.getElementsByTagNameNS=ae.prototype.getElementsByTagNameNS,I(ae,it),fe.prototype.nodeType=J,I(fe,it),Ie.prototype={data:"",substringData:function(f,_){return this.data.substring(f,f+_)},appendData:function(f){f=this.data+f,this.nodeValue=this.data=f,this.length=f.length},insertData:function(f,_){this.replaceData(f,0,_)},deleteData:function(f,_){this.replaceData(f,_,"")},replaceData:function(f,_,b){b=this.data.substring(0,f)+b+this.data.substring(f+_),this.nodeValue=this.data=b,this.length=b.length}},I(Ie,it),ye.prototype={nodeName:"#text",nodeType:Y,splitText:function(f){var _=this.data,b=_.substring(f);_=_.substring(0,f),this.data=this.nodeValue=_,this.length=_.length;var A=this.ownerDocument.createTextNode(b);return this.parentNode&&this.parentNode.insertBefore(A,this.nextSibling),A}},I(ye,Ie),Ae.prototype={nodeName:"#comment",nodeType:Z},I(Ae,Ie),je.prototype={nodeName:"#cdata-section",nodeType:P},I(je,ye),Oe.prototype.nodeType=q,I(Oe,it),Ee.prototype.nodeType=lt,I(Ee,it),ee.prototype.nodeType=M,I(ee,it),Te.prototype.nodeType=X,I(Te,it),Re.prototype.nodeName="#document-fragment",Re.prototype.nodeType=Q,I(Re,it),Ht.prototype.nodeType=B,I(Ht,Ie),ie.prototype.serializeToString=function(f,_){return ge.call(f,_)},it.prototype.toString=ge;try{if(Object.defineProperty){let f=function(_){switch(_.nodeType){case U:case Q:var b=[];for(_=_.firstChild;_;)_.nodeType!==7&&_.nodeType!==8&&b.push(f(_)),_=_.nextSibling;return b.join("");default:return _.nodeValue}};var $t=f;Object.defineProperty(pt.prototype,"length",{get:function(){return G(this),this.$$length}}),Object.defineProperty(it.prototype,"textContent",{get:function(){return f(this)},set:function(_){switch(this.nodeType){case U:case Q:for(;this.firstChild;)this.removeChild(this.firstChild);(_||String(_))&&this.appendChild(this.ownerDocument.createTextNode(_));break;default:this.data=_,this.value=_,this.nodeValue=_}}}),Qt=function(_,b,A){_["$$"+b]=A}}}catch{}n._updateLiveList=G,n.Attr=fe,n.CDATASection=je,n.CharacterData=Ie,n.Comment=Ae,n.Document=It,n.DocumentFragment=Re,n.DocumentType=Oe,n.DOMImplementation=rt,n.Element=ae,n.Entity=ee,n.EntityReference=Te,n.LiveNodeList=pt,n.NamedNodeMap=j,n.Node=it,n.NodeList=mt,n.Notation=Ee,n.Text=ye,n.ProcessingInstruction=Ht,n.XMLSerializer=ie},function(i,n,s){function o(Tt){try{typeof Tt!="function"&&(Tt=RegExp);var ht=new Tt("𝌆","u").exec("𝌆");return!!ht&&ht[0].length===2}catch{}return!1}var a=o();function l(Tt){if(Tt.source[0]!=="[")throw new Error(Tt+" can not be used with chars");return Tt.source.slice(1,Tt.source.lastIndexOf("]"))}function h(Tt,ht){if(Tt.source[0]!=="[")throw new Error("/"+Tt.source+"/ can not be used with chars_without");if(!ht||typeof ht!="string")throw new Error(JSON.stringify(ht)+" is not a valid search");if(Tt.source.indexOf(ht)===-1)throw new Error('"'+ht+'" is not is /'+Tt.source+"/");if(ht==="-"&&Tt.source.indexOf(ht)!==1)throw new Error('"'+ht+'" is not at the first postion of /'+Tt.source+"/");return new RegExp(Tt.source.replace(ht,""),a?"u":"")}function u(Tt){var ht=this;return new RegExp(Array.prototype.slice.call(arguments).map(function(wt){var Wt=typeof wt=="string";if(Wt&&ht===void 0&&wt==="|")throw new Error("use regg instead of reg to wrap expressions with `|`!");return Wt?wt:wt.source}).join(""),a?"mu":"m")}function g(Tt){if(arguments.length===0)throw new Error("no parameters provided");return u.apply(g,["(?:"].concat(Array.prototype.slice.call(arguments),[")"]))}var m=/[-\x09\x0A\x0D\x20-\x2C\x2E-\uD7FF\uE000-\uFFFD]/;a&&(m=u("[",l(m),"\\u{10000}-\\u{10FFFF}","]"));var y=/[\x20\x09\x0D\x0A]/,w=l(y),E=u(y,"+"),v=u(y,"*"),x=/[:_a-zA-Z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/;a&&(x=u("[",l(x),"\\u{10000}-\\u{10FFFF}","]"));var S=u("[",l(x),l(/[-.0-9\xB7]/),l(/[\u0300-\u036F\u203F-\u2040]/),"]"),R=u(x,S,"*"),O=u(S,"+"),k=u("&",R,";"),F=g(/&#[0-9]+;|&#x[0-9a-fA-F]+;/),W=g(k,"|",F),H=u("%",R,";"),N=g(u('"',g(/[^%&"]/,"|",H,"|",W),"*",'"'),"|",u("'",g(/[^%&']/,"|",H,"|",W),"*","'")),z=g('"',g(/[^<&"]/,"|",W),"*",'"',"|","'",g(/[^<&']/,"|",W),"*","'"),I=u(h(x,":"),h(S,":"),"*"),L=u(I,g(":",I),"?"),U=u("^",L,"$"),J=u("(",L,")"),Y=g(/"[^"]*"|'[^']*'/),P=u(/^<\?/,"(",R,")",g(E,"(",m,"*?)"),"?",/\?>/),X=/[\x20\x0D\x0Aa-zA-Z0-9-'()+,./:=?;!*#@$_%]/,M=g('"',X,'*"',"|","'",h(X,"'"),"*'"),B="<!--",Z=u(B,g(h(m,"-"),"|",u("-",h(m,"-"))),"*","-->"),K="#PCDATA",q=g(u(/\(/,v,K,g(v,/\|/,v,L),"*",v,/\)\*/),"|",u(/\(/,v,K,v,/\)/)),Q=g("EMPTY","|","ANY","|",q,"|",u(/\([^>]+\)/,/[?*+]?/)),lt=u("<!ELEMENT",E,g(L,"|",H),E,g(Q,"|",H),v,">"),nt=u("NOTATION",E,/\(/,v,R,g(v,/\|/,v,R),"*",v,/\)/),Gt=u(/\(/,v,O,g(v,/\|/,v,O),"*",v,/\)/),Rt=g(nt,"|",Gt),_t=g(/CDATA|ID|IDREF|IDREFS|ENTITY|ENTITIES|NMTOKEN|NMTOKENS/,"|",Rt),mt=g(/#REQUIRED|#IMPLIED/,"|",g(g("#FIXED",E),"?",z)),pt=u("<!ATTLIST",E,R,g(E,R,E,_t,E,mt),"*",v,">"),G="SYSTEM",j="PUBLIC",tt=g(g(G,E,Y),"|",g(j,E,M,E,Y)),st=u("^",g(g(G,E,"(?<SystemLiteralOnly>",Y,")"),"|",g(j,E,"(?<PubidLiteral>",M,")",E,"(?<SystemLiteral>",Y,")"))),et=g(E,"NDATA",E,R),rt="<!ENTITY",it=u(rt,E,R,E,g(N,"|",g(tt,et,"?")),v,">"),Ot=g(N,"|",tt),Mt=g(it,"|",u(rt,E,"%",E,R,E,Ot,v,">")),It=u(j,E,M),Dt=u("<!NOTATION",E,R,E,g(tt,"|",It),v,">"),Nt=u(v,"=",v),kt=/1[.]\d+/,Et=u(E,"version",Nt,g("'",kt,"'","|",'"',kt,'"')),bt=/[A-Za-z][-A-Za-z0-9._]*/,ce=u(/^<\?xml/,Et,g(E,"encoding",Nt,g('"',bt,'"',"|","'",bt,"'")),"?",g(E,"standalone",Nt,g("'",g("yes","|","no"),"'","|",'"',g("yes","|","no"),'"')),"?",v,/\?>/),Vt=u(m,"*?",/\]\]>/),Jt=u(/<!\[CDATA\[/,Vt);n.chars=l,n.chars_without=h,n.detectUnicodeSupport=o,n.reg=u,n.regg=g,n.AttlistDecl=pt,n.CDATA_START="<![CDATA[",n.CDATA_END="]]>",n.CDSect=Jt,n.Char=m,n.Comment=Z,n.COMMENT_START=B,n.COMMENT_END="-->",n.DOCTYPE_DECL_START="<!DOCTYPE",n.elementdecl=lt,n.EntityDecl=Mt,n.EntityValue=N,n.ExternalID=tt,n.ExternalID_match=st,n.Name=R,n.NotationDecl=Dt,n.Reference=W,n.PEReference=H,n.PI=P,n.PUBLIC=j,n.PubidLiteral=M,n.QName=L,n.QName_exact=U,n.QName_group=J,n.S=E,n.SChar_s=w,n.S_OPT=v,n.SYSTEM=G,n.SystemLiteral=Y,n.UNICODE_REPLACEMENT_CHARACTER="�",n.UNICODE_SUPPORT=a,n.XMLDecl=ce},function(i,n,s){(function(o,a){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */var l;l=function(){function h(G){return typeof G=="function"}var u=Array.isArray?Array.isArray:function(G){return Object.prototype.toString.call(G)==="[object Array]"},g=0,m=void 0,y=void 0,w=function(G,j){k[g]=G,k[g+1]=j,(g+=2)===2&&(y?y(F):I())},E=typeof window<"u"?window:void 0,v=E||{},x=v.MutationObserver||v.WebKitMutationObserver,S=typeof self>"u"&&o!==void 0&&{}.toString.call(o)==="[object process]",R=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function O(){var G=setTimeout;return function(){return G(F,1)}}var k=new Array(1e3);function F(){for(var G=0;G<g;G+=2)(0,k[G])(k[G+1]),k[G]=void 0,k[G+1]=void 0;g=0}var W,H,N,z,I=void 0;function L(G,j){var tt=this,st=new this.constructor(Y);st[J]===void 0&&_t(st);var et=tt._state;if(et){var rt=arguments[et-1];w(function(){return Gt(et,st,rt,tt._result)})}else lt(tt,st,G,j);return st}function U(G){if(G&&typeof G=="object"&&G.constructor===this)return G;var j=new this(Y);return Z(j,G),j}S?I=function(){return o.nextTick(F)}:x?(H=0,N=new x(F),z=document.createTextNode(""),N.observe(z,{characterData:!0}),I=function(){z.data=H=++H%2}):R?((W=new MessageChannel).port1.onmessage=F,I=function(){return W.port2.postMessage(0)}):I=E===void 0?function(){try{var G=Function("return this")().require("vertx");return(m=G.runOnLoop||G.runOnContext)!==void 0?function(){m(F)}:O()}catch{return O()}}():O();var J=Math.random().toString(36).substring(2);function Y(){}var P=void 0,X=1,M=2;function B(G,j,tt){j.constructor===G.constructor&&tt===L&&j.constructor.resolve===U?function(st,et){et._state===X?q(st,et._result):et._state===M?Q(st,et._result):lt(et,void 0,function(rt){return Z(st,rt)},function(rt){return Q(st,rt)})}(G,j):tt===void 0?q(G,j):h(tt)?function(st,et,rt){w(function(it){var Ot=!1,Mt=function(It,Dt,Nt,kt){try{It.call(Dt,Nt,kt)}catch(Et){return Et}}(rt,et,function(It){Ot||(Ot=!0,et!==It?Z(it,It):q(it,It))},function(It){Ot||(Ot=!0,Q(it,It))},it._label);!Ot&&Mt&&(Ot=!0,Q(it,Mt))},st)}(G,j,tt):q(G,j)}function Z(G,j){if(G===j)Q(G,new TypeError("You cannot resolve a promise with itself"));else if(et=typeof(st=j),st===null||et!=="object"&&et!=="function")q(G,j);else{var tt=void 0;try{tt=j.then}catch(rt){return void Q(G,rt)}B(G,j,tt)}var st,et}function K(G){G._onerror&&G._onerror(G._result),nt(G)}function q(G,j){G._state===P&&(G._result=j,G._state=X,G._subscribers.length!==0&&w(nt,G))}function Q(G,j){G._state===P&&(G._state=M,G._result=j,w(K,G))}function lt(G,j,tt,st){var et=G._subscribers,rt=et.length;G._onerror=null,et[rt]=j,et[rt+X]=tt,et[rt+M]=st,rt===0&&G._state&&w(nt,G)}function nt(G){var j=G._subscribers,tt=G._state;if(j.length!==0){for(var st=void 0,et=void 0,rt=G._result,it=0;it<j.length;it+=3)st=j[it],et=j[it+tt],st?Gt(tt,st,et,rt):et(rt);G._subscribers.length=0}}function Gt(G,j,tt,st){var et=h(tt),rt=void 0,it=void 0,Ot=!0;if(et){try{rt=tt(st)}catch(Mt){Ot=!1,it=Mt}if(j===rt)return void Q(j,new TypeError("A promises callback cannot return that same promise."))}else rt=st;j._state!==P||(et&&Ot?Z(j,rt):Ot===!1?Q(j,it):G===X?q(j,rt):G===M&&Q(j,rt))}var Rt=0;function _t(G){G[J]=Rt++,G._state=void 0,G._result=void 0,G._subscribers=[]}var mt=function(){function G(j,tt){this._instanceConstructor=j,this.promise=new j(Y),this.promise[J]||_t(this.promise),u(tt)?(this.length=tt.length,this._remaining=tt.length,this._result=new Array(this.length),this.length===0?q(this.promise,this._result):(this.length=this.length||0,this._enumerate(tt),this._remaining===0&&q(this.promise,this._result))):Q(this.promise,new Error("Array Methods must be provided an Array"))}return G.prototype._enumerate=function(j){for(var tt=0;this._state===P&&tt<j.length;tt++)this._eachEntry(j[tt],tt)},G.prototype._eachEntry=function(j,tt){var st=this._instanceConstructor,et=st.resolve;if(et===U){var rt=void 0,it=void 0,Ot=!1;try{rt=j.then}catch(It){Ot=!0,it=It}if(rt===L&&j._state!==P)this._settledAt(j._state,tt,j._result);else if(typeof rt!="function")this._remaining--,this._result[tt]=j;else if(st===pt){var Mt=new st(Y);Ot?Q(Mt,it):B(Mt,j,rt),this._willSettleAt(Mt,tt)}else this._willSettleAt(new st(function(It){return It(j)}),tt)}else this._willSettleAt(et(j),tt)},G.prototype._settledAt=function(j,tt,st){var et=this.promise;et._state===P&&(this._remaining--,j===M?Q(et,st):this._result[tt]=st),this._remaining===0&&q(et,this._result)},G.prototype._willSettleAt=function(j,tt){var st=this;lt(j,void 0,function(et){return st._settledAt(X,tt,et)},function(et){return st._settledAt(M,tt,et)})},G}(),pt=function(){function G(j){this[J]=Rt++,this._result=this._state=void 0,this._subscribers=[],Y!==j&&(typeof j!="function"&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof G?function(tt,st){try{st(function(et){Z(tt,et)},function(et){Q(tt,et)})}catch(et){Q(tt,et)}}(this,j):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return G.prototype.catch=function(j){return this.then(null,j)},G.prototype.finally=function(j){var tt=this,st=tt.constructor;return h(j)?tt.then(function(et){return st.resolve(j()).then(function(){return et})},function(et){return st.resolve(j()).then(function(){throw et})}):tt.then(j,j)},G}();return pt.prototype.then=L,pt.all=function(G){return new mt(this,G).promise},pt.race=function(G){var j=this;return u(G)?new j(function(tt,st){for(var et=G.length,rt=0;rt<et;rt++)j.resolve(G[rt]).then(tt,st)}):new j(function(tt,st){return st(new TypeError("You must pass an array to race."))})},pt.resolve=U,pt.reject=function(G){var j=new this(Y);return Q(j,G),j},pt._setScheduler=function(G){y=G},pt._setAsap=function(G){w=G},pt._asap=w,pt.polyfill=function(){var G=void 0;if(a!==void 0)G=a;else if(typeof self<"u")G=self;else try{G=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var j=G.Promise;if(j){var tt=null;try{tt=Object.prototype.toString.call(j.resolve())}catch{}if(tt==="[object Promise]"&&!j.cast)return}G.Promise=pt},pt.Promise=pt,pt},i.exports=l()}).call(this,s(10),s(11))},function(i,n,s){i.exports=s(15)},function(i,n){var s,o,a=i.exports={};function l(){throw new Error("setTimeout has not been defined")}function h(){throw new Error("clearTimeout has not been defined")}function u(R){if(s===setTimeout)return setTimeout(R,0);if((s===l||!s)&&setTimeout)return s=setTimeout,setTimeout(R,0);try{return s(R,0)}catch{try{return s.call(null,R,0)}catch{return s.call(this,R,0)}}}(function(){try{s=typeof setTimeout=="function"?setTimeout:l}catch{s=l}try{o=typeof clearTimeout=="function"?clearTimeout:h}catch{o=h}})();var g,m=[],y=!1,w=-1;function E(){y&&g&&(y=!1,g.length?m=g.concat(m):w=-1,m.length&&v())}function v(){if(!y){var R=u(E);y=!0;for(var O=m.length;O;){for(g=m,m=[];++w<O;)g&&g[w].run();w=-1,O=m.length}g=null,y=!1,function(k){if(o===clearTimeout)return clearTimeout(k);if((o===h||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(k);try{return o(k)}catch{try{return o.call(null,k)}catch{return o.call(this,k)}}}(R)}}function x(R,O){this.fun=R,this.array=O}function S(){}a.nextTick=function(R){var O=new Array(arguments.length-1);if(arguments.length>1)for(var k=1;k<arguments.length;k++)O[k-1]=arguments[k];m.push(new x(R,O)),m.length!==1||y||u(v)},x.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=S,a.addListener=S,a.once=S,a.off=S,a.removeListener=S,a.removeAllListeners=S,a.emit=S,a.prependListener=S,a.prependOnceListener=S,a.listeners=function(R){return[]},a.binding=function(R){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(R){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(i,n){var s;s=function(){return this}();try{s=s||new Function("return this")()}catch{typeof window=="object"&&(s=window)}i.exports=s},function(i,n,s){var o=s(0),a=s(6),l=s(2),h=s(13),u=s(14),g=a.DOMImplementation,m=o.hasDefaultHTMLNamespace,y=o.isHTMLMimeType,w=o.isValidMimeType,E=o.MIME_TYPE,v=o.NAMESPACE,x=l.ParseError,S=u.XMLReader;function R(N){return N.replace(/\r[\n\u0085]/g,`
`).replace(/[\r\u0085\u2028]/g,`
`)}function O(N){if(N=N||{locator:!0},this.assign=N.assign||o.assign,this.domHandler=N.domHandler||k,this.onError=N.onError||N.errorHandler,N.errorHandler&&typeof N.errorHandler!="function")throw new TypeError("errorHandler object is no longer supported, switch to onError!");N.errorHandler&&N.errorHandler("warning","The `errorHandler` option has been deprecated, use `onError` instead!",this),this.normalizeLineEndings=N.normalizeLineEndings||R,this.locator=!!N.locator,this.xmlns=this.assign(Object.create(null),N.xmlns)}function k(N){var z=N||{};this.mimeType=z.mimeType||E.XML_APPLICATION,this.defaultNamespace=z.defaultNamespace||null,this.cdata=!1,this.currentElement=void 0,this.doc=void 0,this.locator=void 0,this.onError=z.onError}function F(N,z){z.lineNumber=N.lineNumber,z.columnNumber=N.columnNumber}function W(N,z,I){return typeof N=="string"?N.substr(z,I):N.length>=z+I||z?new java.lang.String(N,z,I)+"":N}function H(N,z){N.currentElement?N.currentElement.appendChild(z):N.doc.appendChild(z)}O.prototype.parseFromString=function(N,z){if(!w(z))throw new TypeError('DOMParser.parseFromString: the provided mimeType "'+z+'" is not valid.');var I=this.assign(Object.create(null),this.xmlns),L=h.XML_ENTITIES,U=I[""]||null;m(z)?(L=h.HTML_ENTITIES,U=v.HTML):z===E.XML_SVG_IMAGE&&(U=v.SVG),I[""]=U,I.xml=I.xml||v.XML;var J=new this.domHandler({mimeType:z,defaultNamespace:U,onError:this.onError}),Y=this.locator?{}:void 0;this.locator&&J.setDocumentLocator(Y);var P=new S;return P.errorHandler=J,P.domBuilder=J,!o.isHTMLMimeType(z)&&typeof N!="string"&&P.errorHandler.fatalError("source is not a string"),P.parse(this.normalizeLineEndings(String(N)),I,L),J.doc.documentElement||P.errorHandler.fatalError("missing root element"),J.doc},k.prototype={startDocument:function(){var N=new g;this.doc=y(this.mimeType)?N.createHTMLDocument(!1):N.createDocument(this.defaultNamespace,"")},startElement:function(N,z,I,L){var U=this.doc,J=U.createElementNS(N,I||z),Y=L.length;H(this,J),this.currentElement=J,this.locator&&F(this.locator,J);for(var P=0;P<Y;P++){N=L.getURI(P);var X=L.getValue(P),M=(I=L.getQName(P),U.createAttributeNS(N,I));this.locator&&F(L.getLocator(P),M),M.value=M.nodeValue=X,J.setAttributeNode(M)}},endElement:function(N,z,I){this.currentElement=this.currentElement.parentNode},startPrefixMapping:function(N,z){},endPrefixMapping:function(N){},processingInstruction:function(N,z){var I=this.doc.createProcessingInstruction(N,z);this.locator&&F(this.locator,I),H(this,I)},ignorableWhitespace:function(N,z,I){},characters:function(N,z,I){if(N=W.apply(this,arguments)){if(this.cdata)var L=this.doc.createCDATASection(N);else L=this.doc.createTextNode(N);this.currentElement?this.currentElement.appendChild(L):/^\s*$/.test(N)&&this.doc.appendChild(L),this.locator&&F(this.locator,L)}},skippedEntity:function(N){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(N){N&&(N.lineNumber=0),this.locator=N},comment:function(N,z,I){N=W.apply(this,arguments);var L=this.doc.createComment(N);this.locator&&F(this.locator,L),H(this,L)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(N,z,I,L){var U=this.doc.implementation;if(U&&U.createDocumentType){var J=U.createDocumentType(N,z,I,L);this.locator&&F(this.locator,J),H(this,J),this.doc.doctype=J}},reportError:function(N,z){if(typeof this.onError=="function")try{this.onError(N,z,this)}catch(I){throw new x("Reporting "+N+' "'+z+'" caused '+I,this.locator)}else console.error("[xmldom "+N+"]	"+z,function(I){if(I)return`
@#[line:`+I.lineNumber+",col:"+I.columnNumber+"]"}(this.locator))},warning:function(N){this.reportError("warning",N)},error:function(N){this.reportError("error",N)},fatalError:function(N){throw this.reportError("fatalError",N),new x(N,this.locator)}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(N){k.prototype[N]=function(){return null}}),n.__DOMHandler=k,n.DOMParser=O,n.normalizeLineEndings=R,n.onErrorStopParsing=function(N){if(N==="error")throw"onErrorStopParsing"},n.onWarningStopParsing=function(){throw"onWarningStopParsing"}},function(i,n,s){var o=s(0).freeze;n.XML_ENTITIES=o({amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}),n.HTML_ENTITIES=o({Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",AMP:"&",amp:"&",And:"⩓",and:"∧",andand:"⩕",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsd:"∡",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",ap:"≈",apacir:"⩯",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",Barwed:"⌆",barwed:"⌅",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",Because:"∵",because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxDL:"╗",boxDl:"╖",boxdL:"╕",boxdl:"┐",boxDR:"╔",boxDr:"╓",boxdR:"╒",boxdr:"┌",boxH:"═",boxh:"─",boxHD:"╦",boxHd:"╤",boxhD:"╥",boxhd:"┬",boxHU:"╩",boxHu:"╧",boxhU:"╨",boxhu:"┴",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxUL:"╝",boxUl:"╜",boxuL:"╛",boxul:"┘",boxUR:"╚",boxUr:"╙",boxuR:"╘",boxur:"└",boxV:"║",boxv:"│",boxVH:"╬",boxVh:"╫",boxvH:"╪",boxvh:"┼",boxVL:"╣",boxVl:"╢",boxvL:"╡",boxvl:"┤",boxVR:"╠",boxVr:"╟",boxvR:"╞",boxvr:"├",bprime:"‵",Breve:"˘",breve:"˘",brvbar:"¦",Bscr:"ℬ",bscr:"𝒷",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsol:"\\",bsolb:"⧅",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",Cap:"⋒",cap:"∩",capand:"⩄",capbrcup:"⩉",capcap:"⩋",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",CenterDot:"·",centerdot:"·",Cfr:"ℭ",cfr:"𝔠",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",cir:"○",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",Colon:"∷",colon:":",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",Conint:"∯",conint:"∮",ContourIntegral:"∮",Copf:"ℂ",copf:"𝕔",coprod:"∐",Coproduct:"∐",COPY:"©",copy:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",Cross:"⨯",cross:"✗",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",Cup:"⋓",cup:"∪",cupbrcap:"⩈",CupCap:"≍",cupcap:"⩆",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",Dagger:"‡",dagger:"†",daleth:"ℸ",Darr:"↡",dArr:"⇓",darr:"↓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",DD:"ⅅ",dd:"ⅆ",ddagger:"‡",ddarr:"⇊",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",Diamond:"⋄",diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrow:"↓",Downarrow:"⇓",downarrow:"↓",DownArrowBar:"⤓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVector:"↽",DownLeftVectorBar:"⥖",DownRightTeeVector:"⥟",DownRightVector:"⇁",DownRightVectorBar:"⥗",DownTee:"⊤",DownTeeArrow:"↧",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",ecir:"≖",Ecirc:"Ê",ecirc:"ê",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",eDot:"≑",edot:"ė",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp:" ",emsp13:" ",emsp14:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",Escr:"ℰ",escr:"ℯ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",ExponentialE:"ⅇ",exponentiale:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",ForAll:"∀",forall:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",Fscr:"ℱ",fscr:"𝒻",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",gE:"≧",ge:"≥",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",ges:"⩾",gescc:"⪩",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",Gg:"⋙",gg:"≫",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gl:"≷",gla:"⪥",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gnE:"≩",gne:"⪈",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",Gt:"≫",GT:">",gt:">",gtcc:"⪧",gtcir:"⩺",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",hArr:"⇔",harr:"↔",harrcir:"⥈",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",Hfr:"ℌ",hfr:"𝔥",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",Hopf:"ℍ",hopf:"𝕙",horbar:"―",HorizontalLine:"─",Hscr:"ℋ",hscr:"𝒽",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",Ifr:"ℑ",ifr:"𝔦",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Im:"ℑ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",imof:"⊷",imped:"Ƶ",Implies:"⇒",in:"∈",incare:"℅",infin:"∞",infintie:"⧝",inodot:"ı",Int:"∬",int:"∫",intcal:"⊺",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",Iscr:"ℐ",iscr:"𝒾",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",Lang:"⟪",lang:"⟨",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",Larr:"↞",lArr:"⇐",larr:"←",larrb:"⇤",larrbfs:"⤟",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",lat:"⪫",lAtail:"⤛",latail:"⤙",late:"⪭",lates:"⪭︀",lBarr:"⤎",lbarr:"⤌",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",lE:"≦",le:"≤",LeftAngleBracket:"⟨",LeftArrow:"←",Leftarrow:"⇐",leftarrow:"←",LeftArrowBar:"⇤",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVector:"⇃",LeftDownVectorBar:"⥙",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrow:"↔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTee:"⊣",LeftTeeArrow:"↤",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangle:"⊲",LeftTriangleBar:"⧏",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVector:"↿",LeftUpVectorBar:"⥘",LeftVector:"↼",LeftVectorBar:"⥒",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",les:"⩽",lescc:"⪨",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",Ll:"⋘",ll:"≪",llarr:"⇇",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoust:"⎰",lmoustache:"⎰",lnap:"⪉",lnapprox:"⪉",lnE:"≨",lne:"⪇",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftarrow:"⟵",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longleftrightarrow:"⟷",longmapsto:"⟼",LongRightArrow:"⟶",Longrightarrow:"⟹",longrightarrow:"⟶",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",Lscr:"ℒ",lscr:"𝓁",Lsh:"↰",lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",Lt:"≪",LT:"<",lt:"<",ltcc:"⪦",ltcir:"⩹",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",mid:"∣",midast:"*",midcir:"⫰",middot:"·",minus:"−",minusb:"⊟",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",Mscr:"ℳ",mscr:"𝓂",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natur:"♮",natural:"♮",naturals:"ℕ",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",ne:"≠",nearhk:"⤤",neArr:"⇗",nearr:"↗",nearrow:"↗",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:`
`,nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nhArr:"⇎",nharr:"↮",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlArr:"⇍",nlarr:"↚",nldr:"‥",nlE:"≦̸",nle:"≰",nLeftarrow:"⇍",nleftarrow:"↚",nLeftrightarrow:"⇎",nleftrightarrow:"↮",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",Nopf:"ℕ",nopf:"𝕟",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangle:"⋪",NotLeftTriangleBar:"⧏̸",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangle:"⋫",NotRightTriangleBar:"⧐̸",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",npar:"∦",nparallel:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",npre:"⪯̸",nprec:"⊀",npreceq:"⪯̸",nrArr:"⇏",nrarr:"↛",nrarrc:"⤳̸",nrarrw:"↝̸",nRightarrow:"⇏",nrightarrow:"↛",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nVDash:"⊯",nVdash:"⊮",nvDash:"⊭",nvdash:"⊬",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwArr:"⇖",nwarr:"↖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",ocir:"⊚",Ocirc:"Ô",ocirc:"ô",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",Or:"⩔",or:"∨",orarr:"↻",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",Otimes:"⨷",otimes:"⊗",otimesas:"⨶",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",par:"∥",para:"¶",parallel:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plus:"+",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",Popf:"ℙ",popf:"𝕡",pound:"£",Pr:"⪻",pr:"≺",prap:"⪷",prcue:"≼",prE:"⪳",pre:"⪯",prec:"≺",precapprox:"⪷",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",precsim:"≾",Prime:"″",prime:"′",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportion:"∷",Proportional:"∝",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",Qopf:"ℚ",qopf:"𝕢",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",QUOT:'"',quot:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",Rang:"⟫",rang:"⟩",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",Rarr:"↠",rArr:"⇒",rarr:"→",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",rAtail:"⤜",ratail:"⤚",ratio:"∶",rationals:"ℚ",RBarr:"⤐",rBarr:"⤏",rbarr:"⤍",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",Re:"ℜ",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",rect:"▭",REG:"®",reg:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",Rfr:"ℜ",rfr:"𝔯",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrow:"→",Rightarrow:"⇒",rightarrow:"→",RightArrowBar:"⇥",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVector:"⇂",RightDownVectorBar:"⥕",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTee:"⊢",RightTeeArrow:"↦",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangle:"⊳",RightTriangleBar:"⧐",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVector:"↾",RightUpVectorBar:"⥔",RightVector:"⇀",RightVectorBar:"⥓",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoust:"⎱",rmoustache:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",Ropf:"ℝ",ropf:"𝕣",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",Rscr:"ℛ",rscr:"𝓇",Rsh:"↱",rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",Sc:"⪼",sc:"≻",scap:"⪸",Scaron:"Š",scaron:"š",sccue:"≽",scE:"⪴",sce:"⪰",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdot:"⋅",sdotb:"⊡",sdote:"⩦",searhk:"⤥",seArr:"⇘",searr:"↘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",sol:"/",solb:"⧄",solbar:"⌿",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",squ:"□",Square:"□",square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",Sub:"⋐",sub:"⊂",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",Subset:"⋐",subset:"⊂",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succ:"≻",succapprox:"⪸",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",Sum:"∑",sum:"∑",sung:"♪",Sup:"⋑",sup:"⊃",sup1:"¹",sup2:"²",sup3:"³",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",Supset:"⋑",supset:"⊃",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swArr:"⇙",swarr:"↙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"	",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",Therefore:"∴",therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",thinsp:" ",ThinSpace:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",Tilde:"∼",tilde:"˜",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",times:"×",timesb:"⊠",timesbar:"⨱",timesd:"⨰",tint:"∭",toea:"⤨",top:"⊤",topbot:"⌶",topcir:"⫱",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",TRADE:"™",trade:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",Uarr:"↟",uArr:"⇑",uarr:"↑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrow:"↑",Uparrow:"⇑",uparrow:"↑",UpArrowBar:"⤒",UpArrowDownArrow:"⇅",UpDownArrow:"↕",Updownarrow:"⇕",updownarrow:"↕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",Upsi:"ϒ",upsi:"υ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTee:"⊥",UpTeeArrow:"↥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",vArr:"⇕",varr:"↕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",Vbar:"⫫",vBar:"⫨",vBarv:"⫩",Vcy:"В",vcy:"в",VDash:"⊫",Vdash:"⊩",vDash:"⊨",vdash:"⊢",Vdashl:"⫦",Vee:"⋁",vee:"∨",veebar:"⊻",veeeq:"≚",vellip:"⋮",Verbar:"‖",verbar:"|",Vert:"‖",vert:"|",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",Wedge:"⋀",wedge:"∧",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xhArr:"⟺",xharr:"⟷",Xi:"Ξ",xi:"ξ",xlArr:"⟸",xlarr:"⟵",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrArr:"⟹",xrarr:"⟶",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",Yuml:"Ÿ",yuml:"ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",Zfr:"ℨ",zfr:"𝔷",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",Zopf:"ℤ",zopf:"𝕫",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}),n.entityMap=n.HTML_ENTITIES},function(i,n,s){var o=s(0),a=s(7),l=s(2),h=o.isHTMLEscapableRawTextElement,u=o.isHTMLMimeType,g=o.isHTMLRawTextElement,m=o.hasOwn,y=o.NAMESPACE,w=l.ParseError,E=l.DOMException;function v(){}v.prototype={parse:function(I,L,U){var J=this.domBuilder;J.startDocument(),F(L,L=Object.create(null)),function(Y,P,X,M,B){var Z=u(M.mimeType);Y.indexOf(a.UNICODE_REPLACEMENT_CHARACTER)>=0&&B.warning("Unicode replacement character detected, source encoding issues?");function K(ht){if(ht>65535){var wt=55296+((ht-=65536)>>10),Wt=56320+(1023&ht);return String.fromCharCode(wt,Wt)}return String.fromCharCode(ht)}function q(ht){var wt=ht[ht.length-1]===";"?ht:ht+";";if(!Z&&wt!==ht)return B.error("EntityRef: expecting ;"),ht;var Wt=a.Reference.exec(wt);if(!Wt||Wt[0].length!==wt.length)return B.error("entity not matching Reference production: "+ht),ht;var ae=wt.slice(1,-1);return m(X,ae)?X[ae]:ae.charAt(0)==="#"?K(parseInt(ae.substr(1).replace("x","0x"))):(B.error("entity not found:"+ht),ht)}function Q(ht){if(ht>G){var wt=Y.substring(G,ht).replace(x,q);_t&&lt(G),M.characters(wt,0,ht-G),G=ht}}function lt(ht,wt){for(;ht>=Gt&&(wt=Rt.exec(Y));)nt=wt.index,Gt=nt+wt[0].length,_t.lineNumber++;_t.columnNumber=ht-nt+1}for(var nt=0,Gt=0,Rt=/.*(?:\r\n?|\n)|.*$/g,_t=M.locator,mt=[{currentNSMap:P}],pt=[],G=0;;){try{var j=Y.indexOf("<",G);if(j<0){if(!Z&&pt.length>0)return B.fatalError("unclosed xml tag(s): "+pt.join(", "));if(!Y.substring(G).match(/^\s*$/)){var tt=M.doc,st=tt.createTextNode(Y.substr(G));if(tt.documentElement)return B.error("Extra content at the end of the document");tt.appendChild(st),M.currentElement=st}return}if(j>G){var et=Y.substring(G,j);Z||pt.length!==0||(et=et.replace(new RegExp(a.S_OPT.source,"g"),""))&&B.error("Unexpected content outside root element: '"+et+"'"),Q(j)}switch(Y.charAt(j+1)){case"/":var rt=Y.indexOf(">",j+2),it=Y.substring(j+2,rt>0?rt:void 0);if(!it)return B.fatalError("end tag name missing");var Ot=rt>0&&a.reg("^",a.QName_group,a.S_OPT,"$").exec(it);if(!Ot)return B.fatalError('end tag name contains invalid characters: "'+it+'"');if(!M.currentElement&&!M.doc.documentElement)return;var Mt=pt[pt.length-1]||M.currentElement.tagName||M.doc.documentElement.tagName||"";if(Mt!==Ot[1]){var It=Ot[1].toLowerCase();if(!Z||Mt.toLowerCase()!==It)return B.fatalError('Opening and ending tag mismatch: "'+Mt+'" != "'+it+'"')}var Dt=mt.pop();pt.pop();var Nt=Dt.localNSMap;if(M.endElement(Dt.uri,Dt.localName,Mt),Nt)for(var kt in Nt)m(Nt,kt)&&M.endPrefixMapping(kt);rt++;break;case"?":_t&&lt(j),rt=N(Y,j,M,B);break;case"!":_t&&lt(j),rt=H(Y,j,M,B,Z);break;default:_t&&lt(j);var Et=new z,bt=mt[mt.length-1].currentNSMap,ce=(rt=R(Y,j,Et,bt,q,B,Z),Et.length);if(Et.closed||(Z&&o.isHTMLVoidElement(Et.tagName)?Et.closed=!0:pt.push(Et.tagName)),_t&&ce){for(var Vt=S(_t,{}),Jt=0;Jt<ce;Jt++){var Tt=Et[Jt];lt(Tt.offset),Tt.locator=S(_t,{})}M.locator=Vt,O(Et,M,bt)&&mt.push(Et),M.locator=_t}else O(Et,M,bt)&&mt.push(Et);Z&&!Et.closed?rt=k(Y,rt,Et.tagName,q,M):rt++}}catch(ht){if(ht instanceof w)throw ht;if(ht instanceof E)throw new w(ht.name+": "+ht.message,M.locator,ht);B.error("element parse error: "+ht),rt=-1}rt>G?G=rt:Q(Math.max(j,G)+1)}}(I,L,U,J,this.errorHandler),J.endDocument()}};var x=/&#?\w+;?/g;function S(I,L){return L.lineNumber=I.lineNumber,L.columnNumber=I.columnNumber,L}function R(I,L,U,J,Y,P,X){function M(lt,nt,Gt){return m(U.attributeNames,lt)?P.fatalError("Attribute "+lt+" redefined"):!X&&nt.indexOf("<")>=0?P.fatalError("Unescaped '<' not allowed in attributes values"):void U.addValue(lt,nt.replace(/[\t\n\r]/g," ").replace(x,Y),Gt)}for(var B,Z=++L,K=0;;){var q=I.charAt(Z);switch(q){case"=":if(K===1)B=I.slice(L,Z),K=3;else{if(K!==2)throw new Error("attribute equal must after attrName");K=3}break;case"'":case'"':if(K===3||K===1){if(K===1&&(P.warning('attribute value must after "="'),B=I.slice(L,Z)),L=Z+1,!((Z=I.indexOf(q,L))>0))throw new Error("attribute value no end '"+q+"' match");M(B,Q=I.slice(L,Z),L-1),K=5}else{if(K!=4)throw new Error('attribute value must after "="');M(B,Q=I.slice(L,Z),L),P.warning('attribute "'+B+'" missed start quot('+q+")!!"),L=Z+1,K=5}break;case"/":switch(K){case 0:U.setTagName(I.slice(L,Z));case 5:case 6:case 7:K=7,U.closed=!0;case 4:case 1:break;case 2:U.closed=!0;break;default:throw new Error("attribute invalid close char('/')")}break;case"":return P.error("unexpected end of input"),K==0&&U.setTagName(I.slice(L,Z)),Z;case">":switch(K){case 0:U.setTagName(I.slice(L,Z));case 5:case 6:case 7:break;case 4:case 1:(Q=I.slice(L,Z)).slice(-1)==="/"&&(U.closed=!0,Q=Q.slice(0,-1));case 2:K===2&&(Q=B),K==4?(P.warning('attribute "'+Q+'" missed quot(")!'),M(B,Q,L)):(X||P.warning('attribute "'+Q+'" missed value!! "'+Q+'" instead!!'),M(Q,Q,L));break;case 3:if(!X)return P.fatalError(`AttValue: ' or " expected`)}return Z;case"":q=" ";default:if(q<=" ")switch(K){case 0:U.setTagName(I.slice(L,Z)),K=6;break;case 1:B=I.slice(L,Z),K=2;break;case 4:var Q=I.slice(L,Z);P.warning('attribute "'+Q+'" missed quot(")!!'),M(B,Q,L);case 5:K=6}else switch(K){case 2:X||P.warning('attribute "'+B+'" missed value!! "'+B+'" instead2!!'),M(B,B,L),L=Z,K=1;break;case 5:P.warning('attribute space is required"'+B+'"!!');case 6:K=1,L=Z;break;case 3:K=4,L=Z;break;case 7:throw new Error("elements closed character '/' and '>' must be connected to")}}Z++}}function O(I,L,U){for(var J=I.tagName,Y=null,P=I.length;P--;){var X=I[P],M=X.qName,B=X.value;if((Q=M.indexOf(":"))>0)var Z=X.prefix=M.slice(0,Q),K=M.slice(Q+1),q=Z==="xmlns"&&K;else K=M,Z=null,q=M==="xmlns"&&"";X.localName=K,q!==!1&&(Y==null&&(Y=Object.create(null),F(U,U=Object.create(null))),U[q]=Y[q]=B,X.uri=y.XMLNS,L.startPrefixMapping(q,B))}for(P=I.length;P--;)(X=I[P]).prefix&&(X.prefix==="xml"&&(X.uri=y.XML),X.prefix!=="xmlns"&&(X.uri=U[X.prefix]));var Q;(Q=J.indexOf(":"))>0?(Z=I.prefix=J.slice(0,Q),K=I.localName=J.slice(Q+1)):(Z=null,K=I.localName=J);var lt=I.uri=U[Z||""];if(L.startElement(lt,K,J,I),!I.closed)return I.currentNSMap=U,I.localNSMap=Y,!0;if(L.endElement(lt,K,J),Y)for(Z in Y)m(Y,Z)&&L.endPrefixMapping(Z)}function k(I,L,U,J,Y){var P=h(U);if(P||g(U)){var X=I.indexOf("</"+U+">",L),M=I.substring(L+1,X);return P&&(M=M.replace(x,J)),Y.characters(M,0,M.length),X}return L+1}function F(I,L){for(var U in I)m(I,U)&&(L[U]=I[U])}function W(I,L){var U=L;function J(X){return X=X||0,I.charAt(U+X)}function Y(X){U+=X=X||1}function P(){return I.substring(U)}return{char:J,getIndex:function(){return U},getMatch:function(X){var M=a.reg("^",X).exec(P());return M?(Y(M[0].length),M[0]):null},getSource:function(){return I},skip:Y,skipBlanks:function(){for(var X=0;U<I.length;){var M=J();if(M!==" "&&M!==`
`&&M!=="	"&&M!=="\r")return X;X++,Y()}return-1},substringFromIndex:P,substringStartsWith:function(X){return I.substring(U,U+X.length)===X}}}function H(I,L,U,J,Y){var P=W(I,L);switch(P.char(2)){case"-":var X=P.getMatch(a.Comment);return X?(U.comment(X,a.COMMENT_START.length,X.length-a.COMMENT_START.length-a.COMMENT_END.length),P.getIndex()):J.fatalError("comment is not well-formed at position "+P.getIndex());case"[":var M=P.getMatch(a.CDSect);return M?Y||U.currentElement?(U.startCDATA(),U.characters(M,a.CDATA_START.length,M.length-a.CDATA_START.length-a.CDATA_END.length),U.endCDATA(),P.getIndex()):J.fatalError("CDATA outside of element"):J.fatalError("Invalid CDATA starting at position "+L);case"D":if(U.doc&&U.doc.documentElement)return J.fatalError("Doctype not allowed inside or after documentElement at position "+P.getIndex());if(!P.substringStartsWith(a.DOCTYPE_DECL_START))return J.fatalError("Expected "+a.DOCTYPE_DECL_START+" at position "+P.getIndex());if(P.skip(a.DOCTYPE_DECL_START.length),P.skipBlanks()<1)return J.fatalError("Expected whitespace after "+a.DOCTYPE_DECL_START+" at position "+P.getIndex());var B={name:void 0,publicId:void 0,systemId:void 0,internalSubset:void 0};if(B.name=P.getMatch(a.Name),!B.name)return J.fatalError("doctype name missing or contains unexpected characters at position "+P.getIndex());if(P.skipBlanks(),P.substringStartsWith(a.PUBLIC)||P.substringStartsWith(a.SYSTEM)){var Z=a.ExternalID_match.exec(P.substringFromIndex());if(!Z)return J.fatalError("doctype external id is not well-formed at position "+P.getIndex());Z.groups.SystemLiteralOnly!==void 0?B.systemId=Z.groups.SystemLiteralOnly:(B.systemId=Z.groups.SystemLiteral,B.publicId=Z.groups.PubidLiteral),P.skip(Z[0].length)}return P.skipBlanks(),B.internalSubset=function(K,q){function Q(_t,mt){var pt=a.PI.exec(_t.substringFromIndex());return pt?pt[1].toLowerCase()==="xml"?mt.fatalError("xml declaration is only allowed at the start of the document, but found at position "+_t.getIndex()):(_t.skip(pt[0].length),pt[0]):mt.fatalError("processing instruction is not well-formed at position "+_t.getIndex())}var lt=K.getSource();if(K.char()==="["){K.skip(1);for(var nt=K.getIndex();K.getIndex()<lt.length;){if(K.skipBlanks(),K.char()==="]"){var Gt=lt.substring(nt,K.getIndex());return K.skip(1),Gt}var Rt=null;if(K.char()==="<"&&K.char(1)==="!")switch(K.char(2)){case"E":K.char(3)==="L"?Rt=K.getMatch(a.elementdecl):K.char(3)==="N"&&(Rt=K.getMatch(a.EntityDecl));break;case"A":Rt=K.getMatch(a.AttlistDecl);break;case"N":Rt=K.getMatch(a.NotationDecl);break;case"-":Rt=K.getMatch(a.Comment)}else if(K.char()==="<"&&K.char(1)==="?")Rt=Q(K,q);else{if(K.char()!=="%")return q.fatalError("Error detected in Markup declaration");Rt=K.getMatch(a.PEReference)}if(!Rt)return q.fatalError("Error in internal subset at position "+K.getIndex())}return q.fatalError("doctype internal subset is not well-formed, missing ]")}}(P,J),P.skipBlanks(),P.char()!==">"?J.fatalError("doctype not terminated with > at position "+P.getIndex()):(P.skip(1),U.startDTD(B.name,B.publicId,B.systemId,B.internalSubset),U.endDTD(),P.getIndex());default:return J.fatalError('Not well-formed XML starting with "<!" at position '+L)}}function N(I,L,U,J){var Y=I.substring(L).match(a.PI);if(!Y)return J.fatalError("Invalid processing instruction starting at position "+L);if(Y[1].toLowerCase()==="xml"){if(L>0)return J.fatalError("processing instruction at position "+L+" is an xml declaration which is only at the start of the document");if(!a.XMLDecl.test(I.substring(L)))return J.fatalError("xml declaration is not well-formed")}return U.processingInstruction(Y[1],Y[2]),L+Y[0].length}function z(){this.attributeNames=Object.create(null)}z.prototype={setTagName:function(I){if(!a.QName_exact.test(I))throw new Error("invalid tagName:"+I);this.tagName=I},addValue:function(I,L,U){if(!a.QName_exact.test(I))throw new Error("invalid attribute:"+I);this.attributeNames[I]=this.length,this[this.length++]={qName:I,value:L,offset:U}},length:0,getLocalName:function(I){return this[I].localName},getLocator:function(I){return this[I].locator},getQName:function(I){return this[I].qName},getURI:function(I){return this[I].uri},getValue:function(I){return this[I].value}},n.XMLReader=v,n.parseUtils=W,n.parseDoctypeCommentOrCData=H},function(i,n,s){s.r(n),s.d(n,"servicesVersion",function(){return qs}),s.d(n,"servicesDate",function(){return Xs});var o=s(3),a={getLogger:function(c){if(d===void 0)var d={env:{VERBOSE:!1}};d.env.VERBOSE?o.enableAll():o.disableAll();var p=c||"default";return o.getLogger(p)}},l={PARAM_MISSING:"Parameter(s) '%var%' missing",PARAM_EMPTY:"Parameter(s) '%var%' empty",PARAM_TYPE:"Wrong type(s) for parameter(s) '%var%'",PARAM_FORMAT:"Parameter(s) '%var%' not correctly formatted",PARAM_NOT_SUPPORT:"Value(s) for parameter(s) '%var%' not supported",PARAM_NOT_SUPPORT_NODEJS:"Value(s) for parameter(s) '%var%' not supported to NodeJS",PARAM_UNKNOWN:"Value(s) for parameter(s) '%var%' unknown",SERVICE_REQUEST_BUILD:"An error occurred during the request building of the service",SERVICE_REQUEST_EMPTY:"The request sent to the service is empty",SERVICE_RESPONSE_EXCEPTION:"The service returned an exception : '%var%'",SERVICE_RESPONSE_EXCEPTION_2:"The service returned an exception",SERVICE_RESPONSE_ANALYSE:"An error occurred while parsing the response '%var%' of the service",SERVICE_RESPONSE_ANALYSE_2:"An unknown error occurred while parsing the response",SERVICE_RESPONSE_EMPTY:"The response of the service is empty",SERVICE_RESPONSE_EMPTY_2:"The response from the service could not be analyzed or is empty",SERVICE_RESPONSE_FORMAT:"The format of the service response is not supported (handled format(s) : '%var%')",SERVICE_RESPONSE_FORMAT_2:"The format of the service response is not supported",SERVICE_RESPONSE_FORMAT_3:"No suggestion matching the search",CLASS_CONSTRUCTOR:"'%var%' constructor cannot be called as a function.",getMessage:function(c,d){if(Object.keys(arguments).length===0)return"Message indefined !";var p=Array.prototype.slice.call(arguments),T=p.shift(),C=p,D=this[T];try{D=Array.isArray(C)&&C.length>0?D.replace("%var%",C.join(" - ")):D.replace("%var%","%var% (not specified)")}catch{}return D}},h=l,u={normalyzeParameters:function(c){var d=null;if(c){var p=[];for(var T in c)if(c.hasOwnProperty(T)){var C=c[T];C||(C=""),p.push(T+"="+C)}d=p.join("&")}return d},normalyzeUrl:function(c,d,p){var T=c;if(c){if(c.split("?").length-1>=2){var C=c.search(/\?/)+1;T=c.substring(0,C)+c.slice(C).replace(/\?/g,"&")}var D=c.indexOf("?");D===-1&&(T+="?"),D!==-1&&D!==c.length-1&&(T+="&")}return d&&(T+=typeof d=="string"?d=d.replace("?",""):this.normalyzeParameters(d)),p&&(T=encodeURIComponent(T)),T},indent:function(c,d){return new Array((c||0)+1).join("	")+d}},g=s(8),m=s.n(g);function y(c){return y=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},y(c)}var w,E={call:function(c){var d=a.getLogger("XHR");if(d.trace("[XHR::call()]"),m.a.polyfill(),!c.url)throw new Error("missing parameter : url is not defined !");if(!c.method)throw new Error("missing parameter : method is not defined !");c.format||(c.format="text");var p={};switch(p.url=c.url,p.data=c.data?c.data:null,p.method=c.method,p.timeOut=c.timeOut||0,p.scope=c.scope||this,p.proxy=c.proxy||null,p.content=c.content||null,p.headers=c.headers||{referer:"http://localhost"},c.method){case"DELETE":case"GET":break;case"PUT":case"POST":p.content=c.content?c.content:"application/x-www-form-urlencoded",p.headers=c.headers?c.headers:{referer:"http://localhost"};break;case"HEAD":case"OPTIONS":throw new Error("HTTP method not yet supported !");default:throw new Error("HTTP method unknown !")}switch(c.format){case"text":this.__call(p).then(function(T){d.trace(T),c.onResponse.call(this,T)}).catch(function(T){c.onFailure.call(this,T)});break;case"json":this.__callJSON(p).then(function(T){d.trace(T),c.onResponse.call(this,T)}).catch(function(T){c.onFailure.call(this,T)});break;case"xml":this.__callXML(p).then(function(T){d.trace(T),c.onResponse.call(this,T)}).catch(function(T){c.onFailure.call(this,T)});break;default:throw new Error("This output Format is not yet supported !")}},__call:function(c){var d=a.getLogger("XHR");return d.trace("[XHR::__call()]"),new Promise(function(p,T){var C=c.method==="POST"||c.method==="PUT"?1:0;c.data&&(y(c.data)==="object"&&Object.keys(c.data).length||typeof c.data=="string"&&c.data.length)&&!C&&(c.url=u.normalyzeUrl(c.url,c.data)),d.trace("URL = ",c.url);var D=null;if(typeof window>"u"){var $=s(4),ct={headers:{Referer:"https://localhost"}};return c.data&&typeof c.data=="string"&&C&&(ct={method:c.method,body:c.data,headers:{"Content-Type":c.content,Referer:"https://localhost"}}),$(c.url,ct).then(function(Ct){if(Ct.ok)p(Ct.text());else{var be="Errors Occured on Http Request (status : '"+Ct.statusText+"' | url : '"+Ct.url+"')",nn=Ct.status;T({message:be,status:nn})}}).catch(function(Ct){T({message:Ct,status:-1})})}if(window.XMLHttpRequest){d.trace("XMLHttpRequest"),(D=new XMLHttpRequest).open(c.method,c.url,!0),D.overrideMimeType=c.content;var ft=null;c.timeOut>0&&(d.trace("XHR - TimeOut actif !"),ft=window.setTimeout(function(){T({message:"TimeOut Occured on Http Request with XMLHttpRequest !",status:-1})},c.timeOut)),C&&(d.trace("data = ",c.data),D.setRequestHeader("Content-type",c.content)),D.onerror=function(Ct){console.log(Ct),T(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},D.ontimeout=function(Ct){console.log(Ct),T(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},D.onreadystatechange=function(Ct){if(D.readyState===4)if(D.status===200)window.clearTimeout(ft),p(D.response);else{var be="Errors Occured on Http Request (status : '"+Ct.target.statusText+"' | url : '"+Ct.target.responseURL+"' | response : '"+Ct.target.response+"')",nn=Ct.target.status;T({message:be,status:nn})}};var ot=c.data&&C?c.data:null;D.send(ot)}else{if(!window.XDomainRequest)throw new Error("CORS not supported");d.trace("XDomainRequest"),(D=new XDomainRequest).open(c.method,c.url),D.overrideMimeType=c.content,c.timeOut>0&&(D.timeout=c.timeout,d.trace("XHR - TimeOut actif !")),C&&D.setRequestHeader("Content-type",c.content),D.onerror=function(){T(new Error("Errors Occured on Http Request with XMLHttpRequest !"))},D.ontimeout=function(){T(new Error("TimeOut Occured on Http Request with XMLHttpRequest !"))},D.onload=function(Ct){if(D.status===200)p(D.responseText);else{var be="Errors Occured on Http Request (status : '"+Ct.target.statusText+"' | url : '"+Ct.target.responseURL+"')",nn=Ct.target.status;T({message:be,status:nn})}};var Ft=c.data&&C?c.data:null;D.send(Ft)}})},__callJSON:function(c){return this.__call(c).then(JSON.parse).catch(function(d){console.log("_callJSON failed on : ",c.url,d)})},__callXML:function(c){return this.__call(c).then(function(d){var p;return typeof window>"u"?p=new(s(5)).DOMParser().parseFromString(d,"text/xml"):window.DOMParser?p=new window.DOMParser().parseFromString(d,"text/xml"):((p=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,p.loadXML(d)),p}).catch(function(d){console.log("__callXML failed on : ",c.url,d)})}},v={uuid:(w=Math.floor(Date.now()),function(){return w++}),call:function(c){var d=a.getLogger("JSONP");if(d.trace("[JSONP::call ()]"),!c)throw d.error("missing parameter : options !"),new Error("missing parameter : options !");if(!c.url)throw d.error("missing parameter : options.url !"),new Error("missing parameter : options.url !");if(c.timeOut||(d.info("setting 'options.timeOut' default value"),c.timeOut=0),!c.onResponse)throw d.error("missing parameter : options.onResponse !"),new Error("missing parameter : options.onResponse !");var p=typeof c.callbackSuffix=="string"?c.callbackSuffix:this.uuid(),T=!1,C=!1,D=c.url.indexOf("callback=");if(D!==-1){T=!0;var $=c.url.indexOf("&",D);$===-1&&($=c.url.length);var ct=c.url.substring(D+9,$);ct&&(C=!0,c.callbackName=ct,d.info("setting 'options.callbackName' value ("+c.callbackName+") from 'options.url' parameter"))}if(!T){var ft=c.url.indexOf("?");ft===-1?c.url=c.url+"?callback=":ft===c.url.length?c.url=c.url+"callback=":c.url=c.url+"&callback=",d.info("setting callback default key in 'options.url' : "+c.url)}var ot=!!c.callbackName||C;if(C||(c.callbackName||(d.info("setting 'options.callbackName' default value"),c.callbackName="callback",(p||p==="")&&(c.callbackName+=p)),c.url=c.url.replace("callback=","callback="+c.callbackName),d.info("setting callback function name in 'options.url' : "+c.url)),c.onTimeOut||(d.info("setting 'options.onTimeOut' default value"),c.onTimeOut=function(){console.log("TimeOut while invoking url : "+c.url)}),!ot){var Ft=this,Ct=null;c.timeOut>0&&(Ct=window.setTimeout(function(){window[c.callbackName]=function(){},c.onTimeOut(),Ft._deleteScript(p)},c.timeOut)),window[c.callbackName]=function(be){window.clearTimeout(Ct),c.onResponse(be),Ft._deleteScript(p)}}this._createScript(p,c.url)},_createScript:function(c,d){var p,T=document.getElementById("results"+c);(p=document.createElement("script")).setAttribute("type","text/javascript"),p.setAttribute("src",d),p.setAttribute("charset","UTF-8"),p.setAttribute("id","results"+c),p.setAttribute("async","true");var C=document.documentElement||document.getElementsByTagName("head")[0];T===null?C.appendChild(p):C.replaceChild(p,T)},_deleteScript:function(c){var d=document.getElementById("results"+c);if(d){var p=d.parentNode||document.documentElement;if(!p)return;p.removeChild(d)}}},x={send:function(c){var d=c||{method:"GET",protocol:"XHR",timeOut:0,format:null,wrap:!0,nocache:!0,output:"json",callback:null,callbackSuffix:null};if(typeof window<"u"||c.protocol!=="JSONP"){if(c.protocol==="XHR"||c.format==="json"?d.wrap=!1:c.protocol==="JSONP"&&c.format==="xml"&&(d.wrap=!0),d.callback=null,d.output=d.wrap?"json":null,d.wrap){var p={};p.output=d.output,p.callback=d.callback,delete p.callback,d.url=u.normalyzeUrl(c.url,p)}switch(d.protocol){case"XHR":c.method==="GET"&&c.nocache&&(d.url=u.normalyzeUrl(d.url,{t:new Date().getTime()})),E.call(d);break;case"JSONP":d.data&&(d.url=u.normalyzeUrl(d.url,d.data)),v.call(d);break;default:throw new Error("protocol not supported (XHR|JSONP) !")}}else console.log("Value (s) for parameter (s) 'protocol=JSONP (instead use XHR)' not supported to NodeJS")}};function S(c){if(!(this instanceof S))throw new TypeError("ErrorService constructor cannot be called as a function.");var d=c;typeof c=="string"||c instanceof String?(this.message=c,this.status=-1,this.type=S.TYPE_UNKERR):(this.message=d.message||"undefined!?",this.type=d.type,this.status=d.status||-1),this.name="ErrorService",this.stack=new Error().stack}S.TYPE_SRVERR="SERVICE_ERROR",S.TYPE_USEERR="USAGE_ERROR",S.TYPE_UNKERR="UNKNOWN_ERROR",S.prototype=Object.create(Error.prototype,{constructor:{value:S,writable:!0,configurable:!0}});var R=S,O=s(1);function k(c){if(!(this instanceof k))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR"));for(var d in this.logger=a.getLogger("CommonService"),this.logger.trace("[Constructeur CommonService (options)]"),this.options={protocol:"XHR",ssl:!0,proxyURL:"",callbackSuffix:null,httpMethod:"GET",timeOut:0,rawResponse:!1,scope:this,onSuccess:function(p){console.log("onSuccess - la reponse est la suivante : ",p)},onFailure:function(p){p.status!==200&&p.status?console.log("onFailure - Erreur (",p.status,") : ",p.message):console.log("onFailure : ",p.message)}},c)c.hasOwnProperty(d)&&(this.options[d]=c[d]);if(this.options.rawResponse&&!this.options.onSuccess&&(this.options.onSuccess=function(p){console.log("onSuccess - la réponse brute du service est la suivante : ",p)}),this.options.onSuccess===null||typeof this.options.onSuccess!="function")throw new Error(h.getMessage("PARAM_MISSING","onSuccess()"));switch(this.options.httpMethod=typeof c.httpMethod=="string"?c.httpMethod.toUpperCase():"GET",this.options.httpMethod){case"POST":case"GET":break;case"PUT":case"DELETE":case"HEAD":case"OPTIONS":throw new Error(h.getMessage("PARAM_NOT_SUPPORT","httpMethod"));default:throw new Error(h.getMessage("PARAM_UNKNOWN","httpMethod"))}switch(this.options.protocol=typeof c.protocol=="string"?c.protocol.toUpperCase():"XHR",this.options.protocol){case"JSONP":case"XHR":break;default:throw new Error(h.getMessage("PARAM_UNKNOWN","protocol"))}if(typeof window>"u"&&this.options.protocol==="JSONP")throw new Error(h.getMessage("PARAM_NOT_SUPPORT_NODEJS","protocol=JSONP (instead use XHR)"));this.options.protocol==="JSONP"&&(this.options.httpMethod="GET"),this.options.nocache=c.nocache||!1,this.options.outputFormat=null,this.request=null,this.response=null}k.prototype={constructor:k,call:function(){this.logger.trace("CommonService::call ()");var c=this;function d(D){this.logger.trace("CommonService::onBuildRequest : ",D),this.callService.call(c,C,p)}function p(D){this.logger.trace("CommonService::onCallService : ",D),this.analyzeResponse.call(c,C,T)}function T(D){if(this.logger.trace("CommonService::onAnalyzeResponse : ",D),!D)return C.call(this,new R("Analyse de la reponse en échec !?"));this.options.onSuccess.call(this,D)}function C(D){this.logger.trace("CommonService::onError()");var $=D;$ instanceof R||($=new R(D.message)),this.options.onFailure.call(this,$)}(function(){this.logger.trace("CommonService::run ()"),this.buildRequest.call(c,C,d)}).call(c)},buildRequest:function(c,d){this.logger.error("overwritten method !"),c&&c.call(this,"This method must be overwritten !"),d.call(this,"This method must be overwritten !")},callService:function(c,d){var p=null,T=this.request,C=!(!this.options.proxyURL||this.options.protocol!=="XHR"),D={"gp-access-lib":O.version};this.options.apiKey&&(D.apiKey=this.options.apiKey),this.options.serverUrl=u.normalyzeUrl(this.options.serverUrl,D,!1),C&&(this.options.httpMethod==="GET"&&(p=this.options.proxyURL+u.normalyzeUrl(this.options.serverUrl,this.request,!0),T=null),this.options.httpMethod==="POST"&&(p=this.options.proxyURL+u.normalyzeUrl(this.options.serverUrl,null,!0),T=this.request));var $=this,ct={url:p||this.options.serverUrl,method:this.options.httpMethod,protocol:this.options.protocol,timeOut:this.options.timeOut||0,format:this.options.outputFormat,nocache:this.options.nocache||!1,wrap:this.options.protocol!=="XHR",callbackSuffix:this.options.callbackSuffix,data:T,headers:null,content:this.options.contentType||"application/xml",scope:this.options.scope||this,onResponse:function(ft){$.logger.trace("callService::onResponse()");var ot=null;if($.options.protocol==="XHR"&&($.logger.trace("Response XHR",ft),ot=ft),$.options.protocol==="JSONP"){if($.logger.trace("Response JSON",ft),!ft)return void c.call($,new R("Le contenu de la reponse est vide !?"));if(ft.http){if(ft.http.status!==200)return void c.call($,new R({status:ft.http.status,message:ft.http.error,type:R.TYPE_SRVERR}));ot=ft.xml,$.options.rawResponse&&(ot=ft)}else ot=ft}if(typeof $.options.onBeforeParse=="function"){var Ft=$.options.onBeforeParse(ot);typeof Ft=="string"&&(ot=Ft)}$.response=ot,d.call($,ot)},onFailure:function(ft){$.logger.trace("callService::onFailure()"),ft.type=R.TYPE_SRVERR,c.call($,new R(ft))},onTimeOut:function(){$.logger.trace("callService::onTimeOut()"),c.call($,new R("TimeOut!"))}};x.send(ct)},analyzeResponse:function(c,d){this.logger.error("overwritten method !"),c&&c.call(this,"This method must be overwritten !"),d.call(this,"This method must be overwritten !")}};var F=k,W={ssl:!0,newUrl:function(c){return(W.ssl===!1?"http://":"https://")+"data.geopf.fr"+c},Alti:{new_key:{"elevation-json":"/altimetrie/1.0/calcul/alti/rest/elevation.json","elevation-xml":"/altimetrie/1.0/calcul/alti/rest/elevation.xml","profil-json":"/altimetrie/1.0/calcul/alti/rest/elevationLine.json","profil-xml":"/altimetrie/1.0/calcul/alti/rest/elevationLine.xml"},newUrl:function(){return{"elevation-json":W.newUrl(this.new_key["elevation-json"]),"elevation-xml":W.newUrl(this.new_key["elevation-xml"]),"profil-json":W.newUrl(this.new_key["profil-json"]),"profil-xml":W.newUrl(this.new_key["profil-xml"])}}},ProcessIsoCurve:{new_key:"/navigation/isochrone",newUrl:function(){return W.newUrl(this.new_key)}},Config:{_key:"https://raw.githubusercontent.com/IGNF/geoportal-configuration/new-url/dist/",url:function(c){Array.isArray(c)||(c=c.split(","));for(var d=[],p=0;p<c.length;p++)d[p]=this._key+c[p]+"Config.json";return d}},AutoComplete:{new_key:"/geocodage/completion",newUrl:function(){return W.newUrl(this.new_key)}},ReverseGeocode:{new_key:"/geocodage/reverse",newUrl:function(){return W.newUrl(this.new_key)}},Geocode:{new_key:"/geocodage/search",newUrl:function(){return W.newUrl(this.new_key)}},Route:{new_key:"/navigation/itineraire",newUrl:function(){return W.newUrl(this.new_key)}}},H=W;function N(){if(!(this instanceof N))throw new TypeError("ConfigInterface constructor cannot be called as a function.");this.generalOptions={apiKeys:{},title:null,defaultGMLGFIStyle:null,theme:null,wgs84Resolutions:[]},this.layers={},this.tileMatrixSets={}}N.prototype={constructor:N,isKeyConfLoaded:function(c){if(c)return!!this.generalOptions.apiKeys[c]},getLayersId:function(c){return this.generalOptions.apiKeys[c]},getLayerId:function(c,d){if(c&&d){var p=null;if(this.layers){var T=this.layers;for(var C in T)if(T.hasOwnProperty(C)){var D=C.split("$");if(c===D[0]&&D[1]){var $=D[1].split(":");if(D[1].split(";")[1]===d.toUpperCase()){p=C;break}if($[2]===d.toUpperCase()){p=C;break}}}}if(p)return p}},getLayersConf:function(c){var d={},p=this.getLayersId(c);if(p)for(var T=0;T<p.length;T++){var C=p[T];d[C]=this.layers[C]}return d},getLayerConf:function(c){if(this.layers)return this.layers[c]},getLayerParams:function(c,d){var p={};if((d==="WMS"||Object.keys(this.tileMatrixSets).length!==0)&&Object.keys(this.layers).length!==0){var T=this.getLayerId(c,d);if(T){var C=this.getLayerConf(T),D=this.getLayerKey(T);if(D.length===0)return;for(var $=0;$<D.length;$++)C.serviceParams.serverUrl[D[$]]&&(p.url=C.serviceParams.serverUrl[D[$]]);if(d!=="WFS"&&(/\/v\//.test(p.url)?p.styles=" ":p.styles=C.styles[0].name),p.version=C.serviceParams.version,p.format=C.formats&&C.formats.length?C.formats[0].name:"",p.projection=C.defaultProjection,p.minScale=C.globalConstraint.minScaleDenominator,p.maxScale=C.globalConstraint.maxScaleDenominator,p.extent=C.globalConstraint.bbox,p.legends=C.legends,p.title=C.title,p.description=C.description,d==="WMS"&&(p.metadata=C.metadata),C.wmtsOptions){p.tileMatrixSetLimits=C.wmtsOptions.tileMatrixSetLimits;var ct=C.wmtsOptions.tileMatrixSetLink;if(ct){p.TMSLink=ct;var ft=this.getTMSConf(ct);p.matrixIds=Object.keys(ft.tileMatrices),p.tileMatrices=ft.tileMatrices,p.nativeResolutions=ft.nativeResolutions||this.getTMSConf("PM").nativeResolutions}}}}return p},getLayerKey:function(c){var d=[];if(this.generalOptions&&this.generalOptions.apiKeys&&Object.keys(this.generalOptions.apiKeys).length!==0){var p=this.generalOptions.apiKeys;for(var T in p)p[T].forEach(function(C){C===c&&d.push(T)})}return d},getTileMatrixSets:function(){return this.tileMatrixSets},getTMSConf:function(c){if(this.tileMatrixSets)return this.tileMatrixSets[c]},getGlobalConstraints:function(c){var d={};if(c){var p=this.getLayerConf(c);d.projection=p.defaultProjection,d.minScale=p.globalConstraint.minScaleDenominator,d.maxScale=p.globalConstraint.maxScaleDenominator,d.extent=p.globalConstraint.bbox}return d}};var z=N;function I(c){return I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},I(c)}function L(c,d){var p=Object.keys(c);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(c);d&&(T=T.filter(function(C){return Object.getOwnPropertyDescriptor(c,C).enumerable})),p.push.apply(p,T)}return p}function U(c){for(var d=1;d<arguments.length;d++){var p=arguments[d]!=null?arguments[d]:{};d%2?L(Object(p),!0).forEach(function(T){J(c,T,p[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(p)):L(Object(p)).forEach(function(T){Object.defineProperty(c,T,Object.getOwnPropertyDescriptor(p,T))})}return c}function J(c,d,p){return(d=function(T){var C=function(D,$){if(I(D)!="object"||!D)return D;var ct=D[Symbol.toPrimitive];if(ct!==void 0){var ft=ct.call(D,$||"default");if(I(ft)!="object")return ft;throw new TypeError("@@toPrimitive must return a primitive value.")}return($==="string"?String:Number)(D)}(T,"string");return I(C)=="symbol"?C:C+""}(d))in c?Object.defineProperty(c,d,{value:p,enumerable:!0,configurable:!0,writable:!0}):c[d]=p,c}function Y(c){if(!(this instanceof Y))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","Config"));if(this.CLASSNAME="Config",this.logger=a.getLogger("Gp.Config"),this.logger.trace("[Constructeur Config (options)]"),c.onSuccess===null||typeof c.onSuccess!="function")throw new Error(h.getMessage("PARAM_MISSING","onSuccess()"));c.apiKey||c.customConfigFile||(c.apiKey="full"),this.options={},this.options.onSuccess=c.onSuccess,this.options.onFailure=c.onFailure,this.options.sync=c.sync||!1,this.options.listConfigUrls=c.customConfigFile?[c.customConfigFile]:Array.isArray(c.apiKey)?H.Config.url(c.apiKey):H.Config.url(c.apiKey.split(","))}Y.prototype=Object.create(F.prototype,{}),Y.prototype.constructor=Y,Y.prototype.buildRequest=function(c,d){this.listConfigUrls=this.options.listConfigUrls,this.listConfigUrls?d.call(this,this.listConfigUrls):c.call(this,new Error("url by default not found !"))},Y.prototype.callService=function(c,d){this.options.sync?X.call(this,c,d):P.call(this,c,d)};var P=function(c,d){var p=this;this.listConfigResults=[];var T=null;if(typeof window>"u"){var C=s(4);T=C}else T=window.fetch;for(var D=function(ot){return T(ot,{credentials:"same-origin"}).then(function(Ft){if(Ft.ok)return Ft.json().then(function(Ct){return Ct}).catch(function(Ct){throw new Error("Exception Json : "+Ct)});throw new Error("Exception HTTP : "+Ft.status+" (status code) !")}).catch(function(Ft){return new Promise(function(Ct,be){be(Ft)})})},$=[],ct=0;ct<this.listConfigUrls.length;ct++){var ft=this.listConfigUrls[ct];$.push(D(ft))}Promise.all($).then(function(ot){if(!ot)throw new Error("results config empty !?");ot.forEach(function(Ft){p.listConfigResults.push(Ft)})}).then(function(){d.call(p,p.listConfigResults)}).catch(function(ot){c.call(p,ot)})},X=function(c,d){this.listConfigResults=[];for(var p=0;p<this.listConfigUrls.length;p++){var T=this.listConfigUrls[p],C=new XMLHttpRequest;if(C.open("GET",T,!1),C.send(null),C.status===200){var D=JSON.parse(C.responseText);this.listConfigResults.push(D)}}this.listConfigResults.length!==0?d.call(this,this.listConfigResults):c.call(this,new Error("..."))};Y.prototype.analyzeResponse=function(c,d){var p=function($){for(var ct={},ft={},ot={},Ft=0;Ft<$.length;Ft++){if(!$[Ft].generalOptions||!$[Ft].layers)return;ft=U(U({},ft),$[Ft].generalOptions.apiKeys),ct=U(U({},ct),$[Ft].layers),ot=U(U({},ot),$[Ft].tileMatrixSets)}return{generalOptions:{apiKeys:ft},layers:ct,tileMatrixSets:ot}}(this.listConfigResults);if(p){var T=new z;Object.assign(T,p);var C=typeof window<"u"?window:{};if(C.Gp||(C.Gp={}),C.Gp.Config)for(var D in Object.assign(C.Gp.Config,T),T)C.Gp.Config[D]=T[D];else C.Gp.Config=T;d.call(this,C.Gp.Config)}else c.call(this,new Error("configuration structure not conforme !"))};var M=Y;function B(c){if(!(this instanceof B))throw new TypeError("AltiRequest constructor cannot be called as a function.");this.logger=a.getLogger(),this.logger.trace("[Constructeur AltiRequest ()]"),this.options=c||{},this.positions=this.options.positions||[],this.delimiter=this.options.delimiter||"|",this.indent=this.options.indent||!1,this.crs=this.options.crs||"CRS:84",this.format=this.options.format||"json",this.resource=this.options.resource,this.measures=this.options.measures||!1}B.CLASSNAME="AltiRequest",B.prototype={constructor:B,setPositions:function(c){for(var d=[],p=0;p<c.length;p++){var T=c[p];T.lon&&T.lat&&d.push(T)}this.positions=d},getPositions:function(c){if(!c)return this.positions;var d=this.positions.length-1;return c>d||c<d?(this.logger.warn("index out of range !"),this.positions):this.positions[c]},addPositions:function(c){for(var d=0;d<c.length;d++){var p=c[d];p.lon&&p.lat&&this.positions.push(c[d])}},getLon:function(){for(var c=[],d=0;d<this.positions.length;d++)c.push(this.positions[d].lon);return this.logger.trace(c),c.join(this.delimiter)},getLat:function(){for(var c=[],d=0;d<this.positions.length;d++)c.push(this.positions[d].lat);return this.logger.trace(c),c.join(this.delimiter)}},B.prototype.getData=function(){var c=[];return c.push({k:"lon",v:this.getLon()}),c.push({k:"lat",v:this.getLat()}),c.push({k:"delimiter",v:this.delimiter}),c.push({k:"indent",v:this.indent}),c.push({k:"crs",v:this.crs}),c.push({k:"format",v:this.format}),c};var Z=B;function K(c){if(!(this instanceof K))throw new TypeError("AltiElevationRequest constructor cannot be called as a function.");this.CLASSNAME="AltiElevationRequest",Z.apply(this,arguments),this.logger=a.getLogger(),this.logger.trace("[Constructeur AltiElevationRequest ()]"),this.zonly=this.options.zonly||!1}K.prototype=Object.create(Z.prototype,{zonly:{get:function(){return this._zonly},set:function(c){this._zonly=c}}}),K.prototype.constructor=K,K.prototype.getData=function(){var c=[];return c.push({k:"lon",v:this.getLon()}),c.push({k:"lat",v:this.getLat()}),c.push({k:"indent",v:this.indent}),c.push({k:"crs",v:this.crs}),c.push({k:"zonly",v:this.zonly}),c.push({k:"format",v:this.format}),c.push({k:"resource",v:this.resource}),c};var q=K;function Q(c){if(!(this instanceof Q))throw new TypeError("AltiProfilRequest constructor cannot be called as a function.");this.CLASSNAME="AltiProfilRequest",Z.apply(this,arguments),this.logger=a.getLogger(),this.logger.trace("[Constructeur AltiProfilRequest ()]"),this.sampling=this.options.sampling||3}Q.prototype=Object.create(Z.prototype,{sampling:{get:function(){return this._sampling},set:function(c){this._sampling=c}}}),Q.prototype.constructor=Q,Q.prototype.getData=function(){var c=[];return c.push({k:"lon",v:this.getLon()}),c.push({k:"lat",v:this.getLat()}),c.push({k:"indent",v:this.indent}),c.push({k:"crs",v:this.crs}),c.push({k:"sampling",v:this.sampling}),c.push({k:"format",v:this.format}),c.push({k:"resource",v:this.resource}),c};var lt=Q;function nt(c){if(this.logger=a.getLogger("AltiRequestREST"),this.logger.trace("[Constructeur AltiRequestREST ()]"),!(this instanceof nt))throw new TypeError("AltiRequestREST constructor cannot be called as a function.");if(this.options=c||{},!this.options)throw new Error(h.getMessage("PARAM_EMPTY","options"));if(!this.options.type)throw new Error(h.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));switch(this.DataObject=null,this.options.type){case"Elevation":this.DataObject=new q(this.options.param);break;case"Profil":this.DataObject=new lt(this.options.param);break;default:throw new Error(h.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}this.method=this.options.method||"GET"}nt.prototype={requestString:null,constructor:nt,template:{get:{value:"lon=__LON__&lat=__LAT__&indent=__INDENT__&crs='__CRS__'&resource=__RESOURCE__&measures=__MEASURES__",input:{point:"&zonly=__ZONLY__",profil:"&sampling=__SAMPLING__"}},post:{value:`lon=__LON__
lat=__LAT__
indent=__INDENT__
crs='__CRS__'
resource='__RESOURCE__'
measures='__MEASURES__'
`,input:{point:`zonly=__ZONLY__
`,profil:"sampling=__SAMPLING__"}}},processRequestString:function(){this.logger.trace("AltiRequestREST::processRequestString ()");var c="";return this.method==="POST"?c=this.template.post.value:this.method==="GET"&&(c=this.template.get.value),c=(c=(c=(c=(c=(c=c.replace(/__LON__/g,this.DataObject.getLon())).replace(/__LAT__/g,this.DataObject.getLat())).replace(/__INDENT__/g,this.DataObject.indent)).replace(/__CRS__/g,this.DataObject.crs)).replace(/__RESOURCE__/g,this.DataObject.resource)).replace(/__MEASURES__/g,this.DataObject.measures),c+=this.__addDataInputs(),this.logger.trace("traduction tmpl",c),this.requestString=c,this.requestString},__addDataInputs:function(){var c;if(this.logger.trace("AltiRequestREST::addDataInput ()"),this.method==="POST")c=this.template.post;else{if(this.method!=="GET")throw new Error("No other HTTP method supported by the service !");c=this.template.get}if(this.DataObject.CLASSNAME==="AltiElevationRequest")return c.input.point.replace(/__ZONLY__/g,this.DataObject.zonly.toString());if(this.DataObject.CLASSNAME==="AltiProfilRequest")return c.input.profil.replace(/__SAMPLING__/g,this.DataObject.sampling);throw new Error("No other object supported than elevation or profil !?")}};var Gt=nt;function Rt(c){if(this.logger=a.getLogger(),this.logger.trace("[Constructeur WPS()]"),!(this instanceof Rt))throw new TypeError("WPS constructor cannot be called as a function.");if(this.options=c||{},this.DataObject=this.options.data,!this.DataObject)throw new TypeError("This data object is not defined !");this.paramservice=this.options.param.service||"WPS",this.paramversion=this.options.param.version||"1.0.0",this.paramidentifier=this.options.param.identifier||"gs:WPS",this.paramrawdataoutput=this.options.param.rawdataoutput||"result",this.paramrequest=this.options.param.request||"Execute",this.method=this.options.method||"GET"}Rt.prototype={requestString:null,constructor:Rt,template:{get:{value:"service=__SERVICE__&version=__VERSION__&rawdataoutput=__RAWDATAOUTPUT__&identifier=__IDENTIFIER__&request=__REQUEST__&datainputs=<!-- __DATAINPUTS__ -->",input:"__KEY__=__DATA__"},post:{value:'<?xml version="1.0" encoding="UTF-8"?><wps:__REQUEST__ version="__VERSION__" service="__SERVICE__" __NAMESPACE__ __SCHEMALOCATION__><ows:Identifier>__IDENTIFIER__</ows:Identifier><wps:DataInputs><!-- __DATAINPUTS__ --></wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>__RAWDATAOUTPUT__</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:__REQUEST__>',input:"<wps:Input><ows:Identifier>__KEY__</ows:Identifier><wps:Data><wps:LiteralData>__DATA__</wps:LiteralData></wps:Data></wps:Input>"}},namespaceByDefault:function(){return['xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"','xmlns="http://www.opengis.net/wps/1.0.0"','xmlns:wfs="http://www.opengis.net/wfs"','xmlns:wps="http://www.opengis.net/wps/1.0.0"','xmlns:ows="http://www.opengis.net/ows/1.1"','xmlns:gml="http://www.opengis.net/gml"','xmlns:ogc="http://www.opengis.net/ogc"','xmlns:wcs="http://www.opengis.net/wcs/1.1.1"','xmlns:xlink="http://www.w3.org/1999/xlink"'].join(" ")},schemaLocationByDefault:function(){return'xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd"'},processRequestString:function(){this.logger.trace("WPS::processRequestString ()");var c="";if(this.method==="POST")c=this.template.post.value;else{if(this.method!=="GET")return this.logger.error("No other method supported by the service !"),!1;c=this.template.get.value}return c=(c=(c=(c=(c=c.replace(/__SERVICE__/g,this.paramservice)).replace(/__VERSION__/g,this.paramversion)).replace(/__RAWDATAOUTPUT__/g,this.paramrawdataoutput)).replace(/__IDENTIFIER__/g,this.paramidentifier)).replace(/__REQUEST__/g,this.paramrequest),this.method==="POST"&&(c=(c=c.replace(/__NAMESPACE__/g,this.namespaceByDefault)).replace(/__SCHEMALOCATION__/g,this.schemaLocationByDefault)),(c=c.replace(/<!-- __DATAINPUTS__ -->/g,this.__addDataInputs()))?(this.requestString=c,this.logger.trace("traduction tmpl",c),!0):(this.logger.warn("traduction tmpl : empty request !?"),!1)},__addDataInputs:function(){this.logger.trace("WPS::__addDataInputs ()");for(var c,d=this.method==="GET"?this.template.get.input:this.template.post.input,p=this.method==="GET"?";":"",T="",C=this,D=this.DataObject.getData(),$=0;$<D.length;$++)c=$,p&&(p=c===D.length-1?"":";"),T=T.concat(C.__addDataInput(d,D[c].k,D[c].v),p);return T},__addDataInput:function(c,d,p){var T=c;return T=(T=T.replace(/__KEY__/g,d)).replace(/__DATA__/g,p)},setMethod:function(c){c==="GET"||c==="POST"?this.method=c:this.logger.warn("support only GET and POST method !")},getMethod:function(){return this.method}};var _t=Rt,mt={build:function(c){if(a.getLogger("AltiRequestWPS").trace(["AltiRequestWPS::build()"]),!c)throw new Error(h.getMessage("PARAM_EMPTY","options"));if(!c.type)throw new Error(h.getMessage("PARAM_EMPTY","type (Elevation or Profil)"));var d=null;switch(c.type){case"Elevation":c.wps.identifier="gs:WPSElevation",d=new q(c.param);break;case"Profil":c.wps.identifier="gs:WPSLineElevation",d=new lt(c.param);break;default:throw new Error(h.getMessage("PARAM_TYPE","type (Elevation or Profil)"))}var p={data:d,method:c.method,param:c.wps},T=new _t(p);if(!T.processRequestString())throw new Error("Enable to process request !");return T.requestString}},pt={build:function(c){a.getLogger("AltiRequestFactory").trace(["AltiRequestFactory::build()"]);var d=null,p={type:c.sampling?"Profil":"Elevation",method:c.httpMethod,param:{positions:null,delimiter:null,indent:null,crs:null,format:null,sampling:null,zonly:null,measures:null}};p.param.positions=c.positions,p.param.format=c.outputFormat,p.param.sampling=c.sampling,p.param.zonly=c.zonly,p.param.measures=c.measures,p.param.resource=c.resource;var T=!(c.onError===null||typeof c.onError!="function"),C=!(c.onSuccess===null||typeof c.onSuccess!="function"),D=null;switch(c.api){case"REST":var $=new Gt(p);if(!$.processRequestString()){if(D="Error in process request (rest) !",T)return void c.onError.call(c.scope,new R(D));throw new Error(D)}d=$.requestString;break;case"WPS":if(p.wps={service:null,version:null,identifier:null,rawdataoutput:null,request:null},!(d=mt.build(p))){if(D="Error in process request (wps) !",T)return void c.onError.call(c.scope,new R(D));throw new Error(D)}break;default:if(D="Type of API is not supported by service (REST or WPS) !",T)return void c.onError.call(c.scope,new R(D));throw new Error(D)}return C&&c.onSuccess.call(c.scope,d),d}};function G(c){if(!(this instanceof G))throw new TypeError("XML constructor cannot be called as a function.");this.logger=a.getLogger(),this.logger.trace("[Constructeur XML ()]"),this.xmlString=null,this.xmlDoc=null,this.reader=null,c&&(c.xmlString&&typeof c.xmlString=="string"&&(this.xmlString=c.xmlString,this.xmlDoc=j(c.xmlString)),c.reader&&this.setReader(c.reader))}function j(c){if(typeof window>"u")return new(s(5)).DOMParser().parseFromString(c,"text/xml");var d,p,T="Erreur lors du parsing de la réponse du service : XML non conforme";if(window.ActiveXObject){(p=new window.ActiveXObject("Microsoft.XMLDOM")).async=!1,p.loadXML(c);var C=p.parseError;if(C.errorCode)throw C.line&&C.linepos&&(T+="( ligne "+C.line+", colonne "+C.linepos),C.reason&&(T+=":  "+C.reason+")"),new Error(T);return p}if(window.DOMParser){d=new window.DOMParser;try{p=d.parseFromString(c,"text/xml")}catch(ft){throw ft.message==="SyntaxError"?new Error(T):new Error("Erreur lors du parsing de la réponse du service : "+ft.message)}if(p.getElementsByTagName("parsererror").length>0)for(var D=p.getElementsByTagName("parsererror"),$=0;$<D.length;$++){var ct=D[$].innerHTML;if(ct.indexOf("Huge input lookup")===-1)throw T+="("+ct+")",new Error(T)}else if(!p.documentElement)throw new Error(T);return p}throw new Error("Incompatible DOM Parser pour ce navigateur !")}function tt(c){var d={};if(c.attributes.length>0){var p=function(ft){if(ft.attributes.length>0){for(var ot={},Ft=ft.attributes,Ct=0;Ct<Ft.length;Ct++){var be=Ft[Ct];ot[be.nodeName]=be.nodeValue}return ot}}(c);d.attributes=p}if(c.hasChildNodes()){for(var T,C={},D=c.childNodes,$=0;$<D.length;$++)if((T=D[$]).nodeType===3)d.textContent=T.nodeValue;else if(T.nodeType===1)if(C=tt(T),d[T.nodeName]){if(!Array.isArray(d[T.nodeName])){var ct=d[T.nodeName];d[T.nodeName]=[],d[T.nodeName].push(ct)}d[T.nodeName].push(C)}else d[T.nodeName]=C}return d}G.prototype={constructor:G,getXMLString:function(){return this.xmlString},setXMLString:function(c){c&&typeof c=="string"&&(this.xmlString=c,this.xmlDoc=j(c))},getReader:function(){return this.reader},setReader:function(c){c&&c.read&&typeof c.read=="function"&&(this.reader=c)},getXMLDoc:function(){return this.xmlDoc},setXMLDoc:function(c){this.xmlDoc=c},parse:function(){if(!this.xmlDoc&&this.xmlString&&(this.xmlDoc=j(this.xmlString)),this.xmlDoc){var c,d=function(p){var T;return p.nodeType===9?T=p.documentElement:p.nodeType===1&&(T=p),T}(this.xmlDoc);return d?(this.reader&&this.reader.read?c=this.reader.read(d):(c={})[d.nodeName]=tt(d),c):{}}}};var st=G;function et(){if(!(this instanceof et))throw new TypeError("AltiResponse constructor cannot be called as a function.");this.elevations=[]}et.prototype={constructor:et};var rt=et;function it(){if(!(this instanceof it))throw new TypeError("Elevation constructor cannot be called as a function.");this.z=null}it.prototype={constructor:it};var Ot=it;function Mt(){if(!(this instanceof Mt))throw new TypeError("Measure constructor cannot be called as a function.");this.source_name=null,this.source_measure=null,this.z=null,this.acc=null}Mt.prototype={constructor:Mt};var It=Mt,Dt={};Dt.READERS={elevations:function(c){var d=new rt;if(c.hasChildNodes())for(var p,T,C=c.childNodes,D=0;D<C.length;D++)p=C[D],Dt.READERS[p.nodeName]&&(T=Dt.READERS[p.nodeName](p),d.elevations.push(T));return d},elevation:function(c){var d=new Ot;if(c.hasChildNodes())for(var p,T=c.childNodes,C=0;C<T.length;C++)p=T[C],Dt.READERS[p.nodeName]&&Dt.READERS[p.nodeName](p,d);return d},lat:function(c,d){var p=c.firstChild;if(!p||p.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : latitude attendue mais absente");d.lat=parseFloat(p.nodeValue)},lon:function(c,d){var p=c.firstChild;if(!p||p.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : longitude attendue mais absente");d.lon=parseFloat(p.nodeValue)},z:function(c,d){var p=c.firstChild;if(!p||p.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : altitude attendue mais absente");if(!d)return(d=new Ot).z=parseFloat(p.nodeValue),d;d.z=parseFloat(p.nodeValue)},acc:function(c,d){var p=c.firstChild;if(!p||p.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : précision (acc) attendue mais absente");d.acc=parseFloat(p.nodeValue)},source_name:function(c,d){var p=c.firstChild;if(!p||p.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : source_name attendue mais absente");d.source_name=p.nodeValue},source_measure:function(c,d){var p=c.firstChild;if(!p||p.nodeType!==3)throw new Error("Erreur dans la lecture de la réponse du service : source_measure attendue mais absente");d.source_measure=p.nodeValue},measures:function(c,d){var p;if(d.measures=[],c.hasChildNodes())for(var T,C=c.childNodes,D=0;D<C.length;D++){p=new It,T=C[D].childNodes;for(var $=0;$<T.length;$++){if(!Dt.READERS[T[$].nodeName])throw new Error("Erreur dans la lecture de la réponse du service : measures attendues mais absentes");Dt.READERS[T[$].nodeName](T[$],p)}d.measures.push(p)}},exceptionreport:function(c){var d={};if(c.hasChildNodes())for(var p,T=c.childNodes,C=0;C<T.length;C++)(p=T[C]).nodeName==="Exception"&&(d.exceptionReport=Dt.READERS.exception(p));return d},exception:function(c){var d={},p=c.getAttribute("exceptionCode");p&&(d.exceptionCode=p);var T=c.firstChild;return T&&T.nodeType===3&&(d.exception=T.nodeValue),d},error:function(c){var d={error:{}};if(c.hasChildNodes())for(var p,T=c.childNodes,C=0;C<T.length;C++){var D;(p=T[C]).nodeType===1&&p.nodeName==="code"&&(D=p.firstChild)&&D.nodeType===3&&(d.error.code=D.nodeValue),p.nodeType===1&&p.nodeName==="description"&&(D=p.firstChild)&&D.nodeType===3&&(d.error.description=D.nodeValue)}return d}},Dt.read=function(c){if(c.nodeName==="elevations")return Dt.READERS.elevations(c);if(c.nodeName==="ExceptionReport")return Dt.READERS.exceptionreport(c);if(c.nodeName==="error")return Dt.READERS.error(c);throw new Error("Erreur lors de la lecture de la réponse : elle n'est pas au format attendu.")};var Nt=Dt;function kt(c){return kt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},kt(c)}var Et={build:function(c){var d=a.getLogger("AltiResponseFactory");d.trace(["AltiResponseFactory::build()"]);var p=null;if(c.response){if(c.rawResponse)d.trace("analyze response : raw"),p=c.response;else{switch(c.outputFormat){case"xml":d.trace("analyze response : xml");try{var T=new st({reader:Nt});if(typeof c.response=="string"?T.setXMLString(c.response):T.setXMLDoc(c.response),!(p=T.parse()))throw new Error(h.getMessage("SERVICE_RESPONSE_EXCEPTION_2"))}catch(Ct){var C=Ct.message;return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",C),status:200,type:R.TYPE_SRVERR}))}break;case"json":d.trace("analyze response : json"),d.trace("analyze response : ",kt(c.response));var D=null;if((D=typeof c.response=="string"?JSON.parse(c.response):c.response)&&D.error)return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",D.error.description),status:200,type:R.TYPE_SRVERR}));if(D){var $,ct=D.elevations,ft=new rt;if(Array.isArray(ct)&&ct.length)for(var ot=0;ot<ct.length;ot++)$=new Ot,kt(ct[ot])==="object"?(ct[ot].lon&&($.lon=ct[ot].lon),ct[ot].lat&&($.lat=ct[ot].lat),ct[ot].z&&($.z=ct[ot].z),ct[ot].acc&&($.acc=ct[ot].acc),ct[ot].measures&&($.measures=ct[ot].measures)):typeof ct[ot]=="number"&&($.z=ct[ot]),Array.isArray(ft.elevations)&&ft.elevations.push($);p=ft}if(!p)return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:R.TYPE_UNKERR,status:-1}));break;default:return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_FORMAT_2"),type:R.TYPE_UNKERR,status:-1}))}if(p.exceptionReport)return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",p.exceptionReport),type:R.TYPE_SRVERR,status:200}));if(p.error){var Ft=p.error.description;return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",Ft),type:R.TYPE_SRVERR,status:200}))}}c.onSuccess.call(c.scope,p)}else c.onError.call(c.scope,new R(h.getMessage("SERVICE_RESPONSE_EMPTY")))}};function bt(c){if(!(this instanceof bt))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","Alti"));if(this.CLASSNAME="Alti",F.apply(this,arguments),this.logger=a.getLogger("Gp.Services.Alti"),this.logger.trace("[Constructeur Alti (options)]"),!c.positions)throw new Error(h.getMessage("PARAM_MISSING","positions"));if(c.positions.length===0)throw new Error(h.getMessage("PARAM_EMPTY","positions"));if(this.options.positions=c.positions,this.options.outputFormat=typeof c.outputFormat=="string"?c.outputFormat.toLowerCase():"xml",this.options.resource=c.resource||"ign_rge_alti_wld",this.options.sampling=c.sampling||null,this.options.api=typeof c.api=="string"?c.api.toUpperCase():"REST",this.options.api==="REST"&&(this.options.httpMethod="GET"),this.options.zonly=c.zonly||!1,this.options.measures=c.measures||!1,!this.options.serverUrl){var d=H.Alti.newUrl(),p=null;switch(this.options.api){case"WPS":p=d.wps;break;case"REST":p=d[(c.sampling?"profil":"elevation")+"-"+this.options.outputFormat];break;default:throw new Error(h.getMessage("PARAM_UNKNOWN","api"))}if(!p)throw new Error("Url by default not found !");this.options.serverUrl=p,this.logger.trace("Server URL by default : "+this.options.serverUrl)}var T=this.options.serverUrl.lastIndexOf(".");if(T!==-1){var C=this.options.serverUrl.substring(T+1);if(C&&C.length<5)switch(this.logger.trace("Server Extension URL : "+C),C.toLowerCase()){case"json":case"xml":this.options.outputFormat=C.toLowerCase();break;default:throw new Error("type of service : unknown or unsupported (json or xml) !")}}}bt.prototype=Object.create(F.prototype,{}),bt.prototype.constructor=bt,bt.prototype.buildRequest=function(c,d){var p={httpMethod:this.options.httpMethod,onSuccess:function(T){this.request=T,d.call(this,this.request)},onError:c,scope:this,resource:this.options.resource,positions:this.options.positions,outputFormat:this.options.outputFormat,sampling:this.options.sampling,api:this.options.api,zonly:this.options.zonly,measures:this.options.measures};pt.build(p)},bt.prototype.analyzeResponse=function(c,d){if(this.response){var p={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:c,onSuccess:d,scope:this};Et.build(p)}else c.call(this,new R(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var ce=bt;function Vt(c){if(!(this instanceof Vt))throw new TypeError("GeocodeParamREST constructor cannot be called as a function.");if(this.logger=a.getLogger(),this.logger.trace("[Constructeur GeocodeParamREST ()]"),this.options=c||{},!this.options.geocodeMethod||this.options.geocodeMethod!=="search"&&this.options.geocodeMethod!=="reverse")throw new Error("Error geocodeMethod not valid");this.geocodeMethod=this.options.geocodeMethod,this.query=this.options!==void 0?this.options.query:null,this.searchGeometry=this.options.searchGeometry||null,this.index=this.options.index||null,this.lon=this.options.position&&this.options.position.lon?this.options.position.lon:null,this.lat=this.options.position&&this.options.position.lat?this.options.position.lat:null,this.maxResp=this.options.maxResp||null,this.returnTrueGeometry=this.options.returnTrueGeometry||null,this.filters=this.options.filters||{}}Vt.CLASSNAME="GeocodeParamREST",Vt.prototype={constructor:Vt,getFilters:function(){var c={};for(var d in this.filters)this.filters.hasOwnProperty(d)&&(c[d]=this.filters[d]);return c},getIndex:function(){return this.index===void 0?null:this.index==="StreetAddress"?"address":this.index==="CadastralParcel"?"parcel":this.index==="PositionOfInterest"?"poi":this.index==="location"?"location":this.index},getSearchGeometry:function(){return JSON.stringify(this.searchGeometry)}},Vt.prototype.getParams=function(){var c=[];this.geocodeMethod==="search"&&c.push({k:"q",v:this.query}),this.index&&c.push({k:"index",v:this.getIndex()}),this.geocodeMethod==="reverse"&&this.searchGeometry&&c.push({k:"searchgeom",v:this.getSearchGeometry()}),this.lon&&this.lat&&(c.push({k:"lon",v:this.lon}),c.push({k:"lat",v:this.lat})),this.maxResp&&c.push({k:"limit",v:this.maxResp}),this.returnTrueGeometry&&c.push({k:"returntruegeometry",v:this.returnTrueGeometry});var d=this.getFilters();for(var p in d)c.push({k:p,v:d[p]});return c};var Jt=Vt;function Tt(c){if(this.logger=a.getLogger("GeocodeRequestREST"),this.logger.trace("[Constructeur GeocodeRequestREST ()]"),!(this instanceof Tt))throw new TypeError("GeocodeRequestREST constructor cannot be called as a function.");if(!c)throw new Error(h.getMessage("PARAM_EMPTY","options"));this.settings=c}Tt.prototype={requestString:null,constructor:Tt,processRequestString:function(){for(var c="",d=new Jt(this.settings).getParams(),p=0;p<d.length;p++){var T=d[p];c&&(c+="&"),c+=T.k+"="+T.v}if(!this.settings.geocodeMethod||this.settings.geocodeMethod!=="search"&&this.settings.geocodeMethod!=="reverse")throw new Error("Error geocodeMethod not valid");return this.requestString="?"+c,this.logger.trace(this.requestString),this.requestString}};var ht=Tt,wt={build:function(c){var d=a.getLogger("GeocodeRequestFactory");d.trace(["GeocodeRequestFactory::build()"]);var p=new ht(c||{});if(!p.processRequestString())throw new Error("Error process request (rest) !");var T=p.requestString;return d.trace(T),T}};function Wt(){if(!(this instanceof Wt))throw new TypeError("GeocodeResponse constructor cannot be called as a function.");this.locations=[]}Wt.prototype={constructor:Wt};var ae=Wt;function fe(){if(!(this instanceof fe))throw new TypeError("GeocodedLocation constructor cannot be called as a function.");this.position=null,this.matchType=null,this.placeAttributes={},this.type=null,this.accuracy=null,this.CLASSNAME="GeocodedLocation"}fe.prototype={constructor:fe};var Ie=fe;function ye(){if(!(this instanceof ye))throw new TypeError("GeocodeResponseParser constructor cannot be called as a function.")}function Ae(c,d){var p=new Ie;if(c.geometry&&c.geometry.type==="Point"&&(p.position={lon:c.geometry.coordinates[0],lat:c.geometry.coordinates[1]}),c.properties){for(var T in c.properties)T==="score"?p.accuracy=c.properties[T]:T==="_type"?c.properties[T]==="address"?p.type="StreetAddress":c.properties[T]==="poi"?p.type="PositionOfInterest":c.properties[T]!=="parcel"&&c.properties[T]!=="cadastral"||(p.type="CadastralParcel"):p.placeAttributes[T]=c.properties[T];c.properties._type==="address"&&(p.matchType=c.properties.number!==void 0&&c.properties.number!==null?"street number":"street")}d.locations.push(p)}ye.prototype={constructor:ye,parse:function(c){var d=new ae,p=JSON.parse(c);if(p.type==="FeatureCollection")for(var T=0;T<p.features.length;++T)Ae(p.features[T],d);else{if(p.type!=="Feature"){if(p.type==="SERVICE_ERROR")return{exceptionReport:p};var C=h.getMessage("SERVICE_RESPONSE_ANALYSE",p.type);throw new R({message:C,type:R.TYPE_UNKERR,status:200})}Ae(p,d)}return d}};var je=ye,Oe={build:function(c){var d=null;if(c.response){if(c.rawResponse)d=c.response;else{try{if(!(d=new je().parse(c.response)))throw new Error("L'analyse de la réponse du service !?")}catch(T){var p=T.message;return typeof c.response=="string"?p+="('"+c.response+"')":p+="('"+c.response.documentElement.innerHTML+"')",void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_ANALYSE",p),type:R.TYPE_UNKERR,status:-1}))}if(d.exceptionReport)return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",d.exceptionReport),type:R.TYPE_SRVERR,status:200}))}c.onSuccess.call(c.scope,d)}else c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_EMPTY"),type:R.TYPE_SRVERR,status:-1}))}};function Ee(c){return Ee=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},Ee(c)}function ee(c){if(!(this instanceof ee))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","Geocode"));this.CLASSNAME="Geocode",this.logger=a.getLogger("Gp.Services.Geocode"),this.logger.trace("[Constructeur Geocode (options)]");var d=this.patchOptionConvertor(c);if(d.serverUrl||(d.serverUrl=H.Geocode.newUrl()),F.apply(this,[d]),!d.hasOwnProperty("query"))throw new Error(h.getMessage("PARAM_MISSING","query"));if(this.options.query=d.query,d.index||(this.options.index=d.index="StreetAddress"),d.filters)for(var p=Object.keys(d.filters),T=0;T<p.length;T++){var C=p[T];(d.filters[C]===void 0||Ee(d.filters[C])==="object"&&Object.keys(d.filters[C]).length===0||typeof d.filters[C]=="string"&&d.filters[C].length===0||Array.isArray(d.filters[C])&&d.filters[C].length===0)&&delete this.options.filters[C]}this.options.index=d.index||"StreetAddress",this.options.maximumResponses=d.maximumResponses||20}ee.prototype=Object.create(F.prototype,{}),ee.prototype.constructor=ee,ee.prototype.patchOptionConvertor=function(c){var d=c;return d.hasOwnProperty("location")&&(this.logger.warn("The parameter 'location' is deprecated"),d.query||(d.query=d.location),delete d.location),d.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),d.filters||(d.filters=d.filterOptions,d.filters.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),d.index||(Array.isArray(d.filters.type)&&d.filters.type.length>0?d.index=d.filters.type[0]:d.index=d.filters.type),delete d.filters.type),d.filters.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),delete d.filters.bbox)),delete d.filterOptions),d.position&&(d.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),d.position.lon||(d.position.lon=d.position.x),delete d.position.x),d.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),d.position.lat||(d.position.lat=d.position.y),delete d.position.y)),d.returnFreeForm&&(this.logger.warn("The parameter 'returnFreeForm' is deprecated"),delete d.returnFreeForm),d.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete d.srs),d},ee.prototype.buildRequest=function(c,d){var p={httpMethod:this.options.httpMethod,geocodeMethod:"search",query:this.options.query,index:this.options.index,returnTrueGeometry:this.options.returnTrueGeometry,position:this.options.position,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=wt.build(p),this.request?d.call(this,this.request):c.call(this,new R(h.getMessage("SERVICE_REQUEST_BUILD")))},ee.prototype.analyzeResponse=function(c,d){if(this.response){var p={response:this.response,rawResponse:this.options.rawResponse,onError:c,onSuccess:d,scope:this};Oe.build(p)}else c.call(this,new R(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var Te=ee;function Re(c){return Re=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},Re(c)}function Ht(c){if(!(this instanceof Ht))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","ReverseGeocode"));this.CLASSNAME="ReverseGeocode",this.logger=a.getLogger("Gp.Services.ReverseGeocode"),this.logger.trace("[Constructeur ReverseGeocode (options)]");var d=this.patchOptionConvertor(c);if(d.serverUrl||(d.serverUrl=H.ReverseGeocode.newUrl()),F.apply(this,[d]),d.searchGeometry)this.options.searchGeometry=d.searchGeometry;else if(!d.position)throw new Error(h.getMessage("PARAM_MISSING","searchGeometry"));if(d.index||(this.options.index=d.index="StreetAddress"),d.filters)for(var p=Object.keys(d.filters),T=0;T<p.length;T++){var C=p[T];(d.filters[C]===void 0||Re(d.filters[C])==="object"&&Object.keys(d.filters[C]).length===0||typeof d.filters[C]=="string"&&d.filters[C].length===0||Array.isArray(d.filters[C])&&d.filters[C].length===0)&&delete this.options.filters[C]}this.options.position=d.position,this.options.index=d.index||"StreetAddress",this.options.maximumResponses=d.maximumResponses||20}Ht.prototype=Object.create(F.prototype,{}),Ht.prototype.constructor=Ht,Ht.prototype.patchOptionConvertor=function(c){var d=c;return d.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),d.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),d.index||(Array.isArray(d.filterOptions.type)&&d.filterOptions.type.length>0?d.index=d.filterOptions.type[0]:d.index=d.filterOptions.type),delete d.filterOptions.type),d.filterOptions.bbox&&(this.logger.warn("The parameter 'filterOptions.bbox' is deprecated"),d.searchGeometry||(d.searchGeometry=this.bbox2Json(d.filterOptions.bbox)),delete d.filterOptions.bbox),d.filterOptions.circle&&(this.logger.warn("The parameter 'filterOptions.circle' is deprecated"),d.searchGeometry||(d.searchGeometry=this.circle2Json(d.filterOptions.circle)),delete d.filterOptions.circle),d.filterOptions.polygon&&(this.logger.warn("The parameter 'filterOptions.polygon' is deprecated"),d.searchGeometry||(d.searchGeometry=this.polygon2Json(d.filterOptions.polygon)),delete d.filterOptions.polygon),!d.filters&&Object.keys(d.filterOptions).length>0&&(d.filters=d.filterOptions),delete d.filterOptions),d.position&&(d.position.x&&(this.logger.warn("The parameter 'position.x' is deprecated"),d.position.lon||(d.position.lon=d.position.x),delete d.position.x),d.position.y&&(this.logger.warn("The parameter 'position.y' is deprecated"),d.position.lat||(d.position.lat=d.position.y),delete d.position.y)),d.srs&&(this.logger.warn("The parameter 'srs' is deprecated"),delete d.srs),d},Ht.prototype.buildRequest=function(c,d){var p={httpMethod:this.options.httpMethod,geocodeMethod:"reverse",searchGeometry:this.options.searchGeometry,index:this.options.index,position:this.options.position,returnTrueGeometry:this.options.returnTrueGeometry,maxResp:this.options.maximumResponses,filters:this.options.filters};this.request=wt.build(p),this.request?d.call(this,this.request):c.call(this,new R(h.getMessage("SERVICE_REQUEST_BUILD")))},Ht.prototype.analyzeResponse=function(c,d){if(this.response){var p={response:this.response,rawResponse:this.options.rawResponse,onError:c,onSuccess:d,scope:this};Oe.build(p)}else c.call(this,new R(h.getMessage("SERVICE_RESPONSE_EMPTY")))},Ht.prototype.bbox2Json=function(c){return{type:"Polygon",coordinates:[[[c.left,c.top],[c.right,c.top],[c.right,c.bottom],[c.left,c.bottom],[c.left,c.top]]]}},Ht.prototype.circle2Json=function(c){return{type:"Circle",radius:c.radius,coordinates:[c.x,c.y]}},Ht.prototype.polygon2Json=function(c){for(var d={type:"Polygon",coordinates:[[]]},p=0;p<c.length;++p)d.coordinates[0].push([c[p].x,c[p].y]);return d},Ht.geoEPSG=["EPSG:4326"];var ie=Ht;function ge(){if(!(this instanceof ge))throw new TypeError("AutoCompleteResponse constructor cannot be called as a function.");this.suggestedLocations=[]}ge.prototype={constructor:ge};var ne=ge;function re(){if(!(this instanceof re))throw new TypeError("SuggestedLocation constructor cannot be called as a function.");this.type=null,this.position={x:null,y:null},this.commune=null,this.fullText=null,this.postalCode=null,this.classification=null,this.street=null,this.poi=null,this.kind=null}re.prototype={constructor:re};var jt=re,Ye={build:function(c){var d=a.getLogger("AutoCompleteResponseFactory");d.trace(["AutoCompleteResponseFactory::build()"]);var p=null;if(c.response){if(c.rawResponse)d.trace("analyze response : raw"),p=c.response;else{var T=null;if(T=typeof c.response=="string"?JSON.parse(c.response):c.response){if(T.error)return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",T.error.description),status:T.error.code,type:R.TYPE_SRVERR}));if(p=new ne,!T.results||!Array.isArray(T.results))return void c.onError.call(c.scope,new R(h.getMessage("SERVICE_RESPONSE_FORMAT_3")));for(var C=null,D=0;D<T.results.length;D++){var $=T.results[D];C=new jt,$&&($.country==="StreetAddress"?(C.street=$.street,C.type="StreetAddress"):$.country==="PositionOfInterest"&&(C.poi=$.street,C.type="PositionOfInterest",C.poiType=$.poiType),C.position&&(C.position.x=$.x,C.position.y=$.y),C.kind=$.kind,C.commune=$.city,C.fullText=$.fulltext,C.postalCode=$.zipcode,C.classification=$.classification),p.suggestedLocations.push(C)}if(!p.suggestedLocations.length)return void c.onError.call(c.scope,new R(h.getMessage("SERVICE_RESPONSE_FORMAT_3")))}if(!p)return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_ANALYSE_2"),type:R.TYPE_UNKERR,status:-1}));if(p.exceptionReport)return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",p.exceptionReport),type:R.TYPE_SRVERR,status:200}))}c.onSuccess.call(c.scope,p)}else c.onError.call(c.scope,new R(h.getMessage("SERVICE_RESPONSE_EMPTY")))}};function le(c){if(!(this instanceof le))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","AutoComplete"));this.CLASSNAME="AutoComplete",this.logger=a.getLogger("Gp.Services.AutoComplete"),this.logger.trace("[Constructeur AutoComplete (options)]");var d=this.patchOptionConvertor(c);if(d.serverUrl||(d.serverUrl=H.AutoComplete.newUrl()),F.apply(this,arguments),!d.text)throw new Error(h.getMessage("PARAM_MISSING","text"));this.options.text=d.text,d.type||(d.type=["StreetAddress,PositionOfInterest"]),this.options.type=d.type,this.options.territory=d.terr||"",this.options.maximumResponses=d.maximumResponses||10,this.options.protocol==="XHR"&&this.options.httpMethod==="POST"&&(this.logger.warn("Le service ne gére pas le mode d'interrogation en POST, on bascule sur du GET !"),this.options.httpMethod="GET"),this.options.outputFormat=this.options.rawResponse?"":"json"}le.prototype=Object.create(F.prototype,{}),le.prototype.constructor=le,le.prototype.patchOptionConvertor=function(c){var d=c;return d.filterOptions&&(this.logger.warn("The parameter 'filterOptions' is deprecated"),d.filterOptions.type&&(this.logger.warn("The parameter 'filterOptions.type' is deprecated"),d.type||(d.type=d.filterOptions.type)),d.filterOptions.territory&&(this.logger.warn("The parameter 'filterOptions.territory' is deprecated"),d.terr||(d.terr=d.filterOptions.territory)),delete d.filterOptions),d},le.prototype.buildRequest=function(c,d){var p="";this.options.territory&&(p=this.options.territory);var T="";this.options.type&&(T=this.options.type.join(",")),this.request=u.normalyzeParameters({text:encodeURIComponent(this.options.text),type:T,terr:p,maximumResponses:this.options.maximumResponses}),this.request?d.call(this,this.request):c.call(this,new R(h.getMessage("SERVICE_REQUEST_BUILD")))},le.prototype.analyzeResponse=function(c,d){if(this.response){var p={response:this.response,rawResponse:this.options.rawResponse,onSuccess:d,onError:c,scope:this};Ye.build(p)}else c.call(this,new R(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var Qt=le;function $t(c){if(!(this instanceof $t))throw new TypeError("RouteParamREST constructor cannot be called as a function.");this.logger=a.getLogger(),this.logger.trace("[Constructeur RouteParamREST ()]"),this.options=c||{},this.resource=this.options.resource,this.start=this.options.startPoint.x+","+this.options.startPoint.y,this.end=this.options.endPoint.x+","+this.options.endPoint.y,this.intermediates=this.options.viaPoints,this.profile=this.options.graph,this.crs=this.options.srs,this.constraints=this.options.constraints,this.optimization=this.options.routePreference,this.getSteps=this.options.geometryInInstructions?"true":"false",this.distanceUnit=this.options.distanceUnit,this.timeUnit=this.options.timeUnit,this.waysAttributes=this.options.waysAttributes}$t.CLASSNAME="RouteParamREST",$t.prototype={constructor:$t,getIntermediates:function(){var c=[];if(this.intermediates.length!==0)for(var d=0;d<this.intermediates.length;d++){var p=this.intermediates[d];c.push(p.x+","+p.y)}return c.join("|")},getWaysAttributes:function(){return this.waysAttributes.join("|")},getProfile:function(){return this.profile},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getOptimization:function(){return this.optimization?this.optimization:""},getConstraints:function(){var c=[];if(this.constraints.length!==0)for(var d=0;d<this.constraints.length;d++)c.push(JSON.stringify(this.constraints[d]));return c.join("|")}},$t.prototype.getParams=function(){var c=[];return c.push({k:"resource",v:this.resource}),c.push({k:"start",v:this.start}),c.push({k:"end",v:this.end}),c.push({k:"geometryFormat",v:"geojson"}),this.optimization&&c.push({k:"optimization",v:this.getOptimization()}),this.intermediates&&c.push({k:"intermediates",v:this.getIntermediates()}),this.profile&&c.push({k:"profile",v:this.getProfile()}),this.constraints&&c.push({k:"constraints",v:this.getConstraints()}),this.crs&&c.push({k:"crs",v:this.crs}),this.distanceUnit&&c.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.timeUnit&&c.push({k:"timeUnit",v:this.timeUnit}),this.waysAttributes&&c.push({k:"waysAttributes",v:this.getWaysAttributes()}),c};var f=$t;function _(c){if(this.logger=a.getLogger("RouteRequestREST"),this.logger.trace("[Constructeur RouteRequestREST ()]"),!(this instanceof _))throw new TypeError("RouteRequestREST constructor cannot be called as a function.");if(!c)throw new Error(h.getMessage("PARAM_EMPTY","options"));this.settings=c}_.prototype={requestString:null,constructor:_,processRequestString:function(){this.logger.warn(" PROTOTYPE !");for(var c=new f(this.settings).getParams(),d="",p=0;p<c.length;p++){var T=c[p];d&&(d+="&"),d+=T.k+"="+T.v}return this.logger.trace(d),this.requestString=d,this.requestString}};var b=_,A={build:function(c){a.getLogger("RouteRequestFactory").trace(["RouteRequestFactory::build()"]);var d=c||{},p=!(c.onError===null||typeof c.onError!="function"),T=null,C=new b(d);if(!C.processRequestString()){if(T="Error process request (rest) !",p)return void c.onError.call(c.scope,new R(T));throw new Error(T)}return C.requestString}};function V(){if(!(this instanceof V))throw new TypeError("RouteResponse constructor cannot be called as a function.");this.totalTime=null,this.totalDistance=null,this.bbox={left:null,right:null,top:null,bottom:null},this.routeGeometry=null,this.routeInstructions=[]}V.prototype={constructor:V};var at=V;function At(){if(!(this instanceof At))throw new TypeError("RouteInstruction constructor cannot be called as a function.");this.duration=null,this.distance=null,this.code=null,this.instruction=null,this.geometry=null}At.prototype={constructor:At};var vt=At,Yt={build:function(c){var d=a.getLogger("RouteResponseFactory");d.trace("RouteResponseFactory::build()");var p=null;if(c.response){if(c.rawResponse)d.trace("analyze response : raw"),p=c.response;else{var T;if(d.trace("analyze response : json"),T=typeof c.response=="string"?JSON.parse(c.response):c.response){if(T.message)return void c.onError.call(c.scope,new R(h.getMessage("SERVICE_RESPONSE_EXCEPTION",T.message)));var C=[],D=[],$=[];if((p=new at).hasOwnProperty("totalTime")&&(p.totalTime=parseFloat(T.duration)),p.hasOwnProperty("totalDistance")&&(p.totalDistance=parseFloat(T.distance)),p.hasOwnProperty("bbox")&&(p.bbox.left=parseFloat(T.bbox[0]),p.bbox.bottom=parseFloat(T.bbox[1]),p.bbox.right=parseFloat(T.bbox[2]),p.bbox.top=parseFloat(T.bbox[3])),p.hasOwnProperty("routeGeometry")&&!c.geometryInInstructions&&(p.routeGeometry=T.geometry),p.hasOwnProperty("routeInstructions")&&c.geometryInInstructions){var ct,ft=T.portions;if(Array.isArray(ft)&&ft.length)for(ct=0;ct<ft.length;ct++)C.push(ft[ct]);if(C.length)for(ct=0;ct<C.length;ct++)D.push(C[ct].steps);if(D.length)for(ct=0;ct<D.length;ct++)$=$.concat(D[ct]);$.forEach(function(ot){switch(p.routeInstructions.push(new vt),p.routeInstructions[p.routeInstructions.length-1].duration=ot.duration,p.routeInstructions[p.routeInstructions.length-1].distance=ot.distance,p.routeInstructions[p.routeInstructions.length-1].code="",p.routeInstructions[p.routeInstructions.length-1].instruction="",p.routeInstructions[p.routeInstructions.length-1].geometry=ot.geometry,ot.name==="Valeur non renseignée"&&(ot.name=""),ot.instruction.type){case"turn":p.routeInstructions[p.routeInstructions.length-1].instruction+="Tourner";break;case"new name":p.routeInstructions[p.routeInstructions.length-1].instruction+="Continuer tout droit";break;case"depart":p.routeInstructions[p.routeInstructions.length-1].instruction+="Départ";break;case"arrive":p.routeInstructions[p.routeInstructions.length-1].instruction+="Arrivée";break;case"merge":p.routeInstructions[p.routeInstructions.length-1].instruction+="Rejoindre";break;case"ramp":case"on ramp":p.routeInstructions[p.routeInstructions.length-1].instruction+="Prendre la bretelle";break;case"off ramp":p.routeInstructions[p.routeInstructions.length-1].instruction+="Prendre la sortie";break;case"fork":p.routeInstructions[p.routeInstructions.length-1].instruction+="Sur la bifurcation, prendre";break;case"end of road":p.routeInstructions[p.routeInstructions.length-1].instruction+="À la fin de la route, prendre";break;case"use lane":p.routeInstructions[p.routeInstructions.length-1].instruction+="Utiliser la file";break;case"continue":p.routeInstructions[p.routeInstructions.length-1].instruction+="Continuer";break;case"roundabout":case"rotary":p.routeInstructions[p.routeInstructions.length-1].instruction+="Au rond-point";break;case"roundabout turn":p.routeInstructions[p.routeInstructions.length-1].instruction+="Au rond point, tourner";break;case"notification":p.routeInstructions[p.routeInstructions.length-1].instruction+="";break;default:p.routeInstructions[p.routeInstructions.length-1].instruction+="?"+ot.instruction.type+"?"}if(ot.instruction.modifier)switch(ot.instruction.modifier){case"uturn":p.routeInstructions[p.routeInstructions.length-1].instruction="Faire demi-tour";break;case"sharp right":p.routeInstructions[p.routeInstructions.length-1].instruction+=" complètement à droite";break;case"right":p.routeInstructions[p.routeInstructions.length-1].instruction+=" à droite";break;case"slight right":p.routeInstructions[p.routeInstructions.length-1].instruction+=" légèrement à droite";break;case"straight":p.routeInstructions[p.routeInstructions.length-1].instruction="Continuer tout droit";break;case"slight left":p.routeInstructions[p.routeInstructions.length-1].instruction+=" lègèrement à gauche";break;case"left":p.routeInstructions[p.routeInstructions.length-1].instruction+=" à gauche";break;case"sharp left":p.routeInstructions[p.routeInstructions.length-1].instruction+=" complètement à gauche";break;default:p.routeInstructions[p.routeInstructions.length-1].instruction+=" ?"+ot.instruction.modifier+"?"}ot.instruction.exit&&(p.routeInstructions[p.routeInstructions.length-1].instruction+="".concat(ot.instruction.exit,"e sortie")),ot.attributes.name&&((ot.attributes.name.nom_1_droite||ot.attributes.name.toponyme)&&(p.routeInstructions[p.routeInstructions.length-1].instruction+=" sur"),ot.attributes.name.nom_1_droite&&(p.routeInstructions[p.routeInstructions.length-1].instruction+=" ".concat(ot.attributes.name.nom_1_droite)),ot.attributes.name.toponyme&&(p.routeInstructions[p.routeInstructions.length-1].instruction+=" ".concat(ot.attributes.name.toponyme)))})}}if(!p)return void c.onError.call(c.scope,new R(h.getMessage("SERVICE_RESPONSE_ANALYSE","json")));if(p.exceptionReport)return void c.onError.call(c.scope,new R(h.getMessage("SERVICE_RESPONSE_EXCEPTION_2")))}c.onSuccess.call(c.scope,p)}else c.onError.call(c.scope,new R(h.getMessage("SERVICE_RESPONSE_EMPTY")))}};function Xt(c){if(!(this instanceof Xt))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","Route"));if(this.CLASSNAME="Route",F.apply(this,arguments),this.logger=a.getLogger("Gp.Services.Route"),this.logger.trace("[Constructeur Route (options)]"),!c.startPoint)throw new Error(h.getMessage("PARAM_MISSING","startPoint"));if(c.startPoint.x===null)throw new Error(h.getMessage("PARAM_MISSING","startPoint.x"));if(c.startPoint.y===null)throw new Error(h.getMessage("PARAM_MISSING","startPoint.y"));if(!c.endPoint)throw new Error(h.getMessage("PARAM_MISSING","endPoint"));if(c.endPoint.x===null)throw new Error(h.getMessage("PARAM_MISSING","endPoint.x"));if(c.endPoint.y===null)throw new Error(h.getMessage("PARAM_MISSING","endPoint.y"));if(c.outputFormat&&c.outputFormat!=="json"&&this.logger.warn("options.outputFormat could only be json"),this.options.outputFormat="json",this.options.resource=c.resource||"bdtopo-osrm",this.options.startPoint=c.startPoint,this.options.endPoint=c.endPoint,this.options.viaPoints=c.viaPoints||[],this.options.routePreference=c.routePreference||"fastest",c.graph?(c.graph==="Voiture"&&(this.options.graph="car"),c.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],c.constraints){if(!Array.isArray(c.constraints))throw new Error(h.getMessage("PARAM_TYPE","constraints"));for(var d=0;d<c.constraints.length;d++)this.options.constraints.push(c.constraints[d])}var p={},T={},C={};if(c.exclusions&&c.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var D=0;D<c.exclusions.length;D++)typeof c.exclusions[D]=="string"&&(c.exclusions[D]=c.exclusions[D].toLowerCase(),c.exclusions[D]==="toll"&&(C.constraintType="banned",C.key="wayType",C.operator="=",C.value="autoroute",this.options.constraints.push(C)),c.exclusions[D]==="tunnel"&&(p.constraintType="banned",p.key="wayType",p.operator="=",p.value="tunnel",this.options.constraints.push(p)),c.exclusions[D]==="bridge"&&(T.constraintType="banned",T.key="wayType",T.operator="=",T.value="pont",this.options.constraints.push(T)))}if(this.options.geometryInInstructions=c.geometryInInstructions||!1,this.options.provideBbox=c.provideBbox||!0,this.options.distanceUnit=c.distanceUnit||"m",this.options.timeUnit=c.timeUnit||"second",this.options.expectedStartTime=null,this.options.srs=c.srs||"EPSG:4326",this.options.waysAttributes=c.waysAttributes||[],!this.options.serverUrl){var $=H.Route.newUrl();if(!$)throw new Error("Url by default not found !");this.options.serverUrl=$,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}Xt.prototype=Object.create(F.prototype,{}),Xt.prototype.constructor=Xt,Xt.prototype.buildRequest=function(c,d){var p={resource:this.options.resource,startPoint:this.options.startPoint,endPoint:this.options.endPoint,viaPoints:this.options.viaPoints,provideBbox:this.options.provideBbox,constraints:this.options.constraints,distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,graph:this.options.graph,geometryInInstructions:this.options.geometryInInstructions,routePreference:this.options.routePreference,srs:this.options.srs,waysAttributes:this.options.waysAttributes};this.request=A.build(p),this.request?d.call(this,this.request):c.call(this,new R(h.getMessage("SERVICE_REQUEST_BUILD")))},Xt.prototype.analyzeResponse=function(c,d){if(this.response){var p={distanceUnit:this.options.distanceUnit,timeUnit:this.options.timeUnit,response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onError:c,onSuccess:d,scope:this,geometryInInstructions:this.options.geometryInInstructions};Yt.build(p)}else c.call(this,new R(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var we=Xt;function he(c){if(!(this instanceof he))throw new TypeError("ProcessIsoCurveParam constructor cannot be called as a function.");this.logger=a.getLogger(),this.logger.trace("[Constructeur ProcessIsoCurveParam ()]"),this.options=c||{},this.id=this.options.id,this.resource=this.options.resource,this.point=this.options.position,this.crs=this.options.srs,this.profile=this.options.graph,this.constraints=this.options.constraints,this.reverse=this.options.reverse,this.timeUnit=this.options.timeUnit,this.distanceUnit=this.options.distanceUnit,this.options.method==="distance"?(this.costType="distance",this.costValue=this.options.distance,this.distanceUnit==="m"&&this.costValue>=5e4&&(this.distanceUnit="km",this.costValue/=1e3)):(this.costType="time",this.costValue=this.options.time)}he.CLASSNAME="ProcessIsoCurveParam",he.prototype={constructor:he,getLocation:function(){return this.point.x+","+this.point.y},getDistanceUnit:function(){return this.distanceUnit==="m"?"meter":this.distanceUnit==="km"?"kilometer":""},getConstraints:function(){var c=[];if(this.constraints.length!==0)for(var d=0;d<this.constraints.length;d++)c.push(JSON.stringify(this.constraints[d]));return c.join("|")},getDirection:function(){return this.reverse?"arrival":"departure"}},he.prototype.getParams=function(){var c=[];return c.push({k:"resource",v:this.resource}),c.push({k:"point",v:this.getLocation()}),c.push({k:"direction",v:this.getDirection()}),c.push({k:"costType",v:this.costType}),c.push({k:"costValue",v:this.costValue}),c.push({k:"profile",v:this.profile}),c.push({k:"timeUnit",v:this.timeUnit}),c.push({k:"distanceUnit",v:this.getDistanceUnit()}),this.crs&&c.push({k:"crs",v:this.crs}),this.constraints&&c.push({k:"constraints",v:this.getConstraints()}),c};var ze=he;function Me(c){if(this.logger=a.getLogger("ProcessIsoCurveRequest"),this.logger.trace("[Constructeur ProcessIsoCurveRequest ()]"),!(this instanceof Me))throw new TypeError("ProcessIsoCurveRequest constructor cannot be called as a function.");if(!c)throw new Error(h.getMessage("PARAM_EMPTY","options"));this.settings=c,this.mode=this.settings.httpMethod||"GET"}Me.prototype={requestString:null,constructor:Me,processRequestString:function(){var c="",d=0;switch(this.mode){case"GET":this.logger.trace("Process GET Request");var p=new ze(this.settings).getParams();for(d=0;d<p.length;d++){var T=p[d];c&&(c+="&"),c+=T.k+"="+T.v}break;case"POST":this.logger.trace("Process POST Request");var C={};C.resource=this.settings.resource,C.point=this.settings.position.x+","+this.settings.position.y,this.settings.method==="distance"?(C.costType="distance",C.costValue=this.settings.distance):(C.costType="time",C.costValue=this.settings.time),C.profile=this.settings.graph,this.settings.reverse?C.direction="arrival":C.direction="departure",C.constraints=this.settings.constraints,C.distanceUnit=this.settings.distanceUnit,C.timeUnit=this.settings.timeUnit,C.crs=this.settings.srs,c=JSON.stringify(C);break;default:this.logger.error("No other HTTP method supported by the service !")}return this.logger.trace(c),this.requestString=c,this.requestString}};var Ve=Me;function pe(){if(!(this instanceof pe))throw new TypeError("ProcessIsoCurveResponse constructor cannot be called as a function.");this.message=null,this.id=null,this.location={},this.location.x=null,this.location.y=null,this.srs=null,this.geometry=null,this.time=null,this.distance=null}pe.prototype={constructor:pe};var We=pe,Pi={build:function(c){var d=a.getLogger("ProcessIsoCurveResponseFactory");d.trace(["ProcessIsoCurveResponseFactory::build()"]);var p=null;if(c.response){if(c.rawResponse)d.trace("analyze response : raw"),p=c.response;else{var T;if(d.trace("analyze response : json"),T=typeof c.response=="string"?JSON.parse(c.response):c.response,p=new We,!T)return void c.onError.call(c.scope,new R(h.getMessage("SERVICE_RESPONSE_ANALYSE",c.response)));T.costType==="distance"?(p.time="",p.distance=T.costValue):(p.time=T.costValue,p.distance=""),p.message="",p.id="",p.srs=T.crs,p.geometry=T.geometry;var C=T.point.split(",");if(p.location&&(p.location.x=C[0],p.location.y=C[1]),p.exceptionReport)return void c.onError.call(c.scope,new R({message:h.getMessage("SERVICE_RESPONSE_EXCEPTION",p.exceptionReport),type:R.TYPE_SRVERR,status:200}))}c.onSuccess.call(c.scope,p)}else c.onError.call(c.scope,new R(h.getMessage("SERVICE_RESPONSE_EMPTY")))}};function Le(c){if(!(this instanceof Le))throw new TypeError(h.getMessage("CLASS_CONSTRUCTOR","ProcessIsoCurve"));if(this.CLASSNAME="ProcessIsoCurve",F.apply(this,arguments),this.logger=a.getLogger("Gp.Services.ProcessIsoCurve"),this.logger.trace("[Constructeur ProcessIsoCurve (options)]"),!c.position)throw new Error(h.getMessage("PARAM_MISSING","position"));if(c.position.x===null)throw new Error(h.getMessage("PARAM_MISSING","position.x"));if(c.position.y===null)throw new Error(h.getMessage("PARAM_MISSING","position.y"));if(!c.time&&!c.distance)throw new Error("Parameter (s) 'distance' missing. Parameter time to calculate an isochrone, parameter distance for an isodistance");if(!c.time&&c.distance&&(this.options.method="distance",this.options.time&&delete this.options.time),c.time&&!c.distance&&(this.options.method="time",this.options.distance&&delete this.options.distance),this.options.method=this.options.method||"time",this.options.resource=c.resource||"bdtopo-valhalla",this.options.exclusions=c.exclusions||[],this.options.reverse=c.reverse||!1,this.options.srs=c.srs||"EPSG:4326",this.options.distanceUnit=c.distanceUnit||"m",this.options.timeUnit=c.timeUnit||"second",c.smoothing&&this.logger.warn("options.smoothing is DEPRECATED"),this.options.smoothing=!1,c.holes&&this.logger.warn("options.holes is DEPRECATED"),this.options.holes=!1,c.graph?(c.graph==="Voiture"&&(this.options.graph="car"),c.graph==="Pieton"&&(this.options.graph="pedestrian")):this.options.graph="car",this.options.constraints=[],c.constraints){if(!Array.isArray(c.constraints))throw new Error(h.getMessage("PARAM_TYPE","constraints"));for(var d=0;d<c.constraints.length;d++)this.options.constraints.push(c.constraints[d])}var p={},T={},C={};if(c.exclusions&&c.exclusions.length!==0){this.logger.warn("options.exclusions is DEPRECATED !!");for(var D=0;D<c.exclusions.length;D++)typeof c.exclusions[D]=="string"&&(c.exclusions[D]=c.exclusions[D].toLowerCase(),c.exclusions[D]==="toll"&&(C.constraintType="banned",C.key="wayType",C.operator="=",C.value="autoroute",this.options.constraints.push(C)),c.exclusions[D]==="tunnel"&&(p.constraintType="banned",p.key="wayType",p.operator="=",p.value="tunnel",this.options.constraints.push(p)),c.exclusions[D]==="bridge"&&(T.constraintType="banned",T.key="wayType",T.operator="=",T.value="pont",this.options.constraints.push(T)))}if(this.options.outputFormat=typeof c.outputFormat=="string"?c.outputFormat.toLowerCase():"json",c.outputFormat&&c.outputFormat!=="json")throw new Error(h.getMessage("PARAM_NOT_SUPPORT","outputFormat"));if(this.options.outputFormat="json",!this.options.serverUrl){var $=H.ProcessIsoCurve.newUrl();if(!$)throw new Error("Url by default not found !");this.options.serverUrl=$,this.logger.trace("Serveur URL par defaut : "+this.options.serverUrl)}}Le.prototype=Object.create(F.prototype,{}),Le.prototype.constructor=Le,Le.prototype.buildRequest=function(c,d){try{var p=new Ve(this.options);if(!p.processRequestString())throw new Error(h.getMessage("SERVICE_REQUEST_BUILD"));this.request=p.requestString}catch(T){return void c.call(this,new R(T.message))}d.call(this,this.request)},Le.prototype.analyzeResponse=function(c,d){if(this.response){var p={response:this.response,outputFormat:this.options.outputFormat,rawResponse:this.options.rawResponse,onSuccess:d,onError:c,scope:this};Pi.build(p)}else c.call(this,new R(h.getMessage("SERVICE_RESPONSE_EMPTY")))};var Dn=Le,ei={getConfig:function(c){new M(c).call()},getAltitude:function(c){new ce(c).call()},geocode:function(c){new Te(c).call()},reverseGeocode:function(c){new ie(c).call()},autoComplete:function(c){new Qt(c).call()},route:function(c){new we(c).call()},isoCurve:function(c){new Dn(c).call()}},qs=O.version,Xs=O.date,Kt={};Kt.servicesVersion=qs,Kt.servicesDate=Xs,Kt.Protocols={},Kt.Protocols.XHR=E,Kt.Services=ei,Kt.Services.DefaultUrl=H,Kt.Services.AltiResponse=rt,Kt.Services.Alti={},Kt.Services.Alti.Elevation=Ot,Kt.Services.AutoCompleteResponse=ne,Kt.Services.AutoComplete={},Kt.Services.AutoComplete.SuggestedLocation=jt,Kt.Services.Config=M,Kt.Services.IsoCurveResponse=We,Kt.Services.RouteResponse=at,Kt.Services.Route={},Kt.Services.Route.RouteInstruction=vt,Kt.Error=R,Kt.Helper=u,n.default=Kt}]).default})})(jo);var hs=jo.exports;const zr=(r,t,e,i=!1)=>{const n=[];return window.$barry.calculateToll||n.push("toll"),new Promise(s=>{hs.Services.route({startPoint:{x:r[0],y:r[1]},endPoint:{x:t[0],y:t[1]},graph:window.$barry.calculateTransport,exclusions:n,routePreference:window.$barry.calculateMode==="time"?"fastest":"shortest",geometryInInstructions:i,apiKey:"calcul",onSuccess:o=>{o.key=e,s(o)},onFailure:o=>{alert(o)}})})},te={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function gt(){throw new Error("Unimplemented abstract method.")}let el=0;function Lt(r){return r.ol_uid||(r.ol_uid=String(++el))}function Ys(r){return r[0]>0&&r[1]>0}function il(r,t,e){return e===void 0&&(e=[0,0]),e[0]=r[0]*t+.5|0,e[1]=r[1]*t+.5|0,e}function ve(r,t){return Array.isArray(r)?r:(t===void 0?t=[r,r]:(t[0]=r,t[1]=r),t)}class fr{constructor(t){this.opacity_=t.opacity,this.rotateWithView_=t.rotateWithView,this.rotation_=t.rotation,this.scale_=t.scale,this.scaleArray_=ve(t.scale),this.displacement_=t.displacement,this.declutterMode_=t.declutterMode}clone(){const t=this.getScale();return new fr({opacity:this.getOpacity(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return gt()}getImage(t){return gt()}getHitDetectionImage(){return gt()}getPixelRatio(t){return 1}getImageState(){return gt()}getImageSize(){return gt()}getOrigin(){return gt()}getSize(){return gt()}setDisplacement(t){this.displacement_=t}setOpacity(t){this.opacity_=t}setRotateWithView(t){this.rotateWithView_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ve(t)}listenImageChange(t){gt()}load(){gt()}unlistenImageChange(t){gt()}}function Zt(r,t,e){return Math.min(Math.max(r,t),e)}function nl(r,t,e,i,n,s){const o=n-e,a=s-i;if(o!==0||a!==0){const l=((r-e)*o+(t-i)*a)/(o*o+a*a);l>1?(e=n,i=s):l>0&&(e+=o*l,i+=a*l)}return bi(r,t,e,i)}function bi(r,t,e,i){const n=e-r,s=i-t;return n*n+s*s}function rl(r){const t=r.length;for(let i=0;i<t;i++){let n=i,s=Math.abs(r[i][i]);for(let a=i+1;a<t;a++){const l=Math.abs(r[a][i]);l>s&&(s=l,n=a)}if(s===0)return null;const o=r[n];r[n]=r[i],r[i]=o;for(let a=i+1;a<t;a++){const l=-r[a][i]/r[i][i];for(let h=i;h<t+1;h++)i==h?r[a][h]=0:r[a][h]+=l*r[i][h]}}const e=new Array(t);for(let i=t-1;i>=0;i--){e[i]=r[i][t]/r[i][i];for(let n=i-1;n>=0;n--)r[n][t]-=r[n][i]*e[i]}return e}function $n(r){return r*Math.PI/180}function Vi(r,t){const e=r%t;return e*t<0?e+t:e}function Ze(r,t,e){return r+e*(t-r)}function Yo(r,t){const e=Math.pow(10,t);return Math.round(r*e)/e}function Fn(r,t){return Math.floor(Yo(r,t))}function Gn(r,t){return Math.ceil(Yo(r,t))}const sl=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,ol=/^([a-z]*)$|^hsla?\(.*\)$/i;function zo(r){return typeof r=="string"?r:Vo(r)}function al(r){const t=document.createElement("div");if(t.style.color=r,t.style.color!==""){document.body.appendChild(t);const e=getComputedStyle(t).color;return document.body.removeChild(t),e}else return""}const ll=function(){const t={};let e=0;return function(i){let n;if(t.hasOwnProperty(i))n=t[i];else{if(e>=1024){let s=0;for(const o in t)s++&3||(delete t[o],--e)}n=cl(i),t[i]=n,++e}return n}}();function Kn(r){return Array.isArray(r)?r:ll(r)}function cl(r){let t,e,i,n,s;if(ol.exec(r)&&(r=al(r)),sl.exec(r)){const o=r.length-1;let a;o<=4?a=1:a=2;const l=o===4||o===8;t=parseInt(r.substr(1+0*a,a),16),e=parseInt(r.substr(1+1*a,a),16),i=parseInt(r.substr(1+2*a,a),16),l?n=parseInt(r.substr(1+3*a,a),16):n=255,a==1&&(t=(t<<4)+t,e=(e<<4)+e,i=(i<<4)+i,l&&(n=(n<<4)+n)),s=[t,e,i,n/255]}else r.startsWith("rgba(")?(s=r.slice(5,-1).split(",").map(Number),zs(s)):r.startsWith("rgb(")?(s=r.slice(4,-1).split(",").map(Number),s.push(1),zs(s)):xt(!1,14);return s}function zs(r){return r[0]=Zt(r[0]+.5|0,0,255),r[1]=Zt(r[1]+.5|0,0,255),r[2]=Zt(r[2]+.5|0,0,255),r[3]=Zt(r[3],0,1),r}function Vo(r){let t=r[0];t!=(t|0)&&(t=t+.5|0);let e=r[1];e!=(e|0)&&(e=e+.5|0);let i=r[2];i!=(i|0)&&(i=i+.5|0);const n=r[3]===void 0?1:Math.round(r[3]*100)/100;return"rgba("+t+","+e+","+i+","+n+")"}function ke(r){return Array.isArray(r)?Vo(r):r}const fi=typeof navigator<"u"&&typeof navigator.userAgent<"u"?navigator.userAgent.toLowerCase():"",hl=fi.includes("firefox"),ul=fi.includes("safari")&&!fi.includes("chrom");ul&&(fi.includes("version/15.4")||/cpu (os|iphone os) 15_4 like mac os x/.test(fi));const dl=fi.includes("webkit")&&!fi.includes("edge"),fl=fi.includes("macintosh"),Wo=typeof devicePixelRatio<"u"?devicePixelRatio:1,us=typeof WorkerGlobalScope<"u"&&typeof OffscreenCanvas<"u"&&self instanceof WorkerGlobalScope,gl=typeof Image<"u"&&Image.prototype.decode,Bo=function(){let r=!1;try{const t=Object.defineProperty({},"passive",{get:function(){r=!0}});window.addEventListener("_",null,t),window.removeEventListener("_",null,t)}catch{}return r}();function xe(r,t,e,i){let n;return e&&e.length?n=e.shift():us?n=new OffscreenCanvas(r||300,t||300):n=document.createElement("canvas"),r&&(n.width=r),t&&(n.height=t),n.getContext("2d",i)}function Ho(r){const t=r.canvas;t.width=1,t.height=1,r.clearRect(0,0,1,1)}function Vs(r,t){const e=t.parentNode;e&&e.replaceChild(r,t)}function Vr(r){return r&&r.parentNode?r.parentNode.removeChild(r):null}function pl(r){for(;r.lastChild;)r.removeChild(r.lastChild)}function ml(r,t){const e=r.childNodes;for(let i=0;;++i){const n=e[i],s=t[i];if(!n&&!s)break;if(n!==s){if(!n){r.appendChild(s);continue}if(!s){r.removeChild(n),--i;continue}r.insertBefore(s,n)}}}class ti{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const Hi={PROPERTYCHANGE:"propertychange"};class ds{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}function _l(r,t,e){let i,n;e=e||$i;let s=0,o=r.length,a=!1;for(;s<o;)i=s+(o-s>>1),n=+e(r[i],t),n<0?s=i+1:(o=i,a=!n);return a?s:~s}function $i(r,t){return r>t?1:r<t?-1:0}function fs(r,t,e){const i=r.length;if(r[0]<=t)return 0;if(t<=r[i-1])return i-1;{let n;if(e>0){for(n=1;n<i;++n)if(r[n]<t)return n-1}else if(e<0){for(n=1;n<i;++n)if(r[n]<=t)return n}else for(n=1;n<i;++n){if(r[n]==t)return n;if(r[n]<t)return typeof e=="function"?e(t,r[n-1],r[n])>0?n-1:n:r[n-1]-t<t-r[n]?n-1:n}return i-1}}function yl(r,t,e){for(;t<e;){const i=r[t];r[t]=r[e],r[e]=i,++t,--e}}function Je(r,t){const e=Array.isArray(t)?t:[t],i=e.length;for(let n=0;n<i;n++)r[r.length]=e[n]}function Li(r,t){const e=r.length;if(e!==t.length)return!1;for(let i=0;i<e;i++)if(r[i]!==t[i])return!1;return!0}function El(r,t,e){const i=t;return r.every(function(n,s){if(s===0)return!0;const o=i(r[s-1],n);return!(o>0||o===0)})}function dn(){return!0}function gr(){return!1}function Ii(){}function wl(r){let t=!1,e,i,n;return function(){const s=Array.prototype.slice.call(arguments);return(!t||this!==n||!Li(s,i))&&(t=!0,n=this,i=s,e=r.apply(this,arguments)),e}}function Cn(r){for(const t in r)delete r[t]}function Ki(r){let t;for(t in r)return!1;return!t}class pr extends ds{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const i=this.listeners_||(this.listeners_={}),n=i[t]||(i[t]=[]);n.includes(e)||n.push(e)}dispatchEvent(t){const e=typeof t=="string",i=e?t:t.type,n=this.listeners_&&this.listeners_[i];if(!n)return;const s=e?new ti(t):t;s.target||(s.target=this.eventTarget_||this);const o=this.dispatching_||(this.dispatching_={}),a=this.pendingRemovals_||(this.pendingRemovals_={});i in o||(o[i]=0,a[i]=0),++o[i];let l;for(let h=0,u=n.length;h<u;++h)if("handleEvent"in n[h]?l=n[h].handleEvent(s):l=n[h].call(this,s),l===!1||s.propagationStopped){l=!1;break}if(--o[i]===0){let h=a[i];for(delete a[i];h--;)this.removeEventListener(i,Ii);delete o[i]}return l}disposeInternal(){this.listeners_&&Cn(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){const i=this.listeners_&&this.listeners_[t];if(i){const n=i.indexOf(e);n!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(i[n]=Ii,++this.pendingRemovals_[t]):(i.splice(n,1),i.length===0&&delete this.listeners_[t]))}}}const yt={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function St(r,t,e,i,n){if(i&&i!==r&&(e=e.bind(i)),n){const o=e;e=function(){r.removeEventListener(t,e),o.apply(this,arguments)}}const s={target:r,type:t,listener:e};return r.addEventListener(t,e),s}function Zn(r,t,e,i){return St(r,t,e,i,!0)}function qt(r){r&&r.target&&(r.target.removeEventListener(r.type,r.listener),Cn(r))}class Sn extends pr{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(yt.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let s=0;s<i;++s)n[s]=St(this,t[s],e);return n}else return St(this,t,e)}onceInternal(t,e){let i;if(Array.isArray(t)){const n=t.length;i=new Array(n);for(let s=0;s<n;++s)i[s]=Zn(this,t[s],e)}else i=Zn(this,t,e);return e.ol_key=i,i}unInternal(t,e){const i=e.ol_key;if(i)vl(i);else if(Array.isArray(t))for(let n=0,s=t.length;n<s;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}}Sn.prototype.on;Sn.prototype.once;Sn.prototype.un;function vl(r){if(Array.isArray(r))for(let t=0,e=r.length;t<e;++t)qt(r[t]);else qt(r)}class Ws extends ti{constructor(t,e,i){super(t),this.key=e,this.oldValue=i}}class Xe extends Sn{constructor(t){super(),this.on,this.once,this.un,Lt(this),this.values_=null,t!==void 0&&this.setProperties(t)}get(t){let e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}getKeys(){return this.values_&&Object.keys(this.values_)||[]}getProperties(){return this.values_&&Object.assign({},this.values_)||{}}hasProperties(){return!!this.values_}notify(t,e){let i;i=`change:${t}`,this.hasListener(i)&&this.dispatchEvent(new Ws(i,t,e)),i=Hi.PROPERTYCHANGE,this.hasListener(i)&&this.dispatchEvent(new Ws(i,t,e))}addChangeListener(t,e){this.addEventListener(`change:${t}`,e)}removeChangeListener(t,e){this.removeEventListener(`change:${t}`,e)}set(t,e,i){const n=this.values_||(this.values_={});if(i)n[t]=e;else{const s=n[t];n[t]=e,s!==e&&this.notify(t,s)}}setProperties(t,e){for(const i in t)this.set(i,t[i],e)}applyProperties(t){t.values_&&Object.assign(this.values_||(this.values_={}),t.values_)}unset(t,e){if(this.values_&&t in this.values_){const i=this.values_[t];delete this.values_[t],Ki(this.values_)&&(this.values_=null),e||this.notify(t,i)}}}const Un="ol-hidden",mr="ol-unselectable",gs="ol-control",Bs="ol-collapsed",xl=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),Hs=["style","variant","weight","size","lineHeight","family"],$o=function(r){const t=r.match(xl);if(!t)return null;const e={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,n=Hs.length;i<n;++i){const s=t[i+1];s!==void 0&&(e[Hs[i]]=s)}return e.families=e.family.split(/,\s?/),e},Ko="10px sans-serif",Qe="#000",Jn="round",fn=[],gn=0,Zi="round",pn=10,mn="#000",_n="center",Qn="middle",vi=[0,0,0,0],yn=1,$e=new Xe;let Ui=null,Wr;const Br={},Tl=function(){const t="32px ",e=["monospace","serif"],i=e.length,n="wmytzilWMYTZIL@#/&?$%10";let s,o;function a(h,u,g){let m=!0;for(let y=0;y<i;++y){const w=e[y];if(o=tr(h+" "+u+" "+t+w,n),g!=w){const E=tr(h+" "+u+" "+t+g+","+w,n);m=m&&E!=o}}return!!m}function l(){let h=!0;const u=$e.getKeys();for(let g=0,m=u.length;g<m;++g){const y=u[g];$e.get(y)<100&&(a.apply(this,y.split(`
`))?(Cn(Br),Ui=null,Wr=void 0,$e.set(y,100)):($e.set(y,$e.get(y)+1,!0),h=!1))}h&&(clearInterval(s),s=void 0)}return function(h){const u=$o(h);if(!u)return;const g=u.families;for(let m=0,y=g.length;m<y;++m){const w=g[m],E=u.style+`
`+u.weight+`
`+w;$e.get(E)===void 0&&($e.set(E,100,!0),a(u.style,u.weight,w)||($e.set(E,0,!0),s===void 0&&(s=setInterval(l,32))))}}}(),Rl=function(){let r;return function(t){let e=Br[t];if(e==null){if(us){const i=$o(t),n=Zo(t,"Žg");e=(isNaN(Number(i.lineHeight))?1.2:Number(i.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else r||(r=document.createElement("div"),r.innerHTML="M",r.style.minHeight="0",r.style.maxHeight="none",r.style.height="auto",r.style.padding="0",r.style.border="none",r.style.position="absolute",r.style.display="block",r.style.left="-99999px"),r.style.font=t,document.body.appendChild(r),e=r.offsetHeight,document.body.removeChild(r);Br[t]=e}return e}}();function Zo(r,t){return Ui||(Ui=xe(1,1)),r!=Wr&&(Ui.font=r,Wr=Ui.font),Ui.measureText(t)}function tr(r,t){return Zo(r,t).width}function $s(r,t,e){if(t in e)return e[t];const i=t.split(`
`).reduce((n,s)=>Math.max(n,tr(r,s)),0);return e[t]=i,i}function bl(r,t){const e=[],i=[],n=[];let s=0,o=0,a=0,l=0;for(let h=0,u=t.length;h<=u;h+=2){const g=t[h];if(g===`
`||h===u){s=Math.max(s,o),n.push(o),o=0,a+=l;continue}const m=t[h+1]||r.font,y=tr(m,g);e.push(y),o+=y;const w=Rl(m);i.push(w),l=Math.max(l,w)}return{width:s,height:a,widths:e,heights:i,lineWidths:n}}function Cl(r,t,e,i,n,s,o,a,l,h,u){r.save(),e!==1&&(r.globalAlpha*=e),t&&r.setTransform.apply(r,t),i.contextInstructions?(r.translate(l,h),r.scale(u[0],u[1]),Sl(i,r)):u[0]<0||u[1]<0?(r.translate(l,h),r.scale(u[0],u[1]),r.drawImage(i,n,s,o,a,0,0,o,a)):r.drawImage(i,n,s,o,a,l,h,o*u[0],a*u[1]),r.restore()}function Sl(r,t){const e=r.contextInstructions;for(let i=0,n=e.length;i<n;i+=2)Array.isArray(e[i+1])?t[e[i]].apply(t,e[i+1]):t[e[i]]=e[i+1]}class _r extends fr{constructor(t){const e=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:1,rotateWithView:e,rotation:t.rotation!==void 0?t.rotation:0,scale:t.scale!==void 0?t.scale:1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode}),this.canvas_=void 0,this.hitDetectionCanvas_=null,this.fill_=t.fill!==void 0?t.fill:null,this.origin_=[0,0],this.points_=t.points,this.radius_=t.radius!==void 0?t.radius:t.radius1,this.radius2_=t.radius2,this.angle_=t.angle!==void 0?t.angle:0,this.stroke_=t.stroke!==void 0?t.stroke:null,this.size_=null,this.renderOptions_=null,this.render()}clone(){const t=this.getScale(),e=new _r({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}getAnchor(){const t=this.size_;if(!t)return null;const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]/2-e[0]/i[0],t[1]/2+e[1]/i[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(t){this.fill_=t,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}getImage(t){let e=this.canvas_[t];if(!e){const i=this.renderOptions_,n=xe(i.size*t,i.size*t);this.draw_(i,n,t),e=n.canvas,this.canvas_[t]=e}return e}getPixelRatio(t){return t}getImageSize(){return this.size_}getImageState(){return te.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t,this.render()}listenImageChange(t){}load(){}unlistenImageChange(t){}calculateLineJoinSize_(t,e,i){if(e===0||this.points_===1/0||t!=="bevel"&&t!=="miter")return e;let n=this.radius_,s=this.radius2_===void 0?n:this.radius2_;if(n<s){const F=n;n=s,s=F}const o=this.radius2_===void 0?this.points_:this.points_*2,a=2*Math.PI/o,l=s*Math.sin(a),h=Math.sqrt(s*s-l*l),u=n-h,g=Math.sqrt(l*l+u*u),m=g/l;if(t==="miter"&&m<=i)return m*e;const y=e/2/m,w=e/2*(u/g),v=Math.sqrt((n+y)*(n+y)+w*w)-n;if(this.radius2_===void 0||t==="bevel")return v*2;const x=n*Math.sin(a),S=Math.sqrt(n*n-x*x),R=s-S,k=Math.sqrt(x*x+R*R)/x;if(k<=i){const F=k*e/2-s-n;return 2*Math.max(v,F)}return v*2}createRenderOptions(){let t=Zi,e=0,i=null,n=0,s,o=0;this.stroke_&&(s=this.stroke_.getColor(),s===null&&(s=mn),s=ke(s),o=this.stroke_.getWidth(),o===void 0&&(o=yn),i=this.stroke_.getLineDash(),n=this.stroke_.getLineDashOffset(),t=this.stroke_.getLineJoin(),t===void 0&&(t=Zi),e=this.stroke_.getMiterLimit(),e===void 0&&(e=pn));const a=this.calculateLineJoinSize_(t,o,e),l=Math.max(this.radius_,this.radius2_||0),h=Math.ceil(2*l+a);return{strokeStyle:s,strokeWidth:o,size:h,lineDash:i,lineDashOffset:n,lineJoin:t,miterLimit:e}}render(){this.renderOptions_=this.createRenderOptions();const t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}draw_(t,e,i){if(e.scale(i,i),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){let n=this.fill_.getColor();n===null&&(n=Qe),e.fillStyle=ke(n),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}createHitDetectionCanvas_(t){if(this.fill_){let e=this.fill_.getColor(),i=0;if(typeof e=="string"&&(e=Kn(e)),e===null?i=1:Array.isArray(e)&&(i=e.length===4?e[3]:1),i===0){const n=xe(t.size,t.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(t,n)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}createPath_(t){let e=this.points_;const i=this.radius_;if(e===1/0)t.arc(0,0,i,0,2*Math.PI);else{const n=this.radius2_===void 0?i:this.radius2_;this.radius2_!==void 0&&(e*=2);const s=this.angle_-Math.PI/2,o=2*Math.PI/e;for(let a=0;a<e;a++){const l=s+a*o,h=a%2===0?i:n;t.lineTo(h*Math.cos(l),h*Math.sin(l))}t.closePath()}}drawHitDetectionCanvas_(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=Qe,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}class In extends _r{constructor(t){t=t||{radius:5},super({points:1/0,fill:t.fill,radius:t.radius,stroke:t.stroke,scale:t.scale!==void 0?t.scale:1,rotation:t.rotation!==void 0?t.rotation:0,rotateWithView:t.rotateWithView!==void 0?t.rotateWithView:!1,displacement:t.displacement!==void 0?t.displacement:[0,0],declutterMode:t.declutterMode})}clone(){const t=this.getScale(),e=new In({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}setRadius(t){this.radius_=t,this.render()}}class Qi{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null}clone(){const t=this.getColor();return new Qi({color:Array.isArray(t)?t.slice():t||void 0})}getColor(){return this.color_}setColor(t){this.color_=t}}class Il{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let t=0;for(const e in this.cache_){const i=this.cache_[e];!(t++&3)&&!i.hasListener()&&(delete this.cache_[e],--this.cacheSize_)}}}get(t,e,i){const n=Ks(t,e,i);return n in this.cache_?this.cache_[n]:null}set(t,e,i,n){const s=Ks(t,e,i);this.cache_[s]=n,++this.cacheSize_}setSize(t){this.maxCacheSize_=t,this.expire()}}function Ks(r,t,e){const i=e?zo(e):"null";return t+":"+r+":"+i}const er=new Il;function Jo(r,t,e){const i=r;let n=!0,s=!1,o=!1;const a=[Zn(i,yt.LOAD,function(){o=!0,s||t()})];return i.src&&gl?(s=!0,i.decode().then(function(){n&&t()}).catch(function(l){n&&(o?t():e())})):a.push(Zn(i,yt.ERROR,e)),function(){n=!1,a.forEach(qt)}}let rn=null;class Al extends pr{constructor(t,e,i,n,s,o){super(),this.hitDetectionImage_=null,this.image_=t,this.crossOrigin_=n,this.canvas_={},this.color_=o,this.unlisten_=null,this.imageState_=s,this.size_=i,this.src_=e,this.tainted_}initializeImage_(){this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(this.tainted_===void 0&&this.imageState_===te.LOADED){rn||(rn=xe(1,1)),rn.drawImage(this.image_,0,0);try{rn.getImageData(0,0,1,1),this.tainted_=!1}catch{rn=null,this.tainted_=!0}}return this.tainted_===!0}dispatchChangeEvent_(){this.dispatchEvent(yt.CHANGE)}handleImageError_(){this.imageState_=te.ERROR,this.unlistenImage_(),this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=te.LOADED,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}getImage(t){return this.image_||this.initializeImage_(),this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}getPixelRatio(t){return this.replaceColor_(t),this.canvas_[t]?t:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const t=this.size_[0],e=this.size_[1],i=xe(t,e);i.fillRect(0,0,t,e),this.hitDetectionImage_=i.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===te.IDLE){this.image_||this.initializeImage_(),this.imageState_=te.LOADING;try{this.image_.src=this.src_}catch{this.handleImageError_()}this.unlisten_=Jo(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}replaceColor_(t){if(!this.color_||this.canvas_[t]||this.imageState_!==te.LOADED)return;const e=this.image_,i=document.createElement("canvas");i.width=Math.ceil(e.width*t),i.height=Math.ceil(e.height*t);const n=i.getContext("2d");n.scale(t,t),n.drawImage(e,0,0),n.globalCompositeOperation="multiply",n.fillStyle=zo(this.color_),n.fillRect(0,0,i.width/t,i.height/t),n.globalCompositeOperation="destination-in",n.drawImage(e,0,0),this.canvas_[t]=i}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function Ol(r,t,e,i,n,s){let o=er.get(t,i,s);return o||(o=new Al(r,t,e,i,n,s),er.set(t,i,s,o)),o}class yr extends fr{constructor(t){t=t||{};const e=t.opacity!==void 0?t.opacity:1,i=t.rotation!==void 0?t.rotation:0,n=t.scale!==void 0?t.scale:1,s=t.rotateWithView!==void 0?t.rotateWithView:!1;super({opacity:e,rotation:i,scale:n,displacement:t.displacement!==void 0?t.displacement:[0,0],rotateWithView:s,declutterMode:t.declutterMode}),this.anchor_=t.anchor!==void 0?t.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=t.anchorOrigin!==void 0?t.anchorOrigin:"top-left",this.anchorXUnits_=t.anchorXUnits!==void 0?t.anchorXUnits:"fraction",this.anchorYUnits_=t.anchorYUnits!==void 0?t.anchorYUnits:"fraction",this.crossOrigin_=t.crossOrigin!==void 0?t.crossOrigin:null;const o=t.img!==void 0?t.img:null;this.imgSize_=t.imgSize;let a=t.src;xt(!(a!==void 0&&o),4),xt(!o||o&&this.imgSize_,5),(a===void 0||a.length===0)&&o&&(a=o.src||Lt(o)),xt(a!==void 0&&a.length>0,6);const l=t.src!==void 0?te.IDLE:te.LOADED;this.color_=t.color!==void 0?Kn(t.color):null,this.iconImage_=Ol(o,a,this.imgSize_!==void 0?this.imgSize_:null,this.crossOrigin_,l,this.color_),this.offset_=t.offset!==void 0?t.offset:[0,0],this.offsetOrigin_=t.offsetOrigin!==void 0?t.offsetOrigin:"top-left",this.origin_=null,this.size_=t.size!==void 0?t.size:null}clone(){const t=this.getScale();return new yr({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:this.size_!==null?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let t=this.normalizedAnchor_;if(!t){t=this.anchor_;const n=this.getSize();if(this.anchorXUnits_=="fraction"||this.anchorYUnits_=="fraction"){if(!n)return null;t=this.anchor_.slice(),this.anchorXUnits_=="fraction"&&(t[0]*=n[0]),this.anchorYUnits_=="fraction"&&(t[1]*=n[1])}if(this.anchorOrigin_!="top-left"){if(!n)return null;t===this.anchor_&&(t=this.anchor_.slice()),(this.anchorOrigin_=="top-right"||this.anchorOrigin_=="bottom-right")&&(t[0]=-t[0]+n[0]),(this.anchorOrigin_=="bottom-left"||this.anchorOrigin_=="bottom-right")&&(t[1]=-t[1]+n[1])}this.normalizedAnchor_=t}const e=this.getDisplacement(),i=this.getScaleArray();return[t[0]-e[0]/i[0],t[1]+e[1]/i[1]]}setAnchor(t){this.anchor_=t,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(t){return this.iconImage_.getImage(t)}getPixelRatio(t){return this.iconImage_.getPixelRatio(t)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let t=this.offset_;if(this.offsetOrigin_!="top-left"){const e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice(),(this.offsetOrigin_=="top-right"||this.offsetOrigin_=="bottom-right")&&(t[0]=i[0]-e[0]-t[0]),(this.offsetOrigin_=="bottom-left"||this.offsetOrigin_=="bottom-right")&&(t[1]=i[1]-e[1]-t[1])}return this.origin_=t,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}listenImageChange(t){this.iconImage_.addEventListener(yt.CHANGE,t)}load(){this.iconImage_.load()}unlistenImageChange(t){this.iconImage_.removeEventListener(yt.CHANGE,t)}}class An{constructor(t){t=t||{},this.color_=t.color!==void 0?t.color:null,this.lineCap_=t.lineCap,this.lineDash_=t.lineDash!==void 0?t.lineDash:null,this.lineDashOffset_=t.lineDashOffset,this.lineJoin_=t.lineJoin,this.miterLimit_=t.miterLimit,this.width_=t.width}clone(){const t=this.getColor();return new An({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(t){this.color_=t}setLineCap(t){this.lineCap_=t}setLineDash(t){this.lineDash_=t}setLineDashOffset(t){this.lineDashOffset_=t}setLineJoin(t){this.lineJoin_=t}setMiterLimit(t){this.miterLimit_=t}setWidth(t){this.width_=t}}class gi{constructor(t){t=t||{},this.geometry_=null,this.geometryFunction_=Zs,t.geometry!==void 0&&this.setGeometry(t.geometry),this.fill_=t.fill!==void 0?t.fill:null,this.image_=t.image!==void 0?t.image:null,this.renderer_=t.renderer!==void 0?t.renderer:null,this.hitDetectionRenderer_=t.hitDetectionRenderer!==void 0?t.hitDetectionRenderer:null,this.stroke_=t.stroke!==void 0?t.stroke:null,this.text_=t.text!==void 0?t.text:null,this.zIndex_=t.zIndex}clone(){let t=this.getGeometry();return t&&typeof t=="object"&&(t=t.clone()),new gi({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(t){this.renderer_=t}setHitDetectionRenderer(t){this.hitDetectionRenderer_=t}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(t){this.fill_=t}getImage(){return this.image_}setImage(t){this.image_=t}getStroke(){return this.stroke_}setStroke(t){this.stroke_=t}getText(){return this.text_}setText(t){this.text_=t}getZIndex(){return this.zIndex_}setGeometry(t){typeof t=="function"?this.geometryFunction_=t:typeof t=="string"?this.geometryFunction_=function(e){return e.get(t)}:t?t!==void 0&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Zs,this.geometry_=t}setZIndex(t){this.zIndex_=t}}function Ml(r){let t;if(typeof r=="function")t=r;else{let e;Array.isArray(r)?e=r:(xt(typeof r.getZIndex=="function",41),e=[r]),t=function(){return e}}return t}let br=null;function Ll(r,t){if(!br){const e=new Qi({color:"rgba(255,255,255,0.4)"}),i=new An({color:"#3399CC",width:1.25});br=[new gi({image:new In({fill:e,stroke:i,radius:5}),fill:e,stroke:i})]}return br}function Zs(r){return r.getGeometry()}const Nl="#333";class ps{constructor(t){t=t||{},this.font_=t.font,this.rotation_=t.rotation,this.rotateWithView_=t.rotateWithView,this.scale_=t.scale,this.scaleArray_=ve(t.scale!==void 0?t.scale:1),this.text_=t.text,this.textAlign_=t.textAlign,this.justify_=t.justify,this.textBaseline_=t.textBaseline,this.fill_=t.fill!==void 0?t.fill:new Qi({color:Nl}),this.maxAngle_=t.maxAngle!==void 0?t.maxAngle:Math.PI/4,this.placement_=t.placement!==void 0?t.placement:"point",this.overflow_=!!t.overflow,this.stroke_=t.stroke!==void 0?t.stroke:null,this.offsetX_=t.offsetX!==void 0?t.offsetX:0,this.offsetY_=t.offsetY!==void 0?t.offsetY:0,this.backgroundFill_=t.backgroundFill?t.backgroundFill:null,this.backgroundStroke_=t.backgroundStroke?t.backgroundStroke:null,this.padding_=t.padding===void 0?null:t.padding}clone(){const t=this.getScale();return new ps({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(t){this.overflow_=t}setFont(t){this.font_=t}setMaxAngle(t){this.maxAngle_=t}setOffsetX(t){this.offsetX_=t}setOffsetY(t){this.offsetY_=t}setPlacement(t){this.placement_=t}setRotateWithView(t){this.rotateWithView_=t}setFill(t){this.fill_=t}setRotation(t){this.rotation_=t}setScale(t){this.scale_=t,this.scaleArray_=ve(t!==void 0?t:1)}setStroke(t){this.stroke_=t}setText(t){this.text_=t}setTextAlign(t){this.textAlign_=t}setJustify(t){this.justify_=t}setTextBaseline(t){this.textBaseline_=t}setBackgroundFill(t){this.backgroundFill_=t}setBackgroundStroke(t){this.backgroundStroke_=t}setPadding(t){this.padding_=t}}new Array(6);function Ge(){return[1,0,0,1,0,0]}function Pl(r,t,e,i,n,s,o){return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r[4]=s,r[5]=o,r}function Dl(r,t){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function oe(r,t){const e=t[0],i=t[1];return t[0]=r[0]*e+r[2]*i+r[4],t[1]=r[1]*e+r[3]*i+r[5],t}function kl(r,t,e){return Pl(r,t,0,0,e,0,0)}function pi(r,t,e,i,n,s,o,a){const l=Math.sin(s),h=Math.cos(s);return r[0]=i*h,r[1]=n*l,r[2]=-i*l,r[3]=n*h,r[4]=o*i*h-a*i*l+t,r[5]=o*n*l+a*n*h+e,r}function ms(r,t){const e=Fl(t);xt(e!==0,32);const i=t[0],n=t[1],s=t[2],o=t[3],a=t[4],l=t[5];return r[0]=o/e,r[1]=-n/e,r[2]=-s/e,r[3]=i/e,r[4]=(s*l-o*a)/e,r[5]=-(i*l-n*a)/e,r}function Fl(r){return r[0]*r[3]-r[1]*r[2]}let Js;function Qo(r){const t="matrix("+r.join(", ")+")";if(us)return t;const e=Js||(Js=document.createElement("div"));return e.style.transform=t,e.style.transform}const En={radians:6370997/(2*Math.PI),degrees:2*Math.PI*6370997/360,ft:.3048,m:1,"us-ft":1200/3937};class ta{constructor(t){this.code_=t.code,this.units_=t.units,this.extent_=t.extent!==void 0?t.extent:null,this.worldExtent_=t.worldExtent!==void 0?t.worldExtent:null,this.axisOrientation_=t.axisOrientation!==void 0?t.axisOrientation:"enu",this.global_=t.global!==void 0?t.global:!1,this.canWrapX_=!!(this.global_&&this.extent_),this.getPointResolutionFunc_=t.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=t.metersPerUnit}canWrapX(){return this.canWrapX_}getCode(){return this.code_}getExtent(){return this.extent_}getUnits(){return this.units_}getMetersPerUnit(){return this.metersPerUnit_||En[this.units_]}getWorldExtent(){return this.worldExtent_}getAxisOrientation(){return this.axisOrientation_}isGlobal(){return this.global_}setGlobal(t){this.global_=t,this.canWrapX_=!!(t&&this.extent_)}getDefaultTileGrid(){return this.defaultTileGrid_}setDefaultTileGrid(t){this.defaultTileGrid_=t}setExtent(t){this.extent_=t,this.canWrapX_=!!(this.global_&&t)}setWorldExtent(t){this.worldExtent_=t}setGetPointResolution(t){this.getPointResolutionFunc_=t}getPointResolutionFunc(){return this.getPointResolutionFunc_}}const On=6378137,zi=Math.PI*On,Gl=[-zi,-zi,zi,zi],Ul=[-180,-85,180,85],qn=On*Math.log(Math.tan(Math.PI/2));class Di extends ta{constructor(t){super({code:t,units:"m",extent:Gl,global:!0,worldExtent:Ul,getPointResolution:function(e,i){return e/Math.cosh(i[1]/On)}})}}const Qs=[new Di("EPSG:3857"),new Di("EPSG:102100"),new Di("EPSG:102113"),new Di("EPSG:900913"),new Di("http://www.opengis.net/def/crs/EPSG/0/3857"),new Di("http://www.opengis.net/gml/srs/epsg.xml#3857")];function ql(r,t,e){const i=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(i));for(let n=0;n<i;n+=e){t[n]=zi*r[n]/180;let s=On*Math.log(Math.tan(Math.PI*(+r[n+1]+90)/360));s>qn?s=qn:s<-qn&&(s=-qn),t[n+1]=s}return t}function Xl(r,t,e){const i=r.length;e=e>1?e:2,t===void 0&&(e>2?t=r.slice():t=new Array(i));for(let n=0;n<i;n+=e)t[n]=180*r[n]/zi,t[n+1]=360*Math.atan(Math.exp(r[n+1]/On))/Math.PI-90;return t}const jl=6378137,to=[-180,-90,180,90],Yl=Math.PI*jl/180;class _i extends ta{constructor(t,e){super({code:t,units:"degrees",extent:to,axisOrientation:e,global:!0,metersPerUnit:Yl,worldExtent:to})}}const eo=[new _i("CRS:84"),new _i("EPSG:4326","neu"),new _i("urn:ogc:def:crs:OGC:1.3:CRS84"),new _i("urn:ogc:def:crs:OGC:2:84"),new _i("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new _i("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new _i("http://www.opengis.net/def/crs/EPSG/0/4326","neu")];let Hr={};function zl(r){return Hr[r]||Hr[r.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null}function Vl(r,t){Hr[r]=t}let Wi={};function ir(r,t,e){const i=r.getCode(),n=t.getCode();i in Wi||(Wi[i]={}),Wi[i][n]=e}function Wl(r,t){let e;return r in Wi&&t in Wi[r]&&(e=Wi[r][t]),e}function Bl(r,t){return r[0]+=+t[0],r[1]+=+t[1],r}function nr(r,t){let e=!0;for(let i=r.length-1;i>=0;--i)if(r[i]!=t[i]){e=!1;break}return e}function _s(r,t){const e=Math.cos(t),i=Math.sin(t),n=r[0]*e-r[1]*i,s=r[1]*e+r[0]*i;return r[0]=n,r[1]=s,r}function Hl(r,t){return r[0]*=t,r[1]*=t,r}function ea(r,t){if(t.canWrapX()){const e=Ut(t.getExtent()),i=$l(r,t,e);i&&(r[0]-=i*e)}return r}function $l(r,t,e){const i=t.getExtent();let n=0;return t.canWrapX()&&(r[0]<i[0]||r[0]>i[2])&&(e=e||Ut(i),n=Math.floor((r[0]-i[0])/e)),n}const Kl=63710088e-1;function io(r,t,e){e=e||Kl;const i=$n(r[1]),n=$n(t[1]),s=(n-i)/2,o=$n(t[0]-r[0])/2,a=Math.sin(s)*Math.sin(s)+Math.sin(o)*Math.sin(o)*Math.cos(i)*Math.cos(n);return 2*e*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))}let $r=!0;function Zl(r){$r=!1}function ys(r,t,e){if(t!==void 0){for(let i=0,n=r.length;i<n;++i)t[i]=r[i];t=t}else t=r.slice();return t}function ia(r,t,e){if(t!==void 0&&r!==t){for(let i=0,n=r.length;i<n;++i)t[i]=r[i];r=t}return r}function Jl(r){Vl(r.getCode(),r),ir(r,r,ys)}function Ql(r){r.forEach(Jl)}function Bt(r){return typeof r=="string"?zl(r):r||null}function no(r,t,e,i){r=Bt(r);let n;const s=r.getPointResolutionFunc();if(s)n=s(t,e);else{const o=r.getUnits();if(o=="degrees"&&!i||i=="degrees")n=t;else{const a=Er(r,Bt("EPSG:4326"));if(a===ia&&o!=="degrees")n=t*r.getMetersPerUnit();else{let h=[e[0]-t/2,e[1],e[0]+t/2,e[1],e[0],e[1]-t/2,e[0],e[1]+t/2];h=a(h,h,2);const u=io(h.slice(0,2),h.slice(2,4)),g=io(h.slice(4,6),h.slice(6,8));n=(u+g)/2}const l=r.getMetersPerUnit();l!==void 0&&(n/=l)}}return n}function ro(r){Ql(r),r.forEach(function(t){r.forEach(function(e){t!==e&&ir(t,e,ys)})})}function tc(r,t,e,i){r.forEach(function(n){t.forEach(function(s){ir(n,s,e),ir(s,n,i)})})}function Es(r,t){return r?typeof r=="string"?Bt(r):r:Bt(t)}function wi(r,t){if(r===t)return!0;const e=r.getUnits()===t.getUnits();return(r.getCode()===t.getCode()||Er(r,t)===ys)&&e}function Er(r,t){const e=r.getCode(),i=t.getCode();let n=Wl(e,i);return n||(n=ia),n}function wn(r,t){const e=Bt(r),i=Bt(t);return Er(e,i)}function ws(r,t,e){return wn(t,e)(r,void 0,r.length)}function na(r,t,e,i){const n=wn(t,e);return Ja(r,n,void 0)}let Se=null;function ec(r){Se=Bt(r)}function ra(){return Se}function ic(){ec("EPSG:4326")}function Kr(r,t){return Se?ws(r,t,Se):r}function Ke(r,t){return Se?ws(r,Se,t):($r&&!nr(r,[0,0])&&r[0]>=-180&&r[0]<=180&&r[1]>=-90&&r[1]<=90&&($r=!1,console.warn("Call useGeographic() from ol/proj once to work with [longitude, latitude] coordinates.")),r)}function Zr(r,t){return Se?na(r,t,Se):r}function xi(r,t){return Se?na(r,Se,t):r}function nc(r,t){if(!Se)return r;const e=Bt(t).getUnits(),i=Se.getUnits();return e&&i?r*En[e]/En[i]:r}function rc(){ro(Qs),ro(eo),tc(eo,Qs,ql,Xl)}rc();function Ci(r,t,e,i,n,s){s=s||[];let o=0;for(let a=t;a<e;a+=i){const l=r[a],h=r[a+1];s[o++]=n[0]*l+n[2]*h+n[4],s[o++]=n[1]*l+n[3]*h+n[5]}return s&&s.length!=o&&(s.length=o),s}function sa(r,t,e,i,n,s,o){o=o||[];const a=Math.cos(n),l=Math.sin(n),h=s[0],u=s[1];let g=0;for(let m=t;m<e;m+=i){const y=r[m]-h,w=r[m+1]-u;o[g++]=h+y*a-w*l,o[g++]=u+y*l+w*a;for(let E=m+2;E<m+i;++E)o[g++]=r[E]}return o&&o.length!=g&&(o.length=g),o}function sc(r,t,e,i,n,s,o,a){a=a||[];const l=o[0],h=o[1];let u=0;for(let g=t;g<e;g+=i){const m=r[g]-l,y=r[g+1]-h;a[u++]=l+n*m,a[u++]=h+s*y;for(let w=g+2;w<g+i;++w)a[u++]=r[w]}return a&&a.length!=u&&(a.length=u),a}function oc(r,t,e,i,n,s,o){o=o||[];let a=0;for(let l=t;l<e;l+=i){o[a++]=r[l]+n,o[a++]=r[l+1]+s;for(let h=l+2;h<l+i;++h)o[a++]=r[h]}return o&&o.length!=a&&(o.length=a),o}const so=Ge();class oa extends Xe{constructor(){super(),this.extent_=Ce(),this.extentRevision_=-1,this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=0,this.simplifyTransformedInternal=wl(function(t,e,i){if(!i)return this.getSimplifiedGeometry(e);const n=this.clone();return n.applyTransform(i),n.getSimplifiedGeometry(e)})}simplifyTransformed(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}clone(){return gt()}closestPointXY(t,e,i,n){return gt()}containsXY(t,e){const i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e}getClosestPoint(t,e){return e=e||[NaN,NaN],this.closestPointXY(t[0],t[1],e,1/0),e}intersectsCoordinate(t){return this.containsXY(t[0],t[1])}computeExtent(t){return gt()}getExtent(t){if(this.extentRevision_!=this.getRevision()){const e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&bn(e),this.extentRevision_=this.getRevision()}return Ka(this.extent_,t)}rotate(t,e){gt()}scale(t,e,i){gt()}simplify(t){return this.getSimplifiedGeometry(t*t)}getSimplifiedGeometry(t){return gt()}getType(){return gt()}applyTransform(t){gt()}intersectsExtent(t){return gt()}translate(t,e){gt()}transform(t,e){const i=Bt(t),n=i.getUnits()=="tile-pixels"?function(s,o,a){const l=i.getExtent(),h=i.getWorldExtent(),u=qe(h)/qe(l);return pi(so,h[0],h[3],u,-u,0,0,0),Ci(s,0,s.length,a,so,o),wn(i,e)(s,o,a)}:wn(i,e);return this.applyTransform(n),this}}class Ni extends oa{constructor(){super(),this.layout="XY",this.stride=2,this.flatCoordinates=null}computeExtent(t){return Fo(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinates(){return gt()}getFirstCoordinate(){return this.flatCoordinates.slice(0,this.stride)}getFlatCoordinates(){return this.flatCoordinates}getLastCoordinate(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}getLayout(){return this.layout}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getSimplifiedGeometryInternal(t){return this}getStride(){return this.stride}setFlatCoordinates(t,e){this.stride=oo(t),this.layout=t,this.flatCoordinates=e}setCoordinates(t,e){gt()}setLayout(t,e,i){let n;if(t)n=oo(t);else{for(let s=0;s<i;++s)if(e.length===0){this.layout="XY",this.stride=2;return}else e=e[0];n=e.length,t=ac(n)}this.layout=t,this.stride=n}applyTransform(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}rotate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();sa(i,0,i.length,n,t,e,i),this.changed()}}scale(t,e,i){e===void 0&&(e=t),i||(i=Si(this.getExtent()));const n=this.getFlatCoordinates();if(n){const s=this.getStride();sc(n,0,n.length,s,t,e,i,n),this.changed()}}translate(t,e){const i=this.getFlatCoordinates();if(i){const n=this.getStride();oc(i,0,i.length,n,t,e,i),this.changed()}}}function ac(r){let t;return r==2?t="XY":r==3?t="XYZ":r==4&&(t="XYZM"),t}function oo(r){let t;return r=="XY"?t=2:r=="XYZ"||r=="XYM"?t=3:r=="XYZM"&&(t=4),t}function lc(r,t,e){const i=r.getFlatCoordinates();if(i){const n=r.getStride();return Ci(i,0,i.length,n,t,e)}else return null}function cc(r,t,e,i){for(let n=0,s=e.length;n<s;++n)r[t++]=e[n];return t}function wr(r,t,e,i){for(let n=0,s=e.length;n<s;++n){const o=e[n];for(let a=0;a<i;++a)r[t++]=o[a]}return t}function vs(r,t,e,i,n){n=n||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=wr(r,t,e[o],i);n[s++]=l,t=l}return n.length=s,n}function hc(r,t,e,i,n){n=n||[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=vs(r,t,e[o],i,n[s]);l.length===0&&(l[0]=t),n[s++]=l,t=l[l.length-1]}return n.length=s,n}class rr extends oa{constructor(t){super(),this.geometries_=t||null,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(qt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){if(this.geometries_)for(let t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(St(this.geometries_[t],yt.CHANGE,this.changed,this))}clone(){const t=new rr(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<Oi(this.getExtent(),t,e))return n;const s=this.geometries_;for(let o=0,a=s.length;o<a;++o)n=s[o].closestPointXY(t,e,i,n);return n}containsXY(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)if(i[n].containsXY(t,e))return!0;return!1}computeExtent(t){bn(t);const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)Go(t,e[i].getExtent());return t}getGeometries(){return ao(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[];const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].getType()===this.getType()?t=t.concat(e[i].getGeometriesArrayRecursive()):t.push(e[i]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;const e=[],i=this.geometries_;let n=!1;for(let s=0,o=i.length;s<o;++s){const a=i[s],l=a.getSimplifiedGeometry(t);e.push(l),l!==a&&(n=!0)}if(n){const s=new rr(null);return s.setGeometriesArray(e),s}else return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}getType(){return"GeometryCollection"}intersectsExtent(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)if(e[i].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].rotate(t,e);this.changed()}scale(t,e,i){i||(i=Si(this.getExtent()));const n=this.geometries_;for(let s=0,o=n.length;s<o;++s)n[s].scale(t,e,i);this.changed()}setGeometries(t){this.setGeometriesArray(ao(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){const e=this.geometries_;for(let i=0,n=e.length;i<n;++i)e[i].applyTransform(t);this.changed()}translate(t,e){const i=this.geometries_;for(let n=0,s=i.length;n<s;++n)i[n].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}}function ao(r){const t=[];for(let e=0,i=r.length;e<i;++e)t.push(r[e].clone());return t}function lo(r,t,e,i,n,s,o){const a=r[t],l=r[t+1],h=r[e]-a,u=r[e+1]-l;let g;if(h===0&&u===0)g=t;else{const m=((n-a)*h+(s-l)*u)/(h*h+u*u);if(m>1)g=e;else if(m>0){for(let y=0;y<i;++y)o[y]=Ze(r[t+y],r[e+y],m);o.length=i;return}else g=t}for(let m=0;m<i;++m)o[m]=r[g+m];o.length=i}function xs(r,t,e,i,n){let s=r[t],o=r[t+1];for(t+=i;t<e;t+=i){const a=r[t],l=r[t+1],h=bi(s,o,a,l);h>n&&(n=h),s=a,o=l}return n}function Ts(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s){const a=e[s];n=xs(r,t,a,i,n),t=a}return n}function uc(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s){const a=e[s];n=Ts(r,t,a,i,n),t=a[a.length-1]}return n}function Rs(r,t,e,i,n,s,o,a,l,h,u){if(t==e)return h;let g,m;if(n===0)if(m=bi(o,a,r[t],r[t+1]),m<h){for(g=0;g<i;++g)l[g]=r[t+g];return l.length=i,m}else return h;u=u||[NaN,NaN];let y=t+i;for(;y<e;)if(lo(r,y-i,y,i,o,a,u),m=bi(o,a,u[0],u[1]),m<h){for(h=m,g=0;g<i;++g)l[g]=u[g];l.length=i,y+=i}else y+=i*Math.max((Math.sqrt(m)-Math.sqrt(h))/n|0,1);if(s&&(lo(r,e-i,t,i,o,a,u),m=bi(o,a,u[0],u[1]),m<h)){for(h=m,g=0;g<i;++g)l[g]=u[g];l.length=i}return h}function bs(r,t,e,i,n,s,o,a,l,h,u){u=u||[NaN,NaN];for(let g=0,m=e.length;g<m;++g){const y=e[g];h=Rs(r,t,y,i,n,s,o,a,l,h,u),t=y}return h}function dc(r,t,e,i,n,s,o,a,l,h,u){u=u||[NaN,NaN];for(let g=0,m=e.length;g<m;++g){const y=e[g];h=bs(r,t,y,i,n,s,o,a,l,h,u),t=y[y.length-1]}return h}function Cs(r,t,e,i,n,s,o){const a=(e-t)/i;if(a<3){for(;t<e;t+=i)s[o++]=r[t],s[o++]=r[t+1];return o}const l=new Array(a);l[0]=1,l[a-1]=1;const h=[t,e-i];let u=0;for(;h.length>0;){const g=h.pop(),m=h.pop();let y=0;const w=r[m],E=r[m+1],v=r[g],x=r[g+1];for(let S=m+i;S<g;S+=i){const R=r[S],O=r[S+1],k=nl(R,O,w,E,v,x);k>y&&(u=S,y=k)}y>n&&(l[(u-t)/i]=1,m+i<u&&h.push(m,u),u+i<g&&h.push(u,g))}for(let g=0;g<a;++g)l[g]&&(s[o++]=r[t+g*i],s[o++]=r[t+g*i+1]);return o}function fc(r,t,e,i,n,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l];o=Cs(r,t,u,i,n,s,o),a.push(o),t=u}return o}function Ei(r,t){return t*Math.round(r/t)}function gc(r,t,e,i,n,s,o){if(t==e)return o;let a=Ei(r[t],n),l=Ei(r[t+1],n);t+=i,s[o++]=a,s[o++]=l;let h,u;do if(h=Ei(r[t],n),u=Ei(r[t+1],n),t+=i,t==e)return s[o++]=h,s[o++]=u,o;while(h==a&&u==l);for(;t<e;){const g=Ei(r[t],n),m=Ei(r[t+1],n);if(t+=i,g==h&&m==u)continue;const y=h-a,w=u-l,E=g-a,v=m-l;if(y*v==w*E&&(y<0&&E<y||y==E||y>0&&E>y)&&(w<0&&v<w||w==v||w>0&&v>w)){h=g,u=m;continue}s[o++]=h,s[o++]=u,a=h,l=u,h=g,u=m}return s[o++]=h,s[o++]=u,o}function aa(r,t,e,i,n,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l];o=gc(r,t,u,i,n,s,o),a.push(o),t=u}return o}function pc(r,t,e,i,n,s,o,a){for(let l=0,h=e.length;l<h;++l){const u=e[l],g=[];o=aa(r,t,u,i,n,s,o,g),a.push(g),t=u[u.length-1]}return o}function hi(r,t,e,i,n){n=n!==void 0?n:[];let s=0;for(let o=t;o<e;o+=i)n[s++]=r.slice(o,o+i);return n.length=s,n}function vn(r,t,e,i,n){n=n!==void 0?n:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];n[s++]=hi(r,t,l,i,n[s]),t=l}return n.length=s,n}function Jr(r,t,e,i,n){n=n!==void 0?n:[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o];n[s++]=l.length===1&&l[0]===t?[]:vn(r,t,l,i,n[s]),t=l[l.length-1]}return n.length=s,n}function la(r,t,e,i){let n=0,s=r[e-i],o=r[e-i+1];for(;t<e;t+=i){const a=r[t],l=r[t+1];n+=o*a-s*l,s=a,o=l}return n/2}function ca(r,t,e,i){let n=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];n+=la(r,t,a,i),t=a}return n}function mc(r,t,e,i){let n=0;for(let s=0,o=e.length;s<o;++s){const a=e[s];n+=ca(r,t,a,i),t=a[a.length-1]}return n}class xn extends Ni{constructor(t,e){super(),this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}clone(){return new xn(this.flatCoordinates.slice(),this.layout)}closestPointXY(t,e,i,n){return n<Oi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(xs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Rs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,n))}getArea(){return la(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinates(){return hi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getSimplifiedGeometryInternal(t){const e=[];return e.length=Cs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new xn(e,"XY")}getType(){return"LinearRing"}intersectsExtent(t){return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=wr(this.flatCoordinates,0,t,this.stride),this.changed()}}function ha(r,t,e,i,n){let s;for(t+=i;t<e;t+=i)if(s=n(r.slice(t-i,t),r.slice(t,t+i)),s)return s;return!1}function ua(r,t,e,i,n,s,o){let a,l;const h=(e-t)/i;if(h===1)a=t;else if(h===2)a=t,l=n;else if(h!==0){let u=r[t],g=r[t+1],m=0;const y=[0];for(let v=t+i;v<e;v+=i){const x=r[v],S=r[v+1];m+=Math.sqrt((x-u)*(x-u)+(S-g)*(S-g)),y.push(m),u=x,g=S}const w=n*m,E=_l(y,w);E<0?(l=(w-y[-E-2])/(y[-E-1]-y[-E-2]),a=t+(-E-2)*i):a=t+E*i}o=o>1?o:2,s=s||new Array(o);for(let u=0;u<o;++u)s[u]=a===void 0?NaN:l===void 0?r[a+u]:Ze(r[a+u],r[a+i+u],l);return s}function Qr(r,t,e,i,n,s){if(e==t)return null;let o;if(n<r[t+i-1])return s?(o=r.slice(t,t+i),o[i-1]=n,o):null;if(r[e-1]<n)return s?(o=r.slice(e-i,e),o[i-1]=n,o):null;if(n==r[t+i-1])return r.slice(t,t+i);let a=t/i,l=e/i;for(;a<l;){const m=a+l>>1;n<r[(m+1)*i-1]?l=m:a=m+1}const h=r[a*i-1];if(n==h)return r.slice((a-1)*i,(a-1)*i+i);const u=r[(a+1)*i-1],g=(n-h)/(u-h);o=[];for(let m=0;m<i-1;++m)o.push(Ze(r[(a-1)*i+m],r[a*i+m],g));return o.push(n),o}function _c(r,t,e,i,n,s,o){if(o)return Qr(r,t,e[e.length-1],i,n,s);let a;if(n<r[i-1])return s?(a=r.slice(0,i),a[i-1]=n,a):null;if(r[r.length-1]<n)return s?(a=r.slice(r.length-i),a[i-1]=n,a):null;for(let l=0,h=e.length;l<h;++l){const u=e[l];if(t!=u){if(n<r[t+i-1])return null;if(n<=r[u-1])return Qr(r,t,u,i,n,!1);t=u}}return null}function yc(r,t,e,i,n){return!qo(n,function(o){return!Ti(r,t,e,i,o[0],o[1])})}function Ti(r,t,e,i,n,s){let o=0,a=r[e-i],l=r[e-i+1];for(;t<e;t+=i){const h=r[t],u=r[t+1];l<=s?u>s&&(h-a)*(s-l)-(n-a)*(u-l)>0&&o++:u<=s&&(h-a)*(s-l)-(n-a)*(u-l)<0&&o--,a=h,l=u}return o!==0}function Ss(r,t,e,i,n,s){if(e.length===0||!Ti(r,t,e[0],i,n,s))return!1;for(let o=1,a=e.length;o<a;++o)if(Ti(r,e[o-1],e[o],i,n,s))return!1;return!0}function Ec(r,t,e,i,n,s){if(e.length===0)return!1;for(let o=0,a=e.length;o<a;++o){const l=e[o];if(Ss(r,t,l,i,n,s))return!0;t=l[l.length-1]}return!1}function vr(r,t,e,i,n){const s=Uo(Ce(),r,t,e,i);return me(n,s)?Yi(n,s)||s[0]>=n[0]&&s[2]<=n[2]||s[1]>=n[1]&&s[3]<=n[3]?!0:ha(r,t,e,i,function(o,a){return Za(n,o,a)}):!1}function wc(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s){if(vr(r,t,e[s],i,n))return!0;t=e[s]}return!1}function da(r,t,e,i,n){return!!(vr(r,t,e,i,n)||Ti(r,t,e,i,n[0],n[1])||Ti(r,t,e,i,n[0],n[3])||Ti(r,t,e,i,n[2],n[1])||Ti(r,t,e,i,n[2],n[3]))}function fa(r,t,e,i,n){if(!da(r,t,e[0],i,n))return!1;if(e.length===1)return!0;for(let s=1,o=e.length;s<o;++s)if(yc(r,e[s-1],e[s],i,n)&&!vr(r,e[s-1],e[s],i,n))return!1;return!0}function vc(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(fa(r,t,a,i,n))return!0;t=a[a.length-1]}return!1}function ga(r,t,e,i){let n=r[t],s=r[t+1],o=0;for(let a=t+i;a<e;a+=i){const l=r[a],h=r[a+1];o+=Math.sqrt((l-n)*(l-n)+(h-s)*(h-s)),n=l,s=h}return o}class Ji extends Ni{constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){this.flatCoordinates?Je(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}clone(){const t=new Ji(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<Oi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(xs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Rs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,n))}forEachSegment(t){return ha(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,Qr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return hi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return ua(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return ga(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){const e=[];return e.length=Cs(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new Ji(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return vr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=wr(this.flatCoordinates,0,t,this.stride),this.changed()}}class sr extends Ni{constructor(t,e,i){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&i)this.setFlatCoordinates(e,t),this.ends_=i;else{let n=this.getLayout();const s=t,o=[],a=[];for(let l=0,h=s.length;l<h;++l){const u=s[l];l===0&&(n=u.getLayout()),Je(o,u.getFlatCoordinates()),a.push(o.length)}this.setFlatCoordinates(n,o),this.ends_=a}}appendLineString(t){this.flatCoordinates?Je(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new sr(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<Oi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ts(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),bs(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,n))}getCoordinateAtM(t,e,i){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,i=i!==void 0?i:!1,_c(this.flatCoordinates,0,this.ends_,this.stride,t,e,i))}getCoordinates(){return vn(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new Ji(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){const t=this.flatCoordinates,e=this.ends_,i=this.layout,n=[];let s=0;for(let o=0,a=e.length;o<a;++o){const l=e[o],h=new Ji(t.slice(s,l),i);n.push(h),s=l}return n}getFlatMidpoints(){const t=[],e=this.flatCoordinates;let i=0;const n=this.ends_,s=this.stride;for(let o=0,a=n.length;o<a;++o){const l=n[o],h=ua(e,i,l,s,.5);Je(t,h),i=l}return t}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=fc(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i),new sr(e,"XY",i)}getType(){return"MultiLineString"}intersectsExtent(t){return wc(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=vs(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}class Ai extends Ni{constructor(t,e){super(),this.setCoordinates(t,e)}clone(){const t=new Ai(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){const s=this.flatCoordinates,o=bi(t,e,s[0],s[1]);if(o<n){const a=this.stride;for(let l=0;l<a;++l)i[l]=s[l];return i.length=a,o}else return n}getCoordinates(){return this.flatCoordinates?this.flatCoordinates.slice():[]}computeExtent(t){return Ba(this.flatCoordinates,t)}getType(){return"Point"}intersectsExtent(t){return ls(t,this.flatCoordinates[0],this.flatCoordinates[1])}setCoordinates(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=cc(this.flatCoordinates,0,t,this.stride),this.changed()}}class xr extends Ni{constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){this.flatCoordinates?Je(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}clone(){const t=new xr(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,i,n){if(n<Oi(this.getExtent(),t,e))return n;const s=this.flatCoordinates,o=this.stride;for(let a=0,l=s.length;a<l;a+=o){const h=bi(t,e,s[a],s[a+1]);if(h<n){n=h;for(let u=0;u<o;++u)i[u]=s[a+u];i.length=o}}return n}getCoordinates(){return hi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){const e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new Ai(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){const t=this.flatCoordinates,e=this.layout,i=this.stride,n=[];for(let s=0,o=t.length;s<o;s+=i){const a=new Ai(t.slice(s,s+i),e);n.push(a)}return n}getType(){return"MultiPoint"}intersectsExtent(t){const e=this.flatCoordinates,i=this.stride;for(let n=0,s=e.length;n<s;n+=i){const o=e[n],a=e[n+1];if(ls(t,o,a))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=wr(this.flatCoordinates,0,t,this.stride),this.changed()}}function pa(r,t,e,i,n,s,o){let a,l,h,u,g,m,y;const w=n[s+1],E=[];for(let S=0,R=e.length;S<R;++S){const O=e[S];for(u=r[O-i],m=r[O-i+1],a=t;a<O;a+=i)g=r[a],y=r[a+1],(w<=m&&y<=w||m<=w&&w<=y)&&(h=(w-m)/(y-m)*(g-u)+u,E.push(h)),u=g,m=y}let v=NaN,x=-1/0;for(E.sort($i),u=E[0],a=1,l=E.length;a<l;++a){g=E[a];const S=Math.abs(g-u);S>x&&(h=(u+g)/2,Ss(r,t,e,i,h,w)&&(v=h,x=S)),u=g}return isNaN(v)&&(v=n[s]),o?(o.push(v,w,x),o):[v,w,x]}function xc(r,t,e,i,n){let s=[];for(let o=0,a=e.length;o<a;++o){const l=e[o];s=pa(r,t,l,i,n,2*o,s),t=l[l.length-1]}return s}function Tc(r,t,e,i){for(;t<e-i;){for(let n=0;n<i;++n){const s=r[t+n];r[t+n]=r[e-i+n],r[e-i+n]=s}t+=i,e-=i}}function ma(r,t,e,i){let n=0,s=r[e-i],o=r[e-i+1];for(;t<e;t+=i){const a=r[t],l=r[t+1];n+=(a-s)*(l+o),s=a,o=l}return n===0?void 0:n>0}function _a(r,t,e,i,n){n=n!==void 0?n:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=ma(r,t,a,i);if(s===0){if(n&&l||!n&&!l)return!1}else if(n&&!l||!n&&l)return!1;t=a}return!0}function Rc(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s){const a=e[s];if(!_a(r,t,a,i,n))return!1;a.length&&(t=a[a.length-1])}return!0}function ts(r,t,e,i,n){n=n!==void 0?n:!1;for(let s=0,o=e.length;s<o;++s){const a=e[s],l=ma(r,t,a,i);(s===0?n&&l||!n&&!l:n&&!l||!n&&l)&&Tc(r,t,a,i),t=a}return t}function co(r,t,e,i,n){for(let s=0,o=e.length;s<o;++s)t=ts(r,t,e[s],i,n);return t}class mi extends Ni{constructor(t,e,i){super(),this.ends_=[],this.flatInteriorPointRevision_=-1,this.flatInteriorPoint_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,e!==void 0&&i?(this.setFlatCoordinates(e,t),this.ends_=i):this.setCoordinates(t,e)}appendLinearRing(t){this.flatCoordinates?Je(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){const t=new mi(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,i,n){return n<Oi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ts(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),bs(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return Ss(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}getArea(){return ca(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),ts(e,0,this.ends_,this.stride,t)):e=this.flatCoordinates,vn(e,0,this.ends_,this.stride)}getEnds(){return this.ends_}getFlatInteriorPoint(){if(this.flatInteriorPointRevision_!=this.getRevision()){const t=Si(this.getExtent());this.flatInteriorPoint_=pa(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}getInteriorPoint(){return new Ai(this.getFlatInteriorPoint(),"XYM")}getLinearRingCount(){return this.ends_.length}getLinearRing(t){return t<0||this.ends_.length<=t?null:new xn(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLinearRings(){const t=this.layout,e=this.flatCoordinates,i=this.ends_,n=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o],h=new xn(e.slice(s,l),t);n.push(h),s=l}return n}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;_a(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=ts(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=aa(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i),new mi(e,"XY",i)}getType(){return"Polygon"}intersectsExtent(t){return fa(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);const i=vs(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=i.length===0?0:i[i.length-1],this.changed()}}function ho(r){const t=r[0],e=r[1],i=r[2],n=r[3],s=[t,e,t,n,i,n,i,e,t,e];return new mi(s,"XY",[s.length])}function bc(r,t,e,i){const n=[];let s=Ce();for(let o=0,a=e.length;o<a;++o){const l=e[o];s=Fo(r,t,l[0],i),n.push((s[0]+s[2])/2,(s[1]+s[3])/2),t=l[l.length-1]}return n}class or extends Ni{constructor(t,e,i){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!i&&!Array.isArray(t[0])){let n=this.getLayout();const s=t,o=[],a=[];for(let l=0,h=s.length;l<h;++l){const u=s[l];l===0&&(n=u.getLayout());const g=o.length,m=u.getEnds();for(let y=0,w=m.length;y<w;++y)m[y]+=g;Je(o,u.getFlatCoordinates()),a.push(m)}e=n,t=o,i=a}e!==void 0&&i?(this.setFlatCoordinates(e,t),this.endss_=i):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{const i=this.flatCoordinates.length;Je(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let n=0,s=e.length;n<s;++n)e[n]+=i}this.endss_.push(e),this.changed()}clone(){const t=this.endss_.length,e=new Array(t);for(let n=0;n<t;++n)e[n]=this.endss_[n].slice();const i=new or(this.flatCoordinates.slice(),this.layout,e);return i.applyProperties(this),i}closestPointXY(t,e,i,n){return n<Oi(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(uc(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),dc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,n))}containsXY(t,e){return Ec(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return mc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),co(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Jr(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){const t=bc(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=xc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new xr(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){const t=this.flatCoordinates;Rc(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=co(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){const e=[],i=[];return e.length=pc(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i),new or(e,"XY",i)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{const s=this.endss_[t-1];e=s[s.length-1]}const i=this.endss_[t].slice(),n=i[i.length-1];if(e!==0)for(let s=0,o=i.length;s<o;++s)i[s]-=e;return new mi(this.flatCoordinates.slice(e,n),this.layout,i)}getPolygons(){const t=this.layout,e=this.flatCoordinates,i=this.endss_,n=[];let s=0;for(let o=0,a=i.length;o<a;++o){const l=i[o].slice(),h=l[l.length-1];if(s!==0)for(let g=0,m=l.length;g<m;++g)l[g]-=s;const u=new mi(e.slice(s,h),t,l);n.push(u),s=h}return n}getType(){return"MultiPolygon"}intersectsExtent(t){return vc(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);const i=hc(this.flatCoordinates,0,t,this.stride,this.endss_);if(i.length===0)this.flatCoordinates.length=0;else{const n=i[i.length-1];this.flatCoordinates.length=n.length===0?0:n[n.length-1]}this.changed()}}const _e={ADD:"add",REMOVE:"remove"},uo={LENGTH:"length"};class Xn extends ti{constructor(t,e,i){super(t),this.element=e,this.index=i}}class Fe extends Xe{constructor(t,e){if(super(),this.on,this.once,this.un,e=e||{},this.unique_=!!e.unique,this.array_=t||[],this.unique_)for(let i=0,n=this.array_.length;i<n;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(t){for(let e=0,i=t.length;e<i;++e)this.push(t[e]);return this}forEach(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)t(e[i],i,e)}getArray(){return this.array_}item(t){return this.array_[t]}getLength(){return this.get(uo.LENGTH)}insertAt(t,e){if(t<0||t>this.getLength())throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e),this.array_.splice(t,0,e),this.updateLength_(),this.dispatchEvent(new Xn(_e.ADD,e,t))}pop(){return this.removeAt(this.getLength()-1)}push(t){this.unique_&&this.assertUnique_(t);const e=this.getLength();return this.insertAt(e,t),this.getLength()}remove(t){const e=this.array_;for(let i=0,n=e.length;i<n;++i)if(e[i]===t)return this.removeAt(i)}removeAt(t){if(t<0||t>=this.getLength())return;const e=this.array_[t];return this.array_.splice(t,1),this.updateLength_(),this.dispatchEvent(new Xn(_e.REMOVE,e,t)),e}setAt(t,e){const i=this.getLength();if(t>=i){this.insertAt(t,e);return}if(t<0)throw new Error("Index out of bounds: "+t);this.unique_&&this.assertUnique_(e,t);const n=this.array_[t];this.array_[t]=e,this.dispatchEvent(new Xn(_e.REMOVE,n,t)),this.dispatchEvent(new Xn(_e.ADD,e,t))}updateLength_(){this.set(uo.LENGTH,this.array_.length)}assertUnique_(t,e){for(let i=0,n=this.array_.length;i<n;++i)if(this.array_[i]===t&&i!==e)throw new Do(58)}}const di={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"};class Mn extends Xe{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){const e=t;this.setGeometry(e)}else{const e=t;this.setProperties(e)}}clone(){const t=new Mn(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());const e=this.getGeometry();e&&t.setGeometry(e.clone());const i=this.getStyle();return i&&t.setStyle(i),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(qt(this.geometryChangeKey_),this.geometryChangeKey_=null);const t=this.getGeometry();t&&(this.geometryChangeKey_=St(t,yt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Cc(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}function Cc(r){if(typeof r=="function")return r;{let t;return Array.isArray(r)?t=r:(xt(typeof r.getZIndex=="function",41),t=[r]),function(){return t}}}const Pt={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",MAX_ZOOM:"maxZoom",MIN_ZOOM:"minZoom",SOURCE:"source",MAP:"map"};class ya extends Xe{constructor(t){super(),this.on,this.once,this.un,this.background_=t.background;const e=Object.assign({},t);typeof t.properties=="object"&&(delete e.properties,Object.assign(e,t.properties)),e[Pt.OPACITY]=t.opacity!==void 0?t.opacity:1,xt(typeof e[Pt.OPACITY]=="number",64),e[Pt.VISIBLE]=t.visible!==void 0?t.visible:!0,e[Pt.Z_INDEX]=t.zIndex,e[Pt.MAX_RESOLUTION]=t.maxResolution!==void 0?t.maxResolution:1/0,e[Pt.MIN_RESOLUTION]=t.minResolution!==void 0?t.minResolution:0,e[Pt.MIN_ZOOM]=t.minZoom!==void 0?t.minZoom:-1/0,e[Pt.MAX_ZOOM]=t.maxZoom!==void 0?t.maxZoom:1/0,this.className_=e.className!==void 0?e.className:"ol-layer",delete e.className,this.setProperties(e),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(t){const e=this.state_||{layer:this,managed:t===void 0?!0:t},i=this.getZIndex();return e.opacity=Zt(Math.round(this.getOpacity()*100)/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=i===void 0&&!e.managed?1/0:i,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}getLayersArray(t){return gt()}getLayerStatesArray(t){return gt()}getExtent(){return this.get(Pt.EXTENT)}getMaxResolution(){return this.get(Pt.MAX_RESOLUTION)}getMinResolution(){return this.get(Pt.MIN_RESOLUTION)}getMinZoom(){return this.get(Pt.MIN_ZOOM)}getMaxZoom(){return this.get(Pt.MAX_ZOOM)}getOpacity(){return this.get(Pt.OPACITY)}getSourceState(){return gt()}getVisible(){return this.get(Pt.VISIBLE)}getZIndex(){return this.get(Pt.Z_INDEX)}setBackground(t){this.background_=t,this.changed()}setExtent(t){this.set(Pt.EXTENT,t)}setMaxResolution(t){this.set(Pt.MAX_RESOLUTION,t)}setMinResolution(t){this.set(Pt.MIN_RESOLUTION,t)}setMaxZoom(t){this.set(Pt.MAX_ZOOM,t)}setMinZoom(t){this.set(Pt.MIN_ZOOM,t)}setOpacity(t){xt(typeof t=="number",64),this.set(Pt.OPACITY,t)}setVisible(t){this.set(Pt.VISIBLE,t)}setZIndex(t){this.set(Pt.Z_INDEX,t)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}class Tr extends ya{constructor(t){const e=Object.assign({},t);delete e.source,super(e),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.rendered=!1,t.render&&(this.render=t.render),t.map&&this.setMap(t.map),this.addChangeListener(Pt.SOURCE,this.handleSourcePropertyChange_);const i=t.source?t.source:null;this.setSource(i)}getLayersArray(t){return t=t||[],t.push(this),t}getLayerStatesArray(t){return t=t||[],t.push(this.getLayerState()),t}getSource(){return this.get(Pt.SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const t=this.getSource();return t?t.getState():"undefined"}handleSourceChange_(){this.changed()}handleSourcePropertyChange_(){this.sourceChangeKey_&&(qt(this.sourceChangeKey_),this.sourceChangeKey_=null);const t=this.getSource();t&&(this.sourceChangeKey_=St(t,yt.CHANGE,this.handleSourceChange_,this)),this.changed()}getFeatures(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise(e=>e([]))}getData(t){return!this.renderer_||!this.rendered?null:this.renderer_.getData(t)}render(t,e){const i=this.getRenderer();if(i.prepareFrame(t))return this.rendered=!0,i.renderFrame(t,e)}unrender(){this.rendered=!1}setMapInternal(t){t||this.unrender(),this.set(Pt.MAP,t)}getMapInternal(){return this.get(Pt.MAP)}setMap(t){this.mapPrecomposeKey_&&(qt(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&(qt(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=St(t,di.PRECOMPOSE,function(e){const n=e.frameState.layerStatesArray,s=this.getLayerState(!1);xt(!n.some(function(o){return o.layer===s.layer}),67),n.push(s)},this),this.mapRenderKey_=St(this,yt.CHANGE,t.render,t),this.changed())}setSource(t){this.set(Pt.SOURCE,t)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}}function Is(r,t){if(!r.visible)return!1;const e=t.resolution;if(e<r.minResolution||e>=r.maxResolution)return!1;const i=t.zoom;return i>r.minZoom&&i<=r.maxZoom}function Sc(r,t,e,i,n){Ea(r,t,e||0,i||r.length-1,n||Ic)}function Ea(r,t,e,i,n){for(;i>e;){if(i-e>600){var s=i-e+1,o=t-e+1,a=Math.log(s),l=.5*Math.exp(2*a/3),h=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1),u=Math.max(e,Math.floor(t-o*l/s+h)),g=Math.min(i,Math.floor(t+(s-o)*l/s+h));Ea(r,t,u,g,n)}var m=r[t],y=e,w=i;for(sn(r,e,t),n(r[i],m)>0&&sn(r,e,i);y<w;){for(sn(r,y,w),y++,w--;n(r[y],m)<0;)y++;for(;n(r[w],m)>0;)w--}n(r[e],m)===0?sn(r,e,w):(w++,sn(r,w,i)),w<=t&&(e=w+1),t<=w&&(i=w-1)}}function sn(r,t,e){var i=r[t];r[t]=r[e],r[e]=i}function Ic(r,t){return r<t?-1:r>t?1:0}let wa=class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const i=[];if(!Yn(t,e))return i;const n=this.toBBox,s=[];for(;e;){for(let o=0;o<e.children.length;o++){const a=e.children[o],l=e.leaf?n(a):a;Yn(t,l)&&(e.leaf?i.push(a):Sr(t,l)?this._all(a,i):s.push(a))}e=s.pop()}return i}collides(t){let e=this.data;if(!Yn(t,e))return!1;const i=[];for(;e;){for(let n=0;n<e.children.length;n++){const s=e.children[n],o=e.leaf?this.toBBox(s):s;if(Yn(t,o)){if(e.leaf||Sr(t,o))return!0;i.push(s)}}e=i.pop()}return!1}load(t){if(!(t&&t.length))return this;if(t.length<this._minEntries){for(let i=0;i<t.length;i++)this.insert(t[i]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(!this.data.children.length)this.data=e;else if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const i=this.data;this.data=e,e=i}this._insert(e,this.data.height-e.height-1,!0)}return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=qi([]),this}remove(t,e){if(!t)return this;let i=this.data;const n=this.toBBox(t),s=[],o=[];let a,l,h;for(;i||s.length;){if(i||(i=s.pop(),l=s[s.length-1],a=o.pop(),h=!0),i.leaf){const u=Ac(t,i.children,e);if(u!==-1)return i.children.splice(u,1),s.push(i),this._condense(s),this}!h&&!i.leaf&&Sr(i,n)?(s.push(i),o.push(a),a=0,l=i,i=i.children[0]):l?(a++,i=l.children[a],h=!1):i=null}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const i=[];for(;t;)t.leaf?e.push(...t.children):i.push(...t.children),t=i.pop();return e}_build(t,e,i,n){const s=i-e+1;let o=this._maxEntries,a;if(s<=o)return a=qi(t.slice(e,i+1)),ki(a,this.toBBox),a;n||(n=Math.ceil(Math.log(s)/Math.log(o)),o=Math.ceil(s/Math.pow(o,n-1))),a=qi([]),a.leaf=!1,a.height=n;const l=Math.ceil(s/o),h=l*Math.ceil(Math.sqrt(o));fo(t,e,i,h,this.compareMinX);for(let u=e;u<=i;u+=h){const g=Math.min(u+h-1,i);fo(t,u,g,l,this.compareMinY);for(let m=u;m<=g;m+=l){const y=Math.min(m+l-1,g);a.children.push(this._build(t,m,y,n-1))}}return ki(a,this.toBBox),a}_chooseSubtree(t,e,i,n){for(;n.push(e),!(e.leaf||n.length-1===i);){let s=1/0,o=1/0,a;for(let l=0;l<e.children.length;l++){const h=e.children[l],u=Cr(h),g=Lc(t,h)-u;g<o?(o=g,s=u<s?u:s,a=h):g===o&&u<s&&(s=u,a=h)}e=a||e.children[0]}return e}_insert(t,e,i){const n=i?t:this.toBBox(t),s=[],o=this._chooseSubtree(n,this.data,e,s);for(o.children.push(t),an(o,n);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(n,s,e)}_split(t,e){const i=t[e],n=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,n);const o=this._chooseSplitIndex(i,s,n),a=qi(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,ki(i,this.toBBox),ki(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)}_splitRoot(t,e){this.data=qi([t,e]),this.data.height=t.height+1,this.data.leaf=!1,ki(this.data,this.toBBox)}_chooseSplitIndex(t,e,i){let n,s=1/0,o=1/0;for(let a=e;a<=i-e;a++){const l=on(t,0,a,this.toBBox),h=on(t,a,i,this.toBBox),u=Nc(l,h),g=Cr(l)+Cr(h);u<s?(s=u,n=a,o=g<o?g:o):u===s&&g<o&&(o=g,n=a)}return n||i-e}_chooseSplitAxis(t,e,i){const n=t.leaf?this.compareMinX:Oc,s=t.leaf?this.compareMinY:Mc,o=this._allDistMargin(t,e,i,n),a=this._allDistMargin(t,e,i,s);o<a&&t.children.sort(n)}_allDistMargin(t,e,i,n){t.children.sort(n);const s=this.toBBox,o=on(t,0,e,s),a=on(t,i-e,i,s);let l=jn(o)+jn(a);for(let h=e;h<i-e;h++){const u=t.children[h];an(o,t.leaf?s(u):u),l+=jn(o)}for(let h=i-e-1;h>=e;h--){const u=t.children[h];an(a,t.leaf?s(u):u),l+=jn(a)}return l}_adjustParentBBoxes(t,e,i){for(let n=i;n>=0;n--)an(e[n],t)}_condense(t){for(let e=t.length-1,i;e>=0;e--)t[e].children.length===0?e>0?(i=t[e-1].children,i.splice(i.indexOf(t[e]),1)):this.clear():ki(t[e],this.toBBox)}};function Ac(r,t,e){if(!e)return t.indexOf(r);for(let i=0;i<t.length;i++)if(e(r,t[i]))return i;return-1}function ki(r,t){on(r,0,r.children.length,t,r)}function on(r,t,e,i,n){n||(n=qi(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let s=t;s<e;s++){const o=r.children[s];an(n,r.leaf?i(o):o)}return n}function an(r,t){return r.minX=Math.min(r.minX,t.minX),r.minY=Math.min(r.minY,t.minY),r.maxX=Math.max(r.maxX,t.maxX),r.maxY=Math.max(r.maxY,t.maxY),r}function Oc(r,t){return r.minX-t.minX}function Mc(r,t){return r.minY-t.minY}function Cr(r){return(r.maxX-r.minX)*(r.maxY-r.minY)}function jn(r){return r.maxX-r.minX+(r.maxY-r.minY)}function Lc(r,t){return(Math.max(t.maxX,r.maxX)-Math.min(t.minX,r.minX))*(Math.max(t.maxY,r.maxY)-Math.min(t.minY,r.minY))}function Nc(r,t){const e=Math.max(r.minX,t.minX),i=Math.max(r.minY,t.minY),n=Math.min(r.maxX,t.maxX),s=Math.min(r.maxY,t.maxY);return Math.max(0,n-e)*Math.max(0,s-i)}function Sr(r,t){return r.minX<=t.minX&&r.minY<=t.minY&&t.maxX<=r.maxX&&t.maxY<=r.maxY}function Yn(r,t){return t.minX<=r.maxX&&t.minY<=r.maxY&&t.maxX>=r.minX&&t.maxY>=r.minY}function qi(r){return{children:r,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function fo(r,t,e,i,n){const s=[t,e];for(;s.length;){if(e=s.pop(),t=s.pop(),e-t<=i)continue;const o=t+Math.ceil((e-t)/i/2)*i;Sc(r,o,t,e,n),s.push(t,o,o,e)}}function go(r){return new gi({fill:Tn(r,""),stroke:Rn(r,""),text:Pc(r),image:Dc(r)})}function Tn(r,t){const e=r[t+"fill-color"];if(e)return new Qi({color:e})}function Rn(r,t){const e=r[t+"stroke-width"],i=r[t+"stroke-color"];if(!(!e&&!i))return new An({width:e,color:i,lineCap:r[t+"stroke-line-cap"],lineJoin:r[t+"stroke-line-join"],lineDash:r[t+"stroke-line-dash"],lineDashOffset:r[t+"stroke-line-dash-offset"],miterLimit:r[t+"stroke-miter-limit"]})}function Pc(r){const t=r["text-value"];return t?new ps({text:t,font:r["text-font"],maxAngle:r["text-max-angle"],offsetX:r["text-offset-x"],offsetY:r["text-offset-y"],overflow:r["text-overflow"],placement:r["text-placement"],scale:r["text-scale"],rotateWithView:r["text-rotate-with-view"],rotation:r["text-rotation"],textAlign:r["text-align"],justify:r["text-justify"],textBaseline:r["text-baseline"],padding:r["text-padding"],fill:Tn(r,"text-"),backgroundFill:Tn(r,"text-background-"),stroke:Rn(r,"text-"),backgroundStroke:Rn(r,"text-background-")}):void 0}function Dc(r){const t=r["icon-src"],e=r["icon-img"];if(t||e)return new yr({src:t,img:e,imgSize:r["icon-img-size"],anchor:r["icon-anchor"],anchorOrigin:r["icon-anchor-origin"],anchorXUnits:r["icon-anchor-x-units"],anchorYUnits:r["icon-anchor-y-units"],color:r["icon-color"],crossOrigin:r["icon-cross-origin"],offset:r["icon-offset"],displacement:r["icon-displacement"],opacity:r["icon-opacity"],scale:r["icon-scale"],rotation:r["icon-rotation"],rotateWithView:r["icon-rotate-with-view"],size:r["icon-size"],declutterMode:r["icon-declutter-mode"]});const i=r["shape-points"];if(i){const s="shape-";return new _r({points:i,fill:Tn(r,s),stroke:Rn(r,s),radius:r["shape-radius"],radius1:r["shape-radius1"],radius2:r["shape-radius2"],angle:r["shape-angle"],displacement:r["shape-displacement"],rotation:r["shape-rotation"],rotateWithView:r["shape-rotate-with-view"],scale:r["shape-scale"],declutterMode:r["shape-declutter-mode"]})}const n=r["circle-radius"];if(n){const s="circle-";return new In({radius:n,fill:Tn(r,s),stroke:Rn(r,s),displacement:r["circle-displacement"],scale:r["circle-scale"],rotation:r["circle-rotation"],rotateWithView:r["circle-rotate-with-view"],declutterMode:r["circle-declutter-mode"]})}}const po={RENDER_ORDER:"renderOrder"};class kc extends Tr{constructor(t){t=t||{};const e=Object.assign({},t);delete e.style,delete e.renderBuffer,delete e.updateWhileAnimating,delete e.updateWhileInteracting,super(e),this.declutter_=t.declutter!==void 0?t.declutter:!1,this.renderBuffer_=t.renderBuffer!==void 0?t.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(t.style),this.updateWhileAnimating_=t.updateWhileAnimating!==void 0?t.updateWhileAnimating:!1,this.updateWhileInteracting_=t.updateWhileInteracting!==void 0?t.updateWhileInteracting:!1}getDeclutter(){return this.declutter_}getFeatures(t){return super.getFeatures(t)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(po.RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(t){t.declutterTree||(t.declutterTree=new wa(9)),this.getRenderer().renderDeclutter(t)}setRenderOrder(t){this.set(po.RENDER_ORDER,t)}setStyle(t){let e;if(t===void 0)e=Ll;else if(t===null)e=null;else if(typeof t=="function")e=t;else if(t instanceof gi)e=t;else if(Array.isArray(t)){const i=t.length,n=new Array(i);for(let s=0;s<i;++s){const o=t[s];o instanceof gi?n[s]=o:n[s]=go(o)}e=n}else e=go(t);this.style_=e,this.styleFunction_=t===null?void 0:Ml(this.style_),this.changed()}}const ut={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},zn=[ut.FILL],ui=[ut.STROKE],Ri=[ut.BEGIN_PATH],mo=[ut.CLOSE_PATH];class va{drawCustom(t,e,i,n){}drawGeometry(t){}setStyle(t){}drawCircle(t,e){}drawFeature(t,e){}drawGeometryCollection(t,e){}drawLineString(t,e){}drawMultiLineString(t,e){}drawMultiPoint(t,e){}drawMultiPolygon(t,e){}drawPoint(t,e){}drawPolygon(t,e){}drawText(t,e){}setFillStrokeStyle(t,e){}setImageStyle(t,e){}setTextStyle(t,e){}}class Ln extends va{constructor(t,e,i,n){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=n,this.maxLineWidth=0,this.resolution=i,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){const e=this.pixelRatio;return e==1?t:t.map(function(i){return i*e})}appendFlatPointCoordinates(t,e){const i=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,s=this.coordinates;let o=s.length;for(let a=0,l=t.length;a<l;a+=e)n[0]=t[a],n[1]=t[a+1],lr(i,n)&&(s[o++]=n[0],s[o++]=n[1]);return o}appendFlatLineCoordinates(t,e,i,n,s,o){const a=this.coordinates;let l=a.length;const h=this.getBufferedMaxExtent();o&&(e+=n);let u=t[e],g=t[e+1];const m=this.tmpCoordinate_;let y=!0,w,E,v;for(w=e+n;w<i;w+=n)m[0]=t[w],m[1]=t[w+1],v=Ur(h,m),v!==E?(y&&(a[l++]=u,a[l++]=g,y=!1),a[l++]=m[0],a[l++]=m[1]):v===se.INTERSECTING?(a[l++]=m[0],a[l++]=m[1],y=!1):y=!0,u=m[0],g=m[1],E=v;return(s&&y||w===e+n)&&(a[l++]=u,a[l++]=g),l}drawCustomCoordinates_(t,e,i,n,s){for(let o=0,a=i.length;o<a;++o){const l=i[o],h=this.appendFlatLineCoordinates(t,e,l,n,!1,!1);s.push(h),e=l}return e}drawCustom(t,e,i,n){this.beginGeometry(t,e);const s=t.getType(),o=t.getStride(),a=this.coordinates.length;let l,h,u,g,m;switch(s){case"MultiPolygon":l=t.getOrientedFlatCoordinates(),g=[];const y=t.getEndss();m=0;for(let w=0,E=y.length;w<E;++w){const v=[];m=this.drawCustomCoordinates_(l,m,y[w],o,v),g.push(v)}this.instructions.push([ut.CUSTOM,a,g,t,i,Jr]),this.hitDetectionInstructions.push([ut.CUSTOM,a,g,t,n||i,Jr]);break;case"Polygon":case"MultiLineString":u=[],l=s=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),m=this.drawCustomCoordinates_(l,0,t.getEnds(),o,u),this.instructions.push([ut.CUSTOM,a,u,t,i,vn]),this.hitDetectionInstructions.push([ut.CUSTOM,a,u,t,n||i,vn]);break;case"LineString":case"Circle":l=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(l,0,l.length,o,!1,!1),this.instructions.push([ut.CUSTOM,a,h,t,i,hi]),this.hitDetectionInstructions.push([ut.CUSTOM,a,h,t,n||i,hi]);break;case"MultiPoint":l=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(l,o),h>a&&(this.instructions.push([ut.CUSTOM,a,h,t,i,hi]),this.hitDetectionInstructions.push([ut.CUSTOM,a,h,t,n||i,hi]));break;case"Point":l=t.getFlatCoordinates(),this.coordinates.push(l[0],l[1]),h=this.coordinates.length,this.instructions.push([ut.CUSTOM,a,h,t,i]),this.hitDetectionInstructions.push([ut.CUSTOM,a,h,t,n||i]);break}this.endGeometry(e)}beginGeometry(t,e){this.beginGeometryInstruction1_=[ut.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[ut.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const t=this.hitDetectionInstructions;t.reverse();let e;const i=t.length;let n,s,o=-1;for(e=0;e<i;++e)n=t[e],s=n[0],s==ut.END_GEOMETRY?o=e:s==ut.BEGIN_GEOMETRY&&(n[2]=e,yl(this.hitDetectionInstructions,o,e),o=-1)}setFillStrokeStyle(t,e){const i=this.state;if(t){const n=t.getColor();i.fillStyle=ke(n||Qe)}else i.fillStyle=void 0;if(e){const n=e.getColor();i.strokeStyle=ke(n||mn);const s=e.getLineCap();i.lineCap=s!==void 0?s:Jn;const o=e.getLineDash();i.lineDash=o?o.slice():fn;const a=e.getLineDashOffset();i.lineDashOffset=a||gn;const l=e.getLineJoin();i.lineJoin=l!==void 0?l:Zi;const h=e.getWidth();i.lineWidth=h!==void 0?h:yn;const u=e.getMiterLimit();i.miterLimit=u!==void 0?u:pn,i.lineWidth>this.maxLineWidth&&(this.maxLineWidth=i.lineWidth,this.bufferedMaxExtent_=null)}else i.strokeStyle=void 0,i.lineCap=void 0,i.lineDash=null,i.lineDashOffset=void 0,i.lineJoin=void 0,i.lineWidth=void 0,i.miterLimit=void 0}createFill(t){const e=t.fillStyle,i=[ut.SET_FILL_STYLE,e];return typeof e!="string"&&i.push(!0),i}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[ut.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){const i=t.fillStyle;(typeof i!="string"||t.currentFillStyle!=i)&&(i!==void 0&&this.instructions.push(e.call(this,t)),t.currentFillStyle=i)}updateStrokeStyle(t,e){const i=t.strokeStyle,n=t.lineCap,s=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,l=t.lineWidth,h=t.miterLimit;(t.currentStrokeStyle!=i||t.currentLineCap!=n||s!=t.currentLineDash&&!Li(t.currentLineDash,s)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=l||t.currentMiterLimit!=h)&&(i!==void 0&&e.call(this,t),t.currentStrokeStyle=i,t.currentLineCap=n,t.currentLineDash=s,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=l,t.currentMiterLimit=h)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const e=[ut.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=ko(this.maxExtent),this.maxLineWidth>0)){const t=this.resolution*(this.maxLineWidth+1)/2;as(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}}class Fc extends Ln{constructor(t,e,i,n){super(t,e,i,n),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([ut.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ut.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e){if(!this.image_)return;this.beginGeometry(t,e);const i=t.getFlatCoordinates(),n=t.getStride(),s=this.coordinates.length,o=this.appendFlatPointCoordinates(i,n);this.instructions.push([ut.DRAW_IMAGE,s,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([ut.DRAW_IMAGE,s,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){const i=t.getAnchor(),n=t.getSize(),s=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=i[0],this.anchorY_=i[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=s[0],this.originY_=s[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}class Gc extends Ln{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinates_(t,e,i,n){const s=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,i,n,!1,!1),a=[ut.MOVE_TO_LINE_TO,s,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),i}drawLineString(t,e){const i=this.state,n=i.strokeStyle,s=i.lineWidth;if(n===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,fn,gn],Ri);const o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(ui),this.endGeometry(e)}drawMultiLineString(t,e){const i=this.state,n=i.strokeStyle,s=i.lineWidth;if(n===void 0||s===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Ri);const o=t.getEnds(),a=t.getFlatCoordinates(),l=t.getStride();let h=0;for(let u=0,g=o.length;u<g;++u)h=this.drawFlatCoordinates_(a,h,o[u],l);this.hitDetectionInstructions.push(ui),this.endGeometry(e)}finish(){const t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ui),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ui),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(Ri)}}class _o extends Ln{constructor(t,e,i,n){super(t,e,i,n)}drawFlatCoordinatess_(t,e,i,n){const s=this.state,o=s.fillStyle!==void 0,a=s.strokeStyle!==void 0,l=i.length;this.instructions.push(Ri),this.hitDetectionInstructions.push(Ri);for(let h=0;h<l;++h){const u=i[h],g=this.coordinates.length,m=this.appendFlatLineCoordinates(t,e,u,n,!0,!a),y=[ut.MOVE_TO_LINE_TO,g,m];this.instructions.push(y),this.hitDetectionInstructions.push(y),a&&(this.instructions.push(mo),this.hitDetectionInstructions.push(mo)),e=u}return o&&(this.instructions.push(zn),this.hitDetectionInstructions.push(zn)),a&&(this.instructions.push(ui),this.hitDetectionInstructions.push(ui)),e}drawCircle(t,e){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(n===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_FILL_STYLE,Qe]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getFlatCoordinates(),a=t.getStride(),l=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);const h=[ut.CIRCLE,l];this.instructions.push(Ri,h),this.hitDetectionInstructions.push(Ri,h),i.fillStyle!==void 0&&(this.instructions.push(zn),this.hitDetectionInstructions.push(zn)),i.strokeStyle!==void 0&&(this.instructions.push(ui),this.hitDetectionInstructions.push(ui)),this.endGeometry(e)}drawPolygon(t,e){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(n===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_FILL_STYLE,Qe]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getEnds(),a=t.getOrientedFlatCoordinates(),l=t.getStride();this.drawFlatCoordinatess_(a,0,o,l),this.endGeometry(e)}drawMultiPolygon(t,e){const i=this.state,n=i.fillStyle,s=i.strokeStyle;if(n===void 0&&s===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_FILL_STYLE,Qe]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([ut.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);const o=t.getEndss(),a=t.getOrientedFlatCoordinates(),l=t.getStride();let h=0;for(let u=0,g=o.length;u<g;++u)h=this.drawFlatCoordinatess_(a,h,o[u],l);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const t=this.tolerance;if(t!==0){const e=this.coordinates;for(let i=0,n=e.length;i<n;++i)e[i]=Ei(e[i],t)}return super.finish()}setFillStrokeStyles_(){const t=this.state;t.fillStyle!==void 0&&this.updateFillStyle(t,this.createFill),t.strokeStyle!==void 0&&this.updateStrokeStyle(t,this.applyStroke)}}function Uc(r,t,e,i,n){let s=e,o=e,a=0,l=0,h=e,u,g,m,y,w,E,v,x,S,R;for(g=e;g<i;g+=n){const O=t[g],k=t[g+1];w!==void 0&&(S=O-w,R=k-E,y=Math.sqrt(S*S+R*R),v!==void 0&&(l+=m,u=Math.acos((v*S+x*R)/(m*y)),u>r&&(l>a&&(a=l,s=h,o=g),l=0,h=g-n)),m=y,v=S,x=R),w=O,E=k}return l+=y,l>a?[h,g]:[s,o]}const hn={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};class qc extends Ln{constructor(t,e,i,n){super(t,e,i,n),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e){const i=this.textFillState_,n=this.textStrokeState_,s=this.textState_;if(this.text_===""||!s||!i&&!n)return;const o=this.coordinates;let a=o.length;const l=t.getType();let h=null,u=t.getStride();if(s.placement==="line"&&(l=="LineString"||l=="MultiLineString"||l=="Polygon"||l=="MultiPolygon")){if(!me(this.getBufferedMaxExtent(),t.getExtent()))return;let g;if(h=t.getFlatCoordinates(),l=="LineString")g=[h.length];else if(l=="MultiLineString")g=t.getEnds();else if(l=="Polygon")g=t.getEnds().slice(0,1);else if(l=="MultiPolygon"){const E=t.getEndss();g=[];for(let v=0,x=E.length;v<x;++v)g.push(E[v][0])}this.beginGeometry(t,e);const m=s.textAlign;let y=0,w;for(let E=0,v=g.length;E<v;++E){if(m==null){const S=Uc(s.maxAngle,h,y,g[E],u);y=S[0],w=S[1]}else w=g[E];for(let S=y;S<w;S+=u)o.push(h[S],h[S+1]);const x=o.length;y=g[E],this.drawChars_(a,x),a=x}this.endGeometry(e)}else{let g=s.overflow?null:[];switch(l){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),u=2;break;case"Polygon":h=t.getFlatInteriorPoint(),s.overflow||g.push(h[2]/this.resolution),u=3;break;case"MultiPolygon":const v=t.getFlatInteriorPoints();h=[];for(let x=0,S=v.length;x<S;x+=3)s.overflow||g.push(v[x+2]/this.resolution),h.push(v[x],v[x+1]);if(h.length===0)return;u=2;break}const m=this.appendFlatPointCoordinates(h,u);if(m===a)return;if(g&&(m-a)/2!==h.length/u){let v=a/2;g=g.filter((x,S)=>{const R=o[(v+S)*2]===h[S*u]&&o[(v+S)*2+1]===h[S*u+1];return R||--v,R})}this.saveTextStates_(),(s.backgroundFill||s.backgroundStroke)&&(this.setFillStrokeStyle(s.backgroundFill,s.backgroundStroke),s.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),s.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);let y=s.padding;if(y!=vi&&(s.scale[0]<0||s.scale[1]<0)){let v=s.padding[0],x=s.padding[1],S=s.padding[2],R=s.padding[3];s.scale[0]<0&&(x=-x,R=-R),s.scale[1]<0&&(v=-v,S=-S),y=[v,x,S,R]}const w=this.pixelRatio;this.instructions.push([ut.DRAW_IMAGE,a,m,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,y==vi?vi:y.map(function(v){return v*w}),!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,g]);const E=1/w;this.hitDetectionInstructions.push([ut.DRAW_IMAGE,a,m,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[E,E],NaN,void 0,this.declutterImageWithText_,y,!!s.backgroundFill,!!s.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,g]),this.endGeometry(e)}}saveTextStates_(){const t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));const s=this.textKey_;s in this.textStates||(this.textStates[s]={font:e.font,textAlign:e.textAlign||_n,justify:e.justify,textBaseline:e.textBaseline||Qn,scale:e.scale});const o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))}drawChars_(t,e){const i=this.textStrokeState_,n=this.textState_,s=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();const l=this.pixelRatio,h=hn[n.textBaseline],u=this.textOffsetY_*l,g=this.text_,m=i?i.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([ut.DRAW_CHARS,t,e,h,n.overflow,a,n.maxAngle,l,u,s,m*l,g,o,1]),this.hitDetectionInstructions.push([ut.DRAW_CHARS,t,e,h,n.overflow,a,n.maxAngle,1,u,s,m,g,o,1/l])}setTextStyle(t,e){let i,n,s;if(!t)this.text_="";else{const o=t.getFill();o?(n=this.textFillState_,n||(n={},this.textFillState_=n),n.fillStyle=ke(o.getColor()||Qe)):(n=null,this.textFillState_=n);const a=t.getStroke();if(!a)s=null,this.textStrokeState_=s;else{s=this.textStrokeState_,s||(s={},this.textStrokeState_=s);const w=a.getLineDash(),E=a.getLineDashOffset(),v=a.getWidth(),x=a.getMiterLimit();s.lineCap=a.getLineCap()||Jn,s.lineDash=w?w.slice():fn,s.lineDashOffset=E===void 0?gn:E,s.lineJoin=a.getLineJoin()||Zi,s.lineWidth=v===void 0?yn:v,s.miterLimit=x===void 0?pn:x,s.strokeStyle=ke(a.getColor()||mn)}i=this.textState_;const l=t.getFont()||Ko;Tl(l);const h=t.getScaleArray();i.overflow=t.getOverflow(),i.font=l,i.maxAngle=t.getMaxAngle(),i.placement=t.getPlacement(),i.textAlign=t.getTextAlign(),i.justify=t.getJustify(),i.textBaseline=t.getTextBaseline()||Qn,i.backgroundFill=t.getBackgroundFill(),i.backgroundStroke=t.getBackgroundStroke(),i.padding=t.getPadding()||vi,i.scale=h===void 0?[1,1]:h;const u=t.getOffsetX(),g=t.getOffsetY(),m=t.getRotateWithView(),y=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=u===void 0?0:u,this.textOffsetY_=g===void 0?0:g,this.textRotateWithView_=m===void 0?!1:m,this.textRotation_=y===void 0?0:y,this.strokeKey_=s?(typeof s.strokeStyle=="string"?s.strokeStyle:Lt(s.strokeStyle))+s.lineCap+s.lineDashOffset+"|"+s.lineWidth+s.lineJoin+s.miterLimit+"["+s.lineDash.join()+"]":"",this.textKey_=i.font+i.scale+(i.textAlign||"?")+(i.justify||"?")+(i.textBaseline||"?"),this.fillKey_=n?typeof n.fillStyle=="string"?n.fillStyle:"|"+Lt(n.fillStyle):""}this.declutterImageWithText_=e}}const Xc={Circle:_o,Default:Ln,Image:Fc,LineString:Gc,Polygon:_o,Text:qc};class yo{constructor(t,e,i,n){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=n,this.resolution_=i,this.buildersByZIndex_={}}finish(){const t={};for(const e in this.buildersByZIndex_){t[e]=t[e]||{};const i=this.buildersByZIndex_[e];for(const n in i){const s=i[n].finish();t[e][n]=s}}return t}getBuilder(t,e){const i=t!==void 0?t.toString():"0";let n=this.buildersByZIndex_[i];n===void 0&&(n={},this.buildersByZIndex_[i]=n);let s=n[e];if(s===void 0){const o=Xc[e];s=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=s}return s}}class jc extends Sn{constructor(t){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=t,this.declutterExecutorGroup=null}getFeatures(t){return gt()}getData(t){return null}prepareFrame(t){return gt()}renderFrame(t,e){return gt()}loadedTileCallback(t,e,i){t[e]||(t[e]={}),t[e][i.tileCoord.toString()]=i}createLoadedTileFinder(t,e,i){return(function(n,s){const o=this.loadedTileCallback.bind(this,i,n);return t.forEachLoadedTile(e,n,s,o)}).bind(this)}forEachFeatureAtCoordinate(t,e,i,n,s){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(t){t.target.getState()===te.LOADED&&this.renderIfReadyAndVisible()}loadImage(t){let e=t.getState();return e!=te.LOADED&&e!=te.ERROR&&t.addEventListener(yt.CHANGE,this.boundHandleImageChange_),e==te.IDLE&&(t.load(),e=t.getState()),e==te.LOADED}renderIfReadyAndVisible(){const t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==="ready"&&t.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}class xa extends ti{constructor(t,e,i,n){super(t),this.inversePixelTransform=e,this.frameState=i,this.context=n}}const Eo=[];let Xi=null;function Yc(){const r=document.createElement("canvas");r.width=1,r.height=1,Xi=r.getContext("2d")}class Ta extends jc{constructor(t){super(t),this.container=null,this.renderedResolution,this.tempTransform=Ge(),this.pixelTransform=Ge(),this.inversePixelTransform=Ge(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(t,e,i){Xi||Yc(),Xi.clearRect(0,0,1,1);let n;try{Xi.drawImage(t,e,i,1,1,0,0,1,1),n=Xi.getImageData(0,0,1,1).data}catch{return Xi=null,null}return n}getBackground(t){let i=this.getLayer().getBackground();return typeof i=="function"&&(i=i(t.viewState.resolution)),i||void 0}useContainer(t,e,i){const n=this.getLayer().getClassName();let s,o;if(t&&t.className===n&&(!i||t&&t.style.backgroundColor&&Li(Kn(t.style.backgroundColor),Kn(i)))){const a=t.firstElementChild;a instanceof HTMLCanvasElement&&(o=a.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){s=document.createElement("div"),s.className=n;let a=s.style;a.position="absolute",a.width="100%",a.height="100%",o=xe();const l=o.canvas;s.appendChild(l),a=l.style,a.position="absolute",a.left="0",a.transformOrigin="top left",this.container=s,this.context=o}!this.containerReused&&i&&!this.container.style.backgroundColor&&(this.container.style.backgroundColor=i)}clipUnrotated(t,e,i){const n=Mi(i),s=ur(i),o=hr(i),a=cr(i);oe(e.coordinateToPixelTransform,n),oe(e.coordinateToPixelTransform,s),oe(e.coordinateToPixelTransform,o),oe(e.coordinateToPixelTransform,a);const l=this.inversePixelTransform;oe(l,n),oe(l,s),oe(l,o),oe(l,a),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(s[0]),Math.round(s[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}dispatchRenderEvent_(t,e,i){const n=this.getLayer();if(n.hasListener(t)){const s=new xa(t,this.inversePixelTransform,i,e);n.dispatchEvent(s)}}preRender(t,e){this.frameState=e,this.dispatchRenderEvent_(di.PRERENDER,t,e)}postRender(t,e){this.dispatchRenderEvent_(di.POSTRENDER,t,e)}getRenderTransform(t,e,i,n,s,o,a){const l=s/2,h=o/2,u=n/e,g=-u,m=-t[0]+a,y=-t[1];return pi(this.tempTransform,l,h,u,g,-i,m,y)}disposeInternal(){delete this.frameState,super.disposeInternal()}}function zc(r,t,e,i,n,s,o,a,l,h,u,g){let m=r[t],y=r[t+1],w=0,E=0,v=0,x=0;function S(){w=m,E=y,t+=i,m=r[t],y=r[t+1],x+=v,v=Math.sqrt((m-w)*(m-w)+(y-E)*(y-E))}do S();while(t<e-i&&x+v<s);let R=v===0?0:(s-x)/v;const O=Ze(w,m,R),k=Ze(E,y,R),F=t-i,W=x,H=s+a*l(h,n,u);for(;t<e-i&&x+v<H;)S();R=v===0?0:(H-x)/v;const N=Ze(w,m,R),z=Ze(E,y,R);let I;if(g){const P=[O,k,N,z];sa(P,0,4,2,g,P,P),I=P[0]>P[2]}else I=O>N;const L=Math.PI,U=[],J=F+i===t;t=F,v=0,x=W,m=r[t],y=r[t+1];let Y;if(J){S(),Y=Math.atan2(y-E,m-w),I&&(Y+=Y>0?-L:L);const P=(N+O)/2,X=(z+k)/2;return U[0]=[P,X,(H-s)/2,Y,n],U}n=n.replace(/\n/g," ");for(let P=0,X=n.length;P<X;){S();let M=Math.atan2(y-E,m-w);if(I&&(M+=M>0?-L:L),Y!==void 0){let lt=M-Y;if(lt+=lt>L?-2*L:lt<-L?2*L:0,Math.abs(lt)>o)return null}Y=M;const B=P;let Z=0;for(;P<X;++P){const lt=I?X-P-1:P,nt=a*l(h,n[lt],u);if(t+i<e&&x+v<s+Z+nt/2)break;Z+=nt}if(P===B)continue;const K=I?n.substring(X-B,X-P):n.substring(B,P);R=v===0?0:(s+Z/2-x)/v;const q=Ze(w,m,R),Q=Ze(E,y,R);U.push([q,Q,Z/2,M,K]),s+=Z}return U}const Fi=Ce(),ii=[],Be=[],He=[],ni=[];function wo(r){return r[3].declutterBox}const Vc=new RegExp("[֑-ࣿיִ-﷿ﹰ-ﻼࠀ-࿿-]");function vo(r,t){return(t==="start"||t==="end")&&!Vc.test(r)&&(t=t==="start"?"left":"right"),hn[t]}function Wc(r,t,e){return e>0&&r.push(`
`,""),r.push(t,""),r}class Bc{constructor(t,e,i,n){this.overlaps=i,this.pixelRatio=e,this.resolution=t,this.alignFill_,this.instructions=n.instructions,this.coordinates=n.coordinates,this.coordinateCache_={},this.renderedTransform_=Ge(),this.hitDetectionInstructions=n.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=n.fillStates||{},this.strokeStates=n.strokeStates||{},this.textStates=n.textStates||{},this.widths_={},this.labels_={}}createLabel(t,e,i,n){const s=t+e+i+n;if(this.labels_[s])return this.labels_[s];const o=n?this.strokeStates[n]:null,a=i?this.fillStates[i]:null,l=this.textStates[e],h=this.pixelRatio,u=[l.scale[0]*h,l.scale[1]*h],g=Array.isArray(t),m=l.justify?hn[l.justify]:vo(Array.isArray(t)?t[0]:t,l.textAlign||_n),y=n&&o.lineWidth?o.lineWidth:0,w=g?t:t.split(`
`).reduce(Wc,[]),{width:E,height:v,widths:x,heights:S,lineWidths:R}=bl(l,w),O=E+y,k=[],F=(O+2)*u[0],W=(v+y)*u[1],H={width:F<0?Math.floor(F):Math.ceil(F),height:W<0?Math.floor(W):Math.ceil(W),contextInstructions:k};(u[0]!=1||u[1]!=1)&&k.push("scale",u),n&&(k.push("strokeStyle",o.strokeStyle),k.push("lineWidth",y),k.push("lineCap",o.lineCap),k.push("lineJoin",o.lineJoin),k.push("miterLimit",o.miterLimit),k.push("setLineDash",[o.lineDash]),k.push("lineDashOffset",o.lineDashOffset)),i&&k.push("fillStyle",a.fillStyle),k.push("textBaseline","middle"),k.push("textAlign","center");const N=.5-m;let z=m*O+N*y;const I=[],L=[];let U=0,J=0,Y=0,P=0,X;for(let M=0,B=w.length;M<B;M+=2){const Z=w[M];if(Z===`
`){J+=U,U=0,z=m*O+N*y,++P;continue}const K=w[M+1]||l.font;K!==X&&(n&&I.push("font",K),i&&L.push("font",K),X=K),U=Math.max(U,S[Y]);const q=[Z,z+N*x[Y]+m*(x[Y]-R[P]),.5*(y+U)+J];z+=x[Y],n&&I.push("strokeText",q),i&&L.push("fillText",q),++Y}return Array.prototype.push.apply(k,I),Array.prototype.push.apply(k,L),this.labels_[s]=H,H}replayTextBackground_(t,e,i,n,s,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,s),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}calculateImageOrLabelDimensions_(t,e,i,n,s,o,a,l,h,u,g,m,y,w,E,v){a*=m[0],l*=m[1];let x=i-a,S=n-l;const R=s+h>t?t-h:s,O=o+u>e?e-u:o,k=w[3]+R*m[0]+w[1],F=w[0]+O*m[1]+w[2],W=x-w[3],H=S-w[0];(E||g!==0)&&(ii[0]=W,ni[0]=W,ii[1]=H,Be[1]=H,Be[0]=W+k,He[0]=Be[0],He[1]=H+F,ni[1]=He[1]);let N;return g!==0?(N=pi(Ge(),i,n,1,1,g,-i,-n),oe(N,ii),oe(N,Be),oe(N,He),oe(N,ni),Ue(Math.min(ii[0],Be[0],He[0],ni[0]),Math.min(ii[1],Be[1],He[1],ni[1]),Math.max(ii[0],Be[0],He[0],ni[0]),Math.max(ii[1],Be[1],He[1],ni[1]),Fi)):Ue(Math.min(W,W+k),Math.min(H,H+F),Math.max(W,W+k),Math.max(H,H+F),Fi),y&&(x=Math.round(x),S=Math.round(S)),{drawImageX:x,drawImageY:S,drawImageW:R,drawImageH:O,originX:h,originY:u,declutterBox:{minX:Fi[0],minY:Fi[1],maxX:Fi[2],maxY:Fi[3],value:v},canvasTransform:N,scale:m}}replayImageOrLabel_(t,e,i,n,s,o,a){const l=!!(o||a),h=n.declutterBox,u=t.canvas,g=a?a[2]*n.scale[0]/2:0;return h.minX-g<=u.width/e&&h.maxX+g>=0&&h.minY-g<=u.height/e&&h.maxY+g>=0&&(l&&this.replayTextBackground_(t,ii,Be,He,ni,o,a),Cl(t,n.canvasTransform,s,i,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}fill_(t){if(this.alignFill_){const e=oe(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(e[0]%i,e[1]%i),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6])}drawLabelWithPointPlacement_(t,e,i,n){const s=this.textStates[e],o=this.createLabel(t,e,n,i),a=this.strokeStates[i],l=this.pixelRatio,h=vo(Array.isArray(t)?t[0]:t,s.textAlign||_n),u=hn[s.textBaseline||Qn],g=a&&a.lineWidth?a.lineWidth:0,m=o.width/l-2*s.scale[0],y=h*m+2*(.5-h)*g,w=u*o.height/l+2*(.5-u)*g;return{label:o,anchorX:y,anchorY:w}}execute_(t,e,i,n,s,o,a,l){let h;this.pixelCoordinates_&&Li(i,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Ci(this.coordinates,0,this.coordinates.length,2,i,this.pixelCoordinates_),Dl(this.renderedTransform_,i));let u=0;const g=n.length;let m=0,y,w,E,v,x,S,R,O,k,F,W,H,N=0,z=0,I=null,L=null;const U=this.coordinateCache_,J=this.viewRotation_,Y=Math.round(Math.atan2(-i[1],i[0])*1e12)/1e12,P={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:J},X=this.instructions!=n||this.overlaps?0:200;let M,B,Z,K;for(;u<g;){const q=n[u];switch(q[0]){case ut.BEGIN_GEOMETRY:M=q[1],K=q[3],M.getGeometry()?a!==void 0&&!me(a,K.getExtent())?u=q[2]+1:++u:u=q[2];break;case ut.BEGIN_PATH:N>X&&(this.fill_(t),N=0),z>X&&(t.stroke(),z=0),!N&&!z&&(t.beginPath(),v=NaN,x=NaN),++u;break;case ut.CIRCLE:m=q[1];const lt=h[m],nt=h[m+1],Gt=h[m+2],Rt=h[m+3],_t=Gt-lt,mt=Rt-nt,pt=Math.sqrt(_t*_t+mt*mt);t.moveTo(lt+pt,nt),t.arc(lt,nt,pt,0,2*Math.PI,!0),++u;break;case ut.CLOSE_PATH:t.closePath(),++u;break;case ut.CUSTOM:m=q[1],y=q[2];const G=q[3],j=q[4],tt=q.length==6?q[5]:void 0;P.geometry=G,P.feature=M,u in U||(U[u]=[]);const st=U[u];tt?tt(h,m,y,2,st):(st[0]=h[m],st[1]=h[m+1],st.length=2),j(st,P),++u;break;case ut.DRAW_IMAGE:m=q[1],y=q[2],O=q[3],w=q[4],E=q[5];let et=q[6];const rt=q[7],it=q[8],Ot=q[9],Mt=q[10];let It=q[11];const Dt=q[12];let Nt=q[13];const kt=q[14],Et=q[15];if(!O&&q.length>=20){k=q[19],F=q[20],W=q[21],H=q[22];const ie=this.drawLabelWithPointPlacement_(k,F,W,H);O=ie.label,q[3]=O;const ge=q[23];w=(ie.anchorX-ge)*this.pixelRatio,q[4]=w;const ne=q[24];E=(ie.anchorY-ne)*this.pixelRatio,q[5]=E,et=O.height,q[6]=et,Nt=O.width,q[13]=Nt}let bt;q.length>25&&(bt=q[25]);let ce,Vt,Jt;q.length>17?(ce=q[16],Vt=q[17],Jt=q[18]):(ce=vi,Vt=!1,Jt=!1),Mt&&Y?It+=J:!Mt&&!Y&&(It-=J);let Tt=0;for(;m<y;m+=2){if(bt&&bt[Tt++]<Nt/this.pixelRatio)continue;const ie=this.calculateImageOrLabelDimensions_(O.width,O.height,h[m],h[m+1],Nt,et,w,E,it,Ot,It,Dt,s,ce,Vt||Jt,M),ge=[t,e,O,ie,rt,Vt?I:null,Jt?L:null];if(l){if(kt==="none")continue;if(kt==="obstacle"){l.insert(ie.declutterBox);continue}else{let ne,re;if(Et){const jt=y-m;if(!Et[jt]){Et[jt]=ge;continue}if(ne=Et[jt],delete Et[jt],re=wo(ne),l.collides(re))continue}if(l.collides(ie.declutterBox))continue;ne&&(l.insert(re),this.replayImageOrLabel_.apply(this,ne)),l.insert(ie.declutterBox)}}this.replayImageOrLabel_.apply(this,ge)}++u;break;case ut.DRAW_CHARS:const ht=q[1],wt=q[2],Wt=q[3],ae=q[4];H=q[5];const fe=q[6],Ie=q[7],ye=q[8];W=q[9];const Ae=q[10];k=q[11],F=q[12];const je=[q[13],q[13]],Oe=this.textStates[F],Ee=Oe.font,ee=[Oe.scale[0]*Ie,Oe.scale[1]*Ie];let Te;Ee in this.widths_?Te=this.widths_[Ee]:(Te={},this.widths_[Ee]=Te);const Re=ga(h,ht,wt,2),Ht=Math.abs(ee[0])*$s(Ee,k,Te);if(ae||Ht<=Re){const ie=this.textStates[F].textAlign,ge=(Re-Ht)*hn[ie],ne=zc(h,ht,wt,2,k,ge,fe,Math.abs(ee[0]),$s,Ee,Te,Y?0:this.viewRotation_);t:if(ne){const re=[];let jt,Ye,le,Qt,$t;if(W)for(jt=0,Ye=ne.length;jt<Ye;++jt){$t=ne[jt],le=$t[4],Qt=this.createLabel(le,F,"",W),w=$t[2]+(ee[0]<0?-Ae:Ae),E=Wt*Qt.height+(.5-Wt)*2*Ae*ee[1]/ee[0]-ye;const f=this.calculateImageOrLabelDimensions_(Qt.width,Qt.height,$t[0],$t[1],Qt.width,Qt.height,w,E,0,0,$t[3],je,!1,vi,!1,M);if(l&&l.collides(f.declutterBox))break t;re.push([t,e,Qt,f,1,null,null])}if(H)for(jt=0,Ye=ne.length;jt<Ye;++jt){$t=ne[jt],le=$t[4],Qt=this.createLabel(le,F,H,""),w=$t[2],E=Wt*Qt.height-ye;const f=this.calculateImageOrLabelDimensions_(Qt.width,Qt.height,$t[0],$t[1],Qt.width,Qt.height,w,E,0,0,$t[3],je,!1,vi,!1,M);if(l&&l.collides(f.declutterBox))break t;re.push([t,e,Qt,f,1,null,null])}l&&l.load(re.map(wo));for(let f=0,_=re.length;f<_;++f)this.replayImageOrLabel_.apply(this,re[f])}}++u;break;case ut.END_GEOMETRY:if(o!==void 0){M=q[1];const ie=o(M,K);if(ie)return ie}++u;break;case ut.FILL:X?N++:this.fill_(t),++u;break;case ut.MOVE_TO_LINE_TO:for(m=q[1],y=q[2],B=h[m],Z=h[m+1],S=B+.5|0,R=Z+.5|0,(S!==v||R!==x)&&(t.moveTo(B,Z),v=S,x=R),m+=2;m<y;m+=2)B=h[m],Z=h[m+1],S=B+.5|0,R=Z+.5|0,(m==y-2||S!==v||R!==x)&&(t.lineTo(B,Z),v=S,x=R);++u;break;case ut.SET_FILL_STYLE:I=q,this.alignFill_=q[2],N&&(this.fill_(t),N=0,z&&(t.stroke(),z=0)),t.fillStyle=q[1],++u;break;case ut.SET_STROKE_STYLE:L=q,z&&(t.stroke(),z=0),this.setStrokeStyle_(t,q),++u;break;case ut.STROKE:X?z++:t.stroke(),++u;break;default:++u;break}}N&&this.fill_(t),z&&t.stroke()}execute(t,e,i,n,s,o){this.viewRotation_=n,this.execute_(t,e,i,this.instructions,s,void 0,void 0,o)}executeHitDetection(t,e,i,n,s){return this.viewRotation_=i,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,s)}}const Ir=["Polygon","Circle","LineString","Image","Text","Default"];class xo{constructor(t,e,i,n,s,o){this.maxExtent_=t,this.overlaps_=n,this.pixelRatio_=i,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=Ge(),this.createExecutors_(s)}clip(t,e){const i=this.getClipCoords(e);t.beginPath(),t.moveTo(i[0],i[1]),t.lineTo(i[2],i[3]),t.lineTo(i[4],i[5]),t.lineTo(i[6],i[7]),t.clip()}createExecutors_(t){for(const e in t){let i=this.executorsByZIndex_[e];i===void 0&&(i={},this.executorsByZIndex_[e]=i);const n=t[e];for(const s in n){const o=n[s];i[s]=new Bc(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}hasExecutors(t){for(const e in this.executorsByZIndex_){const i=this.executorsByZIndex_[e];for(let n=0,s=t.length;n<s;++n)if(t[n]in i)return!0}return!1}forEachFeatureAtCoordinate(t,e,i,n,s,o){n=Math.round(n);const a=n*2+1,l=pi(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-i,-t[0],-t[1]),h=!this.hitDetectionContext_;h&&(this.hitDetectionContext_=xe(a,a));const u=this.hitDetectionContext_;u.canvas.width!==a||u.canvas.height!==a?(u.canvas.width=a,u.canvas.height=a):h||u.clearRect(0,0,a,a);let g;this.renderBuffer_!==void 0&&(g=Ce(),ln(g,t),as(g,e*(this.renderBuffer_+n),g));const m=Hc(n);let y;function w(k,F){const W=u.getImageData(0,0,a,a).data;for(let H=0,N=m.length;H<N;H++)if(W[m[H]]>0){if(!o||y!=="Image"&&y!=="Text"||o.includes(k)){const z=(m[H]-3)/4,I=n-z%a,L=n-(z/a|0),U=s(k,F,I*I+L*L);if(U)return U}u.clearRect(0,0,a,a);break}}const E=Object.keys(this.executorsByZIndex_).map(Number);E.sort($i);let v,x,S,R,O;for(v=E.length-1;v>=0;--v){const k=E[v].toString();for(S=this.executorsByZIndex_[k],x=Ir.length-1;x>=0;--x)if(y=Ir[x],R=S[y],R!==void 0&&(O=R.executeHitDetection(u,l,i,w,g),O))return O}}getClipCoords(t){const e=this.maxExtent_;if(!e)return null;const i=e[0],n=e[1],s=e[2],o=e[3],a=[i,n,i,o,s,o,s,n];return Ci(a,0,8,2,t,a),a}isEmpty(){return Ki(this.executorsByZIndex_)}execute(t,e,i,n,s,o,a){const l=Object.keys(this.executorsByZIndex_).map(Number);l.sort($i),this.maxExtent_&&(t.save(),this.clip(t,i)),o=o||Ir;let h,u,g,m,y,w;for(a&&l.reverse(),h=0,u=l.length;h<u;++h){const E=l[h].toString();for(y=this.executorsByZIndex_[E],g=0,m=o.length;g<m;++g){const v=o[g];w=y[v],w!==void 0&&w.execute(t,e,i,n,s,a)}}this.maxExtent_&&t.restore()}}const Ar={};function Hc(r){if(Ar[r]!==void 0)return Ar[r];const t=r*2+1,e=r*r,i=new Array(e+1);for(let s=0;s<=r;++s)for(let o=0;o<=r;++o){const a=s*s+o*o;if(a>e)break;let l=i[a];l||(l=[],i[a]=l),l.push(((r+s)*t+(r+o))*4+3),s>0&&l.push(((r-s)*t+(r+o))*4+3),o>0&&(l.push(((r+s)*t+(r-o))*4+3),s>0&&l.push(((r-s)*t+(r-o))*4+3))}const n=[];for(let s=0,o=i.length;s<o;++s)i[s]&&n.push(...i[s]);return Ar[r]=n,n}const de={ANIMATING:0,INTERACTING:1};class $c extends va{constructor(t,e,i,n,s,o,a){super(),this.context_=t,this.pixelRatio_=e,this.extent_=i,this.transform_=n,this.viewRotation_=s,this.squaredTolerance_=o,this.userTransform_=a,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=Ge()}drawImages_(t,e,i,n){if(!this.image_)return;const s=Ci(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,l=o.globalAlpha;this.imageOpacity_!=1&&(o.globalAlpha=l*this.imageOpacity_);let h=this.imageRotation_;this.imageRotateWithView_&&(h+=this.viewRotation_);for(let u=0,g=s.length;u<g;u+=2){const m=s[u]-this.imageAnchorX_,y=s[u+1]-this.imageAnchorY_;if(h!==0||this.imageScale_[0]!=1||this.imageScale_[1]!=1){const w=m+this.imageAnchorX_,E=y+this.imageAnchorY_;pi(a,w,E,1,1,h,-w,-E),o.setTransform.apply(o,a),o.translate(w,E),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,m,y,this.imageWidth_,this.imageHeight_)}this.imageOpacity_!=1&&(o.globalAlpha=l)}drawText_(t,e,i,n){if(!this.textState_||this.text_==="")return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const s=Ci(t,e,i,n,this.transform_,this.pixelCoordinates_),o=this.context_;let a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<i;e+=n){const l=s[e]+this.textOffsetX_,h=s[e+1]+this.textOffsetY_;a!==0||this.textScale_[0]!=1||this.textScale_[1]!=1?(o.translate(l-this.textOffsetX_,h-this.textOffsetY_),o.rotate(a),o.translate(this.textOffsetX_,this.textOffsetY_),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)):(this.textStrokeState_&&o.strokeText(this.text_,l,h),this.textFillState_&&o.fillText(this.text_,l,h))}}moveToLineTo_(t,e,i,n,s){const o=this.context_,a=Ci(t,e,i,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);let l=a.length;s&&(l-=2);for(let h=2;h<l;h+=2)o.lineTo(a[h],a[h+1]);return s&&o.closePath(),i}drawRings_(t,e,i,n){for(let s=0,o=i.length;s<o;++s)e=this.moveToLineTo_(t,e,i[s],n,!0);return e}drawCircle(t){if(me(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=lc(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],n=e[3]-e[1],s=Math.sqrt(i*i+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],s,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}this.text_!==""&&this.drawText_(t.getCenter(),0,2,2)}}setStyle(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}setTransform(t){this.transform_=t}drawGeometry(t){switch(t.getType()){case"Point":this.drawPoint(t);break;case"LineString":this.drawLineString(t);break;case"Polygon":this.drawPolygon(t);break;case"MultiPoint":this.drawMultiPoint(t);break;case"MultiLineString":this.drawMultiLineString(t);break;case"MultiPolygon":this.drawMultiPolygon(t);break;case"GeometryCollection":this.drawGeometryCollection(t);break;case"Circle":this.drawCircle(t);break}}drawFeature(t,e){const i=e.getGeometryFunction()(t);!i||!me(this.extent_,i.getExtent())||(this.setStyle(e),this.drawGeometry(i))}drawGeometryCollection(t){const e=t.getGeometriesArray();for(let i=0,n=e.length;i<n;++i)this.drawGeometry(e[i])}drawPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawMultiPoint(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i),this.text_!==""&&this.drawText_(e,0,e.length,i)}drawLineString(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!me(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(i,0,i.length,t.getStride(),!1),e.stroke()}if(this.text_!==""){const e=t.getFlatMidpoint();this.drawText_(e,0,2,2)}}}drawMultiLineString(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const e=t.getExtent();if(me(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const i=this.context_,n=t.getFlatCoordinates();let s=0;const o=t.getEnds(),a=t.getStride();i.beginPath();for(let l=0,h=o.length;l<h;++l)s=this.moveToLineTo_(n,s,o[l],a,!1);i.stroke()}if(this.text_!==""){const i=t.getFlatMidpoints();this.drawText_(i,0,i.length,2)}}}drawPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!me(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoint();this.drawText_(e,0,2,2)}}}drawMultiPolygon(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),!!me(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const e=this.context_,i=t.getOrientedFlatCoordinates();let n=0;const s=t.getEndss(),o=t.getStride();e.beginPath();for(let a=0,l=s.length;a<l;++a){const h=s[a];n=this.drawRings_(i,n,h,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(this.text_!==""){const e=t.getFlatInteriorPoints();this.drawText_(e,0,e.length,2)}}}setContextFillState_(t){const e=this.context_,i=this.contextFillState_;i?i.fillStyle!=t.fillStyle&&(i.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}setContextStrokeState_(t){const e=this.context_,i=this.contextStrokeState_;i?(i.lineCap!=t.lineCap&&(i.lineCap=t.lineCap,e.lineCap=t.lineCap),Li(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash),i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset),i.lineJoin!=t.lineJoin&&(i.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),i.lineWidth!=t.lineWidth&&(i.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),i.miterLimit!=t.miterLimit&&(i.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset,e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}setContextTextState_(t){const e=this.context_,i=this.contextTextState_,n=t.textAlign?t.textAlign:_n;i?(i.font!=t.font&&(i.font=t.font,e.font=t.font),i.textAlign!=n&&(i.textAlign=n,e.textAlign=n),i.textBaseline!=t.textBaseline&&(i.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}setFillStrokeStyle(t,e){if(!t)this.fillState_=null;else{const i=t.getColor();this.fillState_={fillStyle:ke(i||Qe)}}if(!e)this.strokeState_=null;else{const i=e.getColor(),n=e.getLineCap(),s=e.getLineDash(),o=e.getLineDashOffset(),a=e.getLineJoin(),l=e.getWidth(),h=e.getMiterLimit(),u=s||fn;this.strokeState_={lineCap:n!==void 0?n:Jn,lineDash:this.pixelRatio_===1?u:u.map(g=>g*this.pixelRatio_),lineDashOffset:(o||gn)*this.pixelRatio_,lineJoin:a!==void 0?a:Zi,lineWidth:(l!==void 0?l:yn)*this.pixelRatio_,miterLimit:h!==void 0?h:pn,strokeStyle:ke(i||mn)}}}setImageStyle(t){let e;if(!t||!(e=t.getSize())){this.image_=null;return}const i=t.getPixelRatio(this.pixelRatio_),n=t.getAnchor(),s=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=n[0]*i,this.imageAnchorY_=n[1]*i,this.imageHeight_=e[1]*i,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=s[0],this.imageOriginY_=s[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation();const o=t.getScaleArray();this.imageScale_=[o[0]*this.pixelRatio_/i,o[1]*this.pixelRatio_/i],this.imageWidth_=e[0]*i}setTextStyle(t){if(!t)this.text_="";else{const e=t.getFill();if(!e)this.textFillState_=null;else{const y=e.getColor();this.textFillState_={fillStyle:ke(y||Qe)}}const i=t.getStroke();if(!i)this.textStrokeState_=null;else{const y=i.getColor(),w=i.getLineCap(),E=i.getLineDash(),v=i.getLineDashOffset(),x=i.getLineJoin(),S=i.getWidth(),R=i.getMiterLimit();this.textStrokeState_={lineCap:w!==void 0?w:Jn,lineDash:E||fn,lineDashOffset:v||gn,lineJoin:x!==void 0?x:Zi,lineWidth:S!==void 0?S:yn,miterLimit:R!==void 0?R:pn,strokeStyle:ke(y||mn)}}const n=t.getFont(),s=t.getOffsetX(),o=t.getOffsetY(),a=t.getRotateWithView(),l=t.getRotation(),h=t.getScaleArray(),u=t.getText(),g=t.getTextAlign(),m=t.getTextBaseline();this.textState_={font:n!==void 0?n:Ko,textAlign:g!==void 0?g:_n,textBaseline:m!==void 0?m:Qn},this.text_=u!==void 0?Array.isArray(u)?u.reduce((y,w,E)=>y+=E%2?" ":w,""):u:"",this.textOffsetX_=s!==void 0?this.pixelRatio_*s:0,this.textOffsetY_=o!==void 0?this.pixelRatio_*o:0,this.textRotateWithView_=a!==void 0?a:!1,this.textRotation_=l!==void 0?l:0,this.textScale_=[this.pixelRatio_*h[0],this.pixelRatio_*h[1]]}}}const De=.5;function Kc(r,t,e,i,n,s,o){const a=r[0]*De,l=r[1]*De,h=xe(a,l);h.imageSmoothingEnabled=!1;const u=h.canvas,g=new $c(h,De,n,null,o),m=e.length,y=Math.floor((256*256*256-1)/m),w={};for(let v=1;v<=m;++v){const x=e[v-1],S=x.getStyleFunction()||i;if(!i)continue;let R=S(x,s);if(!R)continue;Array.isArray(R)||(R=[R]);const k="#"+("000000"+(v*y).toString(16)).slice(-6);for(let F=0,W=R.length;F<W;++F){const H=R[F],N=H.getGeometryFunction()(x);if(!N||!me(n,N.getExtent()))continue;const z=H.clone(),I=z.getFill();I&&I.setColor(k);const L=z.getStroke();L&&(L.setColor(k),L.setLineDash(null)),z.setText(void 0);const U=H.getImage();if(U&&U.getOpacity()!==0){const P=U.getImageSize();if(!P)continue;const X=xe(P[0],P[1],void 0,{alpha:!1}),M=X.canvas;X.fillStyle=k,X.fillRect(0,0,M.width,M.height),z.setImage(new yr({img:M,imgSize:P,anchor:U.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:U.getOrigin(),opacity:1,size:U.getSize(),scale:U.getScale(),rotation:U.getRotation(),rotateWithView:U.getRotateWithView()}))}const J=z.getZIndex()||0;let Y=w[J];Y||(Y={},w[J]=Y,Y.Polygon=[],Y.Circle=[],Y.LineString=[],Y.Point=[]),Y[N.getType().replace("Multi","")].push(N,z)}}const E=Object.keys(w).map(Number).sort($i);for(let v=0,x=E.length;v<x;++v){const S=w[E[v]];for(const R in S){const O=S[R];for(let k=0,F=O.length;k<F;k+=2){g.setStyle(O[k+1]);for(let W=0,H=t.length;W<H;++W)g.setTransform(t[W]),g.drawGeometry(O[k])}}}return h.getImageData(0,0,u.width,u.height)}function Zc(r,t,e){const i=[];if(e){const n=Math.floor(Math.round(r[0])*De),s=Math.floor(Math.round(r[1])*De),o=(Zt(n,0,e.width-1)+Zt(s,0,e.height-1)*e.width)*4,a=e.data[o],l=e.data[o+1],u=e.data[o+2]+256*(l+256*a),g=Math.floor((256*256*256-1)/t.length);u&&u%g===0&&i.push(t[u/g-1])}return i}const Jc=.5,Ra={Point:ah,LineString:rh,Polygon:ch,MultiPoint:lh,MultiLineString:sh,MultiPolygon:oh,GeometryCollection:nh,Circle:eh};function Qc(r,t){return parseInt(Lt(r),10)-parseInt(Lt(t),10)}function th(r,t){const e=es(r,t);return e*e}function es(r,t){return Jc*r/t}function eh(r,t,e,i,n){const s=e.getFill(),o=e.getStroke();if(s||o){const l=r.getBuilder(e.getZIndex(),"Circle");l.setFillStrokeStyle(s,o),l.drawCircle(t,i)}const a=e.getText();if(a&&a.getText()){const l=(n||r).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}}function To(r,t,e,i,n,s,o){let a=!1;const l=e.getImage();if(l){const h=l.getImageState();h==te.LOADED||h==te.ERROR?l.unlistenImageChange(n):(h==te.IDLE&&l.load(),l.listenImageChange(n),a=!0)}return ih(r,t,e,i,s,o),a}function ih(r,t,e,i,n,s){const o=e.getGeometryFunction()(t);if(!o)return;const a=o.simplifyTransformed(i,n);if(e.getRenderer())ba(r,a,e,t);else{const h=Ra[a.getType()];h(r,a,e,t,s)}}function ba(r,t,e,i){if(t.getType()=="GeometryCollection"){const s=t.getGeometries();for(let o=0,a=s.length;o<a;++o)ba(r,s[o],e,i);return}r.getBuilder(e.getZIndex(),"Default").drawCustom(t,i,e.getRenderer(),e.getHitDetectionRenderer())}function nh(r,t,e,i,n){const s=t.getGeometriesArray();let o,a;for(o=0,a=s.length;o<a;++o){const l=Ra[s[o].getType()];l(r,s[o],e,i,n)}}function rh(r,t,e,i,n){const s=e.getStroke();if(s){const a=r.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawLineString(t,i)}const o=e.getText();if(o&&o.getText()){const a=(n||r).getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}}function sh(r,t,e,i,n){const s=e.getStroke();if(s){const a=r.getBuilder(e.getZIndex(),"LineString");a.setFillStrokeStyle(null,s),a.drawMultiLineString(t,i)}const o=e.getText();if(o&&o.getText()){const a=(n||r).getBuilder(e.getZIndex(),"Text");a.setTextStyle(o),a.drawText(t,i)}}function oh(r,t,e,i,n){const s=e.getFill(),o=e.getStroke();if(o||s){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawMultiPolygon(t,i)}const a=e.getText();if(a&&a.getText()){const l=(n||r).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}}function ah(r,t,e,i,n){const s=e.getImage(),o=e.getText();let a;if(s){if(s.getImageState()!=te.LOADED)return;let l=r;if(n){const u=s.getDeclutterMode();if(u!=="none")if(l=n,u==="obstacle"){const g=r.getBuilder(e.getZIndex(),"Image");g.setImageStyle(s,a),g.drawPoint(t,i)}else o&&o.getText()&&(a={})}const h=l.getBuilder(e.getZIndex(),"Image");h.setImageStyle(s,a),h.drawPoint(t,i)}if(o&&o.getText()){let l=r;n&&(l=n);const h=l.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(t,i)}}function lh(r,t,e,i,n){const s=e.getImage(),o=e.getText();let a;if(s){if(s.getImageState()!=te.LOADED)return;let l=r;if(n){const u=s.getDeclutterMode();if(u!=="none")if(l=n,u==="obstacle"){const g=r.getBuilder(e.getZIndex(),"Image");g.setImageStyle(s,a),g.drawMultiPoint(t,i)}else o&&o.getText()&&(a={})}const h=l.getBuilder(e.getZIndex(),"Image");h.setImageStyle(s,a),h.drawMultiPoint(t,i)}if(o&&o.getText()){let l=r;n&&(l=n);const h=l.getBuilder(e.getZIndex(),"Text");h.setTextStyle(o,a),h.drawText(t,i)}}function ch(r,t,e,i,n){const s=e.getFill(),o=e.getStroke();if(s||o){const l=r.getBuilder(e.getZIndex(),"Polygon");l.setFillStrokeStyle(s,o),l.drawPolygon(t,i)}const a=e.getText();if(a&&a.getText()){const l=(n||r).getBuilder(e.getZIndex(),"Text");l.setTextStyle(a),l.drawText(t,i)}}class hh extends Ta{constructor(t){super(t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=Ce(),this.wrappedRenderedExtent_=Ce(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(t,e,i){const n=e.extent,s=e.viewState,o=s.center,a=s.resolution,l=s.projection,h=s.rotation,u=l.getExtent(),g=this.getLayer().getSource(),m=e.pixelRatio,y=e.viewHints,w=!(y[de.ANIMATING]||y[de.INTERACTING]),E=this.compositionContext_,v=Math.round(e.size[0]*m),x=Math.round(e.size[1]*m),S=g.getWrapX()&&l.canWrapX(),R=S?Ut(u):null,O=S?Math.ceil((n[2]-u[2])/R)+1:1;let k=S?Math.floor((n[0]-u[0])/R):0;do{const F=this.getRenderTransform(o,a,h,m,v,x,k*R);t.execute(E,1,F,h,w,void 0,i)}while(++k<O)}setupCompositionContext_(){if(this.opacity_!==1){const t=xe(this.context.canvas.width,this.context.canvas.height,Eo);this.compositionContext_=t}else this.compositionContext_=this.context}releaseCompositionContext_(){if(this.opacity_!==1){const t=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=t,Ho(this.compositionContext_),Eo.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(t){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,t,t.declutterTree),this.releaseCompositionContext_())}renderFrame(t,e){const i=t.pixelRatio,n=t.layerStatesArray[t.layerIndex];kl(this.pixelTransform,1/i,1/i),ms(this.inversePixelTransform,this.pixelTransform);const s=Qo(this.pixelTransform);this.useContainer(e,s,this.getBackground(t));const o=this.context,a=o.canvas,l=this.replayGroup_,h=this.declutterExecutorGroup;if((!l||l.isEmpty())&&(!h||h.isEmpty()))return null;const u=Math.round(t.size[0]*i),g=Math.round(t.size[1]*i);a.width!=u||a.height!=g?(a.width=u,a.height=g,a.style.transform!==s&&(a.style.transform=s)):this.containerReused||o.clearRect(0,0,u,g),this.preRender(o,t);const m=t.viewState,y=m.projection;this.opacity_=n.opacity,this.setupCompositionContext_();let w=!1,E=!0;if(n.extent&&this.clipping){const v=xi(n.extent,y);E=me(v,t.extent),w=E&&!Yi(v,t.extent),w&&this.clipUnrotated(this.compositionContext_,t,v)}return E&&this.renderWorlds(l,t),w&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(o,t),this.renderedRotation_!==m.rotation&&(this.renderedRotation_=m.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(t){return new Promise((function(e){if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const i=[this.context.canvas.width,this.context.canvas.height];oe(this.pixelTransform,i);const n=this.renderedCenter_,s=this.renderedResolution_,o=this.renderedRotation_,a=this.renderedProjection_,l=this.wrappedRenderedExtent_,h=this.getLayer(),u=[],g=i[0]*De,m=i[1]*De;u.push(this.getRenderTransform(n,s,o,De,g,m,0).slice());const y=h.getSource(),w=a.getExtent();if(y.getWrapX()&&a.canWrapX()&&!Yi(w,l)){let E=l[0];const v=Ut(w);let x=0,S;for(;E<w[0];)--x,S=v*x,u.push(this.getRenderTransform(n,s,o,De,g,m,S).slice()),E+=v;for(x=0,E=l[2];E>w[2];)++x,S=v*x,u.push(this.getRenderTransform(n,s,o,De,g,m,S).slice()),E-=v}this.hitDetectionImageData_=Kc(i,u,this.renderedFeatures_,h.getStyleFunction(),l,s,o)}e(Zc(t,this.renderedFeatures_,this.hitDetectionImageData_))}).bind(this))}forEachFeatureAtCoordinate(t,e,i,n,s){if(!this.replayGroup_)return;const o=e.viewState.resolution,a=e.viewState.rotation,l=this.getLayer(),h={},u=function(y,w,E){const v=Lt(y),x=h[v];if(x){if(x!==!0&&E<x.distanceSq){if(E===0)return h[v]=!0,s.splice(s.lastIndexOf(x),1),n(y,l,w);x.geometry=w,x.distanceSq=E}}else{if(E===0)return h[v]=!0,n(y,l,w);s.push(h[v]={feature:y,layer:l,geometry:w,distanceSq:E,callback:n})}};let g;const m=[this.replayGroup_];return this.declutterExecutorGroup&&m.push(this.declutterExecutorGroup),m.some(y=>g=y.forEachFeatureAtCoordinate(t,o,a,i,u,y===this.declutterExecutorGroup&&e.declutterTree?e.declutterTree.all().map(w=>w.value):null)),g}handleFontsChanged(){const t=this.getLayer();t.getVisible()&&this.replayGroup_&&t.changed()}handleStyleImageChange_(t){this.renderIfReadyAndVisible()}prepareFrame(t){const e=this.getLayer(),i=e.getSource();if(!i)return!1;const n=t.viewHints[de.ANIMATING],s=t.viewHints[de.INTERACTING],o=e.getUpdateWhileAnimating(),a=e.getUpdateWhileInteracting();if(this.ready&&!o&&n||!a&&s)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const l=t.extent,h=t.viewState,u=h.projection,g=h.resolution,m=t.pixelRatio,y=e.getRevision(),w=e.getRenderBuffer();let E=e.getRenderOrder();E===void 0&&(E=Qc);const v=h.center.slice(),x=as(l,w*g),S=x.slice(),R=[x.slice()],O=u.getExtent();if(i.getWrapX()&&u.canWrapX()&&!Yi(O,t.extent)){const P=Ut(O),X=Math.max(Ut(x)/2,P);x[0]=O[0]-X,x[2]=O[2]+X,ea(v,u);const M=Xo(R[0],u);M[0]<O[0]&&M[2]<O[2]?R.push([M[0]+P,M[1],M[2]+P,M[3]]):M[0]>O[0]&&M[2]>O[2]&&R.push([M[0]-P,M[1],M[2]-P,M[3]])}if(this.ready&&this.renderedResolution_==g&&this.renderedRevision_==y&&this.renderedRenderOrder_==E&&Yi(this.wrappedRenderedExtent_,x))return Li(this.renderedExtent_,S)||(this.hitDetectionImageData_=null,this.renderedExtent_=S),this.renderedCenter_=v,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const k=new yo(es(g,m),x,g,m);let F;this.getLayer().getDeclutter()&&(F=new yo(es(g,m),x,g,m));const W=ra();let H;if(W){for(let P=0,X=R.length;P<X;++P){const M=R[P],B=Zr(M,u);i.loadFeatures(B,nc(g,u),W)}H=Er(W,u)}else for(let P=0,X=R.length;P<X;++P)i.loadFeatures(R[P],g,u);const N=th(g,m);let z=!0;const I=(function(P){let X;const M=P.getStyleFunction()||e.getStyleFunction();if(M&&(X=M(P,g)),X){const B=this.renderFeature(P,N,X,k,H,F);z=z&&!B}}).bind(this),L=Zr(x,u),U=i.getFeaturesInExtent(L);E&&U.sort(E);for(let P=0,X=U.length;P<X;++P)I(U[P]);this.renderedFeatures_=U,this.ready=z;const J=k.finish(),Y=new xo(x,g,m,i.getOverlaps(),J,e.getRenderBuffer());return F&&(this.declutterExecutorGroup=new xo(x,g,m,i.getOverlaps(),F.finish(),e.getRenderBuffer())),this.renderedResolution_=g,this.renderedRevision_=y,this.renderedRenderOrder_=E,this.renderedExtent_=S,this.wrappedRenderedExtent_=x,this.renderedCenter_=v,this.renderedProjection_=u,this.replayGroup_=Y,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(t,e,i,n,s,o){if(!i)return!1;let a=!1;if(Array.isArray(i))for(let l=0,h=i.length;l<h;++l)a=To(n,t,i[l],e,this.boundHandleStyleImageChange_,s,o)||a;else a=To(n,t,i,e,this.boundHandleStyleImageChange_,s,o);return a}}class As extends kc{constructor(t){super(t)}createRenderer(){return new hh(this)}}class Ro{constructor(t){this.rbush_=new wa(t),this.items_={}}insert(t,e){const i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i),this.items_[Lt(e)]=i}load(t,e){const i=new Array(e.length);for(let n=0,s=e.length;n<s;n++){const o=t[n],a=e[n],l={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:a};i[n]=l,this.items_[Lt(a)]=l}this.rbush_.load(i)}remove(t){const e=Lt(t),i=this.items_[e];return delete this.items_[e],this.rbush_.remove(i)!==null}update(t,e){const i=this.items_[Lt(e)],n=[i.minX,i.minY,i.maxX,i.maxY];un(n,t)||(this.remove(e),this.insert(t,e))}getAll(){return this.rbush_.all().map(function(e){return e.value})}getInExtent(t){const e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(n){return n.value})}forEach(t){return this.forEach_(this.getAll(),t)}forEachInExtent(t,e){return this.forEach_(this.getInExtent(t),e)}forEach_(t,e){let i;for(let n=0,s=t.length;n<s;n++)if(i=e(t[n]),i)return i;return i}isEmpty(){return Ki(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(t){const e=this.rbush_.toJSON();return Ue(e.minX,e.minY,e.maxX,e.maxY,t)}concat(t){this.rbush_.load(t.rbush_.all());for(const e in t.items_)this.items_[e]=t.items_[e]}}class Ca extends Xe{constructor(t){super(),this.projection=Bt(t.projection),this.attributions_=bo(t.attributions),this.attributionsCollapsible_=t.attributionsCollapsible!==void 0?t.attributionsCollapsible:!0,this.loading=!1,this.state_=t.state!==void 0?t.state:"ready",this.wrapX_=t.wrapX!==void 0?t.wrapX:!1,this.interpolate_=!!t.interpolate,this.viewResolver=null,this.viewRejector=null;const e=this;this.viewPromise_=new Promise(function(i,n){e.viewResolver=i,e.viewRejector=n})}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(){return gt()}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(t){this.attributions_=bo(t),this.changed()}setState(t){this.state_=t,this.changed()}}function bo(r){return r?Array.isArray(r)?function(t){return r}:typeof r=="function"?r:function(t){return[r]}:null}const Ne={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature",FEATURESLOADSTART:"featuresloadstart",FEATURESLOADEND:"featuresloadend",FEATURESLOADERROR:"featuresloaderror"};function uh(r,t){return[[-1/0,-1/0,1/0,1/0]]}let dh=!1;function fh(r,t,e,i,n,s,o){const a=new XMLHttpRequest;a.open("GET",typeof r=="function"?r(e,i,n):r,!0),t.getType()=="arraybuffer"&&(a.responseType="arraybuffer"),a.withCredentials=dh,a.onload=function(l){if(!a.status||a.status>=200&&a.status<300){const h=t.getType();let u;h=="json"||h=="text"?u=a.responseText:h=="xml"?(u=a.responseXML,u||(u=new DOMParser().parseFromString(a.responseText,"application/xml"))):h=="arraybuffer"&&(u=a.response),u?s(t.readFeatures(u,{extent:e,featureProjection:n}),t.readProjection(u)):o()}else o()},a.onerror=o,a.send()}function Co(r,t){return function(e,i,n,s,o){const a=this;fh(r,t,e,i,n,function(l,h){a.addFeatures(l),s!==void 0&&s(l)},o||Ii)}}class ri extends ti{constructor(t,e,i){super(t),this.feature=e,this.features=i}}class Sa extends Ca{constructor(t){t=t||{},super({attributions:t.attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:t.wrapX!==void 0?t.wrapX:!0}),this.on,this.once,this.un,this.loader_=Ii,this.format_=t.format,this.overlaps_=t.overlaps===void 0?!0:t.overlaps,this.url_=t.url,t.loader!==void 0?this.loader_=t.loader:this.url_!==void 0&&(xt(this.format_,7),this.loader_=Co(this.url_,this.format_)),this.strategy_=t.strategy!==void 0?t.strategy:uh;const e=t.useSpatialIndex!==void 0?t.useSpatialIndex:!0;this.featuresRtree_=e?new Ro:null,this.loadedExtentsRtree_=new Ro,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null;let i,n;Array.isArray(t.features)?n=t.features:t.features&&(i=t.features,n=i.getArray()),!e&&i===void 0&&(i=new Fe(n)),n!==void 0&&this.addFeaturesInternal(n),i!==void 0&&this.bindFeaturesCollection_(i)}addFeature(t){this.addFeatureInternal(t),this.changed()}addFeatureInternal(t){const e=Lt(t);if(!this.addToIndex_(e,t)){this.featuresCollection_&&this.featuresCollection_.remove(t);return}this.setupChangeEvents_(e,t);const i=t.getGeometry();if(i){const n=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(n,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new ri(Ne.ADDFEATURE,t))}setupChangeEvents_(t,e){this.featureChangeKeys_[t]=[St(e,yt.CHANGE,this.handleFeatureChange_,this),St(e,Hi.PROPERTYCHANGE,this.handleFeatureChange_,this)]}addToIndex_(t,e){let i=!0;const n=e.getId();return n!==void 0&&(n.toString()in this.idIndex_?i=!1:this.idIndex_[n.toString()]=e),i&&(xt(!(t in this.uidIndex_),30),this.uidIndex_[t]=e),i}addFeatures(t){this.addFeaturesInternal(t),this.changed()}addFeaturesInternal(t){const e=[],i=[],n=[];for(let s=0,o=t.length;s<o;s++){const a=t[s],l=Lt(a);this.addToIndex_(l,a)&&i.push(a)}for(let s=0,o=i.length;s<o;s++){const a=i[s],l=Lt(a);this.setupChangeEvents_(l,a);const h=a.getGeometry();if(h){const u=h.getExtent();e.push(u),n.push(a)}else this.nullGeometryFeatures_[l]=a}if(this.featuresRtree_&&this.featuresRtree_.load(e,n),this.hasListener(Ne.ADDFEATURE))for(let s=0,o=i.length;s<o;s++)this.dispatchEvent(new ri(Ne.ADDFEATURE,i[s]))}bindFeaturesCollection_(t){let e=!1;this.addEventListener(Ne.ADDFEATURE,function(i){e||(e=!0,t.push(i.feature),e=!1)}),this.addEventListener(Ne.REMOVEFEATURE,function(i){e||(e=!0,t.remove(i.feature),e=!1)}),t.addEventListener(_e.ADD,(function(i){e||(e=!0,this.addFeature(i.element),e=!1)}).bind(this)),t.addEventListener(_e.REMOVE,(function(i){e||(e=!0,this.removeFeature(i.element),e=!1)}).bind(this)),this.featuresCollection_=t}clear(t){if(t){for(const i in this.featureChangeKeys_)this.featureChangeKeys_[i].forEach(qt);this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const i=(function(n){this.removeFeatureInternal(n)}).bind(this);this.featuresRtree_.forEach(i);for(const n in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[n])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const e=new ri(Ne.CLEAR);this.dispatchEvent(e),this.changed()}forEachFeature(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)}forEachFeatureAtCoordinateDirect(t,e){const i=[t[0],t[1],t[0],t[1]];return this.forEachFeatureInExtent(i,function(n){if(n.getGeometry().intersectsCoordinate(t))return e(n)})}forEachFeatureInExtent(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)}forEachFeatureIntersectingExtent(t,e){return this.forEachFeatureInExtent(t,function(i){if(i.getGeometry().intersectsExtent(t)){const s=e(i);if(s)return s}})}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let t;return this.featuresCollection_?t=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(t=this.featuresRtree_.getAll(),Ki(this.nullGeometryFeatures_)||Je(t,Object.values(this.nullGeometryFeatures_))),t}getFeaturesAtCoordinate(t){const e=[];return this.forEachFeatureAtCoordinateDirect(t,function(i){e.push(i)}),e}getFeaturesInExtent(t,e){if(this.featuresRtree_){if(!(e&&e.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(t);const n=Qa(t,e);return[].concat(...n.map(s=>this.featuresRtree_.getInExtent(s)))}else return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(t,e){const i=t[0],n=t[1];let s=null;const o=[NaN,NaN];let a=1/0;const l=[-1/0,-1/0,1/0,1/0];return e=e||dn,this.featuresRtree_.forEachInExtent(l,function(h){if(e(h)){const u=h.getGeometry(),g=a;if(a=u.closestPointXY(i,n,o,a),a<g){s=h;const m=Math.sqrt(a);l[0]=i-m,l[1]=n-m,l[2]=i+m,l[3]=n+m}}}),s}getExtent(t){return this.featuresRtree_.getExtent(t)}getFeatureById(t){const e=this.idIndex_[t.toString()];return e!==void 0?e:null}getFeatureByUid(t){const e=this.uidIndex_[t];return e!==void 0?e:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(t){const e=t.target,i=Lt(e),n=e.getGeometry();if(!n)i in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(e),this.nullGeometryFeatures_[i]=e);else{const o=n.getExtent();i in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[i],this.featuresRtree_&&this.featuresRtree_.insert(o,e)):this.featuresRtree_&&this.featuresRtree_.update(o,e)}const s=e.getId();if(s!==void 0){const o=s.toString();this.idIndex_[o]!==e&&(this.removeFromIdIndex_(e),this.idIndex_[o]=e)}else this.removeFromIdIndex_(e),this.uidIndex_[i]=e;this.changed(),this.dispatchEvent(new ri(Ne.CHANGEFEATURE,e))}hasFeature(t){const e=t.getId();return e!==void 0?e in this.idIndex_:Lt(t)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&Ki(this.nullGeometryFeatures_):this.featuresCollection_?this.featuresCollection_.getLength()===0:!0}loadFeatures(t,e,i){const n=this.loadedExtentsRtree_,s=this.strategy_(t,e,i);for(let o=0,a=s.length;o<a;++o){const l=s[o];n.forEachInExtent(l,function(u){return Yi(u.extent,l)})||(++this.loadingExtentsCount_,this.dispatchEvent(new ri(Ne.FEATURESLOADSTART)),this.loader_.call(this,l,e,i,(function(u){--this.loadingExtentsCount_,this.dispatchEvent(new ri(Ne.FEATURESLOADEND,void 0,u))}).bind(this),(function(){--this.loadingExtentsCount_,this.dispatchEvent(new ri(Ne.FEATURESLOADERROR))}).bind(this)),n.insert(l,{extent:l.slice()}))}this.loading=this.loader_.length<4?!1:this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(t){const e=this.loadedExtentsRtree_;let i;e.forEachInExtent(t,function(n){if(un(n.extent,t))return i=n,!0}),i&&e.remove(i)}removeFeature(t){if(!t)return;const e=Lt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t),this.removeFeatureInternal(t)&&this.changed()}removeFeatureInternal(t){const e=Lt(t),i=this.featureChangeKeys_[e];if(!i)return;i.forEach(qt),delete this.featureChangeKeys_[e];const n=t.getId();return n!==void 0&&delete this.idIndex_[n.toString()],delete this.uidIndex_[e],this.dispatchEvent(new ri(Ne.REMOVEFEATURE,t)),t}removeFromIdIndex_(t){let e=!1;for(const i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i],e=!0;break}return e}setLoader(t){this.loader_=t}setUrl(t){xt(this.format_,7),this.url_=t,this.setLoader(Co(t,this.format_))}}class li extends ti{constructor(t,e){super(t),this.layer=e}}const Or={LAYERS:"layers"};class tn extends ya{constructor(t){t=t||{};const e=Object.assign({},t);delete e.layers;let i=t.layers;super(e),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Or.LAYERS,this.handleLayersChanged_),i?Array.isArray(i)?i=new Fe(i.slice(),{unique:!0}):xt(typeof i.getArray=="function",43):i=new Fe(void 0,{unique:!0}),this.setLayers(i)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(qt),this.layersListenerKeys_.length=0;const t=this.getLayers();this.layersListenerKeys_.push(St(t,_e.ADD,this.handleLayersAdd_,this),St(t,_e.REMOVE,this.handleLayersRemove_,this));for(const i in this.listenerKeys_)this.listenerKeys_[i].forEach(qt);Cn(this.listenerKeys_);const e=t.getArray();for(let i=0,n=e.length;i<n;i++){const s=e[i];this.registerLayerListeners_(s),this.dispatchEvent(new li("addlayer",s))}this.changed()}registerLayerListeners_(t){const e=[St(t,Hi.PROPERTYCHANGE,this.handleLayerChange_,this),St(t,yt.CHANGE,this.handleLayerChange_,this)];t instanceof tn&&e.push(St(t,"addlayer",this.handleLayerGroupAdd_,this),St(t,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[Lt(t)]=e}handleLayerGroupAdd_(t){this.dispatchEvent(new li("addlayer",t.layer))}handleLayerGroupRemove_(t){this.dispatchEvent(new li("removelayer",t.layer))}handleLayersAdd_(t){const e=t.element;this.registerLayerListeners_(e),this.dispatchEvent(new li("addlayer",e)),this.changed()}handleLayersRemove_(t){const e=t.element,i=Lt(e);this.listenerKeys_[i].forEach(qt),delete this.listenerKeys_[i],this.dispatchEvent(new li("removelayer",e)),this.changed()}getLayers(){return this.get(Or.LAYERS)}setLayers(t){const e=this.getLayers();if(e){const i=e.getArray();for(let n=0,s=i.length;n<s;++n)this.dispatchEvent(new li("removelayer",i[n]))}this.set(Or.LAYERS,t)}getLayersArray(t){return t=t!==void 0?t:[],this.getLayers().forEach(function(e){e.getLayersArray(t)}),t}getLayerStatesArray(t){const e=t!==void 0?t:[],i=e.length;this.getLayers().forEach(function(o){o.getLayerStatesArray(e)});const n=this.getLayerState();let s=n.zIndex;!t&&n.zIndex===void 0&&(s=0);for(let o=i,a=e.length;o<a;o++){const l=e[o];l.opacity*=n.opacity,l.visible=l.visible&&n.visible,l.maxResolution=Math.min(l.maxResolution,n.maxResolution),l.minResolution=Math.max(l.minResolution,n.minResolution),l.minZoom=Math.max(l.minZoom,n.minZoom),l.maxZoom=Math.min(l.maxZoom,n.maxZoom),n.extent!==void 0&&(l.extent!==void 0?l.extent=cn(l.extent,n.extent):l.extent=n.extent),l.zIndex===void 0&&(l.zIndex=s)}return e}getSourceState(){return"ready"}}class gh{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let i=e.dataProjection?Bt(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()==="tile-pixels"&&(i=Bt(i),i.setWorldExtent(e.extent)),e={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}getType(){return gt()}readFeature(t,e){return gt()}readFeatures(t,e){return gt()}readGeometry(t,e){return gt()}readProjection(t){return gt()}writeFeature(t,e){return gt()}writeFeatures(t,e){return gt()}writeGeometry(t,e){return gt()}}function Ia(r,t,e){const i=e?Bt(e.featureProjection):null,n=e?Bt(e.dataProjection):null;let s;if(i&&n&&!wi(i,n)?s=(t?r.clone():r).transform(t?i:n,t?n:i):s=r,t&&e&&e.decimals!==void 0){const o=Math.pow(10,e.decimals),a=function(l){for(let h=0,u=l.length;h<u;++h)l[h]=Math.round(l[h]*o)/o;return l};s===r&&(s=r.clone()),s.applyTransform(a)}return s}const dt={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4};function Aa(r){return Math.pow(r,3)}function en(r){return 1-Aa(1-r)}function ph(r){return 3*r*r-2*r*r*r}function mh(r){return r}class Oa extends pr{constructor(t,e,i){super(),i=i||{},this.tileCoord=t,this.state=e,this.interimTile=null,this.key="",this.transition_=i.transition===void 0?250:i.transition,this.transitionStarts_={},this.interpolate=!!i.interpolate}changed(){this.dispatchEvent(yt.CHANGE)}release(){this.state===dt.ERROR&&this.setState(dt.EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){if(!this.interimTile)return this;let t=this.interimTile;do{if(t.getState()==dt.LOADED)return this.transition_=0,t;t=t.interimTile}while(t);return this}refreshInterimChain(){if(!this.interimTile)return;let t=this.interimTile,e=this;do{if(t.getState()==dt.LOADED){t.interimTile=null;break}else t.getState()==dt.LOADING?e=t:t.getState()==dt.IDLE?e.interimTile=t.interimTile:e=t;t=e.interimTile}while(t)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(t){if(this.state!==dt.ERROR&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}load(){gt()}getAlpha(t,e){if(!this.transition_)return 1;let i=this.transitionStarts_[t];if(!i)i=e,this.transitionStarts_[t]=i;else if(i===-1)return 1;const n=e-i+1e3/60;return n>=this.transition_?1:Aa(n/this.transition_)}inTransition(t){return this.transition_?this.transitionStarts_[t]!==-1:!1}endTransition(t){this.transition_&&(this.transitionStarts_[t]=-1)}}class Ma extends Oa{constructor(t,e,i,n,s,o){super(t,e,o),this.crossOrigin_=n,this.src_=i,this.key=i,this.image_=new Image,n!==null&&(this.image_.crossOrigin=n),this.unlisten_=null,this.tileLoadFunction_=s}getImage(){return this.image_}setImage(t){this.image_=t,this.state=dt.LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=dt.ERROR,this.unlistenImage_(),this.image_=_h(),this.changed()}handleImageLoad_(){const t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=dt.LOADED:this.state=dt.EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==dt.ERROR&&(this.state=dt.IDLE,this.image_=new Image,this.crossOrigin_!==null&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==dt.IDLE&&(this.state=dt.LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=Jo(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}function _h(){const r=xe(1,1);return r.fillStyle="rgba(0,0,0,0)",r.fillRect(0,0,1,1),r.canvas}const yh=.5,Eh=10,So=.25;class wh{constructor(t,e,i,n,s,o){this.sourceProj_=t,this.targetProj_=e;let a={};const l=wn(this.targetProj_,this.sourceProj_);this.transformInv_=function(S){const R=S[0]+"/"+S[1];return a[R]||(a[R]=l(S)),a[R]},this.maxSourceExtent_=n,this.errorThresholdSquared_=s*s,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!n&&!!this.sourceProj_.getExtent()&&Ut(n)==Ut(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?Ut(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?Ut(this.targetProj_.getExtent()):null;const h=Mi(i),u=ur(i),g=hr(i),m=cr(i),y=this.transformInv_(h),w=this.transformInv_(u),E=this.transformInv_(g),v=this.transformInv_(m),x=Eh+(o?Math.max(0,Math.ceil(Math.log2(qr(i)/(o*o*256*256)))):0);if(this.addQuad_(h,u,g,m,y,w,E,v,x),this.wrapsXInSource_){let S=1/0;this.triangles_.forEach(function(R,O,k){S=Math.min(S,R.source[0][0],R.source[1][0],R.source[2][0])}),this.triangles_.forEach((function(R){if(Math.max(R.source[0][0],R.source[1][0],R.source[2][0])-S>this.sourceWorldWidth_/2){const O=[[R.source[0][0],R.source[0][1]],[R.source[1][0],R.source[1][1]],[R.source[2][0],R.source[2][1]]];O[0][0]-S>this.sourceWorldWidth_/2&&(O[0][0]-=this.sourceWorldWidth_),O[1][0]-S>this.sourceWorldWidth_/2&&(O[1][0]-=this.sourceWorldWidth_),O[2][0]-S>this.sourceWorldWidth_/2&&(O[2][0]-=this.sourceWorldWidth_);const k=Math.min(O[0][0],O[1][0],O[2][0]);Math.max(O[0][0],O[1][0],O[2][0])-k<this.sourceWorldWidth_/2&&(R.source=O)}}).bind(this))}a={}}addTriangle_(t,e,i,n,s,o){this.triangles_.push({source:[n,s,o],target:[t,e,i]})}addQuad_(t,e,i,n,s,o,a,l,h){const u=Gr([s,o,a,l]),g=this.sourceWorldWidth_?Ut(u)/this.sourceWorldWidth_:null,m=this.sourceWorldWidth_,y=this.sourceProj_.canWrapX()&&g>.5&&g<1;let w=!1;if(h>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const v=Gr([t,e,i,n]);w=Ut(v)/this.targetWorldWidth_>So||w}!y&&this.sourceProj_.isGlobal()&&g&&(w=g>So||w)}if(!w&&this.maxSourceExtent_&&isFinite(u[0])&&isFinite(u[1])&&isFinite(u[2])&&isFinite(u[3])&&!me(u,this.maxSourceExtent_))return;let E=0;if(!w&&(!isFinite(s[0])||!isFinite(s[1])||!isFinite(o[0])||!isFinite(o[1])||!isFinite(a[0])||!isFinite(a[1])||!isFinite(l[0])||!isFinite(l[1]))){if(h>0)w=!0;else if(E=(!isFinite(s[0])||!isFinite(s[1])?8:0)+(!isFinite(o[0])||!isFinite(o[1])?4:0)+(!isFinite(a[0])||!isFinite(a[1])?2:0)+(!isFinite(l[0])||!isFinite(l[1])?1:0),E!=1&&E!=2&&E!=4&&E!=8)return}if(h>0){if(!w){const v=[(t[0]+i[0])/2,(t[1]+i[1])/2],x=this.transformInv_(v);let S;y?S=(Vi(s[0],m)+Vi(a[0],m))/2-Vi(x[0],m):S=(s[0]+a[0])/2-x[0];const R=(s[1]+a[1])/2-x[1];w=S*S+R*R>this.errorThresholdSquared_}if(w){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){const v=[(e[0]+i[0])/2,(e[1]+i[1])/2],x=this.transformInv_(v),S=[(n[0]+t[0])/2,(n[1]+t[1])/2],R=this.transformInv_(S);this.addQuad_(t,e,v,S,s,o,x,R,h-1),this.addQuad_(S,v,i,n,R,x,a,l,h-1)}else{const v=[(t[0]+e[0])/2,(t[1]+e[1])/2],x=this.transformInv_(v),S=[(i[0]+n[0])/2,(i[1]+n[1])/2],R=this.transformInv_(S);this.addQuad_(t,v,S,n,s,x,R,l,h-1),this.addQuad_(v,e,i,S,x,o,a,R,h-1)}return}}if(y){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}E&11||this.addTriangle_(t,i,n,s,a,l),E&14||this.addTriangle_(t,i,e,s,a,o),E&&(E&13||this.addTriangle_(e,n,t,o,l,s),E&7||this.addTriangle_(e,n,i,o,l,a))}calculateSourceExtent(){const t=Ce();return this.triangles_.forEach(function(e,i,n){const s=e.source;ln(t,s[0]),ln(t,s[1]),ln(t,s[2])}),t}getTriangles(){return this.triangles_}}let Mr;const La=[];function Io(r,t,e,i,n){r.beginPath(),r.moveTo(0,0),r.lineTo(t,e),r.lineTo(i,n),r.closePath(),r.save(),r.clip(),r.fillRect(0,0,Math.max(t,i)+1,Math.max(e,n)),r.restore()}function Lr(r,t){return Math.abs(r[t*4]-210)>2||Math.abs(r[t*4+3]-.75*255)>2}function vh(){if(Mr===void 0){const r=document.createElement("canvas").getContext("2d");r.globalCompositeOperation="lighter",r.fillStyle="rgba(210, 0, 0, 0.75)",Io(r,4,5,4,0),Io(r,4,5,0,5);const t=r.getImageData(0,0,3,3).data;Mr=Lr(t,0)||Lr(t,4)||Lr(t,8)}return Mr}function Ao(r,t,e,i){const n=ws(e,t,r);let s=no(t,i,e);const o=t.getMetersPerUnit();o!==void 0&&(s*=o);const a=r.getMetersPerUnit();a!==void 0&&(s/=a);const l=r.getExtent();if(!l||lr(l,n)){const h=no(r,s,n)/s;isFinite(h)&&h>0&&(s/=h)}return s}function xh(r,t,e,i){const n=Si(e);let s=Ao(r,t,n,i);return(!isFinite(s)||s<=0)&&qo(e,function(o){return s=Ao(r,t,o,i),isFinite(s)&&s>0}),s}function Th(r,t,e,i,n,s,o,a,l,h,u,g){const m=xe(Math.round(e*r),Math.round(e*t),La);if(g||(m.imageSmoothingEnabled=!1),l.length===0)return m.canvas;m.scale(e,e);function y(O){return Math.round(O*e)/e}m.globalCompositeOperation="lighter";const w=Ce();l.forEach(function(O,k,F){Go(w,O.extent)});const E=Ut(w),v=qe(w),x=xe(Math.round(e*E/i),Math.round(e*v/i));g||(x.imageSmoothingEnabled=!1);const S=e/i;l.forEach(function(O,k,F){const W=O.extent[0]-w[0],H=-(O.extent[3]-w[3]),N=Ut(O.extent),z=qe(O.extent);O.image.width>0&&O.image.height>0&&x.drawImage(O.image,h,h,O.image.width-2*h,O.image.height-2*h,W*S,H*S,N*S,z*S)});const R=Mi(o);return a.getTriangles().forEach(function(O,k,F){const W=O.source,H=O.target;let N=W[0][0],z=W[0][1],I=W[1][0],L=W[1][1],U=W[2][0],J=W[2][1];const Y=y((H[0][0]-R[0])/s),P=y(-(H[0][1]-R[1])/s),X=y((H[1][0]-R[0])/s),M=y(-(H[1][1]-R[1])/s),B=y((H[2][0]-R[0])/s),Z=y(-(H[2][1]-R[1])/s),K=N,q=z;N=0,z=0,I-=K,L-=q,U-=K,J-=q;const Q=[[I,L,0,0,X-Y],[U,J,0,0,B-Y],[0,0,I,L,M-P],[0,0,U,J,Z-P]],lt=rl(Q);if(lt){if(m.save(),m.beginPath(),vh()||!g){m.moveTo(X,M);const nt=4,Gt=Y-X,Rt=P-M;for(let _t=0;_t<nt;_t++)m.lineTo(X+y((_t+1)*Gt/nt),M+y(_t*Rt/(nt-1))),_t!=nt-1&&m.lineTo(X+y((_t+1)*Gt/nt),M+y((_t+1)*Rt/(nt-1)));m.lineTo(B,Z)}else m.moveTo(X,M),m.lineTo(Y,P),m.lineTo(B,Z);m.clip(),m.transform(lt[0],lt[2],lt[1],lt[3],Y,P),m.translate(w[0]-K,w[3]-q),m.scale(i/e,-i/e),m.drawImage(x.canvas,0,0),m.restore()}}),u&&(m.save(),m.globalCompositeOperation="source-over",m.strokeStyle="black",m.lineWidth=1,a.getTriangles().forEach(function(O,k,F){const W=O.target,H=(W[0][0]-R[0])/s,N=-(W[0][1]-R[1])/s,z=(W[1][0]-R[0])/s,I=-(W[1][1]-R[1])/s,L=(W[2][0]-R[0])/s,U=-(W[2][1]-R[1])/s;m.beginPath(),m.moveTo(z,I),m.lineTo(H,N),m.lineTo(L,U),m.closePath(),m.stroke()}),m.restore()),m.canvas}class is extends Oa{constructor(t,e,i,n,s,o,a,l,h,u,g,m){super(s,dt.IDLE,{interpolate:!!m}),this.renderEdges_=g!==void 0?g:!1,this.pixelRatio_=a,this.gutter_=l,this.canvas_=null,this.sourceTileGrid_=e,this.targetTileGrid_=n,this.wrappedTileCoord_=o||s,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const y=n.getTileCoordExtent(this.wrappedTileCoord_),w=this.targetTileGrid_.getExtent();let E=this.sourceTileGrid_.getExtent();const v=w?cn(y,w):y;if(qr(v)===0){this.state=dt.EMPTY;return}const x=t.getExtent();x&&(E?E=cn(E,x):E=x);const S=n.getResolution(this.wrappedTileCoord_[0]),R=xh(t,i,v,S);if(!isFinite(R)||R<=0){this.state=dt.EMPTY;return}const O=u!==void 0?u:yh;if(this.triangulation_=new wh(t,i,v,E,R*O,S),this.triangulation_.getTriangles().length===0){this.state=dt.EMPTY;return}this.sourceZ_=e.getZForResolution(R);let k=this.triangulation_.calculateSourceExtent();if(E&&(t.canWrapX()?(k[1]=Zt(k[1],E[1],E[3]),k[3]=Zt(k[3],E[1],E[3])):k=cn(k,E)),!qr(k))this.state=dt.EMPTY;else{const F=e.getTileRangeForExtentAndZ(k,this.sourceZ_);for(let W=F.minX;W<=F.maxX;W++)for(let H=F.minY;H<=F.maxY;H++){const N=h(this.sourceZ_,W,H,a);N&&this.sourceTiles_.push(N)}this.sourceTiles_.length===0&&(this.state=dt.EMPTY)}}getImage(){return this.canvas_}reproject_(){const t=[];if(this.sourceTiles_.forEach((function(e,i,n){e&&e.getState()==dt.LOADED&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}).bind(this)),this.sourceTiles_.length=0,t.length===0)this.state=dt.ERROR;else{const e=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(e),n=typeof i=="number"?i:i[0],s=typeof i=="number"?i:i[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),l=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Th(n,s,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,l,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=dt.LOADED}this.changed()}load(){if(this.state==dt.IDLE){this.state=dt.LOADING,this.changed();let t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((function(e,i,n){const s=e.getState();if(s==dt.IDLE||s==dt.LOADING){t++;const o=St(e,yt.CHANGE,function(a){const l=e.getState();(l==dt.LOADED||l==dt.ERROR||l==dt.EMPTY)&&(qt(o),t--,t===0&&(this.unlistenSources_(),this.reproject_()))},this);this.sourcesListenerKeys_.push(o)}}).bind(this)),t===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function(e,i,n){e.getState()==dt.IDLE&&e.load()})}}unlistenSources_(){this.sourcesListenerKeys_.forEach(qt),this.sourcesListenerKeys_=null}release(){this.canvas_&&(Ho(this.canvas_.getContext("2d")),La.push(this.canvas_),this.canvas_=null),super.release()}}class Os{constructor(t,e,i,n){this.minX=t,this.maxX=e,this.minY=i,this.maxY=n}contains(t){return this.containsXY(t[1],t[2])}containsTileRange(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}containsXY(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}equals(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}extend(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}getHeight(){return this.maxY-this.minY+1}getSize(){return[this.getWidth(),this.getHeight()]}getWidth(){return this.maxX-this.minX+1}intersects(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}function Gi(r,t,e,i,n){return n!==void 0?(n.minX=r,n.maxX=t,n.minY=e,n.maxY=i,n):new Os(r,t,e,i)}class Rh extends Ta{constructor(t){super(t),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=Ce(),this.tmpTileRange_=new Os(0,0,0,0)}isDrawableTile(t){const e=this.getLayer(),i=t.getState(),n=e.getUseInterimTilesOnError();return i==dt.LOADED||i==dt.EMPTY||i==dt.ERROR&&!n}getTile(t,e,i,n){const s=n.pixelRatio,o=n.viewState.projection,a=this.getLayer();let h=a.getSource().getTile(t,e,i,s,o);return h.getState()==dt.ERROR&&a.getUseInterimTilesOnError()&&a.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(h)||(h=h.getInterimTile()),h}getData(t){const e=this.frameState;if(!e)return null;const i=this.getLayer(),n=oe(e.pixelToCoordinateTransform,t.slice()),s=i.getExtent();if(s&&!lr(s,n))return null;const o=e.pixelRatio,a=e.viewState.projection,l=e.viewState,h=i.getRenderSource(),u=h.getTileGridForProjection(l.projection),g=h.getTilePixelRatio(e.pixelRatio);for(let m=u.getZForResolution(l.resolution);m>=u.getMinZoom();--m){const y=u.getTileCoordForCoordAndZ(n,m),w=h.getTile(m,y[1],y[2],o,a);if(!(w instanceof Ma||w instanceof is)||w instanceof is&&w.getState()===dt.EMPTY)return null;if(w.getState()!==dt.LOADED)continue;const E=u.getOrigin(m),v=ve(u.getTileSize(m)),x=u.getResolution(m),S=Math.floor(g*((n[0]-E[0])/x-y[1]*v[0])),R=Math.floor(g*((E[1]-n[1])/x-y[2]*v[1])),O=Math.round(g*h.getGutterForProjection(l.projection));return this.getImageData(w.getImage(),S+O,R+O)}return null}loadedTileCallback(t,e,i){return this.isDrawableTile(i)?super.loadedTileCallback(t,e,i):!1}prepareFrame(t){return!!this.getLayer().getSource()}renderFrame(t,e){const i=t.layerStatesArray[t.layerIndex],n=t.viewState,s=n.projection,o=n.resolution,a=n.center,l=n.rotation,h=t.pixelRatio,u=this.getLayer(),g=u.getSource(),m=g.getRevision(),y=g.getTileGridForProjection(s),w=y.getZForResolution(o,g.zDirection),E=y.getResolution(w);let v=t.extent;const x=t.viewState.resolution,S=g.getTilePixelRatio(h),R=Math.round(Ut(v)/x*h),O=Math.round(qe(v)/x*h),k=i.extent&&xi(i.extent,s);k&&(v=cn(v,xi(i.extent,s)));const F=E*R/2/S,W=E*O/2/S,H=[a[0]-F,a[1]-W,a[0]+F,a[1]+W],N=y.getTileRangeForExtentAndZ(v,w),z={};z[w]={};const I=this.createLoadedTileFinder(g,s,z),L=this.tmpExtent,U=this.tmpTileRange_;this.newTiles_=!1;const J=l?jr(n.center,x,l,t.size):void 0;for(let Q=N.minX;Q<=N.maxX;++Q)for(let lt=N.minY;lt<=N.maxY;++lt){if(l&&!y.tileCoordIntersectsViewport([w,Q,lt],J))continue;const nt=this.getTile(w,Q,lt,t);if(this.isDrawableTile(nt)){const _t=Lt(this);if(nt.getState()==dt.LOADED){z[w][nt.tileCoord.toString()]=nt;let mt=nt.inTransition(_t);mt&&i.opacity!==1&&(nt.endTransition(_t),mt=!1),!this.newTiles_&&(mt||!this.renderedTiles.includes(nt))&&(this.newTiles_=!0)}if(nt.getAlpha(_t,t.time)===1)continue}const Gt=y.getTileCoordChildTileRange(nt.tileCoord,U,L);let Rt=!1;Gt&&(Rt=I(w+1,Gt)),Rt||y.forEachTileCoordParentTileRange(nt.tileCoord,I,U,L)}const Y=E/o*h/S;pi(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/h,1/h,l,-R/2,-O/2);const P=Qo(this.pixelTransform);this.useContainer(e,P,this.getBackground(t));const X=this.context,M=X.canvas;ms(this.inversePixelTransform,this.pixelTransform),pi(this.tempTransform,R/2,O/2,Y,Y,0,-R/2,-O/2),M.width!=R||M.height!=O?(M.width=R,M.height=O):this.containerReused||X.clearRect(0,0,R,O),k&&this.clipUnrotated(X,t,k),g.getInterpolate()||(X.imageSmoothingEnabled=!1),this.preRender(X,t),this.renderedTiles.length=0;let B=Object.keys(z).map(Number);B.sort($i);let Z,K,q;i.opacity===1&&(!this.containerReused||g.getOpaque(t.viewState.projection))?B=B.reverse():(Z=[],K=[]);for(let Q=B.length-1;Q>=0;--Q){const lt=B[Q],nt=g.getTilePixelSize(lt,h,s),Rt=y.getResolution(lt)/E,_t=nt[0]*Rt*Y,mt=nt[1]*Rt*Y,pt=y.getTileCoordForCoordAndZ(Mi(H),lt),G=y.getTileCoordExtent(pt),j=oe(this.tempTransform,[S*(G[0]-H[0])/E,S*(H[3]-G[3])/E]),tt=S*g.getGutterForProjection(s),st=z[lt];for(const et in st){const rt=st[et],it=rt.tileCoord,Ot=pt[1]-it[1],Mt=Math.round(j[0]-(Ot-1)*_t),It=pt[2]-it[2],Dt=Math.round(j[1]-(It-1)*mt),Nt=Math.round(j[0]-Ot*_t),kt=Math.round(j[1]-It*mt),Et=Mt-Nt,bt=Dt-kt,ce=w===lt,Vt=ce&&rt.getAlpha(Lt(this),t.time)!==1;let Jt=!1;if(!Vt)if(Z){q=[Nt,kt,Nt+Et,kt,Nt+Et,kt+bt,Nt,kt+bt];for(let Tt=0,ht=Z.length;Tt<ht;++Tt)if(w!==lt&&lt<K[Tt]){const wt=Z[Tt];me([Nt,kt,Nt+Et,kt+bt],[wt[0],wt[3],wt[4],wt[7]])&&(Jt||(X.save(),Jt=!0),X.beginPath(),X.moveTo(q[0],q[1]),X.lineTo(q[2],q[3]),X.lineTo(q[4],q[5]),X.lineTo(q[6],q[7]),X.moveTo(wt[6],wt[7]),X.lineTo(wt[4],wt[5]),X.lineTo(wt[2],wt[3]),X.lineTo(wt[0],wt[1]),X.clip())}Z.push(q),K.push(lt)}else X.clearRect(Nt,kt,Et,bt);this.drawTileImage(rt,t,Nt,kt,Et,bt,tt,ce),Z&&!Vt?(Jt&&X.restore(),this.renderedTiles.unshift(rt)):this.renderedTiles.push(rt),this.updateUsedTiles(t.usedTiles,g,rt)}}return this.renderedRevision=m,this.renderedResolution=E,this.extentChanged=!this.renderedExtent_||!un(this.renderedExtent_,H),this.renderedExtent_=H,this.renderedPixelRatio=h,this.renderedProjection=s,this.manageTilePyramid(t,g,y,h,s,v,w,u.getPreload()),this.scheduleExpireCache(t,g),this.postRender(X,t),i.extent&&X.restore(),X.imageSmoothingEnabled=!0,P!==M.style.transform&&(M.style.transform=P),this.container}drawTileImage(t,e,i,n,s,o,a,l){const h=this.getTileImage(t);if(!h)return;const u=Lt(this),g=e.layerStatesArray[e.layerIndex],m=g.opacity*(l?t.getAlpha(u,e.time):1),y=m!==this.context.globalAlpha;y&&(this.context.save(),this.context.globalAlpha=m),this.context.drawImage(h,a,a,h.width-2*a,h.height-2*a,i,n,s,o),y&&this.context.restore(),m!==g.opacity?e.animate=!0:l&&t.endTransition(u)}getImage(){const t=this.context;return t?t.canvas:null}getTileImage(t){return t.getImage()}scheduleExpireCache(t,e){if(e.canExpireCache()){const i=(function(n,s,o){const a=Lt(n);a in o.usedTiles&&n.expireCache(o.viewState.projection,o.usedTiles[a])}).bind(null,e);t.postRenderFunctions.push(i)}}updateUsedTiles(t,e,i){const n=Lt(e);n in t||(t[n]={}),t[n][i.getKey()]=!0}manageTilePyramid(t,e,i,n,s,o,a,l,h){const u=Lt(e);u in t.wantedTiles||(t.wantedTiles[u]={});const g=t.wantedTiles[u],m=t.tileQueue,y=i.getMinZoom(),w=t.viewState.rotation,E=w?jr(t.viewState.center,t.viewState.resolution,w,t.size):void 0;let v=0,x,S,R,O,k,F;for(F=y;F<=a;++F)for(S=i.getTileRangeForExtentAndZ(o,F,S),R=i.getResolution(F),O=S.minX;O<=S.maxX;++O)for(k=S.minY;k<=S.maxY;++k)w&&!i.tileCoordIntersectsViewport([F,O,k],E)||(a-F<=l?(++v,x=e.getTile(F,O,k,n,s),x.getState()==dt.IDLE&&(g[x.getKey()]=!0,m.isKeyQueued(x.getKey())||m.enqueue([x,u,i.getTileCoordCenter(x.tileCoord),R])),h!==void 0&&h(x)):e.useTile(F,O,k,s));e.updateCacheSize(v,s)}}const Vn={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};class bh{constructor(t){this.highWaterMark=t!==void 0?t:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(t){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(t){return this.entries_.hasOwnProperty(t)}forEach(t){let e=this.oldest_;for(;e;)t(e.value_,e.key_,this),e=e.newer}get(t,e){const i=this.entries_[t];return xt(i!==void 0,15),i===this.newest_||(i===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(i.newer.older=i.older,i.older.newer=i.newer),i.newer=null,i.older=this.newest_,this.newest_.newer=i,this.newest_=i),i.value_}remove(t){const e=this.entries_[t];return xt(e!==void 0,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}getCount(){return this.count_}getKeys(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.key_;return t}getValues(){const t=new Array(this.count_);let e=0,i;for(i=this.newest_;i;i=i.older)t[e++]=i.value_;return t}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(t){if(this.containsKey(t))return this.entries_[t].value_}pop(){const t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}replace(t,e){this.get(t),this.entries_[t].value_=e}set(t,e){xt(!(t in this.entries_),16);const i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i,this.newest_=i,this.entries_[t]=i,++this.count_}setSize(t){this.highWaterMark=t}}function Oo(r,t,e,i){return i!==void 0?(i[0]=r,i[1]=t,i[2]=e,i):[r,t,e]}function Rr(r,t,e){return r+"/"+t+"/"+e}function Na(r){return Rr(r[0],r[1],r[2])}function Ch(r){return r.split("/").map(Number)}function Sh(r){return(r[1]<<r[0])+r[2]}function Ih(r,t){const e=r[0],i=r[1],n=r[2];if(t.getMinZoom()>e||e>t.getMaxZoom())return!1;const s=t.getFullTileRange(e);return s?s.containsXY(i,n):!0}class Pa extends bh{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}pruneExceptNewestZ(){if(this.getCount()===0)return;const t=this.peekFirstKey(),i=Ch(t)[0];this.forEach((function(n){n.tileCoord[0]!==i&&(this.remove(Na(n.tileCoord)),n.release())}).bind(this))}}const Ah=42,Ms=256,Oh=[0,0,0],si=5;class Da{constructor(t){this.minZoom=t.minZoom!==void 0?t.minZoom:0,this.resolutions_=t.resolutions,xt(El(this.resolutions_,function(n,s){return s-n}),17);let e;if(!t.origins){for(let n=0,s=this.resolutions_.length-1;n<s;++n)if(!e)e=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==e){e=void 0;break}}this.zoomFactor_=e,this.maxZoom=this.resolutions_.length-1,this.origin_=t.origin!==void 0?t.origin:null,this.origins_=null,t.origins!==void 0&&(this.origins_=t.origins,xt(this.origins_.length==this.resolutions_.length,20));const i=t.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=Mi(i)),xt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,t.tileSizes!==void 0&&(this.tileSizes_=t.tileSizes,xt(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=t.tileSize!==void 0?t.tileSize:this.tileSizes_?null:Ms,xt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],t.sizes!==void 0?this.fullTileRanges_=t.sizes.map(function(n,s){const o=new Os(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){const a=this.getTileRangeForExtentAndZ(i,s);o.minX=Math.max(a.minX,o.minX),o.maxX=Math.min(a.maxX,o.maxX),o.minY=Math.max(a.minY,o.minY),o.maxY=Math.min(a.maxY,o.maxY)}return o},this):i&&this.calculateTileRanges_(i)}forEachTileCoord(t,e,i){const n=this.getTileRangeForExtentAndZ(t,e);for(let s=n.minX,o=n.maxX;s<=o;++s)for(let a=n.minY,l=n.maxY;a<=l;++a)i([e,s,a])}forEachTileCoordParentTileRange(t,e,i,n){let s,o,a,l=null,h=t[0]-1;for(this.zoomFactor_===2?(o=t[1],a=t[2]):l=this.getTileCoordExtent(t,n);h>=this.minZoom;){if(this.zoomFactor_===2?(o=Math.floor(o/2),a=Math.floor(a/2),s=Gi(o,o,a,a,i)):s=this.getTileRangeForExtentAndZ(l,h,i),e(h,s))return!0;--h}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(t){return this.origin_?this.origin_:this.origins_[t]}getResolution(t){return this.resolutions_[t]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(t,e,i){if(t[0]<this.maxZoom){if(this.zoomFactor_===2){const s=t[1]*2,o=t[2]*2;return Gi(s,s+1,o,o+1,e)}const n=this.getTileCoordExtent(t,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,t[0]+1,e)}return null}getTileRangeForTileCoordAndZ(t,e,i){if(e>this.maxZoom||e<this.minZoom)return null;const n=t[0],s=t[1],o=t[2];if(e===n)return Gi(s,o,s,o,i);if(this.zoomFactor_){const l=Math.pow(this.zoomFactor_,e-n),h=Math.floor(s*l),u=Math.floor(o*l);if(e<n)return Gi(h,h,u,u,i);const g=Math.floor(l*(s+1))-1,m=Math.floor(l*(o+1))-1;return Gi(h,g,u,m,i)}const a=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(a,e,i)}getTileRangeExtent(t,e,i){const n=this.getOrigin(t),s=this.getResolution(t),o=ve(this.getTileSize(t),this.tmpSize_),a=n[0]+e.minX*o[0]*s,l=n[0]+(e.maxX+1)*o[0]*s,h=n[1]+e.minY*o[1]*s,u=n[1]+(e.maxY+1)*o[1]*s;return Ue(a,h,l,u,i)}getTileRangeForExtentAndZ(t,e,i){const n=Oh;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);const s=n[1],o=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),Gi(s,n[1],o,n[2],i)}getTileCoordCenter(t){const e=this.getOrigin(t[0]),i=this.getResolution(t[0]),n=ve(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*i,e[1]-(t[2]+.5)*n[1]*i]}getTileCoordExtent(t,e){const i=this.getOrigin(t[0]),n=this.getResolution(t[0]),s=ve(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*s[0]*n,a=i[1]-(t[2]+1)*s[1]*n,l=o+s[0]*n,h=a+s[1]*n;return Ue(o,a,l,h,e)}getTileCoordForCoordAndResolution(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)}getTileCoordForXYAndResolution_(t,e,i,n,s){const o=this.getZForResolution(i),a=i/this.getResolution(o),l=this.getOrigin(o),h=ve(this.getTileSize(o),this.tmpSize_);let u=a*(t-l[0])/i/h[0],g=a*(l[1]-e)/i/h[1];return n?(u=Gn(u,si)-1,g=Gn(g,si)-1):(u=Fn(u,si),g=Fn(g,si)),Oo(o,u,g,s)}getTileCoordForXYAndZ_(t,e,i,n,s){const o=this.getOrigin(i),a=this.getResolution(i),l=ve(this.getTileSize(i),this.tmpSize_);let h=(t-o[0])/a/l[0],u=(o[1]-e)/a/l[1];return n?(h=Gn(h,si)-1,u=Gn(u,si)-1):(h=Fn(h,si),u=Fn(u,si)),Oo(i,h,u,s)}getTileCoordForCoordAndZ(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)}getTileCoordResolution(t){return this.resolutions_[t[0]]}getTileSize(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}getFullTileRange(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}getZForResolution(t,e){const i=fs(this.resolutions_,t,e||0);return Zt(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(t,e){return da(e,0,e.length,2,this.getTileCoordExtent(t))}calculateTileRanges_(t){const e=this.resolutions_.length,i=new Array(e);for(let n=this.minZoom;n<e;++n)i[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=i}}const Nr={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};function ka(r){let t=r.getDefaultTileGrid();return t||(t=Ph(r),r.setDefaultTileGrid(t)),t}function Mh(r,t,e){const i=t[0],n=r.getTileCoordCenter(t),s=Ls(e);if(lr(s,n))return t;{const o=Ut(s),a=Math.ceil((s[0]-n[0])/o);return n[0]+=o*a,r.getTileCoordForCoordAndZ(n,i)}}function Lh(r,t,e,i){i=i!==void 0?i:"top-left";const n=Fa(r,t,e);return new Da({extent:r,origin:$a(r,i),resolutions:n,tileSize:e})}function Nh(r){const t=r,e=t.extent||Bt("EPSG:3857").getExtent(),i={extent:e,minZoom:t.minZoom,tileSize:t.tileSize,resolutions:Fa(e,t.maxZoom,t.tileSize,t.maxResolution)};return new Da(i)}function Fa(r,t,e,i){t=t!==void 0?t:Ah,e=ve(e!==void 0?e:Ms);const n=qe(r),s=Ut(r);i=i>0?i:Math.max(s/e[0],n/e[1]);const o=t+1,a=new Array(o);for(let l=0;l<o;++l)a[l]=i/Math.pow(2,l);return a}function Ph(r,t,e,i){const n=Ls(r);return Lh(n,t,e,i)}function Ls(r){r=Bt(r);let t=r.getExtent();if(!t){const e=180*En.degrees/r.getMetersPerUnit();t=Ue(-e,-e,e,e)}return t}class Dh extends Ca{constructor(t){super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate}),this.on,this.once,this.un,this.opaque_=t.opaque!==void 0?t.opaque:!1,this.tilePixelRatio_=t.tilePixelRatio!==void 0?t.tilePixelRatio:1,this.tileGrid=t.tileGrid!==void 0?t.tileGrid:null;const e=[256,256];this.tileGrid&&ve(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),e),this.tileCache=new Pa(t.cacheSize||0),this.tmpSize=[0,0],this.key_=t.key||"",this.tileOptions={transition:t.transition,interpolate:t.interpolate},this.zDirection=t.zDirection?t.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(t,e){const i=this.getTileCacheForProjection(t);i&&i.expireCache(e)}forEachLoadedTile(t,e,i,n){const s=this.getTileCacheForProjection(t);if(!s)return!1;let o=!0,a,l,h;for(let u=i.minX;u<=i.maxX;++u)for(let g=i.minY;g<=i.maxY;++g)l=Rr(e,u,g),h=!1,s.containsKey(l)&&(a=s.get(l),h=a.getState()===dt.LOADED,h&&(h=n(a)!==!1)),h||(o=!1);return o}getGutterForProjection(t){return 0}getKey(){return this.key_}setKey(t){this.key_!==t&&(this.key_=t,this.changed())}getOpaque(t){return this.opaque_}getResolutions(){return this.tileGrid?this.tileGrid.getResolutions():null}getTile(t,e,i,n,s){return gt()}getTileGrid(){return this.tileGrid}getTileGridForProjection(t){return this.tileGrid?this.tileGrid:ka(t)}getTileCacheForProjection(t){const e=this.getProjection();return xt(e===null||wi(e,t),68),this.tileCache}getTilePixelRatio(t){return this.tilePixelRatio_}getTilePixelSize(t,e,i){const n=this.getTileGridForProjection(i),s=this.getTilePixelRatio(e),o=ve(n.getTileSize(t),this.tmpSize);return s==1?o:il(o,s,this.tmpSize)}getTileCoordForTileUrlFunction(t,e){e=e!==void 0?e:this.getProjection();const i=this.getTileGridForProjection(e);return this.getWrapX()&&e.isGlobal()&&(t=Mh(i,t,e)),Ih(t,i)?t:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(t,e){const i=this.getTileCacheForProjection(e);t>i.highWaterMark&&(i.highWaterMark=t)}useTile(t,e,i,n){}}class kh extends ti{constructor(t,e){super(t),this.tile=e}}function Fh(r,t){const e=/\{z\}/g,i=/\{x\}/g,n=/\{y\}/g,s=/\{-y\}/g;return function(o,a,l){if(o)return r.replace(e,o[0].toString()).replace(i,o[1].toString()).replace(n,o[2].toString()).replace(s,function(){const h=o[0],u=t.getFullTileRange(h);return xt(u,55),(u.getHeight()-o[2]-1).toString()})}}function Gh(r,t){const e=r.length,i=new Array(e);for(let n=0;n<e;++n)i[n]=Fh(r[n],t);return Uh(i)}function Uh(r){return r.length===1?r[0]:function(t,e,i){if(t){const n=Sh(t),s=Vi(n,r.length);return r[s](t,e,i)}else return}}function qh(r){const t=[];let e=/\{([a-z])-([a-z])\}/.exec(r);if(e){const i=e[1].charCodeAt(0),n=e[2].charCodeAt(0);let s;for(s=i;s<=n;++s)t.push(r.replace(e[0],String.fromCharCode(s)));return t}if(e=/\{(\d+)-(\d+)\}/.exec(r),e){const i=parseInt(e[2],10);for(let n=parseInt(e[1],10);n<=i;n++)t.push(r.replace(e[0],n.toString()));return t}return t.push(r),t}class Ns extends Dh{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===Ns.prototype.tileUrlFunction,this.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(this.tileUrlFunction=t.tileUrlFunction),this.urls=null,t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(t){const e=t.target,i=Lt(e),n=e.getState();let s;n==dt.LOADING?(this.tileLoadingKeys_[i]=!0,s=Nr.TILELOADSTART):i in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[i],s=n==dt.ERROR?Nr.TILELOADERROR:n==dt.LOADED?Nr.TILELOADEND:void 0),s!=null&&this.dispatchEvent(new kh(s,e))}setTileLoadFunction(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}setTileUrlFunction(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),typeof e<"u"?this.setKey(e):this.changed()}setUrl(t){const e=qh(t);this.urls=e,this.setUrls(e)}setUrls(t){this.urls=t;const e=t.join(`
`);this.generateTileUrlFunction_?this.setTileUrlFunction(Gh(t,this.tileGrid),e):this.setKey(e)}tileUrlFunction(t,e,i){}useTile(t,e,i){const n=Rr(t,e,i);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}class Xh extends gh{constructor(){super()}getType(){return"json"}readFeature(t,e){return this.readFeatureFromObject(Wn(t),this.getReadOptions(t,e))}readFeatures(t,e){return this.readFeaturesFromObject(Wn(t),this.getReadOptions(t,e))}readFeatureFromObject(t,e){return gt()}readFeaturesFromObject(t,e){return gt()}readGeometry(t,e){return this.readGeometryFromObject(Wn(t),this.getReadOptions(t,e))}readGeometryFromObject(t,e){return gt()}readProjection(t){return this.readProjectionFromObject(Wn(t))}readProjectionFromObject(t){return gt()}writeFeature(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}writeFeatureObject(t,e){return gt()}writeFeatures(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}writeFeaturesObject(t,e){return gt()}writeGeometry(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}writeGeometryObject(t,e){return gt()}}function Wn(r){if(typeof r=="string"){const t=JSON.parse(r);return t||null}else return r!==null?r:null}class jh extends Xh{constructor(t){t=t||{},super(),this.dataProjection=Bt(t.dataProjection?t.dataProjection:"EPSG:4326"),t.featureProjection&&(this.defaultFeatureProjection=Bt(t.featureProjection)),this.geometryName_=t.geometryName,this.extractGeometryName_=t.extractGeometryName,this.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"]}readFeatureFromObject(t,e){let i=null;t.type==="Feature"?i=t:i={type:"Feature",geometry:t,properties:null};const n=ns(i.geometry,e),s=new Mn;return this.geometryName_?s.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&s.setGeometryName(i.geometry_name),s.setGeometry(n),"id"in i&&s.setId(i.id),i.properties&&s.setProperties(i.properties,!0),s}readFeaturesFromObject(t,e){const i=t;let n=null;if(i.type==="FeatureCollection"){const s=t;n=[];const o=s.features;for(let a=0,l=o.length;a<l;++a)n.push(this.readFeatureFromObject(o[a],e))}else n=[this.readFeatureFromObject(t,e)];return n}readGeometryFromObject(t,e){return ns(t,e)}readProjectionFromObject(t){const e=t.crs;let i;return e?e.type=="name"?i=Bt(e.properties.name):e.type==="EPSG"?i=Bt("EPSG:"+e.properties.code):xt(!1,36):i=this.dataProjection,i}writeFeatureObject(t,e){e=this.adaptOptions(e);const i={type:"Feature",geometry:null,properties:null},n=t.getId();if(n!==void 0&&(i.id=n),!t.hasProperties())return i;const s=t.getProperties(),o=t.getGeometry();return o&&(i.geometry=rs(o,e),delete s[t.getGeometryName()]),Ki(s)||(i.properties=s),i}writeFeaturesObject(t,e){e=this.adaptOptions(e);const i=[];for(let n=0,s=t.length;n<s;++n)i.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:i}}writeGeometryObject(t,e){return rs(t,this.adaptOptions(e))}}function ns(r,t){if(!r)return null;let e;switch(r.type){case"Point":{e=zh(r);break}case"LineString":{e=Vh(r);break}case"Polygon":{e=$h(r);break}case"MultiPoint":{e=Bh(r);break}case"MultiLineString":{e=Wh(r);break}case"MultiPolygon":{e=Hh(r);break}case"GeometryCollection":{e=Yh(r);break}default:throw new Error("Unsupported GeoJSON type: "+r.type)}return Ia(e,!1,t)}function Yh(r,t){const e=r.geometries.map(function(i){return ns(i,t)});return new rr(e)}function zh(r){return new Ai(r.coordinates)}function Vh(r){return new Ji(r.coordinates)}function Wh(r){return new sr(r.coordinates)}function Bh(r){return new xr(r.coordinates)}function Hh(r){return new or(r.coordinates)}function $h(r){return new mi(r.coordinates)}function rs(r,t){r=Ia(r,!0,t);const e=r.getType();let i;switch(e){case"Point":{i=eu(r);break}case"LineString":{i=Zh(r);break}case"Polygon":{i=iu(r,t);break}case"MultiPoint":{i=Qh(r);break}case"MultiLineString":{i=Jh(r);break}case"MultiPolygon":{i=tu(r,t);break}case"GeometryCollection":{i=Kh(r,t);break}case"Circle":{i={type:"GeometryCollection",geometries:[]};break}default:throw new Error("Unsupported geometry type: "+e)}return i}function Kh(r,t){return t=Object.assign({},t),delete t.featureProjection,{type:"GeometryCollection",geometries:r.getGeometriesArray().map(function(i){return rs(i,t)})}}function Zh(r,t){return{type:"LineString",coordinates:r.getCoordinates()}}function Jh(r,t){return{type:"MultiLineString",coordinates:r.getCoordinates()}}function Qh(r,t){return{type:"MultiPoint",coordinates:r.getCoordinates()}}function tu(r,t){let e;return t&&(e=t.rightHanded),{type:"MultiPolygon",coordinates:r.getCoordinates(e)}}function eu(r,t){return{type:"Point",coordinates:r.getCoordinates()}}function iu(r,t){let e;return t&&(e=t.rightHanded),{type:"Polygon",coordinates:r.getCoordinates(e)}}class nu extends ds{constructor(t){super(),this.map_=t}dispatchRenderEvent(t,e){gt()}calculateMatrices2D(t){const e=t.viewState,i=t.coordinateToPixelTransform,n=t.pixelToCoordinateTransform;pi(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]),ms(n,i)}forEachFeatureAtCoordinate(t,e,i,n,s,o,a,l){let h;const u=e.viewState;function g(O,k,F,W){return s.call(o,k,O?F:null,W)}const m=u.projection,y=ea(t.slice(),m),w=[[0,0]];if(m.canWrapX()&&n){const O=m.getExtent(),k=Ut(O);w.push([-k,0],[k,0])}const E=e.layerStatesArray,v=E.length,x=[],S=[];for(let O=0;O<w.length;O++)for(let k=v-1;k>=0;--k){const F=E[k],W=F.layer;if(W.hasRenderer()&&Is(F,u)&&a.call(l,W)){const H=W.getRenderer(),N=W.getSource();if(H&&N){const z=N.getWrapX()?y:t,I=g.bind(null,F.managed);S[0]=z[0]+w[O][0],S[1]=z[1]+w[O][1],h=H.forEachFeatureAtCoordinate(S,e,i,I,x)}if(h)return h}}if(x.length===0)return;const R=1/x.length;return x.forEach((O,k)=>O.distanceSq+=k*R),x.sort((O,k)=>O.distanceSq-k.distanceSq),x.some(O=>h=O.callback(O.feature,O.layer,O.geometry)),h}hasFeatureAtCoordinate(t,e,i,n,s,o){return this.forEachFeatureAtCoordinate(t,e,i,n,dn,this,s,o)!==void 0}getMap(){return this.map_}renderFrame(t){gt()}scheduleExpireIconCache(t){er.canExpireCache()&&t.postRenderFunctions.push(ru)}}function ru(r,t){er.expire()}class su extends nu{constructor(t){super(t),this.fontChangeListenerKey_=St($e,Hi.PROPERTYCHANGE,t.redrawText.bind(t)),this.element_=document.createElement("div");const e=this.element_.style;e.position="absolute",e.width="100%",e.height="100%",e.zIndex="0",this.element_.className=mr+" ol-layers";const i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(t,e){const i=this.getMap();if(i.hasListener(t)){const n=new xa(t,void 0,e);i.dispatchEvent(n)}}disposeInternal(){qt(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(t){if(!t){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(t),this.dispatchRenderEvent(di.PRECOMPOSE,t);const e=t.layerStatesArray.sort(function(o,a){return o.zIndex-a.zIndex}),i=t.viewState;this.children_.length=0;const n=[];let s=null;for(let o=0,a=e.length;o<a;++o){const l=e[o];t.layerIndex=o;const h=l.layer,u=h.getSourceState();if(!Is(l,i)||u!="ready"&&u!="undefined"){h.unrender();continue}const g=h.render(t,s);g&&(g!==s&&(this.children_.push(g),s=g),"getDeclutter"in h&&n.push(h))}for(let o=n.length-1;o>=0;--o)n[o].renderDeclutter(t);ml(this.element_,this.children_),this.dispatchRenderEvent(di.POSTCOMPOSE,t),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(t)}}class ji extends ti{constructor(t,e,i){super(t),this.map=e,this.frameState=i!==void 0?i:null}}class oi extends ji{constructor(t,e,i,n,s,o){super(t,e,s),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(t){this.pixel_=t}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(t){this.coordinate_=t}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const zt={SINGLECLICK:"singleclick",CLICK:yt.CLICK,DBLCLICK:yt.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},ss={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"};class ou extends pr{constructor(t,e){super(t),this.map_=t,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=e===void 0?1:e,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=St(i,ss.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=St(i,ss.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(yt.TOUCHMOVE,this.boundHandleTouchMove_,Bo?{passive:!1}:!1)}emulateClick_(t){let e=new oi(zt.CLICK,this.map_,t);this.dispatchEvent(e),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,e=new oi(zt.DBLCLICK,this.map_,t),this.dispatchEvent(e)):this.clickTimeoutId_=setTimeout((function(){this.clickTimeoutId_=void 0;const i=new oi(zt.SINGLECLICK,this.map_,t);this.dispatchEvent(i)}).bind(this),250)}updateActivePointers_(t){const e=t,i=e.pointerId;if(e.type==zt.POINTERUP||e.type==zt.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==e.target){delete this.trackedTouches_[n];break}}else(e.type==zt.POINTERDOWN||e.type==zt.POINTERMOVE)&&(this.trackedTouches_[i]=e);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(t){this.updateActivePointers_(t);const e=new oi(zt.POINTERUP,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.emulateClicks_&&!e.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(t)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(qt),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(t){return t.button===0}handlePointerDown_(t){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(t);const e=new oi(zt.POINTERDOWN,this.map_,t,void 0,void 0,this.activePointers_);this.dispatchEvent(e),this.down_={};for(const i in t){const n=t[i];this.down_[i]=typeof n=="function"?Ii:n}if(this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(St(i,zt.POINTERMOVE,this.handlePointerMove_,this),St(i,zt.POINTERUP,this.handlePointerUp_,this),St(this.element_,zt.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(St(this.element_.getRootNode(),zt.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(t){if(this.isMoving_(t)){this.updateActivePointers_(t),this.dragging_=!0;const e=new oi(zt.POINTERDRAG,this.map_,t,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(e)}}relayMoveEvent_(t){this.originalPointerMoveEvent_=t;const e=!!(this.down_&&this.isMoving_(t));this.dispatchEvent(new oi(zt.POINTERMOVE,this.map_,t,e))}handleTouchMove_(t){const e=this.originalPointerMoveEvent_;(!e||e.defaultPrevented)&&(typeof t.cancelable!="boolean"||t.cancelable===!0)&&t.preventDefault()}isMoving_(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(qt(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(yt.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(qt(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(qt),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const ai={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},ue={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},ar=1/0;class au{constructor(t,e){this.priorityFunction_=t,this.keyFunction_=e,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,Cn(this.queuedElements_)}dequeue(){const t=this.elements_,e=this.priorities_,i=t[0];t.length==1?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));const n=this.keyFunction_(i);return delete this.queuedElements_[n],i}enqueue(t){xt(!(this.keyFunction_(t)in this.queuedElements_),31);const e=this.priorityFunction_(t);return e!=ar?(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0):!1}getCount(){return this.elements_.length}getLeftChildIndex_(t){return t*2+1}getRightChildIndex_(t){return t*2+2}getParentIndex_(t){return t-1>>1}heapify_(){let t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}isEmpty(){return this.elements_.length===0}isKeyQueued(t){return t in this.queuedElements_}isQueued(t){return this.isKeyQueued(this.keyFunction_(t))}siftUp_(t){const e=this.elements_,i=this.priorities_,n=e.length,s=e[t],o=i[t],a=t;for(;t<n>>1;){const l=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),u=h<n&&i[h]<i[l]?h:l;e[t]=e[u],i[t]=i[u],t=u}e[t]=s,i[t]=o,this.siftDown_(a,t)}siftDown_(t,e){const i=this.elements_,n=this.priorities_,s=i[e],o=n[e];for(;e>t;){const a=this.getParentIndex_(e);if(n[a]>o)i[e]=i[a],n[e]=n[a],e=a;else break}i[e]=s,n[e]=o}reprioritize(){const t=this.priorityFunction_,e=this.elements_,i=this.priorities_;let n=0;const s=e.length;let o,a,l;for(a=0;a<s;++a)o=e[a],l=t(o),l==ar?delete this.queuedElements_[this.keyFunction_(o)]:(i[n]=l,e[n++]=o);e.length=n,i.length=n,this.heapify_()}}class lu extends au{constructor(t,e){super(function(i){return t.apply(null,i)},function(i){return i[0].getKey()}),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=e,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(t){const e=super.enqueue(t);return e&&t[0].addEventListener(yt.CHANGE,this.boundHandleTileChange_),e}getTilesLoading(){return this.tilesLoading_}handleTileChange(t){const e=t.target,i=e.getState();if(i===dt.LOADED||i===dt.ERROR||i===dt.EMPTY){i!==dt.ERROR&&e.removeEventListener(yt.CHANGE,this.boundHandleTileChange_);const n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(t,e){let i=0,n,s,o;for(;this.tilesLoading_<t&&i<e&&this.getCount()>0;)s=this.dequeue()[0],o=s.getKey(),n=s.getState(),n===dt.IDLE&&!(o in this.tilesLoadingKeys_)&&(this.tilesLoadingKeys_[o]=!0,++this.tilesLoading_,++i,s.load())}}function cu(r,t,e,i,n){if(!r||!(e in r.wantedTiles)||!r.wantedTiles[e][t.getKey()])return ar;const s=r.viewState.center,o=i[0]-s[0],a=i[1]-s[1];return 65536*Math.log(n)+Math.sqrt(o*o+a*a)/n}const Pe={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function Mo(r,t,e){return function(i,n,s,o,a){if(!i)return;if(!n&&!t)return i;const l=t?0:s[0]*n,h=t?0:s[1]*n,u=a?a[0]:0,g=a?a[1]:0;let m=r[0]+l/2+u,y=r[2]-l/2+u,w=r[1]+h/2+g,E=r[3]-h/2+g;m>y&&(m=(y+m)/2,y=m),w>E&&(w=(E+w)/2,E=w);let v=Zt(i[0],m,y),x=Zt(i[1],w,E);if(o&&e&&n){const S=30*n;v+=-S*Math.log(1+Math.max(0,m-i[0])/S)+S*Math.log(1+Math.max(0,i[0]-y)/S),x+=-S*Math.log(1+Math.max(0,w-i[1])/S)+S*Math.log(1+Math.max(0,i[1]-E)/S)}return[v,x]}}function hu(r){return r}function Ps(r,t,e,i){const n=Ut(t)/e[0],s=qe(t)/e[1];return i?Math.min(r,Math.max(n,s)):Math.min(r,Math.min(n,s))}function Ds(r,t,e){let i=Math.min(r,t);const n=50;return i*=Math.log(1+n*Math.max(0,r/t-1))/n+1,e&&(i=Math.max(i,e),i/=Math.log(1+n*Math.max(0,e/r-1))/n+1),Zt(i,e/2,t*2)}function uu(r,t,e,i){return t=t!==void 0?t:!0,function(n,s,o,a){if(n!==void 0){const l=r[0],h=r[r.length-1],u=e?Ps(l,e,o,i):l;if(a)return t?Ds(n,u,h):Zt(n,h,u);const g=Math.min(u,n),m=Math.floor(fs(r,g,s));return r[m]>u&&m<r.length-1?r[m+1]:r[m]}else return}}function du(r,t,e,i,n,s){return i=i!==void 0?i:!0,e=e!==void 0?e:0,function(o,a,l,h){if(o!==void 0){const u=n?Ps(t,n,l,s):t;if(h)return i?Ds(o,u,e):Zt(o,e,u);const g=1e-9,m=Math.ceil(Math.log(t/u)/Math.log(r)-g),y=-a*(.5-g)+.5,w=Math.min(u,o),E=Math.floor(Math.log(t/w)/Math.log(r)+y),v=Math.max(m,E),x=t/Math.pow(r,v);return Zt(x,e,u)}else return}}function Lo(r,t,e,i,n){return e=e!==void 0?e:!0,function(s,o,a,l){if(s!==void 0){const h=i?Ps(r,i,a,n):r;return!e||!l?Zt(s,t,h):Ds(s,h,t)}else return}}function ks(r){if(r!==void 0)return 0}function No(r){if(r!==void 0)return r}function fu(r){const t=2*Math.PI/r;return function(e,i){if(i)return e;if(e!==void 0)return e=Math.floor(e/t+.5)*t,e}}function gu(r){return r=r||$n(5),function(t,e){if(e)return t;if(t!==void 0)return Math.abs(t)<=r?0:t}}const Pr=0;class ci extends Xe{constructor(t){super(),this.on,this.once,this.un,t=Object.assign({},t),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=Es(t.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,t.projection&&Zl(),t.center&&(t.center=Ke(t.center,this.projection_)),t.extent&&(t.extent=xi(t.extent,this.projection_)),this.applyOptions_(t)}applyOptions_(t){const e=Object.assign({},t);for(const a in Pe)delete e[a];this.setProperties(e,!0);const i=mu(t);this.maxResolution_=i.maxResolution,this.minResolution_=i.minResolution,this.zoomFactor_=i.zoomFactor,this.resolutions_=t.resolutions,this.padding_=t.padding,this.minZoom_=i.minZoom;const n=pu(t),s=i.constraint,o=_u(t);this.constraints_={center:n,resolution:s,rotation:o},this.setRotation(t.rotation!==void 0?t.rotation:0),this.setCenterInternal(t.center!==void 0?t.center:null),t.resolution!==void 0?this.setResolution(t.resolution):t.zoom!==void 0&&this.setZoom(t.zoom)}get padding(){return this.padding_}set padding(t){let e=this.padding_;this.padding_=t;const i=this.getCenter();if(i){const n=t||[0,0,0,0];e=e||[0,0,0,0];const s=this.getResolution(),o=s/2*(n[3]-e[3]+e[1]-n[1]),a=s/2*(n[0]-e[0]+e[2]-n[2]);this.setCenterInternal([i[0]+o,i[1]-a])}}getUpdatedOptions_(t){const e=this.getProperties();return e.resolution!==void 0?e.resolution=this.getResolution():e.zoom=this.getZoom(),e.center=this.getCenterInternal(),e.rotation=this.getRotation(),Object.assign({},e,t)}animate(t){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const e=new Array(arguments.length);for(let i=0;i<e.length;++i){let n=arguments[i];n.center&&(n=Object.assign({},n),n.center=Ke(n.center,this.getProjection())),n.anchor&&(n=Object.assign({},n),n.anchor=Ke(n.anchor,this.getProjection())),e[i]=n}this.animateInternal.apply(this,e)}animateInternal(t){let e=arguments.length,i;e>1&&typeof arguments[e-1]=="function"&&(i=arguments[e-1],--e);let n=0;for(;n<e&&!this.isDef();++n){const u=arguments[n];u.center&&this.setCenterInternal(u.center),u.zoom!==void 0?this.setZoom(u.zoom):u.resolution&&this.setResolution(u.resolution),u.rotation!==void 0&&this.setRotation(u.rotation)}if(n===e){i&&Bn(i,!0);return}let s=Date.now(),o=this.targetCenter_.slice(),a=this.targetResolution_,l=this.targetRotation_;const h=[];for(;n<e;++n){const u=arguments[n],g={start:s,complete:!1,anchor:u.anchor,duration:u.duration!==void 0?u.duration:1e3,easing:u.easing||ph,callback:i};if(u.center&&(g.sourceCenter=o,g.targetCenter=u.center.slice(),o=g.targetCenter),u.zoom!==void 0?(g.sourceResolution=a,g.targetResolution=this.getResolutionForZoom(u.zoom),a=g.targetResolution):u.resolution&&(g.sourceResolution=a,g.targetResolution=u.resolution,a=g.targetResolution),u.rotation!==void 0){g.sourceRotation=l;const m=Vi(u.rotation-l+Math.PI,2*Math.PI)-Math.PI;g.targetRotation=l+m,l=g.targetRotation}yu(g)?g.complete=!0:s+=g.duration,h.push(g)}this.animations_.push(h),this.setHint(de.ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[de.ANIMATING]>0}getInteracting(){return this.hints_[de.INTERACTING]>0}cancelAnimations(){this.setHint(de.ANIMATING,-this.hints_[de.ANIMATING]);let t;for(let e=0,i=this.animations_.length;e<i;++e){const n=this.animations_[e];if(n[0].callback&&Bn(n[0].callback,!1),!t)for(let s=0,o=n.length;s<o;++s){const a=n[s];if(!a.complete){t=a.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=t,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(this.updateAnimationKey_!==void 0&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const t=Date.now();let e=!1;for(let i=this.animations_.length-1;i>=0;--i){const n=this.animations_[i];let s=!0;for(let o=0,a=n.length;o<a;++o){const l=n[o];if(l.complete)continue;const h=t-l.start;let u=l.duration>0?h/l.duration:1;u>=1?(l.complete=!0,u=1):s=!1;const g=l.easing(u);if(l.sourceCenter){const m=l.sourceCenter[0],y=l.sourceCenter[1],w=l.targetCenter[0],E=l.targetCenter[1];this.nextCenter_=l.targetCenter;const v=m+g*(w-m),x=y+g*(E-y);this.targetCenter_=[v,x]}if(l.sourceResolution&&l.targetResolution){const m=g===1?l.targetResolution:l.sourceResolution+g*(l.targetResolution-l.sourceResolution);if(l.anchor){const y=this.getViewportSize_(this.getRotation()),w=this.constraints_.resolution(m,0,y,!0);this.targetCenter_=this.calculateCenterZoom(w,l.anchor)}this.nextResolution_=l.targetResolution,this.targetResolution_=m,this.applyTargetState_(!0)}if(l.sourceRotation!==void 0&&l.targetRotation!==void 0){const m=g===1?Vi(l.targetRotation+Math.PI,2*Math.PI)-Math.PI:l.sourceRotation+g*(l.targetRotation-l.sourceRotation);if(l.anchor){const y=this.constraints_.rotation(m,!0);this.targetCenter_=this.calculateCenterRotate(y,l.anchor)}this.nextRotation_=l.targetRotation,this.targetRotation_=m}if(this.applyTargetState_(!0),e=!0,!l.complete)break}if(s){this.animations_[i]=null,this.setHint(de.ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const o=n[0].callback;o&&Bn(o,!0)}}this.animations_=this.animations_.filter(Boolean),e&&this.updateAnimationKey_===void 0&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(t,e){let i;const n=this.getCenterInternal();return n!==void 0&&(i=[n[0]-e[0],n[1]-e[1]],_s(i,t-this.getRotation()),Bl(i,e)),i}calculateCenterZoom(t,e){let i;const n=this.getCenterInternal(),s=this.getResolution();if(n!==void 0&&s!==void 0){const o=e[0]-t*(e[0]-n[0])/s,a=e[1]-t*(e[1]-n[1])/s;i=[o,a]}return i}getViewportSize_(t){const e=this.viewportSize_;if(t){const i=e[0],n=e[1];return[Math.abs(i*Math.cos(t))+Math.abs(n*Math.sin(t)),Math.abs(i*Math.sin(t))+Math.abs(n*Math.cos(t))]}else return e}setViewportSize(t){this.viewportSize_=Array.isArray(t)?t.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const t=this.getCenterInternal();return t&&Kr(t,this.getProjection())}getCenterInternal(){return this.get(Pe.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(t){return t!==void 0?(t[0]=this.hints_[0],t[1]=this.hints_[1],t):this.hints_.slice()}calculateExtent(t){const e=this.calculateExtentInternal(t);return Zr(e,this.getProjection())}calculateExtentInternal(t){t=t||this.getViewportSizeMinusPadding_();const e=this.getCenterInternal();xt(e,1);const i=this.getResolution();xt(i!==void 0,2);const n=this.getRotation();return xt(n!==void 0,3),Xr(e,i,n,t)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))}setConstrainResolution(t){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:t}))}getProjection(){return this.projection_}getResolution(){return this.get(Pe.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(t,e){return this.getResolutionForExtentInternal(xi(t,this.getProjection()),e)}getResolutionForExtentInternal(t,e){e=e||this.getViewportSizeMinusPadding_();const i=Ut(t)/e[0],n=qe(t)/e[1];return Math.max(i,n)}getResolutionForValueFunction(t){t=t||2;const e=this.getConstrainedResolution(this.maxResolution_),i=this.minResolution_,n=Math.log(e/i)/Math.log(t);return function(s){return e/Math.pow(t,s*n)}}getRotation(){return this.get(Pe.ROTATION)}getValueForResolutionFunction(t){const e=Math.log(t||2),i=this.getConstrainedResolution(this.maxResolution_),n=this.minResolution_,s=Math.log(i/n)/e;return function(o){return Math.log(i/o)/e/s}}getViewportSizeMinusPadding_(t){let e=this.getViewportSize_(t);const i=this.padding_;return i&&(e=[e[0]-i[1]-i[3],e[1]-i[0]-i[2]]),e}getState(){const t=this.getProjection(),e=this.getResolution(),i=this.getRotation();let n=this.getCenterInternal();const s=this.padding_;if(s){const o=this.getViewportSizeMinusPadding_();n=Dr(n,this.getViewportSize_(),[o[0]/2+s[3],o[1]/2+s[0]],e,i)}return{center:n.slice(0),projection:t!==void 0?t:null,resolution:e,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation:i,zoom:this.getZoom()}}getZoom(){let t;const e=this.getResolution();return e!==void 0&&(t=this.getZoomForResolution(e)),t}getZoomForResolution(t){let e=this.minZoom_||0,i,n;if(this.resolutions_){const s=fs(this.resolutions_,t,1);e=s,i=this.resolutions_[s],s==this.resolutions_.length-1?n=2:n=i/this.resolutions_[s+1]}else i=this.maxResolution_,n=this.zoomFactor_;return e+Math.log(i/t)/Math.log(n)}getResolutionForZoom(t){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const e=Zt(Math.floor(t),0,this.resolutions_.length-2),i=this.resolutions_[e]/this.resolutions_[e+1];return this.resolutions_[e]/Math.pow(i,Zt(t-e,0,1))}else return this.maxResolution_/Math.pow(this.zoomFactor_,t-this.minZoom_)}fit(t,e){let i;if(xt(Array.isArray(t)||typeof t.getSimplifiedGeometry=="function",24),Array.isArray(t)){xt(!cs(t),25);const n=xi(t,this.getProjection());i=ho(n)}else if(t.getType()==="Circle"){const n=xi(t.getExtent(),this.getProjection());i=ho(n),i.rotate(this.getRotation(),Si(n))}else{const n=ra();n?i=t.clone().transform(n,this.getProjection()):i=t}this.fitInternal(i,e)}rotatedExtentForGeometry(t){const e=this.getRotation(),i=Math.cos(e),n=Math.sin(-e),s=t.getFlatCoordinates(),o=t.getStride();let a=1/0,l=1/0,h=-1/0,u=-1/0;for(let g=0,m=s.length;g<m;g+=o){const y=s[g]*i-s[g+1]*n,w=s[g]*n+s[g+1]*i;a=Math.min(a,y),l=Math.min(l,w),h=Math.max(h,y),u=Math.max(u,w)}return[a,l,h,u]}fitInternal(t,e){e=e||{};let i=e.size;i||(i=this.getViewportSizeMinusPadding_());const n=e.padding!==void 0?e.padding:[0,0,0,0],s=e.nearest!==void 0?e.nearest:!1;let o;e.minResolution!==void 0?o=e.minResolution:e.maxZoom!==void 0?o=this.getResolutionForZoom(e.maxZoom):o=0;const a=this.rotatedExtentForGeometry(t);let l=this.getResolutionForExtentInternal(a,[i[0]-n[1]-n[3],i[1]-n[0]-n[2]]);l=isNaN(l)?o:Math.max(l,o),l=this.getConstrainedResolution(l,s?0:1);const h=this.getRotation(),u=Math.sin(h),g=Math.cos(h),m=Si(a);m[0]+=(n[1]-n[3])/2*l,m[1]+=(n[0]-n[2])/2*l;const y=m[0]*g-m[1]*u,w=m[1]*g+m[0]*u,E=this.getConstrainedCenter([y,w],l),v=e.callback?e.callback:Ii;e.duration!==void 0?this.animateInternal({resolution:l,center:E,duration:e.duration,easing:e.easing},v):(this.targetResolution_=l,this.targetCenter_=E,this.applyTargetState_(!1,!0),Bn(v,!0))}centerOn(t,e,i){this.centerOnInternal(Ke(t,this.getProjection()),e,i)}centerOnInternal(t,e,i){this.setCenterInternal(Dr(t,e,i,this.getResolution(),this.getRotation()))}calculateCenterShift(t,e,i,n){let s;const o=this.padding_;if(o&&t){const a=this.getViewportSizeMinusPadding_(-i),l=Dr(t,n,[a[0]/2+o[3],a[1]/2+o[0]],e,i);s=[t[0]-l[0],t[1]-l[1]]}return s}isDef(){return!!this.getCenterInternal()&&this.getResolution()!==void 0}adjustCenter(t){const e=Kr(this.targetCenter_,this.getProjection());this.setCenter([e[0]+t[0],e[1]+t[1]])}adjustCenterInternal(t){const e=this.targetCenter_;this.setCenterInternal([e[0]+t[0],e[1]+t[1]])}adjustResolution(t,e){e=e&&Ke(e,this.getProjection()),this.adjustResolutionInternal(t,e)}adjustResolutionInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.getViewportSize_(this.getRotation()),s=this.constraints_.resolution(this.targetResolution_*t,0,n,i);e&&(this.targetCenter_=this.calculateCenterZoom(s,e)),this.targetResolution_*=t,this.applyTargetState_()}adjustZoom(t,e){this.adjustResolution(Math.pow(this.zoomFactor_,-t),e)}adjustRotation(t,e){e&&(e=Ke(e,this.getProjection())),this.adjustRotationInternal(t,e)}adjustRotationInternal(t,e){const i=this.getAnimating()||this.getInteracting(),n=this.constraints_.rotation(this.targetRotation_+t,i);e&&(this.targetCenter_=this.calculateCenterRotate(n,e)),this.targetRotation_+=t,this.applyTargetState_()}setCenter(t){this.setCenterInternal(t&&Ke(t,this.getProjection()))}setCenterInternal(t){this.targetCenter_=t,this.applyTargetState_()}setHint(t,e){return this.hints_[t]+=e,this.changed(),this.hints_[t]}setResolution(t){this.targetResolution_=t,this.applyTargetState_()}setRotation(t){this.targetRotation_=t,this.applyTargetState_()}setZoom(t){this.setResolution(this.getResolutionForZoom(t))}applyTargetState_(t,e){const i=this.getAnimating()||this.getInteracting()||e,n=this.constraints_.rotation(this.targetRotation_,i),s=this.getViewportSize_(n),o=this.constraints_.resolution(this.targetResolution_,0,s,i),a=this.constraints_.center(this.targetCenter_,o,s,i,this.calculateCenterShift(this.targetCenter_,o,n,s));this.get(Pe.ROTATION)!==n&&this.set(Pe.ROTATION,n),this.get(Pe.RESOLUTION)!==o&&(this.set(Pe.RESOLUTION,o),this.set("zoom",this.getZoom(),!0)),(!a||!this.get(Pe.CENTER)||!nr(this.get(Pe.CENTER),a))&&this.set(Pe.CENTER,a),this.getAnimating()&&!t&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(t,e,i){t=t!==void 0?t:200;const n=e||0,s=this.constraints_.rotation(this.targetRotation_),o=this.getViewportSize_(s),a=this.constraints_.resolution(this.targetResolution_,n,o),l=this.constraints_.center(this.targetCenter_,a,o,!1,this.calculateCenterShift(this.targetCenter_,a,s,o));if(t===0&&!this.cancelAnchor_){this.targetResolution_=a,this.targetRotation_=s,this.targetCenter_=l,this.applyTargetState_();return}i=i||(t===0?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,(this.getResolution()!==a||this.getRotation()!==s||!this.getCenterInternal()||!nr(this.getCenterInternal(),l))&&(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:s,center:l,resolution:a,duration:t,easing:en,anchor:i}))}beginInteraction(){this.resolveConstraints(0),this.setHint(de.INTERACTING,1)}endInteraction(t,e,i){i=i&&Ke(i,this.getProjection()),this.endInteractionInternal(t,e,i)}endInteractionInternal(t,e,i){this.setHint(de.INTERACTING,-1),this.resolveConstraints(t,e,i)}getConstrainedCenter(t,e){const i=this.getViewportSize_(this.getRotation());return this.constraints_.center(t,e||this.getResolution(),i)}getConstrainedZoom(t,e){const i=this.getResolutionForZoom(t);return this.getZoomForResolution(this.getConstrainedResolution(i,e))}getConstrainedResolution(t,e){e=e||0;const i=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(t,e,i)}}function Bn(r,t){setTimeout(function(){r(t)},0)}function pu(r){if(r.extent!==void 0){const e=r.smoothExtentConstraint!==void 0?r.smoothExtentConstraint:!0;return Mo(r.extent,r.constrainOnlyCenter,e)}const t=Es(r.projection,"EPSG:3857");if(r.multiWorld!==!0&&t.isGlobal()){const e=t.getExtent().slice();return e[0]=-1/0,e[2]=1/0,Mo(e,!1,!1)}return hu}function mu(r){let t,e,i,o=r.minZoom!==void 0?r.minZoom:Pr,a=r.maxZoom!==void 0?r.maxZoom:28;const l=r.zoomFactor!==void 0?r.zoomFactor:2,h=r.multiWorld!==void 0?r.multiWorld:!1,u=r.smoothResolutionConstraint!==void 0?r.smoothResolutionConstraint:!0,g=r.showFullExtent!==void 0?r.showFullExtent:!1,m=Es(r.projection,"EPSG:3857"),y=m.getExtent();let w=r.constrainOnlyCenter,E=r.extent;if(!h&&!E&&m.isGlobal()&&(w=!1,E=y),r.resolutions!==void 0){const v=r.resolutions;e=v[o],i=v[a]!==void 0?v[a]:v[v.length-1],r.constrainResolution?t=uu(v,u,!w&&E,g):t=Lo(e,i,u,!w&&E,g)}else{const x=(y?Math.max(Ut(y),qe(y)):360*En.degrees/m.getMetersPerUnit())/Ms/Math.pow(2,Pr),S=x/Math.pow(2,28-Pr);e=r.maxResolution,e!==void 0?o=0:e=x/Math.pow(l,o),i=r.minResolution,i===void 0&&(r.maxZoom!==void 0?r.maxResolution!==void 0?i=e/Math.pow(l,a):i=x/Math.pow(l,a):i=S),a=o+Math.floor(Math.log(e/i)/Math.log(l)),i=e/Math.pow(l,a-o),r.constrainResolution?t=du(l,e,i,u,!w&&E,g):t=Lo(e,i,u,!w&&E,g)}return{constraint:t,maxResolution:e,minResolution:i,minZoom:o,zoomFactor:l}}function _u(r){if(r.enableRotation!==void 0?r.enableRotation:!0){const e=r.constrainRotation;return e===void 0||e===!0?gu():e===!1?No:typeof e=="number"?fu(e):No}else return ks}function yu(r){return!(r.sourceCenter&&r.targetCenter&&!nr(r.sourceCenter,r.targetCenter)||r.sourceResolution!==r.targetResolution||r.sourceRotation!==r.targetRotation)}function Dr(r,t,e,i,n){const s=Math.cos(-n);let o=Math.sin(-n),a=r[0]*s-r[1]*o,l=r[1]*s+r[0]*o;a+=(t[0]/2-e[0])*i,l+=(e[1]-t[1]/2)*i,o=-o;const h=a*s-l*o,u=l*s+a*o;return[h,u]}class Fs extends Xe{constructor(t){super();const e=t.element;e&&!t.target&&!e.style.pointerEvents&&(e.style.pointerEvents="auto"),this.element=e||null,this.target_=null,this.map_=null,this.listenerKeys=[],t.render&&(this.render=t.render),t.target&&this.setTarget(t.target)}disposeInternal(){Vr(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(t){this.map_&&Vr(this.element);for(let e=0,i=this.listenerKeys.length;e<i;++e)qt(this.listenerKeys[e]);this.listenerKeys.length=0,this.map_=t,t&&((this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==Ii&&this.listenerKeys.push(St(t,ai.POSTRENDER,this.render,this)),t.render())}render(t){}setTarget(t){this.target_=typeof t=="string"?document.getElementById(t):t}}class Eu extends Fs{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=t.collapsed!==void 0?t.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=t.collapsible!==void 0,this.collapsible_=t.collapsible!==void 0?t.collapsible:!0,this.collapsible_||(this.collapsed_=!1);const e=t.className!==void 0?t.className:"ol-attribution",i=t.tipLabel!==void 0?t.tipLabel:"Attributions",n=t.expandClassName!==void 0?t.expandClassName:e+"-expand",s=t.collapseLabel!==void 0?t.collapseLabel:"›",o=t.collapseClassName!==void 0?t.collapseClassName:e+"-collapse";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s,this.collapseLabel_.className=o):this.collapseLabel_=s;const a=t.label!==void 0?t.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(yt.CLICK,this.handleClick_.bind(this),!1);const h=e+" "+mr+" "+gs+(this.collapsed_&&this.collapsible_?" "+Bs:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=h,u.appendChild(this.toggleButton_),u.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(t){const e={},i=[];let n=!0;const s=t.layerStatesArray;for(let o=0,a=s.length;o<a;++o){const l=s[o];if(!Is(l,t.viewState))continue;const h=l.layer.getSource();if(!h)continue;const u=h.getAttributions();if(!u)continue;const g=u(t);if(g)if(n=n&&h.getAttributionsCollapsible()!==!1,Array.isArray(g))for(let m=0,y=g.length;m<y;++m)g[m]in e||(i.push(g[m]),e[g[m]]=!0);else g in e||(i.push(g),e[g]=!0)}return this.overrideCollapsible_||this.setCollapsible(n),i}updateElement_(t){if(!t){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const e=this.collectSourceAttributions_(t),i=e.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!Li(e,this.renderedAttributions_)){pl(this.ulElement_);for(let n=0,s=e.length;n<s;++n){const o=document.createElement("li");o.innerHTML=e[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}handleClick_(t){t.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(Bs),this.collapsed_?Vs(this.collapseLabel_,this.label_):Vs(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(t){this.collapsible_!==t&&(this.collapsible_=t,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(t){this.userCollapsed_=t,!(!this.collapsible_||this.collapsed_===t)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(t){this.updateElement_(t.frameState)}}class wu extends Fs{constructor(t){t=t||{},super({element:document.createElement("div"),render:t.render,target:t.target});const e=t.className!==void 0?t.className:"ol-rotate",i=t.label!==void 0?t.label:"⇧",n=t.compassClassName!==void 0?t.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const s=t.tipLabel?t.tipLabel:"Reset rotation",o=document.createElement("button");o.className=e+"-reset",o.setAttribute("type","button"),o.title=s,o.appendChild(this.label_),o.addEventListener(yt.CLICK,this.handleClick_.bind(this),!1);const a=e+" "+mr+" "+gs,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=t.resetNorth?t.resetNorth:void 0,this.duration_=t.duration!==void 0?t.duration:250,this.autoHide_=t.autoHide!==void 0?t.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Un)}handleClick_(t){t.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const e=this.getMap().getView();if(!e)return;const i=e.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?e.animate({rotation:0,duration:this.duration_,easing:en}):e.setRotation(0))}render(t){const e=t.frameState;if(!e)return;const i=e.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const s=this.element.classList.contains(Un);!s&&i===0?this.element.classList.add(Un):s&&i!==0&&this.element.classList.remove(Un)}this.label_.style.transform=n}this.rotation_=i}}class vu extends Fs{constructor(t){t=t||{},super({element:document.createElement("div"),target:t.target});const e=t.className!==void 0?t.className:"ol-zoom",i=t.delta!==void 0?t.delta:1,n=t.zoomInClassName!==void 0?t.zoomInClassName:e+"-in",s=t.zoomOutClassName!==void 0?t.zoomOutClassName:e+"-out",o=t.zoomInLabel!==void 0?t.zoomInLabel:"+",a=t.zoomOutLabel!==void 0?t.zoomOutLabel:"–",l=t.zoomInTipLabel!==void 0?t.zoomInTipLabel:"Zoom in",h=t.zoomOutTipLabel!==void 0?t.zoomOutTipLabel:"Zoom out",u=document.createElement("button");u.className=n,u.setAttribute("type","button"),u.title=l,u.appendChild(typeof o=="string"?document.createTextNode(o):o),u.addEventListener(yt.CLICK,this.handleClick_.bind(this,i),!1);const g=document.createElement("button");g.className=s,g.setAttribute("type","button"),g.title=h,g.appendChild(typeof a=="string"?document.createTextNode(a):a),g.addEventListener(yt.CLICK,this.handleClick_.bind(this,-i),!1);const m=e+" "+mr+" "+gs,y=this.element;y.className=m,y.appendChild(u),y.appendChild(g),this.duration_=t.duration!==void 0?t.duration:250}handleClick_(t,e){e.preventDefault(),this.zoomByDelta_(t)}zoomByDelta_(t){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(n!==void 0){const s=i.getConstrainedZoom(n+t);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:s,duration:this.duration_,easing:en})):i.setZoom(s)}}}function xu(r){r=r||{};const t=new Fe;return(r.zoom!==void 0?r.zoom:!0)&&t.push(new vu(r.zoomOptions)),(r.rotate!==void 0?r.rotate:!0)&&t.push(new wu(r.rotateOptions)),(r.attribution!==void 0?r.attribution:!0)&&t.push(new Eu(r.attributionOptions)),t}const Po={ACTIVE:"active"};class Nn extends Xe{constructor(t){super(),this.on,this.once,this.un,t&&t.handleEvent&&(this.handleEvent=t.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Po.ACTIVE)}getMap(){return this.map_}handleEvent(t){return!0}setActive(t){this.set(Po.ACTIVE,t)}setMap(t){this.map_=t}}function Tu(r,t,e){const i=r.getCenterInternal();if(i){const n=[i[0]+t[0],i[1]+t[1]];r.animateInternal({duration:e!==void 0?e:250,easing:mh,center:r.getConstrainedCenter(n)})}}function Gs(r,t,e,i){const n=r.getZoom();if(n===void 0)return;const s=r.getConstrainedZoom(n+t),o=r.getResolutionForZoom(s);r.getAnimating()&&r.cancelAnimations(),r.animate({resolution:o,anchor:e,duration:i!==void 0?i:250,easing:en})}class Ru extends Nn{constructor(t){super(),t=t||{},this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:250}handleEvent(t){let e=!1;if(t.type==zt.DBLCLICK){const i=t.originalEvent,n=t.map,s=t.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=n.getView();Gs(a,o,s,this.duration_),i.preventDefault(),e=!0}return!e}}class Pn extends Nn{constructor(t){t=t||{},super(t),t.handleDownEvent&&(this.handleDownEvent=t.handleDownEvent),t.handleDragEvent&&(this.handleDragEvent=t.handleDragEvent),t.handleMoveEvent&&(this.handleMoveEvent=t.handleMoveEvent),t.handleUpEvent&&(this.handleUpEvent=t.handleUpEvent),t.stopDown&&(this.stopDown=t.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(t){return!1}handleDragEvent(t){}handleEvent(t){if(!t.originalEvent)return!0;let e=!1;if(this.updateTrackedPointers_(t),this.handlingDownUpSequence){if(t.type==zt.POINTERDRAG)this.handleDragEvent(t),t.originalEvent.preventDefault();else if(t.type==zt.POINTERUP){const i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(t.type==zt.POINTERDOWN){const i=this.handleDownEvent(t);this.handlingDownUpSequence=i,e=this.stopDown(i)}else t.type==zt.POINTERMOVE&&this.handleMoveEvent(t);return!e}handleMoveEvent(t){}handleUpEvent(t){return!1}stopDown(t){return t}updateTrackedPointers_(t){t.activePointers&&(this.targetPointers=t.activePointers)}}function Us(r){const t=r.length;let e=0,i=0;for(let n=0;n<t;n++)e+=r[n].clientX,i+=r[n].clientY;return[e/t,i/t]}function os(r){const t=arguments;return function(e){let i=!0;for(let n=0,s=t.length;n<s&&(i=i&&t[n](e),!!i);++n);return i}}const bu=function(r){const t=r.originalEvent;return t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Cu=function(r){const t=r.map.getTargetElement(),e=r.map.getOwnerDocument().activeElement;return t.contains(e)},Ga=function(r){return r.map.getTargetElement().hasAttribute("tabindex")?Cu(r):!0},Su=dn,Ua=function(r){const t=r.originalEvent;return t.button==0&&!(dl&&fl&&t.ctrlKey)},qa=function(r){const t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&!t.shiftKey},Iu=function(r){const t=r.originalEvent;return!t.altKey&&!(t.metaKey||t.ctrlKey)&&t.shiftKey},Xa=function(r){const t=r.originalEvent,e=t.target.tagName;return e!=="INPUT"&&e!=="SELECT"&&e!=="TEXTAREA"&&!t.target.isContentEditable},kr=function(r){const t=r.originalEvent;return xt(t!==void 0,56),t.pointerType=="mouse"},Au=function(r){const t=r.originalEvent;return xt(t!==void 0,56),t.isPrimary&&t.button===0};class Ou extends Pn{constructor(t){super({stopDown:gr}),t=t||{},this.kinetic_=t.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const e=t.condition?t.condition:os(qa,Au);this.condition_=t.onFocusOnly?os(Ga,e):e,this.noKinetic_=!1}handleDragEvent(t){this.panning_||(this.panning_=!0,this.getMap().getView().beginInteraction());const e=this.targetPointers,i=Us(e);if(e.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(i[0],i[1]),this.lastCentroid){const n=[this.lastCentroid[0]-i[0],i[1]-this.lastCentroid[1]],o=t.map.getView();Hl(n,o.getResolution()),_s(n,o.getRotation()),o.adjustCenterInternal(n)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i,this.lastPointersCount_=e.length,t.originalEvent.preventDefault()}handleUpEvent(t){const e=t.map,i=e.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),s=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=e.getPixelFromCoordinateInternal(o),l=e.getCoordinateFromPixelInternal([a[0]-n*Math.cos(s),a[1]-n*Math.sin(s)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:en})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}else return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(t){if(this.targetPointers.length>0&&this.condition_(t)){const i=t.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}else return!1}}class Mu extends Pn{constructor(t){t=t||{},super({stopDown:gr}),this.condition_=t.condition?t.condition:bu,this.lastAngle_=void 0,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){if(!kr(t))return;const e=t.map,i=e.getView();if(i.getConstraints().rotation===ks)return;const n=e.getSize(),s=t.pixel,o=Math.atan2(n[1]/2-s[1],s[0]-n[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(t){return kr(t)?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){return kr(t)&&Ua(t)&&this.condition_(t)?(t.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class Lu extends ds{constructor(t){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+t,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const t=this.startPixel_,e=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(t[0],e[0])+i,n.top=Math.min(t[1],e[1])+i,n.width=Math.abs(e[0]-t[0])+i,n.height=Math.abs(e[1]-t[1])+i}setMap(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const e=this.element_.style;e.left="inherit",e.top="inherit",e.width="inherit",e.height="inherit"}this.map_=t,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(t,e){this.startPixel_=t,this.endPixel_=e,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const t=this.startPixel_,e=this.endPixel_,n=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new mi([n])}getGeometry(){return this.geometry_}}const Hn={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class Fr extends ti{constructor(t,e,i){super(t),this.coordinate=e,this.mapBrowserEvent=i}}class Nu extends Pn{constructor(t){super(),this.on,this.once,this.un,t=t||{},this.box_=new Lu(t.className||"ol-dragbox"),this.minArea_=t.minArea!==void 0?t.minArea:64,t.onBoxEnd&&(this.onBoxEnd=t.onBoxEnd),this.startPixel_=null,this.condition_=t.condition?t.condition:Ua,this.boxEndCondition_=t.boxEndCondition?t.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(t,e,i){const n=i[0]-e[0],s=i[1]-e[1];return n*n+s*s>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(t){this.box_.setPixels(this.startPixel_,t.pixel),this.dispatchEvent(new Fr(Hn.BOXDRAG,t.coordinate,t))}handleUpEvent(t){this.box_.setMap(null);const e=this.boxEndCondition_(t,this.startPixel_,t.pixel);return e&&this.onBoxEnd(t),this.dispatchEvent(new Fr(e?Hn.BOXEND:Hn.BOXCANCEL,t.coordinate,t)),!1}handleDownEvent(t){return this.condition_(t)?(this.startPixel_=t.pixel,this.box_.setMap(t.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new Fr(Hn.BOXSTART,t.coordinate,t)),!0):!1}onBoxEnd(t){}}class Pu extends Nu{constructor(t){t=t||{};const e=t.condition?t.condition:Iu;super({condition:e,className:t.className||"ol-dragzoom",minArea:t.minArea}),this.duration_=t.duration!==void 0?t.duration:200,this.out_=t.out!==void 0?t.out:!1}onBoxEnd(t){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const s=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(s),a=i.getResolution()/o;n=n.clone(),n.scale(a*a)}i.fitInternal(n,{duration:this.duration_,easing:en})}}const yi={LEFT:37,UP:38,RIGHT:39,DOWN:40};class Du extends Nn{constructor(t){super(),t=t||{},this.defaultCondition_=function(e){return qa(e)&&Xa(e)},this.condition_=t.condition!==void 0?t.condition:this.defaultCondition_,this.duration_=t.duration!==void 0?t.duration:100,this.pixelDelta_=t.pixelDelta!==void 0?t.pixelDelta:128}handleEvent(t){let e=!1;if(t.type==yt.KEYDOWN){const i=t.originalEvent,n=i.keyCode;if(this.condition_(t)&&(n==yi.DOWN||n==yi.LEFT||n==yi.RIGHT||n==yi.UP)){const o=t.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,h=0;n==yi.DOWN?h=-a:n==yi.LEFT?l=-a:n==yi.RIGHT?l=a:h=a;const u=[l,h];_s(u,o.getRotation()),Tu(o,u,this.duration_),i.preventDefault(),e=!0}}return!e}}class ku extends Nn{constructor(t){super(),t=t||{},this.condition_=t.condition?t.condition:Xa,this.delta_=t.delta?t.delta:1,this.duration_=t.duration!==void 0?t.duration:100}handleEvent(t){let e=!1;if(t.type==yt.KEYDOWN||t.type==yt.KEYPRESS){const i=t.originalEvent,n=i.charCode;if(this.condition_(t)&&(n==43||n==45)){const s=t.map,o=n==43?this.delta_:-this.delta_,a=s.getView();Gs(a,o,void 0,this.duration_),i.preventDefault(),e=!0}}return!e}}class Fu{constructor(t,e,i){this.decay_=t,this.minVelocity_=e,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(t,e){this.points_.push(t,e,Date.now())}end(){if(this.points_.length<6)return!1;const t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;let i=e-3;for(;i>0&&this.points_[i+2]>t;)i-=3;const n=this.points_[e+2]-this.points_[i+2];if(n<1e3/60)return!1;const s=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];return this.angle_=Math.atan2(o,s),this.initialVelocity_=Math.sqrt(s*s+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}class Gu extends Nn{constructor(t){t=t||{},super(t),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=t.maxDelta!==void 0?t.maxDelta:1,this.duration_=t.duration!==void 0?t.duration:250,this.timeout_=t.timeout!==void 0?t.timeout:80,this.useAnchor_=t.useAnchor!==void 0?t.useAnchor:!0,this.constrainResolution_=t.constrainResolution!==void 0?t.constrainResolution:!1;const e=t.condition?t.condition:Su;this.condition_=t.onFocusOnly?os(Ga,e):e,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const t=this.getMap();if(!t)return;t.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(t){if(!this.condition_(t)||t.type!==yt.WHEEL)return!0;const i=t.map,n=t.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=t.coordinate);let s;if(t.type==yt.WHEEL&&(s=n.deltaY,hl&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(s/=Wo),n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(s*=40)),s===0)return!1;this.lastDelta_=s;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(s)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-s/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=o,!1;this.totalDelta_+=s;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(t){const e=t.getView();e.getAnimating()&&e.cancelAnimations();let i=-Zt(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(e.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),Gs(e,i,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(t){this.useAnchor_=t,t||(this.lastAnchor_=null)}}class Uu extends Pn{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=gr),super(e),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=t.threshold!==void 0?t.threshold:.3,this.duration_=t.duration!==void 0?t.duration:250}handleDragEvent(t){let e=0;const i=this.targetPointers[0],n=this.targetPointers[1],s=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const u=s-this.lastAngle_;this.rotationDelta_+=u,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),e=u}this.lastAngle_=s;const o=t.map,a=o.getView();if(a.getConstraints().rotation===ks)return;const l=o.getViewport().getBoundingClientRect(),h=Us(this.targetPointers);h[0]-=l.left,h[1]-=l.top,this.anchor_=o.getCoordinateFromPixelInternal(h),this.rotating_&&(o.render(),a.adjustRotationInternal(e,this.anchor_))}handleUpEvent(t){return this.targetPointers.length<2?(t.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1}}class qu extends Pn{constructor(t){t=t||{};const e=t;e.stopDown||(e.stopDown=gr),super(e),this.anchor_=null,this.duration_=t.duration!==void 0?t.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(t){let e=1;const i=this.targetPointers[0],n=this.targetPointers[1],s=i.clientX-n.clientX,o=i.clientY-n.clientY,a=Math.sqrt(s*s+o*o);this.lastDistance_!==void 0&&(e=this.lastDistance_/a),this.lastDistance_=a;const l=t.map,h=l.getView();e!=1&&(this.lastScaleDelta_=e);const u=l.getViewport().getBoundingClientRect(),g=Us(this.targetPointers);g[0]-=u.left,g[1]-=u.top,this.anchor_=l.getCoordinateFromPixelInternal(g),l.render(),h.adjustResolutionInternal(e,this.anchor_)}handleUpEvent(t){if(this.targetPointers.length<2){const i=t.map.getView(),n=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,n),!1}else return!0}handleDownEvent(t){if(this.targetPointers.length>=2){const e=t.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||e.getView().beginInteraction(),!0}else return!1}}function Xu(r){r=r||{};const t=new Fe,e=new Fu(-.005,.05,100);return(r.altShiftDragRotate!==void 0?r.altShiftDragRotate:!0)&&t.push(new Mu),(r.doubleClickZoom!==void 0?r.doubleClickZoom:!0)&&t.push(new Ru({delta:r.zoomDelta,duration:r.zoomDuration})),(r.dragPan!==void 0?r.dragPan:!0)&&t.push(new Ou({onFocusOnly:r.onFocusOnly,kinetic:e})),(r.pinchRotate!==void 0?r.pinchRotate:!0)&&t.push(new Uu),(r.pinchZoom!==void 0?r.pinchZoom:!0)&&t.push(new qu({duration:r.zoomDuration})),(r.keyboard!==void 0?r.keyboard:!0)&&(t.push(new Du),t.push(new ku({delta:r.zoomDelta,duration:r.zoomDuration}))),(r.mouseWheelZoom!==void 0?r.mouseWheelZoom:!0)&&t.push(new Gu({onFocusOnly:r.onFocusOnly,duration:r.zoomDuration})),(r.shiftDragZoom!==void 0?r.shiftDragZoom:!0)&&t.push(new Pu({duration:r.zoomDuration})),t}function ja(r){if(r instanceof Tr){r.setMapInternal(null);return}r instanceof tn&&r.getLayers().forEach(ja)}function Ya(r,t){if(r instanceof Tr){r.setMapInternal(t);return}if(r instanceof tn){const e=r.getLayers().getArray();for(let i=0,n=e.length;i<n;++i)Ya(e[i],t)}}class ju extends Xe{constructor(t){super(),t=t||{},this.on,this.once,this.un;const e=Yu(t);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=t.maxTilesLoading!==void 0?t.maxTilesLoading:16,this.pixelRatio_=t.pixelRatio!==void 0?t.pixelRatio:Wo,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=Ge(),this.pixelToCoordinateTransform_=Ge(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=t.moveTolerance,this.keyboardEventTarget_=e.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.controls=e.controls||xu(),this.interactions=e.interactions||Xu({onFocusOnly:!0}),this.overlays_=e.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new lu(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(ue.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(ue.VIEW,this.handleViewChanged_),this.addChangeListener(ue.SIZE,this.handleSizeChanged_),this.addChangeListener(ue.TARGET,this.handleTargetChanged_),this.setProperties(e.values);const i=this;t.view&&!(t.view instanceof ci)&&t.view.then(function(n){i.setView(new ci(n))}),this.controls.addEventListener(_e.ADD,(function(n){n.element.setMap(this)}).bind(this)),this.controls.addEventListener(_e.REMOVE,(function(n){n.element.setMap(null)}).bind(this)),this.interactions.addEventListener(_e.ADD,(function(n){n.element.setMap(this)}).bind(this)),this.interactions.addEventListener(_e.REMOVE,(function(n){n.element.setMap(null)}).bind(this)),this.overlays_.addEventListener(_e.ADD,(function(n){this.addOverlayInternal_(n.element)}).bind(this)),this.overlays_.addEventListener(_e.REMOVE,(function(n){const s=n.element.getId();s!==void 0&&delete this.overlayIdIndex_[s.toString()],n.element.setMap(null)}).bind(this)),this.controls.forEach((function(n){n.setMap(this)}).bind(this)),this.interactions.forEach((function(n){n.setMap(this)}).bind(this)),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(t){this.getControls().push(t)}addInteraction(t){this.getInteractions().push(t)}addLayer(t){this.getLayerGroup().getLayers().push(t)}handleLayerAdd_(t){Ya(t.layer,this)}addOverlay(t){this.getOverlays().push(t)}addOverlayInternal_(t){const e=t.getId();e!==void 0&&(this.overlayIdIndex_[e.toString()]=t),t.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(t,e,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(t);i=i!==void 0?i:{};const s=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:dn,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,s,a,e,null,o,null)}getFeaturesAtPixel(t,e){const i=[];return this.forEachFeatureAtPixel(t,function(n){i.push(n)},e),i}getAllLayers(){const t=[];function e(i){i.forEach(function(n){n instanceof tn?e(n.getLayers()):t.push(n)})}return e(this.getLayers()),t}hasFeatureAtPixel(t,e){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(t);e=e!==void 0?e:{};const n=e.layerFilter!==void 0?e.layerFilter:dn,s=e.hitTolerance!==void 0?e.hitTolerance:0,o=e.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,s,o,n,null)}getEventCoordinate(t){return this.getCoordinateFromPixel(this.getEventPixel(t))}getEventCoordinateInternal(t){return this.getCoordinateFromPixelInternal(this.getEventPixel(t))}getEventPixel(t){const e=this.viewport_.getBoundingClientRect(),i="changedTouches"in t?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]}getTarget(){return this.get(ue.TARGET)}getTargetElement(){const t=this.getTarget();return t!==void 0?typeof t=="string"?document.getElementById(t):t:null}getCoordinateFromPixel(t){return Kr(this.getCoordinateFromPixelInternal(t),this.getView().getProjection())}getCoordinateFromPixelInternal(t){const e=this.frameState_;return e?oe(e.pixelToCoordinateTransform,t.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(t){const e=this.overlayIdIndex_[t.toString()];return e!==void 0?e:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(ue.LAYERGROUP)}setLayers(t){const e=this.getLayerGroup();if(t instanceof Fe){e.setLayers(t);return}const i=e.getLayers();i.clear(),i.extend(t)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const n=t[e];if(!n.visible)continue;const s=n.layer.getRenderer();if(s&&!s.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(t){const e=Ke(t,this.getView().getProjection());return this.getPixelFromCoordinateInternal(e)}getPixelFromCoordinateInternal(t){const e=this.frameState_;return e?oe(e.coordinateToPixelTransform,t.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(ue.SIZE)}getView(){return this.get(ue.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const t=this.getTargetElement();return t?t.ownerDocument:document}getTilePriority(t,e,i,n){return cu(this.frameState_,t,e,i,n)}handleBrowserEvent(t,e){e=e||t.type;const i=new oi(e,this,t);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(t){if(!this.frameState_)return;const e=t.originalEvent,i=e.type;if(i===ss.POINTERDOWN||i===yt.WHEEL||i===yt.KEYDOWN){const n=this.getOwnerDocument(),s=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=e.target;if(this.overlayContainerStopEvent_.contains(o)||!(s===n?n.documentElement:s).contains(o))return}if(t.frameState=this.frameState_,this.dispatchEvent(t)!==!1){const n=this.getInteractions().getArray().slice();for(let s=n.length-1;s>=0;s--){const o=n[s];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(t)||t.propagationStopped)break}}}handlePostRender(){const t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){let n=this.maxTilesLoading_,s=n;if(t){const o=t.viewHints;if(o[de.ANIMATING]||o[de.INTERACTING]){const a=Date.now()-t.time>8;n=a?0:8,s=a?0:2}}e.getTilesLoading()<n&&(e.reprioritize(),e.loadMoreTiles(n,s))}t&&this.renderer_&&!t.animate&&(this.renderComplete_===!0?(this.hasListener(di.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(di.RENDERCOMPLETE,t),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new ji(ai.LOADEND,this,t)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new ji(ai.LOADSTART,this,t))));const i=this.postRenderFunctions_;for(let n=0,s=i.length;n<s;++n)i[n](this,t);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let e=0,i=this.targetChangeHandlerKeys_.length;e<i;++e)qt(this.targetChangeHandlerKeys_[e]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(yt.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(yt.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,Vr(this.viewport_)}const t=this.getTargetElement();if(!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new su(this)),this.mapBrowserEventHandler_=new ou(this,this.moveTolerance_);for(const n in zt)this.mapBrowserEventHandler_.addEventListener(zt[n],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(yt.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(yt.WHEEL,this.boundHandleBrowserEvent_,Bo?{passive:!1}:!1);const e=this.getOwnerDocument().defaultView,i=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.targetChangeHandlerKeys_=[St(i,yt.KEYDOWN,this.handleBrowserEvent,this),St(i,yt.KEYPRESS,this.handleBrowserEvent,this),St(e,yt.RESIZE,this.updateSize,this)]}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(qt(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(qt(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const t=this.getView();t&&(this.updateViewportSize_(),this.viewPropertyListenerKey_=St(t,Hi.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=St(t,yt.CHANGE,this.handleViewPropertyChanged_,this),t.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(qt),this.layerGroupPropertyListenerKeys_=null);const t=this.getLayerGroup();t&&(this.handleLayerAdd_(new li("addlayer",t)),this.layerGroupPropertyListenerKeys_=[St(t,Hi.PROPERTYCHANGE,this.render,this),St(t,yt.CHANGE,this.render,this),St(t,"addlayer",this.handleLayerAdd_,this),St(t,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const t=this.getLayerGroup().getLayerStatesArray();for(let e=0,i=t.length;e<i;++e){const n=t[e].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(t){return this.getControls().remove(t)}removeInteraction(t){return this.getInteractions().remove(t)}removeLayer(t){return this.getLayerGroup().getLayers().remove(t)}handleLayerRemove_(t){ja(t.layer)}removeOverlay(t){return this.getOverlays().remove(t)}renderFrame_(t){const e=this.getSize(),i=this.getView(),n=this.frameState_;let s=null;if(e!==void 0&&Ys(e)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:Xr(a.center,a.resolution,a.rotation,e),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:e,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:Lt(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;s.nextExtent=Xr(a.nextCenter,a.nextResolution,l,e)}}this.frameState_=s,this.renderer_.renderFrame(s),s&&(s.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions),n&&(!this.previousExtent_||!cs(this.previousExtent_)&&!un(s.extent,this.previousExtent_))&&(this.dispatchEvent(new ji(ai.MOVESTART,this,n)),this.previousExtent_=bn(this.previousExtent_)),this.previousExtent_&&!s.viewHints[de.ANIMATING]&&!s.viewHints[de.INTERACTING]&&!un(s.extent,this.previousExtent_)&&(this.dispatchEvent(new ji(ai.MOVEEND,this,s)),ko(s.extent,this.previousExtent_))),this.dispatchEvent(new ji(ai.POSTRENDER,this,s)),this.renderComplete_=this.hasListener(ai.LOADSTART)||this.hasListener(ai.LOADEND)||this.hasListener(di.RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(t){const e=this.getLayerGroup();e&&this.handleLayerRemove_(new li("removelayer",e)),this.set(ue.LAYERGROUP,t)}setSize(t){this.set(ue.SIZE,t)}setTarget(t){this.set(ue.TARGET,t)}setView(t){if(!t||t instanceof ci){this.set(ue.VIEW,t);return}this.set(ue.VIEW,new ci);const e=this;t.then(function(i){e.setView(new ci(i))})}updateSize(){const t=this.getTargetElement();let e;if(t){const i=getComputedStyle(t),n=t.offsetWidth-parseFloat(i.borderLeftWidth)-parseFloat(i.paddingLeft)-parseFloat(i.paddingRight)-parseFloat(i.borderRightWidth),s=t.offsetHeight-parseFloat(i.borderTopWidth)-parseFloat(i.paddingTop)-parseFloat(i.paddingBottom)-parseFloat(i.borderBottomWidth);!isNaN(n)&&!isNaN(s)&&(e=[n,s],!Ys(e)&&(t.offsetWidth||t.offsetHeight||t.getClientRects().length)&&console.warn("No map visible because the map container's width or height are 0."))}this.setSize(e),this.updateViewportSize_()}updateViewportSize_(){const t=this.getView();if(t){let e;const i=getComputedStyle(this.viewport_);i.width&&i.height&&(e=[parseInt(i.width,10),parseInt(i.height,10)]),t.setViewportSize(e)}}}function Yu(r){let t=null;r.keyboardEventTarget!==void 0&&(t=typeof r.keyboardEventTarget=="string"?document.getElementById(r.keyboardEventTarget):r.keyboardEventTarget);const e={},i=r.layers&&typeof r.layers.getLayers=="function"?r.layers:new tn({layers:r.layers});e[ue.LAYERGROUP]=i,e[ue.TARGET]=r.target,e[ue.VIEW]=r.view instanceof ci?r.view:new ci;let n;r.controls!==void 0&&(Array.isArray(r.controls)?n=new Fe(r.controls.slice()):(xt(typeof r.controls.getArray=="function",47),n=r.controls));let s;r.interactions!==void 0&&(Array.isArray(r.interactions)?s=new Fe(r.interactions.slice()):(xt(typeof r.interactions.getArray=="function",48),s=r.interactions));let o;return r.overlays!==void 0?Array.isArray(r.overlays)?o=new Fe(r.overlays.slice()):(xt(typeof r.overlays.getArray=="function",49),o=r.overlays):o=new Fe,{controls:n,interactions:s,keyboardEventTarget:t,overlays:o,values:e}}class zu extends Ns{constructor(t){super({attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Vu,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate!==void 0?t.interpolate:!0,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.crossOrigin=t.crossOrigin!==void 0?t.crossOrigin:null,this.tileClass=t.tileClass!==void 0?t.tileClass:Ma,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1}expireCache(t,e){const i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(const n in this.tileCacheForProjection){const s=this.tileCacheForProjection[n];s.expireCache(s==i?e:{})}}getGutterForProjection(t){return this.getProjection()&&t&&!wi(this.getProjection(),t)?0:this.getGutter()}getGutter(){return 0}getKey(){let t=super.getKey();return this.getInterpolate()||(t+=":disable-interpolation"),t}getOpaque(t){return this.getProjection()&&t&&!wi(this.getProjection(),t)?!1:super.getOpaque(t)}getTileGridForProjection(t){const e=this.getProjection();if(this.tileGrid&&(!e||wi(e,t)))return this.tileGrid;{const i=Lt(t);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=ka(t)),this.tileGridForProjection[i]}}getTileCacheForProjection(t){const e=this.getProjection();if(!e||wi(e,t))return this.tileCache;{const i=Lt(t);return i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new Pa(this.tileCache.highWaterMark)),this.tileCacheForProjection[i]}}createTile_(t,e,i,n,s,o){const a=[t,e,i],l=this.getTileCoordForTileUrlFunction(a,s),h=l?this.tileUrlFunction(l,n,s):void 0,u=new this.tileClass(a,h!==void 0?dt.IDLE:dt.EMPTY,h!==void 0?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return u.key=o,u.addEventListener(yt.CHANGE,this.handleTileChange.bind(this)),u}getTile(t,e,i,n,s){const o=this.getProjection();if(!o||!s||wi(o,s))return this.getTileInternal(t,e,i,n,o||s);{const a=this.getTileCacheForProjection(s),l=[t,e,i];let h;const u=Na(l);a.containsKey(u)&&(h=a.get(u));const g=this.getKey();if(h&&h.key==g)return h;{const m=this.getTileGridForProjection(o),y=this.getTileGridForProjection(s),w=this.getTileCoordForTileUrlFunction(l,s),E=new is(o,m,s,y,l,w,this.getTilePixelRatio(n),this.getGutter(),(function(v,x,S,R){return this.getTileInternal(v,x,S,R,o)}).bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.getInterpolate());return E.key=g,h?(E.interimTile=h,E.refreshInterimChain(),a.replace(u,E)):a.set(u,E),E}}}getTileInternal(t,e,i,n,s){let o=null;const a=Rr(t,e,i),l=this.getKey();if(!this.tileCache.containsKey(a))o=this.createTile_(t,e,i,n,s,l),this.tileCache.set(a,o);else if(o=this.tileCache.get(a),o.key!=l){const h=o;o=this.createTile_(t,e,i,n,s,l),h.getState()==dt.IDLE?o.interimTile=h.interimTile:o.interimTile=h,o.refreshInterimChain(),this.tileCache.replace(a,o)}return o}setRenderReprojectionEdges(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(const e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}}setTileGridForProjection(t,e){const i=Bt(t);if(i){const n=Lt(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=e)}}clear(){super.clear();for(const t in this.tileCacheForProjection)this.tileCacheForProjection[t].clear()}}function Vu(r,t){r.getImage().src=t}class Wu extends Tr{constructor(t){t=t||{};const e=Object.assign({},t);delete e.preload,delete e.useInterimTilesOnError,super(e),this.on,this.once,this.un,this.setPreload(t.preload!==void 0?t.preload:0),this.setUseInterimTilesOnError(t.useInterimTilesOnError!==void 0?t.useInterimTilesOnError:!0)}getPreload(){return this.get(Vn.PRELOAD)}setPreload(t){this.set(Vn.PRELOAD,t)}getUseInterimTilesOnError(){return this.get(Vn.USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(t){this.set(Vn.USE_INTERIM_TILES_ON_ERROR,t)}getData(t){return super.getData(t)}}class Bu extends Wu{constructor(t){super(t)}createRenderer(){return new Rh(this)}}class Hu extends zu{constructor(t){t=t||{};const e=t.projection!==void 0?t.projection:"EPSG:3857",i=t.tileGrid!==void 0?t.tileGrid:Nh({extent:Ls(e),maxResolution:t.maxResolution,maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:t.tileSize});super({attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,opaque:t.opaque,projection:e,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX!==void 0?t.wrapX:!0,transition:t.transition,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection}),this.gutter_=t.gutter!==void 0?t.gutter:0}getGutter(){return this.gutter_}}const $u='&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.';class Ku extends Hu{constructor(t){t=t||{};let e;t.attributions!==void 0?e=t.attributions:e=[$u];const i=t.crossOrigin!==void 0?t.crossOrigin:"anonymous",n=t.url!==void 0?t.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:e,attributionsCollapsible:!1,cacheSize:t.cacheSize,crossOrigin:i,interpolate:t.interpolate,maxZoom:t.maxZoom!==void 0?t.maxZoom:19,opaque:t.opaque!==void 0?t.opaque:!0,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,transition:t.transition,url:n,wrapX:t.wrapX,zDirection:t.zDirection})}}const Bi=(r,t,e,i,n=5)=>{const s=[r,t];typeof window.$barry.layers[i]<"u"&&window.$barry.map.removeLayer(window.$barry.layers[i]),i.startsWith("place")&&(window.$barry.places[i]=s,window.$barry.canCalculate());const o=new Ai(s),a=new Mn(o);a.setId(i);const l=new As({source:new Sa({features:[a]}),style:new gi({image:new In({radius:n,fill:new Qi({color:e})})})});window.$barry.layers[i]=l,window.$barry.map.addLayer(l)},Zu=(r,t,e,i=3)=>{typeof window.$barry.layers[e]<"u"&&window.$barry.map.removeLayer(window.$barry.layers[e]);const n=new jh,s=new Mn({geometry:n.readGeometry(r)});s.setId(e),s.setStyle(new gi({stroke:new An({color:t,width:i})}));const o=new Sa({features:[s]}),a=new As({source:o});window.$barry.layers[e]=a,window.$barry.map.addLayer(a)},Ju=(r,t,e)=>{const i=Object.keys(window.$barry.places),n=[];for(let s=0;s<i.length;s++)i[s].startsWith("place")&&n.push(new Promise(o=>{zr(window.$barry.places[i[s]],r,s).then(a=>{const l=a.totalTime,h=Math.floor(l/3600),u=Math.floor(l/60%60);Zu(a.routeGeometry,window.$barry.roadColor,`route_${a.key}`),window.$barry.log(`
<span onmouseenter="window.$barry.showNav('route_${a.key}', 1);"
      onmouseleave="window.$barry.showNav('route_${a.key}', 0)"
      onclick="window.$barry.zoom([[${a.bbox.top}, ${a.bbox.left}],[${a.bbox.bottom}, ${a.bbox.right}]])"
>
  De 
  <b>
    ${document.querySelector(`input[data-city="${i[s]}"]`).value}
  </b>
  , il y 
  <b>
    ${Math.round(100*Number.parseFloat(a.totalDistance)/1e3)/100}
  </b>
  km en
  <b>
    ${h} h ${u<10?`0${u}`:u}
  </b>
</span>`),o()})}));window.$barry.log("Je calcule le trajet pour chaque ville.",1),Promise.all(n).then(()=>{Bi(r[0],r[1],t,e)})},Qu=r=>new Promise(t=>{hs.Services.reverseGeocode({position:{x:r[0],y:r[1]},filterOptions:{type:["PositionOfInterest"],circle:{x:r[0],y:r[1],radius:4}},apiKey:"calcul",onSuccess:e=>{let i=!1;e.locations.forEach((n,s)=>{var o,a;(a=(o=n.placeAttributes)==null?void 0:o.extrafields)!=null&&a.cleabs.startsWith("COMMUNE_")&&!i&&(i=!0,window.$barry.log(`On se retrouve donc à <b>${n.placeAttributes.name}</b>`),t([n.position.lon,n.position.lat]))}),t(r)},onFailure:e=>{alert(e),t(r)}})}),td=()=>new Promise((r,t)=>{window.$barry.log("Je calcule tous les chemins !",1);const e=[],i=Object.keys(window.$barry.places);for(let n=0;n<i.length;n++)for(let s=n+1;s<i.length;s++)i[n].startsWith("place")&&i[s].startsWith("place")&&e.push(zr(window.$barry.places[i[n]],window.$barry.places[i[s]],`${i[n]};${i[s]}`));Promise.all(e).then(n=>{let s=0,o=0,a=n[0].key;for(let h=0;h<n.length;h++){const u=Number.parseFloat(n[h].totalTime),g=Number.parseFloat(n[h].totalDistance),m=Math.floor(u/3600),y=Math.floor(u/60%60),w=n[h].key.split(";");window.$barry.log(`Entre "${document.querySelector(`input[data-city="${w[0]}"]`).value}" et "${document.querySelector(`input[data-city="${w[1]}"]`).value}" il y a ${Math.round(100*g/1e3)/100} km en ${m}h${y<10?`0${y}`:y}`,1),(window.$barry.calculateMode==="time"&&u>o||window.$barry.calculateMode==="distance"&&g>s)&&(s=g,o=u,a=n[h].key)}const l=a.split(";");window.$barry.log(`Le trajet le plus long (en ${window.$barry.calculateMode==="time"?"temps":"distance"}) est donc entre "${document.querySelector(`input[data-city="${l[0]}"]`).value}" et "${document.querySelector(`input[data-city="${l[1]}"]`).value}"`,1),window.$barry.log("Je calcule le point à mi-temps.",1),l.length>1?zr(window.$barry.places[l[0]],window.$barry.places[l[1]],"",!0).then(h=>{let u=null;const g=h.routeInstructions.length;let m=0,y=0;const w=Math.round(o/2),E=Math.round(s/2);for(let v=0;v<g&&(y+=Number.parseFloat(h.routeInstructions[v].distance),m+=Number.parseFloat(h.routeInstructions[v].duration),u=h.routeInstructions[v],!(window.$barry.calculateMode==="time"&&m>w||window.$barry.calculateMode==="distance"&&y>E));v++);if(u!=null){let v=0;window.$barry.calculateMode==="time"?v=(m-w)/Number.parseFloat(u.duration):window.$barry.calculateMode==="distance"&&(v=(y-E)/Number.parseFloat(u.distance)),window.$barry.log("Le point est trouvé.",1),r(u.geometry.coordinates[Math.round((1-v)*u.geometry.coordinates.length)])}}):t("Pas de point trouvé")})});function ed(){return new Promise(r=>{const t=Object.keys(window.$barry.places);let e=0,i=0;for(let n=0;n<t.length;n++)t[n].startsWith("place")&&(e+=Number.parseFloat(window.$barry.places[t[n]][0]),i+=Number.parseFloat(window.$barry.places[t[n]][1]));e/=t.length,i/=t.length,window.$barry.log("Je fais la moyenne des coordonnées des villes.",1),r([e,i])})}const id=()=>new Promise(r=>{const t=window.$barry.calcBox();window.$barry.log("Je détermine les latitudes et longitudes minimales et maximales pour définir un cadre et je calcule le centre du cadre.",1),r([(t[1][1]+t[0][1])/2,(t[1][0]+t[0][0])/2])});window.$barry.calculate=()=>{window.$barry.$logContent.innerHTML="",window.$barry.$log.classList.remove("hide"),window.$barry.$spinner.classList.remove("hide"),window.$barry.$rappel.classList.add("hide");const r=[];r.push(window.$barry.calculateMode),document.querySelectorAll(".address").forEach((n,s)=>{const o=n.querySelector("input").value;o==""?window.$barry.removeAddress(n.id):(r.push(o),n.querySelectorAll("button").forEach((a,l)=>a.classList.add("hide")))}),window.location.hash=btoa(r.join("|")),window.$barry.log("C'est parti pour rechercher votre point de rencontre équitable");const t=[td(),ed(),id()],e=["longMiddle","average","center"],i=[13,2,1];Promise.all(t).then(n=>{window.$barry.log("J'ai fini les différents calculs, je prend maintenant la moyenne des coordonnées.",1);let s=0,o=0,a=0;Object.keys(window.$barry.places).length>2?(n.map((l,h)=>{for(let u=0;u<i[h];u++)s+=Number.parseFloat(l[0]),o+=Number.parseFloat(l[1]),a++;Bi(l[0],l[1],window.$barry.methods[e[h]].color,e[h])}),s/=a,o/=a):n&&(s=n[0][0],o=n[0][1],Bi(s,o,window.$barry.methods[e[0]].color,e[0])),window.$barry.log(`On se retrouve à [${s}, ${o}]`,1),window.$barry.log("Je cherche la ville la plus proche du point.",1),Bi(s,o,window.$barry.resultColor,"result"),Qu([s,o]).then(l=>{l[0]===l[1]&&l[0]===0?window.$barry.log("Pas de ville trouvée proche, je suis désolé mais va falloir le faire à la main."):(Ju(l,window.$barry.resultColor,"result"),dr(),window.$barry.meetPoint=l,window.$barry.$pois.classList.remove("hide")),window.$barry.$spinner.classList.add("hide"),window.$barry.$calculate.classList.add("hide"),window.$barry.$newsearch.classList.remove("hide")})})};window.$barry.canCalculate=()=>{Object.keys(window.$barry.places).length>1?window.$barry.$calculate.classList.remove("hide"):window.$barry.$calculate.classList.add("hide")};window.$barry.canPlace=r=>{window.$barry.addressToCalc[r]=!0};window.$barry.changeCalcMode=()=>{window.$barry.calculateMode==="time"?window.$barry.calculateMode="distance":window.$barry.calculateMode="time"};window.$barry.changeCalcTransport=()=>{window.$barry.calculateTransport==="Voiture"?window.$barry.calculateTransport="Pieton":window.$barry.calculateTransport="Voiture"};window.$barry.changeCalcToll=()=>{window.$barry.calculateToll=!window.$barry.calculateToll};window.$barry.changeLogMode=()=>{window.$barry.$log.querySelectorAll(".log-1").forEach((r,t)=>{window.$barry.$toggleLogMode.checked?r.classList.remove("hide"):r.classList.add("hide")})};window.$barry.log=(r,t)=>{let e=t;typeof t>"u"&&(e=0),window.$barry.$logContent.innerHTML+=`<p class="log-${e}${e>0?" hide":""}">${r}</p>`};window.$barry.managePOI=r=>{Object.keys(window.$barry.layers).forEach((t,e)=>{t.startsWith("poi_")&&window.$barry.map.removeLayer(window.$barry.layers[t])});for(const t in window.$barry.pois){const e=window.$barry.pois[t];e.categories.includes(r)&&Bi(e.longitude,e.latitude,"#131282",`poi_${e.identifier}`,3)}};window.$barry.newAddress=r=>{if(typeof r<"u"){const e=document.getElementById(r);e.querySelector(".plus").classList.toggle("hide"),e.querySelector(".minus").classList.toggle("hide")}const t=document.createElement("div");t.classList.add("address"),t.id=`address_${window.$barry.addressesCount}`,t.innerHTML=`
<input type="text"
       placeholder="Adresse postale"
       onfocus="window.$barry.canPlace('place_${window.$barry.addressesCount}')"
       onblur="window.$barry.placePoint(this.value, 'place_${window.$barry.addressesCount}');"
       onkeydown="window.$barry.calcAddress(event, '${window.$barry.addressesCount}', this.value)"
       data-city="place_${window.$barry.addressesCount}" />
<button class="minus hide" 
        onclick="window.$barry.removeAddress('address_${window.$barry.addressesCount}')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd" />
    </svg>
</button>
<button class="plus" 
        onclick="window.$barry.newAddress('address_${window.$barry.addressesCount}')">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
    </svg>
</button>
      `,window.$barry.$addressesWrapper.appendChild(t),window.$barry.addressesCount++,window.$barry.nbPlaces++};const za=()=>{dr([[51.31133241804094,-4.369239747680932],[42.14745185055437,8.623599144082085]])};window.$barry.newSearch=()=>{window.$barry.$log.classList.add("hide"),window.$barry.$newsearch.classList.add("hide"),window.$barry.$rappel.classList.remove("hide"),document.querySelectorAll(".address").forEach((r,t)=>{r.parentNode.removeChild(r)}),window.$barry.addressesCount=0,window.$barry.places={},Object.keys(window.$barry.layers).forEach((r,t)=>{window.$barry.map.removeLayer(window.$barry.layers[r])}),window.$barry.layers={},window.$barry.newAddress(),za(),window.$barry.$pois.classList.remove("hide"),window.$barry.pois=[],window.location.hash=""};const nd=(r,t)=>{if(r.trim()!=="")return hs.Services.geocode({location:r,ssl:!0,apiKey:"essentiels",onSuccess:e=>{Bi(e.locations[0].position.lon,e.locations[0].position.lat,window.$barry.addressColor,t)},onFailure:e=>{alert(e)}});window.$barry.canCalculate()};window.$barry.placePoint=(r,t)=>{window.$barry.addressToCalc[t]&&window.$barry.$newsearch.classList.contains("hide")&&(window.$barry.addressToCalc[t]=!1,window.$barry.$calculate.classList.add("hide"),nd(r,t))};window.$barry.removeAddress=r=>{let t=r;window.$barry.nbPlaces--;const e=document.getElementById(r);e.parentNode.removeChild(e),t=r.replace("address_","place_"),delete window.$barry.places[t],window.$barry.map.removeLayer(window.$barry.layers[t]),delete window.$barry.layers[t]};window.$barry.showPOI=r=>{document.querySelectorAll("#pois a").forEach((t,e)=>t.classList.remove("active")),document.querySelector(`#pois a[data-cat="${r}"]`).classList.add("active"),Object.keys(window.$barry.pois).length==0?window.$barry.tourisme().then(t=>{t.forEach((e,i)=>{window.$barry.pois[`poi_${e.identifier}`]=e}),window.$barry.managePOI(r)}):window.$barry.managePOI(r)};window.$barry.showNav=(r,t)=>{Object.keys(window.$barry.layers).forEach((e,i)=>{e.startsWith("route_")&&window.$barry.layers[e].setVisible(t===1?e.startsWith(r):!0)})};window.$barry.toggleConfiguration=()=>{window.$barry.$configuration.classList.toggle("hide"),window.$barry.$reduceConfiguration.classList.toggle("hide"),window.$barry.$augmentConfiguration.classList.toggle("hide")};window.$barry.toggleWelcome=()=>{window.$barry.$welcome.querySelector("div").classList.toggle("hide"),window.$barry.$reduceWelcome.classList.toggle("hide"),window.$barry.$augmentWelcome.classList.toggle("hide")};window.$barry.tourisme=()=>{const r=new URL(window.$barry.urlTourismAPI),t=window.$barry.meetPoint,e={lat_min:Number.parseFloat(t[1])-.2,lat_max:Number.parseFloat(t[1])+.2,lng_min:Number.parseFloat(t[0])-.3,lng_max:Number.parseFloat(t[0])+.3};Object.keys(e).forEach((n,s)=>r.searchParams.append(n,e[n]));const i=[[e.lat_min,e.lng_min],[e.lat_max,e.lng_max]];return dr(i),fetch(r).then(n=>n.text()).then(n=>{try{return JSON.parse(n)}catch{return n}})};window.$barry.zoom=r=>{dr(r)};const rd=()=>{window.$barry.layers={},ic(),window.$barry.map=new ju({target:"map",layers:[new Bu({source:new Ku})],view:new ci({center:[2.213749,46.927638],zoom:2})}),window.$barry.map.on("pointermove",r=>{window.$barry.map.forEachFeatureAtPixel(r.pixel,t=>{if(t.id_.startsWith("poi_")){const e=window.$barry.pois[t.id_];window.$barry.$popin.innerHTML=`
<h3>${e.label}</h3>
<p>${e.description}</p>
<ul>
  <li>
    ${e.address.replace(/\|/g,"<br />")}<br />${e.postcode} ${e.city}
  </li>
  <li>
    <a href="tel:${e.phone}">${e.phone}</a>
  </li>
  <li>
    <a href="mailto:${e.mail}">${e.mail}</a>
  </li>
</ul>
`,window.$barry.$popin.classList.remove("hide")}else window.$barry.$popin.classList.add("hide")},{layerFilter:t=>t.type===new As().type,hitTolerance:6})})};rd();za();window.$barry.newAddress();if(window.location.hash!==""){const r=atob(window.location.hash.substring(1)).split("|");r.length>1&&(window.$barry.calculateMode=r.shift(),window.$barry.calculateMode!=="time"&&(window.$barry.$toggleCalcMode.checked=!0),r.forEach((t,e)=>{const i=window.$barry.addressesCount-1;window.$barry.canPlace(`place_${i}`),window.$barry.placePoint(t,`place_${i}`);const n=document.getElementById(`address_${i}`);n.querySelector("input").value=t,n.querySelector(".plus").classList.add("hide"),n.querySelector(".minus").classList.remove("hide"),window.$barry.newAddress()}))}
